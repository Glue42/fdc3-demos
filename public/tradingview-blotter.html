<html>

<head>
    <title>TradingView Blotter</title>
    <link rel="shortcut icon" href="https://www.tradingview.com/static/images/favicon.ico">
    <style>
        body {
            background: #222;
            margin: 0px;
        }

        #blotter-container {
            display: flex;
            flex-flow: wrap;
            margin: 3px;
        }

        #blotter-container .tradingview-widget-container {
            padding: 3px;
        }
    </style>
    <script src="/scripts/util.js"></script>
    <!-- TODO (optional): Reference the manifest you want to use here: -->
    <!-- e.g. <link rel="manifest" href="./manifests/web/tradingview-blotter"> -->
    <link rel="manifest" href="./manifest-blotter.json">
    <script>
        // TODO (optional): Register the service worker you want to use here:
        // e.g.
        // if ("serviceWorker" in navigator) {
        //     navigator.serviceWorker.register('./tradingview-blotter/sw.js');
        // }
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("./service-worker.js");
        }
    </script>
    <!-- TODO (optional): Reference your FDC3 implementation here. Skip this if your implementation is auto injected by the container or by a browser extension. -->
    <script type="text/javascript" src="./scripts/fdc3-glue42.js"></script>

    <!-- TODO (optional): Reference any other scripts/styles you might need here (e.g. for a channel selector widget). -->
    <link rel="stylesheet" href="./scripts/jquery-ui.min.css">
    <script type="text/javascript" src="./scripts/jquery-1.12.4.min.js"></script>
    <script src="./scripts/jquery-ui.min.js"></script>
    <script src="./scripts/glue42-core-channel-selector.js"></script>
</head>

<body>
    <!-- TODO (optional): Add a HTML element that would hold the channel selector widget.  -->
    <!-- e.g. <select id="channel-selector-widget"></select> -->
    <select id="channel-selector-widget"></select>

    <!-- TradingView Widget BEGIN -->
    <div class="tradingview-widget-container">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js"
            async>
                {
                    "symbols": [
                        {
                            "proName": "OANDA:SPX500USD",
                            "title": "S&P 500"
                        },
                        {
                            "proName": "OANDA:NAS100USD",
                            "title": "Nasdaq 100"
                        },
                        {
                            "proName": "FX_IDC:EURUSD",
                            "title": "EUR/USD"
                        },
                        {
                            "proName": "BITSTAMP:BTCUSD",
                            "title": "BTC/USD"
                        },
                        {
                            "proName": "BITSTAMP:ETHUSD",
                            "title": "ETH/USD"
                        }
                    ],
                        "colorTheme": "dark",
                            "isTransparent": false,
                                "displayMode": "adaptive",
                                    "locale": "en"
                }
            </script>
    </div>
    <!-- TradingView Widget END -->

    <div id="blotter-container"></div>
</body>
<script>
    const makeTicker = (context) => {
        const wrapper = document.createElement("div");
        const ticker = context.id.ticker;
        wrapper.className = "tradingview-widget-container";
        wrapper.innerHTML = `<div class="tradingview-widget-container__widget"></div></div>`;
        document.getElementById("blotter-container").appendChild(wrapper);
        const script = document.createElement("script");
        script.src = "https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js";
        script.innerHTML = `{
  "symbol": "${ticker}",
  "width": 350,
  "colorTheme": "dark",
  "isTransparent": false,
  "locale": "en"
}`;
        const target = wrapper.querySelector(".tradingview-widget-container__widget");
        target.appendChild(script);
    };

    document.addEventListener("DOMContentLoaded", () => {
        fdc3Init(() => {
            fdc3.addContextListener(ctx => {
                if (ctx.type === "fdc3.instrument" && typeof ctx.id.ticker !== "undefined") {
                    makeTicker(ctx);
                }
            });
        });
    });
</script>

</html>
