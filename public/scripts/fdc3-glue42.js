!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).web=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __awaiter(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,u)}s((r=r.apply(n,e||[])).next())}))}var OpenError,ResolveError,ChannelError,ContextTypes,Intents;!function(n){n.AppNotFound="AppNotFound",n.ErrorOnLaunch="ErrorOnLaunch",n.AppTimeout="AppTimeout",n.ResolverUnavailable="ResolverUnavailable"}(OpenError||(OpenError={})),function(n){n.NoAppsFound="NoAppsFound",n.ResolverUnavailable="ResolverUnavailable",n.ResolverTimeout="ResolverTimeout"}(ResolveError||(ResolveError={})),function(n){n.NoChannelFound="NoChannelFound",n.AccessDenied="AccessDenied",n.CreationFailed="CreationFailed"}(ChannelError||(ChannelError={})),function(n){n.Contact="fdc3.contact",n.ContactList="fdc3.contactList",n.Country="fdc3.country",n.Instrument="fdc3.instrument",n.Organization="fdc3.organization",n.Portfolio="fdc3.portfolio",n.Position="fdc3.position"}(ContextTypes||(ContextTypes={})),function(n){n.StartCall="StartCall",n.StartChart="StartChart",n.ViewChart="ViewChart",n.ViewContact="ViewContact",n.ViewQuote="ViewQuote",n.ViewNews="ViewNews",n.ViewInstrument="ViewInstrument",n.ViewAnalysis="ViewAnalysis"}(Intents||(Intents={}));const newSubscribe=(n,e)=>{let t=!1;return window.glue.contexts.subscribe(n,((n,r,i,o,l)=>{if(!t)return void(t=!0);l.updaterId===window.glue.interop.instance.instance||e(n,r,i,o,l)}))},getChannelsList=()=>__awaiter(void 0,void 0,void 0,(function*(){const n=yield window.glue.channels.all();return yield Promise.all(n.map((n=>window.glue.channels.get(n))))})),isEmptyObject=n=>0===Object.keys(n).length&&n.constructor===Object,isGlue42Core=!navigator.userAgent.toLowerCase().includes(" electron/"),AsyncListener=n=>({unsubscribe(){n?"function"==typeof n?n():n.then((n=>n())):console.error("Failed to unsubscribe!")}}),waitFor=(n,e,t)=>new Promise((r=>{const i=()=>{void 0!==t?r(t()):r()};if(n())i();else{let t;t=setInterval((()=>{n()&&(clearInterval(t),i())}),e)}}));class SystemChannel{constructor(n){this.type="system",this.id=n.name,this.displayMetadata=n.meta}broadcast(n){return window.glue.channels.publish(n,this.id)}getCurrentContext(n){return __awaiter(this,void 0,void 0,(function*(){const e=yield window.glue.channels.get(this.id),{data:t}=e;return n?t&&t.type===n?t:null:t}))}addContextListener(n,e){const t=2===arguments.length&&n,r=2===arguments.length?e:n,i=window.glue.channels.subscribeFor(this.id,(n=>{t?(null==n?void 0:n.type)===t&&r(n):r(n)}));return{unsubscribe(){i.then((n=>n()))}}}join(){return window.glue.channels.join(this.id)}leave(){return window.glue.channels.leave()}}class AppChannel{constructor(n){this.id=n,this.type="app"}broadcast(n){return window.glue.contexts.update(this.id,n)}getCurrentContext(n){return __awaiter(this,void 0,void 0,(function*(){const e=yield window.glue.contexts.get(this.id),{data:t}=e;return n?t&&t.type===n?t:null:t}))}addContextListener(n,e){const t=2===arguments.length&&n,r=2===arguments.length?e:n,i=newSubscribe(this.id,(n=>{t?(null==n?void 0:n.type)===t&&r(n):r(n)}));return{unsubscribe:()=>{i.then((n=>n()))}}}}const createChannelsAgent=()=>{let n,e;const t={};let r=[];const i=window.fdc3GluePromise.then((()=>{const n=window.glue.channels.current();isGlue42Core||(void 0!==n&&a(n),window.glue.channels.changed((n=>{a(n)})));const e=getChannelsList().then((n=>{n.map((n=>{t[n.name]=u(n)}))})),i=window.glue.channels.all().then((n=>{r=n}));return Promise.all([e,i])})),o=n=>__awaiter(void 0,void 0,void 0,(function*(){return(yield window.glue.contexts.all()).some((e=>e===n))})),l=n=>!!n&&r.some((e=>e===n.id)),u=n=>new SystemChannel(n),s=n=>new AppChannel(n),a=n=>__awaiter(void 0,void 0,void 0,(function*(){yield i,void 0!==n&&g(t[n])})),c=(n,t)=>{let r=()=>{e=null};return e={contextType:n,handler:t,setActualUnsub:n=>{r=n}},{unsubscribe:r}},d=()=>__awaiter(void 0,void 0,void 0,(function*(){yield i;return r.map((n=>t[n]))})),h=n=>__awaiter(void 0,void 0,void 0,(function*(){yield i;return(yield o(n))||(yield(n=>__awaiter(void 0,void 0,void 0,(function*(){yield window.glue.contexts.set(n,null)})))(n)),s(n)})),f=()=>__awaiter(void 0,void 0,void 0,(function*(){l(n)&&(yield n.leave())}));function p(e,t){const r=2===arguments.length&&e,i=2===arguments.length?t:e;if(!n){console.warn("You need to join a channel in order to start receiving broadcasted contexts!");const n=c(r,i);return window.fdc3GluePromise.then((()=>window.glue.windows.my().getContext())).then((n=>{isEmptyObject(n)||i(n)})),n}const{id:o,type:l}=n,u=n=>"system"===l?window.glue.channels.subscribe(n):newSubscribe(o,n),s=n=>{r?n.type===r&&i(n):i(n)},a=u(s);return AsyncListener(a)}const g=t=>{if(n=t,e){const{contextType:n,handler:t,setActualUnsub:r}=e;r(p(n,t).unsubscribe),e=null}};return{getSystemChannels:d,getOrCreateChannel:n=>__awaiter(void 0,void 0,void 0,(function*(){const e=(yield d()).find((e=>e.id===n));return void 0===e?h(n):e})),joinChannel:n=>__awaiter(void 0,void 0,void 0,(function*(){yield i;const e=t[n]||(yield(n=>__awaiter(void 0,void 0,void 0,(function*(){if(yield i,!(yield o(n)))throw new Error(ChannelError.NoChannelFound);const e=s(n);return t[n]=e,e})))(n));if(!e)throw new Error(ChannelError.NoChannelFound);l(e)?e.join():yield f(),g(e)})),getCurrentChannel:()=>__awaiter(void 0,void 0,void 0,(function*(){return yield i,n})),leaveCurrentChannel:()=>__awaiter(void 0,void 0,void 0,(function*(){yield i,yield f(),n=null})),broadcast:e=>__awaiter(void 0,void 0,void 0,(function*(){if(yield i,!n)return void console.error("You need to join a channel in order to broadcast.");const{id:t,type:r}=n;"system"===r?window.glue.channels.publish(e):window.glue.contexts.update(t,e)})),addContextListener:p}},convertGlue42IntentToFDC3AppIntent=n=>{const{name:e,handlers:t}=n,r=t.filter((n=>"app"===n.type)),i=t.filter((n=>"instance"===n.type&&!r.some((e=>e.applicationName===n.applicationName)))),o=[...r,...i];return{intent:{name:e,displayName:t[0].displayName||""},apps:o.map((n=>{const e=n.applicationName,t=window.glue.appManager.application(e);return{name:e,title:n.applicationTitle||n.instanceTitle||e,tooltip:(null==t?void 0:t.userProperties.tooltip)||`${e} (${n.type})`,description:n.applicationDescription,icons:n.applicationIcon?[n.applicationIcon,...(null==t?void 0:t.userProperties.icons)||[]]:null==t?void 0:t.userProperties.icons,images:null==t?void 0:t.userProperties.images}}))}},createIntentsAgent=()=>({open:(...n)=>__awaiter(void 0,void 0,void 0,(function*(){return yield window.fdc3GluePromise,((n,e)=>__awaiter(void 0,void 0,void 0,(function*(){const t=window.glue.appManager.application(n);if(void 0===t)throw new Error(OpenError.AppNotFound);try{yield t.start(e)}catch(n){}})))(...n)})),findIntent:(...n)=>__awaiter(void 0,void 0,void 0,(function*(){return yield window.fdc3GluePromise,((n,e)=>__awaiter(void 0,void 0,void 0,(function*(){if("string"!=typeof n)throw new Error("Please provide the intent as a string!");if(void 0!==e&&"string"!=typeof e.type)throw new Error("Please provide the context.type as a string!");const t=yield window.glue.intents.find({name:n,contextType:null==e?void 0:e.type});if(void 0!==t&&0===t.length)throw new Error(ResolveError.NoAppsFound);return convertGlue42IntentToFDC3AppIntent(t[0])})))(...n)})),findIntentsByContext:(...n)=>__awaiter(void 0,void 0,void 0,(function*(){return yield window.fdc3GluePromise,(n=>__awaiter(void 0,void 0,void 0,(function*(){if(void 0!==n&&"string"!=typeof n.type)throw new Error("Please provide the context.type as a string!");const e=yield window.glue.intents.find({contextType:n.type});if(void 0!==e&&0===e.length)throw new Error(ResolveError.NoAppsFound);return e.map((n=>convertGlue42IntentToFDC3AppIntent(n)))})))(...n)})),raiseIntent:(...n)=>__awaiter(void 0,void 0,void 0,(function*(){return yield window.fdc3GluePromise,((n,e,t)=>__awaiter(void 0,void 0,void 0,(function*(){if("string"!=typeof n)throw new Error("Please provide the intent as a string!");if(void 0!==e&&"string"!=typeof e.type)throw new Error("Please provide the context.type as a string!");if(void 0!==t&&"string"!=typeof t)throw new Error("Please provide the target as a string!");let r="reuse";if(void 0!==t){const n=window.glue.appManager.application(t);if(void 0===n)throw new Error(OpenError.AppNotFound);const e=n.instances;r=0===e.length?{app:t}:{instance:e[0].id}}const i={type:e.type,data:Object.assign({},e)},o={intent:n,context:i,target:r},l=yield window.glue.intents.raise(o);return{source:l.handler.applicationName,version:"1.0.0",data:l.result}})))(...n)})),addIntentListener:(n,e)=>{if("string"!=typeof n)throw new Error("Please provide the intent as a string!");if("function"!=typeof e)throw new Error("Please provide the handler as a function!");const t={unsubscribe:()=>console.error("Failed to unsubscribe!")},r=n=>{e(Object.assign(Object.assign({},n.data),{type:n.type||""}))};return window.fdc3GluePromise.then((()=>{t.unsubscribe=window.glue.intents.addIntentListener(n,r).unsubscribe})),t}}),createDesktopAgent=()=>{const n=createIntentsAgent(),e=createChannelsAgent();return Object.assign(Object.assign({},n),e)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var extendStatics=function(n,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function __extends(n,e){function t(){this.constructor=n}extendStatics(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign=function(){return(__assign=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __awaiter$1(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new t((function(e){e(n.value)})).then(l,u)}s((r=r.apply(n,e||[])).next())}))}function __generator(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics$1=function(n,e){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function __extends$1(n,e){function t(){this.constructor=n}extendStatics$1(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign$1=function(){return(__assign$1=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __awaiter$1$1(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new t((function(e){e(n.value)})).then(l,u)}s((r=r.apply(n,e||[])).next())}))}function __generator$1(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function __spreadArrays(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],l=0,u=o.length;l<u;l++,i++)r[i]=o[l];return r}var MetricTypes={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue(n){return n.type===MetricTypes.TIMESTAMP?"timestamp":n.type===MetricTypes.NUMBER?"number":n.type===MetricTypes.STRING?"string":n.type===MetricTypes.OBJECT?"object":"unknown"}function getTypeByValue(n){return n.constructor===Date?"timestamp":"number"==typeof n?"number":"string"==typeof n?"string":"object"==typeof n?"object":"string"}function serializeMetric(n){var e={},t=getMetricTypeByValue(n);if("object"===t){var r=Object.keys(n.value).reduce((function(e,t){var r=getTypeByValue(n.value[t]);if("object"===r){var i=defineNestedComposite(n.value[t]);e[t]={type:"object",description:"",context:{},composite:i}}else e[t]={type:r,description:"",context:{}};return e}),{});e.composite=r}return e.name=normalizeMetricName(n.path.join("/")+"/"+n.name),e.type=t,e.description=n.description,e.context={},e}function defineNestedComposite(n){return Object.keys(n).reduce((function(e,t){var r=getTypeByValue(n[t]);return e[t]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite(n[t])}:{type:r,description:"",context:{}},e}),{})}function normalizeMetricName(n){return void 0!==n&&n.length>0&&"/"!==n[0]?"/"+n:n}function getMetricValueByType(n){return"timestamp"===getMetricTypeByValue(n)?Date.now():publishNestedComposite(n.value)}function publishNestedComposite(n){return"object"!=typeof n?n:Object.keys(n).reduce((function(e,t){var r=n[t];return"object"==typeof r&&r.constructor!==Date?e[t]=publishNestedComposite(r):r.constructor===Date?e[t]=new Date(r).getTime():r.constructor===Boolean?e[t]=r.toString():e[t]=r,e}),{})}function flatten(n){return n.reduce((function(n,e){return n.concat(Array.isArray(e)?flatten(e):e)}),[])}function getHighestState(n){return n.sort((function(n,e){return n.state?e.state?e.state-n.state:-1:1}))[0]}function aggregateDescription(n){var e="";return n.forEach((function(n,t,r){var i=n.path.join(".");t===r.length-1?e+=i+"."+n.name+": "+n.description:e+=i+"."+n.name+": "+n.description+","})),e.length>100?e.slice(0,100)+"...":e}function composeMsgForRootStateMetric(n){var e=flatten(n.root.getAggregateState()),t=getHighestState(e);return{description:aggregateDescription(e),value:t.state}}function gw3(n,e){var t,r,i=this;if(!n||"object"!=typeof n)throw new Error("Connection is required parameter");var o=function(n){l(n.root)},l=function(n){u(n),n.metrics.forEach((function(n){s(n)})),n.subSystems.forEach((function(n){l(n)}))},u=function(n){return __awaiter$1$1(i,void 0,void 0,(function(){var e,i;return __generator$1(this,(function(o){switch(o.label){case 0:return void 0===n.parent?[2]:[4,t];case 1:return o.sent(),e={name:normalizeMetricName(n.path.join("/")+"/"+n.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[e]},r.send(i),[2]}}))}))},s=function(n){return __awaiter$1$1(i,void 0,void 0,(function(){var e,i,o;return __generator$1(this,(function(l){switch(l.label){case 0:return e=c(n),[4,t];case 1:return l.sent(),i=serializeMetric(e),o={type:"define",metrics:[i]},r.send(o),void 0!==e.value&&a(e),[2]}}))}))},a=function(n){if(d()){var e=getMetricValueByType(n),t={type:"publish",values:[{name:normalizeMetricName(n.path.join("/")+"/"+n.name),value:e,timestamp:Date.now()}]};return r.sendFireAndForget(t)}return Promise.resolve()},c=function(n){var e=__assign$1({},n);return"object"==typeof n.value&&null!==n.value&&(e.value=__assign$1({},n.value)),e},d=function(){var n;try{return(null!==(n=e.canUpdateMetric)&&void 0!==n?n:function(){return!0})()}catch(n){return!0}};return{init:function(i){var l;t=new Promise((function(n){l=n})),(r=n.domain("metrics")).onJoined((function(n){!n&&l&&(l(),l=void 0);var e={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(e),n&&o(i)})),r.join({system:e.system,service:e.service,instance:e.instance})},createSystem:u,updateSystem:function(e,o){return __awaiter$1$1(i,void 0,void 0,(function(){var i,l,u;return __generator$1(this,(function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),i={type:"publish",values:[{name:normalizeMetricName(e.path.join("/")+"/"+e.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric(e),u={type:"publish",peer_id:n.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(u),[2]}}))}))},createMetric:s,updateMetric:function(n){return __awaiter$1$1(i,void 0,void 0,(function(){var e;return __generator$1(this,(function(r){switch(r.label){case 0:return e=c(n),[4,t];case 1:return r.sent(),a(e),[2]}}))}))}}}var Helpers={validate:function(n,e,t){if(null===n||"object"!=typeof n)throw new Error("Missing definition");if(null===e||"object"!=typeof e)throw new Error("Missing parent");if(null===t||"object"!=typeof t)throw new Error("Missing transport")}},BaseMetric=function(){function n(n,e,t,r,i){this.definition=n,this.system=e,this.transport=t,this.value=r,this.type=i,this.path=[],Helpers.validate(n,e,t),this.path=e.path.slice(0),this.path.push(e.name),this.name=n.name,this.description=n.description,t.createMetric(this)}return Object.defineProperty(n.prototype,"repo",{get:function(){var n;return null===(n=this.system)||void 0===n?void 0:n.repo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),n.prototype.update=function(n){return this.value=n,this.transport.updateMetric(this)},n}(),NumberMetric=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes.NUMBER)||this}return __extends$1(e,n),e.prototype.incrementBy=function(n){this.update(this.value+n)},e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.incrementBy(-1)},e.prototype.decrementBy=function(n){this.incrementBy(-1*n)},e}(BaseMetric),ObjectMetric=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes.OBJECT)||this}return __extends$1(e,n),e.prototype.update=function(n){return this.mergeValues(n),this.transport.updateMetric(this)},e.prototype.mergeValues=function(n){var e=this;return Object.keys(this.value).forEach((function(t){void 0!==n[t]&&(e.value[t]=n[t])}))},e}(BaseMetric),StringMetric=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes.STRING)||this}return __extends$1(e,n),e}(BaseMetric),TimestampMetric=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes.TIMESTAMP)||this}return __extends$1(e,n),e.prototype.now=function(){this.update(new Date)},e}(BaseMetric);function system(n,e,t,r,i){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");var o,l,u=t,s=n,a=i||"",c=e,d=r,h=function n(e){if(!e||!e.parent)return[];var t=n(e.parent);return t.push(e.name),t}(r),f={},p=(l="/",((o=h)&&o.length>0?o.join(l):"")+n),g=e.root,w=[],v=[];function m(n,e,t,r){var i={name:""};i="string"==typeof n?{name:n}:n;var o=v.filter((function(n){return n.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==e)throw new Error("A metric named "+i.name+" is already defined with different type.");return void 0!==t&&l.update(t).catch((function(){})),l}var u=r(i);return v.push(u),u}var y={get name(){return s},get description(){return a},get repo(){return c},get parent(){return d},path:h,id:p,root:g,get subSystems(){return w},get metrics(){return v},subSystem:function(n,e){if(!n||0===n.length)throw new Error("name is required");var t=w.filter((function(e){return e.name===n}));if(t.length>0)return t[0];var r=system(n,c,u,y,e);return w.push(r),r},getState:function(){return f},setState:function(n,e){f={state:n,description:e},u.updateSystem(y,f)},stringMetric:function(n,e){return m(n,MetricTypes.STRING,e,(function(n){return new StringMetric(n,y,u,e)}))},timestampMetric:function(n,e){return m(n,MetricTypes.TIMESTAMP,e,(function(n){return new TimestampMetric(n,y,u,e)}))},objectMetric:function(n,e){return m(n,MetricTypes.OBJECT,e,(function(n){return new ObjectMetric(n,y,u,e)}))},numberMetric:function(n,e){return m(n,MetricTypes.NUMBER,e,(function(n){return new NumberMetric(n,y,u,e)}))},getAggregateState:function(){var n=[];return Object.keys(f).length>0&&n.push({name:s,path:h,state:f.state,description:f.description}),w.forEach((function(e){var t=e.getAggregateState();t.length>0&&n.push.apply(n,t)})),n}};return u.createSystem(y),y}var Repository=function(){function n(n,e){e.init(this),this.root=system("",this,e),this.addSystemMetrics(this.root,n.clickStream||void 0===n.clickStream)}return n.prototype.addSystemMetrics=function(n,e){if("undefined"!=typeof navigator&&n.stringMetric("UserAgent",navigator.userAgent),e&&"undefined"!=typeof document){var t=n.subSystem("ClickStream"),r=function(n){if(n.target){var e=n.target;t.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:n.target?e.className:"",id:e.id,type:"<"+e.tagName.toLowerCase()+">",href:e.href||""}})}};t.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}n.stringMetric("StartTime",(new Date).toString());var i=n.stringMetric("StartURL",""),o=n.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},n}(),NullProtocol=function(){function n(){}return n.prototype.init=function(n){},n.prototype.createSystem=function(n){return Promise.resolve()},n.prototype.updateSystem=function(n,e){return Promise.resolve()},n.prototype.createMetric=function(n){return Promise.resolve()},n.prototype.updateMetric=function(n){return Promise.resolve()},n}(),PerfTracker=function(){function n(n,e,t){this.api=n,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=e?e:this.initialPublishTimeout,this.publishInterval=null!=t?t:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return n.prototype.scheduleCollection=function(){var n=this;setTimeout((function(){n.collect(),setInterval((function(){n.collect()}),n.publishInterval)}),this.initialPublishTimeout)},n.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(n){}},n.prototype.collectMemory=function(){var n=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:n.totalJSHeapSize,usedJSHeapSize:n.usedJSHeapSize}))},n.prototype.collectEntries=function(){var n=window.performance.getEntries();n.length<=this.lastCount||(this.lastCount=n.length,this.system.stringMetric("entries",JSON.stringify(n)))},n}(),metrics=function(n){var e;e=n.connection&&"object"==typeof n.connection?gw3(n.connection,n):new NullProtocol;var t=new Repository(n,e).root;n.disableAutoAppSystem||(t=t.subSystem("App"));var r=addFAVSupport(t);return initPerf(r,n.pagePerformanceMetrics),r},perf;function initPerf(n,e){var t,r;if("undefined"!=typeof window){var i=null===(r=null===(t=null===window||void 0===window?void 0:window.glue42gd)||void 0===t?void 0:t.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(e=i),(null==e?void 0:e.enabled)&&(perf=new PerfTracker(n,e.initialPublishTimeout,e.publishInterval))}}function addFAVSupport(n){var e,t=n.subSystem("reporting"),r={name:"features"};return n.featureMetric=function(n,i,o){if(void 0===n||""===n)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");e?e.update({name:n,action:i,payload:o}):e=t.objectMetric(r,{name:n,action:i,payload:o})},n}function createRegistry(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry.default=createRegistry;var lib=createRegistry,InProcTransport=function(){function n(n,e){var t=this;this.registry=lib(),this.gw=n.facade,this.gw.connect((function(n,e){t.messageHandler(e)})).then((function(n){t.client=n}))}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.client?(this.client.send(n),Promise.resolve(void 0)):Promise.reject("not connected")},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"in-memory"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),SharedWorkerTransport=function(){function n(n,e){var t=this;this.logger=e,this.registry=lib(),this.worker=new SharedWorker(n),this.worker.port.onmessage=function(n){t.messageHandler(n.data)}}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.worker.port.postMessage(n),Promise.resolve()},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"shared-worker"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),Utils=function(){function n(){}return n.getGDMajorVersion=function(){if("undefined"!=typeof window&&window.glueDesktop&&window.glueDesktop.version){var n=Number(window.glueDesktop.version.substr(0,1));return isNaN(n)?void 0:n}},n.isNode=function(){if(void 0!==n._isNode)return n._isNode;if("undefined"!=typeof window)return n._isNode=!1,!1;try{n._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(e){n._isNode=!1}return n._isNode},n}(),PromiseWrapper=function(){function n(){var n=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(e,t){n.resolve=function(t){n.resolved=!0,e(t)},n.reject=function(e){n.rejected=!0,t(e)}}))}return n.delay=function(n){return new Promise((function(e){return setTimeout(e,n)}))},Object.defineProperty(n.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),n}(),timers={};function getAllTimers(){return timers}function timer(n){var e=timers[n];if(e)return e;var t=[];function r(){return(new Date).getTime()}var i,o,l=r();function u(n,e){var i=null!=e?e:r(),o=0;t.length>0&&(o=i-t[t.length-1].time),t.push({name:n,time:i,diff:o})}u("start",l);var s={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return u("end",i=r()),o=i-l},mark:u,marks:t};return timers[n]=s,s}var WebSocketConstructor=Utils.isNode()?require("ws"):window.WebSocket,WS=function(){function n(n,e){if(this.startupTimer=timer("connection"),this._running=!0,this._registry=lib(),this.wsRequests=[],this.settings=n,this.logger=e,!this.settings.ws)throw new Error("ws is missing")}return n.prototype.onMessage=function(n){return this._registry.add("onMessage",n)},n.prototype.send=function(n,e){var t=this;return new Promise((function(e,r){t.waitForSocketConnection((function(){var i;try{null===(i=t.ws)||void 0===i||i.send(n),e()}catch(n){r(n)}}),r)}))},n.prototype.open=function(){var n=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(e,t){n.waitForSocketConnection(e,t)}))},n.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},n.prototype.onConnectedChanged=function(n){return this._registry.add("onConnectedChanged",n)},n.prototype.name=function(){return"ws "+this.settings.ws},n.prototype.reconnect=function(){var n;null===(n=this.ws)||void 0===n||n.close();var e=new PromiseWrapper;return this.waitForSocketConnection((function(){e.resolve()})),e.promise},n.prototype.waitForSocketConnection=function(n,e){var t;e=null!=e?e:function(){},this._running?1!==(null===(t=this.ws)||void 0===t?void 0:t.readyState)?(this.wsRequests.push({callback:n,failed:e}),this.wsRequests.length>1||this.openSocket()):n():e("wait for socket on "+this.settings.ws+" failed - socket closed by user")},n.prototype.openSocket=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t=this;return __generator$1(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===n&&(n=this.settings.reconnectInterval),void 0!==e){if(0===e)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+e+" more times (every "+n+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===e?void 0:e-1;t.openSocket(n,r)}),n),[3,4];case 4:return[2]}}))}))},n.prototype.initiateSocket=function(){var n=this,e=new PromiseWrapper;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new WebSocketConstructor(this.settings.ws||""),this.ws.onerror=function(t){var r="";try{r=JSON.stringify(t)}catch(n){var i=new WeakSet;r=JSON.stringify(t,(function(n,e){if("object"==typeof e&&null!==e){if(i.has(e))return;i.add(e)}return e}))}e.reject("error"),n.notifyStatusChanged(!1,r)},this.ws.onclose=function(t){n.logger.info("ws closed "+t),e.reject("closed"),n.notifyStatusChanged(!1)},this.ws.onopen=function(){var t;n.startupTimer.mark("ws-opened"),n.logger.info("ws opened "+(null===(t=n.settings.identity)||void 0===t?void 0:t.application)),e.resolve(),n.notifyStatusChanged(!0)},this.ws.onmessage=function(e){n._registry.execute("onMessage",e.data)},e.promise},n.prototype.notifyForSocketState=function(n){this.wsRequests.forEach((function(e){n?e.failed&&e.failed(n):e.callback()})),this.wsRequests=[]},n.prototype.notifyStatusChanged=function(n,e){this._registry.execute("onConnectedChanged",n,e)},n}();function createCommonjsModule(n,e){return n(e={exports:{}},e.exports),e.exports}var seed=1;function getNextValue(){return(seed=(9301*seed+49297)%233280)/233280}function setSeed(n){seed=n}var randomFromSeed={nextValue:getNextValue,seed:setSeed},ORIGINAL="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet,previousSeed,shuffled;function reset(){shuffled=!1}function setCharacters(n){if(n){if(n!==alphabet){if(n.length!==ORIGINAL.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet=n,reset()}}else alphabet!==ORIGINAL&&(alphabet=ORIGINAL,reset())}function characters(n){return setCharacters(n),alphabet}function setSeed$1(n){randomFromSeed.seed(n),previousSeed!==n&&(reset(),previousSeed=n)}function shuffle(){alphabet||setCharacters(ORIGINAL);for(var n,e=alphabet.split(""),t=[],r=randomFromSeed.nextValue();e.length>0;)r=randomFromSeed.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled(){return shuffled||(shuffled=shuffle())}function lookup(n){return getShuffled()[n]}var alphabet_1={characters:characters,seed:setSeed$1,lookup:lookup,shuffled:getShuffled},crypto="object"==typeof window&&(window.crypto||window.msCrypto);function randomByte(){if(!crypto||!crypto.getRandomValues)return 48&Math.floor(256*Math.random());var n=new Uint8Array(1);return crypto.getRandomValues(n),48&n[0]}var randomByteBrowser=randomByte;function encode(n,e){for(var t,r=0,i="";!t;)i+=n(e>>4*r&15|randomByteBrowser()),t=e<Math.pow(16,r+1),r++;return i}var encode_1=encode;function decode(n){var e=alphabet_1.shuffled();return{version:15&e.indexOf(n.substr(0,1)),worker:15&e.indexOf(n.substr(1,1))}}var decode_1=decode;function isShortId(n){if(!n||"string"!=typeof n||n.length<6)return!1;for(var e=alphabet_1.characters(),t=n.length,r=0;r<t;r++)if(-1===e.indexOf(n[r]))return!1;return!0}var isValid=isShortId,lib$1=createCommonjsModule((function(n){var e,t,r=0;function i(){var n="",i=Math.floor(.001*(Date.now()-1459707606518));return i===t?e++:(e=0,t=i),n+=encode_1(alphabet_1.lookup,6),n+=encode_1(alphabet_1.lookup,r),e>0&&(n+=encode_1(alphabet_1.lookup,e)),n+=encode_1(alphabet_1.lookup,i)}n.exports=i,n.exports.generate=i,n.exports.seed=function(e){return alphabet_1.seed(e),n.exports},n.exports.worker=function(e){return r=e,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1.characters(n),alphabet_1.shuffled()},n.exports.decode=decode_1,n.exports.isValid=isValid})),lib_1=lib$1.generate,lib_2=lib$1.seed,lib_3=lib$1.worker,lib_4=lib$1.characters,lib_5=lib$1.decode,lib_6=lib$1.isValid,shortid=lib$1;function domainSession(n,e,t,r,i){null==n&&(n="global"),r=r||["success"],i=i||["error"];var o,l=!1,u=!1,s=!1,a=lib();e.disconnected((function(){s=!1,t.debug("connection is down"),l=!1,u=!0,a.execute("onLeft",{disconnected:!0})})),e.loggedIn((function(){s=!0,u&&(t.debug("connection is now up - trying to reconnect..."),d(o))})),e.on("success",(function(n){return f(n)})),e.on("error",(function(n){return h(n)})),e.on("result",(function(n){return f(n)})),r&&r.forEach((function(n){e.on(n,(function(n){return f(n)}))})),i&&i.forEach((function(n){e.on(n,(function(n){return h(n)}))}));var c={};function d(e){return o=e,new Promise((function(r,i){if(l)r();else{var o;if("global"===n)o=s?Promise.resolve({}):Promise.reject("not connected to gateway");else t.debug("joining domain "+n),o=g({type:"join",destination:n,domain:"global",options:e});o.then((function(){!function(){t.debug("did join "+n),l=!0;var e=u;u=!1,a.execute("onJoined",e)}(),r()})).catch((function(e){t.debug("error joining "+n+" domain: "+JSON.stringify(e)),i(e)}))}}))}function h(e){if(n===e.domain){var t=e.request_id;if(t){var r=c[t];r&&r.error(e)}}}function f(e){if(e.domain===n){var t=e.request_id;if(t){var r=c[t];r&&r.success(e)}}}function p(){return shortid()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||n,o.skipPeerId||(r.peer_id=e.peerId);var l=r.request_id;return new Promise((function(n,u){c[l]={success:function(e){delete c[l],e._tag=i,n(e)},error:function(n){t.warn("GW error - "+JSON.stringify(n)+" for request "+JSON.stringify(r)),delete c[l],n._tag=i,u(n)}},e.send(r,o).catch((function(n){c[l].error({err:n})}))}))}return{join:d,leave:function(){return"global"===n?Promise.resolve():(t.debug("stopping session "+n+"..."),u=!1,g({type:"leave",destination:n,domain:"global"}).then((function(){l=!1,a.execute("onLeft")})))},onJoined:function(n){return l&&n(!1),a.add("onJoined",n)},onLeft:function(n){return l||n(),a.add("onLeft",n)},send:g,sendFireAndForget:function(t){return t.request_id=t.request_id?t.request_id:p(),t.domain=t.domain||n,t.peer_id=e.peerId,e.send(t)},on:function(r,i){e.on(r,(function(e){if(e.domain===n)try{i(e)}catch(n){t.error("Callback  failed: "+n+" \n "+n.stack+" \n msg was: "+JSON.stringify(e),n)}}))},loggedIn:function(n){return e.loggedIn(n)},connected:function(n){return e.connected(n)},disconnected:function(n){return e.disconnected(n)},get peerId(){return e.peerId},get domain(){return n}}}var GW3ProtocolImpl=function(){function n(n,e,t){var r=this;this.connection=n,this.settings=e,this.logger=t,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],n.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.processStringMessage=function(n){var e=this,t=JSON.parse(n,(function(n,t){if("string"!=typeof t)return t;if(t.length<e.dateMinLen)return t;if(t[0]!==e.datePrefixFirstChar)return t;if(t.substring(0,e.datePrefixLen)!==e.datePrefix)return t;try{var r=parseInt(t.substring(e.datePrefixLen,t.length),10);return isNaN(r)?t:new Date(r)}catch(n){return t}}));return{msg:t,msgType:t.type}},n.prototype.createStringMessage=function(n){var e=Date.prototype.toJSON;try{var t=this.datePrefix;return Date.prototype.toJSON=function(){return t+this.getTime()},JSON.stringify(n)}finally{Date.prototype.toJSON=e}},n.prototype.processObjectMessage=function(n){if(!n.type)throw new Error("Object should have type property");return{msg:n,msgType:n.type}},n.prototype.createObjectMessage=function(n){return n},n.prototype.login=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t,r,i,o,l,u,s,a,c,d;return __generator$1(this,(function(h){switch(h.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=n,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,t={},this.connection.gatewayToken=n.gatewayToken,!n.gatewayToken)return[3,5];if(!e)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return a=h.sent(),n.gatewayToken=a,[3,4];case 3:return r=h.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null==r?void 0:r.message)||r)),[3,4];case 4:return t.method="gateway-token",t.token=n.gatewayToken,this.connection.gatewayToken=n.gatewayToken,[3,10];case 5:return"sspi"!==n.flowName?[3,9]:(t.provider="win",t.method="access-token",n.flowCallback&&n.sessionId?(i=t,[4,n.flowCallback(n.sessionId,null)]):[3,7]);case 6:return i.token=h.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(n.token)t.method="access-token",t.token=n.token;else{if(!n.username)throw new Error("invalid auth message"+JSON.stringify(n));t.method="secret",t.login=n.username,t.secret=n.password}h.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:t},n.sessionId&&(o.request_id=n.sessionId),this.globalDomain=domainSession("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),h.label=11;case 11:h.trys.push([11,19,20,21]),u=void 0,h.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(s=h.sent()).type?[3,16]:(a=Buffer.from(s.authentication.token,"base64"),n.flowCallback&&n.sessionId?(c=o.authentication,[4,n.flowCallback(n.sessionId,a)]):[3,15]);case 14:c.token=h.sent().data.toString("base64"),h.label=15;case 15:return o.request_id=n.sessionId,[3,12];case 16:if("welcome"===s.type)return u=s,[3,18];throw"error"===s.type?new Error("Authentication failed: "+s.reason):new Error("Unexpected message type during authentication: "+s.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.info("login successful with peerId "+u.peer_id),this.connection.peerId=u.peer_id,this.connection.resolvedIdentity=u.resolved_identity,this.connection.availableDomains=u.available_domains,u.options&&(this.connection.token=u.options.access_token,this.connection.info=u.options.info),this.setLoggedIn(!0),[2,u.resolved_identity];case 19:throw d=h.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return n&&n.flowCallback&&n.sessionId&&n.flowCallback(n.sessionId,null),[7];case 21:return[2]}}))}))},n.prototype.logout=function(){return __awaiter$1$1(this,void 0,void 0,(function(){var n;return __generator$1(this,(function(e){switch(e.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),n=this.sessions.map((function(n){n.leave()})),[4,Promise.all(n)];case 1:return e.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this._isLoggedIn&&n(),this.registry.add("onLoggedIn",n)},n.prototype.domain=function(n,e,t,r){var i=this.sessions.filter((function(e){return e.domain===n}))[0];return i||(i=domainSession(n,this.connection,e,t,r),this.sessions.push(i)),i},n.prototype.handleDisconnected=function(){var n=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(n.handleDisconnected.bind(n),n.settings.reconnectInterval||1e3)}))}},n.prototype.setLoggedIn=function(n){this._isLoggedIn=n,this._isLoggedIn&&this.registry.execute("onLoggedIn")},n.prototype.ping=function(){var n=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){n.ping()}),3e4))},n.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(n){return n.token})):Promise.reject(new Error("no global domain session"))},n.prototype.getNewGWToken=function(){if(void 0!==typeof window){var n=window.glue42gd;if(n)return n.getGWToken()}return Promise.reject(new Error("not running in GD"))},n}(),MessageReplayerImpl=function(){function n(n){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var e=0,t=n;e<t.length;e++){var r=t[e];this.specs[r.name]=r,this.specsNames.push(r.name)}}return n.prototype.init=function(n){var e=this;this.connection=n;for(var t=0,r=this.specsNames;t<r.length;t++)for(var i=r[t],o=function(t){var r=l.subsRefCount[t];if(r||(r=0),r+=1,l.subsRefCount[t]=r,r>1)return"continue";var i=n.on(t,(function(n){return e.processMessage(t,n)}));l.subs[t]=i},l=this,u=0,s=this.specs[i].types;u<s.length;u++){o(s[u])}},n.prototype.processMessage=function(n,e){if(!this.isDone&&e)for(var t=0,r=this.specsNames;t<r.length;t++){var i=r[t];if(-1!==this.specs[i].types.indexOf(n)){var o=this.messages[i]||[];this.messages[i]=o,o.push(e)}}},n.prototype.drain=function(n,e){var t;e&&(this.messages[n]||[]).forEach(e),delete this.messages[n];for(var r=0,i=this.specs[n].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(t=this.connection)||void 0===t||t.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[n],this.specs.length||(this.isDone=!0)},n}(),Connection=function(){function n(n,e){if(this.settings=n,this.logger=e,this.messageHandlers={},this.ids=1,this.registry=lib(),this._connected=!1,this.isTrace=!1,(n=n||{}).reconnectAttempts=n.reconnectAttempts||10,n.reconnectInterval=n.reconnectInterval||1e3,n.inproc)this.transport=new InProcTransport(n.inproc,e.subLogger("inMemory"));else if(n.sharedWorker)this.transport=new SharedWorkerTransport(n.sharedWorker,e.subLogger("shared-worker"));else{if(void 0===n.ws)throw new Error("No connection information specified");this.transport=new WS(n,e.subLogger("ws"))}this.isTrace=e.canPublish("trace"),e.info("starting with "+this.transport.name()+" transport"),this.protocol=new GW3ProtocolImpl(this,n,e.subLogger("protocol")),this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this.transport.onMessage(this.handleTransportMessage.bind(this)),n.replaySpecs&&n.replaySpecs.length&&(this.replayer=new MessageReplayerImpl(n.replaySpecs),this.replayer.init(this))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;return null===(n=this.protocol)||void 0===n?void 0:n.protocolVersion},enumerable:!0,configurable:!0}),n.prototype.send=function(n,e){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var t=this.protocol.createObjectMessage(n);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(t)),this.transport.sendObject(t,e)}var r=this.protocol.createStringMessage(n);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,e)},n.prototype.on=function(n,e){n=n.toLowerCase(),void 0===this.messageHandlers[n]&&(this.messageHandlers[n]={});var t=this.ids++;return this.messageHandlers[n][t]=e,{type:n,id:t}},n.prototype.off=function(n){delete this.messageHandlers[n.type.toLowerCase()][n.id]},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.connected=function(n){var e=this;return this.protocol.loggedIn((function(){n(e.settings.ws||e.settings.sharedWorker||"")}))},n.prototype.disconnected=function(n){return this.registry.add("disconnected",n)},n.prototype.login=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t;return __generator$1(this,(function(r){switch(r.label){case 0:return[4,this.transport.open()];case 1:return r.sent(),timer("connection").mark("transport-opened"),t=this.protocol.login(n,e),timer("connection").mark("protocol-logged-in"),[2,t]}}))}))},n.prototype.logout=function(){return __awaiter$1$1(this,void 0,void 0,(function(){return __generator$1(this,(function(n){switch(n.label){case 0:return[4,this.protocol.logout()];case 1:return n.sent(),[4,this.transport.close()];case 2:return n.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this.protocol.loggedIn(n)},n.prototype.domain=function(n,e,t){return this.protocol.domain(n,this.logger.subLogger("domain="+n),e,t)},n.prototype.authToken=function(){return this.protocol.authToken()},n.prototype.reconnect=function(){return this.transport.reconnect()},n.prototype.distributeMessage=function(n,e){var t=this,r=this.messageHandlers[e.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(e){var i=r[e];if(void 0!==i)try{i(n)}catch(n){try{t.logger.error("Message handler failed with "+n.stack,n)}catch(e){console.log("Message handler failed",n)}}}))},n.prototype.handleConnectionChanged=function(n){this._connected!==n&&(this._connected=n,n?this.registry.execute("connected"):this.registry.execute("disconnected"))},n.prototype.handleTransportMessage=function(n){var e;e="string"==typeof n?this.protocol.processStringMessage(n):this.protocol.processObjectMessage(n),this.isTrace&&this.logger.trace("<< "+JSON.stringify(e)),this.distributeMessage(e.msg,e.msgType)},n}(),order=["trace","debug","info","warn","error","off"],Logger=function(){function n(n,e,t){this.name=n,this.parent=e,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=n,this.path=e?e.path+"."+n:n,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!t,t&&(this.logFn=t,this.customLogFn=!0)}return n.prototype.subLogger=function(e){var t=this.subLoggers.filter((function(n){return n.name===e}))[0];if(void 0!==t)return t;Object.keys(this).forEach((function(n){if(n===e)throw new Error("This sub logger name is not allowed.")}));var r=new n(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},n.prototype.publishLevel=function(n){var e;return n&&(this._publishLevel=n),this._publishLevel||(null===(e=this.parent)||void 0===e?void 0:e.publishLevel())},n.prototype.consoleLevel=function(n){var e;return n&&(this._consoleLevel=n),this._consoleLevel||(null===(e=this.parent)||void 0===e?void 0:e.consoleLevel())},n.prototype.log=function(n,e,t){this.publishMessage(e||"info",n,t)},n.prototype.trace=function(n){this.log(n,"trace")},n.prototype.debug=function(n){this.log(n,"debug")},n.prototype.info=function(n){this.log(n,"info")},n.prototype.warn=function(n){this.log(n,"warn")},n.prototype.error=function(n,e){this.log(n,"error")},n.prototype.canPublish=function(n,e){return order.indexOf(n)>=order.indexOf(e||this.consoleLevel()||"trace")},n.prototype.publishMessage=function(e,t,r){var i=this.loggerFullName;if("error"===e&&!r){var o=new Error;o.stack&&(t=t+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(e,this.publishLevel())){var l=n.Interop;if(l)try{l.methods({name:n.InteropMethodName}).length>0&&l.invoke(n.InteropMethodName,{msg:""+t,logger:i,level:e})}catch(n){}}if(this.canPublish(e)){var u="";if(this.includeTimeAndLevel){var s=new Date;u="["+(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+":"+s.getMilliseconds())+"] ["+e+"] "}var a=""+u+i+": "+t;switch(e){case"trace":this.logFn.debug(a);break;case"debug":this.logFn.debug?this.logFn.debug(a):this.logFn.log(a);break;case"info":this.logFn.info(a);break;case"warn":this.logFn.warn(a);break;case"error":this.logFn.error(a,r)}}},n.InteropMethodName="T42.AppLogger.Log",n}(),GW_MESSAGE_CREATE_CONTEXT="create-context",GW_MESSAGE_ACTIVITY_CREATED="created",GW_MESSAGE_ACTIVITY_DESTROYED="destroyed",GW_MESSAGE_CONTEXT_CREATED="context-created",GW_MESSAGE_CONTEXT_ADDED="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT="update-context",GW_MESSAGE_CONTEXT_UPDATED="context-updated",GW_MESSAGE_JOINED_ACTIVITY="joined",ContextMessageReplaySpec={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT,GW_MESSAGE_ACTIVITY_CREATED,GW_MESSAGE_ACTIVITY_DESTROYED,GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_CONTEXT_ADDED,GW_MESSAGE_SUBSCRIBE_CONTEXT,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_UNSUBSCRIBE_CONTEXT,GW_MESSAGE_DESTROY_CONTEXT,GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_UPDATE_CONTEXT,GW_MESSAGE_CONTEXT_UPDATED,GW_MESSAGE_JOINED_ACTIVITY]}},version="5.2.7";function prepareConfig(n,e,t){var r,i,o,l,u,s;if(Utils.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(n){}}function c(){if(n.application)return n.application;if(t)return t.applicationName;var e=shortid();return Utils.isNode()?s?s.applicationConfig.name:"NodeJS"+e:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" ("+e+")":e}var d=function(){var r,i,o,l,u,a,d,h,f,p=n.gateway,g=null!==(r=null==p?void 0:p.protocolVersion)&&void 0!==r?r:3,w=null==p?void 0:p.reconnectInterval,v=null==p?void 0:p.reconnectAttempts,m=null==p?void 0:p.ws,y=null==p?void 0:p.sharedWorker,b=null==p?void 0:p.inproc;t&&(m=t.gwURL),Utils.isNode()&&s&&s.gwURL&&(m=s.gwURL),m||y||b||(m="ws://localhost:8385");var $=c(),_=$;void 0!==t?(a=t.windowId,d=t.pid,t.env&&(h=t.env.env,f=t.env.region),_=null!==(i=t.application)&&void 0!==i?i:"glue-app",u=t.appInstanceId):Utils.isNode()?(d=process.pid,s&&(h=s.env,f=s.region,u=s.instanceId)):a=window.name||shortid();var S=null!==(l=null===(o=n.gateway)||void 0===o?void 0:o.replaySpecs)&&void 0!==l?l:[];return S.push(ContextMessageReplaySpec),{identity:{application:_,applicationName:$,windowId:a,instance:u,process:d,region:f,environment:h,api:e.version||version},reconnectInterval:w,ws:m,sharedWorker:y,inproc:b,protocolVersion:g,reconnectAttempts:v,replaySpecs:S}}(),h=c();if("undefined"!=typeof window){var f=window,p=f.htmlContainer?f.htmlContainer.containerName+"."+f.htmlContainer.application:null===(r=null==f?void 0:f.glue42gd)||void 0===r?void 0:r.application;p&&(h=p)}return{bus:null!==(i=n.bus)&&void 0!==i&&i,application:h,auth:function(){var e,t;return"string"==typeof n.auth?{token:n.auth}:n.auth?n.auth:Utils.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(e=n.gateway)||void 0===e?void 0:e.inproc)||(null===(t=n.gateway)||void 0===t?void 0:t.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var e,r,i,o=n.logger,l="warn";return o||(o=l),t&&(i=t.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(e=null!=i?i:o.console)&&void 0!==e?e:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:d,metrics:null===(o=n.metrics)||void 0===o||o,contexts:null===(l=n.contexts)||void 0===l||l,version:e.version||version,libs:null!==(u=e.libs)&&void 0!==u?u:[],customLogger:n.customLogger}}var GW3ContextData=function(){function n(n,e,t,r){this.updateCallbacks={},this.contextId=n,this.name=e,this.isAnnounced=t,this.activityId=r,this.context={}}return n.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},n.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},n}();function applyContextDelta(n,e,t){try{if((null==t?void 0:t.canPublish("trace"))&&(null==t||t.trace("applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n))),!e)return n;if(e.reset)return n=__assign$1({},e.reset);if(n=deepClone(n,void 0),e.commands){for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath(n,o.path):"set"===o.type&&setValueToPath(n,o.value,o.path)}return n}var l=e.added,u=e.updated,s=e.removed;return l&&Object.keys(l).forEach((function(e){n[e]=l[e]})),u&&Object.keys(u).forEach((function(e){mergeObjectsProperties(e,n,u)})),s&&s.forEach((function(e){delete n[e]})),n}catch(r){return null==t||t.error("error applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n),r),n}}function deepClone(n,e){if(e=e||new WeakMap,Object(n)!==n)return n;if(n instanceof Set)return new Set(n);if(e.has(n))return e.get(n);var t=n instanceof Date?new Date(n):n instanceof RegExp?new RegExp(n.source,n.flags):n.constructor?new n.constructor:Object.create(null);return e.set(n,t),n instanceof Map&&Array.from(n,(function(n){var r=n[0],i=n[1];return t.set(r,deepClone(i,e))})),Object.assign.apply(Object,__spreadArrays([t],Object.keys(n).map((function(t){var r;return(r={})[t]=deepClone(n[t],e),r}))))}var mergeObjectsProperties=function(n,e,t){var r=t[n];if(void 0===r)return e;var i=e[n];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(e[n]=r,e):(e[n]=Object.assign({},i,r),e):(e[n]=r,e)};function deepEqual(n,e){if(n===e)return!0;if(!(n instanceof Object&&e instanceof Object))return!1;if(n.constructor!==e.constructor)return!1;for(var t in n)if(n.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(n[t]!==e[t]){if("object"!=typeof n[t])return!1;if(!deepEqual(n[t],e[t]))return!1}}for(var t in e)if(e.hasOwnProperty(t)&&!n.hasOwnProperty(t))return!1;return!0}function setValueToPath(n,e,t){var r,i=t.split(".");for(r=0;r<i.length-1;r++)n[i[r]]||(n[i[r]]={}),"object"!=typeof n[i[r]]&&(n[i[r]]={}),n=n[i[r]];n[i[r]]=e}function deletePath(n,e){var t,r=e.split(".");for(t=0;t<r.length-1;t++){if(!n[r[t]])return;n=n[r[t]]}delete n[r[t]]}var GW3Bridge=function(){function n(n){var e,t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._connection=n.connection,this._logger=n.logger,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_CONTEXT_UPDATED]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec.name,(function(n){var e=n.type;e&&(e===GW_MESSAGE_CONTEXT_CREATED||e===GW_MESSAGE_CONTEXT_ADDED||e===GW_MESSAGE_ACTIVITY_CREATED?t.handleContextCreatedMessage(n):e===GW_MESSAGE_SUBSCRIBED_CONTEXT||e===GW_MESSAGE_CONTEXT_UPDATED||e===GW_MESSAGE_JOINED_ACTIVITY?t.handleContextUpdatedMessage(n):e!==GW_MESSAGE_CONTEXT_DESTROYED&&e!==GW_MESSAGE_ACTIVITY_DESTROYED||t.handleContextDestroyedMessage(n))}))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;if(!this._protocolVersion){var e=this._connection.availableDomains.find((function(n){return"context"===n.uri}));this._protocolVersion=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){for(var n=0,e=this._gw3Subscriptions;n<e.length;n++){var t=e[n];this._connection.off(t)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},n.prototype.createContext=function(n,e){var t=this;return this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT,domain:"global",name:n,data:e,lifetime:"retained"}).then((function(r){t._contextNameToId[n]=r.context_id,t._contextIdToName[r.context_id]=n;var i=t._contextNameToData[n]||new GW3ContextData(r.context_id,n,!0,void 0);return i.isAnnounced=!0,i.name=n,i.contextId=r.context_id,i.context=e,t._contextNameToData[n]=i,r.context_id}))},n.prototype.all=function(){var n=this;return Object.keys(this._contextNameToData).filter((function(e){return n._contextNameToData[e].isAnnounced}))},n.prototype.update=function(n,e){var t;return __awaiter$1$1(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator$1(this,(function(u){switch(u.label){case 0:return(r=this._contextNameToData[n])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(n,e)];case 1:i=u.sent(),u.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,e):this.calculateContextDeltaV1(i,e),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(t=o.commands)||void 0===t?void 0:t.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(n){l.handleUpdated(r,o,{updaterId:n.peer_id})}))]:[2,Promise.resolve()]}}))}))},n.prototype.set=function(n,e){var t=this,r=this._contextNameToData[n];return r&&r.isAnnounced?this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:{reset:e}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{reset:e,added:{},removed:[],updated:{}},{updaterId:n.peer_id})})):this.createContext(n,e)},n.prototype.setPath=function(n,e,t){return this.setPathSupported?this.setPaths(n,[{path:e,value:t}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},n.prototype.setPaths=function(n,e){var t=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[n];if(!r||!r.isAnnounced){for(var i={},o=0,l=e;o<l.length;o++){setValueToPath(i,(c=l[o]).value,c.path)}return this.createContext(n,i)}for(var u=[],s=0,a=e;s<a.length;s++){var c;null===(c=a[s]).value?u.push({type:"remove",path:c.path}):u.push({type:"set",path:c.path,value:c.value})}return this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:{commands:u}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{added:{},removed:[],updated:{},commands:u},{updaterId:n.peer_id})}))},n.prototype.get=function(n){var e,t=this,r=this._contextNameToData[n];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&!r.hasCallbacks())return new Promise((function(e,r){return __awaiter$1$1(t,void 0,void 0,(function(){var t=this;return __generator$1(this,(function(r){return this.subscribe(n,(function(n,r,i,o){t.unsubscribe(o),e(n)})),[2]}))}))}));var i=null!==(e=null==r?void 0:r.context)&&void 0!==e?e:{};return Promise.resolve(i)},n.prototype.subscribe=function(n,e){var t=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var r=this._contextNameToData[n];if(!r||!r.isAnnounced)return r=r||new GW3ContextData(void 0,n,!1,void 0),this._contextNameToData[n]=r,r.updateCallbacks[t]=e,Promise.resolve(t);var i,o=r.hasCallbacks();return r.updateCallbacks[t]=e,o||r.joinedActivity||r.context&&r.sentExplicitSubscription?(e(i=deepClone(r.context),i,[],t),Promise.resolve(t)):this.sendSubscribe(r).then((function(){return t}))},n.prototype.unsubscribe=function(n){for(var e=0,t=Object.keys(this._contextNameToData);e<t.length;e++){var r=t[e],i=(this._contextNameToId[r],this._contextNameToData[r]);if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[n],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},n.prototype.destroy=function(n){var e=this._contextNameToData[n];return e?this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT,domain:"global",context_id:e.contextId}).then((function(n){})):Promise.reject("context with "+n+" does not exist")},n.prototype.handleUpdated=function(n,e,t){var r=n.context;n.context=applyContextDelta(n.context,e,this._logger),this._contextNameToData[n.name]!==n||deepEqual(r,n.context)||this.invokeUpdateCallbacks(n,e,t)},n.prototype.subscribeToContextCreatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_ADDED,GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_ACTIVITY_CREATED];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextCreatedMessage=function(n){var e=n.type;e===GW_MESSAGE_ACTIVITY_CREATED?(this._contextNameToId[n.activity_id]=n.context_id,this._contextIdToName[n.context_id]=n.activity_id):e===GW_MESSAGE_CONTEXT_ADDED&&(this._contextNameToId[n.name]=n.context_id,this._contextIdToName[n.context_id]=n.name);var t=this._contextIdToName[n.context_id];if(!t)throw new Error("Received created event for context with unknown name: "+n.context_id);if(!this._contextNameToId[t])throw new Error("Received created event for context with unknown id: "+n.context_id);var r=this._contextNameToData[t];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=n.context_id,r.activityId=n.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[t]=r=new GW3ContextData(n.context_id,t,!0,n.activity_id)},n.prototype.subscribeToContextUpdatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_UPDATED,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_JOINED_ACTIVITY];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextUpdatedMessage=function(n){var e=n.type,t=n.context_id,r=this._contextNameToData[this._contextIdToName[t]],i=!r||!r.isAnnounced;if(e===GW_MESSAGE_JOINED_ACTIVITY)r?(r.contextId=t,r.isAnnounced=!0,r.activityId=n.activity_id):(r=new GW3ContextData(t,n.activity_id,!0,n.activity_id),this._contextNameToData[n.activity_id]=r,this._contextIdToName[t]=n.activity_id,this._contextNameToId[n.activity_id]=t),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(e===GW_MESSAGE_SUBSCRIBED_CONTEXT?((r=r||new GW3ContextData(t,n.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[n.name]=r,this._contextIdToName[t]=n.name,this._contextNameToId[n.name]=t):this._logger.error("Received 'update' for unknown context: "+t));var o=r.context;if(e===GW_MESSAGE_SUBSCRIBED_CONTEXT)r.context=n.data||{};else if(e===GW_MESSAGE_JOINED_ACTIVITY)r.context=n.context_snapshot||{};else{if(e!==GW_MESSAGE_CONTEXT_UPDATED)throw new Error("Unrecognized context update message "+e);r.context=applyContextDelta(r.context,n.delta,this._logger)}!i&&deepEqual(r.context,o)&&e!==GW_MESSAGE_SUBSCRIBED_CONTEXT||this.invokeUpdateCallbacks(r,n.delta,{updaterId:n.updater_id})},n.prototype.invokeUpdateCallbacks=function(n,e,t){if((e=e||{added:{},updated:{},reset:{},removed:[]}).commands){e.added=e.updated=e.reset={},e.removed=[];for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&e.removed.push(o.path),setValueToPath(e.updated,null,o.path)):"set"===o.type&&setValueToPath(e.updated,o.value,o.path)}}for(var l in n.updateCallbacks)if(n.updateCallbacks.hasOwnProperty(l))try{(0,n.updateCallbacks[l])(deepClone(n.context),Object.assign({},e.added||{},e.updated||{},e.reset||{}),e.removed,parseInt(l,10),t)}catch(n){this._logger.debug("callback error: "+JSON.stringify(n))}},n.prototype.subscribeToContextDestroyedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_ACTIVITY_DESTROYED];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextDestroyedMessage=function(n){var e,t;if(n.type===GW_MESSAGE_ACTIVITY_DESTROYED){if(t=n.activity_id,!(e=this._contextNameToId[t]))return void this._logger.error("Received 'destroyed' for unknown activity: "+n.activity_id)}else if(e=n.context_id,!(t=this._contextIdToName[e]))return void this._logger.error("Received 'destroyed' for unknown context: "+n.context_id);delete this._contextIdToName[e],delete this._contextNameToId[t];var r=this._contextNameToData[t];delete this._contextNameToData[t],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+e)},n.prototype.sendSubscribe=function(n){return n.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.sendUnsubscribe=function(n){return n.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.calculateContextDeltaV1=function(n,e){var t={added:{},updated:{},removed:[],reset:void 0};if(n)for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];-1===Object.keys(e).indexOf(o)||null===e[o]||deepEqual(n[o],e[o])||(t.updated[o]=e[o])}for(var l=0,u=Object.keys(e);l<u.length;l++){o=u[l];n&&-1!==Object.keys(n).indexOf(o)?null===e[o]&&t.removed.push(o):null!==e[o]&&(t.added[o]=e[o])}return t},n.prototype.calculateContextDeltaV2=function(n,e){for(var t,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(e);o<l.length;o++){var u=l[o];if(null!==e[u])deepEqual(n?n[u]:null,e[u])||null===(t=i.commands)||void 0===t||t.push({type:"set",path:u,value:e[u]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:u})}return i},n}(),ContextsModule=function(){function n(n){this._bridge=new GW3Bridge(n)}return n.prototype.all=function(){return this._bridge.all()},n.prototype.update=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.update(n,e)},n.prototype.set=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.set(n,e)},n.prototype.setPath=function(n,e,t){return this.checkName(n),this.checkPath(e),""===e?(this.checkData(t),this.set(n,t)):this._bridge.setPath(n,e,t)},n.prototype.setPaths=function(n,e){if(this.checkName(n),!Array.isArray(e))throw new Error("Please provide the paths as an array of PathValues!");for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(n,e)},n.prototype.subscribe=function(n,e){var t=this;if(this.checkName(n),"function"!=typeof e)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(n,(function(n,r,i,o,l){return e(n,r,i,(function(){return t._bridge.unsubscribe(o)}),l)})).then((function(n){return function(){t._bridge.unsubscribe(n)}}))},n.prototype.get=function(n){return this.checkName(n),this._bridge.get(n)},n.prototype.ready=function(){return Promise.resolve(this)},n.prototype.destroy=function(n){return this.checkName(n),this._bridge.destroy(n)},Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),n.prototype.checkName=function(n){if("string"!=typeof n||""===n)throw new Error("Please provide the name as a non-empty string!")},n.prototype.checkPath=function(n){if("string"!=typeof n)throw new Error("Please provide the path as a dot delimited string!")},n.prototype.checkData=function(n){if("object"!=typeof n)throw new Error("Please provide the data as an object!")},n}(),InvokeStatus;function promisify(n,e,t){return"function"!=typeof e&&"function"!=typeof t?n:("function"!=typeof e?e=function(){}:"function"!=typeof t&&(t=function(){}),n.then(e,t))}function rejectAfter(n,e,t){var r;return void 0===n&&(n=0),e.finally((function(){r&&clearTimeout(r)})),new Promise((function(e,i){r=setTimeout((function(){return i(t)}),n)}))}!function(n){n[n.Success=0]="Success",n[n.Error=1]="Error"}(InvokeStatus||(InvokeStatus={}));var Client=function(){function n(n,e,t,r){this.protocol=n,this.repo=e,this.instance=t,this.configuration=r}return n.prototype.subscribe=function(n,e,t,r,i){var o=this,l=function(n,t,r,l){var u;e.methodResponseTimeout=null!==(u=e.methodResponseTimeout)&&void 0!==u?u:e.waitTimeoutMs,o.protocol.client.subscribe(t,e,n,r,l,i)};return promisify(new Promise((function(t,r){var i,u=function(n){t(n)},s=function(n){r(n)};if(n)if((i="string"==typeof n?{name:n}:n).name){void 0===e&&(e={});var a=e.target;if(void 0===a&&(a="best"),"string"!=typeof a||"all"===a||"best"===a){void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=e.method_response_timeout,void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=e.wait_for_method_timeout,void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,d=o.getServerMethodsByFilterAndTarget(i,a);if(d.length>0)l(d,d[0].methods[0],u,s);else{var h=function(){if(a&&e.waitTimeoutMs)if(c+=500,(d=o.getServerMethodsByFilterAndTarget(i,a)).length>0){var t=d[0].methods[0];l(d,t,u,s)}else if(c>=e.waitTimeoutMs){l(d,"string"==typeof n?{name:n}:n,u,s)}else setTimeout(h,500)};setTimeout(h,500)}}else r(new Error('"'+a+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")})),t,r)},n.prototype.servers=function(n){var e=void 0===n?void 0:__assign$1({},n);return this.getServers(e).map((function(n){return n.server.instance}))},n.prototype.methods=function(n){return n="string"==typeof n?{name:n}:__assign$1({},n),this.getMethods(n)},n.prototype.methodsForInstance=function(n){return this.getMethodsForInstance(n)},n.prototype.methodAdded=function(n){return this.repo.onMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.repo.onMethodRemoved(n)},n.prototype.serverAdded=function(n){return this.repo.onServerAdded(n)},n.prototype.serverRemoved=function(n){return this.repo.onServerRemoved((function(e,t){n(e,t)}))},n.prototype.serverMethodAdded=function(n){return this.repo.onServerMethodAdded((function(e,t){n({server:e,method:t})}))},n.prototype.serverMethodRemoved=function(n){return this.repo.onServerMethodRemoved((function(e,t){n({server:e,method:t})}))},n.prototype.invoke=function(n,e,t,r,i,o){return __awaiter$1$1(this,void 0,void 0,(function(){var l=this;return __generator$1(this,(function(u){return[2,promisify(function(){return __awaiter$1$1(l,void 0,void 0,(function(){var i,o,l,u,s,a,c,d,h,f,p=this;return __generator$1(this,(function(g){switch(g.label){case 0:if(!(i="string"==typeof n?{name:n}:__assign$1({},n)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(e||(e={}),t||(t="best"),"string"==typeof t&&"all"!==t&&"best"!==t&&"skipMine"!==t)return[2,Promise.reject(new Error('"'+t+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!=typeof e)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,t)).length)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,t,r)];case 2:return o=g.sent(),[3,4];case 3:return g.sent(),l=__assign$1(__assign$1({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[]}),u={method:l,called_with:e,message:"Can not find a method matching "+JSON.stringify(n)+" with server filter "+JSON.stringify(t),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(u)];case 4:return s=r.methodResponseTimeoutMs,a=r,c=o.map((function(n){var t=shortid(),r=n.methods[0],i=n.server,o=p.protocol.client.invoke(t,r,e,i,a);return Promise.race([o,rejectAfter(s,o,{invocationId:t,message:"Invocation timeout ("+s+" ms) reached for method name: "+(null==r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(a),status:InvokeStatus.Error})])})),[4,Promise.all(c)];case 5:return d=g.sent(),h=this.getInvocationResultObj(d,i,e),d.every((function(n){return n.status===InvokeStatus.Error}))?[2,Promise.reject(h)]:[2,h]}}))}))}(),i,o)]}))}))},n.prototype.getInvocationResultObj=function(n,e,t){var r=n.filter((function(n){return n.status===InvokeStatus.Success})).reduce((function(n,r){return n=__spreadArrays(n,[{executed_by:r.instance,returned:r.result,called_with:t,method:e,message:r.message,status:r.status}])}),[]),i=n.filter((function(n){return n.status===InvokeStatus.Error})).reduce((function(n,r){return n=__spreadArrays(n,[{executed_by:r.instance,called_with:t,name:e.name,message:r.message}])}),[]),o=n[0];return{method:e,called_with:t,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},n.prototype.tryToAwaitForMethods=function(n,e,t){var r=this;return new Promise((function(i,o){if(0!==t.waitTimeoutMs)var l=0,u=setInterval((function(){l+=500;var s=r.getServerMethodsByFilterAndTarget(n,e);if(s.length>0)clearInterval(u),i(s);else if(l>=(t.waitTimeoutMs||1e4))return clearInterval(u),void o()}),500);else o()}))},n.prototype.filterByTarget=function(n,e){var t=this;if("string"!=typeof n){return(Array.isArray(n)?n:[n]).reduce((function(n,r){var i=e.filter((function(n){return t.instanceMatch(r,n.server.instance)}));return n.concat(i)}),[])}if("all"===n)return __spreadArrays(e);if("best"===n){var r=e.find((function(n){return n.server.instance.isLocal}));if(r)return[r];if(void 0!==e[0])return[e[0]]}else if("skipMine"===n)return e.filter((function(n){return n.server.instance.peerId!==t.instance.peerId}));return[]},n.prototype.instanceMatch=function(n,e){return this.containsProps(n,e)},n.prototype.methodMatch=function(n,e){return this.containsProps(n,e)},n.prototype.containsProps=function(n,e){return Object.keys(n).filter((function(e){return void 0!==n[e]&&"function"!=typeof n[e]&&"object_types"!==e&&"display_name"!==e&&"id"!==e&&"gatewayId"!==e&&"identifier"!==e&&"_"!==e[0]})).reduce((function(t,r){var i=n[r],o=e[r];if("objectTypes"===r){(i.length>o.length||!1===function(n,e){var t=n.reduce((function(n,e){return n[e]=!1,n}),{});e.forEach((function(n){void 0!==t[n]&&(t[n]=!0)}));return Object.keys(t).reduce((function(n,e){return t[e]||(n=!1),n}),!0)}(i,o))&&(t=!1)}else String(i).toLowerCase()!==String(o).toLowerCase()&&(t=!1);return t}),!0)},n.prototype.getMethods=function(n){var e=this;return void 0===n?this.repo.getMethods():this.repo.getMethods().filter((function(t){return e.methodMatch(n,t)}))},n.prototype.getMethodsForInstance=function(n){var e=this,t=this.repo.getServers().filter((function(t){return e.instanceMatch(n,t.instance)}));if(0===t.length)return[];var r={};return 1===t.length?r=t[0].methods:t.forEach((function(n){Object.keys(n.methods).forEach((function(e){var t=n.methods[e];r[t.identifier]=t}))})),Object.keys(r).map((function(n){return r[n]}))},n.prototype.getServers=function(n){var e=this,t=this.repo.getServers();return void 0===n?t.map((function(n){return{server:n,methods:[]}})):t.reduce((function(t,r){var i=e.repo.getServerMethodsById(r.id).filter((function(t){return e.methodMatch(n,t)}));return i.length>0&&t.push({server:r,methods:i}),t}),[])},n.prototype.getServerMethodsByFilterAndTarget=function(n,e){var t=this.getServers(n);return this.filterByTarget(e,t)},n}(),ServerSubscription=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.subscription=t}return Object.defineProperty(n.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),n.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},n.prototype.push=function(n){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,n)},n}(),Request=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.requestContext=t,this.arguments=t.arguments,this.instance=t.instance}return n.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},n.prototype.acceptOnBranch=function(n){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,n)},n.prototype.reject=function(n){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,n)},n}(),ServerStreaming=function(){function n(n,e){var t=this;this.protocol=n,this.server=e,n.server.onSubRequest((function(n,e){return t.handleSubRequest(n,e)})),n.server.onSubAdded((function(n,e){return t.handleSubAdded(n,e)})),n.server.onSubRemoved((function(n,e){return t.handleSubRemoved(n,e)}))}return n.prototype.handleSubRequest=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRequestHandler){var t=new Request(this.protocol,e,n);e.streamCallbacks.subscriptionRequestHandler(t)}},n.prototype.handleSubAdded=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionAddedHandler){var t=new ServerSubscription(this.protocol,e,n);e.streamCallbacks.subscriptionAddedHandler(t)}},n.prototype.handleSubRemoved=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRemovedHandler){var t=new ServerSubscription(this.protocol,e,n);e.streamCallbacks.subscriptionRemovedHandler(t)}},n}(),ServerBranch=function(){function n(n,e,t){this.key=n,this.protocol=e,this.repoMethod=t}return n.prototype.subscriptions=function(){var n=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(e){return new ServerSubscription(n.protocol,n.repoMethod,e)}))},n.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},n.prototype.push=function(n){this.protocol.server.pushData(this.repoMethod,n,[this.key])},n}(),ServerStream=function(){function n(n,e,t){this._protocol=n,this._repoMethod=e,this._server=t,this.name=this._repoMethod.definition.name}return n.prototype.branches=function(n){var e=this,t=this._protocol.server.getBranchList(this._repoMethod);return n?t.indexOf(n)>-1?new ServerBranch(n,this._protocol,this._repoMethod):void 0:t.map((function(n){return new ServerBranch(n,e._protocol,e._repoMethod)}))},n.prototype.branch=function(n){return this.branches(n)},n.prototype.subscriptions=function(){var n=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(e){return new ServerSubscription(n._protocol,n._repoMethod,e)}))},Object.defineProperty(n.prototype,"definition",{get:function(){var n=this._repoMethod.definition;return{accepts:n.accepts,description:n.description,displayName:n.displayName,name:n.name,objectTypes:n.objectTypes,returns:n.returns,supportsStreaming:n.supportsStreaming}},enumerable:!0,configurable:!0}),n.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},n.prototype.push=function(n,e){if("string"!=typeof e&&!Array.isArray(e)&&void 0!==e)throw new Error("invalid branches should be string or string array");if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,n,e)},n.prototype.updateRepoMethod=function(n){this._repoMethod=n},n}(),Server=function(){function n(n,e){this.protocol=n,this.serverRepository=e,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming(n,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return n.prototype.createStream=function(n,e,t,r,i){var o=this;return promisify(new Promise((function(t,r){if(n){var l;if(!(l="string"==typeof n?{name:""+n}:__assign$1({},n)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: "+JSON.stringify(l));if(o.serverRepository.getList().some((function(n){return n.definition.name===l.name})))return r('A stream with the name "'+l.name+'" already exists! Please, provide a unique name for the stream.');l.supportsStreaming=!0,e||(e={}),"function"!=typeof e.subscriptionRequestHandler&&(e.subscriptionRequestHandler=function(n){n.accept()});var u=o.serverRepository.add({definition:l,streamCallbacks:e,protocolState:{}});o.protocol.server.createStream(u).then((function(){var n;i?(n=i,i.updateRepoMethod(u)):n=new ServerStream(o.protocol,u,o),u.stream=n,t(n)})).catch((function(n){u.repoId&&o.serverRepository.remove(u.repoId),r(n)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")})),t,r)},n.prototype.register=function(n,e){var t=this;if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var r=function(n,r){return __awaiter$1$1(t,void 0,void 0,(function(){var t,i,o;return __generator$1(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(t=e(n.args,n.instance))&&"function"==typeof t.then?[4,t]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,t),l.label=3;case 3:return[3,5];case 4:return(o=l.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=e,this.registerCore(n,r)},n.prototype.registerAsync=function(n,e){if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var t=function(n,t){try{var r=!1,i=function(n){r||t(void 0,n),r=!0},o=function(n){r||(n||(n=""),t(n,n)),r=!0},l=e(n.args,n.instance,i,o);l&&"function"==typeof l.then&&l.then(i).catch(o)}catch(n){t(n,void 0)}};return t.userCallbackAsync=e,this.registerCore(n,t)},n.prototype.unregister=function(n,e){return void 0===e&&(e=!1),__awaiter$1$1(this,void 0,void 0,(function(){var t,r;return __generator$1(this,(function(i){switch(i.label){case 0:return void 0===n?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof n?[3,2]:[4,this.unregisterWithPredicate(n,e)];case 1:return i.sent(),[2];case 2:return void 0===(t="string"==typeof n?{name:n}:n).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(n){return n.definition.name===t.name&&(n.definition.supportsStreaming||!1)===e})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+t.name+'" does not exist or is not registered by your application!')];case 3:return i.sent(),[2]}}))}))},n.prototype.unregisterWithPredicate=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t;return __generator$1(this,(function(r){switch(r.label){case 0:return(t=this.serverRepository.getList().filter((function(e){return n(e.definition)})).filter((function(n){return(n.definition.supportsStreaming||!1)===e})))&&0!==t.length?[4,this.removeMethodsOrStreams(t)]:[2,Promise.reject("Could not find a "+(e?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},n.prototype.removeMethodsOrStreams=function(n){var e=this,t=[];return n.forEach((function(n){var r=e.protocol.server.unregister(n).then((function(){n.repoId&&e.serverRepository.remove(n.repoId)}));t.push(r),e.addAsCurrentlyUnregistering(n.definition.name,r)})),Promise.all(t)},n.prototype.addAsCurrentlyUnregistering=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t,r=this;return __generator$1(this,(function(i){return t=new Promise((function(n){return setTimeout(n,5e3)})),this.currentlyUnregistering[n]=Promise.race([e,t]).then((function(){delete r.currentlyUnregistering[n]})),[2]}))}))},n.prototype.registerCore=function(n,e){return __awaiter$1$1(this,void 0,void 0,(function(){var t,r,i,o=this;return __generator$1(this,(function(l){switch(l.label){case 0:return(t="string"==typeof n?{name:""+n}:__assign$1({},n)).name?(r=this.currentlyUnregistering[t.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: "+JSON.stringify(n))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(n){return n.definition.name===t.name}))?[2,Promise.reject('A method with the name "'+t.name+'" already exists! Please, provide a unique name for the method.')]:t.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want "+t.name+" to be a stream, please use the glue.interop.createStream() method.")]:(i=this.serverRepository.add({definition:t,theFunction:e,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(n){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),n}))])}}))}))},n.prototype.onMethodInvoked=function(n,e,t){var r=this;n&&n.theFunction&&n.theFunction(t,(function(t,i){if(null!=t)if(t.message&&"string"==typeof t.message)t=t.message;else if("string"!=typeof t)try{t=JSON.stringify(t)}catch(n){t="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(t)}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(n,e,t,i)}))},n}(),InstanceWrapper=function(){function n(n,e){var t=this;this.wrapped={getMethods:getMethods,getStreams:getStreams},n&&this.refreshWrappedObject(n),e&&(e.loggedIn((function(){t.refresh(e)})),this.refresh(e))}return n.prototype.unwrap=function(){return this.wrapped},n.prototype.refresh=function(n){if(n){var e=null==n?void 0:n.resolvedIdentity,t=Object.assign({},null!=e?e:{},{peerId:null==n?void 0:n.peerId});this.refreshWrappedObject(t)}},n.prototype.refreshWrappedObject=function(n){var e,t,r;this.wrapped.user=n.user,this.wrapped.instance=n.instance,this.wrapped.application=null!==(e=n.application)&&void 0!==e?e:shortid(),this.wrapped.applicationName=n.applicationName,this.wrapped.pid=null!==(r=null!==(t=n.pid)&&void 0!==t?t:n.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=n.machine,this.wrapped.environment=n.environment,this.wrapped.region=n.region,this.wrapped.windowId=n.windowId,this.wrapped.isLocal=!0,this.wrapped.api=n.api,this.wrapped.service=n.service,this.wrapped.peerId=n.peerId},n}();function getMethods(){var n;return null===(n=InstanceWrapper.API)||void 0===n?void 0:n.methodsForInstance(this)}function getStreams(){var n;return null===(n=InstanceWrapper.API)||void 0===n?void 0:n.methodsForInstance(this).filter((function(n){return n.supportsStreaming}))}var ClientRepository=function(){function n(n){this.logger=n,this.servers={},this.methodsCount={},this.callbacks=lib()}return n.prototype.addServer=function(n,e){this.logger.debug("adding server "+e);var t=this.servers[e];if(t)return t.id;var r=new InstanceWrapper(n),i={id:e,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[e]=i,this.callbacks.execute("onServerAdded",i.instance),e},n.prototype.removeServerById=function(n,e){var t=this,r=this.servers[n];r?(this.logger.debug("removing server "+n),Object.keys(r.methods).forEach((function(e){t.removeServerMethod(n,e)})),delete this.servers[n],this.callbacks.execute("onServerRemoved",r.instance,e)):this.logger.warn("not aware of server "+n+", my state "+JSON.stringify(Object.keys(this.servers)))},n.prototype.addServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");if(!t.methods[e.id]){var r=this.createMethodIdentifier(e),i=this,o={identifier:r,gatewayId:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types||[],accepts:e.input_signature,returns:e.result_signature,supportsStreaming:void 0!==e.flags&&e.flags.streaming,getServers:function(){return i.getServersByMethod(r)}};return o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,t.methods[e.id]=o,this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",o)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",t.instance,o),o}},n.prototype.removeServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");var r=t.methods[e];delete t.methods[e],this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",t.instance,r)},n.prototype.getMethods=function(){var n=this,e={};return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];Object.keys(r.methods).forEach((function(n){var t=r.methods[n];e[t.identifier]=t}))})),Object.keys(e).map((function(n){return e[n]}))},n.prototype.getServers=function(){var n=this,e=[];return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];e.push(r)})),e},n.prototype.getServerMethodsById=function(n){var e=this.servers[n];return Object.keys(e.methods).map((function(n){return e.methods[n]}))},n.prototype.onServerAdded=function(n){var e=this.callbacks.add("onServerAdded",n),t=this.getServers().map((function(n){return n.instance}));return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onMethodAdded=function(n){var e=this.callbacks.add("onMethodAdded",n),t=this.getMethods();return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onServerMethodAdded=function(n){var e=this.callbacks.add("onServerMethodAdded",n),t=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(e){var r=e.methods;Object.keys(r).forEach((function(i){t||n(e.instance,r[i])}))}))}),0),function(){t=!0,e()}},n.prototype.onMethodRemoved=function(n){return this.callbacks.add("onMethodRemoved",n)},n.prototype.onServerRemoved=function(n){return this.callbacks.add("onServerRemoved",n)},n.prototype.onServerMethodRemoved=function(n){return this.callbacks.add("onServerMethodRemoved",n)},n.prototype.getServerById=function(n){return this.servers[n]},n.prototype.reset=function(){var n=this;Object.keys(this.servers).forEach((function(e){n.removeServerById(e,"reset")})),this.servers={},this.methodsCount={}},n.prototype.createMethodIdentifier=function(n){var e=void 0!==n.input_signature?n.input_signature:"",t=void 0!==n.result_signature?n.result_signature:"";return(n.name+e+t).toLowerCase()},n.prototype.getServersByMethod=function(n){var e=this,t=[];return Object.keys(this.servers).forEach((function(r){var i=e.servers[r];Object.keys(i.methods).forEach((function(e){i.methods[e].identifier===n&&t.push(i.instance)}))})),t},n.prototype.returnUnsubWithDelayedReplay=function(n,e,t){var r=!1;return setTimeout((function(){e.forEach((function(n){r||t(n)}))}),0),function(){r=!0,n()}},n}(),ServerRepository=function(){function n(){this.nextId=0,this.methods=[]}return n.prototype.add=function(n){return n.repoId=String(this.nextId),this.nextId+=1,this.methods.push(n),n},n.prototype.remove=function(n){if("string"!=typeof n)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(e){return e.repoId!==n}))},n.prototype.getById=function(n){if("string"==typeof n)return this.methods.find((function(e){return e.repoId===n}))},n.prototype.getList=function(){return this.methods.map((function(n){return n}))},n.prototype.length=function(){return this.methods.length},n.prototype.reset=function(){this.methods=[]},n}(),SUBSCRIPTION_REQUEST="onSubscriptionRequest",SUBSCRIPTION_ADDED="onSubscriptionAdded",SUBSCRIPTION_REMOVED="onSubscriptionRemoved",ServerStreaming$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.serverRepository=t,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib(),this.nextStreamId=0,n.on("add-interest",(function(n){r.handleAddInterest(n)})),n.on("remove-interest",(function(n){r.handleRemoveInterest(n)}))}return n.prototype.acceptRequestOnBranch=function(n,e,t){if("string"!=typeof t&&(t=""),"object"!=typeof e.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(e.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(e,t),i=n.msg.subscription_id,o={id:i,arguments:n.arguments,instance:n.instance,branchKey:t,streamId:r,subscribeMsg:n.msg};e.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED,o,e)},n.prototype.rejectRequest=function(n,e,t){"string"!=typeof t&&(t=""),this.sendSubscriptionFailed("Subscription rejected by user. "+t,n.msg.subscription_id)},n.prototype.pushData=function(n,e,t){var r=this;if("object"==typeof n&&Array.isArray(n.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof t?t=[t]:(!Array.isArray(t)||t.length<=0)&&(t=[]),n.protocolState.branchKeyToStreamIdMap.filter((function(n){return!t||0===t.length||t.indexOf(n.key)>=0})).map((function(n){return n.streamId})).forEach((function(n){var t={type:"publish",stream_id:n,data:e};r.session.sendFireAndForget(t)}))}},n.prototype.pushDataToSingle=function(n,e,t){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:e.id,data:t};this.session.sendFireAndForget(r)},n.prototype.closeSingleSubscription=function(n,e){n.protocolState.subscriptionsMap&&delete n.protocolState.subscriptionsMap[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(t);e.instance;this.callbacks.execute(SUBSCRIPTION_REMOVED,e,n)},n.prototype.closeMultipleSubscriptions=function(n,e){var t=this;if("object"==typeof n&&"object"==typeof n.protocolState.subscriptionsMap&&n.protocolState.subscriptionsMap){var r=n.protocolState.subscriptionsMap,i=Object.keys(r).map((function(n){return r[n]}));"string"==typeof e&&(i=i.filter((function(n){return n.branchKey===e}))),i.forEach((function(n){delete r[n.id];var e={type:"drop-subscription",subscription_id:n.id,reason:"Server dropping all subscriptions on stream_id: "+n.streamId};t.session.sendFireAndForget(e)}))}},n.prototype.getSubscriptionList=function(n,e){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var t=n.protocolState.subscriptionsMap,r=Object.keys(t).map((function(n){return t[n]}));return"string"!=typeof e?r:r.filter((function(n){return n.branchKey===e}))},n.prototype.getBranchList=function(n){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var e=n.protocolState.subscriptionsMap,t=Object.keys(e).map((function(n){return e[n]})),r=[];return t.forEach((function(n){var e="";"object"==typeof n&&"string"==typeof n.branchKey&&(e=n.branchKey),-1===r.indexOf(e)&&r.push(e)})),r},n.prototype.onSubAdded=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED,n)},n.prototype.onSubRequest=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST,n)},n.prototype.onSubRemoved=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED,n)},n.prototype.handleRemoveInterest=function(n){var e=this.serverRepository.getById(n.method_id);if("string"==typeof n.subscription_id&&"object"==typeof e&&e.protocolState.subscriptionsMap&&"object"==typeof e.protocolState.subscriptionsMap[n.subscription_id]){var t=e.protocolState.subscriptionsMap[n.subscription_id];delete e.protocolState.subscriptionsMap[n.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED,t,e)}},n.prototype.onSubscriptionLifetimeEvent=function(n,e){this.callbacks.add(n,e)},n.prototype.getNextStreamId=function(){return this.nextStreamId+++""},n.prototype.handleAddInterest=function(n){var e=this.repository.getServerById(n.caller_id).instance,t={msg:n,arguments:n.arguments_kv||{},instance:e},r=this.serverRepository.getById(n.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[n.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+n.subscription_id+" already exists.",n.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST,t,r);else{var i="No method with id "+n.method_id+" on this server.";this.sendSubscriptionFailed(i,n.subscription_id)}},n.prototype.sendSubscriptionFailed=function(n,e){var t={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:n,request_id:e};this.session.sendFireAndForget(t)},n.prototype.getStreamId=function(n,e){if("string"!=typeof e&&(e=""),!n.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+n.definition.name+" method without protocol state");var t=n.protocolState.branchKeyToStreamIdMap.filter((function(n){return n.key===e}))[0],r=t?t.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),n.protocolState.branchKeyToStreamIdMap.push({key:e,streamId:r})),r},n}(),ServerProtocol=function(){function n(n,e,t,r){var i=this;this.session=n,this.clientRepository=e,this.serverRepository=t,this.logger=r,this.callbacks=lib(),this.streaming=new ServerStreaming$1(n,e,t),this.session.on("invoke",(function(n){return i.handleInvokeMessage(n)}))}return n.prototype.createStream=function(n){return n.protocolState.subscriptionsMap={},n.protocolState.branchKeyToStreamIdMap=[],this.register(n,!0)},n.prototype.register=function(n,e){var t=this,r=n.definition,i={streaming:e||!1},o={type:"register",methods:[{id:n.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:i,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(o,{methodId:n.repoId}).then((function(){t.logger.debug("registered method "+n.definition.name+" with id "+n.repoId)})).catch((function(e){throw t.logger.warn("failed to register method "+n.definition.name+" with id "+n.repoId+" - "+JSON.stringify(e)),e}))},n.prototype.onInvoked=function(n){this.callbacks.add("onInvoked",n)},n.prototype.methodInvocationResult=function(n,e,t,r){var i;i=t||""===t?{type:"error",request_id:e,reason_uri:"agm.errors.client_error",reason:t,context:r,peer_id:void 0}:{type:"yield",invocation_id:e,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},n.prototype.unregister=function(n){return __awaiter$1$1(this,void 0,void 0,(function(){var e;return __generator$1(this,(function(t){switch(t.label){case 0:return e={type:"unregister",methods:[n.repoId]},[4,this.session.send(e)];case 1:return t.sent(),[2]}}))}))},n.prototype.getBranchList=function(n){return this.streaming.getBranchList(n)},n.prototype.getSubscriptionList=function(n,e){return this.streaming.getSubscriptionList(n,e)},n.prototype.closeAllSubscriptions=function(n,e){this.streaming.closeMultipleSubscriptions(n,e)},n.prototype.pushData=function(n,e,t){this.streaming.pushData(n,e,t)},n.prototype.pushDataToSingle=function(n,e,t){this.streaming.pushDataToSingle(n,e,t)},n.prototype.closeSingleSubscription=function(n,e){this.streaming.closeSingleSubscription(n,e)},n.prototype.acceptRequestOnBranch=function(n,e,t){this.streaming.acceptRequestOnBranch(n,e,t)},n.prototype.rejectRequest=function(n,e,t){this.streaming.rejectRequest(n,e,t)},n.prototype.onSubRequest=function(n){this.streaming.onSubRequest(n)},n.prototype.onSubAdded=function(n){this.streaming.onSubAdded(n)},n.prototype.onSubRemoved=function(n){this.streaming.onSubRemoved(n)},n.prototype.handleInvokeMessage=function(n){var e=n.invocation_id,t=n.caller_id,r=n.method_id,i=n.arguments_kv,o=this.serverRepository.getList().filter((function(n){return n.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(t).instance};this.callbacks.execute("onInvoked",o,e,l)}},n}(),UserSubscription=function(){function n(n,e){this.repository=n,this.subscriptionData=e}return Object.defineProperty(n.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"servers",{get:function(){var n=this;return this.subscriptionData.trackedServers.filter((function(n){return n.subscriptionId})).map((function(e){return n.repository.getServerById(e.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),n.prototype.onData=function(n){if("function"!=typeof n)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(n),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(e){n(e)}))},n.prototype.onClosed=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(n)},n.prototype.onFailed=function(n){},n.prototype.onConnected=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(n)},n.prototype.close=function(){this.subscriptionData.close()},n.prototype.setNewSubscription=function(n){this.subscriptionData=n},n}(),STATUS_AWAITING_ACCEPT="awaitingAccept",STATUS_SUBSCRIBED="subscribed",ERR_MSG_SUB_FAILED="Subscription failed.",ERR_MSG_SUB_REJECTED="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT="ClientInitiated",ClientStreaming=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(n){var e=n._tag,t=e.subLocalKey,i=r.subscriptionsList[t];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(n){return n.serverId!==e.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT){var o="string"==typeof n.reason&&""!==n.reason?' Publisher said "'+n.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED&&r.callOnClosedHandlers(i);delete r.subscriptionsList[t]}},this.handleSubscribed=function(n){var e=n._tag.subLocalKey,t=r.subscriptionsList[e];if("object"==typeof t){var i=n._tag.serverId,o=t.trackedServers.filter((function(n){return n.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=n.subscription_id,r.subscriptionIdToLocalKeyMap[n.subscription_id]=e;var l=t.status===STATUS_AWAITING_ACCEPT;if(t.status=STATUS_SUBSCRIBED,l){var u=!1,s=t.subscription;s?(s.setNewSubscription(t),t.success(s),u=!0):(s=new UserSubscription(r.repository,t),t.subscription=s,t.success(s));for(var a=0,c=t.handlers.onConnected;a<c.length;a++){var d=c[a];try{d(s.serverInstance,u)}catch(n){}}}}}},this.handleEventData=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.filter((function(e){return e.subscriptionId===n.subscription_id}));if(1===i.length){var o=n.oob,l=i[0].serverId,u=function(){return{data:n.data,server:r.repository.getServerById(l).instance,requestArguments:t.params.arguments,message:void 0,private:o}},s=t.handlers.onData,a=t.queued.data;s.length>0?s.forEach((function(n){"function"==typeof n&&n(u())})):a.push(u())}}}},this.handleSubscriptionCancelled=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.length-1;t.trackedServers=t.trackedServers.filter((function(e){return e.subscriptionId!==n.subscription_id||(t.queued.closers.push(e.serverId),!1)})),t.trackedServers.length===i&&(t.trackedServers.length<=0&&(clearTimeout(t.timeoutId),r.callOnClosedHandlers(t),delete r.subscriptionsList[e]),delete r.subscriptionIdToLocalKeyMap[n.subscription_id])}}},n.on("subscribed",this.handleSubscribed),n.on("event",this.handleEventData),n.on("subscription-cancelled",this.handleSubscriptionCancelled)}return n.prototype.subscribe=function(n,e,t,r,i,o){var l=this;if(0!==t.length){var u=this.getNextSubscriptionLocalKey(),s=this.registerSubscription(u,n,e,r,i,e.methodResponseTimeout||1e4,o);"object"==typeof s?t.forEach((function(t){var r=t.server.id,i=t.methods.find((function(e){return e.name===n.name}));if(i){s.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:e.arguments};l.session.send(o,{serverId:r,subLocalKey:u}).then((function(n){return l.handleSubscribed(n)})).catch((function(n){return l.handleErrorSubscribing(n)}))}else l.logger.error("can not find method "+n.name+" for target "+t.server.id)})):i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED+" Unable to register the user callbacks."})}else i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED+" No available servers matched the target params."})},n.prototype.drainSubscriptions=function(){var n=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},n},n.prototype.getNextSubscriptionLocalKey=function(){var n=this.nextSubLocalKey;return this.nextSubLocalKey+=1,n},n.prototype.registerSubscription=function(n,e,t,r,i,o,l){var u=this,s={localKey:n,status:STATUS_AWAITING_ACCEPT,method:e,params:t,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return u.closeSubscription(n)},subscription:null==l?void 0:l.subscription};return l||(t.onData&&s.handlers.onData.push(t.onData),t.onClosed&&s.handlers.onClosed.push(t.onClosed),t.onConnected&&s.handlers.onConnected.push(t.onConnected)),this.subscriptionsList[n]=s,s.timeoutId=setTimeout((function(){if(void 0!==u.subscriptionsList[n]){var r=u.subscriptionsList[n];r.status===STATUS_AWAITING_ACCEPT?(i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED+" Subscription attempt timed out after "+o+" ms."}),delete u.subscriptionsList[n]):r.status===STATUS_SUBSCRIBED&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(n){return void 0!==n.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(u.callOnClosedHandlers(r),delete u.subscriptionsList[n]))}}),o),s},n.prototype.callOnClosedHandlers=function(n,e){var t,r=n.queued.closers.length,i=r>0?n.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(t=this.repository.getServerById(i).instance),n.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:e||ON_CLOSE_MSG_SERVER_INIT,requestArguments:n.params.arguments||{},server:t,stream:n.method})}))},n.prototype.closeSubscription=function(n){var e=this,t=this.subscriptionsList[n];"object"==typeof t&&(t.trackedServers.forEach((function(n){void 0!==n.subscriptionId&&(t.queued.closers.push(n.serverId),e.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT}),delete e.subscriptionIdToLocalKeyMap[n.subscriptionId])})),t.trackedServers=[],this.callOnClosedHandlers(t,ON_CLOSE_MSG_CLIENT_INIT),delete this.subscriptionsList[n])},n}(),ClientProtocol=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,n.on("peer-added",(function(n){return r.handlePeerAdded(n)})),n.on("peer-removed",(function(n){return r.handlePeerRemoved(n)})),n.on("methods-added",(function(n){return r.handleMethodsAddedMessage(n)})),n.on("methods-removed",(function(n){return r.handleMethodsRemovedMessage(n)})),this.streaming=new ClientStreaming(n,e,t)}return n.prototype.subscribe=function(n,e,t,r,i,o){this.streaming.subscribe(n,e,t,r,i,o)},n.prototype.invoke=function(n,e,t,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:e.gatewayId,arguments_kv:t};return this.session.send(l,{invocationId:n,serverId:o}).then((function(n){return i.handleResultMessage(n)})).catch((function(n){return i.handleInvocationError(n)}))},n.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},n.prototype.handlePeerAdded=function(n){var e=n.new_peer_id,t=n.identity,r=!n.meta||n.meta.local,i=Number(t.process),o={machine:t.machine,pid:isNaN(i)?t.process:i,instance:t.instance,application:t.application,applicationName:t.applicationName,environment:t.environment,region:t.region,user:t.user,windowId:t.windowId,peerId:e,api:t.api,isLocal:r};this.repository.addServer(o,e)},n.prototype.handlePeerRemoved=function(n){var e=n.removed_id,t=n.reason;this.repository.removeServerById(e,t)},n.prototype.handleMethodsAddedMessage=function(n){var e=this,t=n.server_id;n.methods.forEach((function(n){e.repository.addServerMethod(t,n)}))},n.prototype.handleMethodsRemovedMessage=function(n){var e=this,t=n.server_id,r=n.methods,i=this.repository.getServerById(t);Object.keys(i.methods).forEach((function(n){var o=i.methods[n];r.indexOf(o.gatewayId)>-1&&e.repository.removeServerMethod(t,n)}))},n.prototype.handleResultMessage=function(n){var e=n._tag.invocationId,t=n.result,r=n._tag.serverId;return{invocationId:e,result:t,instance:this.repository.getServerById(r).instance,status:InvokeStatus.Success,message:""}},n.prototype.handleInvocationError=function(n){if(this.logger.debug("handle invocation error "+JSON.stringify(n)),"_tag"in n){var e=n._tag.invocationId,t=n._tag.serverId,r=this.repository.getServerById(t),i=n.reason;return{invocationId:e,result:n.context,instance:r.instance,status:InvokeStatus.Error,message:i}}return{invocationId:"",message:n.message,status:InvokeStatus.Error,error:n}},n}();function gW3ProtocolFactory(n,e,t,r,i,o){var l,u=i.logger.subLogger("gw3-protocol"),s=new Promise((function(n){l=n})),a=e.domain("agm",["subscribed"]),c=new ServerProtocol(a,t,r,u.subLogger("server")),d=new ClientProtocol(a,t,u.subLogger("client"));return a.onJoined((function(i){t.addServer(n,e.peerId),i?function(){u.info("reconnected - will replay registered methods and subscriptions");for(var n=0,e=d.drainSubscriptions();n<e.length;n++){var t=e[n],i=t.method,l=Object.assign({},t.params);u.info("trying to re-subscribe to method "+i.name),o.client.subscribe(i,l,void 0,void 0,t)}var s=r.getList();r.reset();for(var a=0,c=s;a<c.length;a++){var h=c[a],f=h.definition;u.info("re-publishing method "+f.name),h.stream?o.server.createStream(f,h.streamCallbacks,void 0,void 0,h.stream):h.theFunction&&h.theFunction.userCallback?o.register(f,h.theFunction.userCallback):h.theFunction&&h.theFunction.userCallbackAsync&&o.registerAsync(f,h.theFunction.userCallbackAsync)}}():l&&(l({client:d,server:c}),l=void 0)})),a.onLeft((function(){t.reset()})),a.join(),s}var Interop=function(){function n(n){var e=this;if(void 0===n)throw new Error("configuration is required");if(void 0===n.connection)throw new Error("configuration.connections is required");var t,r=n.connection;if("number"!=typeof n.methodResponseTimeout&&(n.methodResponseTimeout=3e4),"number"!=typeof n.waitTimeoutMs&&(n.waitTimeoutMs=3e4),InstanceWrapper.API=this,this.instance=new InstanceWrapper(void 0,r).unwrap(),this.clientRepository=new ClientRepository(n.logger.subLogger("cRep")),this.serverRepository=new ServerRepository,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");t=gW3ProtocolFactory(this.instance,r,this.clientRepository,this.serverRepository,n,this),this.readyPromise=t.then((function(t){return e.protocol=t,e.client=new Client(e.protocol,e.clientRepository,e.instance,n),e.server=new Server(e.protocol,e.serverRepository),e}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.serverRemoved=function(n){return this.client.serverRemoved(n)},n.prototype.serverAdded=function(n){return this.client.serverAdded(n)},n.prototype.serverMethodRemoved=function(n){return this.client.serverMethodRemoved(n)},n.prototype.serverMethodAdded=function(n){return this.client.serverMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.client.methodRemoved(n)},n.prototype.methodAdded=function(n){return this.client.methodAdded(n)},n.prototype.methodsForInstance=function(n){return this.client.methodsForInstance(n)},n.prototype.methods=function(n){return this.client.methods(n)},n.prototype.servers=function(n){return this.client.servers(n)},n.prototype.subscribe=function(n,e,t,r){return this.client.subscribe(n,e,t,r)},n.prototype.createStream=function(n,e,t,r){return this.server.createStream(n,e,t,r)},n.prototype.unregister=function(n){return this.server.unregister(n)},n.prototype.registerAsync=function(n,e){return this.server.registerAsync(n,e)},n.prototype.register=function(n,e){return this.server.register(n,e)},n.prototype.invoke=function(n,e,t,r,i,o){return this.client.invoke(n,e,t,r,i,o)},n}(),successMessages=["subscribed","success"],MessageBus=function(){function n(n,e){var t=this;this.publish=function(n,e,r){var i=r||{},o=i.routingKey,l=i.target,u=t.removeEmptyValues({type:"publish",topic:n,data:e,peer_id:t.peerId,routing_key:o,target_identity:l});t.session.send(u)},this.subscribe=function(n,e,r){return new Promise((function(i,o){var l=r||{},u=l.routingKey,s=l.target,a=t.removeEmptyValues({type:"subscribe",topic:n,peer_id:t.peerId,routing_key:u,source:s});t.session.send(a).then((function(r){var o=r.subscription_id;t.subscriptions.push({subscription_id:o,topic:n,callback:e,source:s}),i({unsubscribe:function(){return t.session.send({type:"unsubscribe",subscription_id:o,peer_id:t.peerId}),t.subscriptions=t.subscriptions.filter((function(n){return n.subscription_id!==o})),Promise.resolve()}})})).catch((function(n){return o(n)}))}))},this.watchOnEvent=function(){t.session.on("event",(function(n){var e=n.data,r=n.subscription_id,i=n["publisher-identity"],o=t.subscriptions.find((function(n){return n.subscription_id===r}));o&&(o.source?t.keysMatch(o.source,i)&&o.callback(e,o.topic,i):o.callback(e,o.topic,i))}))},this.connection=n,this.logger=e,this.peerId=n.peerId,this.subscriptions=[],this.session=n.domain("bus",successMessages),this.readyPromise=this.session.join(),this.readyPromise.then((function(){t.watchOnEvent()}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.removeEmptyValues=function(n){var e={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&null!==n[t]&&(e[t]=n[t])})),e},n.prototype.keysMatch=function(n,e){var t=Object.keys(n),r=!0;return t.forEach((function(t){n[t]!==e[t]&&(r=!1)})),r},n}(),GlueCore=function(n,e){var t,r=Utils.getGDMajorVersion(),i=Promise.resolve();if(r){if(r<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");r>=3&&(t=window.glue42gd,i=window.gdPreloadPromise||i)}var o,l,u,s,a,c,d,h=timer("glue"),f=prepareConfig(n=n||{},e=e||{},t),p={};function g(n,e,t){(d=u.canPublish("trace"))&&u.trace("registering "+n+" module");var r=function(){e.initTime=t.stop(),e.initEndTime=t.endTime,e.marks=t.marks,d&&u.trace(n+" is ready - "+(t.endTime-t.startTime))};e.initStartTime=t.startTime,e.ready?e.ready().then((function(){r()})):r(),Array.isArray(n)||(n=[n]),n.forEach((function(n){p[n]=e,GlueCore[n]=e}))}function w(){var n=timer("interop"),e={connection:o,logger:u.subLogger("interop")};return l=new Interop(e),Logger.Interop=l,g(["interop","agm"],l,n),Promise.resolve()}function v(){var n=f.activities&&3===o.protocolVersion;if(f.contexts||n){var e=timer("contexts");return g("contexts",a=new ContextsModule({connection:o,logger:u.subLogger("contexts")}),e),a}var t=o.replayer;t&&t.drain(ContextMessageReplaySpec.name)}function m(){return __awaiter$1$1(this,void 0,void 0,(function(){var n;return __generator$1(this,(function(e){return f.bus?(n=timer("bus"),g("bus",c=new MessageBus(o,u.subLogger("bus")),n),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function y(n){try{return n.forEach((function(n){!function(n,e){var t=timer(n),r=e(p);r&&g(n,r,t)}(n.name,n.create)})),Promise.resolve()}catch(n){return Promise.reject(n)}}return i.then((function(){var n,e=timer("logger");return(u=new Logger(""+(null===(n=f.connection.identity)||void 0===n?void 0:n.application),void 0,f.customLogger)).consoleLevel(f.logger.console),u.publishLevel(f.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,e),Promise.resolve(void 0)})).then((function(){var n=timer("connection");o=new Connection(f.connection,u.subLogger("connection"));var e=Promise.resolve(f.auth);return f.connection&&!f.auth&&(e=t?t.getGWToken().then((function(n){return{gatewayToken:n}})):Promise.reject("You need to provide auth information")),e.then((function(e){var t;if(n.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));return t=e,o.login(t)})).then((function(){return g("connection",o,n),f})).catch((function(n){throw o&&o.logout(),n}))})).then((function(){return Promise.all([(l=timer("metrics"),a=f.metrics,c=null==t?void 0:t.getMetricsPublishingEnabled,d=f.connection.identity,h=c||function(){return!0},p=null!==(n="boolean"!=typeof a&&a.disableAutoAppSystem)&&void 0!==n&&n,g("metrics",s=metrics({connection:a?o:void 0,logger:u.subLogger("metrics"),canUpdateMetric:h,system:"Glue42",service:null!==(e=null==d?void 0:d.service)&&void 0!==e?e:"metrics-service",instance:null!==(i=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==i?i:shortid(),disableAutoAppSystem:p,pagePerformanceMetrics:"boolean"!=typeof a?null==a?void 0:a.pagePerformanceMetrics:void 0}),l),Promise.resolve()),w(),v(),m()]);var n,e,r,i,l,a,c,d,h,p})).then((function(){return l.readyPromise})).then((function(){return y(f.libs||[])})).then((function(){var n=Object.keys(p).map((function(n){var e=p[n];return e.ready?e.ready():Promise.resolve()}));return Promise.all(n)})).then((function(){var r={coreVersion:version,version:f.version};h.stop();var i={feedback:function(n){l&&l.invoke("T42.ACS.Feedback",n,"best")},info:r,logger:u,interop:l,agm:l,connection:o,metrics:s,contexts:a,bus:c,version:f.version,userConfig:n,done:function(){return null==u||u.info("done called by user..."),o.logout()}};if(i.performance={get glueVer(){return f.version},get glueConfig(){return JSON.stringify(n)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var n=getAllTimers();return Object.keys(n).map((function(e){var t=n[e];return{name:e,duration:t.endTime-t.startTime,marks:t.marks}}))}},Object.keys(p).forEach((function(n){var e=p[n];i[n]=e})),i.config={},Object.keys(f).forEach((function(n){i.config[n]=f[n]})),e&&e.extOptions&&Object.keys(e.extOptions).forEach((function(n){i.config[n]=null==e?void 0:e.extOptions[n]})),(null==e?void 0:e.enrichGlue)&&e.enrichGlue(i),t&&t.updatePerfData&&t.updatePerfData(i.performance),i.agm){var d=function(n,e,t){return function(){i.logger.warn("glue.js - 'glue.agm."+e+"' method is deprecated, use 'glue.interop."+t+"' instead."),n.apply(i.agm,arguments)}},g=i.agm;g.method_added=d(i.agm.methodAdded,"method_added","methodAdded"),g.method_removed=d(i.agm.methodRemoved,"method_removed","methodRemoved"),g.server_added=d(i.agm.serverAdded,"server_added","serverAdded"),g.server_method_aded=d(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),g.server_method_removed=d(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(n){return Promise.reject({err:n,libs:p})}))};"undefined"!=typeof window&&(window.GlueCore=GlueCore),GlueCore.version=version,GlueCore.default=GlueCore;var ActivityEntity=function(){function n(n){this._id=n}return Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),n.prototype._update=function(n){if(n._id!==this._id)throw Error("Can not update from entity with different id.");this._updateCore(n)},n.prototype._updateCore=function(n){},n.prototype._beforeDelete=function(n){},n}();function isString(n){return"string"==typeof n}function isObject(n){return"object"==typeof n&&null!==n}function isArray(n){return Array.isArray?Array.isArray(n):"[object Array]"===toString.call(n)}function isUndefined(n){return void 0===n}function isUndefinedOrNull(n){return!n||void 0===n}function isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)}function some(n,e){for(var t=0;t<n.length;t++)if(e(n[t],t))return!0;return!1}function ifNotUndefined(n,e){void 0!==n&&e(n)}function promisify$1(n,e,t){if("function"!=typeof e&&"function"!=typeof t)return n;"function"!=typeof e?e=function(){}:"function"!=typeof t&&(t=function(){}),n.then(e,t)}var ActivityType=function(n){function e(e,t,r,i){var o=n.call(this,e)||this;return o._name=e,o._description=i,o._ownerWindow=t,o._helperWindows=r||[],o}return __extends(e,n),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helperWindows",{get:function(){var n=this;return this._helperWindows.map((function(e){return n.covertToWindowDef(e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerWindow",{get:function(){return this.covertToWindowDef(this._ownerWindow)},enumerable:!0,configurable:!0}),e.prototype.initiate=function(n,e,t){return this._manager.initiate(this._name,n,e,t)},e.prototype._updateCore=function(e){var t=this;n.prototype._updateCore.call(this,e),ifNotUndefined(e._description,(function(n){return t._description=n})),ifNotUndefined(e._ownerWindow,(function(n){return t._ownerWindow=n})),ifNotUndefined(e._helperWindows,(function(n){return t._helperWindows=n}))},e.prototype.covertToWindowDef=function(n){var e,t,r,i;return{type:null===(t=null===(e=n)||void 0===e?void 0:e.id)||void 0===t?void 0:t.type,name:null===(i=null===(r=n)||void 0===r?void 0:r.id)||void 0===i?void 0:i.name}},e}(ActivityEntity),WindowType=function(n){function e(e,t){var r=n.call(this,e)||this;return r._name=e,r._appByWindowTypeGetter=t,r}return __extends(e,n),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this._appByWindowTypeGetter(this._name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"windows",{get:function(){return this._manager.getWindows({type:this._name})},enumerable:!0,configurable:!0}),e.prototype.create=function(n,e){var t=Object.assign({type:this.name,name:this.name,isIndependent:!1},e);return this._manager.createWindow(n,t)},e}(ActivityEntity),EntityEvent=function(n,e){this.entity=n,this.context=e},EntityEventContext=function(n){this.type=n},ActivityStatusChangeEventContext=function(n){function e(e,t){var r=n.call(this,EntityEventType.StatusChange)||this;return r.newStatus=e,r.oldStatus=t,r}return __extends(e,n),e}(EntityEventContext),ActivityContextChangedEventContext=function(n){function e(e,t,r){var i=n.call(this,EntityEventType.ActivityContextChange)||this;return i.context="string"==typeof e?JSON.parse(e):e,i.updated=t,i.removed=r,i}return __extends(e,n),e}(EntityEventContext),EntityEventType=function(){function n(){}return n.Added="added",n.Removed="removed",n.Updated="updated",n.Closed="closed",n.StatusChange="statusChange",n.ActivityContextChange="activityContextUpdate",n.ActivityWindowEvent="activityWindowEvent",n.ActivityWindowJoinedActivity="joined",n.ActivityWindowLeftActivity="left",n}(),ActivityState=function(){function n(){}return n.Created="created",n.Started="started",n.Destroyed="destroyed",n}(),ActivityAGM=function(){function n(n){this._activity=n}return n.prototype.register=function(e,t){this._ensureHasAgm(),n.AGM.register(e,t)},n.prototype.servers=function(){return this._ensureHasAgm(),isUndefinedOrNull(this._activity)?[]:this._activity.windows.map((function(n){return n.instance}))},n.prototype.methods=function(){var n=this;if(this._ensureHasAgm(),isUndefinedOrNull(this._activity))return[];var e=this._activity.windows,t=[],r=[];return e.forEach((function(e){n.methodsForWindow(e).forEach((function(n){-1===t.indexOf(n.name)&&(t.push(n.name),r.push(n))}))})),r},n.prototype.methodsForWindow=function(e){return this._ensureHasAgm(),e.instance?n.AGM.methodsForInstance(e.instance):[]},n.prototype.invoke=function(e,t,r,i,o,l){this._ensureHasAgm();var u=this.servers();if(isUndefinedOrNull(r)&&(r="activity.all"),isString(r))if("activity.all"===r)u;else{if("activity.best"!==r){if("all"===r||"best"===r)return promisify$1(n.AGM.invoke(e,t,r,i),o,l);throw new Error("Invalid invoke target "+r)}var s=u.filter((function(t){return n.AGM.methodsForInstance(t).filter((function(n){return n.name===e})).length>0}));s.length>0&&[s[0]]}else if(isArray(r)){if(r.length>=0){var a=r[0];if(this._isInstance(a))r.map((function(n){return n}));else{if(!this._isActivityWindow(a))throw new Error("Unknown target object");r.map((function(n){return n.instance}))}}}else if(this._isInstance(r))[r];else{if(!this._isActivityWindow(r))throw new Error("Unknown target object");[r.instance]}throw new Error("Not implemented")},n.prototype.unregister=function(e){return this._ensureHasAgm(),n.AGM.unregister(e)},n.prototype.createStream=function(e,t,r){this._ensureHasAgm(),n.AGM.createStream(e,{subscriptionAddedHandler:t,subscriptionRemovedHandler:r,subscriptionRequestHandler:void 0})},n.prototype.subscribe=function(e,t,r){return this._ensureHasAgm(),n.AGM.subscribe(e,t)},n.prototype._ensureHasAgm=function(){if(isUndefinedOrNull(n.AGM))throw new Error("Agm should be configured to be used in activity")},n.prototype._isInstance=function(n){return void 0!==n.application},n.prototype._isActivityWindow=function(n){return void 0!==n.instance},n}(),AttachedActivityDescriptor=function(){function n(n,e,t){this._manager=n,this._ownerActivityId=e,this._state=t}return Object.defineProperty(n.prototype,"ownerId",{get:function(){return this._state.ownerId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"windowIds",{get:function(){return this._state.windowIds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"frameColor",{get:function(){return this._state.frameColor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"context",{get:function(){return this._state.context},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tag",{get:function(){return this._state.tag},enumerable:!0,configurable:!0}),n.prototype.detach=function(n){var e=this;n=n||{};var t={};return Object.keys(this._state).forEach((function(n){t[n]=e._state[n]})),t.context=n.context||t.context,t.frameColor=n.frameColor||t.frameColor,this._manager.detachActivities(this._ownerActivityId,t)},n}(),nextTick=function(n){setTimeout(n,0)};function nodeify(n,e){if(!isFunction(e))return n;n.then((function(n){nextTick((function(){e(null,n)}))}),(function(n){nextTick((function(){e(n,null)}))}))}var Activity=function(n){function e(e,t,r,i,o){var l=n.call(this,e)||this;return l._id=e,l._actType=t,l._status=r,l._context=i,l._ownerId=o,l._agm=new ActivityAGM(l),l}return __extends(e,n),Object.defineProperty(e.prototype,"type",{get:function(){if(this._manager)return this._manager.getActivityType(this._actType)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this._ownerId?this._manager.getWindows({id:this._ownerId})[0]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"windows",{get:function(){return this._manager.getWindows({activityId:this._id})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"agm",{get:function(){return this._agm},enumerable:!0,configurable:!0}),e.prototype.addWindow=function(n,e){return this._manager.addWindowToActivity(this,n,e)},e.prototype.createWindow=function(n,e){return this._manager.createWindow(this,n,e)},e.prototype.createStackedWindows=function(n,e,t){return this._manager.createStackedWindows(this,n,e,t)},e.prototype.leave=function(n,e){return this._manager.leaveWindowFromActivity(this,n,e)},e.prototype.getWindowsByType=function(n){var e={activityId:this._id,type:n};return this._manager.getWindows(e)},e.prototype.setContext=function(n,e){return this._manager.setActivityContext(this,n,e)},e.prototype.updateContext=function(n,e){return this._manager.updateActivityContext(this,n,e)},e.prototype.onStatusChange=function(n){var e=this;return this._manager.subscribeActivityEvents((function(t,r,i){t.id===e.id&&n(t,r,i)}))},e.prototype.onWindowEvent=function(n){var e=this;return this._manager.subscribeWindowEvents((function(t,r,i){t.id===e.id&&n(t,r,i)}))},e.prototype.onContextChanged=function(n){var e=this;this._manager.subscribeActivityContextChanged((function(t,r,i,o){t.id===e.id&&n(r,i,o,t)}));try{n(this.context,this.context,[],this)}catch(n){return}},e.prototype.stop=function(){this._manager.stopActivity(this)},e.prototype.clone=function(n){return this._manager.clone(this,n)},e.prototype.attach=function(n,e){var t;return t="string"==typeof n?n:n.id,this._manager.attachActivities(t,this.id,e)},e.prototype.onActivityAttached=function(n){var e=this;this._manager.subscribeActivitiesAttached((function(t,r,i){t===e._id&&n(i)}))},e.prototype.onDetached=function(n){var e=this;this._manager.subscribeActivitiesDetached((function(t,r,i){r.id===e._id&&n(t,i)}))},e.prototype._updateCore=function(e){var t=this;n.prototype._updateCore.call(this,e),ifNotUndefined(e._actType,(function(n){return t._actType=n})),ifNotUndefined(e._context,(function(n){return t._context=n})),ifNotUndefined(e._ownerId,(function(n){return t._ownerId=n})),!e._status||this._status&&this._status.state===e._status.state||(this._status=e._status)},e.prototype._updateDescriptors=function(n){var e=this;this._attached=n.map((function(n){return new AttachedActivityDescriptor(e._manager,e._id,n)}))},Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},enumerable:!0,configurable:!0}),e.prototype.setFrameColor=function(n,e){var t=this;return nodeify(new Promise((function(e,r){var i=t.windows.length;0===i&&e(t),t.windows.forEach((function(r){r.underlyingWindow.setFrameColor(n,(function(){--i<=0&&e(t)}))})),setTimeout((function(){i>0&&r(t.id+" - timed out waiting for setFrameColor with"+n)}),5e3)})),e)},e.prototype.getFrameColor=function(){return this.windows&&0!==this.windows.length?this.windows[0].underlyingWindow.frameColor:""},e}(ActivityEntity),LogLevel=function(){function n(){}return n.Trace="trace",n.Debug="debug",n.Info="info",n.Warn="warn",n.Error="error",n}(),Logger$1=function(){function n(e){this._name=e,isUndefinedOrNull(n.GlueLogger)||(this._glueLogger=n.GlueLogger.subLogger(e))}return n.GetNamed=function(e){return new n(e)},n.Get=function(e){return new n(n.GetTypeName(e))},n.prototype.trace=function(e){isUndefinedOrNull(this._glueLogger)?n.Level===LogLevel.Trace&&console.info(this._getMessage(e,LogLevel.Trace)):this._glueLogger.trace(e)},n.prototype.debug=function(e){isUndefinedOrNull(this._glueLogger)?n.Level!==LogLevel.Debug&&n.Level!==LogLevel.Trace||console.info(this._getMessage(e,LogLevel.Debug)):this._glueLogger.debug(e)},n.prototype.info=function(e){isUndefinedOrNull(this._glueLogger)?n.Level!==LogLevel.Debug&&n.Level!==LogLevel.Trace&&n.Level!==LogLevel.Info||console.info(this._getMessage(e,LogLevel.Info)):this._glueLogger.info(e)},n.prototype.warn=function(e){isUndefinedOrNull(this._glueLogger)?n.Level!==LogLevel.Debug&&n.Level!==LogLevel.Trace&&n.Level!==LogLevel.Info&&n.Level!==LogLevel.Warn||console.info(this._getMessage(e,LogLevel.Info)):this._glueLogger.warn(e)},n.prototype.error=function(n){isUndefinedOrNull(this._glueLogger)?(console.error(this._getMessage(n,LogLevel.Error)),console.trace()):this._glueLogger.error(n)},n.prototype._getMessage=function(n,e){return"["+e+"] "+this._name+" - "+n},n.GetTypeName=function(n){var e=/function (.{1,})\(/.exec(n.constructor.toString());return e&&e.length>1?e[1]:""},n.Level=LogLevel.Info,n}(),ActivityWindow=function(n){function e(e,t,r,i,o,l,u,s){var a=n.call(this,e)||this;return a._logger=Logger$1.Get("window"),a._type=r,a._activityId=i,a._name=t,a._instance=o,a._isIndependent=l,a._windowGetter=u,a._hcWindowId=s,a}return __extends(e,n),e.prototype.getBounds=function(){return this._manager.getWindowBounds(this.id)},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isIndependent",{get:function(){return this._isIndependent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){if(this._manager)return this._manager.getWindowType(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activity",{get:function(){if(!isUndefined(this._activityId))return this._manager.getActivityById(this._activityId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOwner",{get:function(){var n=this.activity;return!isUndefined(n)&&n.owner.id===this.id},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(n,e){return this._manager.setWindowVisibility(this.id,n)},e.prototype.activate=function(n){return this._manager.activateWindow(this.id,n)},e.prototype.setBounds=function(n,e){return this._manager.setWindowBounds(this.id,n,e)},e.prototype.close=function(){return this._manager.closeWindow(this.id)},Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underlyingWindow",{get:function(){var n=this._windowGetter();return n||{id:this._hcWindowId}},enumerable:!0,configurable:!0}),e.prototype.onActivityJoined=function(n){this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowJoinedActivity,n)},e.prototype.onActivityRemoved=function(n){this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowLeftActivity,n)},e.prototype._updateCore=function(n){var e=this;ifNotUndefined(n._activityId,(function(n){return e._activityId=n})),ifNotUndefined(n._isIndependent,(function(n){return e._isIndependent=n})),ifNotUndefined(n._hcWindowId,(function(n){return e._hcWindowId=n})),ifNotUndefined(n._type,(function(n){return e._type=n})),ifNotUndefined(n._name,(function(n){return e._name=n})),isUndefinedOrNull(n._instance)||(this._instance=n._instance)},e.prototype._subscribeForActivityWindowEvent=function(n,e){var t=this;this._manager.subscribeWindowEvents((function(r,i,o){i.id===t.id&&o===n&&e(r)}))},e.prototype._beforeDelete=function(n){this._hcWindowId=n._hcWindowId},e}(ActivityEntity),ActivityStatus=function(){function n(n,e,t){this.state=n,this.message=e,this.time=t}return n.prototype.getState=function(){return this.state},n.prototype.getMessage=function(){return this.message},n.prototype.getTime=function(){return this.time},n}(),gwMmessageError="error",gwMessageAddActivityTypes="add-types",gwMmessageActivityTypesAdded="types-added",gwMessageRemoveActivityTypes="remove-types",gwMessageActivityTypesRemoved="types-removed",gwMessageActivityCreated="created",gwMessageActivityDestroyed="destroyed",gwMessageActivityInitiated="initiated",gwMmessageJoinActivity="join-activity",gwMessageJoinedActivity="joined",gwMessageActivityJoined="activity-joined",gwMessageLeaveActivity="leave-activity",gwMessageActivityLeft="left",gwNmessageMergeActivities="merge",gwMessageSplitActivities="split",gwMessageOwnerChanged="owner-changed",gwMessageAddPeerFactories="add-peer-factories",gwMessagePeerFactoriesAdded="peer-factories-added",gwMessageRemovePeerFactories="remove-peer-factories",gwMessagePeerFactoriesRemoved="peer-factories-removed",gwMessageCreateActivity="create",gwMessageCreatePeer="create-peer",gwMessagePeerRequested="peer-requested",gwMessageReady="ready",gwMessagePeerCreated="peer-created",gwMessageDestroyActivity="destroy",gwMessageDisposePeer="dispose-peer",gwMessageDestroyPeer="destroy-peer",GW3Bridge$1=function(){function n(n){var e=this;if(this._activityChangeCallbacks=[],this._activityTypeStatusChangeCallbacks=[],this._activityWindowChangeCallbacks=[],this._windowTypeStatusChangeCallbacks=[],this._peerIdAndFactoryIdToPeerType={},this._peerFactoriesRegisteredByUs={},this._gw3Subscriptions=[],this._contextSubscriptions={},this._activityTypesInitiatedFromMe={},this._config=n,this._connection=n.connection,this._logger=n.logger,this._contexts=n.contexts,this._windows=n.windows,this._sessionJoinedPromise=new Promise((function(n){e._sessionJoinedPromiseResolve=n})),this._activityJoinedPromise=new Promise((function(n){e._activityJoinedPromiseResolve=n})),this._config.activityId||this._activityJoinedPromiseResolve({}),this._gw3Session=this._connection.domain("activity",["joined","initiated","peer-created","token"]),"undefined"!=typeof window){var t=window.glue42gd;t&&"function"==typeof t.addRefreshHandler&&t.addRefreshHandler((function(n,r){e._gw3Session.send({type:"reload"}).then((function(e){if(e.token){try{t.setGWToken(e.token)}catch(n){return void r(n.message||n)}n()}else r("Expected gateway token for refreshing.")}),r)}))}}return n.activityTypeGwMessageEntityToActivityType=function(n,e){var t=function(n){return new WindowType(n,void 0)};return new ActivityType(n.name,n.owner_type&&t(n.owner_type),n.helper_types&&n.helper_types.map(t),e)},n.peerFactoryGwMessageEntityToWindowType=function(n){return new WindowType(n.peer_type,(function(n){}))},n.activityGwMessageToActivity=function(n,e){var t=void 0!==n.owner?n.owner.peer_id:n.owner_id;return new Activity(n.activity_id,n.activity_type,e,n.context_snapshot,t)},n.activityToActivityStatusChangeEvent=function(n){return new EntityEvent(n,new ActivityStatusChangeEventContext(n.status,void 0))},Object.defineProperty(n.prototype,"bridgeType",{get:function(){return"GW3"},enumerable:!0,configurable:!0}),n.prototype.init=function(){var n=this;this.forwardActivityTypeMessagesToStatusEventHandlers(),this.subscribe(gwMessageActivityCreated,this.handleActivityCreatedMessage),this.subscribe(gwMessageActivityDestroyed,this.handleActivityDestroyedMessage),this.forwardActivityMessagesToStatusEventHandlers(),this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(),this.forwardPeerFactoryMessagesToStatusEventHandlers(),this.forwardPeerFactoryMessagesToPeerFactoryRequests(),this.subscribe(gwMessagePeerFactoriesAdded,this.handlePeerFactoriesAdded),this.subscribe(gwMessagePeerFactoriesRemoved,this.handlePeerFactoriesRemoved),this.forwardActivityWindowMessagesToEventHandlers(),this.subscribe(gwMessageDisposePeer,(function(){if("dispose"!==n._config.disposeRequestHandling){if("exit"===n._config.disposeRequestHandling){if(n._windows&&void 0!==n._windows.my())return void n._windows.my().close();if("undefined"!=typeof window&&"function"==typeof window.close)return void window.close();if("undefined"!=typeof process&&"function"==typeof process.exit)return void process.exit()}}else n.dispose()})),this._gw3Session.onJoined((function(){"trackMyOnly"===n._config.mode||"trackMyTypeAndInitiatedFromMe"===n._config.mode?n._sessionJoinedPromiseResolve(n):n._gw3Session.send({type:"subscribe",activity_types:"trackAll"===n._config.mode?[]:"trackTypes"===n._config.mode?n._config.typesToTrack:[]}).then((function(){n._sessionJoinedPromiseResolve(n)}))})),this._gw3Session.join()},n.prototype.dispose=function(){var n=this;this._gw3Subscriptions.forEach((function(e){return e&&n._connection.off(e)})),this._gw3Subscriptions.length=0},n.prototype.ready=function(){return Promise.all([this._sessionJoinedPromise,this._activityJoinedPromise])},n.prototype.initReady=function(){return this._sessionJoinedPromise},n.prototype.onActivityTypeStatusChange=function(n){this._activityTypeStatusChangeCallbacks.push(n)},n.prototype.registerActivityType=function(e,t,r,i,o){var l=this,u={};u.name=e;var s=function(n){return{type:n.type,name:n.name,configuration:n}};return u.owner_type=s(t),u.helper_types=r.map(s),this._gw3Session.send({type:gwMessageAddActivityTypes,types:[u]}).then((function(){var e=n.activityTypeGwMessageEntityToActivityType(u,o);return l.invokeCallbacks(l._activityTypeStatusChangeCallbacks,new EntityEvent(e,new EntityEventContext(EntityEventType.Added)),gwMessageAddActivityTypes),e}))},n.prototype.unregisterActivityType=function(n){var e=this;return this._gw3Session.send({type:gwMessageRemoveActivityTypes,types:[n]}).then((function(){var t=new ActivityType(n,void 0,void 0,void 0);e.invokeCallbacks(e._activityTypeStatusChangeCallbacks,new EntityEvent(t,new EntityEventContext(EntityEventType.Removed)),gwMessageAddActivityTypes)}))},n.prototype.onWindowTypeStatusChange=function(n){this._windowTypeStatusChangeCallbacks.push(n)},n.prototype.registerWindowFactory=function(e,t,r){var i=this;if(this._peerFactoriesRegisteredByUs[e])return Promise.reject(new Error("Factory for windowType "+e+" already registered."));this._peerFactoriesRegisteredByUs[e]=t;var o={id:e,peer_type:e,configuration:r};return this._gw3Session.send({type:gwMessageAddPeerFactories,factories:[o]}).then((function(){i.invokeCallbacks(i._windowTypeStatusChangeCallbacks,new EntityEvent(n.peerFactoryGwMessageEntityToWindowType(o),new EntityEventContext(EntityEventType.Added)),gwMessageAddPeerFactories)})).catch((function(){delete i._peerFactoriesRegisteredByUs[e]}))},n.prototype.unregisterWindowFactory=function(n){var e=this;return this._peerFactoriesRegisteredByUs[n]?(delete this._peerFactoriesRegisteredByUs[n],this._gw3Session.send({type:gwMessageRemovePeerFactories,factory_ids:[n]}).then((function(){e.invokeCallbacks(e._windowTypeStatusChangeCallbacks,new EntityEvent(new WindowType(n,void 0),new EntityEventContext(EntityEventType.Removed)),gwMessageAddPeerFactories)}))):Promise.reject(new Error("Factory for windowType "+n+" not registered."))},n.prototype.onActivityStatusChange=function(n){this._activityChangeCallbacks.push(n)},n.prototype.initiateActivity=function(n,e,t){var r=this,i={type:gwMessageCreateActivity,activity_type:n,initial_context:e};return this.isOverrideTypeDefinition(t)?i.types_override={owner_type:{type:t.owner.type,name:t.owner.name,configuration:t.owner},helper_types:t.helpers&&t.helpers.map((function(n){return{type:n.type,name:n.name,configuration:n}}))}:i.configuration=t&&t.map((function(n){return{type:n.type,name:n.name,configuration:n}})),this.sendCreateAndMapResultingMessagesToPromise(i,gwMessageActivityInitiated,(function(n,e){return n.request_id===e}),gwMessageActivityCreated,(function(n,e,t){return n.activity_id===t.activity_id}),gwMessageActivityDestroyed,(function(n,e,t){return n.activity_id===t.activity_id}),(function(n){return n.activity_id})).then((function(e){return"trackMyTypeAndInitiatedFromMe"!==r._config.mode||r._activityTypesInitiatedFromMe[n]?e:(r._activityTypesInitiatedFromMe[n]=!0,r._gw3Session.send({type:"subscribe",activity_types:[n]}).then((function(){return e})))}))},n.prototype.stopActivity=function(n){return this._gw3Session.send({type:gwMessageDestroyActivity,activity_id:n.id,reason_uri:"com.tick42.glue.activity.constants.destroyReason.general",reason:"Destroying activity"}).then((function(n){return!0}))},n.prototype.updateActivityContext=function(n,e,t,r){if(t)return this._contexts.set(n.id,e);for(var i=0,o=r=r||[];i<o.length;i++){e[o[i]]=null}return this._contexts.update(n.id,e)},n.prototype.announceWindow=function(n,e){throw new Error("Invalid operation 'announceWindow' for GW3 protocol")},n.prototype.registerWindow=function(n,e,t){var r=void 0!==this._connection.gatewayToken,i=this._connection.peerId;if("undefined"!=typeof window){var o=window.glue42gd;o&&(r=void 0!==o.activityInfo)}return r&&this._gw3Session.send({type:gwMessageReady}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new EntityEvent(new ActivityWindow(i,e,n,void 0,this.getAgmInstance(i),t,this.generateWindowGetter(i),void 0),new EntityEventContext(EntityEventType.Added)),"register window"),Promise.resolve(i)},n.prototype.onActivityWindowChange=function(n){this._activityWindowChangeCallbacks.push(n)},n.prototype.createWindow=function(n,e){var t=this;return e.layout||(e.left||e.width||e.height||e.top)&&(e.layout={mode:"pixels",cellSize:1}),this.sendCreateAndMapResultingMessagesToPromise({type:gwMessageCreatePeer,peer_type:e.type,peer_name:e.name||e.type,configuration:e,activity_id:n},void 0,void 0,gwMessagePeerCreated,(function(n,e){return n.request_id===e}),void 0,void 0,(function(n){return n.created_id})).then((function(r){if(n)return t.joinActivity(n,r,e.name).then((function(){return r}))}))},n.prototype.closeWindow=function(n){return this._gw3Session.send({type:gwMessageDestroyPeer,destroy_peer_id:n}).then((function(n){}))},n.prototype.getAnnouncementInfo=function(){var n=this._config.activityId||this._config.announcementInfo&&this._config.announcementInfo.activityId,e=this._config.announcementInfo&&this._config.announcementInfo.activityWindowType,t=this._config.announcementInfo&&this._config.announcementInfo.activityWindowIndependent,r=this._config.announcementInfo&&this._config.announcementInfo.activityWindowName;if("undefined"!=typeof window&&void 0!==window.location&&window.location.search&&"function"==typeof URLSearchParams){var i=new URLSearchParams(location.search.slice(1));e=(e=e||i.get("t42PeerType"))||i.get("t42ActivityWindowType"),void 0===t&&(t=i.get("t42ActivityWindowIndependent")),r=r||i.get("t42ActivityWindowName"),n=n||i.get("t42ActivityId")}return{activityWindowId:void 0,activityId:n,activityWindowType:e=e||"unknown",activityWindowIndependent:t=t||!1,activityWindowName:r=r||this._connection.peerId}},n.prototype.joinActivity=function(n,e,t){var r=this,i=t&&{name:t}||{};return this._gw3Session.send(__assign({type:gwMmessageJoinActivity,target_id:e,activity_id:n},i)).then((function(){r.invokeCallbacks(r._activityWindowChangeCallbacks,new EntityEvent(new ActivityWindow(e,void 0,void 0,n,r.getAgmInstance(e),void 0,r.generateWindowGetter(e),void 0),new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)),"activity joined - ActivityWindow"),r.invokeCallbacks(r._activityChangeCallbacks,new EntityEvent(new Activity(n,void 0,new ActivityStatus("created",void 0,void 0),void 0,void 0),new EntityEventContext(EntityEventType.Updated)),"activity joined - Activity")}))},n.prototype.leaveActivity=function(n,e){var t=this;return this._gw3Session.send({type:gwMessageLeaveActivity,target_id:e,activity_id:n}).then((function(){t.invokeCallbacks(t._activityWindowChangeCallbacks,new EntityEvent(new ActivityWindow(e,void 0,void 0,null,t.getAgmInstance(e),void 0,t.generateWindowGetter(e),void 0),new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)),"activity left - ActivityWindow"),t.invokeCallbacks(t._activityChangeCallbacks,new EntityEvent(new Activity(n,void 0,new ActivityStatus("created",void 0,void 0),void 0,void 0),new EntityEventContext(EntityEventType.Updated)),"activity left - Activity")}))},n.prototype.getActivityTypes=function(){return Promise.resolve([])},n.prototype.getWindowTypes=function(){return Promise.resolve([])},n.prototype.getActivities=function(){return Promise.resolve([])},n.prototype.getActivityWindows=function(){return Promise.resolve([])},n.prototype.createStackedWindows=function(n,e,t){},n.prototype.getWindowBounds=function(n){},n.prototype.setWindowBounds=function(n,e){},n.prototype.activateWindow=function(n,e){},n.prototype.setWindowVisibility=function(n,e){},n.prototype.cloneActivity=function(n,e){},n.prototype.attachActivities=function(n,e,t){return this._gw3Session.send({type:gwNmessageMergeActivities,into:e,merge:n})},n.prototype.detachActivities=function(n,e){return this._gw3Session.send({type:gwMessageSplitActivities,from:n}).then((function(){return""}))},n.prototype.onActivitiesAttached=function(n){},n.prototype.onActivitiesDetached=function(n){},n.prototype.onActivityAttachedDescriptorsRefreshed=function(n){},n.prototype.getAttachedDescriptors=function(){return Promise.resolve([])},n.prototype.getRandomRequestId=function(){return this._connection.peerId+":"+Math.floor(1e9*Math.random())},n.prototype.forwardAddedAndRemovedMessagesToEventHandler=function(n,e,t,r){var i=function(n){return function(e){return new EntityEvent(e,new EntityEventContext(n?EntityEventType.Added:EntityEventType.Removed))}};return[n&&this.forwardMessageToEventHandler(n,(function(n){return t(n,!0)}),i(!0),r),e&&this.forwardMessageToEventHandler(e,(function(n){return t(n,!1)}),i(!1),r)].filter((function(n){return n}))},n.prototype.forwardMessageToEventHandler=function(n,e,t,r){return this.subscribe(n,(function(n){e(n).forEach((function(e){return r.forEach((function(r){return r(t(e,n))}))}))}))},n.prototype.sendCreateAndMapResultingMessagesToPromise=function(n,e,t,r,i,o,l,u){var s,a,c,d,h,f,p=this,g=this.getRandomRequestId(),w=new Promise((function(n,e){s=n,a=e})),v=null,m=function(){p.dropSubscription(c),p.dropSubscription(d),p.dropSubscription(h),p.dropSubscription(f)};c=e&&this.subscribe(e,(function(n){t(n,g)&&(v=n,p.dropSubscription(c))})),d=this.subscribe(r,(function(n){i(n,g,v)&&s(u(n))})),h=o&&this.subscribe(o,(function(n){l(n,g,v)&&a(n)})),f=o&&this.subscribe(gwMmessageError,(function(n){n.request_id===g&&a(n)})),n.request_id=g;var y=this._gw3Session.send(n).then((function(){return w}));return y.then(m,m),y},n.prototype.peerFactoryIdAndOwnerIdToWindowType=function(n,e){var t=this._peerIdAndFactoryIdToPeerType[e+":"+n];return t?new WindowType(t,void 0):null},n.prototype.subscribe=function(n,e){var t=this,r=this._connection.on(n,(function(n){return e.bind(t)(n)}));return this._gw3Subscriptions.push(r),r},n.prototype.dropSubscription=function(n){n&&(this._connection.off(n),delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(n)])},n.prototype.invokeCallbacks=function(n,e,t){var r=this;n.forEach((function(n){try{n(e)}catch(n){r._logger.error("Error in "+(t||e.context.type)+" callback: "+JSON.stringify(n))}}))},n.prototype.handleActivityCreatedMessage=function(n){n.context_id?this._contextSubscriptions[n.activity_id]||this.subscribeToContext(n):this._logger.error("Activity created with unknown context_id: "+n.activity_id)},n.prototype.subscribeToContext=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e,t,r,i=this;return __generator(this,(function(o){switch(o.label){case 0:return e=n.activity_id,t=this._contextSubscriptions,r=e,[4,this._contexts.subscribe(e,(function(n,t,r){var o=new EntityEvent(new Activity(e,void 0,void 0,n,void 0),new ActivityContextChangedEventContext(n,t,r));i.invokeCallbacks(i._activityChangeCallbacks,o,"context updated")}))];case 1:return t[r]=o.sent(),[2]}}))}))},n.prototype.handleActivityDestroyedMessage=function(n){var e=this._contextSubscriptions[n.activity_id];"function"==typeof e&&e(),delete this._contextSubscriptions[n.activity_id]},n.prototype.handlePeerFactoriesAdded=function(n){var e=this;n.factories.forEach((function(t){e._peerIdAndFactoryIdToPeerType[n.owner_id+":"+t.id]=t.peer_type}))},n.prototype.handlePeerFactoriesRemoved=function(n){var e=this;n.factory_ids.forEach((function(t){delete e._peerIdAndFactoryIdToPeerType[n.owner_id+":"+t]}))},n.prototype.forwardActivityTypeMessagesToStatusEventHandlers=function(){this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded,gwMessageActivityTypesRemoved,(function(e,t){return t?e.types.map((function(e){return n.activityTypeGwMessageEntityToActivityType(e,void 0)})):e.types.map((function(n){return new ActivityType(n.name,void 0,void 0,void 0)}))}),this._activityTypeStatusChangeCallbacks)},n.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers=function(){for(var n=this,e=0,t=[gwMessageActivityCreated,gwMessageJoinedActivity,gwMessageOwnerChanged];e<t.length;e++){var r=t[e];this.forwardMessageToEventHandler(r,(function(e){return[e.owner||__assign(__assign({},e),{type:e.peer_type,name:e.peer_name,peer_id:e.owner_id})].concat(e.participants||[]).map((function(t){return new ActivityWindow(t.peer_id,t.name,t.type,e.activity_id,n.getAgmInstance(t.peer_id),void 0,n.generateWindowGetter(t.peer_id),void 0)}))}),(function(n,e){return new EntityEvent(n,new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity))}),this._activityWindowChangeCallbacks)}},n.prototype.forwardActivityMessagesToStatusEventHandlers=function(){for(var e=0,t=[gwMessageActivityCreated,gwMessageJoinedActivity];e<t.length;e++){var r=t[e];this.forwardMessageToEventHandler(r,(function(e){return[n.activityGwMessageToActivity(e,new ActivityStatus("started","",new Date))]}),(function(e,t){return n.activityToActivityStatusChangeEvent(e)}),this._activityChangeCallbacks)}this.forwardMessageToEventHandler(gwMessageActivityDestroyed,(function(e){return[n.activityGwMessageToActivity(e,new ActivityStatus("destroyed",e.reason,new Date))]}),(function(e,t){return n.activityToActivityStatusChangeEvent(e)}),this._activityChangeCallbacks),this.forwardMessageToEventHandler(gwMessageActivityInitiated,(function(e){return[n.activityGwMessageToActivity(e,new ActivityStatus("created","",new Date))]}),(function(e,t){return n.activityToActivityStatusChangeEvent(e)}),this._activityChangeCallbacks),this.forwardMessageToEventHandler(gwMessageOwnerChanged,(function(e){return[n.activityGwMessageToActivity(e,new ActivityStatus("created","",new Date))]}),(function(e,t){return n.activityToActivityStatusChangeEvent(e)}),this._activityChangeCallbacks)},n.prototype.forwardPeerFactoryMessagesToStatusEventHandlers=function(){var e=this;this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded,gwMessagePeerFactoriesRemoved,(function(t,r){return r?t.factories.map(n.peerFactoryGwMessageEntityToWindowType):t.factory_ids.map((function(n){return e.peerFactoryIdAndOwnerIdToWindowType(n,t.owner_id)})).filter((function(n){return null!=n}))}),this._windowTypeStatusChangeCallbacks)},n.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests=function(){var n=this;this.subscribe(gwMessagePeerRequested,(function(e){var t=n._peerFactoriesRegisteredByUs[e.peer_factory];if(t)try{var r=e.configuration||{};r.gateway_token=r.gateway_token||e.gateway_token,r.peer_factory=r.peer_factory||e.peer_factory;var i=t({activityId:e.activity&&e.activity.id,activityType:e.activity&&e.activity.type,type:e.configuration&&e.configuration.type,gwToken:r.gateway_token,configuration:r});i&&i.then&&i.catch&&i.catch((function(t){return n._gw3Session.send({type:gwMmessageError,request_id:e.request_id,reason:t&&(t.message||JSON.stringify(t))})}))}catch(t){n._gw3Session.send({type:gwMmessageError,request_id:e.request_id,reason:t&&(t.message||JSON.stringify(t))})}else n._gw3Session.send({type:gwMmessageError,request_id:e.request_id,reason:"Unknown peer factory "+e.peer_factory})}))},n.prototype.forwardActivityWindowMessagesToEventHandlers=function(){for(var n=this,e=function(e){t.subscribe(e,(function(t){var r=e===gwMessageActivityJoined?t.joined_id:t.peer_id,i=e===gwMessageActivityJoined?t.joined_type:t.peer_type,o=e===gwMessageActivityJoined?t.joined_name:t.peer_name,l=new ActivityWindow(r,o,i,t.activity_id,n.getAgmInstance(r),void 0,n.generateWindowGetter(r),void 0);n._contextSubscriptions[t.activity_id]?e===gwMessageJoinedActivity&&n._activityJoinedPromiseResolve({}):n.subscribeToContext(t).then((function(){e===gwMessageJoinedActivity&&n._activityJoinedPromiseResolve({})})),n.invokeCallbacks(n._activityWindowChangeCallbacks,new EntityEvent(l,new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)),e)}))},t=this,r=0,i=[gwMessageActivityJoined,gwMessageJoinedActivity];r<i.length;r++){e(i[r])}this.subscribe(gwMessageActivityLeft,(function(e){var t=new ActivityWindow(e.left_id,void 0,void 0,null,n.getAgmInstance(e.left_id),void 0,n.generateWindowGetter(e.left_id),void 0);n.invokeCallbacks(n._activityWindowChangeCallbacks,new EntityEvent(t,new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)),gwMessageActivityLeft)})),this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated,void 0,(function(e){return[new ActivityWindow(e.created_id,void 0,void 0,void 0,void 0,void 0,n.generateWindowGetter(e.created_id),void 0)]}),this._activityWindowChangeCallbacks)},n.prototype.getAgmInstance=function(n){return this._config.agm.servers().find((function(e){return e.peerId===n||e.windowId===n}))},n.prototype.generateWindowGetter=function(n){var e=this;return function(){var t=e.getAgmInstance(n);if(t){var r=t.windowId;return e._config.windows.list().filter((function(n){return n.id===r}))[0]}}},n.prototype.isOverrideTypeDefinition=function(n){return void 0!==n&&!!n.owner},n}(),ActivityMy=function(){function n(n,e){var t=this;this._myAttached=[],this._myDetached=[],this._myAttachedTo=[],this._myDetachedFrom=[],this._myActivityFrameColorChanged=[],this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=Logger$1.Get(this),this._m=n,n.ready().then((function(n){n.subscribeActivityContextChanged(t._subscribeMyContextChanged.bind(t)),n.subscribeWindowEvents(t._subscribeMyWindowEvent.bind(t)),n.subscribeActivitiesAttached(t._subscribeActivitiesAttached.bind(t)),n.subscribeActivitiesDetached(t._subscribeActivitiesDetached.bind(t)),e&&e.onWindowFrameColorChanged(t._subscribeWindowFrameColorChanged.bind(t))}))}return Object.defineProperty(n.prototype,"window",{get:function(){if(isUndefinedOrNull(this._w)){var n=this._m.announcedWindows;n.length>0&&(this._w=n[0])}return this._w},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activity",{get:function(){var n=this.window;if(!isUndefinedOrNull(n))return n.activity},enumerable:!0,configurable:!0}),n.prototype.createWindow=function(n){return this._m.createWindow(this.activity,n)},n.prototype.createStackedWindows=function(n,e){return this._m.createStackedWindows(this.activity,n,e)},Object.defineProperty(n.prototype,"context",{get:function(){var n=this.activity;return isUndefined(n)?{}:n.context},enumerable:!0,configurable:!0}),n.prototype.updateContext=function(n,e){var t=this.activity;return isUndefined(t)?new Promise((function(n,e){e("Not in activity")})):t.updateContext(n,e)},n.prototype.setContext=function(n,e){var t=this.activity;return isUndefined(t)?new Promise((function(n,e){e("Not in activity")})):t.setContext(n,e)},n.prototype.onActivityJoined=function(n){this._myActivityJoinedCallbacks.push(n);var e=this.window;isUndefinedOrNull(e)||isUndefinedOrNull(e.activity)||n(e.activity)},n.prototype.onActivityLeft=function(n){this._myActivityRemovedCallbacks.push(n)},n.prototype.onContextChanged=function(n){this._myContextUpdateCallbacks.push(n);var e=this.window;if(!isUndefinedOrNull(e)){var t=e.activity;isUndefinedOrNull(t)||n(t.context,t.context,[],t)}},n.prototype.clone=function(n,e){var t=this.activity;return this._m.clone(t,n,e)},n.prototype.attach=function(n,e){var t;return t="string"==typeof n?n:n.id,this._m.attachActivities(t,this.activity.id,e)},n.prototype.onActivityAttached=function(n){this._myAttached.push(n)},n.prototype.onActivityDetached=function(n){this._myDetached.push(n)},n.prototype.onAttachedToActivity=function(n){this._myAttachedTo.push(n)},n.prototype.onDetachedFromActivity=function(n){this._myDetachedFrom.push(n)},Object.defineProperty(n.prototype,"attached",{get:function(){return this.activity?this.activity.attached:[]},enumerable:!0,configurable:!0}),n.prototype.setFrameColor=function(n,e){return this.activity?this.activity.setFrameColor(n,e):Promise.resolve(null)},n.prototype.getFrameColor=function(){return this.activity?this.activity.getFrameColor():""},n.prototype.onFrameColorChanged=function(n){this._myActivityFrameColorChanged.push(n)},n.prototype._subscribeMyContextChanged=function(n,e,t,r){var i=this.window;if(!isUndefinedOrNull(i)){var o=i.activity;isUndefinedOrNull(o)||n.id===o.id&&this._notifyMyContextChanged(n,e,t,r)}},n.prototype._subscribeMyWindowEvent=function(n,e,t){isUndefinedOrNull(this.window)||this.window.id===e.id&&(t===EntityEventType.ActivityWindowJoinedActivity?(this._notifyMyWindowEvent(n,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(n,n.context,null,null)):t===EntityEventType.ActivityWindowLeftActivity&&this._notifyMyWindowEvent(n,this._myActivityRemovedCallbacks))},n.prototype._notifyMyWindowEvent=function(n,e){var t=this;e.forEach((function(e){try{e(n,event)}catch(n){t._logger.warn("error in user callback "+n)}}))},n.prototype._notifyMyContextChanged=function(n,e,t,r){var i=this;t=t||{},r=r||[],this._myContextUpdateCallbacks.forEach((function(o){try{o(e,t,r,n)}catch(n){i._logger.warn("error in user callback "+n)}}))},n.prototype._notifyAttached=function(n){var e=this;this._myAttached.forEach((function(t){try{t(n)}catch(n){e._logger.warn("error in user callback "+n)}}))},n.prototype._notifyDetached=function(n){var e=this;this._myDetached.forEach((function(t){try{t(n)}catch(n){e._logger.warn("error in user callback "+n)}}))},n.prototype._notifyAttachedTo=function(n){var e=this;this._myAttachedTo.forEach((function(t){try{t(e.activity,n)}catch(n){e._logger.warn("error in user callback "+n)}}))},n.prototype._notifyDetachedFrom=function(n,e,t){var r=this;this._myDetachedFrom.forEach((function(i){try{i(n,e,t)}catch(n){r._logger.warn("error in user callback "+n)}}))},n.prototype._subscribeActivitiesAttached=function(n,e){var t=this.window;if(!isUndefinedOrNull(t)){var r=t.activity;isUndefinedOrNull(r)||n.id===r.id&&(e.windowIds.indexOf(t.id)>=0?this._notifyAttachedTo(e):this._notifyAttached(e))}},n.prototype._subscribeActivitiesDetached=function(n,e,t){var r=this.window;if(!isUndefinedOrNull(r)){var i=r.activity;isUndefinedOrNull(i)||(e.id===i.id&&this._notifyDetached(t),n.id===i.id&&this._notifyDetachedFrom(n,e,t))}},n.prototype._subscribeWindowFrameColorChanged=function(n){var e=this.activity;e&&e.owner&&e.owner.underlyingWindow.id===n.id&&this._myActivityFrameColorChanged.forEach((function(e){e(n.frameColor)}))},n}(),ReadyMarker=function(){function n(n,e){if(this._logger=Logger$1.Get("ReadyMarker ["+n+"]"),this._logger.debug("Initializing ready marker for '"+n+"' with "+e+" signals to wait"),e<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=e,this._callbacks=[],this._name=n}return n.prototype.setCallback=function(n){this.isSet()?n(void 0):this.isError()?n(this._error):this._callbacks.push(n)},n.prototype.signal=function(n){if(this._logger.debug("Signaled - "+n+" - signals left "+(this._signals-1)),this._signals--,this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach((function(n){n(void 0)}))},n.prototype.error=function(n){this._error=n,this._callbacks.forEach((function(e){e(n)}))},n.prototype.isSet=function(){return!this.isError()&&0===this._signals},n.prototype.isError=function(){return!isUndefined(this._error)},n.prototype.getError=function(){return this._error},n}(),EntityObservableCollection=function(){function n(n){this._items={},this._listeners=[],this._processNew=n}return n.prototype.addOne=function(n){this.add([n])},n.prototype.add=function(n){var e=this;n.forEach((function(n){e.process(new EntityEvent(n,new EntityEventContext(EntityEventType.Added)))}))},n.prototype.process=function(n){var e=n.context,t=e.type,r=n.entity;if(t===EntityEventType.StatusChange&&!e.oldStatus){var i=this._items[r.id];i&&(e.oldStatus=i.status)}t===EntityEventType.StatusChange&&e.oldStatus&&e.newStatus&&e.oldStatus.state===e.newStatus.state&&(e.type=EntityEventType.Updated),"undefined"==typeof htmlContainer&&(t===EntityEventType.ActivityWindowJoinedActivity&&this._items[r.id]&&this._items[r.id].activity&&(e.type=EntityEventType.Updated),t===EntityEventType.ActivityWindowLeftActivity&&this._items[r.id]&&!this._items[r.id].activity&&(e.type=EntityEventType.Updated));var o=this._updateInternalCollections(r,t,e);return this._notifyListeners(o,e),o},n.prototype.get=function(){var n=[];for(var e in this._items)if(this._items.hasOwnProperty(e)){var t=this._items[e];n.push(t)}return n},n.prototype.getByName=function(n){for(var e in this._items)if(e===n)return this._items[e]},n.prototype.getOrWait=function(n){var e=this;return new Promise((function(t){var r=function(i){i.id===n&&(t(i),e.unsubscribe(r))};e.subscribe(r);var i=e.getByName(n);if(i)return e.unsubscribe(r),void t(i)}))},n.prototype.subscribe=function(n){var e=this;return this._listeners.push(n),Object.keys(this._items).forEach((function(t){var r=e._items[t];n(r,new EntityEventContext(EntityEventType.Added.toString()))})),function(){e.unsubscribe(n)}},n.prototype.unsubscribe=function(n){var e=this._listeners.indexOf(n);-1!==e&&this._listeners.splice(e,1)},n.prototype._notifyListeners=function(n,e){this._listeners.forEach((function(t){try{t(n,e)}catch(n){return}}))},n.prototype._updateInternalCollections=function(n,e,t){var r=n,i=e===EntityEventType.StatusChange&&r.status&&r.status.state===ActivityState.Destroyed||e===EntityEventType.StatusChange&&t&&t.newStatus&&t.newStatus.state===ActivityState.Destroyed,o=e===EntityEventType.Closed;if(e===EntityEventType.Removed&&void 0===r.isIndependent||o||i){var l=this._items[n.id];return delete this._items[n.id],this._processNew(n),l&&n._beforeDelete(l),n}var u=n.id;return this._items.hasOwnProperty(u)?this._items[n.id]._update(n):(this._processNew(n),this._items[n.id]=n),this._items[n.id]},n}(),ActivityManager=function(){function n(n,e,t){var r=this;this._logger=Logger$1.Get("activityManager"),this._announcedWindows=[],this._attachedCallbacks=[],this._detachedCallbacks=[],this._frameColorChangesCallbacks=[],this._windowHandlers=[],this._bridge=n,this._activityTypes=new EntityObservableCollection((function(n){return r._grabEntity(n)})),this._windowTypes=new EntityObservableCollection((function(n){return r._grabEntity(n)})),this._activities=new EntityObservableCollection((function(n){return r._grabEntity(n)})),this._windows=new EntityObservableCollection((function(n){return r._grabEntity(n)})),this._dataReadyMarker=new ReadyMarker("Activity Manager Data",["GetActivityTypes","GetWindowTypes","GetActivities","GetWindows"].length),this._descriptorsMarker=new ReadyMarker("Attached Activities Descriptors",["GetDescriptors"].length),e?(this._readyMarker=new ReadyMarker("Activity Manager Announce",["Announcement"].length),this._dataReadyMarker.setCallback((function(n){n&&r._readyMarker.error(n),r._descriptorsMarker.setCallback((function(n){n&&r._readyMarker.error(n),r._logger.debug("Auto announcing window"),r.announceWindow().then((function(n){r._announcedWindows.push(n),r._readyMarker.signal("Successfully announced window with id '"+n.id+"'")})).catch((function(n){r._logger.debug("Will not announce window - "+n),r._readyMarker.signal()}))})),r.refreshDescriptors()}))):this._readyMarker=this._dataReadyMarker,this._bridge.onActivitiesAttached((function(n){r._handleActivitiesAttached(n)})),this._bridge.onActivitiesDetached((function(n){r._handleActivitiesDetached(n)})),this._bridge.onActivityAttachedDescriptorsRefreshed((function(n){r._handleActivityDescriptorsRefreshed(n)})),t&&t.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this)),this._bridge.init(),this._subscribeForData(),this._bridge.initReady().then((function(n){r._getInitialData()})).catch((function(n){console.log(n)}))}return Object.defineProperty(n.prototype,"usingHc",{get:function(){return"HC"===this._bridge.bridgeType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"announcedWindows",{get:function(){return this._announcedWindows},set:function(n){throw new Error("not allowed")},enumerable:!0,configurable:!0}),n.prototype.ready=function(n){var e=this,t=new Promise((function(n,t){e._readyMarker.setCallback((function(r){r?t(e._readyMarker.getError()):n(e)}))}));return nodeify(Promise.all([this._bridge.ready(),t]).then((function(){return e})),n)},n.prototype.getActivityTypes=function(){return this._activityTypes.get()},n.prototype.getActivityType=function(n){return this._activityTypes.getByName(n)},n.prototype.registerActivityType=function(n,e,t,r,i,o){var l=this;return nodeify(new Promise((function(o,u){var s;if(isUndefinedOrNull(n))u("activityTypeName argument can not be undefined");else if(isString(n))if(isUndefinedOrNull(l.getActivityType(n)))if(isUndefined(e))u("Owner window type can not be undefined");else{s=isString(e)?{type:e,name:"",isIndependent:!1,arguments:{}}:e;var a=[];if(!isUndefined(t)&&isArray(t))for(var c in t){var d=t[c];if(isString(d)){var h={type:d,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};a.push(h)}else a.push(d)}l._bridge.registerActivityType(n,s,a,r,i).then((function(n){l._grabEntity(n),o(n)})).catch((function(n){u(n)}))}else u("Activity type '"+n+"' already exists");else u("activityTypeName should be string")})),o)},n.prototype.unregisterActivityType=function(n,e){var t=this;return nodeify(new Promise((function(e,r){var i=t.getActivityType(n);isUndefined(i)?r("Activity type '"+n+"' does not exists"):t._bridge.unregisterActivityType(n).then((function(){return e(i)}),r)})),e)},n.prototype.initiate=function(n,e,t,r){var i=this;return nodeify(new Promise((function(t,o){isUndefined(i.getActivityType(n))?o("Activity type '"+n+"' does not exists"):i._bridge.initiateActivity(n,e,r).then((function(n){i._activities.getOrWait(n).then((function(n){t(n)})).catch((function(n){return o(n)}))})).catch((function(n){o(n)}))})),t)},n.prototype.subscribeActivityTypeEvents=function(n){this._activityTypes.subscribe((function(e,t){n(e,t.type)}))},n.prototype.getWindowTypes=function(){return this._windowTypes.get()},n.prototype.getWindowType=function(n){return this._windowTypes.getByName(n)},n.prototype.registerWindowFactory=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){if(isUndefinedOrNull(n))i("no windowType specified");else{if(isObject(n))n=n.getName();else if(!isString(n))return void i("windowType should be string or object that has getName method");r._bridge.registerWindowFactory(n,e).then((function(n){t(n)})).catch((function(n){i(n)}))}})),t)},n.prototype.unregisterWindowFactory=function(n,e){var t=this;return nodeify(new Promise((function(e,r){isUndefinedOrNull(n)?r("no windowType specified"):isString(n)?t._bridge.unregisterWindowFactory(n).then((function(n){e(n)})).catch((function(n){r(n)})):r("windowType should be a string")})),e)},n.prototype.getActivities=function(n){var e=this._activities.get();if(e=e.filter((function(n){return n._ownerId})),!n)return e;var t=n;if(isString(n))t=[n];else if(n instanceof ActivityType)t=[n.name];else if(!(n instanceof Array))throw new Error("Invalid input argument 'activityType' = "+n);return e.filter((function(n){var e=n.type;return some(t,(function(n){return e.id===n.id}))}))},n.prototype.getActivityById=function(n){return this._activities.getByName(n)},n.prototype.announceWindow=function(n,e){var t=this;return new Promise((function(r,i){var o=t._bridge.getAnnouncementInfo();if(isUndefined(n)&&(n=o.activityWindowId),isUndefined(e)&&(e=o.activityWindowType),isUndefinedOrNull(e))throw new Error("Can not announce - unknown windowType");var l=o&&o.activityId;if(isUndefinedOrNull(n))t._logger.debug("Registering window with type:'"+e+"', name:'"+o.activityWindowName+"', ind.:'"+o.activityWindowIndependent+"'"),t._bridge.registerWindow(e,o.activityWindowName,o.activityWindowIndependent).then(t._windows.getOrWait.bind(t._windows)).then((function(n){return l?t._activities.getOrWait(l).then((function(e){return n})):n})).then((function(n){r(n)})).catch((function(n){t._logger.error(n)}));else{t._logger.debug("Announcing window with id '"+n+"' and type '"+e+"'");var u=t._windows.getByName(n);if(!isUndefinedOrNull(u))return t._logger.debug("Window with id '"+n+"' already announced - reusing the window"),void r(u);var s=function(e,o,l){n===o.id&&(l===EntityEventType.ActivityWindowJoinedActivity&&(isUndefined(o.activity)&&i("UNDEFINED ACTIVITY"),t._logger.trace("Got joined event for id '"+n+"'"),r(o),t.unsubscribeWindowEvents(s)))};t.subscribeWindowEvents(s),t._logger.trace("Waiting for joined event for id '"+n+"'"),t._bridge.announceWindow(e,n)}}))},n.prototype.subscribeWindowTypeEvents=function(n){this._windowTypes.subscribe((function(e,t){n(e,t.type)}))},n.prototype.subscribeActivityEvents=function(n){var e=this;return this._activities.subscribe((function(t,r){if(r.type===EntityEventType.StatusChange){var i=r;n(t,i.newStatus,i.oldStatus)}if(r.type===EntityEventType.Removed||r.type===EntityEventType.StatusChange&&r.newStatus.getState()===ActivityState.Destroyed)for(var o=0,l=e._windows.get();o<l.length;o++){var u=l[o];u.activity&&u.activity.id===t.id&&e._windows.process(new EntityEvent(u,new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)))}}))},n.prototype.subscribeWindowEvents=function(n){var e=function(e,t){var r=t.type;r===EntityEventType.Added&&(r="opened"),n(e.activity,e,r)};return this._windowHandlers.push([n,e]),this._windows.subscribe(e)},n.prototype.unsubscribeWindowEvents=function(n){var e=this._windowHandlers.find((function(e){return e[0]===n}));e&&(this._windowHandlers.splice(this._windowHandlers.indexOf(e),1),this._windows.unsubscribe(e[1]))},n.prototype.createWindow=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){var o,l;if(isUndefinedOrNull(e)&&i("windowType is undefined"),isString(e))o={type:e,name:"",isIndependent:!1,arguments:{}};else if(e instanceof WindowType)o={type:e.type||e.id,name:e.name||e.type||e.id,isIndependent:!1};else{var u=["url"],s={};Object.keys(e).forEach((function(n){-1===u.indexOf(n)&&(s[n]=e[n])})),o=s}if(!isUndefinedOrNull(o.relativeTo))if("string"==typeof(l=o.relativeTo))!isUndefinedOrNull(a=r.getWindows({type:l}))&&a.length>0&&(o.relativeTo=a[0].id);else if(isUndefinedOrNull(l.type))isUndefinedOrNull(l.windowId)||(o.relativeTo=l.windowId);else{var a;!isUndefinedOrNull(a=r.getWindows({type:l.type}))&&a.length>0&&(o.relativeTo=a[0].id)}r._bridge.createWindow(n&&n.id,o).then((function(e){r._logger.debug("Window created, waiting for window entity with id "+e);var i=function(o,l){o.id!==e||n&&!o.activity||(r._logger.debug("Got entity window with id "+e),t(o),r._windows.unsubscribe(i))};r._windows.subscribe(i)})).catch((function(n){i(n)}))})),t)},n.prototype.createStackedWindows=function(n,e,t,r){var i=this;return nodeify(new Promise((function(r,o){isUndefinedOrNull(n)&&o("activity is undefined"),isUndefinedOrNull(e)&&o("relativeWindowTypes is undefined"),Array.isArray(e)||o("relativeWindowTypes has to be an array"),isUndefinedOrNull(t)&&(t=2e4);var l=[];e.forEach((function(n){var e,r;if((e=isString(n)?{type:n,name:"",isIndependent:!1,arguments:{}}:n).stackedWindow=!0,e.timeout=t,!isUndefinedOrNull(e.relativeTo))if(isUndefinedOrNull((r=e.relativeTo).type)){if(!isUndefinedOrNull(r.windowId)){var o=i.getWindows({id:r.windowId});!isUndefinedOrNull(o)&&o.length>0&&(e.relativeTo=o[0].type.name)}}else e.relativeTo=r.type;l.push(e)}));var u=[];l.forEach((function(e){return u.push(i.createWindow(n,e))})),Promise.all(u).then(r).catch(o)})),r)},n.prototype.addWindowToActivity=function(n,e,t){var r=this._bridge.joinActivity(n.id,e.id).then((function(){return e}));return nodeify(r,t),r},n.prototype.leaveWindowFromActivity=function(n,e,t){var r=this._bridge.leaveActivity(n.id,e.id).then((function(){return e}));return nodeify(r,t),r},n.prototype.setActivityContext=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){isUndefinedOrNull(n)&&i("activity can not be null"),r._bridge.updateActivityContext(n,e,!0).then((function(e){t(n)})).catch((function(n){i(n)}))})),t)},n.prototype.updateActivityContext=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){isUndefinedOrNull(n)&&i("activity can not be null");var o=[];for(var l in e)e.hasOwnProperty(l)&&null===e[l]&&o.push(l);for(var u=0,s=o;u<s.length;u++){var a=s[u];delete e[a]}r._bridge.updateActivityContext(n,e,!1,o).then((function(e){t(n)})).catch((function(n){i(n)}))})),t)},n.prototype.subscribeActivityContextChanged=function(n){this._activities.subscribe((function(e,t){if(t.type===EntityEventType.ActivityContextChange){var r=t;n(e,r.context,r.updated,r.removed)}}))},n.prototype.stopActivity=function(n,e){return nodeify(this._bridge.stopActivity(n),e)},n.prototype.getWindows=function(n){return isUndefined(n)?this._windows.get():isUndefined(n.id)?this._windows.get().filter((function(e){if(!isUndefined(n.type)&&e.type.id!==n.type)return!1;if(!isUndefined(n.name)&&e.name!==n.name)return!1;if(!isUndefined(n.activityId)){if(isUndefinedOrNull(e.activity))return!1;if(e.activity.id!==n.activityId)return!1}return!0})):[this._windows.getByName(n.id)]},n.prototype.getWindowBounds=function(n){return this._bridge.getWindowBounds(n)},n.prototype.setWindowBounds=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){r._bridge.setWindowBounds(n,e).then((function(){return t()})).catch((function(n){return i(n)}))})),t)},n.prototype.closeWindow=function(n){return this._bridge.closeWindow(n)},n.prototype.activateWindow=function(n,e){return this._bridge.activateWindow(n,e)},n.prototype.setWindowVisibility=function(n,e){return this._bridge.setWindowVisibility(n,e)},n.prototype.clone=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){n||i("activity can not be null"),r._bridge.cloneActivity(n.id,e).then((function(n){r._activities.getOrWait(n).then((function(n){t(n)})).catch((function(n){return i(n)}))})).catch((function(n){return i(n)}))})),t)},n.prototype.attachActivities=function(n,e,t,r){var i=this;return t=t||{},nodeify(new Promise((function(r,o){if(i._activities.getByName(n)){if(i._activities.getByName(e))return i._bridge.attachActivities(n,e,t).then((function(n){var e=n.to,t=n.descriptor,o=n.descriptors;i._activities.getOrWait(e).then((function(n){n._updateDescriptors(o);var e=n.attached.filter((function(n){return n.ownerId===t.ownerId}))[0];r(e)}))})).catch((function(n){o(n)}));o("can not find activity with id "+e)}else o("can not find activity with id "+n)})),r)},n.prototype.detachActivities=function(n,e,t){var r=this;return nodeify(new Promise((function(t,i){return r._bridge.detachActivities(n,e).then((function(){r._activities.getOrWait(undefined).then((function(n){n._updateDescriptors(undefined),r._activities.getOrWait(undefined).then((function(n){t(n)}))})).catch((function(n){return i(n)}))})).catch((function(n){i(n)}))})),t)},n.prototype.subscribeActivitiesAttached=function(n){this._attachedCallbacks.push(n)},n.prototype.subscribeActivitiesDetached=function(n){this._detachedCallbacks.push(n)},n.prototype.subscribeActivityFrameColorChanged=function(n){this._frameColorChangesCallbacks.push(n)},n.prototype._grabEntity=function(n){n._manager=this},n.prototype._getInitialData=function(){var n=this;this._logger.debug("Request initial data..."),this._bridge.getActivityTypes().then((function(e){n._activityTypes.add(e),n._dataReadyMarker.signal("Got act types")})).catch((function(e){n._logger.error(e),n._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+e)})),this._bridge.getWindowTypes().then((function(e){n._windowTypes.add(e),n._dataReadyMarker.signal("Got window types")})).catch((function(e){n._logger.error(e),n._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+e)})),this._bridge.getActivities().then((function(e){n._activities.add(e),n._dataReadyMarker.signal("Got activities")})).catch((function(e){n._logger.error(e),n._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+e)})),this._bridge.getActivityWindows().then((function(e){n._windows.add(e),n._dataReadyMarker.signal("Got windows")})).catch((function(e){n._logger.error(e),n._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+e)}))},n.prototype._subscribeForData=function(){var n=this;this._logger.debug("Subscribe for data..."),this._bridge.onActivityTypeStatusChange((function(e){n._activityTypes.process(e)})),this._bridge.onWindowTypeStatusChange((function(e){n._windowTypes.process(e)})),this._bridge.onActivityWindowChange((function(e){n._windows.process(e)})),this._bridge.onActivityStatusChange((function(e){n._activities.process(e)}))},n.prototype._handleActivitiesAttached=function(n){var e=this,t=n.to,r=n.descriptor,i=n.descriptors;this._activities.getOrWait(t).then((function(n){n._updateDescriptors(i);var t=n.attached.filter((function(n){return n.ownerId===r.ownerId}))[0];e._attachedCallbacks.forEach((function(e){try{e(n,t)}catch(n){return}}))}))},n.prototype._handleActivitiesDetached=function(n){var e=this,t=n.oldActivityId,r=n.newActivityId,i=n.descriptors,o=n.descriptor;this._activities.getOrWait(t).then((function(n){n._updateDescriptors(i),e._activities.getOrWait(r).then((function(t){e._detachedCallbacks.forEach((function(e){try{e(t,n,o)}catch(n){return}}))}))}))},n.prototype._handleActivityDescriptorsRefreshed=function(n){var e=n.id,t=n.descriptors,r=this._activities.getByName(e);r&&r._updateDescriptors(t)},n.prototype.refreshDescriptors=function(){var n=this;this._bridge.getAttachedDescriptors().then((function(e){e&&Object.keys(e).forEach((function(t){var r=t,i=e[t],o=n._activities.getByName(r);o&&o._updateDescriptors(i)})),n._descriptorsMarker.signal("Successfully got descriptors")})).catch((function(e){n._descriptorsMarker.error("failed to get descriptors - "+e)}))},n.prototype._handleWindowFrameColorChanged=function(n){if(n.activityId){var e=this._activities.getByName(n.activityId);e&&e.owner&&e.owner.underlyingWindow.id===n.id&&this._frameColorChangesCallbacks.forEach((function(t){try{t(e,n.frameColor)}catch(n){return}}))}},n}(),ActivityManagementAPI=function(){function n(n,e){this._m=n,this._my=e,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:void 0,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:void 0},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:void 0,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:void 0}}return n.prototype.onAttached=function(n){this._m.subscribeActivitiesAttached(n)},n.prototype.onDetached=function(n){this._m.subscribeActivitiesDetached(n)},n.prototype.onActivityFrameColorChanged=function(n){this._m.subscribeActivityFrameColorChanged(n)},n.prototype._getActivityTypesWrapper=function(n){return isUndefined(n)?this._m.getActivityTypes():this._m.getActivityType(n)},n.prototype._getWindowTypesWrapper=function(n){return isUndefined(n)?this._m.getWindowTypes():this._m.getWindowType(n)},n}(),ActivityAPI=function(){function n(n,e){this._mgr=n,this._my=e,this.all=new ActivityManagementAPI(n,e)}return n.prototype.ready=function(n){var e=this;return nodeify(new Promise((function(n,t){e._mgr.ready().then((function(){n(e)})).catch((function(n){t(n)}))})),n)},Object.defineProperty(n.prototype,"my",{get:function(){return this._my},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"aware",{get:function(){return void 0!==this._my.window},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inActivity",{get:function(){return this.aware&&void 0!==this._my.activity},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"agm",{get:function(){if(this.aware)return this.inActivity?this._my.activity.agm:new ActivityAGM(null)},enumerable:!0,configurable:!0}),n.prototype.getAvailableFrameColors=function(){return[]},n}(),ActivityModule=function(){function n(e){var t,r=this;if(!e)throw new Error("config can not be null");if(isUndefined(e.logLevel)||(Logger$1.Level=e.logLevel),isUndefinedOrNull(e.logger)||(Logger$1.GlueLogger=e.logger),this._isUsingHCImplementation=2===e.gdMajorVersion,this._isUsingGW3Implementation=n.checkIsUsingGW3Implementation(e.connection),this._isUsingHCImplementation)throw new Error("GD2 not supported");if(!this._isUsingGW3Implementation)throw new Error("Unable to instantiate activity bridge implementation");if(!(t=new GW3Bridge$1(e)))throw new Error("A bridge to native activity is needed to create activity lib.");ActivityAGM.AGM=e.agm;var i=new ActivityManager(t,!e.disableAutoAnnounce,e.windows),o=new ActivityMy(i,e.windows);this._api=new ActivityAPI(i,o),this._readyPromise=i.ready().then((function(n){return r}))}return n.checkIsUsingGW3Implementation=function(n){return 3===n.protocolVersion},Object.defineProperty(n.prototype,"api",{get:function(){return this._api},set:function(n){this._api=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isUsingHCImplementation",{get:function(){return this._isUsingHCImplementation},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isUsingGW3Implementation",{get:function(){return this._isUsingGW3Implementation},enumerable:!0,configurable:!0}),n.prototype.ready=function(n){return nodeify(this._readyPromise,n)},n}(),ShutdownMethodName="T42.ACS.Shutdown",OnGDShutdownMethodName="T42.ACS.OnGDShutdown",RestartMethodName="T42.ACS.Restart",GetConfigurationRegionMethodName="T42.ACS.GetConfigurationRegion",SetConfigurationRegionMethodName="T42.ACS.SetConfigurationRegion",GetUserMethodName="T42.ACS.GetUser",GetBranchesMethodName="T42.ACS.GetBranches",GetCurrentBranchMethodName="T42.ACS.GetCurrentBranch",SetCurrentBranchMethodName="T42.ACS.SetCurrentBranch",GetFunctionalEntitlementMethodName="T42.ACS.GetFunctionalEntitlement",CanIMethodName="T42.ACS.CanI",StartApplicationMethodName="T42.ACS.StartApplication",StopApplicationMethodName="T42.ACS.StopApplication",ActivateApplicationMethodName="T42.ACS.ActivateApplication",OnEventMethodName="T42.ACS.OnEvent",GetApplicationsMethodName="T42.ACS.GetApplications";function createRegistry$1(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$1.default=createRegistry$1;var lib$2=createRegistry$1;function objectValues(n){return n?Object.keys(n).map((function(e){return n[e]})):[]}function objectClone(n){var e;try{e=JSON.parse(JSON.stringify(n||{}))}catch(n){e={}}return e}var ApplicationImpl=function(){function n(n,e,t){var r=this;this._appManager=n,this._name=e,this._agm=t,this._registry=lib$2(),n.onInstanceStarted((function(n){n.application&&n.application.name!==r._name||r._registry.execute("instanceStarted",n)})),n.onInstanceStopped((function(n){n.application&&n.application.name!==r._name||r._registry.execute("instanceStopped",n)})),n.onAppRemoved((function(n){n.name===r._name&&r._registry.execute("appRemoved",n)})),n.onAppChanged((function(n){n.name===r._name&&r._registry.execute("appChanged",n)})),n.onAppAvailable((function(n){n.name===r._name&&r._registry.execute("appAvailable",n)})),n.onAppUnavailable((function(n){n.name===r._name&&r._registry.execute("appUnavailable",n)}))}return Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this._props.Title},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"version",{get:function(){return this._props.Version},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoStart",{get:function(){return this._props.AutoStart},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isShell",{get:function(){return this._props.IsShell},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"caption",{get:function(){return this._props.Caption},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hidden",{get:function(){return this._props.IsHidden},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"container",{get:function(){return this._props.ApplicationName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activityType",{get:function(){return this._props.ActivityType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activityWindowType",{get:function(){return this._props.ActivityWindowType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"windowSettings",{get:function(){return this._props.Arguments?objectClone(this._props.Arguments):{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowMultiple",{get:function(){return this._props.AllowMultiple},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"available",{get:function(){return this._props.IsReady||!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"icon",{get:function(){return this._props.Icon},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"iconURL",{get:function(){return this._props.IconUrl},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sortOrder",{get:function(){return this._props.SortOrder},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"userProperties",{get:function(){return this._props.UserProperties?objectClone(this._props.UserProperties):{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActivity",{get:function(){return void 0!==this._props.ActivityType&&""!==this._props.ActivityType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"configuration",{get:function(){return{autoStart:this._props.AutoStart,caption:this._props.Caption,hidden:this._props.IsHidden,container:this._props.ApplicationName,activityType:this._props.ActivityType,allowMultiple:this._props.AllowMultiple}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"instances",{get:function(){var n=this;return this._appManager.instances().filter((function(e){return e.application.name===n._name}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._props.Type},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mode",{get:function(){if(!this._props)return"unknown";if(this._props.Mode&&"string"==typeof this._props.Mode)return this._props.Mode.toLowerCase();if(this.isActivity)return"unknown";if(this._props.Arguments&&this._props.Arguments.mode&&"string"==typeof this._props.Arguments.mode)return this._props.Arguments.mode.toLowerCase();var n=this._props.WindowStyleAttributes;if(n){var e='mode:"',t=(n=n.split(" ").join("")).indexOf(e);if(-1!==t){var r=t+e.length,i=n.indexOf('"',r),o=n.substr(r,i-r);if(o&&"string"==typeof o)return o.toLowerCase()}}return"flat"},enumerable:!0,configurable:!0}),n.prototype.updateFromProps=function(n){var e=this;this._props||(this._props={Name:n.Name}),Object.keys(n).forEach((function(t){e._props[t]=n[t]}))},n.prototype.start=function(n,e){var t=this,r=this._name;return new Promise((function(i,o){e=e||{},n=n||{};t._agm.invoke(StartApplicationMethodName,{Name:r,Context:n,Options:e},"best",{methodResponseTimeoutMs:1e4},(function(n){var e=n.returned&&n.returned.Instance_0?n.returned.Instance_0:n.returned;if(e&&e.Id)if("startOnly"===t._appManager.mode){var r=t._appManager.handleInstanceStarted(e);i(r)}else!function(n){var e,r=function(){var e,r=t._appManager.instances().filter((function(e){return e.id===n}));return(e=2===r.length?r[0].isActivityInstance?r[0]:r[1]:r[0])?e.agm?e:void 0:e},l=setTimeout((function(){e&&e(),o("timeout")}),1e4);e=t._appManager.onInstanceAgmServerReady((function(t){t.id===n&&(e&&(e(),e=void 0),clearTimeout(l),setTimeout((function(){i(r())}),1))}));var u=r();u&&(e&&(e(),e=void 0),clearTimeout(l),i(u))}(e.Id);else i(void 0)}),(function(n){o(n)}))}))},n.prototype.onInstanceStarted=function(n){this._registry.add("instanceStarted",n)},n.prototype.onInstanceStopped=function(n){this._registry.add("instanceStopped",n)},n.prototype.onAvailable=function(n){this._registry.add("appAvailable",n)},n.prototype.onUnavailable=function(n){this._registry.add("appUnavailable",n)},n.prototype.onChanged=function(n){this._registry.add("appChanged",n)},n.prototype.onRemoved=function(n){this._registry.add("appRemoved",n)},n}(),InstanceImpl=function(){function n(n,e,t,r,i,o,l){var u=this;this._id=n,this._appName=e,this._appManager=t,this._agm=r,this._activities=i,this._windows=o,this.onAgmReady=this._addToRegistry("agmReady"),this.onStopped=this._addToRegistry("stopped"),this._registry=lib$2(),l||(this._unsubscribeInstanceStopped=this._appManager.onInstanceStopped((function(n){n.id===u._id&&u._registry.execute("stopped",n)})),this._unsubscribeInstanceAgmServerReady=this._appManager.onInstanceAgmServerReady((function(n){n.id===u._id&&u._registry.execute("agmReady",n)})))}return Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"application",{get:function(){return this._appManager.application(this._appName)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activity",{get:function(){var n=this;if(!this._activities)throw new Error("This method requires glue.activities library to be enabled.");return this._activities.all.instances.get().filter((function(e){return e.id===n._activityId}))[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActivityOwner",{get:function(){return this._isActivityOwner},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activityInstances",{get:function(){var n=this;return this._appManager.instances().filter((function(e){return"activity"!==e.application.type&&e.activityId&&e.activityId===n._activityId}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activityOwnerInstance",{get:function(){if(this._activityId)return this.activityInstances.filter((function(n){var e;return null===(e=n)||void 0===e?void 0:e.isActivityOwner}))[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"window",{get:function(){var n=this;if(!this._windows)throw new Error("This method requires glue.windows library to be enabled.");var e=this._windows.list().filter((function(e){return e.id===n._id}))[0];return!e&&this.activity&&this.activityOwnerInstance&&(e=this.activityOwnerInstance.window),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"context",{get:function(){var n,e,t;return null!=(t=null!=(n=this._startUpContext)?n:null===(e=this.window)||void 0===e?void 0:e.context)?t:{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActivityInstance",{get:function(){return this._isActivityInstance},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activityId",{get:function(){return this._activityId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inActivity",{get:function(){return this._inActivity},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isSingleWindowApp",{get:function(){return!this._inActivity},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"agm",{get:function(){return this._agmInstance},enumerable:!0,configurable:!0}),n.prototype.updateFromProps=function(n){this._startUpContext=n.Context,this._title=n.Title,this._isActivityInstance=!1,n.ActivityId&&""!==n.ActivityId&&(this._activityId=n.ActivityId,this._isActivityInstance=!0),this._isActivityOwner=n.IsActivityOwner,!this._activityId&&this._startUpContext&&this._startUpContext.activityId&&(this._activityId=this._startUpContext.activityId),this._inActivity=Boolean(this._activityId),this.updateAgmInstanceFromProps(n)},n.prototype.updateAgmInstanceFromProps=function(n){if(n.AgmServers)if(n.GD3){var e=n.AgmServers;e&&(this._agmInstance=e[0])}else{var t=n.AgmServers,r=Object.keys(t)[0];if(!r)return;var i=t[r];this._agmInstance={machine:i.machineName,user:i.userName,environment:i.environment,application:i.applicationName}}},n.prototype.stop=function(){var n=this;return new Promise((function(e,t){var r=n._appManager.onInstanceStopped((function(t){t.id===n._id&&(r(),e())}));n._agm.invoke(StopApplicationMethodName,{Name:n._appName,Id:n._id}).then((function(){"startOnly"===n._appManager.mode&&(n._appManager.handleInstanceStopped({Name:n._appName,Id:n.id,Context:void 0,Title:void 0,ActivityId:void 0,IsActivityOwner:void 0,AgmServers:void 0}),e())})).catch((function(n){return t(n)}))}))},n.prototype.activate=function(){return this._agm.invoke(ActivateApplicationMethodName,{Name:this._appName,Id:this._id})},n.prototype.done=function(){this._registry.clear(),this._unsubscribeInstanceAgmServerReady(),this._unsubscribeInstanceStopped()},n.prototype.getContext=function(){return Promise.resolve(this.context)},n.prototype._addToRegistry=function(n){var e=this;return function(t){e._registry.add(n,t)}},n}(),AppManagerImpl=function(){function n(n,e,t,r,i,o){var l=this;this.mode=n,this._agm=e,this._activities=t,this._windows=r,this._logger=i,this._gdMajorVersion=o,this._apps={},this._instances=[],this._registry=lib$2(),this.application=function(n){return l._apps[n]},this.applications=function(){return Object.keys(l._apps).map((function(n){return l._apps[n]}))},this.instances=function(){return l._instances},this.getMyInstance=function(){if(l._gdMajorVersion>=3){var n=window.glue42gd.appInstanceId;return l._instances.filter((function(e){return e.id===n}))[0]}},this.handleAppAdded=function(n){var e=l._getAppId(n);l._logger.trace("adding app "+e),l._apps[e]=new ApplicationImpl(l,e,l._agm);var t=l._updateAppFromProps(n);l._registry.execute("appAdded",t)},this.handleAppUpdated=function(n){var e=l._updateAppFromProps(n);l._registry.execute("appChanged",e)},this.handleAppRemoved=function(n){var e=l._getAppId(n);l._logger.trace("removing app "+e);var t=l.application(e);l._instances=l._instances.filter((function(n){return n.application.name!==t.name})),delete l._apps[e],l._registry.execute("appRemoved",t)},this.handleAppReady=function(n){var e=l._getAppId(n),t=l._getAppOrThrow(e);t.updateFromProps(n),t.available?l._registry.execute("appAvailable",t):l._registry.execute("appUnavailable",t)},this.handleInstanceStarted=function(n){l._logger.trace("started app "+n.Name+" "+n.Id);var e=l._getInstanceId(n),t=l._getInstanceAppName(n),r=new InstanceImpl(e,t,l,l._agm,l._activities,l._windows);return l._updateInstanceFromProps(r,n),l._instances.push(r),l._registry.execute("instanceStarted",r),r},this.handleInstanceStopped=function(n){l._logger.trace("failed to start app "+n.Name+" "+n.Id);var e=l._getInstanceId(n),t=l._getInstanceAppName(n),r=l._getInstanceOrThrow(e,t);l._instances=l._instances.filter((function(n){return!l._matchInstance(n,e,t)})),l._registry.execute("instanceStopped",r),r.done()},this.handleInstanceAgmServerReady=function(n){var e=l._getInstanceId(n),t=l._getInstanceAppName(n),r=l._getInstanceOrThrow(e,t);r.updateAgmInstanceFromProps(n),l._registry.execute("instanceAgmServerReady",r)},this.handleInstanceStartFailed=function(n){var e=l._getInstanceId(n),t=l._getInstanceAppName(n),r=new InstanceImpl(e,t,void 0,void 0,void 0,void 0,!0);l._updateInstanceFromProps(r,n),l._registry.execute("instanceStartFailed",r)},this.handleInstanceUpdated=function(n){var e=l._getInstanceId(n),t=l._getInstanceAppName(n),r=l._getInstanceOrThrow(e,t);l._updateInstanceFromProps(r,n)},this.onInstanceStarted=function(n){return l._registry.add("instanceStarted",n,l._instances)},this.onInstanceStartFailed=function(n){return l._registry.add("instanceStartFailed",n)},this.onInstanceStopped=function(n){return l._registry.add("instanceStopped",n)},this.onInstanceUpdated=function(n){return l._registry.add("instanceChanged",n)},this.onInstanceAgmServerReady=function(n){return l._registry.add("instanceAgmServerReady",n)},this.onAppAdded=function(n){return l._registry.add("appAdded",n,Object.values(l._apps))},this.onAppRemoved=function(n){return l._registry.add("appRemoved",n)},this.onAppAvailable=function(n){return l._registry.add("appAvailable",n)},this.onAppUnavailable=function(n){return l._registry.add("appUnavailable",n)},this.onAppChanged=function(n){return l._registry.add("appChanged",n)}}return n.prototype._getAppOrThrow=function(n){var e=this.application(n);if(!e)throw Error("app with id "+n+" not found");return e},n.prototype._getAppId=function(n){return n.Name},n.prototype._matchInstance=function(n,e,t){return n.id===e&&n.application.name===t},n.prototype._getInstanceByIdAndName=function(n,e){var t=this;return this._instances.filter((function(r){return t._matchInstance(r,n,e)}))[0]},n.prototype._getInstanceOrThrow=function(n,e){var t=this._getInstanceByIdAndName(n,e);if(!t)throw Error("instance with id "+n+" not found");return t},n.prototype._getInstanceId=function(n){return n.Id},n.prototype._getInstanceAppName=function(n){return n.Name},n.prototype._updateAppFromProps=function(n){var e=this._getAppId(n);this._logger.trace("updating app with  + "+e+", "+n);var t=this._getAppOrThrow(e);return t.updateFromProps(n),t},n.prototype._updateInstanceFromProps=function(n,e){this._logger.trace("updating instance with "+this._getInstanceId(e)+" for app "+this._getInstanceAppName(e)),n.updateFromProps(e)},n}();function promisify$2(n,e,t){var r=function(n){return!!(n&&n.constructor&&n.call&&n.apply)};if(!r(e)&&!r(t))return n;r(e)?r(t)||(t=function(){}):e=function(){},n.then(e,t)}var EntitlementsImpl=function(){function n(n){var e=this;this._agm=n,this._registry=lib$2(),this._isMethodRegistered=!1,this.handleBranchModified=function(n){e._registry.execute("branchChanged",n)},this.handleBranchesModified=function(n){e._registry.execute("branchesChanged",n)},this.getRegion=function(n,t){return promisify$2(e._agmInvoke(GetConfigurationRegionMethodName,(function(n){return n.returned.Region})),n,t)},this.getBranches=function(n,t){return promisify$2(e._agmInvoke(GetBranchesMethodName,(function(n){var e=n.returned.Branches;return Object.keys(e).map((function(n){return e[n]}))})),n,t)},this.getCurrentBranch=function(n,t){return promisify$2(e._agmInvoke(GetCurrentBranchMethodName,(function(n){return n.returned.Branch}),void 0),n,t)},this.setRegion=function(n,t,r){return promisify$2(e._agmInvoke(SetConfigurationRegionMethodName,(function(n){return n.returned.ResultMessage}),{Region:n}),t,r)},this.setCurrentBranch=function(n,t,r){return promisify$2(e._agmInvoke(SetCurrentBranchMethodName,(function(n){return n.returned.ResultMessage}),{Branch:n}),t,r)},this.currentUser=function(n,t){return promisify$2(e._agmInvoke(GetUserMethodName),n,t)},this.getFunctionalEntitlement=function(n,t,r){return promisify$2(e._agmInvoke(GetFunctionalEntitlementMethodName,(function(n){return n.returned.Entitlement}),{Function:n}),t,r)},this.getFunctionalEntitlementBranch=function(n,t,r,i){return promisify$2(e._agmInvoke(GetFunctionalEntitlementMethodName,(function(n){return n.returned.Entitlement}),{Function:n,Branch:t}),r,i)},this.canI=function(n,t,r){return promisify$2(e._agmInvoke(CanIMethodName,(function(n){return n.returned.Result}),{Function:n}),t,r)},this.canIBranch=function(n,t,r,i){return promisify$2(e._agmInvoke(CanIMethodName,(function(n){return n.returned.Result}),{Function:n,Branch:t}),r,i)},this.onBranchesChanged=function(n){return e._registry.add("branchesChanged",n)},this.onBranchChanged=function(n){return e._registry.add("branchChanged",n)},this.exit=function(n){return e._agmInvoke(ShutdownMethodName,null,n)},this.onShuttingDown=function(n){return e.registerMethod(),e._registry.add("onShuttingDown",n)},this.restart=function(n){return e._agmInvoke(RestartMethodName,null,n)},this._agmInvoke=function(n,t,r){return r=r||{},new Promise((function(i,o){e._agm.invoke(n,r).then((function(n){t||(t=function(n){return n.returned}),i(t(n))})).catch((function(n){return o(n)}))}))}}return n.prototype.registerMethod=function(){var n=this;this._isMethodRegistered||(this._agm.register(OnGDShutdownMethodName,(function(e){return __awaiter$1(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Promise.all(this._registry.execute("onShuttingDown",e))];case 1:return n.sent(),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))}))})),this._isMethodRegistered=!0)},n}();function snapshot(n,e){return new Promise((function(t,r){n.invoke(GetApplicationsMethodName,{skipIcon:!0}).then((function(n){var r=n.returned;r||t();var i=r.applications;i||t(),objectValues(i).map((function(n){return e.handleAppAdded(n)})),t()})).catch((function(n){return r("Error getting application snapshot: "+n.message)}))}))}var OnBranchChangedEvent="OnBranchChanged",OnBranchesModifiedEvent="OnBranchesModified",OnApplicationAddedEvent="OnApplicationAdded",OnApplicationRemovedEvent="OnApplicationRemoved",OnApplicationChangedEvent="OnApplicationChanged",OnApplicationReadyEvent="OnApplicationReady",OnApplicationStartedEvent="OnApplicationStarted",OnApplicationAgmServerReadyEvent="OnApplicationAgmServerReady",OnApplicationUpdatedEvent="OnApplicationUpdated",OnApplicationStoppedEvent="OnApplicationStopped",OnApplicationStartFailedEvent="OnApplicationStartFailed";function createDataSubscription(n,e,t,r){var i;return{start:function(){var o,l,u=new Promise((function(n,e){o=n,l=e}));return n.subscribe(OnEventMethodName,{arguments:{skipIcon:r},waitTimeoutMs:1e4}).then((function(n){(i=n).onData((function(n){var r=n.data;objectValues(r[OnApplicationAddedEvent]).map((function(n){return e.handleAppAdded(n)})),objectValues(r[OnApplicationChangedEvent]).map((function(n){return e.handleAppUpdated(n)})),objectValues(r[OnApplicationRemovedEvent]).map((function(n){return e.handleAppRemoved(n)})),objectValues(r[OnApplicationReadyEvent]).map((function(n){return e.handleAppReady(n)})),objectValues(r[OnApplicationStartedEvent]).map((function(n){return e.handleInstanceStarted(n)})),objectValues(r[OnApplicationStartFailedEvent]).map((function(n){return e.handleInstanceStartFailed(n)})),objectValues(r[OnApplicationStoppedEvent]).map((function(n){return e.handleInstanceStopped(n)})),objectValues(r[OnApplicationUpdatedEvent]).map((function(n){return e.handleInstanceUpdated(n)})),objectValues(r[OnApplicationAgmServerReadyEvent]).map((function(n){return e.handleInstanceAgmServerReady(n)})),objectValues(r[OnBranchChangedEvent]).map((function(n){return t.handleBranchModified(n)})),objectValues(r[OnBranchesModifiedEvent]).map((function(n){return t.handleBranchesModified(n)})),o()})),i.onFailed((function(n){return l(n)}))})).catch((function(n){return l("Error subscribing for "+OnEventMethodName+" stream. Err: "+n)})),u},stop:function(){i&&i.close()}}}var AppManagerFactory=function(n){if(!n)throw Error("config not set");if(!n.agm)throw Error("config.agm is missing");var e="startOnly",t="skipIcons",r=n.mode||e;if(r!==e&&r!==t&&"full"!==r)throw new Error("Invalid mode for appManager lib - "+r+" is not supported");var i,o=n.activities,l=n.agm,u=n.logger,s=n.windows,a=new AppManagerImpl(r,l,o,s,u.subLogger("applications"),n.gdMajorVersion),c=new EntitlementsImpl(l);if(r===e)i=snapshot(l,a);else{var d=createDataSubscription(l,a,c,r===t);i=d.start()}return{ready:function(){return i},applications:a.applications,application:a.application,onAppAdded:a.onAppAdded,onAppRemoved:a.onAppRemoved,onAppChanged:a.onAppChanged,onAppAvailable:a.onAppAvailable,onAppUnavailable:a.onAppUnavailable,instances:a.instances,get myInstance(){return a.getMyInstance()},onInstanceStarted:a.onInstanceStarted,onInstanceStopped:a.onInstanceStopped,onInstanceUpdated:a.onInstanceUpdated,onInstanceStartFailed:a.onInstanceStartFailed,getRegion:c.getRegion,getBranches:c.getBranches,getCurrentBranch:c.getCurrentBranch,getFunctionalEntitlement:c.getFunctionalEntitlement,getFunctionalEntitlementBranch:c.getFunctionalEntitlementBranch,setCurrentBranch:c.setCurrentBranch,setRegion:c.setRegion,currentUser:c.currentUser,canI:c.canI,canIBranch:c.canIBranch,onBranchesChanged:c.onBranchesChanged,exit:c.exit,restart:c.restart,onShuttingDown:c.onShuttingDown}},WindowStore=function(){function n(){this.waitForTimeoutInMilliseconds=6e4,this._windows={},this._pendingWindows={},this._pendingWindowsStates={},this._registry=lib$2()}return n.prototype.init=function(n){this._logger=n},n.prototype.get=function(n){return this._windows[n]||this._pendingWindows[n]},n.prototype.getIfReady=function(n){return this._windows[n]},Object.defineProperty(n.prototype,"list",{get:function(){return this._windows},enumerable:!0,configurable:!0}),n.prototype.add=function(n){if(!!this._pendingWindows[n.API.id])this._logger.error("trying to add window with id "+n.API.id+" from windowStore, which already exists");else{var e="remote"===n.API.windowType;this._pendingWindows[n.API.id]=n,this._pendingWindowsStates[n.API.id]={ready:!1,urlChanged:e},this._registry.execute("on-added",n)}},n.prototype.remove=function(n){delete this._windows[n.API.id],delete this._pendingWindows[n.API.id],delete this._pendingWindowsStates[n.API.id],this._registry.execute("on-removed",n)},n.prototype.setReadyState=function(n){var e=this._pendingWindowsStates[n];void 0!==e&&(e.ready=!0,e.urlChanged&&this.markReadyToShow(n))},n.prototype.setUrlChangedState=function(n){var e=this._pendingWindowsStates[n];void 0!==e&&(e.urlChanged=!0,e.ready&&this.markReadyToShow(n))},n.prototype.waitFor=function(n){var e=this;return new Promise((function(t,r){var i,o=setTimeout((function(){i(),r("waitFor timed out.")}),e.waitForTimeoutInMilliseconds),l=e._windows[n];l?(clearTimeout(o),t(l)):i=e.onReadyWindow((function(e){e.API.id===n&&(clearTimeout(o),i(),t(e))}))}))},n.prototype.onReadyWindow=function(n){return this._registry.add("on-ready",n)},n.prototype.onAdded=function(n){return this._registry.add("on-added",n)},n.prototype.onRemoved=function(n){return this._registry.add("on-removed",n)},n.prototype.markReadyToShow=function(n){this._pendingWindows[n]&&(this._windows[n]=this._pendingWindows[n],delete this._pendingWindows[n],delete this._pendingWindowsStates[n]),this._registry.execute("on-ready",this._windows[n])},n}(),windowStore=new WindowStore,Utils$1=function(){function n(){}return n.getGDMajorVersion=function(){if("undefined"==typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;var n=Number(window.glueDesktop.version.substr(0,1));return isNaN(n)?-1:n},n.callbackifyPromise=function(n,e,t){var r=function(n){var e=n;if(n instanceof Error&&(e=n.message),"function"!=typeof t)return Promise.reject(e);t(e)};try{return n().then((function(n){return"function"==typeof e&&e(n),n})).catch((function(n){return r(n)}))}catch(n){return r(n)}},n.getMonitor=function(n,e){var t=this;return e.map((function(e){var r=e.left,i=e.top,o=e.workingAreaWidth,l=e.workingAreaHeight;return{monitor:e,totalOverlap:t.calculateTotalOverlap({left:r,top:i,width:o,height:l},n)}})).sort((function(n,e){return e.totalOverlap-n.totalOverlap}))[0].monitor},n.getDisplayCenterOfScreen=function(n,e){var t=Math.floor(Math.max(e.left,e.left+(e.workingAreaWidth-n.width)/2));return{top:Math.floor(Math.max(e.top,e.top+(e.workingAreaHeight-n.height)/2)),left:t}},n.calculateTotalOverlap=function(n,e){var t=n.left,r=n.top,i=t+n.width,o=r+n.height,l=e.left,u=e.top,s=l+e.width,a=u+e.height;return Math.max(0,Math.min(i,s)-Math.max(t,l))*Math.max(0,Math.min(o,a)-Math.max(r,u))},n}(),windowFactory=function(n,e,t,r,i,o,l,u){var s,a,c=null!=u?u:lib$2(),d=r.subLogger("window "+n),h=e.name,f=e.mode,p=e.url,g=e.title,w=e.context||{},v=e.bounds,m=e.frameColor,y=e.focus,b=e.neighbours||{},$=e.groupId,_=e.isGroupHeaderVisible,S=e.isTabHeaderVisible,I=e.isTabSelected,C=e.settings,R=e.isVisible,A=e.isSticky,E=e.isCollapsed,D=e.state,x=e.tabGroupId,T=e.isLocked,k=[],O=e.zoomFactor,M=e.placementSettings;function j(n,e,r){return new Promise((function(i,o){var l,u,s=nn(n,v),c=!1,d=function(){c||(c=!0,"function"==typeof e&&e(a),i(a),u&&(u(),u=void 0),l&&(clearTimeout(l),l=void 0))};s||(u=U((function(e){e.id===a.id&&nn(n,e.bounds)&&d()}))),t.moveResize(a,n).then((function(){s?d():l=setTimeout((function(){d()}),1e3)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))}function N(e,r,i){return new Promise((function(o,l){t.setVisible(a,e).then((function(){var t=void 0===e?!0===R:R===e;if(t)return"function"==typeof r&&r(a),o(a);var i=B((function(l){t=void 0===e?!0===l.isVisible:l.isVisible===e,l.id===n&&t&&("function"==typeof r&&r(a),i(),o(a))}))})).catch((function(n){"function"==typeof i&&i(n),l(n)}))}))}function Q(n,e,r){return new Promise((function(i,o){t.updateContext(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))}function P(){return new Promise((function(n){var e=V((function(t){t.id===a.id&&(e(),n())}))}))}function G(n){return c.add("onUrlChanged",n)}function W(n){return E&&n(a),c.add("collapsed",n)}function q(n){return E||n(a),c.add("expanded",n)}function J(n){return"maximized"===D&&n(a),c.add("maximized",n)}function L(n){return"minimized"===D&&n(a),c.add("minimized",n)}function z(n){return"normal"===D&&n(a),c.add("normal",n)}function F(n){return c.add("detached",n)}function B(n){return c.add("visibility-changed",n)}function V(n){return c.add("lock-changed",n)}function U(n){return c.add("bounds-changed",n)}function H(n){return c.add("tab-header-visibility-changed",n)}function X(n){return c.add("group-changed",n)}function K(n){var e=b[n];if(void 0!==e)return e.reduce((function(n,e){var t=windowStore.get(e);return t&&n.push(t.API),n}),[])}function Z(){if(w._APPLICATION_NAME)return w._APPLICATION_NAME;if(w&&w._t42&&w._t42.application)return w._t42.application;var n=Y();return n?n.applicationName:void 0}function Y(){if("undefined"!=typeof window&&window.glue42gd&&window.glue42gd.getWindowInfo){var e=window.glue42gd.getWindowInfo(n);return e||void 0}}function nn(n,e){var t=n.height,r=n.width;n.height<C.minHeight&&(t=C.minHeight),n.height>C.maxHeight&&(t=C.maxHeight),n.width<C.minWidth&&(r=C.minWidth),n.width>C.maxWidth&&(r=C.maxWidth);var i=!t||e.height===t,o=!r||e.width===r,l=!n.left||e.left===n.left,u=!n.top||e.top===n.top;return i&&o&&l&&u}var en={handleWindowClose:function(){void 0!==a.id&&(a.id=void 0,c.execute("onClose",a))},handleWindowChangeState:function(n){"collapsed"===n?E=!0:"expanded"===n?E=!1:D=n,c.execute(n,a)},handleTitleChanged:function(n){g=n,c.execute("onTitleChanged",n,a)},handleVisibilityChanged:function(n){n!==R&&(R=n,c.execute("visibility-changed",a))},handleUrlChanged:function(n){p=n,c.execute("onUrlChanged",n,a)},handleWindowSettingsChanged:function(n){C=n,c.execute("settings-changed",a)},handleContextUpdated:function(n){w=n,c.execute("context-updated",w,a)},handleFrameIsLockedChanged:function(n){T=n,c.execute("lock-changed",a)},handleBoundsChanged:function(n){v.top===n.top&&v.left===n.left&&v.width===n.width&&v.height===n.height||(v.top=n.top,v.left=n.left,v.width=n.width,v.height=n.height,c.execute("bounds-changed",a))},handleFocusChanged:function(n){y=n,c.execute("focus-changed",a)},handleFrameButtonAdded:function(n){var e=["buttonId","imageBase64","order","tooltip"].reduce((function(e,t){return e[t]=n[t],e}),{});-1===k.map((function(n){return n.buttonId})).indexOf(n.buttonId)&&k.push(e),c.execute("onFrameButtonAdded",e,a)},handleFrameButtonRemoved:function(n){var e;k=k.reduce((function(t,r){return r.buttonId===n?e=r:t.push(r),t}),[]),void 0!==e&&c.execute("onFrameButtonRemoved",e,a)},handleFrameButtonClicked:function(n){var e=k.filter((function(e){return e.buttonId===n.buttonId}));e.length>0&&c.execute("onFrameButtonClicked",e[0],a)},handleFrameColorChanged:function(n){m=n,c.execute("frame-color-changed",a)},handleFrameAttached:function(n,e){x=n,S=e,c.execute("frame-attached",a)},handleFrameSelectionChanged:function(e,t){var r;void 0!==e&&e===n?(I=!0,r=a):(I=!1,r=windowStore.get(e)?windowStore.get(e).API:void 0);var i=windowStore.get(t)?windowStore.get(t).API:void 0;if(I&&i)var o=i.onTabSelectionChanged((function(n,e){(e&&e.id)===i.id&&(o(),c.execute("tab-selection-changed",r,i,a))}));else c.execute("tab-selection-changed",r,i,a)},handleCompositionChanged:function(n,e){b=n||{},$=e,a.groupId!==e&&c.execute("group-changed",a)},handleGroupHeaderVisibilityChanged:function(n){_=n},handleTabHeaderVisibilityChanged:function(n){S!==n&&(S=n,c.execute("tab-header-visibility-changed",a))},handleGroupChanged:function(e,t){d.trace("handle group changed to win: "+n+" with group id: "+e.id),s=e,$=e.id,c.execute("group-changed",a,e,t)},handleGroupAssociation:function(e){e&&d.trace("setting group to win: "+n+" with group id: "+e.id),s=e},handleAttached:function(n,e){x=n,S=e,c.execute("attached",a)},handleDetached:function(e){x=e;var t=c.add("frame-attached",(function(e){e.id===n&&(t(),c.execute("detached",a))}))},handleWindowAttached:function(n){c.execute("window-attached",n)},handleWindowDetached:function(n){c.execute("window-detached",n)},handleZoomFactorChanged:function(n){O=n,c.execute("zoom-factor-changed",a)},handleIsStickyChanged:function(n){A=n,c.execute("sticky-changed",n,a)},handlePlacementSettingsChanged:function(n){var e,t=n;if(t.display){var r=o();if(r){var i=t.display-1;e=new Promise((function(n,e){r.all().then((function(e){var t=e.find((function(n){return n.index===i}));n(t)})).catch(e)}))}else e=Promise.resolve(void 0)}else e=Promise.resolve(void 0);e.then((function(n){t.display=n,M=t,c.execute("placementSettingsChanged",a)}))}};return{API:a={get name(){return h},get application(){var n=i();return n?n.application(Z()):void 0},get hostInstance(){return t.hostInstance},get agmInstance(){var n=this;if("undefined"!=typeof window&&window.glue42gd)return l.servers().find((function(e){return e.windowId===n.id}));var e=Z();return e?{application:e}:void 0},get url(){return p},id:n,get title(){return g},get windowStyleAttributes(){return C},get settings(){return C},get tabGroupId(){return"tab"===f.toLowerCase()?x:void 0},get frameButtons(){return k},get mode(){return f},get state(){return D},get isCollapsed(){return E},get isVisible(){return R},get isLocked(){return T},get context(){return w},get bounds(){return v},get minHeight(){return C.minHeight},get maxHeight(){return C.maxHeight},get minWidth(){return C.minWidth},get maxWidth(){return C.maxWidth},get isFocused(){return y},get frameColor(){return m},get opened(){return void 0!==a.id},get group(){return s},get groupId(){return $},get isSticky(){return A},get topNeighbours(){return K("top")},get leftNeighbours(){return K("left")},get rightNeighbours(){return K("right")},get bottomNeighbours(){return K("bottom")},get isGroupHeaderVisible(){return _},get activityId(){if(w._t42)return w._t42.activityId;var n=Y();return n?n.activityId:void 0},get activityWindowId(){if(w._t42)return w._t42.activityWindowId;var n=Y();return n?n.activityWindowId:void 0},get windowType(){return e.windowType||"electron"},get zoomFactor(){return O},get screen(){if("undefined"!=typeof window&&window.glue42gd)return Utils$1.getMonitor(a.bounds,window.glue42gd.monitors)},get placementSettings(){return Object.assign({},M)},maximize:function(e,r){return new Promise((function(i,o){t.maximize(a).then((function(){if("maximized"===D)return"function"==typeof e&&e(a),i(a);var t=J((function(r){r.id===n&&"maximized"===r.state&&("function"==typeof e&&e(a),t(),i(a))}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},restore:function(e,r){return new Promise((function(i,o){t.restore(a).then((function(){if("normal"===D)return"function"==typeof e&&e(a),i(a);var t=z((function(r){n===r.id&&"normal"===r.state&&("function"==typeof e&&e(a),t(),i(a))}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},minimize:function(e,r){return new Promise((function(i,o){t.minimize(a).then((function(){if("minimized"===D)return"function"==typeof e&&e(a),i(a);var t=L((function(r){if(n===r.id&&"minimized"===r.state)return"function"==typeof e&&e(a),t(),i(a)}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},maximizeRestore:function(n,e){return new Promise((function(r,i){var o="normal"===D?J:z;t.maximizeRestore(a).then((function(){var e=o((function(){"function"==typeof n&&n(a),e&&e(),r(a)}))})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},collapse:function(e,r){return new Promise((function(i,o){if(E)return"function"==typeof e&&e(a),i(a);t.collapse(a).then((function(){if(E)return"function"==typeof e&&e(a),i(a);var t=W((function(r){r.id===n&&("function"==typeof e&&e(a),t(),i(a))}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},expand:function(e,r){return new Promise((function(i,o){if(!E)return"function"==typeof e&&e(a),i(a);t.expand(a).then((function(){if(!E)return"function"==typeof e&&e(a),i(a);var t=q((function(r){r.id===n&&("function"==typeof e&&e(a),t(),i(a))}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},toggleCollapse:function(e,r){return new Promise((function(i,o){var l=E?q:W;t.toggleCollapse(a).then((function(){l((function(t){t.id===n&&("function"==typeof e&&e(a),i(a))}))})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},focus:function(n,e){return new Promise((function(r,i){t.focus(a).then((function(){"function"==typeof n&&n(a),r(a)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},activate:function(n,e){return new Promise((function(r,i){t.activate(a).then((function(){"function"==typeof n&&n(a),r(a)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},moveResize:j,setTitle:function(n,e,r){return new Promise((function(i,o){t.setTitle(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},setStyle:function(n,e,r){if(!n||0===Object.keys(n).length||Object.keys(n).every((function(n){return!n})))return r(i="Invalid style arguments: "+JSON.stringify(n)),Promise.reject(new Error(i));if(n&&void 0!==n.focus){var i;if("boolean"!=typeof n.focus)return r(i="Focus must be boolean. Currently only focus true is supported ! "+JSON.stringify(n)),Promise.reject(new Error(i));!1===n.focus&&d.warn("Focus false is not supported ! ")}return n&&void 0!==n.hidden&&"boolean"!=typeof n.hidden?(r(i="Hidden must be boolean ! provided: "+JSON.stringify(n)),Promise.reject(new Error(i))):Utils$1.callbackifyPromise((function(){return t.setStyle(a,n)}),e,r)},setOnTop:function(n,e,r){if(this.onTop===n){var i="OnTop setting is already set to '"+n+"'";return r(i),Promise.reject(new Error(i))}return Utils$1.callbackifyPromise((function(){return t.setOnTop(a,n)}),e,r)},resetButtons:function(n,e,r){return Utils$1.callbackifyPromise((function(){return t.resetButtons(a,n)}),e,r)},setSizeConstraints:function(n,e,r){if(!n||Object.keys(n).every((function(n){return void 0===n}))){var i="Invalid Constraints: "+JSON.stringify(n);return r(i),Promise.reject(new Error(i))}return Utils$1.callbackifyPromise((function(){return t.setSizeConstraints(a,n)}),e,r)},navigate:function(e,r,i){return new Promise((function(o,l){t.navigate(a,e).then((function(){if(e===p)return"function"==typeof r&&r(a),o(a);var t=G((function(e,i){i.id===n&&e===i.url&&("function"==typeof r&&r(a),t(),o(a))}))})).catch((function(n){"function"==typeof i&&i(n),l(n)}))}))},addFrameButton:function(n,e,r){return new Promise((function(i,o){return void 0===n?"function"==typeof r?void r("No button info"):void o("No button info"):void 0===n.buttonId?"function"==typeof r?void r("No buttonId"):void o("No buttonId"):void 0===n.imageBase64?"function"==typeof r?void r("No imageBase64"):void o("No imageBase64"):void t.addFrameButton(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},removeFrameButton:function(n,e,r){return new Promise((function(i,o){if(void 0===n||""===n)return"function"==typeof r?void r("No buttonId"):void o("No buttonId");t.removeFrameButton(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},setVisible:N,show:function(){return N(!0)},hide:function(){return N(!1)},center:function(n){return j(Utils$1.getDisplayCenterOfScreen(a.bounds,n||a.screen))},close:function(n,e){return new Promise((function(r,i){t.close(a).then((function(){"function"==typeof n&&n(a),r(a)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},snap:function(n,e,r,i){var o,l;if(!n)return Promise.reject("Please specify a target window! calledWith: "+n);if("string"==typeof n){var u=windowStore.get(n);if(!u)return Promise.reject(new Error("Invalid target parameter or no such window. Invoked with:  "+n));o=u.API.group}else o=n.group;return Promise.all([(l=o,new Promise((function(n,e){var t=l.onWindowAdded((function(e,r){a.id===r.id&&(t(),n())}))}))),t.snap(a,n,e)]).then((function(){return"function"==typeof r&&r(a),a})).catch((function(n){return"function"==typeof i&&i(n),n}))},showLoader:function(n){return new Promise((function(e,r){t.showLoader(a,n).then((function(){e(a)})).catch((function(n){r(n)}))}))},hideLoader:function(){return new Promise((function(n,e){t.hideLoader(a).then((function(){n(a)})).catch((function(n){e(n)}))}))},updateContext:Q,lock:function(n,e){return a.isLocked?("function"==typeof n&&n(a),Promise.resolve(a)):new Promise((function(r,i){t.lock(a).then((function(){return P()})).then((function(){"function"==typeof n&&n(a),r(a)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},unlock:function(n,e){return a.isLocked?new Promise((function(r,i){t.unlock(a).then((function(){return P()})).then((function(){"function"==typeof n&&n(a),r(a)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))})):("function"==typeof n&&n(a),Promise.resolve(a))},getIcon:function(n,e){return new Promise((function(r,i){t.getIcon(a).then((function(e){"function"==typeof n&&n(e),r(e)})).catch((function(n){"function"==typeof e&&e(n),i(n)}))}))},setIcon:function(n,e,r){return new Promise((function(i,o){t.setIcon(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},setFrameColor:function(n,e,r){return new Promise((function(i,o){t.setFrameColor(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},setTabTooltip:function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!n)throw new Error(n+" is null or undefined");return[2,t.setTabTooltip(a,n)]}))}))},attachTab:function(n,e,r,i){return new Promise((function(o,l){var u,s=a.id,c="Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:"+a.id;if(n){if("string"==typeof n)u=n;else{if(void 0===n.id)return void l(c);u=n.id}var d={sourceWindowId:u,targetWindowId:s};e&&(d.index=e);var h=windowStore.get(d.sourceWindowId).API,f=h.onAttached((function(n){n.id===h.id&&("function"==typeof r&&r(a),f(),o(a))}));t.attachTab(a,d).catch((function(n){"function"==typeof i&&i(n),f(),l(n)}))}else l(c)}))},detachTab:function(e,r,i){return new Promise((function(o,l){var u={windowId:a.id},s=e||{};void 0!==s.relativeTo&&("string"==typeof s.relativeTo?u.relativeTo=s.relativeTo:void 0!==s.relativeTo.id&&(u.relativeTo=s.relativeTo.id),void 0!==s.relativeDirection&&(u.relativeDirection=s.relativeDirection),void 0!==s.width&&(u.width=s.width),void 0!==s.height&&(u.height=s.height)),void 0!==s.bounds&&(u.bounds=s.bounds),void 0!==s.hideTabHeader&&(u.hideTabHeader=s.hideTabHeader);var d=!1,h=!1,f=c.add("frame-attached",(function(e){var t=void 0===s.hideTabHeader||s.hideTabHeader!==e.isTabHeaderVisible;n===e.id&&t&&(d=!0,f(),h&&("function"==typeof r&&r(a),o(a),"function"==typeof p&&p()))})),p=F((function(e){n===e.id&&(h=!0,p(),d&&("function"==typeof r&&r(a),o(a),"function"==typeof f&&f()))}));t.detachTab(a,u).catch((function(n){"function"==typeof i&&i(n),p(),f(),l(n)}))}))},setTabHeaderVisible:function(e,r,i){return new Promise((function(o,l){t.setTabHeaderVisible(a,e).then((function(){if(S===e)return"function"==typeof r&&r(a),o(a);var t=H((function(i){i.id===n&&i.isTabHeaderVisible===e&&("function"==typeof r&&r(a),t(),o(a))}))})).catch((function(n){"function"==typeof i&&i(n),l(n)}))}))},showPopup:function(n){return t.showPopup(a,n)},createFlydown:function(n){return t.createFlydown(a.id,n)},setModalState:function(n){return t.setModalState(a.id,n||!1)},setZoomFactor:function(n,e,r){return Utils$1.callbackifyPromise((function(){if(isNaN(n))throw new Error("zoomFactor is not a number");return t.setZoomFactor(a,n)}),e,r)},zoomIn:function(n,e){return Utils$1.callbackifyPromise((function(){return t.zoomIn(a)}),n,e)},zoomOut:function(n,e){return Utils$1.callbackifyPromise((function(){return t.zoomOut(a)}),n,e)},showDevTools:function(){return t.showDevTools(a)},capture:function(n){return t.capture(a,n)},flash:function(n,e){var r={shouldFlash:!0,mode:"auto"};return"boolean"==typeof n&&(r.shouldFlash=n),void 0!==e&&(r.mode=e),t.flash(a,r)},setSticky:function(n,e,r){return new Promise((function(i,o){t.setSticky(a,n).then((function(){"function"==typeof e&&e(a),i(a)})).catch((function(n){"function"==typeof r&&r(n),o(n)}))}))},print:function(n){return t.print(a,n)},printToPDF:function(n){return t.printToPDF(a,n)},place:function(n){return t.place(a,n)},ungroup:function(e){return new Promise((function(r,i){var o=X((function(e,t,i){n===e.id&&(o(),r(a))}));t.ungroup(a,e).catch((function(n){o(),i(n)}))}))},onClose:function(n){return c.add("onClose",n)},onUrlChanged:G,onTitleChanged:function(n){return n(a.title,a),c.add("onTitleChanged",n)},onFrameButtonAdded:function(n){return c.add("onFrameButtonAdded",n)},onFrameButtonRemoved:function(n){return c.add("onFrameButtonRemoved",n)},onFrameButtonClicked:function(n){return c.add("onFrameButtonClicked",n)},onCollapsed:W,onExpanded:q,onMinimized:L,onMaximized:J,onNormal:z,onAttached:function(n){return c.add("attached",n)},onDetached:F,onVisibilityChanged:B,onContextUpdated:function(n){return c.add("context-updated",n)},onLockingChanged:V,onBoundsChanged:U,onFrameColorChanged:function(n){return c.add("frame-color-changed",n)},onFocusChanged:function(n){return c.add("focus-changed",n)},onStickyChanged:function(n){return c.add("sticky-changed",n)},onGroupChanged:X,onWindowAttached:function(n){return c.add("window-attached",n)},onWindowDetached:function(n){return c.add("window-detached",n)},onTabSelectionChanged:function(n){return c.add("tab-selection-changed",n)},onTabHeaderVisibilityChanged:H,onClosing:function(e){if(!isFunction(e))throw new Error("callback should be a function");return t.onClosing((function(n,t){var r=e();r&&r.then?r.then(n).catch(t):n()}),n)},onRefreshing:function(e){if(!isFunction(e))throw new Error("callback should be a function");return t.onRefreshing((function(n,t,r){var i=e(r);i&&i.then?i.then(n).catch(t):n()}),n)},onZoomFactorChanged:function(n){if(!isFunction(n))throw new Error("callback should be a function");return c.add("zoom-factor-changed",n)},onPlacementSettingsChanged:function(n){if(!isFunction(n))throw new Error("callback should be a function");return c.add("placementSettingsChanged",n)},get tabs(){return n=windowStore.list,"tab"!==f.toLowerCase()?[]:Object.keys(n).reduce((function(e,t){var r=n[t];return r&&r.API.tabGroupId&&void 0!==r.API.tabGroupId&&void 0!==a.tabGroupId&&r.API.tabGroupId===a.tabGroupId&&e.push(r.API),e}),[]);var n},get isTabHeaderVisible(){return S},get isTabSelected(){return I},getURL:function(){return Promise.resolve(p)},getTitle:function(){return Promise.resolve(g)},getBounds:function(){return Promise.resolve(v)},getContext:function(){return Promise.resolve(w)},setContext:function(n){return Q(n)},resizeTo:function(n,e){return j({width:n,height:e})},moveTo:function(n,e){return j({top:n,left:e})},getParentWindow:function(){var n;return __awaiter$1(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){return(e=C.parentInstanceId)?[2,null===(n=windowStore.list[e])||void 0===n?void 0:n.API]:[2,void 0]}))}))},getChildWindows:function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,Object.keys(windowStore.list).map((function(n){return windowStore.list[n].API})).filter((function(e){return e.settings.parentInstanceId===n}))]}))}))}},Events:en,Registry:c}},GDExecutor=function(){function n(){this._registry=lib$2()}return Object.defineProperty(n.prototype,"hostInstance",{get:function(){return this.agmTarget},enumerable:!0,configurable:!0}),n.prototype.init=function(n,e){this.agm=n,this.agmTarget=e},n.prototype.close=function(n){var e=this;return new Promise((function(t,r){e.execute("close",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.navigate=function(n,e){var t=this;return new Promise((function(r,i){t.execute("navigate",{windowId:n.id,options:{url:e}}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.setStyle=function(n,e){var t;return __awaiter$1(this,void 0,void 0,(function(){var r,i,o,l,u,s,a,c,d,h,f,p,g;return __generator(this,(function(w){switch(w.label){case 0:return r=[],i=function(n){return r.push(n)},void 0===e.focus||n.isFocused||i(n.focus()),void 0!==e.hidden&&(o=!e.hidden,i(n.setVisible(o))),void 0!==e.onTop&&i(n.setOnTop(e.onTop)),void 0===e.tabTooltip&&void 0===e.tabToolTip||(t=e.tabTooltip,l=null!=t?t:e.tabToolTip,i(n.setTabTooltip(l))),u=e.maxWidth,s=e.maxHeight,a=e.minWidth,c=e.minHeight,d=e.allowClose,h=e.allowCollapse,f=e.allowLockUnlock,p=e.allowMaximize,g=e.allowMinimize,i(n.setSizeConstraints({maxWidth:u,maxHeight:s,minWidth:a,minHeight:c})),i(n.resetButtons({allowClose:d,allowCollapse:h,allowLockUnlock:f,allowMaximize:p,allowMinimize:g})),[4,Promise.all(r)];case 1:return w.sent(),[2,n]}}))}))},n.prototype.setSizeConstraints=function(n,e){var t=this;return new Promise((function(r,i){t.execute("setSizeConstraints",{windowId:n.id,options:e}).then((function(){r(n)})).catch(i)}))},n.prototype.setTabTooltip=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("setTabTooltip",{windowId:n.id,options:{tabToolTip:e}})];case 1:return t.sent(),[2,n]}}))}))},n.prototype.resetButtons=function(n,e){var t=this;return new Promise((function(r,i){t.execute("resetButtons",{windowId:n.id,options:e}).then((function(){r(n)})).catch(i)}))},n.prototype.setOnTop=function(n,e){var t=this;return new Promise((function(r,i){t.execute("setOnTop",{windowId:n.id,options:{onTop:e}}).then((function(){r(n)})).catch(i)}))},n.prototype.setTitle=function(n,e){var t=this;return new Promise((function(r,i){var o={windowId:n.id,options:{title:e}};t.execute("setTitle",o).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.setSticky=function(n,e){var t=this;return new Promise((function(r,i){var o={windowId:n.id,options:{isSticky:e}};t.execute("setSticky",o).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.moveResize=function(n,e){var t=this;return new Promise((function(r,i){t.execute("moveResize",{windowId:n.id,options:{bounds:e}}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.addFrameButton=function(n,e){var t=this;return new Promise((function(r,i){t.execute("addButton",{windowId:n.id,options:e}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.removeFrameButton=function(n,e){var t=this;return new Promise((function(r,i){t.execute("removeButton",{windowId:n.id,options:e}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.activate=function(n){var e=this;return new Promise((function(t,r){e.execute("activate",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.focus=function(n){var e=this;return new Promise((function(t,r){e.execute("focus",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.maximizeRestore=function(n){var e=this;return new Promise((function(t,r){e.execute("maximizeRestore",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.maximize=function(n){var e=this;return new Promise((function(t,r){e.execute("maximize",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.restore=function(n){var e=this;return new Promise((function(t,r){e.execute("restore",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.minimize=function(n){var e=this;return new Promise((function(t,r){e.execute("minimize",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.collapse=function(n){var e=this;return new Promise((function(t,r){e.execute("collapse",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.expand=function(n){var e=this;return new Promise((function(t,r){e.execute("expand",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.toggleCollapse=function(n){var e=this;return new Promise((function(t,r){e.execute("toggleCollapse",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.snap=function(n,e,t){var r=this;return new Promise((function(i,o){n.id;var l,u="Invalid target parameter - should be an object with property id or a string. Invoked for source window id:"+n.id;if(e){if("string"==typeof e)l=e;else{if(void 0===e.id)return void o(u);l=e.id}var s={targetWindowId:l};t&&(s.snappingEdge=t),r.execute("snap",{windowId:n.id,options:s}).then((function(){i(n)})).catch((function(n){o(n)}))}else o(u)}))},n.prototype.attachTab=function(n,e){var t=this;return new Promise((function(r,i){t.execute("attachTab",{windowId:n.id,options:e}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.detachTab=function(n,e){var t=this;return new Promise((function(r,i){t.execute("detachTab",{windowId:n.id,options:e}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.setVisible=function(n,e){var t=this;return void 0===e&&(e=!0),new Promise((function(r,i){var o;o=e?"show":"hide",t.execute(o,{windowId:n.id}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.showLoader=function(n,e){var t=this;return new Promise((function(r,i){t.execute("showLoadingAnimation",{windowId:n.id,options:e}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.hideLoader=function(n){var e=this;return new Promise((function(t,r){e.execute("hideLoadingAnimation",{windowId:n.id}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.updateContext=function(n,e){var t=this;return new Promise((function(r,i){t.execute("updateContext",{windowId:n.id,context:e,replace:!(Object.keys(n.context).length>0)}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.lock=function(n){var e=this;return new Promise((function(t,r){e.execute("lockUnlock",{windowId:n.id,options:{lock:!0}}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.unlock=function(n){var e=this;return new Promise((function(t,r){e.execute("lockUnlock",{windowId:n.id,options:{lock:!1}}).then((function(){t(n)})).catch((function(n){r(n)}))}))},n.prototype.getIcon=function(n){var e=this;return new Promise((function(t,r){e.execute("getIcon",{windowId:n.id,options:{}}).then((function(n){t(n.icon)})).catch((function(n){r(n)}))}))},n.prototype.setIcon=function(n,e){var t=this;return new Promise((function(r,i){t.execute("setIcon",{windowId:n.id,options:{dataURL:e}}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.setFrameColor=function(n,e){var t=this;return new Promise((function(r,i){t.execute("setFrameColor",{windowId:n.id,options:{frameColor:e}}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.setTabHeaderVisible=function(n,e){var t=this;return new Promise((function(r,i){t.execute("setTabHeaderVisible",{windowId:n.id,options:{toShow:e}}).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.showPopup=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(i){switch(i.label){case 0:return e?((t=__assign({},e)).targetLocation||(t.targetLocation="bottom"),r=__assign(__assign({},t),{popupBounds:t.size,targetId:n.id,popupId:t.windowId}),[4,this.execute("showPopupWindow",{windowId:n.id,options:r})]):[2,Promise.reject("The options object is not valid!")];case 1:return i.sent(),[2,n]}}))}))},n.prototype.createFlydown=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t,r,i=this;return __generator(this,(function(o){return e?((t=__assign({},e)).horizontalOffset||(t.horizontalOffset=0),t.verticalOffset||(t.verticalOffset=0),r=this.reformatFlydownOptions(n,t),[2,this.execute("setFlydownArea",{windowId:n,options:r}).then((function(){var n=r.zones.map((function(n){return n.id}));return r.zones.forEach((function(n){var t="function"==typeof n.flydownSize?n.flydownSize:function(){return n.flydownSize};e.size instanceof Function&&n.flydownSize&&(t=function(t,r){return __awaiter$1(i,void 0,void 0,(function(){var i;return __generator(this,(function(o){switch(o.label){case 0:return e.size instanceof Function?[4,e.size(t,r)]:[3,2];case 1:i=o.sent(),o.label=2;case 2:return n.flydownSize instanceof Function&&n.flydownSize!==e.size?[4,n.flydownSize(t,r)]:[3,4];case 3:return[2,o.sent()||i];case 4:return[2,i||n.flydownSize]}}))}))}),i._registry.clearKey(r.targetId+"_"+n.id),i._registry.add(r.targetId+"_"+n.id,t)})),{destroy:function(){return i.clearFlydownArea(r.targetId,n)},options:t}}))]):[2,Promise.reject("The options object is not valid!")]}))}))},n.prototype.setModalState=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.execute("setModalState",{windowId:n,options:{isModal:e}})]}))}))},n.prototype.handleFlydownBoundsRequested=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t,r,i,o,l;return __generator(this,(function(u){switch(u.label){case 0:return t=function(){return e.cancel=!0},r={zoneId:e.flydownId,flydownWindowBounds:e.flydownWindowBounds,flydownWindowId:e.flydownWindowId},[4,Promise.all(this._registry.execute(n+"_"+e.flydownId,r,t))];case 1:return 1===(i=u.sent()).length?(o={height:0,width:0,top:0,left:0},l="object"!=typeof i[0]||Array.isArray(i[0])?o:i[0],[2,__assign(__assign({},e),{flydownWindowBounds:l})]):[2]}}))}))},n.prototype.zoomIn=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.execute("zoomIn",{windowId:n.id})];case 1:return e.sent(),[2,n]}}))}))},n.prototype.zoomOut=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.execute("zoomOut",{windowId:n.id})];case 1:return e.sent(),[2,n]}}))}))},n.prototype.setZoomFactor=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("setZoomFactor",{windowId:n.id,options:{zoomFactor:e}})];case 1:return t.sent(),[2,n]}}))}))},n.prototype.showDevTools=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.execute("showDevTools",{windowId:n.id})];case 1:return e.sent(),[2,n]}}))}))},n.prototype.capture=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("captureScreenshot",{windowId:n.id,options:__assign({},e)})];case 1:return[2,t.sent().data]}}))}))},n.prototype.captureGroup=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("captureGroupScreenshot",{windowId:n[0],options:__assign({groupWindowIds:n},e)})];case 1:return[2,t.sent().data]}}))}))},n.prototype.flash=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("flash",{windowId:n.id,options:__assign({},e)})];case 1:return t.sent(),[2,n]}}))}))},n.prototype.configure=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.execute("configure",{windowId:n,options:__assign({},e)})]}))}))},n.prototype.print=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("print",{windowId:n.id,options:__assign({},e)})];case 1:return t.sent(),[2,n]}}))}))},n.prototype.printToPDF=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.execute("printToPDF",{windowId:n.id,options:__assign({},e)})];case 1:return[2,t.sent().filePath]}}))}))},n.prototype.place=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return(t=__assign({},e)).display&&(t.display=t.display.index+1),[2,this.execute("place",{windowId:n.id,options:__assign({},t)})]}))}))},n.prototype.execute=function(n,e){var t=this;return new Promise((function(r,i){var o=__assign(__assign({},e),{command:n});t.agm.invoke("T42.Wnd.Execute",o,t.agmTarget).then((function(n){n.returned&&n.returned.errorMsg?i(n):r(n.returned)})).catch((function(n){i(n)}))}))},n.prototype.setGroupHeaderVisible=function(n,e){return this.execute("setGroupHeaderVisibility",{windowId:n,options:{toShow:e}})},n.prototype.getGroupTitle=function(n){return this.execute("getGroupTitle",{windowId:n,options:{}}).then((function(n){return n.title}))},n.prototype.setGroupTitle=function(n,e){return this.execute("setGroupTitle",{windowId:n,options:{title:e}})},n.prototype.onClosing=function(n,e){var t="undefined"!=typeof window&&window.glue42gd;if(t)return t.addCloseHandler(n,e)},n.prototype.onRefreshing=function(n,e){var t="undefined"!=typeof window&&window.glue42gd;if(t)return t.addRefreshHandler(n,e)},n.prototype.ungroup=function(n,e){var t=this;return new Promise((function(r,i){var o={windowId:n.id,options:e};t.execute("ungroup",o).then((function(){r(n)})).catch((function(n){i(n)}))}))},n.prototype.reformatFlydownOptions=function(n,e){var t=function(n,t){if(e[t]&&(void 0===n[t]||null===n[t])){var r=e[t];n[t]=r}},r=e.zones.map((function(n){return t(n,"windowId"),t(n,"targetLocation"),!e.size||void 0!==n.flydownSize&&null!==n.flydownSize||(n.flydownSize=e.size),n.flydownBounds=n.flydownSize,n.flydownId=n.windowId,n.targetLocation||(n.targetLocation="bottom"),n}));return __assign(__assign({},e),{zones:r,targetId:n,flydownBounds:e.size,flydownActiveArea:e.activeArea})},n.prototype.clearFlydownArea=function(n,e){var t=this;return this.execute("clearFlydownWindowArea",{windowId:n,options:{}}).then((function(){e.forEach((function(e){t._registry.clearKey(n+"_"+e)}))}))},n}(),executor=new GDExecutor;function getWindowsByTabGroupId(n,e){var t=windowStore.list;return Object.keys(t).reduce((function(r,i){var o=t[i];return o.API.tabGroupId===e&&o.API.id!==n&&(r[i]=o),r}),{})}var GDEnvironment=function(){function n(n,e,t,r,i,o){this._registry=lib$2(),this._waitTimeout=1e4,this._agm=n,this._logger=e.subLogger("gd-env"),this._agmInstance=this.normalizeInstance(i),this._windowId=o,this._appManagerGetter=t,this._displayAPIGetter=r}return n.prototype.init=function(){var n=this;return new Promise((function(e,t){void 0===n._agmInstance&&(n._agmInstance="best"),n._agm.registerAsync("T42.Wnd.OnEventWithResponse",(function(e,t,r,i){n.respondToEvent(e).then(r).catch(i)}));new Promise((function(r,i){n._agm.subscribe("T42.Wnd.OnEvent",{waitTimeoutMs:n._waitTimeout,target:n._agmInstance,onData:function(t){n.updateWindow(t.data,e)},onConnected:function(e){n._agmInstance=n.normalizeInstance(e),executor.init(n._agm,n._agmInstance)}}).catch((function(n){t("Can not subscribe for stream T42.Wnd.OnEvent. Err: "+n)}))}))}))},Object.defineProperty(n.prototype,"executor",{get:function(){return executor},enumerable:!0,configurable:!0}),n.prototype.open=function(n,e,t,r,i){var o=__assign({},t=t||{});void 0!==n?(void 0!==o.relativeTo&&"string"!=typeof o.relativeTo&&(o.relativeTo=o.relativeTo.id||""),o.name=n,o.url=e,o.windowState=t.windowState||t.state,delete o.state,this._agm.invoke("T42.Wnd.Create",o,this._agmInstance).then((function(n){if(void 0!==n.returned){var e=n.returned.id;r(e)}else i({message:"failed to execute T42.Wnd.Create - unknown reason"})})).catch(i)):i({message:"The name is undefined"})},n.prototype.createFlydown=function(n,e){return this.executor.createFlydown(n,e)},n.prototype.showPopup=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return t=windowStore.get(n),[4,this.executor.showPopup(t.API,e)];case 1:return r.sent(),[2]}}))}))},n.prototype.tabAttached=function(n){return this._registry.add("tab-attached",n)},n.prototype.tabDetached=function(n){return this._registry.add("tab-detached",n)},n.prototype.onWindowFrameColorChanged=function(n){return this._registry.add("frame-color-changed",n)},n.prototype.onEvent=function(n){return this._registry.add("window-event",n)},n.prototype.my=function(){return this._windowId},n.prototype.execute=function(n,e,t){return this._agm.invoke("T42.Wnd.Execute",{command:n,options:t,windowId:e})},n.prototype.setGroupHeaderVisible=function(n,e){return this._agm.invoke("T42.Wnd.SetGroupHeaderVisible",{windowId:n,toShow:e},this._agmInstance)},n.prototype.onCompositionChanged=function(n){return this._registry.add("composition-changed",n)},n.prototype.onGroupHeaderVisibilityChanged=function(n){return this._registry.add("group-header-changed",n)},n.prototype.onWindowGotFocus=function(n){return this._registry.add("got-focus",n)},n.prototype.onWindowLostFocus=function(n){return this._registry.add("lost-focus",n)},n.prototype.normalizeInstance=function(n){if(n)return{application:n.application,machine:n.machine,user:n.user}},n.prototype.respondToEvent=function(n){return"ShowFlydownBoundsRequested"===n.type?this.executor.handleFlydownBoundsRequested(n.data.windowId,n.data):Promise.reject("There isn't a handler for "+n.type)},n.prototype.updateWindow=function(n,e){var t=this,r=this.getExtendedStreamEvent(n);if("Snapshot"===n.type)return n.windows.forEach((function(n){var e=t.createWindow(n.id,n);windowStore.markReadyToShow(e.API.id),t._registry.execute("window-event",r)})),void e(this);if("Created"===n.type){var i=n,o=this.createWindow(i.windowId,i.data||{});return windowStore.setReadyState(o.API.id),void this._registry.execute("window-event",r)}var l=windowStore.get(n.windowId);if(l){var u=l.API,s=l.Events;if("BoundsChanged"===n.type){var a=n;s.handleBoundsChanged(a.data)}if("UrlChanged"===n.type){var c=n;windowStore.setUrlChangedState(c.windowId),s.handleUrlChanged(c.data)}if("TitleChanged"===n.type){var d=n;s.handleTitleChanged(d.data)}if("IsStickyChanged"===n.type){var h=n;s.handleIsStickyChanged(h.data)}if("VisibilityChanged"===n.type&&s.handleVisibilityChanged(n.data),"ContextChanged"===n.type&&s.handleContextUpdated(n.data),"StateChanged"===n.type&&s.handleWindowChangeState(n.data),"FrameColorChanged"===n.type&&(s.handleFrameColorChanged(n.data),this._registry.execute("frame-color-changed",u)),"CompositionChanged"===n.type){var f=n;s.handleCompositionChanged(f.data.neighbors,f.data.groupId),this._registry.execute("composition-changed",f.data)}if("GroupHeaderVisibilityChanged"===n.type){var p=n;s.handleGroupHeaderVisibilityChanged(p.data.groupHeaderVisible),this._registry.execute("group-header-changed",p.data)}if("FocusChanged"===n.type){var g=n;this.focusChanged(s,u,g.data)}if("WindowFrameChanged"===n.type&&(s.handleFrameAttached(n.data.frameId,n.data.isTabHeaderVisible),this._registry.execute("frame-changed")),"WindowFrameAdded"===n.type){s.handleAttached(n.data.frameId,n.data.isTabHeaderVisible);var w=getWindowsByTabGroupId(u.id,n.data.frameId);Object.keys(w).forEach((function(n){w[n].Events.handleWindowAttached(u)})),this._registry.execute("tab-attached",u,n.data.frameId,n.data.isTabHeaderVisible)}if("WindowFrameRemoved"===n.type){var v=u.tabGroupId;s.handleDetached(n.data.frameId);var m=getWindowsByTabGroupId(u.id,v);Object.keys(m).forEach((function(n){m[n].Events.handleWindowDetached(u)}));var y=this._registry.add("frame-changed",(function(){y(),t._registry.execute("tab-detached",u,n.data.frameId,u.tabGroupId)}))}"TabHeaderVisibilityChanged"===n.type&&s.handleTabHeaderVisibilityChanged(n.data.isTabHeaderVisible),"FrameSelectionChanged"===n.type&&s.handleFrameSelectionChanged(n.data.newWindowId,n.data.prevWindowId),"ButtonClicked"===n.type&&s.handleFrameButtonClicked(n.data),"ButtonAdded"===n.type&&s.handleFrameButtonAdded(n.data),"ButtonRemoved"===n.type&&s.handleFrameButtonRemoved(n.data),"WindowZoomFactorChanged"===n.type&&s.handleZoomFactorChanged(n.data),"Closed"===n.type&&(windowStore.remove(l),s.handleWindowClose()),"FrameIsLockedChanged"===n.type&&s.handleFrameIsLockedChanged(n.data),"PlacementSettingsChanged"===n.type&&s.handlePlacementSettingsChanged(n.data),this._registry.execute("window-event",r)}else this._logger.error("received update for unknown window. Stream:', "+JSON.stringify(n,null,4))},n.prototype.createWindow=function(n,e){var t,r=windowStore.get(n),i=windowFactory(n,this.mapToWindowConstructorOptions(e),executor,this._logger,this._appManagerGetter,this._displayAPIGetter,this._agm,null===(t=r)||void 0===t?void 0:t.Registry);return windowStore.add(i),i},n.prototype.focusChanged=function(n,e,t){n.handleFocusChanged(t),t?this._registry.execute("got-focus",e):this._registry.execute("lost-focus",e)},n.prototype.mapToWindowConstructorOptions=function(n){return{name:n.name,context:n.context,bounds:n.bounds,url:n.url,title:n.title,isVisible:n.isVisible,focus:n.isFocused,state:n.state,frameColor:n.frameColor,groupId:n.groupId,neighbours:n.neighbors,isFocused:n.isFocused,isGroupHeaderVisible:n.groupHeaderVisible,isCollapsed:n.isCollapsed,tabGroupId:n.frameId,mode:n.mode,isTabHeaderVisible:n.isTabHeaderVisible,isTabSelected:n.isActiveTab,settings:n.settings,windowType:n.windowType,zoomFactor:n.zoomFactor,isLocked:n.isLocked,placementSettings:n.placementSettings,isSticky:n.isSticky}},n.prototype.getExtendedStreamEvent=function(n){try{var e=__assign({state:n.type,windowName:windowStore.get(n.windowId).API.name},n);return"WindowFrameAdded"===e.state&&(e.state="TabAttached"),"StateChanged"===e.state&&(e.state=e.data.charAt(0).toUpperCase()+e.data.slice(1)),"ButtonAdded"===e.state&&(e.state="FrameButtonAdded"),"ButtonRemoved"===e.state&&(e.state="FrameButtonRemoved"),e}catch(e){return n}},n}(),envDetector=function(n,e,t,r,i){var o=e;return new Promise((function(e,l){if(2===i)throw o.trace("running in HC"),new Error("GD2 not supported");if(i>=3){o.trace("running in GD 3"),new GDEnvironment(n,o,t,r,void 0,window.glue42gd.windowId).init().then(e).catch(l)}else{var u=new GDEnvironment(n,o,t,r).init();Promise.race([u,(s=1e4,new Promise((function(n,e){return setTimeout((function(){e("timeout waiting for streams")}),s)})))]).then(e).catch(l)}var s}))},groupFactory=function(n,e){var t=lib$2(),r=[];function i(){return new Promise((function(n,e){var t=s((function(e){t(),n()}))}))}function o(n,t,r,i){return new Promise((function(i,o){e.execute(n,t).then((function(n){"function"==typeof r&&r(a),i(a)})).catch((function(n){o(n)}))}))}function l(){var n=[];return r.forEach((function(e){var t=u(e);void 0!==t&&n.push(t)})),n}function u(n){return windowStore.get(n)?windowStore.get(n).API:void 0}function s(n){return t.add("header-visibility-changed",n)}var a={id:n,get windows(){return e=l(),"function"==typeof n&&n(e),e;var n,e},find:function(n,e){var t;t="string"==typeof n?n:n.id;var i=r.indexOf(t);if(-1!==i){var o=u(r[i]);return"function"==typeof e&&e(o),o}},get isHeaderVisible(){return void 0===l().find((function(n){return!n.isGroupHeaderVisible}))},showHeader:function(n,t){return new Promise((function(t,o){Promise.all([e.setGroupHeaderVisible(r[0],!0),i()]).then((function(){"function"==typeof n&&n(a),t(a)})).catch((function(n){o(n)}))}))},hideHeader:function(n,t){return new Promise((function(t,o){Promise.all([e.setGroupHeaderVisible(r[0],!1),i()]).then((function(){"function"==typeof n&&n(a),t(a)})).catch((function(n){}))}))},getTitle:function(){return e.getGroupTitle(r[0])},setTitle:function(n){return e.setGroupTitle(r[0],n)},capture:function(n){return e.captureGroup(r,n)},maximize:function(e,t){return o("maximize",{groupId:n},e)},restore:function(e,t){return o("restore",{groupId:n},e)},onHeaderVisibilityChanged:s,onWindowAdded:function(n){return t.add("window-added",n)},onWindowRemoved:function(n){return t.add("window-removed",n)}};return{groupAPI:a,groupInternal:{addWindow:function(n){if(-1===r.indexOf(n)){r.push(n);var e=windowStore.get(n);e.Events.handleGroupAssociation(a),t.execute("window-added",a,e.API)}},removeWindow:function(n){var e=r.indexOf(n);if(-1!==e){r.splice(e,1);var i=u(n);t.execute("window-removed",a,i)}},handleGroupHeaderVisibilityChanged:function(n){t.execute("header-visibility-changed",a)}}}},groupsFactory=function(n,e){var t=e.subLogger("groups"),r=lib$2(),i={},o=-1,l=windowStore.list;function u(n,t){var r,o;if(void 0!==n)return r="string"==typeof n?n:n.id,Object.keys(i).forEach((function(n){var e=i[n].groupAPI;void 0===e.find(r)||(o=e)})),"function"==typeof t&&t(o),o;e.debug("trying to find a group by a window, but winId is undefined")}function s(n){t.trace("Adding new window "+n.API.id+" to win.API.groupId "+n.API.groupId);var e=a(n);e&&(t.trace("handleGroupAssociation "+n.API.id+" to group.groupAPI.id "+e.groupAPI.id),n.Events.handleGroupAssociation(e.groupAPI))}function a(e,r){var o=r||e.API.groupId,l=e.API.id;if(void 0!==o&&void 0!==l){var u=function(e){if(i.hasOwnProperty(e))return i[e];var t=groupFactory(e,n.executor);return i[e]=t,t}(o);return u.groupInternal.addWindow(l),u}t.debug("trying to add a window without group - winId: "+l)}function c(n,e){var t=n.API.id,r=e||n.API.groupId;void 0!==r&&(i[r].groupInternal.removeWindow(t),n.Events.handleGroupAssociation(void 0),function(n){i.hasOwnProperty(n)&&void 0!==i[n]&&0===i[n].groupAPI.windows.length&&delete i[n]}(r))}return Object.keys(l).forEach((function(n){s(l[n])})),n.onCompositionChanged((function(n){!function(n){var e=n.groupId,i=n.windowId,o=u(i),l=o?o.id:void 0;if(t.trace("handleCompositionChanged newGroupId: "+e+" windowId: "+i+" oldGroup: "+l),l===e)return void t.trace("handleCompositionChanged newGroupId: "+e+" windowId: "+i+" oldGroup: "+l+" are the same - returning...");var s=windowStore.get(i)||windowStore.get(i),d=a(s,e);o&&(c(s,l),r.execute("window-moved",i,o,e));s.Events.handleGroupChanged(d.groupAPI,o)}(n)})),n.onGroupHeaderVisibilityChanged((function(n){var e=u(n.windowId);if(void 0!==e){var t=i[e.id];-1===o&&(o=e.windows.length),0===--o&&(o=-1,t.groupInternal.handleGroupHeaderVisibilityChanged(n))}})),windowStore.onAdded((function(n){s(n)})),windowStore.onRemoved((function(n){c(n)})),{groupsAPI:{get my(){return u(n.my())},list:function(n){var e=Object.keys(i).map((function(n){if(i[n])return i[n].groupAPI}));return"function"==typeof n&&n(e),e},findGroupByWindow:u},groupsEvents:{onWindowMoved:function(n){return r.add("window-moved",n)}}}},WindowsFactory=function(n,e,t,r,i){var o,l,u=lib$2(),s=e;windowStore.init(s);var a=new Promise((function(e,u){envDetector(n,s,t,r,i).then((function(n){l=n,o=groupsFactory(n,s),e()})).catch((function(n){var e="Environment detector fails with: "+n;s.error(e),u(e)}))}));function c(){var n=windowStore.getIfReady(l.my());return n?n.API:void 0}function d(n){return u.add("window-added",n)}function h(n){return u.add("window-removed",n)}return windowStore.onReadyWindow((function(n){u.execute("window-added",n.API)})),windowStore.onRemoved((function(n){u.execute("window-removed",n.API)})),{my:c,open:function(n,e,t,r,i){return new Promise((function(o,u){var s=function(n){"function"==typeof i&&i(n),u(n)};l.open(n,e,t,(function(n){windowStore.waitFor(n).then((function(n){"function"==typeof r&&r(n.API),o(n.API),"electron"===n.API.windowType&&n.Events.handleUrlChanged(n.API.url)})).catch(s)}),s)}))},find:function(n,e,t){var r=windowStore.list,i=Object.keys(r).reduce((function(e,t){var i=r[t];return i&&i.API.name===n&&e.push(i.API),e}),[]);if("function"!=typeof e)return i[0];i.length>0?e(i[0]):"function"==typeof t&&t("There is no window with name:"+n)},findById:function(n,e,t){var r=windowStore.list,i=Object.keys(r).reduce((function(e,t){var i=r[t];return void 0!==i&&i.API.id===n&&e.push(i.API),e}),[]);if("function"!=typeof e)return i[0];i.length>0?e(i[0]):"function"==typeof t&&t("There is no window with such id:"+n)},list:function(n){var e=windowStore.list,t=Object.keys(e).map((function(n){return e[n].API}));if("function"!=typeof n)return t;n(t)},ready:function(){return a},onWindowAdded:d,windowAdded:d,onWindowRemoved:h,windowRemoved:h,onTabAttached:function(n){return a.then((function(){l.tabAttached(n)}))},onTabDetached:function(n){return a.then((function(){l.tabDetached(n)}))},onWindowFrameColorChanged:function(n){return a.then((function(){return l.onWindowFrameColorChanged(n)}))},get groups(){return o.groupsAPI},onWindowGotFocus:function(n){var e;return a.then((function(){e=l.onWindowGotFocus(n)})),function(){e&&e()}},onWindowLostFocus:function(n){var e;return a.then((function(){e=l.onWindowLostFocus(n)})),function(){e&&e()}},onEvent:function(n){var e,t=!1;return a.then((function(){t||(e=l.onEvent(n))})),function(){t=!0,e&&e()}},createFlydown:function(n,e){return l.createFlydown(n,e)},showPopup:function(n,e){return l.showPopup(n,e)},configure:function(n){var e=c(),t=e?e.id:"";return executor.configure(t,n)}}},LayoutStore=function(){function n(){this.layouts=[]}return n.prototype.removeWhere=function(n){this.layouts=this.layouts.filter(n)},n.prototype.add=function(n){this.layouts.push(n)},Object.defineProperty(n.prototype,"all",{get:function(){return this.layouts},enumerable:!0,configurable:!0}),n.prototype.where=function(n){return this.layouts.filter(n)},n.prototype.first=function(n){return this.where(n)[0]},n}(),store=new LayoutStore;function createCommonjsModule$1(n,e){return n(e={exports:{}},e.exports),e.exports}var seed$1=1;function getNextValue$1(){return(seed$1=(9301*seed$1+49297)%233280)/233280}function setSeed$2(n){seed$1=n}var randomFromSeed$1={nextValue:getNextValue$1,seed:setSeed$2},ORIGINAL$1="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$1,previousSeed$1,shuffled$1;function reset$1(){shuffled$1=!1}function setCharacters$1(n){if(n){if(n!==alphabet$1){if(n.length!==ORIGINAL$1.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet$1=n,reset$1()}}else alphabet$1!==ORIGINAL$1&&(alphabet$1=ORIGINAL$1,reset$1())}function characters$1(n){return setCharacters$1(n),alphabet$1}function setSeed$3(n){randomFromSeed$1.seed(n),previousSeed$1!==n&&(reset$1(),previousSeed$1=n)}function shuffle$1(){alphabet$1||setCharacters$1(ORIGINAL$1);for(var n,e=alphabet$1.split(""),t=[],r=randomFromSeed$1.nextValue();e.length>0;)r=randomFromSeed$1.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled$1(){return shuffled$1||(shuffled$1=shuffle$1())}function lookup$1(n){return getShuffled$1()[n]}var alphabet_1$1={characters:characters$1,seed:setSeed$3,lookup:lookup$1,shuffled:getShuffled$1},crypto$1="object"==typeof window&&(window.crypto||window.msCrypto);function randomByte$1(){if(!crypto$1||!crypto$1.getRandomValues)return 48&Math.floor(256*Math.random());var n=new Uint8Array(1);return crypto$1.getRandomValues(n),48&n[0]}var randomByteBrowser$1=randomByte$1;function encode$1(n,e){for(var t,r=0,i="";!t;)i+=n(e>>4*r&15|randomByteBrowser$1()),t=e<Math.pow(16,r+1),r++;return i}var encode_1$1=encode$1;function decode$1(n){var e=alphabet_1$1.shuffled();return{version:15&e.indexOf(n.substr(0,1)),worker:15&e.indexOf(n.substr(1,1))}}var decode_1$1=decode$1,REDUCE_TIME=1459707606518,version$1=6,counter,previousSeconds;function build(n){var e="",t=Math.floor(.001*(Date.now()-REDUCE_TIME));return t===previousSeconds?counter++:(counter=0,previousSeconds=t),e+=encode_1$1(alphabet_1$1.lookup,version$1),e+=encode_1$1(alphabet_1$1.lookup,n),counter>0&&(e+=encode_1$1(alphabet_1$1.lookup,counter)),e+=encode_1$1(alphabet_1$1.lookup,t)}var build_1=build;function isShortId$1(n){if(!n||"string"!=typeof n||n.length<6)return!1;for(var e=alphabet_1$1.characters(),t=n.length,r=0;r<t;r++)if(-1===e.indexOf(n[r]))return!1;return!0}var isValid$1=isShortId$1,lib$3=createCommonjsModule$1((function(n){var e=0;function t(){return build_1(e)}n.exports=t,n.exports.generate=t,n.exports.seed=function(e){return alphabet_1$1.seed(e),n.exports},n.exports.worker=function(t){return e=t,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1$1.characters(n),alphabet_1$1.shuffled()},n.exports.decode=decode_1$1,n.exports.isValid=isValid$1})),lib_1$1=lib$3.generate,lib_2$1=lib$3.seed,lib_3$1=lib$3.worker,lib_4$1=lib$3.characters,lib_5$1=lib$3.decode,lib_6$1=lib$3.isValid,shortid$1=lib$3,SaveContextMethodName="T42.HC.GetSaveContext",ContextProvider=function(){function n(n,e,t,r){this.config=n,this.activitiesGetter=e,this.callbacks=t,this.logger=r,this.interop=n.agm,this.registerRequestMethods()}return n.prototype.onSaveRequested=function(n){return this.callbacks.add("saveRequested",n)},n.prototype.isActivityOwner=function(){if("undefined"!=typeof htmlContainer){var n=htmlContainer.getContext();return n&&n._t42&&n._t42.activityIsOwner}var e=this.activitiesGetter();if(!e)return!1;if(!e.inActivity)return!1;var t=e.my.window,r=e.my.activity;return!(!r&&!t)&&r.owner.id===t.id},n.prototype.registerRequestMethods=function(){var n=this;this.interop.register(SaveContextMethodName,(function(e){var t,r,i,o=n.callbacks.execute("saveRequested",e);(null===(t=o)||void 0===t?void 0:t.length)>1&&n.logger.warn('Multiple subscriptions for "glue.layouts.onSaveRequested" - only the first one will be used');var l=o[0],u=n.config.autoSaveWindowContext;if(u)return{autoSaveWindowContext:u};var s={windowContext:null===(r=l)||void 0===r?void 0:r.windowContext,activityContext:void 0};return n.isActivityOwner()&&(s.activityContext=null===(i=l)||void 0===i?void 0:i.activityContext),s}))},n}();function transformACSLayout(n){if(!n)return n;if(Array.isArray(n))return n.map((function(n){return transformACSLayout(n)}));if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return n;return Object.keys(n).reduce((function(e,t){var r=transformACSLayout(n[t]),i=t;return t[0].toLowerCase()!==t[0]&&(i=t[0].toLowerCase()+t.substr(1)),e[i]=r,e}),{})}var LayoutImpl=function(n){this.name=n.name,this.type=n.type,this.components=n.components,this.context=n.context,this.metadata=n.metadata,this.version=n.version,this.displays=n.displays},LayoutsAPIImpl=function(){function n(n,e,t,r){this.config=n,this.stream=e,this.callbacks=t,this.appManager=n.appManager,this.onEvent=e.onEvent,this.provider=new ContextProvider(n,n.activityGetter,t,r),e.subscribe()}return n.prototype.setDefaultGlobal=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.config.agm.invoke("T42.ACS.SelectDefaultLayout",{name:n})];case 1:return e.sent(),[2]}}))}))},n.prototype.clearDefaultGlobal=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.config.agm.invoke("T42.ACS.DeselectDefaultLayout")];case 1:return n.sent(),[2]}}))}))},n.prototype.getDefaultGlobal=function(){return __awaiter$1(this,void 0,void 0,(function(){var n,e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.config.agm.invoke("T42.ACS.GetDefaultLayout")];case 1:return n=t.sent(),(e=n.returned)?this.isSlimMode()?[2,e]:[2,this.list().find((function(n){return n.name===e.name&&"Global"===n.type}))]:[2,void 0]}}))}))},n.prototype.ready=function(){return"fullWaitSnapshot"===this.config.mode?this.stream.gotSnapshot:this.stream.ready},n.prototype.save=function(n){var e=this;return new Promise((function(t,r){if(e.verifyNotSlimMode(),!n.name)throw Error("layout.name argument is required");n.type||(n.type="Global"),n.activityId&&(n.type="Activity"),void 0===n.ignoreHidden&&(n.ignoreHidden=!0);var i={name:n.name,actIds:[],appIds:[],type:n.type,context:n.context,metadata:n.metadata||{},options:{ignoreLayoutRestrictions:!1}};if("Activity"===n.type){var o=n.activityId;if(!o){if(!e.appManager.myInstance.inActivity)throw new Error("Current application is not in activity. Can not save activity layout for it");o=e.appManager.myInstance.activityId}i.actIds.push(o),i.options={ignoreLayoutRestrictions:!0}}else{if("Global"!==n.type)throw new Error("layout type "+n.type+" not supported");if(2===e.config.gdMajorVersion){var l=e.appManager.instances();n.ignoreHidden&&(l=l.filter((function(n){return e.isVisibleWindow(n)}))),n.ignoreMyInstance&&e.appManager.myInstance&&(l=l.filter((function(n){return n.id!==e.appManager.myInstance.id}))),l.reduce((function(n,e){if(!e.id)return n;if(e.inActivity){var t=e.activityId;-1===n.actIds.indexOf(t)&&n.actIds.push(t)}else n.appIds.push(e.id);return n}),i)}else i.autoCollectApps=!0}e.invokeMethodAndTrack("T42.ACS.SaveLayout",i,t,r)}))},n.prototype.restore=function(n){var e=this;return new Promise((function(t,r){if(e.verifyNotSlimMode(),void 0===n)throw Error("options argument is required");if(!n.name)throw Error("options.name argument is required");n.type||(n.type="Global"),n.activityIdToJoin&&(n.type="Activity"),void 0===n.restoreActivityOwner&&(n.restoreActivityOwner=!1),void 0===n.ignoreActivityWindowTypes&&(n.ignoreActivityWindowTypes=[]),void 0===n.setActivityContext&&(n.setActivityContext=!0),void 0===n.closeRunningInstance&&("Global"===n.type?n.closeRunningInstance=!0:"Activity"===n.type&&(n.closeRunningInstance=!1)),void 0===n.reuseWindows&&(n.reuseWindows=!0),n.context=n.context||{};var i={restoreOptions:{activityToJoin:n.activityIdToJoin,setActivityContext:n.setActivityContext,ignoreActivityWindowTypes:n.ignoreActivityWindowTypes,restoreActivityOwner:n.restoreActivityOwner,closeOldWindows:n.closeRunningInstance,reuseExistingWindows:n.reuseWindows}},o={type:n.type,name:n.name,context:n.context,toClose:[],splash:n.splash};2===e.config.gdMajorVersion&&n.closeRunningInstance&&(o.toClose=e.getInstancesToClose(n)),n.timeout&&(o.timeout=n.timeout),o.context._t42=i,e.invokeMethodAndTrack("T42.ACS.RestoreLayout",o,t,r,!0)}))},n.prototype.remove=function(n,e){var t=this;return new Promise((function(r,i){if(t.verifyNotSlimMode(),!e)throw Error("name argument is required");if(!n)throw Error("type argument is required");var o={type:n,name:e};t.invokeMethodAndTrack("T42.ACS.RemoveLayout",o,r,i)}))},n.prototype.list=function(){return this.verifyNotSlimMode(),store.all},n.prototype.import=function(n,e){var t=this;return new Promise((function(r,i){t.verifyNotSlimMode();var o={mode:e||"replace",layouts:n};t.invokeMethodAndTrack("T42.ACS.ImportLayouts",o,r,i,!0)}))},n.prototype.export=function(n){var e=this;return new Promise((function(t,r){e.invokeMethodAndTrack("T42.ACS.ExportLayouts",{},(function(r){var i=e.getObjectValues(r.Layouts).map((function(n){return new LayoutImpl(transformACSLayout(n))}));n&&(i=i.filter((function(e){return e.type=n}))),t(i)}),r,!0)}))},n.prototype.rename=function(n,e){var t=this;return new Promise((function(r,i){if(t.verifyNotSlimMode(),!n)throw Error("layout argument is required");if(!n.name)throw Error("name argument is required");if(!n.type)throw Error("type argument is required");var o={type:n.type,oldName:n.name,newName:e};t.invokeMethodAndTrack("T42.ACS.RenameLayout",o,r,i)}))},n.prototype.updateMetadata=function(n){var e=this;return new Promise((function(t,r){if(!n)throw Error("layout argument is required");if(!n.name)throw Error("name argument is required");if(!n.type)throw Error("type argument is required");if(!n.metadata)throw Error("metadata argument is required");var i={name:n.name,type:n.type,metadata:n.metadata};e.invokeMethodAndTrack("T42.ACS.UpdateMetadata",i,t,r,!0)}))},n.prototype.hibernate=function(n,e){var t=this;return new Promise((function(r,i){if(!n)return i("name cannot be empty");var o={name:n,type:"Global",context:(e=e||{}).context||{},metadata:e.metadata||{}};t.invokeMethodAndTrack("T42.ACS.HibernateLayout",o,r,i,!0)}))},n.prototype.resume=function(n,e,t){var r=this;return new Promise((function(i,o){if(!n)return o("name cannot be empty");var l=__assign({name:n,type:"Global",context:e},t);r.invokeMethodAndTrack("T42.ACS.ResumeLayout",l,i,o,!0)}))},n.prototype.getCurrentLayout=function(){return __awaiter$1(this,void 0,void 0,(function(){var n,e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.config.agm.invoke("T42.ACS.GetCurrentLayout",{},"best",{methodResponseTimeoutMs:12e4})];case 1:return n=t.sent(),(e=n.returned.layout)?(this.isSlimMode()||(e=this.list().find((function(n){return n.name===e.name&&n.type===e.type}))),[2,e]):[2,void 0]}}))}))},n.prototype.onAdded=function(n){var e=this.callbacks.add("added",n);return store.all.length>0&&store.all.forEach((function(e){try{n(e)}catch(n){}})),e},n.prototype.onRemoved=function(n){return this.callbacks.add("removed",n)},n.prototype.onChanged=function(n){return this.callbacks.add("changed",n)},n.prototype.onRestored=function(n){return this.callbacks.add("restored",n)},n.prototype.onRenamed=function(n){return this.callbacks.add("renamed",n)},n.prototype.onEvent=function(n){return this.stream.onEvent(n)},n.prototype.onSaveRequested=function(n){return this.provider.onSaveRequested(n)},n.prototype.updateAppContextInCurrent=function(n){var e=this;return new Promise((function(t,r){n&&"object"!=typeof n&&r("context must be an object");var i={context:n=null!=n?n:{}};e.invokeMethodAndTrack("T42.ACS.UpdateLayoutComponentContext",i,t,r,!0)}))},n.prototype.updateDefaultContext=function(n){var e=this;return new Promise((function(t,r){n&&"object"!=typeof n&&r("context must be an object");var i={context:n=null!=n?n:{}};e.invokeMethodAndTrack("T42.ACS.UpdateDefaultContext",i,t,r,!0)}))},n.prototype.get=function(n,e){var t=this.list().find((function(t){return t.name===n&&t.type===e}));return t?Promise.resolve(t):Promise.reject("can not find layout with name="+n+" and type="+e)},n.prototype.getAll=function(n){var e=this.list().filter((function(e){return n===e.type}));return Promise.resolve(e)},n.prototype.isSlimMode=function(){return"slim"===this.config.mode},n.prototype.verifyNotSlimMode=function(){if(this.isSlimMode())throw Error("Operation not allowed in slim mode. Run in full mode.")},n.prototype.isVisibleWindow=function(n){return"exe"===n.application.type||"node"===n.application.type||("activity"===n.application.type||!(!n||!n.window)&&n.window.isVisible)},n.prototype.invokeMethodAndTrack=function(n,e,t,r,i){var o,l=i,u=shortid$1();e.token=u;var s=function(){l&&o&&t(o)};i||this.stream.waitFor(u).then((function(){l=!0,s()})).catch((function(n){r(n)}));this.config.agm.invoke(n,e,"best",{methodResponseTimeoutMs:12e4}).then((function(e){e.returned||r("No result from method "+n),e.returned.status&&"Success"!==e.returned.status&&"PartialSuccess"!==e.returned.status&&r(e.returned),o=e.returned,s()})).catch((function(n){return r(n)}))},n.prototype.getInstancesToClose=function(n){var e=this,t=[],r=this.appManager.applications().filter((function(n){return n.isShell}))[0],i=r?r.name:"AppManager";return this.appManager.instances().forEach((function(r){e.appManager.myInstance&&r.id===e.appManager.myInstance.id||r.application.name!==i&&e.isVisibleWindow(r)&&("Activity"===n.type&&r.activityId!==n.activityIdToJoin||t.push({application:r.application.name,instance:r.id}))})),t},n.prototype.getObjectValues=function(n){return n?Object.keys(n).map((function(e){return n[e]})):[]},n}(),ACSStream=function(){function n(n,e){var t=this;this.agm=n,this.callbacks=e,this.ready=new Promise((function(n,e){t.resolveReady=n,t.rejectReady=e})),this.gotSnapshot=new Promise((function(n,e){t.resolveGotSnapshot=n,t.rejectGotSnapshot=e}))}return n.prototype.subscribe=function(n){var e=this,t=function(n){return e.getObjectValues(n).map((function(n){return transformACSLayout(n)}))};this.checkForLayoutEventMethod()?this.agm.subscribe("T42.ACS.OnLayoutEvent",{waitTimeoutMs:1e4}).then((function(n){n.onData((function(n){var r=n.data;r.IsSnapshot&&e.resolveGotSnapshot(),e.addLayouts(t(r.OnLayoutAdded)),e.removeLayouts(t(r.OnLayoutRemoved)),e.changeLayouts(t(r.OnLayoutChanged)),e.renameLayouts(t(r.OnLayoutRenamed)),e.restoredLayout(t(r.OnLayoutRestored)),e.callbacks.execute("streamEvent",r)})),n.onFailed((function(n){var t="can not subscribe to T42.ACS.OnLayoutEvent "+n;e.rejectReady(t),e.rejectGotSnapshot(t)})),e.resolveReady()})).catch((function(n){var t="Error subscribing for T42.ACS.OnLayoutEvent stream. Err: "+n;e.rejectReady(t),e.rejectGotSnapshot(t)})):(n&&this.resolveReady(),setTimeout((function(){e.subscribe(!0)}),500))},n.prototype.onEvent=function(n){return this.callbacks.add("streamEvent",n)},n.prototype.waitFor=function(n,e){var t=this;return e||(e=1e4),new Promise((function(r,i){var o=!1,l=t.onEvent((function(e){e.Token===n&&(o=!0,l(),r())}));setTimeout((function(){o||i("timed out")}),e)}))},n.prototype.checkForLayoutEventMethod=function(){try{return-1!==this.agm.methods().map((function(n){return n.name})).indexOf("T42.ACS.OnLayoutEvent")}catch(n){return!1}},n.prototype.addLayouts=function(n){var e=this;n&&n.forEach((function(n){var t=new LayoutImpl(n);store.add(t),e.callbacks.execute("added",t)}))},n.prototype.removeLayouts=function(n){var e=this;n&&n.forEach((function(n){store.removeWhere((function(t){return!e.compareLayouts(t,n)})),e.callbacks.execute("removed",n)}))},n.prototype.changeLayouts=function(n){var e=this;n&&n.forEach((function(n){store.removeWhere((function(t){return!e.compareLayouts(t,n)})),store.add(new LayoutImpl(n)),e.callbacks.execute("changed",n)}))},n.prototype.renameLayouts=function(n){var e=this;n&&n.forEach((function(n){var t=store.first((function(t){return e.compareLayouts(t,{type:n.type,name:n.oldName})}));if(!t)throw Error("received rename event for unknown layout with type "+n.type+" and name "+n.oldName);t.name=n.newName,e.callbacks.execute("renamed",t)}))},n.prototype.compareLayouts=function(n,e){return n.name===e.name&&n.type===e.type},n.prototype.getObjectValues=function(n){return n?Object.keys(n).map((function(e){return n[e]})):[]},n.prototype.restoredLayout=function(n){var e=this;n&&n.forEach((function(n){var t=store.first((function(t){return e.compareLayouts(t,{type:n.type,name:n.name})}));e.callbacks.execute("restored",t)}))},n}();function streamNull(){return{ready:Promise.resolve(void 0),subscribe:function(){},onEvent:function(n){return function(){}},waitFor:function(n,e){return Promise.resolve(void 0)},gotSnapshot:Promise.resolve(void 0)}}function LayoutsFactory(n){if(!n.agm)throw Error("config.agm is required");if(!n.logger)throw Error("config.logger is required");n.mode=n.mode||"slim";var e,t=n.logger,r=lib$2();return n.mode,e=new ACSStream(n.agm,r),new LayoutsAPIImpl(n,e,r,t)}var T42DisplayCommand="T42.Displays.Command",DisplayManager=function(n,e){var t=this;this._agm=n,this._logger=e,this.all=function(){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.callGD(DisplayCommand.GetAll,{})];case 1:return[2,n.sent().map(this.decorateDisplay)]}}))}))},this.get=function(n){return __awaiter$1(t,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.callGD(DisplayCommand.Get,{id:n})];case 1:return e=t.sent(),[2,this.decorateDisplay(e)]}}))}))},this.getPrimary=function(){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.all()];case 1:return[2,n.sent().find((function(n){return n.isPrimary}))]}}))}))},this.capture=function(n){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.callGD(DisplayCommand.Capture,__assign({},n))];case 1:return[2,e.sent()]}}))}))},this.captureAll=function(n){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.callGD(DisplayCommand.CaptureAll,__assign({},n))];case 1:return[2,e.sent()]}}))}))},this.getMousePosition=function(){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.callGD(DisplayCommand.GetMousePosition)];case 1:return[2,n.sent()]}}))}))},this.callGD=function(n,e){return __awaiter$1(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._agm.invoke(T42DisplayCommand,{options:__assign({},e),command:n})];case 1:return[2,t.sent().returned.data]}}))}))},this.decorateDisplay=function(n){return __assign(__assign({},n),{capture:function(e){return t.capture({id:n.id,size:e})}})}},DisplayCommand,interop,windowId;function setupAGM(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return interop=n,"undefined"!=typeof window&&window.glue42gd&&(windowId=window.glue42gd.windowId),windowId?[4,interop.register("T42.Channels.Command",(function(n){var t=n.command;if(!t)throw new Error("missing command argument");if("join"!==t){if("leave"!==t){if("get"===t)return{id:r=e.current()};throw new Error("unknown command "+t)}e.leaveNoSelectorSwitch()}else{var r;if(!(r=n.channel))throw new Error("missing argument id");e.joinNoSelectorSwitch(r)}}))]:[2];case 1:return t.sent(),interop.invoke("T42.Channels.Announce",{swId:windowId,instance:interop.instance.instance}),[2]}}))}))}function switchChannel(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){return interop.invoke("T42.Channels.Announce",{swId:null!=e?e:windowId,command:"switchChannel",data:{newChannel:n}}),[2]}))}))}!function(n){n.Capture="capture",n.CaptureAll="captureAll",n.GetAll="getAll",n.Get="get",n.GetMousePosition="getMousePosition"}(DisplayCommand||(DisplayCommand={}));var CONTEXT_PREFIX="___channel___",SharedContextSubscriber=function(){function n(n){this.contexts=n}return n.prototype.subscribe=function(n){this.callback=n},n.prototype.subscribeFor=function(n,e){if(!this.isChannel(n))return Promise.reject(new Error("Channel with name: "+n+" doesn't exist!"));var t=this.createContextName(n);return this.contexts.subscribe(t,(function(n,t,r,i,o){var l;e(n.data,n,null===(l=o)||void 0===l?void 0:l.updaterId)}))},n.prototype.switchChannel=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e,t,r=this;return __generator(this,(function(i){switch(i.label){case 0:return this.unsubscribe(),e=this.createContextName(n),t=this,[4,this.contexts.subscribe(e,(function(n,e,t,i,o){var l;r.callback&&r.callback(n.data,n,null===(l=o)||void 0===l?void 0:l.updaterId)}))];case 1:return t.unsubscribeFunc=i.sent(),[2]}}))}))},n.prototype.unsubscribe=function(){this.unsubscribeFunc&&this.unsubscribeFunc()},n.prototype.all=function(){return this.contexts.all().filter((function(n){return n.startsWith(CONTEXT_PREFIX)})).map((function(n){return n.substr(CONTEXT_PREFIX.length)}))},n.prototype.getContextData=function(n){var e=this;return new Promise((function(t,r){if(!e.isChannel(n))return r(new Error("A channel with name: "+n+" doesn't exist!"));var i=e.createContextName(n);e.contexts.subscribe(i,(function(n){t(n)})).then((function(n){return n()}))}))},n.prototype.updateChannel=function(n,e){var t=this.createContextName(n);return this.contexts.update(t,e)},n.prototype.updateData=function(n,e){var t=this.createContextName(n);if(this.contexts.setPathSupported){var r=Object.keys(e).map((function(n){return{path:"data."+n,value:e[n]}}));return this.contexts.setPaths(t,r)}return this.contexts.update(t,{data:e})},n.prototype.isChannel=function(n){return this.all().some((function(e){return e===n}))},n.prototype.createContextName=function(n){return CONTEXT_PREFIX+n},n}(),ChannelsImpl=function(){function n(n){this.shared=n,this.subsKey="subs",this.changedKey="changed",this.registry=lib$2(),this.shared.subscribe(this.handler.bind(this))}return n.prototype.subscribe=function(n){if("function"!=typeof n)throw new Error("Please provide the callback as a function!");return this.registry.add(this.subsKey,n)},n.prototype.subscribeFor=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if("string"!=typeof n)throw new Error("Please provide the name as a string!");if("function"!=typeof e)throw new Error("Please provide the callback as a function!");return[4,this.shared.subscribeFor(n,e)];case 1:return[2,t.sent()]}}))}))},n.prototype.publish=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){if("object"!=typeof n)throw new Error("Please provide the data as an object!");if(e){if("string"!=typeof e)throw new Error("Please provide the name as a string!");return this.shared.isChannel(e)?[2,this.shared.updateData(e,n)]:[2,Promise.reject(new Error("A channel with name: "+e+" doesn't exist!"))]}if(!this.currentContext)throw new Error("Not joined to any channel!");return[2,this.shared.updateData(this.currentContext,n)]}))}))},n.prototype.all=function(){var n=this.shared.all();return Promise.resolve(n)},n.prototype.list=function(){return __awaiter$1(this,void 0,void 0,(function(){var n,e=this;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.all()];case 1:return n=t.sent(),[4,Promise.all(n.map((function(n){return e.get(n)})))];case 2:return[2,t.sent()]}}))}))},n.prototype.get=function(n){return"string"!=typeof n?Promise.reject(new Error("Please provide the channel name as a string!")):this.shared.getContextData(n)},n.prototype.join=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.joinCore(n)]}))}))},n.prototype.joinNoSelectorSwitch=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.joinCore(n,!1)]}))}))},n.prototype.leave=function(){return this.leaveCore()},n.prototype.leaveNoSelectorSwitch=function(){return this.leaveCore(!1)},n.prototype.current=function(){return this.currentContext},n.prototype.my=function(){return this.current()},n.prototype.changed=function(n){if("function"!=typeof n)throw new Error("Please provide the callback as a function!");return this.registry.add(this.changedKey,n)},n.prototype.onChanged=function(n){return this.changed(n)},n.prototype.add=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if("object"!=typeof n)throw new Error("Please provide the info as an object!");if(void 0===n.name)throw new Error("info.name is missing!");if("string"!=typeof n.name)throw new Error("Please provide the info.name as a string!");if(void 0===n.meta)throw new Error("info.meta is missing!");if("object"!=typeof n.meta)throw new Error("Please provide the info.meta as an object!");if(void 0===n.meta.color)throw new Error("info.meta.color is missing!");if("string"!=typeof n.meta.color)throw new Error("Please provide the info.meta.color as a string!");return e={name:n.name,meta:n.meta||{},data:n.data||{}},[4,this.shared.updateChannel(n.name,e)];case 1:return t.sent(),[2,e]}}))}))},n.prototype.handler=function(n,e,t){this.registry.execute(this.subsKey,n,e,t)},n.prototype.joinCore=function(n,e){return void 0===e&&(e=!0),__awaiter$1(this,void 0,void 0,(function(){var t,r=this;return __generator(this,(function(i){switch(i.label){case 0:if("string"!=typeof n)throw new Error("Please provide the channel name as a string!");return n===this.currentContext?[2]:(t=function(n){return r.shared.all().includes(n)})(n)?[3,2]:[4,new Promise((function(e,r){var i,o=setInterval((function(){t(n)&&(clearTimeout(i),clearInterval(o),e())}),100);i=setTimeout((function(){return clearInterval(o),r(new Error("A channel with name: "+n+" doesn't exist!"))}),3e3)}))];case 1:i.sent(),i.label=2;case 2:return this.currentContext=n,[4,this.shared.switchChannel(n)];case 3:return i.sent(),e&&switchChannel(n),this.registry.execute(this.changedKey,n),[2]}}))}))},n.prototype.leaveCore=function(n){return void 0===n&&(n=!0),this.currentContext=void 0,this.registry.execute(this.changedKey,void 0),this.shared.unsubscribe(),n&&switchChannel(),Promise.resolve()},n}();function factory(n,e){var t=new SharedContextSubscriber(n),r=new ChannelsImpl(t);return setupAGM(e,r),{subscribe:r.subscribe.bind(r),subscribeFor:r.subscribeFor.bind(r),publish:r.publish.bind(r),all:r.all.bind(r),list:r.list.bind(r),get:r.get.bind(r),join:r.join.bind(r),leave:r.leave.bind(r),current:r.current.bind(r),my:r.my.bind(r),changed:r.changed.bind(r),onChanged:r.onChanged.bind(r),add:r.add.bind(r),ready:function(){return n.ready()}}}var CommandMethod="T42.Hotkeys.Command",InvokeMethod="T42.Hotkeys.Invoke",RegisterCommand="register",UnregisterCommand="unregister",UnregisterAllCommand="unregisterAll",HotkeysImpl=function(){function n(n){this.agm=n,this.registry=lib$2(),this.firstHotkey=!0,this.hotkeys=new Map}return n.prototype.register=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(void 0===n)throw new Error("Hotkey parameter missing");if("string"==typeof n)n={hotkey:n};else{if(!n.hotkey)throw new Error("Info's hotkey parameter missing");n={hotkey:n.hotkey,description:n.description}}if(t=this.formatHotkey(n.hotkey),this.hotkeys.has(t))throw new Error("Shortcut for "+t+" already registered");return this.firstHotkey?(this.firstHotkey=!1,[4,this.registerInvokeAGMMethod()]):[3,2];case 1:r.sent(),r.label=2;case 2:return this.registry.add(t,e),[4,this.agm.invoke(CommandMethod,{command:RegisterCommand,hotkey:t,description:n.description})];case 3:return r.sent(),this.hotkeys.set(t,n),[2]}}))}))},n.prototype.unregister=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:if(void 0===n)throw new Error("hotkey parameter missing");if("string"!=typeof n)throw new Error("hotkey parameter must be string");return e=this.formatHotkey(n),[4,this.agm.invoke(CommandMethod,{command:UnregisterCommand,hotkey:e})];case 1:return t.sent(),this.hotkeys.delete(e),this.registry.clearKey(e),[2]}}))}))},n.prototype.unregisterAll=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.agm.invoke(CommandMethod,{command:UnregisterAllCommand})];case 1:return n.sent(),this.hotkeys.clear(),this.registry.clear(),[2]}}))}))},n.prototype.isRegistered=function(n){var e=this.formatHotkey(n);return this.hotkeys.has(e)},n.prototype.registerInvokeAGMMethod=function(){var n=this;this.agm.register(InvokeMethod,(function(e){var t=e.key.toLowerCase(),r=n.hotkeys.get(t);n.registry.execute(t,r)}))},n.prototype.formatHotkey=function(n){if(n)return n.replace(/\s/g,"").toLowerCase()},n}();function factory$1(n){var e=new HotkeysImpl(n);return{register:e.register.bind(e),unregister:e.unregister.bind(e),unregisterAll:e.unregisterAll.bind(e),isRegistered:e.isRegistered.bind(e),ready:function(){return Promise.resolve()}}}var version$2="5.4.1",prepareConfig$1=function(n){function e(n,e,r){if("boolean"!=typeof n||n){var i=t(n,e,r);return"object"==typeof n?(n.mode=i,n):{mode:i}}}function t(n,e,r){return"object"==typeof n?t(n.mode,e,r)+"":void 0===n?"boolean"!=typeof e||e?e+"":void 0:"boolean"==typeof n?n?(void 0===r?e:r)+"":void 0:n+""}return{layouts:e(n.layouts,"slim"),activities:e(n.activities,"trackMyTypeAndInitiatedFromMe"),appManager:e(n.appManager,!1,"startOnly"),windows:e(n.windows,!0),channels:e(n.channels||!1,!1),displays:e(n.displays,!0)}},Glue42Notification=function(){function n(n){this.options=n,this.callbacks=lib$2(),this.actions=n.actions,this.body=n.body,this.badge=n.badge,this.data=n.data,this.dir=n.dir,this.icon=n.icon,this.image=n.image,this.lang=n.lang,this.renotify=n.renotify,this.requireInteraction=n.requireInteraction,this.silent=n.silent,this.tag=n.tag,this.timestamp=n.timestamp,this.title=n.title}return n.prototype.close=function(){throw new Error("Method not implemented.")},n.prototype.addEventListener=function(n,e,t){this.callbacks.add(n,e)},n.prototype.removeEventListener=function(n,e,t){},n.prototype.dispatchEvent=function(n){return this.callbacks.execute(n.type,n),!0},n}(),STARTING_INDEX=0,Notifications=function(){function n(n){this.interop=n,this.methodsRegistered=!1,this.methodNameRoot="T42.Notifications.Handler-"+shortid$1(),this.nextId=0,this.notifications={}}return Object.defineProperty(n.prototype,"maxActions",{get:function(){return 2},enumerable:!0,configurable:!0}),n.prototype.raise=function(n){var e,t;return __awaiter$1(this,void 0,void 0,(function(){var r,i,o,l,u,s,a,c,d,h,f;return __generator(this,(function(p){switch(p.label){case 0:if(!n)throw new Error("invalid options - should be an object");if(!n.title)throw new Error("invalid options - should have title");if(this.methodsRegistered)return[3,2];for(r=[],u=STARTING_INDEX;u<this.maxActions;u++)r.push(this.interop.register(this.methodNameRoot+"_"+u,this.handleNotificationAction.bind(this)));return[4,Promise.all(r)];case 1:p.sent(),this.methodsRegistered=!0,p.label=2;case 2:if(i=String(this.nextId++),o={title:n.title,severity:"Medium",description:n.body,glueRoutingDetailMethodName:this.methodNameRoot+"_"+STARTING_INDEX,actions:[],source:i},n.actions)for(l=n.actions.slice(0,this.maxActions),u=STARTING_INDEX,s=function(n){var r={g42notificationId:i,g42action:n.action,g42interopMethod:null===(e=n.interop)||void 0===e?void 0:e.method,g42interopTarget:null===(t=n.interop)||void 0===t?void 0:t.target},l=Object.keys(r).map((function(n){return{name:n,value:{stringValue:r[n]}}})),s={name:a.methodNameRoot+"_"+u,description:n.title,displayName:n.title,parameters:l};o.actions.push(s),u++},a=this,c=0,d=l;c<d.length;c++)h=d[c],s(h);return[4,this.interop.invoke("T42.GNS.Publish.RaiseNotification",{notification:o})];case 3:return p.sent(),f=new Glue42Notification(n),this.notifications[i]=f,[2,f]}}))}))},n.prototype.handleNotificationAction=function(n){if(n.g42notificationId){var e=n,t=e.g42notificationId;if(!(o=this.notifications[t]))return;var r=new Event("onaction");r.action=e.g42action,o.onaction&&o.onaction(r);var i=(o.actions||[]).find((function(n){return n.action===e.g42action})).interop;i&&this.interop.invoke(i.method,i.arguments||{},i.target||"best"),o.dispatchEvent(r)}else if(n.notification&&n.notification.source){var o;t=n.notification.source;if(!(o=this.notifications[t]))return;var l=new Event("onclick");o.onclick&&o.onclick(l);var u=o.options.clickInterop;u&&this.interop.invoke(u.method,u.arguments||{},u.target||"best"),o.dispatchEvent(l)}},n}(),ThemesConfigurationMethodName="T42.Themes.Configuration",ThemesImpl=function(){function n(n){this.core=n,this.registry=lib$2(),this.isSubscribed=!1,this.getConfiguration()}return n.prototype.list=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.getConfiguration()];case 1:if(n.sent(),!this.getMethodName)throw new Error("not supported");return[4,this.getAll()];case 2:return[2,n.sent().returned.all]}}))}))},n.prototype.getCurrent=function(){return __awaiter$1(this,void 0,void 0,(function(){var n;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getConfiguration()];case 1:if(e.sent(),!this.getMethodName)throw new Error("not supported");return[4,this.getAll()];case 2:return[2,(n=e.sent()).returned.all.find((function(e){return e.name===n.returned.selected}))]}}))}))},n.prototype.select=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getConfiguration()];case 1:if(e.sent(),!this.setMethodName)throw new Error("not supported");return[4,this.core.interop.invoke(this.setMethodName,{theme:n})];case 2:return e.sent(),[2]}}))}))},n.prototype.onChanged=function(n){return this.subscribe(),this.registry.add("changed",n)},n.prototype.getConfiguration=function(){return __awaiter$1(this,void 0,void 0,(function(){var n;return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.sharedContextName?[2]:[4,this.core.interop.invoke(ThemesConfigurationMethodName)];case 1:return n=e.sent(),this.sharedContextName=n.returned.sharedContextName,this.getMethodName=n.returned.getThemesMethodName,this.setMethodName=n.returned.setThemesMethodName,[3,3];case 2:return e.sent(),[2];case 3:return[2]}}))}))},n.prototype.getAll=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.getConfiguration()];case 1:return n.sent(),[4,this.core.interop.invoke(this.getMethodName)];case 2:return[2,n.sent()]}}))}))},n.prototype.subscribe=function(){return __awaiter$1(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getConfiguration()];case 1:return e.sent(),this.isSubscribed?[2]:(this.isSubscribed=!0,this.core.contexts.subscribe(this.sharedContextName,(function(e){e&&e.all&&e.selected&&n.registry.execute("changed",e.all.find((function(n){return n.name===e.selected})))})),[2])}}))}))},n}();function factory$2(n){var e=new ThemesImpl(n);return{list:e.list.bind(e),getCurrent:e.getCurrent.bind(e),select:e.select.bind(e),onChanged:e.onChanged.bind(e),ready:function(){return Promise.resolve()}}}var GLUE42_FDC3_INTENTS_METHOD_PREFIX="Tick42.FDC3.Intents.",Intents$1=function(){function n(n,e,t){this.interop=n,this.windows=e,this.logger=t}return n.prototype.find=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.all()];case 1:if(e=r.sent(),void 0===n)return[2,e];if("string"==typeof n)return[2,e.filter((function(e){return e.name===n}))];if("object"!=typeof n)throw new Error("Please provide the intentFilter as a string or an object!");return n.contextType&&(t=n.contextType.toLowerCase(),e=e.filter((function(n){return n.handlers.some((function(n){var e;return null===(e=n.contextTypes)||void 0===e?void 0:e.some((function(n){return n.toLowerCase()===t}))}))}))),n.name&&(e=e.filter((function(e){return e.name===n.name}))),[2,e]}}))}))},n.prototype.raise=function(n){return __awaiter$1(this,void 0,void 0,(function(){var e,t,r,i,o,l,u,s,a;return __generator(this,(function(c){switch(c.label){case 0:if("string"!=typeof n&&"object"!=typeof n||"object"==typeof n&&"string"!=typeof n.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");return"string"==typeof n&&(n={intent:n}),e=n.intent,[4,this.get(e)];case 1:if(void 0===(t=c.sent()))throw new Error("Intent "+e+" not found.");if(r=!t.handlers.some((function(n){return"app"===n.type})),i=n.target||(r?"reuse":"startNew"),l=t.handlers.find((function(n){return"app"===n.type})),"startNew"===i)o=l;else if("reuse"===i)u=t.handlers.find((function(n){return"instance"===n.type})),o=u||l;else if(i.instance)o=t.handlers.find((function(n){return"instance"===n.type&&n.instanceId===i.instance}));else{if(!i.app)throw new Error("Invalid intent target: "+JSON.stringify(i));o=t.handlers.find((function(n){return"app"===n.type&&n.applicationName===i.app}))}if(!o)throw new Error("Can not raise intent for request "+JSON.stringify(n)+" - can not find intent handler.");return s=o.instanceId,"app"!==o.type?[3,3]:[4,this.startApp(o.applicationName,n.options)];case 2:s=c.sent(),c.label=3;case 3:return[4,this.raiseIntentToInstance(s,e,n.context)];case 4:return(a=c.sent()).request=n,a.handler=o,[2,a]}}))}))},n.prototype.all=function(){return __awaiter$1(this,void 0,void 0,(function(){var n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v=this;return __generator(this,(function(m){switch(m.label){case 0:return m.trys.push([0,6,,7]),[4,this.interop.invoke("T42.ACS.GetApplications",{withIntentsInfo:!0})];case 1:for(n=m.sent(),e=n.returned.applications,t={},r=e.filter((function(n){return n.intents&&n.intents.length>0})),i=0,o=r;i<o.length;i++)for(l=o[i],u=0,s=l.intents;u<s.length;u++)a=s[u],(c=t[a.name])||(c={name:a.name,handlers:[]},t[a.name]=c),d={applicationName:l.name,applicationTitle:l.title,applicationDescription:l.caption,displayName:a.displayName,contextTypes:a.contexts,applicationIcon:l.icon,type:"app"},c.handlers.push(d);h=function(n){return __generator(this,(function(r){switch(r.label){case 0:return[4,Promise.all(n.getMethods().filter((function(n){return n.name.startsWith(GLUE42_FDC3_INTENTS_METHOD_PREFIX)})).map((function(r){return __awaiter$1(v,void 0,void 0,(function(){var i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$;return __generator(this,(function(_){switch(_.label){case 0:if(i=r.name.replace(GLUE42_FDC3_INTENTS_METHOD_PREFIX,""),(o=t[i])||(o={name:i,handlers:[]},t[i]=o),r.description)try{l=JSON.parse(r.description)}catch(n){}return(u=e.find((function(e){return e.name===n.application})))&&u.intents&&(s=u.intents.find((function(n){return n.name===i}))),a=this.windows.findById(n.windowId),[4,null===(h=a)||void 0===h?void 0:h.getTitle()];case 1:return c=_.sent(),d={instanceId:n.instance,applicationName:n.application,applicationIcon:(null===(f=l)||void 0===f?void 0:f.icon)||(null===(p=u)||void 0===p?void 0:p.icon),applicationTitle:null===(g=u)||void 0===g?void 0:g.title,applicationDescription:(null===(w=l)||void 0===w?void 0:w.description)||(null===(v=u)||void 0===v?void 0:v.caption),displayName:(null===(m=l)||void 0===m?void 0:m.displayName)||(null===(y=s)||void 0===y?void 0:y.displayName),contextTypes:(null===(b=l)||void 0===b?void 0:b.contextTypes)||(null===($=s)||void 0===$?void 0:$.contexts),instanceTitle:c,type:"instance"},o.handlers.push(d),[2]}}))}))})))];case 1:return r.sent(),[2]}}))},f=0,p=this.interop.servers(),m.label=2;case 2:return f<p.length?(g=p[f],[5,h(g)]):[3,5];case 3:m.sent(),m.label=4;case 4:return f++,[3,2];case 5:return[2,Object.values(t)];case 6:return w=m.sent(),this.logger.error("Failed to get the applications!",w),[2,[]];case 7:return[2]}}))}))},n.prototype.addIntentListener=function(n,e){var t=this;if("string"!=typeof n&&"object"!=typeof n||"object"==typeof n&&"string"!=typeof n.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");if("function"!=typeof e)throw new Error("Please provide the handler as a function!");var r={unsubscribe:function(){return console.log("Could not unsubscribe!")}},i="string"==typeof n?n:n.intent,o=""+GLUE42_FDC3_INTENTS_METHOD_PREFIX+i,l="string"==typeof n?void 0:JSON.stringify(n);return this.interop.register({name:o,description:l},(function(n){return e(n)})).then((function(){r.unsubscribe=function(){t.interop.unregister(o)}})),r},n.prototype.get=function(n){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.all()];case 1:return[2,e.sent().find((function(e){return e.name===n}))]}}))}))},n.prototype.startApp=function(n,e){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.interop.invoke("T42.ACS.StartApplication",{Name:n,options:e})];case 1:return[2,t.sent().returned.Id]}}))}))},n.prototype.raiseIntentToInstance=function(n,e,t){return __awaiter$1(this,void 0,void 0,(function(){var r,i,o=this;return __generator(this,(function(l){switch(l.label){case 0:return r=""+GLUE42_FDC3_INTENTS_METHOD_PREFIX+e,(i=this.interop.servers().find((function(e){return e.instance===n})))?[3,2]:[4,new Promise((function(e,t){var r,l=o.interop.serverAdded((function(t){t.instance===n&&(i=t,e(),clearTimeout(r),l())}));r=setTimeout((function(){l(),t(new Error("Can not find interop server for instance "+n))}),3e4)}))];case 1:l.sent(),l.label=2;case 2:return i.getMethods().find((function(n){return n.name===r}))?[3,4]:[4,new Promise((function(e,t){var i,l=o.interop.methodAdded((function(n){n.name===r&&(e(),clearTimeout(i),l())}));i=setTimeout((function(){l(),t(new Error("Can not find interop method "+r+" for instance "+n))}),1e4)}))];case 3:l.sent(),l.label=4;case 4:return[4,this.interop.invoke(r,t,{instance:n})];case 5:return[2,{result:l.sent().returned}]}}))}))},n}(),instances=[],factory$3=function(n){return __awaiter$1(void 0,void 0,void 0,(function(){function e(n){if(g.windows){var e=d("windows",n.logger,g.windows);return h(m=WindowsFactory(n.agm,e,(function(){return w}),(function(){return y}),p)),m}}function t(n){var e,t;if(g.activities&&ActivityModule.checkIsUsingGW3Implementation&&ActivityModule.checkIsUsingGW3Implementation(n.connection)){var r=d("activity",n.logger,g.activities);return h(v=new ActivityModule({connection:n.connection,contexts:n.contexts,agm:n.agm,logger:r,logLevel:"info",disableAutoAnnounce:!1,disposeRequestHandling:"exit",announcementInfo:null,windows:m,appManagerGetter:function(){return w},mode:g.activities.mode,typesToTrack:g.activities.typesToTrack,activityId:null===(t=null===(e=f)||void 0===e?void 0:e.activityInfo)||void 0===t?void 0:t.activityId,gdMajorVersion:p}).api),v}}function r(n){if(g.appManager){var e=d("appManager",n.logger,g.appManager);return h(w=AppManagerFactory({agm:n.agm,windows:m,logger:e,activities:v,mode:g.appManager.mode,gdMajorVersion:p})),w}}function i(n){var e;if(g.layouts){var t=d("layouts",n.logger,g.layouts),r=g.layouts,i=LayoutsFactory({agm:n.agm,appManager:w,activityGetter:function(){return v},logger:t,mode:r.mode,autoSaveWindowContext:(e=r.autoSaveWindowContext,null!=e&&e),gdMajorVersion:p});return h(i),i}}function o(n){if(g.channels&&n.contexts){var e=factory(n.contexts,n.agm);return h(e),e}}function l(n){var e=factory$1(n.agm);return h(e),e}function u(n){var e=new Intents$1(n.agm,m,n.logger.subLogger("intents"));return h(e),e}function s(n){var e=new Notifications(n.interop);return h(e),e}function a(n){if(g.displays){var e=d("displays",n.logger,g.displays);return h(y=new DisplayManager(n.agm,e)),y}}function c(n){if(n.contexts){var e=factory$2(n);return h(e),e}}function d(n,e,t){var r=e.subLogger(n);if(t&&t.logger){var i=t.logger;i.console&&r.consoleLevel(i.console),i.publish&&r.publishLevel(i.publish)}return r}function h(n){$.push(n)}var f,p,g,w,v,m,y,b,$,_,S;return __generator(this,(function(d){switch(d.label){case 0:return(f="undefined"!=typeof window&&window.glue42gd)&&instances.length>0?[2,instances[0]]:(p=Utils$1.getGDMajorVersion(),g=prepareConfig$1(n=n||{}),n.gateway=n.gateway||{},b={libs:[{name:"windows",create:e},{name:"activities",create:t},{name:"appManager",create:r},{name:"layouts",create:i},{name:"channels",create:o},{name:"hotkeys",create:l},{name:"displays",create:a},{name:"intents",create:u},{name:"notifications",create:s},{name:"themes",create:c}],version:version$2,enrichGlue:function(n){n.config.activities=g.activities,n.config.windows=g.windows,n.config.appManager=g.appManager,n.config.layouts=g.layouts,n.config.channels=g.channels,n.config.displays=g.displays}},$=[],"undefined"!=typeof window&&(window.glueFactoryLog||(window.glueFactoryLog=[]),window.glueFactoryLog.push($)),[4,GlueCore(n,b)]);case 1:return _=d.sent(),instances.push(_),Array.isArray(null===(S=n)||void 0===S?void 0:S.libraries)&&n.libraries.length?[4,Promise.all(n.libraries.map((function(e){return e(_,n)})))]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2,_]}}))}))};factory$3.coreVersion=GlueCore.version,factory$3.version=version$2,factory$3.instances=instances;var whatToExpose=factory$3,shouldSetToWindow=!0;if("undefined"!=typeof window){var glue42gd=window.glue42gd;glue42gd&&glue42gd.autoInjected&&(whatToExpose=window.Glue,shouldSetToWindow=!1),shouldSetToWindow&&(window.Glue=whatToExpose),delete window.GlueCore}whatToExpose.default=whatToExpose;var whatToExpose$1=whatToExpose;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __awaiter$2(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,u)}s((r=r.apply(n,e||[])).next())}))}const defaultConfig={logger:"trace",gateway:{webPlatform:{}},libraries:[]},parseConfig=n=>{var e;const t=Object.assign({},defaultConfig,n);return t.systemLogger&&(t.logger=null!==(e=t.systemLogger.level)&&void 0!==e?e:"trace"),t},checkSingleton=()=>{const n=window.glue42core;if(n){if(n.webStarted)throw new Error("The Glue42 Core Web has already been started for this application.");n.webStarted=!0}else window.glue42core={webStarted:!0}},enterprise=n=>{var e,t;const r={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:n.libraries,logger:null!==(t=null===(e=null==n?void 0:n.systemLogger)||void 0===e?void 0:e.level)&&void 0!==t?t:"warn"};return window.Glue(r)};var ok=function(n){return{ok:!0,result:n}},isOk=function(n){return!0===n.ok},err=function(n){return{ok:!1,error:n}},isErr=function(n){return!1===n.ok},asPromise=function(n){return!0===n.ok?Promise.resolve(n.result):Promise.reject(n.error)},withDefault=function(n,e){return!0===e.ok?e.result:n},withException=function(n){if(!0===n.ok)return n.result;throw n.error},successes=function(n){return n.reduce((function(n,e){return!0===e.ok?n.concat(e.result):n}),[])},map=function(n,e){return!0===e.ok?ok(n(e.result)):e},map2=function(n,e,t){return!1===e.ok?e:!1===t.ok?t:ok(n(e.result,t.result))},mapError=function(n,e){return!0===e.ok?e:err(n(e.error))},andThen=function(n,e){return!0===e.ok?n(e.result):e},result=Object.freeze({ok:ok,isOk:isOk,err:err,isErr:isErr,asPromise:asPromise,withDefault:withDefault,withException:withException,successes:successes,map:map,map2:map2,mapError:mapError,andThen:andThen}),__assign$2=function(){return(__assign$2=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __rest(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function isEqual(n,e){if(n===e)return!0;if(null===n&&null===e)return!0;if(typeof n!=typeof e)return!1;if("object"==typeof n){if(Array.isArray(n)){if(!Array.isArray(e))return!1;if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!isEqual(n[t],e[t]))return!1;return!0}var r=Object.keys(n);if(r.length!==Object.keys(e).length)return!1;for(t=0;t<r.length;t++){if(!e.hasOwnProperty(r[t]))return!1;if(!isEqual(n[r[t]],e[r[t]]))return!1}return!0}}var isJsonArray=function(n){return Array.isArray(n)},isJsonObject=function(n){return"object"==typeof n&&null!==n&&!isJsonArray(n)},typeString=function(n){switch(typeof n){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return n instanceof Array?"an array":null===n?"null":"an object";default:return JSON.stringify(n)}},expectedGot=function(n,e){return"expected "+n+", got "+typeString(e)},printPath=function(n){return n.map((function(n){return"string"==typeof n?"."+n:"["+n+"]"})).join("")},prependAt=function(n,e){var t=e.at,r=__rest(e,["at"]);return __assign$2({at:n+(t||"")},r)},Decoder=function(){function n(e){var t=this;this.decode=e,this.run=function(n){return mapError((function(e){return{kind:"DecoderError",input:n,at:"input"+(e.at||""),message:e.message||""}}),t.decode(n))},this.runPromise=function(n){return asPromise(t.run(n))},this.runWithException=function(n){return withException(t.run(n))},this.map=function(e){return new n((function(n){return map(e,t.decode(n))}))},this.andThen=function(e){return new n((function(n){return andThen((function(t){return e(t).decode(n)}),t.decode(n))}))},this.where=function(e,r){return t.andThen((function(t){return e(t)?n.succeed(t):n.fail(r)}))}}return n.string=function(){return new n((function(n){return"string"==typeof n?ok(n):err({message:expectedGot("a string",n)})}))},n.number=function(){return new n((function(n){return"number"==typeof n?ok(n):err({message:expectedGot("a number",n)})}))},n.boolean=function(){return new n((function(n){return"boolean"==typeof n?ok(n):err({message:expectedGot("a boolean",n)})}))},n.constant=function(e){return new n((function(n){return isEqual(n,e)?ok(e):err({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})}))},n.object=function(e){return new n((function(n){if(isJsonObject(n)&&e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r].decode(n[r]);if(!0!==i.ok)return void 0===n[r]?err({message:"the key '"+r+"' is required but was not present"}):err(prependAt("."+r,i.error));void 0!==i.result&&(t[r]=i.result)}return ok(t)}return isJsonObject(n)?ok(n):err({message:expectedGot("an object",n)})}))},n.array=function(e){return new n((function(n){if(isJsonArray(n)&&e){return n.reduce((function(n,t,r){return map2((function(n,e){return n.concat([e])}),n,function(n,t){return mapError((function(n){return prependAt("["+t+"]",n)}),e.decode(n))}(t,r))}),ok([]))}return isJsonArray(n)?ok(n):err({message:expectedGot("an array",n)})}))},n.tuple=function(e){return new n((function(n){if(isJsonArray(n)){if(n.length!==e.length)return err({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n[r]);if(!i.ok)return err(prependAt("["+r+"]",i.error));t[r]=i.result}return ok(t)}return err({message:expectedGot("a tuple of length "+e.length,n)})}))},n.union=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n.oneOf.apply(n,[e,t].concat(r))},n.intersection=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new n((function(n){return[e,t].concat(r).reduce((function(e,t){return map2(Object.assign,e,t.decode(n))}),ok({}))}))},n.anyJson=function(){return new n((function(n){return ok(n)}))},n.unknownJson=function(){return new n((function(n){return ok(n)}))},n.dict=function(e){return new n((function(n){if(isJsonObject(n)){var t={};for(var r in n)if(n.hasOwnProperty(r)){var i=e.decode(n[r]);if(!0!==i.ok)return err(prependAt("."+r,i.error));t[r]=i.result}return ok(t)}return err({message:expectedGot("an object",n)})}))},n.optional=function(e){return new n((function(n){return null==n?ok(void 0):e.decode(n)}))},n.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new n((function(n){for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n);if(!0===i.ok)return i;t[r]=i.error}var o=t.map((function(n){return"at error"+(n.at||"")+": "+n.message})).join('", "');return err({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},n.withDefault=function(e,t){return new n((function(n){return ok(withDefault(e,t.decode(n)))}))},n.valueAt=function(e,t){return new n((function(n){for(var r=n,i=0;i<e.length;i++){if(void 0===r)return err({at:printPath(e.slice(0,i+1)),message:"path does not exist"});if("string"==typeof e[i]&&!isJsonObject(r))return err({at:printPath(e.slice(0,i+1)),message:expectedGot("an object",r)});if("number"==typeof e[i]&&!isJsonArray(r))return err({at:printPath(e.slice(0,i+1)),message:expectedGot("an array",r)});r=r[e[i]]}return mapError((function(n){return void 0===r?{at:printPath(e),message:"path does not exist"}:prependAt(printPath(e),n)}),t.decode(r))}))},n.succeed=function(e){return new n((function(n){return ok(e)}))},n.fail=function(e){return new n((function(n){return err({message:e})}))},n.lazy=function(e){return new n((function(n){return e().decode(n)}))},n}(),string=Decoder.string,number=Decoder.number,boolean=Decoder.boolean,anyJson=Decoder.anyJson,constant=Decoder.constant,object=Decoder.object,array=Decoder.array,optional=Decoder.optional,oneOf=Decoder.oneOf,lazy=Decoder.lazy;const nonEmptyStringDecoder=string().where((n=>n.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder=number().where((n=>n>=0),"Expected a non-negative number"),libDomainDecoder=oneOf(constant("windows"),constant("appManager"),constant("layouts"),constant("intents")),windowOperationTypesDecoder=oneOf(constant("openWindow"),constant("windowHello"),constant("windowAdded"),constant("windowRemoved"),constant("getBounds"),constant("getUrl"),constant("moveResize"),constant("focus"),constant("close"),constant("getTitle"),constant("setTitle")),appManagerOperationTypesDecoder=oneOf(constant("appHello"),constant("applicationAdded"),constant("applicationRemoved"),constant("applicationChanged"),constant("instanceStarted"),constant("instanceStopped"),constant("applicationStart"),constant("instanceStop")),layoutsOperationTypesDecoder=oneOf(constant("layoutAdded"),constant("layoutChanged"),constant("layoutRemoved"),constant("get"),constant("getAll"),constant("export"),constant("import"),constant("remove")),windowRelativeDirectionDecoder=oneOf(constant("top"),constant("left"),constant("right"),constant("bottom")),windowOpenSettingsDecoder=optional(object({top:optional(number()),left:optional(number()),width:optional(nonNegativeNumberDecoder),height:optional(nonNegativeNumberDecoder),context:optional(anyJson()),relativeTo:optional(nonEmptyStringDecoder),relativeDirection:optional(windowRelativeDirectionDecoder),windowId:optional(nonEmptyStringDecoder)})),openWindowConfigDecoder=object({name:nonEmptyStringDecoder,url:nonEmptyStringDecoder,options:windowOpenSettingsDecoder}),windowHelloDecoder=object({windowId:optional(nonEmptyStringDecoder)}),coreWindowDataDecoder=object({windowId:nonEmptyStringDecoder,name:nonEmptyStringDecoder}),simpleWindowDecoder=object({windowId:nonEmptyStringDecoder}),helloSuccessDecoder=object({windows:array(coreWindowDataDecoder),isWorkspaceFrame:boolean()}),windowTitleConfigDecoder=object({windowId:nonEmptyStringDecoder,title:string()}),windowMoveResizeConfigDecoder=object({windowId:nonEmptyStringDecoder,top:optional(number()),left:optional(number()),width:optional(nonNegativeNumberDecoder),height:optional(nonNegativeNumberDecoder),relative:optional(boolean())}),windowBoundsResultDecoder=object({windowId:nonEmptyStringDecoder,bounds:object({top:number(),left:number(),width:nonNegativeNumberDecoder,height:nonNegativeNumberDecoder})}),windowUrlResultDecoder=object({windowId:nonEmptyStringDecoder,url:nonEmptyStringDecoder}),anyDecoder=anyJson(),boundsDecoder=object({top:optional(number()),left:optional(number()),width:optional(nonNegativeNumberDecoder),height:optional(nonNegativeNumberDecoder)}),instanceDataDecoder=object({id:nonEmptyStringDecoder,applicationName:nonEmptyStringDecoder}),applicationDetailsDecoder=object({url:nonEmptyStringDecoder,top:optional(number()),left:optional(number()),width:optional(nonNegativeNumberDecoder),height:optional(nonNegativeNumberDecoder)}),intentDefinitionDecoder=object({name:nonEmptyStringDecoder,displayName:optional(string()),contexts:optional(array(string())),customConfig:optional(object())}),applicationDefinitionDecoder=object({name:nonEmptyStringDecoder,title:optional(nonEmptyStringDecoder),version:optional(nonEmptyStringDecoder),customProperties:optional(anyJson()),icon:optional(nonEmptyStringDecoder),caption:optional(nonEmptyStringDecoder),details:applicationDetailsDecoder,intents:optional(array(intentDefinitionDecoder))}),appDefinitionOperationDecoder=object({definitions:array(applicationDefinitionDecoder),mode:oneOf(constant("replace"),constant("merge"))}),appRemoveConfigDecoder=object({name:nonEmptyStringDecoder}),appsExportOperationDecoder=object({definitions:array(applicationDefinitionDecoder)}),applicationDataDecoder=object({name:nonEmptyStringDecoder,instances:array(instanceDataDecoder),userProperties:optional(anyJson()),title:optional(nonEmptyStringDecoder),version:optional(nonEmptyStringDecoder),icon:optional(nonEmptyStringDecoder),caption:optional(nonEmptyStringDecoder)}),baseApplicationDataDecoder=object({name:nonEmptyStringDecoder,userProperties:anyJson(),title:optional(nonEmptyStringDecoder),version:optional(nonEmptyStringDecoder),icon:optional(nonEmptyStringDecoder),caption:optional(nonEmptyStringDecoder)}),appHelloSuccessDecoder=object({apps:array(applicationDataDecoder)}),basicInstanceDataDecoder=object({id:nonEmptyStringDecoder}),applicationStartConfigDecoder=object({name:nonEmptyStringDecoder,waitForAGMReady:boolean(),context:optional(anyJson()),top:optional(number()),left:optional(number()),width:optional(nonNegativeNumberDecoder),height:optional(nonNegativeNumberDecoder),relativeTo:optional(nonEmptyStringDecoder),relativeDirection:optional(oneOf(constant("top"),constant("left"),constant("right"),constant("bottom")))}),layoutTypeDecoder=oneOf(constant("Global"),constant("Activity"),constant("ApplicationDefault"),constant("Swimlane"),constant("Workspace")),componentTypeDecoder=oneOf(constant("application"),constant("activity")),windowLayoutComponentDecoder=object({type:constant("window"),componentType:componentTypeDecoder,state:object({name:anyJson(),context:anyJson(),url:nonEmptyStringDecoder,bounds:anyJson(),id:nonEmptyStringDecoder,parentId:optional(nonEmptyStringDecoder),main:boolean()})}),windowLayoutItemDecoder=object({type:constant("window"),config:object({appName:nonEmptyStringDecoder,url:optional(nonEmptyStringDecoder)})}),groupLayoutItemDecoder=object({type:constant("group"),config:anyJson(),children:array(oneOf(windowLayoutItemDecoder))}),columnLayoutItemDecoder=object({type:constant("column"),config:anyJson(),children:array(oneOf(groupLayoutItemDecoder,windowLayoutItemDecoder,lazy((()=>columnLayoutItemDecoder)),lazy((()=>rowLayoutItemDecoder))))}),rowLayoutItemDecoder=object({type:constant("row"),config:anyJson(),children:array(oneOf(columnLayoutItemDecoder,groupLayoutItemDecoder,windowLayoutItemDecoder,lazy((()=>rowLayoutItemDecoder))))}),workspaceLayoutComponentDecoder=object({type:constant("Workspace"),state:object({config:anyJson(),context:anyJson(),children:array(oneOf(rowLayoutItemDecoder,columnLayoutItemDecoder,groupLayoutItemDecoder,windowLayoutItemDecoder))})}),glueLayoutDecoder=object({name:nonEmptyStringDecoder,type:layoutTypeDecoder,components:array(oneOf(windowLayoutComponentDecoder,workspaceLayoutComponentDecoder)),context:optional(anyJson()),metadata:optional(anyJson())}),newLayoutOptionsDecoder=object({name:nonEmptyStringDecoder,context:optional(anyJson()),metadata:optional(anyJson())}),restoreOptionsDecoder=object({name:nonEmptyStringDecoder,context:optional(anyJson()),closeRunningInstance:optional(boolean())}),layoutSummaryDecoder=object({name:nonEmptyStringDecoder,type:layoutTypeDecoder,context:optional(anyJson()),metadata:optional(anyJson())}),simpleLayoutConfigDecoder=object({name:nonEmptyStringDecoder,type:layoutTypeDecoder}),getAllLayoutsConfigDecoder=object({type:layoutTypeDecoder}),allLayoutsFullConfigDecoder=object({layouts:array(glueLayoutDecoder)}),importModeDecoder=oneOf(constant("replace"),constant("merge")),layoutsImportConfigDecoder=object({layouts:array(glueLayoutDecoder),mode:importModeDecoder}),allLayoutsSummariesResultDecoder=object({summaries:array(layoutSummaryDecoder)}),simpleLayoutResult=object({layout:glueLayoutDecoder}),optionalSimpleLayoutResult=object({layout:optional(glueLayoutDecoder)}),intentsOperationTypesDecoder=oneOf(constant("findIntent"),constant("getIntents"),constant("raiseIntent")),intentHandlerDecoder=object({applicationName:nonEmptyStringDecoder,applicationTitle:string(),applicationDescription:optional(string()),applicationIcon:optional(string()),type:oneOf(constant("app"),constant("instance")),displayName:optional(string()),contextTypes:optional(array(nonEmptyStringDecoder)),instanceId:optional(string()),instanceTitle:optional(string())}),intentDecoder=object({name:nonEmptyStringDecoder,handlers:array(intentHandlerDecoder)}),intentTargetDecoder=oneOf(constant("startNew"),constant("reuse"),object({app:optional(nonEmptyStringDecoder),instance:optional(nonEmptyStringDecoder)})),intentContextDecoder=object({type:optional(nonEmptyStringDecoder),data:optional(object())}),intentsDecoder=array(intentDecoder),wrappedIntentsDecoder=object({intents:intentsDecoder}),intentFilterDecoder=object({name:optional(nonEmptyStringDecoder),contextType:optional(nonEmptyStringDecoder)}),findFilterDecoder=oneOf(nonEmptyStringDecoder,intentFilterDecoder),wrappedIntentFilterDecoder=object({filter:optional(intentFilterDecoder)}),intentRequestDecoder=object({intent:nonEmptyStringDecoder,target:optional(intentTargetDecoder),context:optional(intentContextDecoder),options:optional(windowOpenSettingsDecoder)}),raiseRequestDecoder=oneOf(nonEmptyStringDecoder,intentRequestDecoder),intentResultDecoder=object({request:intentRequestDecoder,handler:intentHandlerDecoder,result:anyJson()}),addIntentListenerRequestDecoder=object({intent:nonEmptyStringDecoder,contextTypes:optional(array(nonEmptyStringDecoder)),displayName:optional(string()),icon:optional(string()),description:optional(string())}),addIntentListenerIntentDecoder=oneOf(nonEmptyStringDecoder,addIntentListenerRequestDecoder),channelNameDecoder=n=>nonEmptyStringDecoder.where((e=>n.includes(e)),"Expected a valid channel name"),operations={openWindow:{name:"openWindow",dataDecoder:openWindowConfigDecoder,resultDecoder:coreWindowDataDecoder},windowHello:{name:"windowHello",dataDecoder:windowHelloDecoder,resultDecoder:helloSuccessDecoder},windowAdded:{name:"windowAdded",dataDecoder:coreWindowDataDecoder},windowRemoved:{name:"windowRemoved",dataDecoder:simpleWindowDecoder},getBounds:{name:"getBounds",dataDecoder:simpleWindowDecoder,resultDecoder:windowBoundsResultDecoder},getUrl:{name:"getUrl",dataDecoder:simpleWindowDecoder,resultDecoder:windowUrlResultDecoder},moveResize:{name:"moveResize",dataDecoder:windowMoveResizeConfigDecoder},focus:{name:"focus",dataDecoder:simpleWindowDecoder},close:{name:"close",dataDecoder:simpleWindowDecoder},getTitle:{name:"getTitle",dataDecoder:simpleWindowDecoder,resultDecoder:windowTitleConfigDecoder},setTitle:{name:"setTitle",dataDecoder:windowTitleConfigDecoder}};function createRegistry$2(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[]),t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$2.default=createRegistry$2;var lib$4=createRegistry$2;class WebWindowModel{constructor(n,e,t){this._id=n,this._name=e,this._bridge=t,this.registry=lib$4(),this.myCtxKey="___window___"+this.id}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}toApi(){return __awaiter$2(this,void 0,void 0,(function*(){this.ctxUnsubscribe=yield this._bridge.contextLib.subscribe(this.myCtxKey,(n=>this.registry.execute("context-updated",n)));const n={id:this.id,name:this.name,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this)};return this.me=Object.freeze(n),this.me}))}getURL(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations.getUrl,{windowId:this.id})).url}))}moveResize(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=boundsDecoder.runWithException(n),t=Object.assign({},e,{windowId:this.id,relative:!1});return yield this._bridge.send("windows",operations.moveResize,t),this.me}))}resizeTo(n,e){return __awaiter$2(this,void 0,void 0,(function*(){if(void 0===n&&void 0===e)return this.me;void 0!==n&&nonNegativeNumberDecoder.runWithException(n),void 0!==e&&nonNegativeNumberDecoder.runWithException(e);const t=Object.assign({},{width:n,height:e},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations.moveResize,t),this.me}))}moveTo(n,e){return __awaiter$2(this,void 0,void 0,(function*(){if(void 0===n&&void 0===e)return this.me;void 0!==n&&number().runWithException(n),void 0!==e&&number().runWithException(e);const t=Object.assign({},{top:n,left:e},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations.moveResize,t),this.me}))}focus(){return __awaiter$2(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",operations.focus,{windowId:this.id}),this.me}))}close(){return __awaiter$2(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",operations.close,{windowId:this.id}),this.me}))}getTitle(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations.getTitle,{windowId:this.id})).title}))}setTitle(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=nonEmptyStringDecoder.runWithException(n);return yield this._bridge.send("windows",operations.setTitle,{windowId:this.id,title:e}),this.me}))}getBounds(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations.getBounds,{windowId:this.id})).bounds}))}getContext(){return __awaiter$2(this,void 0,void 0,(function*(){return yield this._bridge.contextLib.get(this.myCtxKey)}))}updateContext(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=anyDecoder.runWithException(n);return yield this._bridge.contextLib.update(this.myCtxKey,e),this.me}))}setContext(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=anyDecoder.runWithException(n);return yield this._bridge.contextLib.set(this.myCtxKey,e),this.me}))}onContextUpdated(n){if("function"!=typeof n)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("context-updated",(e=>{n(e,this.me)}))}}class WindowsController{constructor(){this.registry=lib$4(),this.allWindowProjections=[]}start(n,e){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=n.connection.transport.publicWindowId,this.actualWindowId=n.interop.instance.windowId,this.addWindowOperationExecutors(),this.ioc=e,this.bridge=e.bridge,this.logger.trace(`set the public window id: ${this.publicWindowId} and actual window id: ${this.actualWindowId}, set the bridge operations and ioc, registering with the platform now`),this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const t=this.toApi();n.windows=t}))}handleBridgeMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){yield this.platformRegistration;const e=windowOperationTypesDecoder.runWithException(n.operation),t=operations[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}open(n,e,t){return __awaiter$2(this,void 0,void 0,(function*(){nonEmptyStringDecoder.runWithException(n),nonEmptyStringDecoder.runWithException(e);const r=windowOpenSettingsDecoder.runWithException(t),i=yield this.bridge.send("windows",operations.openWindow,{name:n,url:e,options:r});return(yield this.ioc.buildWebWindow(i.windowId,i.name)).api}))}list(){return this.allWindowProjections.map((n=>n.api))}findById(n){var e;return nonEmptyStringDecoder.runWithException(n),null===(e=this.allWindowProjections.find((e=>e.id===n)))||void 0===e?void 0:e.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this)}}addWindowOperationExecutors(){operations.windowAdded.execute=this.handleWindowAdded.bind(this),operations.windowRemoved.execute=this.handleWindowRemoved.bind(this),operations.getBounds.execute=this.handleGetBounds.bind(this),operations.getTitle.execute=this.handleGetTitle.bind(this),operations.getUrl.execute=this.handleGetUrl.bind(this),operations.moveResize.execute=this.handleMoveResize.bind(this),operations.setTitle.execute=this.handleSetTitle.bind(this)}my(){return Object.assign({},this.me)}onWindowAdded(n){if("function"!=typeof n)throw new Error("Cannot subscribe to window added, because the provided callback is not a function!");return this.registry.add("window-added",n)}onWindowRemoved(n){if("function"!=typeof n)throw new Error("Cannot subscribe to window removed, because the provided callback is not a function!");return this.registry.add("window-removed",n)}sayHello(){return __awaiter$2(this,void 0,void 0,(function*(){return yield this.bridge.send("windows",operations.windowHello,{windowId:this.actualWindowId})}))}registerWithPlatform(){return __awaiter$2(this,void 0,void 0,(function*(){const{windows:n,isWorkspaceFrame:e}=yield this.sayHello();if(this.logger.trace("the platform responded to the hello message"),!e){this.logger.trace("i am not treated as a workspace frame, setting my window");const e=n.find((n=>n.windowId===this.publicWindowId));if(!e)throw new Error("Cannot initialize the window library, because I received no information about me from the platform");this.me=(yield this.ioc.buildWebWindow(this.publicWindowId,e.name)).api}const t=yield Promise.all(n.map((n=>this.ioc.buildWebWindow(n.windowId,n.name))));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...t)}))}handleWindowAdded(n){return __awaiter$2(this,void 0,void 0,(function*(){if(this.allWindowProjections.some((e=>e.id===n.windowId)))return;const e=yield this.ioc.buildWebWindow(n.windowId,n.name);this.allWindowProjections.push(e),this.registry.execute("window-added",e.api)}))}handleWindowRemoved(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=this.allWindowProjections.find((e=>e.id===n.windowId));e&&(this.allWindowProjections=this.allWindowProjections.filter((e=>e.id!==n.windowId)),e.model.clean(),this.registry.execute("window-removed",e.api))}))}handleGetBounds(){return __awaiter$2(this,void 0,void 0,(function*(){return{windowId:this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}))}handleGetTitle(){return __awaiter$2(this,void 0,void 0,(function*(){return{windowId:this.me.id,title:document.title}}))}handleGetUrl(){return __awaiter$2(this,void 0,void 0,(function*(){return{windowId:this.me.id,url:window.location.href}}))}handleMoveResize(n){return __awaiter$2(this,void 0,void 0,(function*(){const e="number"==typeof n.top?n.top:n.relative?0:window.screenTop,t="number"==typeof n.left?n.left:n.relative?0:window.screenLeft,r="number"==typeof n.height?n.height:n.relative?0:window.innerHeight,i="number"==typeof n.width?n.width:n.relative?0:window.innerWidth,o=n.relative?window.moveBy:window.moveTo,l=n.relative?window.resizeBy:window.resizeTo;o(t,e),l(i,r)}))}handleSetTitle(n){return __awaiter$2(this,void 0,void 0,(function*(){document.title=n.title}))}}const PromiseWrap=(n,e,t)=>new Promise(((r,i)=>{let o=!0;const l=setTimeout((()=>{if(!o)return;o=!1;i(t||"Promise timeout hit: "+e)}),e);n().then((n=>{o&&(o=!1,clearTimeout(l),r(n))})).catch((n=>{o&&(o=!1,clearTimeout(l),i(n))}))})),PromisePlus=(n,e,t)=>new Promise(((r,i)=>{const o=setTimeout((()=>{i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((n=>{clearTimeout(o),r(n)})).catch((n=>{clearTimeout(o),i(n)}))})),GlueWebPlatformControlName="T42.Web.Platform.Control",GlueWebPlatformStreamName="T42.Web.Platform.Stream",GlueClientControlName="T42.Web.Client.Control";class GlueBridge{constructor(n){this.coreGlue=n,this.platformMethodTimeoutMs=1e4}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}start(n){return __awaiter$2(this,void 0,void 0,(function*(){this.controllers=n,yield Promise.all([this.checkWaitMethod(GlueWebPlatformControlName),this.checkWaitMethod(GlueWebPlatformStreamName)]);const[e]=yield Promise.all([this.coreGlue.interop.subscribe(GlueWebPlatformStreamName),this.coreGlue.interop.registerAsync(GlueClientControlName,((n,e,t,r)=>this.passMessageController(n,t,r)))]);this.sub=e,this.sub.onData((n=>this.passMessageController(n.data)))}))}getInteropInstance(n){const e=this.coreGlue.interop.servers().find((e=>e.windowId&&e.windowId===n));return{application:null==e?void 0:e.application,applicationName:null==e?void 0:e.applicationName,peerId:null==e?void 0:e.peerId,instance:null==e?void 0:e.instance,windowId:null==e?void 0:e.windowId}}send(n,e,t){return __awaiter$2(this,void 0,void 0,(function*(){if(e.dataDecoder)try{e.dataDecoder.runWithException(t)}catch(n){throw new Error(`Unexpected internal outgoing validation error: ${n.message}, for operation: ${e.name} and input: ${JSON.stringify(n.input)}`)}let r;try{r=yield this.transmitMessage(n,e,t),e.resultDecoder&&(r=e.resultDecoder.runWithException(r))}catch(n){if(n.kind)throw new Error(`Unexpected internal incoming validation error: ${n.message}, for operation: ${e.name} and input: ${JSON.stringify(n.input)}`);throw new Error(n.message)}return r}))}checkWaitMethod(n){return PromisePlus((e=>{if(this.coreGlue.interop.methods().some((e=>e.name===n)))return e();const t=this.coreGlue.interop.methodAdded((r=>{r.name===n&&(t(),e())}))}),this.platformMethodTimeoutMs,"Cannot initiate Glue Web, because a system method's discovery timed out: "+n)}passMessageController(n,e,t){const r=libDomainDecoder.run(n.domain);if(!r.ok)return void(t&&t("Cannot execute this client control, because of domain validation error: "+JSON.stringify(r.error)));const i=r.result;this.controllers[i].handleBridgeMessage(n).then((n=>{e&&e(n)})).catch((n=>{t&&t(n),console.warn(n)}))}transmitMessage(n,e,t){return __awaiter$2(this,void 0,void 0,(function*(){const r={domain:n,data:t,operation:e.name};let i;const o=`Internal Platform Communication Error. Attempted operation: ${JSON.stringify(e.name)} with data: ${JSON.stringify(t)}. `;try{if(i=yield this.coreGlue.interop.invoke(GlueWebPlatformControlName,r),!i)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(i.all_return_values)||0===i.all_return_values.length)throw new Error("Received unsupported result from the platform - empty values collection")}catch(n){if(n&&n.all_errors&&n.all_errors.length){const e=n.all_errors[0].message;throw new Error(`${o} -> Inner message: ${e}`)}throw new Error(`${o} -> Inner message: ${n.message}`)}return i.all_return_values[0].returned}))}}const operations$1={appHello:{name:"appHello",dataDecoder:windowHelloDecoder,resultDecoder:appHelloSuccessDecoder},applicationAdded:{name:"applicationAdded",dataDecoder:baseApplicationDataDecoder},applicationRemoved:{name:"applicationRemoved",dataDecoder:baseApplicationDataDecoder},applicationChanged:{name:"applicationChanged",dataDecoder:baseApplicationDataDecoder},instanceStarted:{name:"instanceStarted",dataDecoder:instanceDataDecoder},instanceStopped:{name:"instanceStopped",dataDecoder:instanceDataDecoder},applicationStart:{name:"applicationStart",dataDecoder:applicationStartConfigDecoder,resultDecoder:instanceDataDecoder},instanceStop:{name:"instanceStop",dataDecoder:basicInstanceDataDecoder},import:{name:"import"},remove:{name:"remove",dataDecoder:appRemoveConfigDecoder},export:{name:"export",resultDecoder:appsExportOperationDecoder}};class AppManagerController{constructor(){this.registry=lib$4(),this.applications=[],this.instances=[]}start(n,e){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=n.connection.transport.publicWindowId,this.actualWindowId=n.interop.instance.windowId,this.addOperationsExecutors(),this.ioc=e,this.bridge=e.bridge,this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const t=this.toApi();n.appManager=t}))}handleBridgeMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){yield this.platformRegistration;const e=appManagerOperationTypesDecoder.runWithException(n.operation),t=operations$1[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}onInstanceStarted(n){return this.registry.add("instance-started",n,this.instances)}onInstanceStopped(n){return this.registry.add("instance-stopped",n)}startApplication(n,e,t){var r;return __awaiter$2(this,void 0,void 0,(function*(){const i={name:n,waitForAGMReady:null===(r=null==t?void 0:t.waitForAGMReady)||void 0===r||r,context:e,top:null==t?void 0:t.top,left:null==t?void 0:t.left,width:null==t?void 0:t.width,height:null==t?void 0:t.height,relativeTo:null==t?void 0:t.relativeTo,relativeDirection:null==t?void 0:t.relativeDirection},o=yield this.bridge.send("appManager",operations$1.applicationStart,i),l=this.applications.find((n=>n.name===o.applicationName));return this.ioc.buildInstance(o,l)}))}toApi(){const n={myInstance:this.me,import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return Object.freeze(n)}addOperationsExecutors(){operations$1.applicationAdded.execute=this.handleApplicationAddedMessage.bind(this),operations$1.applicationRemoved.execute=this.handleApplicationRemovedMessage.bind(this),operations$1.applicationChanged.execute=this.handleApplicationChangedMessage.bind(this),operations$1.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),operations$1.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}onAppAdded(n){return this.registry.add("application-added",n,this.applications)}onAppRemoved(n){return this.registry.add("application-removed",n)}onAppChanged(n){return this.registry.add("application-changed",n)}handleApplicationAddedMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){if(this.applications.some((e=>e.name===n.name)))return;const e=yield this.ioc.buildApplication(n,[]),t=this.instances.filter((n=>n.application.name===e.name));e.instances.push(...t),this.applications.push(e),this.registry.execute("application-added",e)}))}handleApplicationRemovedMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=this.applications.findIndex((e=>e.name===n.name));if(e<0)return;const t=this.applications[e];this.applications.splice(e,1),this.registry.execute("application-removed",t)}))}handleApplicationChangedMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=this.applications.find((e=>e.name===n.name));if(!e)return this.handleApplicationAddedMessage(n);e.title=n.title,e.version=n.version,e.icon=n.icon,e.caption=n.caption,e.userProperties=n.userProperties,this.registry.execute("application-changed",e)}))}handleInstanceStartedMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){if(this.instances.some((e=>e.id===n.id)))return;const e=this.applications.find((e=>e.name===n.applicationName));if(!e)throw new Error(`Cannot add instance: ${n.id}, because there is no application definition associated with it`);const t=this.ioc.buildInstance(n,e);this.instances.push(t),e.instances.push(t),this.registry.execute("instance-started",t)}))}handleInstanceStoppedMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=this.instances.find((e=>e.id===n.id));if(e){const e=this.instances.findIndex((e=>e.id===n.id));this.instances.splice(e,1)}const t=this.applications.find((e=>e.instances.some((e=>e.id===n.id))));if(t){const e=t.instances.findIndex((e=>e.id===n.id));t.instances.splice(e,1)}e&&this.registry.execute("instance-stopped",e)}))}import(n,e="replace"){return __awaiter$2(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$1.import,{definitions:n,mode:e})}))}remove(n){return __awaiter$2(this,void 0,void 0,(function*(){nonEmptyStringDecoder.runWithException(n),yield this.bridge.send("appManager",operations$1.remove,{name:n})}))}export(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.bridge.send("appManager",operations$1.export,void 0)).definitions}))}getApplication(n){const e=nonEmptyStringDecoder.runWithException(n);return this.applications.find((n=>n.name===e))}getApplications(){return this.applications.slice()}getInstances(){return this.instances.slice()}registerWithPlatform(){return __awaiter$2(this,void 0,void 0,(function*(){const n=yield this.bridge.send("appManager",operations$1.appHello,{windowId:this.actualWindowId});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=yield Promise.all(n.apps.map((n=>this.ioc.buildApplication(n,n.instances)))),this.instances=this.applications.reduce(((n,e)=>(n.push(...e.instances),n)),[]),this.me=this.findMyInstance(),this.logger.trace(`all applications were parsed and saved. I am ${this.me?"NOT a":"a"} valid instance`)}))}findMyInstance(){for(const n of this.applications){const e=n.instances.find((n=>n.id===this.publicWindowId));if(e)return e}}}class InstanceModel{constructor(n,e,t){this.data=n,this.bridge=e,this.application=t,this.myCtxKey="___instance___"+this.data.id}toApi(){const n=this.bridge.getInteropInstance(this.data.id),e={id:this.data.id,agm:n,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(e),this.me}getContext(){return __awaiter$2(this,void 0,void 0,(function*(){return this.bridge.contextLib.get(this.myCtxKey)}))}stop(){return __awaiter$2(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$1.instanceStop,{id:this.data.id})}))}}class ApplicationModel{constructor(n,e,t){this.data=n,this.instances=e,this.controller=t}toApi(){const n={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=n,this.me}onInstanceStarted(n){if("function"!=typeof n)throw new Error("OnInstanceStarted requires a single argument of type function");this.controller.onInstanceStarted((e=>{e.application.name===this.data.name&&n(e)}))}onInstanceStopped(n){if("function"!=typeof n)throw new Error("OnInstanceStarted requires a single argument of type function");this.controller.onInstanceStopped((e=>{e.application.name===this.data.name&&n(e)}))}start(n,e){return __awaiter$2(this,void 0,void 0,(function*(){return this.controller.startApplication(this.data.name,n,e)}))}}const operations$2={layoutAdded:{name:"layoutAdded",dataDecoder:glueLayoutDecoder},layoutChanged:{name:"layoutChanged",dataDecoder:glueLayoutDecoder},layoutRemoved:{name:"layoutRemoved",dataDecoder:glueLayoutDecoder},get:{name:"get",dataDecoder:simpleLayoutConfigDecoder,resultDecoder:optionalSimpleLayoutResult},getAll:{name:"getAll",dataDecoder:getAllLayoutsConfigDecoder,resultDecoder:allLayoutsSummariesResultDecoder},export:{name:"export",dataDecoder:getAllLayoutsConfigDecoder,resultDecoder:allLayoutsFullConfigDecoder},import:{name:"import",dataDecoder:layoutsImportConfigDecoder},remove:{name:"remove",dataDecoder:simpleLayoutConfigDecoder}};class LayoutsController{constructor(){this.registry=lib$4()}start(n,e){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=e.bridge,this.addOperationsExecutors();const t=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),n.layouts=t}))}handleBridgeMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=layoutsOperationTypesDecoder.runWithException(n.operation),t=operations$2[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}toApi(){const n={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this)};return Object.freeze(n)}addOperationsExecutors(){operations$2.layoutAdded.execute=this.handleOnAdded.bind(this),operations$2.layoutChanged.execute=this.handleOnChanged.bind(this),operations$2.layoutRemoved.execute=this.handleOnRemoved.bind(this)}get(n,e){return __awaiter$2(this,void 0,void 0,(function*(){nonEmptyStringDecoder.runWithException(n),layoutTypeDecoder.runWithException(e);return(yield this.bridge.send("layouts",operations$2.get,{name:n,type:e})).layout}))}getAll(n){return __awaiter$2(this,void 0,void 0,(function*(){layoutTypeDecoder.runWithException(n);return(yield this.bridge.send("layouts",operations$2.getAll,{type:n})).summaries}))}export(n){return __awaiter$2(this,void 0,void 0,(function*(){n&&layoutTypeDecoder.runWithException(n);return(yield this.bridge.send("layouts",operations$2.export,{type:"Workspace"})).layouts}))}import(n,e="replace"){return __awaiter$2(this,void 0,void 0,(function*(){n.forEach((n=>glueLayoutDecoder.runWithException(n))),importModeDecoder.runWithException(e),yield this.bridge.send("layouts",operations$2.import,{layouts:n,mode:e})}))}save(n){return __awaiter$2(this,void 0,void 0,(function*(){throw newLayoutOptionsDecoder.runWithException(n),new Error("Save is not supported in Core at the moment")}))}restore(n){return __awaiter$2(this,void 0,void 0,(function*(){throw restoreOptionsDecoder.runWithException(n),new Error("Restore is not supported in Core at the moment")}))}remove(n,e){return __awaiter$2(this,void 0,void 0,(function*(){layoutTypeDecoder.runWithException(n),nonEmptyStringDecoder.runWithException(e),yield this.bridge.send("layouts",operations$2.remove,{type:n,name:e})}))}onAdded(n){return this.registry.add(operations$2.layoutAdded.name,n)}onChanged(n){return this.registry.add(operations$2.layoutChanged.name,n)}onRemoved(n){return this.registry.add(operations$2.layoutRemoved.name,n)}handleOnAdded(n){return __awaiter$2(this,void 0,void 0,(function*(){this.registry.execute(operations$2.layoutAdded.name,n)}))}handleOnChanged(n){return __awaiter$2(this,void 0,void 0,(function*(){this.registry.execute(operations$2.layoutChanged.name,n)}))}handleOnRemoved(n){return __awaiter$2(this,void 0,void 0,(function*(){this.registry.execute(operations$2.layoutRemoved.name,n)}))}}class NotificationsController{start(n){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.interop=n.interop;const e=this.toApi();n.notifications=e,this.logger.trace("notifications are ready")}))}handleBridgeMessage(){return __awaiter$2(this,void 0,void 0,(function*(){}))}toApi(){const n={raise:this.raise.bind(this)};return Object.freeze(n)}raise(n){return __awaiter$2(this,void 0,void 0,(function*(){if(!("Notification"in window))throw new Error("this browser does not support desktop notification");let e;e="granted"===Notification.permission?Promise.resolve("granted"):"denied"===Notification.permission?Promise.reject("no permissions from user"):Notification.requestPermission(),yield e;const t=this.raiseUsingWebApi(n);if(n.clickInterop){const e=n.clickInterop;t.onclick=()=>{var n,t;this.interop.invoke(e.method,null!==(n=null==e?void 0:e.arguments)&&void 0!==n?n:{},null!==(t=null==e?void 0:e.target)&&void 0!==t?t:"best")}}return t}))}raiseUsingWebApi(n){return new Notification(n.title)}}const operations$3={getIntents:{name:"getIntents",resultDecoder:wrappedIntentsDecoder},findIntent:{name:"findIntent",dataDecoder:wrappedIntentFilterDecoder,resultDecoder:wrappedIntentsDecoder},raiseIntent:{name:"raiseIntent",dataDecoder:intentRequestDecoder,resultDecoder:intentResultDecoder}};class IntentsController{constructor(){this.myIntents=new Set,this.GlueWebIntentsPrefix="Tick42.FDC3.Intents."}start(n,e){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=e.bridge,this.interop=n.interop;const t=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),n.intents=t}))}handleBridgeMessage(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=intentsOperationTypesDecoder.runWithException(n.operation),t=operations$3[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}toApi(){const n={raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),find:this.find.bind(this)};return Object.freeze(n)}raise(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=raiseRequestDecoder.runWithException(n);let t;t="string"==typeof e?{intent:e}:e;return yield this.bridge.send("intents",operations$3.raiseIntent,t)}))}all(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.bridge.send("intents",operations$3.getIntents,void 0)).intents}))}addIntentListener(n,e){if(addIntentListenerIntentDecoder.runWithException(n),"function"!=typeof e)throw new Error("Cannot add intent listener, because the provided handler is not a function!");let t=!0;const r="string"==typeof n?n:n.intent,i=`${this.GlueWebIntentsPrefix}${r}`;if(this.myIntents.has(r))throw new Error(`Intent listener for intent ${r} already registered!`);this.myIntents.add(r);const o={unsubscribe:()=>{t=!1;try{this.interop.unregister(i),this.myIntents.delete(r)}catch(n){this.logger.trace(`Unsubscribed intent listener, but ${i} unregistration failed!`)}}},l="string"==typeof n?void 0:JSON.stringify(n);return this.interop.register({name:i,description:l},(n=>{if(t)return e(n)})),o}find(n){return __awaiter$2(this,void 0,void 0,(function*(){let e=void 0;if(void 0!==n){const t=findFilterDecoder.runWithException(n);"string"==typeof t?e={filter:{name:t}}:"object"==typeof t&&(e={filter:t})}return(yield this.bridge.send("intents",operations$3.findIntent,e)).intents}))}}class ChannelsController{constructor(){this.registry=lib$4(),this.GlueWebChannelsPrefix="___channel___",this.SubsKey="subs",this.ChangedKey="changed"}start(n){return __awaiter$2(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=n.contexts,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning");const e=this.toApi();n.channels=e}))}handleBridgeMessage(){return __awaiter$2(this,void 0,void 0,(function*(){}))}toApi(){const n={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this)};return Object.freeze(n)}createContextName(n){return`${this.GlueWebChannelsPrefix}${n}`}getAllChannelNames(){return this.contexts.all().filter((n=>n.startsWith(this.GlueWebChannelsPrefix))).map((n=>n.replace(this.GlueWebChannelsPrefix,"")))}unsubscribe(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}switchToChannel(n){return __awaiter$2(this,void 0,void 0,(function*(){if(this.unsubscribe(),this.currentChannelName=n,void 0!==n){const e=this.createContextName(n);this.unsubscribeFunc=yield this.contexts.subscribe(e,((n,e,t,r,i)=>{this.registry.execute(this.SubsKey,n.data,n,null==i?void 0:i.updaterId)}))}this.registry.execute(this.ChangedKey,n)}))}updateData(n,e){return __awaiter$2(this,void 0,void 0,(function*(){const t=this.createContextName(n);if(this.contexts.setPathSupported){const n=Object.keys(e).map((n=>({path:"data."+n,value:e[n]})));yield this.contexts.setPaths(t,n)}else yield this.contexts.update(t,{data:e})}))}subscribe(n){if("function"!=typeof n)throw new Error("Cannot subscribe to channels, because the provided callback is not a function!");return this.registry.add(this.SubsKey,n)}subscribeFor(n,e){return __awaiter$2(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();if(channelNameDecoder(t).runWithException(n),"function"!=typeof e)throw new Error(`Cannot subscribe to channel ${n}, because the provided callback is not a function!`);const r=this.createContextName(n);return this.contexts.subscribe(r,((n,t,r,i,o)=>{e(n.data,n,null==o?void 0:o.updaterId)}))}))}publish(n,e){if("object"!=typeof n)throw new Error("Cannot publish to channel, because the provided data is not an object!");if(void 0!==e){const t=this.getAllChannelNames();return channelNameDecoder(t).runWithException(e),this.updateData(e,n)}if(void 0===this.currentChannelName)throw new Error("Cannot publish to channel, because not joined to a channel!");return this.updateData(this.currentChannelName,n)}all(){return __awaiter$2(this,void 0,void 0,(function*(){return this.getAllChannelNames()}))}list(){return __awaiter$2(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();return yield Promise.all(n.map((n=>this.get(n))))}))}get(n){const e=this.getAllChannelNames();channelNameDecoder(e).runWithException(n);const t=this.createContextName(n);return this.contexts.get(t)}join(n){return __awaiter$2(this,void 0,void 0,(function*(){const e=this.getAllChannelNames();channelNameDecoder(e).runWithException(n),yield this.switchToChannel(n)}))}leave(){return __awaiter$2(this,void 0,void 0,(function*(){yield this.switchToChannel()}))}current(){return this.currentChannelName}my(){return this.current()}changed(n){if("function"!=typeof n)throw new Error("Cannot subscribe to channel changed, because the provided callback is not a function!");return this.registry.add(this.ChangedKey,n)}onChanged(n){return this.changed(n)}add(n){throw new Error("Method `add()` isn't implemented.")}}class IoC{constructor(n){this.coreGlue=n,this.controllers={windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController}}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new WindowsController),this._windowsControllerInstance}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new AppManagerController),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new LayoutsController),this._layoutsControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new NotificationsController),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new IntentsController),this._intentsControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new ChannelsController),this._channelsControllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new GlueBridge(this.coreGlue)),this._bridgeInstance}buildWebWindow(n,e){return __awaiter$2(this,void 0,void 0,(function*(){const t=new WebWindowModel(n,e,this.bridge),r=yield t.toApi();return{id:n,model:t,api:r}}))}buildApplication(n,e){return __awaiter$2(this,void 0,void 0,(function*(){const t=new ApplicationModel(n,[],this.appManagerController).toApi(),r=e.map((n=>this.buildInstance(n,t)));return t.instances.push(...r),t}))}buildInstance(n,e){return new InstanceModel(n,this.bridge,e).toApi()}}const createFactoryFunction=n=>e=>__awaiter$2(void 0,void 0,void 0,(function*(){const t=parseConfig(e);if(window.glue42gd)return enterprise(t);checkSingleton();const r=yield PromiseWrap((()=>n(t)),3e4,"Glue Web initialization timed out"),i=r.logger.subLogger("web.main.controller"),o=new IoC(r);return yield o.bridge.start(o.controllers),i.trace("the bridge has been started, initializing all controllers"),yield Promise.all(Object.values(o.controllers).map((n=>n.start(r,o)))),i.trace("all controllers reported started, starting all additional libraries"),yield Promise.all(t.libraries.map((n=>n(r,t)))),i.trace("all libraries were started, glue is ready, returning it"),r}));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics$2=function(n,e){return(extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function __extends$2(n,e){function t(){this.constructor=n}extendStatics$2(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign$1$1=function(){return(__assign$1$1=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __awaiter$1$2(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new t((function(e){e(n.value)})).then(l,u)}s((r=r.apply(n,e||[])).next())}))}function __generator$2(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function __spreadArrays$1(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],l=0,u=o.length;l<u;l++,i++)r[i]=o[l];return r}var MetricTypes$1={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue$1(n){return n.type===MetricTypes$1.TIMESTAMP?"timestamp":n.type===MetricTypes$1.NUMBER?"number":n.type===MetricTypes$1.STRING?"string":n.type===MetricTypes$1.OBJECT?"object":"unknown"}function getTypeByValue$1(n){return n.constructor===Date?"timestamp":"number"==typeof n?"number":"string"==typeof n?"string":"object"==typeof n?"object":"string"}function serializeMetric$1(n){var e={},t=getMetricTypeByValue$1(n);if("object"===t){var r=Object.keys(n.value).reduce((function(e,t){var r=getTypeByValue$1(n.value[t]);if("object"===r){var i=defineNestedComposite$1(n.value[t]);e[t]={type:"object",description:"",context:{},composite:i}}else e[t]={type:r,description:"",context:{}};return e}),{});e.composite=r}return e.name=normalizeMetricName$1(n.path.join("/")+"/"+n.name),e.type=t,e.description=n.description,e.context={},e}function defineNestedComposite$1(n){return Object.keys(n).reduce((function(e,t){var r=getTypeByValue$1(n[t]);return e[t]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite$1(n[t])}:{type:r,description:"",context:{}},e}),{})}function normalizeMetricName$1(n){return void 0!==n&&n.length>0&&"/"!==n[0]?"/"+n:n}function getMetricValueByType$1(n){return"timestamp"===getMetricTypeByValue$1(n)?Date.now():publishNestedComposite$1(n.value)}function publishNestedComposite$1(n){return"object"!=typeof n?n:Object.keys(n).reduce((function(e,t){var r=n[t];return"object"==typeof r&&r.constructor!==Date?e[t]=publishNestedComposite$1(r):r.constructor===Date?e[t]=new Date(r).getTime():r.constructor===Boolean?e[t]=r.toString():e[t]=r,e}),{})}function flatten$1(n){return n.reduce((function(n,e){return n.concat(Array.isArray(e)?flatten$1(e):e)}),[])}function getHighestState$1(n){return n.sort((function(n,e){return n.state?e.state?e.state-n.state:-1:1}))[0]}function aggregateDescription$1(n){var e="";return n.forEach((function(n,t,r){var i=n.path.join(".");t===r.length-1?e+=i+"."+n.name+": "+n.description:e+=i+"."+n.name+": "+n.description+","})),e.length>100?e.slice(0,100)+"...":e}function composeMsgForRootStateMetric$1(n){var e=flatten$1(n.root.getAggregateState()),t=getHighestState$1(e);return{description:aggregateDescription$1(e),value:t.state}}function gw3$1(n,e){var t,r,i=this;if(!n||"object"!=typeof n)throw new Error("Connection is required parameter");var o=function(n){l(n.root)},l=function(n){u(n),n.metrics.forEach((function(n){s(n)})),n.subSystems.forEach((function(n){l(n)}))},u=function(n){return __awaiter$1$2(i,void 0,void 0,(function(){var e,i;return __generator$2(this,(function(o){switch(o.label){case 0:return void 0===n.parent?[2]:[4,t];case 1:return o.sent(),e={name:normalizeMetricName$1(n.path.join("/")+"/"+n.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[e]},r.send(i),[2]}}))}))},s=function(n){return __awaiter$1$2(i,void 0,void 0,(function(){var e,i,o;return __generator$2(this,(function(l){switch(l.label){case 0:return e=c(n),[4,t];case 1:return l.sent(),i=serializeMetric$1(e),o={type:"define",metrics:[i]},r.send(o),void 0!==e.value&&a(e),[2]}}))}))},a=function(n){if(d()){var e=getMetricValueByType$1(n),t={type:"publish",values:[{name:normalizeMetricName$1(n.path.join("/")+"/"+n.name),value:e,timestamp:Date.now()}]};return r.sendFireAndForget(t)}return Promise.resolve()},c=function(n){var e=__assign$1$1({},n);return"object"==typeof n.value&&null!==n.value&&(e.value=__assign$1$1({},n.value)),e},d=function(){var n;try{return(null!==(n=e.canUpdateMetric)&&void 0!==n?n:function(){return!0})()}catch(n){return!0}};return{init:function(i){var l;t=new Promise((function(n){l=n})),(r=n.domain("metrics")).onJoined((function(n){!n&&l&&(l(),l=void 0);var e={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(e),n&&o(i)})),r.join({system:e.system,service:e.service,instance:e.instance})},createSystem:u,updateSystem:function(e,o){return __awaiter$1$2(i,void 0,void 0,(function(){var i,l,u;return __generator$2(this,(function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),i={type:"publish",values:[{name:normalizeMetricName$1(e.path.join("/")+"/"+e.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric$1(e),u={type:"publish",peer_id:n.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(u),[2]}}))}))},createMetric:s,updateMetric:function(n){return __awaiter$1$2(i,void 0,void 0,(function(){var e;return __generator$2(this,(function(r){switch(r.label){case 0:return e=c(n),[4,t];case 1:return r.sent(),a(e),[2]}}))}))}}}var Helpers$1={validate:function(n,e,t){if(null===n||"object"!=typeof n)throw new Error("Missing definition");if(null===e||"object"!=typeof e)throw new Error("Missing parent");if(null===t||"object"!=typeof t)throw new Error("Missing transport")}},BaseMetric$1=function(){function n(n,e,t,r,i){this.definition=n,this.system=e,this.transport=t,this.value=r,this.type=i,this.path=[],Helpers$1.validate(n,e,t),this.path=e.path.slice(0),this.path.push(e.name),this.name=n.name,this.description=n.description,t.createMetric(this)}return Object.defineProperty(n.prototype,"repo",{get:function(){var n;return null===(n=this.system)||void 0===n?void 0:n.repo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),n.prototype.update=function(n){return this.value=n,this.transport.updateMetric(this)},n}(),NumberMetric$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1.NUMBER)||this}return __extends$2(e,n),e.prototype.incrementBy=function(n){this.update(this.value+n)},e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.incrementBy(-1)},e.prototype.decrementBy=function(n){this.incrementBy(-1*n)},e}(BaseMetric$1),ObjectMetric$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1.OBJECT)||this}return __extends$2(e,n),e.prototype.update=function(n){return this.mergeValues(n),this.transport.updateMetric(this)},e.prototype.mergeValues=function(n){var e=this;return Object.keys(this.value).forEach((function(t){void 0!==n[t]&&(e.value[t]=n[t])}))},e}(BaseMetric$1),StringMetric$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1.STRING)||this}return __extends$2(e,n),e}(BaseMetric$1),TimestampMetric$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1.TIMESTAMP)||this}return __extends$2(e,n),e.prototype.now=function(){this.update(new Date)},e}(BaseMetric$1);function system$1(n,e,t,r,i){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");var o,l,u=t,s=n,a=i||"",c=e,d=r,h=function n(e){if(!e||!e.parent)return[];var t=n(e.parent);return t.push(e.name),t}(r),f={},p=(l="/",((o=h)&&o.length>0?o.join(l):"")+n),g=e.root,w=[],v=[];function m(n,e,t,r){var i={name:""};i="string"==typeof n?{name:n}:n;var o=v.filter((function(n){return n.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==e)throw new Error("A metric named "+i.name+" is already defined with different type.");return void 0!==t&&l.update(t).catch((function(){})),l}var u=r(i);return v.push(u),u}var y={get name(){return s},get description(){return a},get repo(){return c},get parent(){return d},path:h,id:p,root:g,get subSystems(){return w},get metrics(){return v},subSystem:function(n,e){if(!n||0===n.length)throw new Error("name is required");var t=w.filter((function(e){return e.name===n}));if(t.length>0)return t[0];var r=system$1(n,c,u,y,e);return w.push(r),r},getState:function(){return f},setState:function(n,e){f={state:n,description:e},u.updateSystem(y,f)},stringMetric:function(n,e){return m(n,MetricTypes$1.STRING,e,(function(n){return new StringMetric$1(n,y,u,e)}))},timestampMetric:function(n,e){return m(n,MetricTypes$1.TIMESTAMP,e,(function(n){return new TimestampMetric$1(n,y,u,e)}))},objectMetric:function(n,e){return m(n,MetricTypes$1.OBJECT,e,(function(n){return new ObjectMetric$1(n,y,u,e)}))},numberMetric:function(n,e){return m(n,MetricTypes$1.NUMBER,e,(function(n){return new NumberMetric$1(n,y,u,e)}))},getAggregateState:function(){var n=[];return Object.keys(f).length>0&&n.push({name:s,path:h,state:f.state,description:f.description}),w.forEach((function(e){var t=e.getAggregateState();t.length>0&&n.push.apply(n,t)})),n}};return u.createSystem(y),y}var Repository$1=function(){function n(n,e){e.init(this),this.root=system$1("",this,e),this.addSystemMetrics(this.root,n.clickStream||void 0===n.clickStream)}return n.prototype.addSystemMetrics=function(n,e){if("undefined"!=typeof navigator&&n.stringMetric("UserAgent",navigator.userAgent),e&&"undefined"!=typeof document){var t=n.subSystem("ClickStream"),r=function(n){if(n.target){var e=n.target;t.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:n.target?e.className:"",id:e.id,type:"<"+e.tagName.toLowerCase()+">",href:e.href||""}})}};t.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}n.stringMetric("StartTime",(new Date).toString());var i=n.stringMetric("StartURL",""),o=n.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},n}(),NullProtocol$1=function(){function n(){}return n.prototype.init=function(n){},n.prototype.createSystem=function(n){return Promise.resolve()},n.prototype.updateSystem=function(n,e){return Promise.resolve()},n.prototype.createMetric=function(n){return Promise.resolve()},n.prototype.updateMetric=function(n){return Promise.resolve()},n}(),PerfTracker$1=function(){function n(n,e,t){this.api=n,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=e?e:this.initialPublishTimeout,this.publishInterval=null!=t?t:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return n.prototype.scheduleCollection=function(){var n=this;setTimeout((function(){n.collect(),setInterval((function(){n.collect()}),n.publishInterval)}),this.initialPublishTimeout)},n.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(n){}},n.prototype.collectMemory=function(){var n=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:n.totalJSHeapSize,usedJSHeapSize:n.usedJSHeapSize}))},n.prototype.collectEntries=function(){var n=window.performance.getEntries();n.length<=this.lastCount||(this.lastCount=n.length,this.system.stringMetric("entries",JSON.stringify(n)))},n}(),metrics$1=function(n){var e;e=n.connection&&"object"==typeof n.connection?gw3$1(n.connection,n):new NullProtocol$1;var t=new Repository$1(n,e).root;n.disableAutoAppSystem||(t=t.subSystem("App"));var r=addFAVSupport$1(t);return initPerf$1(r,n.pagePerformanceMetrics),r},perf$1;function initPerf$1(n,e){var t,r;if("undefined"!=typeof window){var i=null===(r=null===(t=null===window||void 0===window?void 0:window.glue42gd)||void 0===t?void 0:t.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(e=i),(null==e?void 0:e.enabled)&&(perf$1=new PerfTracker$1(n,e.initialPublishTimeout,e.publishInterval))}}function addFAVSupport$1(n){var e,t=n.subSystem("reporting"),r={name:"features"};return n.featureMetric=function(n,i,o){if(void 0===n||""===n)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");e?e.update({name:n,action:i,payload:o}):e=t.objectMetric(r,{name:n,action:i,payload:o})},n}function createRegistry$1$1(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$1$1.default=createRegistry$1$1;var lib$1$1=createRegistry$1$1,InProcTransport$1=function(){function n(n,e){var t=this;this.registry=lib$1$1(),this.gw=n.facade,this.gw.connect((function(n,e){t.messageHandler(e)})).then((function(n){t.client=n}))}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.client?(this.client.send(n),Promise.resolve(void 0)):Promise.reject("not connected")},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"in-memory"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),SharedWorkerTransport$1=function(){function n(n,e){var t=this;this.logger=e,this.registry=lib$1$1(),this.worker=new SharedWorker(n),this.worker.port.onmessage=function(n){t.messageHandler(n.data)}}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.worker.port.postMessage(n),Promise.resolve()},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"shared-worker"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),Utils$2=function(){function n(){}return n.getGDMajorVersion=function(){if("undefined"!=typeof window&&window.glueDesktop&&window.glueDesktop.version){var n=Number(window.glueDesktop.version.substr(0,1));return isNaN(n)?void 0:n}},n.isNode=function(){if(void 0!==n._isNode)return n._isNode;if("undefined"!=typeof window)return n._isNode=!1,!1;try{n._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(e){n._isNode=!1}return n._isNode},n}(),PromiseWrapper$1=function(){function n(){var n=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(e,t){n.resolve=function(t){n.resolved=!0,e(t)},n.reject=function(e){n.rejected=!0,t(e)}}))}return n.delay=function(n){return new Promise((function(e){return setTimeout(e,n)}))},Object.defineProperty(n.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),n}(),timers$1={};function getAllTimers$1(){return timers$1}function timer$1(n){var e=timers$1[n];if(e)return e;var t=[];function r(){return(new Date).getTime()}var i,o,l=r();function u(n,e){var i=null!=e?e:r(),o=0;t.length>0&&(o=i-t[t.length-1].time),t.push({name:n,time:i,diff:o})}u("start",l);var s={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return u("end",i=r()),o=i-l},mark:u,marks:t};return timers$1[n]=s,s}var WebSocketConstructor$1=Utils$2.isNode()?require("ws"):window.WebSocket,WS$1=function(){function n(n,e){if(this.startupTimer=timer$1("connection"),this._running=!0,this._registry=lib$1$1(),this.wsRequests=[],this.settings=n,this.logger=e,!this.settings.ws)throw new Error("ws is missing")}return n.prototype.onMessage=function(n){return this._registry.add("onMessage",n)},n.prototype.send=function(n,e){var t=this;return new Promise((function(e,r){t.waitForSocketConnection((function(){var i;try{null===(i=t.ws)||void 0===i||i.send(n),e()}catch(n){r(n)}}),r)}))},n.prototype.open=function(){var n=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(e,t){n.waitForSocketConnection(e,t)}))},n.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},n.prototype.onConnectedChanged=function(n){return this._registry.add("onConnectedChanged",n)},n.prototype.name=function(){return"ws "+this.settings.ws},n.prototype.reconnect=function(){var n;null===(n=this.ws)||void 0===n||n.close();var e=new PromiseWrapper$1;return this.waitForSocketConnection((function(){e.resolve()})),e.promise},n.prototype.waitForSocketConnection=function(n,e){var t;e=null!=e?e:function(){},this._running?1!==(null===(t=this.ws)||void 0===t?void 0:t.readyState)?(this.wsRequests.push({callback:n,failed:e}),this.wsRequests.length>1||this.openSocket()):n():e("wait for socket on "+this.settings.ws+" failed - socket closed by user")},n.prototype.openSocket=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t=this;return __generator$2(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===n&&(n=this.settings.reconnectInterval),void 0!==e){if(0===e)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+e+" more times (every "+n+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===e?void 0:e-1;t.openSocket(n,r)}),n),[3,4];case 4:return[2]}}))}))},n.prototype.initiateSocket=function(){var n=this,e=new PromiseWrapper$1;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new WebSocketConstructor$1(this.settings.ws||""),this.ws.onerror=function(t){var r="";try{r=JSON.stringify(t)}catch(n){var i=new WeakSet;r=JSON.stringify(t,(function(n,e){if("object"==typeof e&&null!==e){if(i.has(e))return;i.add(e)}return e}))}e.reject("error"),n.notifyStatusChanged(!1,r)},this.ws.onclose=function(t){n.logger.info("ws closed "+t),e.reject("closed"),n.notifyStatusChanged(!1)},this.ws.onopen=function(){var t;n.startupTimer.mark("ws-opened"),n.logger.info("ws opened "+(null===(t=n.settings.identity)||void 0===t?void 0:t.application)),e.resolve(),n.notifyStatusChanged(!0)},this.ws.onmessage=function(e){n._registry.execute("onMessage",e.data)},e.promise},n.prototype.notifyForSocketState=function(n){this.wsRequests.forEach((function(e){n?e.failed&&e.failed(n):e.callback()})),this.wsRequests=[]},n.prototype.notifyStatusChanged=function(n,e){this._registry.execute("onConnectedChanged",n,e)},n}();function createCommonjsModule$2(n,e){return n(e={exports:{}},e.exports),e.exports}var seed$2=1;function getNextValue$2(){return(seed$2=(9301*seed$2+49297)%233280)/233280}function setSeed$4(n){seed$2=n}var randomFromSeed$2={nextValue:getNextValue$2,seed:setSeed$4},ORIGINAL$2="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$2,previousSeed$2,shuffled$2;function reset$2(){shuffled$2=!1}function setCharacters$2(n){if(n){if(n!==alphabet$2){if(n.length!==ORIGINAL$2.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet$2=n,reset$2()}}else alphabet$2!==ORIGINAL$2&&(alphabet$2=ORIGINAL$2,reset$2())}function characters$2(n){return setCharacters$2(n),alphabet$2}function setSeed$1$1(n){randomFromSeed$2.seed(n),previousSeed$2!==n&&(reset$2(),previousSeed$2=n)}function shuffle$2(){alphabet$2||setCharacters$2(ORIGINAL$2);for(var n,e=alphabet$2.split(""),t=[],r=randomFromSeed$2.nextValue();e.length>0;)r=randomFromSeed$2.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled$2(){return shuffled$2||(shuffled$2=shuffle$2())}function lookup$2(n){return getShuffled$2()[n]}var alphabet_1$2={characters:characters$2,seed:setSeed$1$1,lookup:lookup$2,shuffled:getShuffled$2},crypto$2="object"==typeof window&&(window.crypto||window.msCrypto);function randomByte$2(){if(!crypto$2||!crypto$2.getRandomValues)return 48&Math.floor(256*Math.random());var n=new Uint8Array(1);return crypto$2.getRandomValues(n),48&n[0]}var randomByteBrowser$2=randomByte$2;function encode$2(n,e){for(var t,r=0,i="";!t;)i+=n(e>>4*r&15|randomByteBrowser$2()),t=e<Math.pow(16,r+1),r++;return i}var encode_1$2=encode$2;function decode$2(n){var e=alphabet_1$2.shuffled();return{version:15&e.indexOf(n.substr(0,1)),worker:15&e.indexOf(n.substr(1,1))}}var decode_1$2=decode$2;function isShortId$2(n){if(!n||"string"!=typeof n||n.length<6)return!1;for(var e=alphabet_1$2.characters(),t=n.length,r=0;r<t;r++)if(-1===e.indexOf(n[r]))return!1;return!0}var isValid$2=isShortId$2,lib$1$1$1=createCommonjsModule$2((function(n){var e,t,r=0;function i(){var n="",i=Math.floor(.001*(Date.now()-1459707606518));return i===t?e++:(e=0,t=i),n+=encode_1$2(alphabet_1$2.lookup,6),n+=encode_1$2(alphabet_1$2.lookup,r),e>0&&(n+=encode_1$2(alphabet_1$2.lookup,e)),n+=encode_1$2(alphabet_1$2.lookup,i)}n.exports=i,n.exports.generate=i,n.exports.seed=function(e){return alphabet_1$2.seed(e),n.exports},n.exports.worker=function(e){return r=e,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1$2.characters(n),alphabet_1$2.shuffled()},n.exports.decode=decode_1$2,n.exports.isValid=isValid$2})),lib_1$2=lib$1$1$1.generate,lib_2$2=lib$1$1$1.seed,lib_3$2=lib$1$1$1.worker,lib_4$2=lib$1$1$1.characters,lib_5$2=lib$1$1$1.decode,lib_6$2=lib$1$1$1.isValid,shortid$2=lib$1$1$1;function domainSession$1(n,e,t,r,i){null==n&&(n="global"),r=r||["success"],i=i||["error"];var o,l=!1,u=!1,s=!1,a=lib$1$1();e.disconnected((function(){s=!1,t.debug("connection is down"),l=!1,u=!0,a.execute("onLeft",{disconnected:!0})})),e.loggedIn((function(){s=!0,u&&(t.debug("connection is now up - trying to reconnect..."),d(o))})),e.on("success",(function(n){return f(n)})),e.on("error",(function(n){return h(n)})),e.on("result",(function(n){return f(n)})),r&&r.forEach((function(n){e.on(n,(function(n){return f(n)}))})),i&&i.forEach((function(n){e.on(n,(function(n){return h(n)}))}));var c={};function d(e){return o=e,new Promise((function(r,i){if(l)r();else{var o;if("global"===n)o=s?Promise.resolve({}):Promise.reject("not connected to gateway");else t.debug("joining domain "+n),o=g({type:"join",destination:n,domain:"global",options:e});o.then((function(){!function(){t.debug("did join "+n),l=!0;var e=u;u=!1,a.execute("onJoined",e)}(),r()})).catch((function(e){t.debug("error joining "+n+" domain: "+JSON.stringify(e)),i(e)}))}}))}function h(e){if(n===e.domain){var t=e.request_id;if(t){var r=c[t];r&&r.error(e)}}}function f(e){if(e.domain===n){var t=e.request_id;if(t){var r=c[t];r&&r.success(e)}}}function p(){return shortid$2()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||n,o.skipPeerId||(r.peer_id=e.peerId);var l=r.request_id;return new Promise((function(n,u){c[l]={success:function(e){delete c[l],e._tag=i,n(e)},error:function(n){t.warn("GW error - "+JSON.stringify(n)+" for request "+JSON.stringify(r)),delete c[l],n._tag=i,u(n)}},e.send(r,o).catch((function(n){c[l].error({err:n})}))}))}return{join:d,leave:function(){return"global"===n?Promise.resolve():(t.debug("stopping session "+n+"..."),u=!1,g({type:"leave",destination:n,domain:"global"}).then((function(){l=!1,a.execute("onLeft")})))},onJoined:function(n){return l&&n(!1),a.add("onJoined",n)},onLeft:function(n){return l||n(),a.add("onLeft",n)},send:g,sendFireAndForget:function(t){return t.request_id=t.request_id?t.request_id:p(),t.domain=t.domain||n,t.peer_id=e.peerId,e.send(t)},on:function(r,i){e.on(r,(function(e){if(e.domain===n)try{i(e)}catch(n){t.error("Callback  failed: "+n+" \n "+n.stack+" \n msg was: "+JSON.stringify(e),n)}}))},loggedIn:function(n){return e.loggedIn(n)},connected:function(n){return e.connected(n)},disconnected:function(n){return e.disconnected(n)},get peerId(){return e.peerId},get domain(){return n}}}var GW3ProtocolImpl$1=function(){function n(n,e,t){var r=this;this.connection=n,this.settings=e,this.logger=t,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib$1$1(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],n.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.processStringMessage=function(n){var e=this,t=JSON.parse(n,(function(n,t){if("string"!=typeof t)return t;if(t.length<e.dateMinLen)return t;if(t[0]!==e.datePrefixFirstChar)return t;if(t.substring(0,e.datePrefixLen)!==e.datePrefix)return t;try{var r=parseInt(t.substring(e.datePrefixLen,t.length),10);return isNaN(r)?t:new Date(r)}catch(n){return t}}));return{msg:t,msgType:t.type}},n.prototype.createStringMessage=function(n){var e=Date.prototype.toJSON;try{var t=this.datePrefix;return Date.prototype.toJSON=function(){return t+this.getTime()},JSON.stringify(n)}finally{Date.prototype.toJSON=e}},n.prototype.processObjectMessage=function(n){if(!n.type)throw new Error("Object should have type property");return{msg:n,msgType:n.type}},n.prototype.createObjectMessage=function(n){return n},n.prototype.login=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t,r,i,o,l,u,s,a,c,d;return __generator$2(this,(function(h){switch(h.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=n,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,t={},this.connection.gatewayToken=n.gatewayToken,!n.gatewayToken)return[3,5];if(!e)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return a=h.sent(),n.gatewayToken=a,[3,4];case 3:return r=h.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null==r?void 0:r.message)||r)),[3,4];case 4:return t.method="gateway-token",t.token=n.gatewayToken,this.connection.gatewayToken=n.gatewayToken,[3,10];case 5:return"sspi"!==n.flowName?[3,9]:(t.provider="win",t.method="access-token",n.flowCallback&&n.sessionId?(i=t,[4,n.flowCallback(n.sessionId,null)]):[3,7]);case 6:return i.token=h.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(n.token)t.method="access-token",t.token=n.token;else{if(!n.username)throw new Error("invalid auth message"+JSON.stringify(n));t.method="secret",t.login=n.username,t.secret=n.password}h.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:t},n.sessionId&&(o.request_id=n.sessionId),this.globalDomain=domainSession$1("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),h.label=11;case 11:h.trys.push([11,19,20,21]),u=void 0,h.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(s=h.sent()).type?[3,16]:(a=Buffer.from(s.authentication.token,"base64"),n.flowCallback&&n.sessionId?(c=o.authentication,[4,n.flowCallback(n.sessionId,a)]):[3,15]);case 14:c.token=h.sent().data.toString("base64"),h.label=15;case 15:return o.request_id=n.sessionId,[3,12];case 16:if("welcome"===s.type)return u=s,[3,18];throw"error"===s.type?new Error("Authentication failed: "+s.reason):new Error("Unexpected message type during authentication: "+s.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+u.peer_id),this.connection.peerId=u.peer_id,this.connection.resolvedIdentity=u.resolved_identity,this.connection.availableDomains=u.available_domains,u.options&&(this.connection.token=u.options.access_token,this.connection.info=u.options.info),this.setLoggedIn(!0),[2,u.resolved_identity];case 19:throw d=h.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return n&&n.flowCallback&&n.sessionId&&n.flowCallback(n.sessionId,null),[7];case 21:return[2]}}))}))},n.prototype.logout=function(){return __awaiter$1$2(this,void 0,void 0,(function(){var n;return __generator$2(this,(function(e){switch(e.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),n=this.sessions.map((function(n){n.leave()})),[4,Promise.all(n)];case 1:return e.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this._isLoggedIn&&n(),this.registry.add("onLoggedIn",n)},n.prototype.domain=function(n,e,t,r){var i=this.sessions.filter((function(e){return e.domain===n}))[0];return i||(i=domainSession$1(n,this.connection,e,t,r),this.sessions.push(i)),i},n.prototype.handleDisconnected=function(){var n=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(n.handleDisconnected.bind(n),n.settings.reconnectInterval||1e3)}))}},n.prototype.setLoggedIn=function(n){this._isLoggedIn=n,this._isLoggedIn&&this.registry.execute("onLoggedIn")},n.prototype.ping=function(){var n=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){n.ping()}),3e4))},n.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(n){return n.token})):Promise.reject(new Error("no global domain session"))},n.prototype.getNewGWToken=function(){if(void 0!==typeof window){var n=window.glue42gd;if(n)return n.getGWToken()}return Promise.reject(new Error("not running in GD"))},n}(),MessageReplayerImpl$1=function(){function n(n){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var e=0,t=n;e<t.length;e++){var r=t[e];this.specs[r.name]=r,this.specsNames.push(r.name)}}return n.prototype.init=function(n){var e=this;this.connection=n;for(var t=0,r=this.specsNames;t<r.length;t++)for(var i=r[t],o=function(t){var r=l.subsRefCount[t];if(r||(r=0),r+=1,l.subsRefCount[t]=r,r>1)return"continue";var i=n.on(t,(function(n){return e.processMessage(t,n)}));l.subs[t]=i},l=this,u=0,s=this.specs[i].types;u<s.length;u++){o(s[u])}},n.prototype.processMessage=function(n,e){if(!this.isDone&&e)for(var t=0,r=this.specsNames;t<r.length;t++){var i=r[t];if(-1!==this.specs[i].types.indexOf(n)){var o=this.messages[i]||[];this.messages[i]=o,o.push(e)}}},n.prototype.drain=function(n,e){var t;e&&(this.messages[n]||[]).forEach(e),delete this.messages[n];for(var r=0,i=this.specs[n].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(t=this.connection)||void 0===t||t.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[n],this.specs.length||(this.isDone=!0)},n}(),PromisePlus$1=function(n,e,t){return new Promise((function(r,i){var o=setTimeout((function(){i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((function(n){clearTimeout(o),r(n)})).catch((function(n){clearTimeout(o),i(n)}))}))},WebPlatformTransport=function(){function n(n,e,t){this.settings=n,this.logger=e,this.identity=t,this.parentReady=!1,this.iAmConnected=!1,this.rejected=!1,this.children=[],this.parentPingTimeout=3e3,this.connectionRequestTimeout=5e3,this.defaultTargetString="*",this.registry=lib$1$1(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:this.handleParentReady.bind(this)},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformUnload:{name:"platformUnload",handle:this.handlePlatformUnload.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)}},this.setUpMessageListener(),this.setUpUnload(),this.settings.port||(this.parent=window.opener||window.top,this.parentType=window.opener?"opener":-1!==window.name.indexOf("#wsp")?"workspace":"top")}return Object.defineProperty(n.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return __awaiter$1$2(this,void 0,void 0,(function(){return __generator$2(this,(function(e){if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(n),[2]}))}))},Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.send=function(){return Promise.reject("not supported")},n.prototype.onConnectedChanged=function(n){return this.registry.add("onConnectedChanged",n)},n.prototype.open=function(){return __awaiter$1$2(this,void 0,void 0,(function(){return __generator$2(this,(function(n){switch(n.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return n.sent(),this.notifyStatusChanged(!0),[2]}}))}))},n.prototype.close=function(){return Promise.resolve()},n.prototype.name=function(){return"web-platform"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.connect=function(){return __awaiter$1$2(this,void 0,void 0,(function(){var n=this;return __generator$2(this,(function(e){switch(e.label){case 0:if(this.parentReady)return this.logger.debug("cancelling connection attempt, because this client's parent has already given a ready signal"),[2];if(this.settings.port)return this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.publicWindowId=this.settings.windowId,this.identity&&(this.identity.windowId=this.publicWindowId),this.port.onmessage=function(e){return n.registry.execute("onMessage",e.data)},this.logger.debug("internal web platform connection completed"),[2];if(!this.parentType||!this.parent)throw new Error("Cannot initiate a connection, because there is no opener, no top and no port.");return this.logger.debug("opening a "+("opener"===this.parentType?"child":"grandchild")+" client web platform connection"),[4,this.waitParent(this.parent,this.parentType)];case 1:return e.sent(),[4,this.initiateRemoteConnection(this.parent,this.parentType)];case 2:return e.sent(),this.logger.debug("the "+("opener"===this.parentType?"child":"grandchild")+" client is connected"),[2]}}))}))},n.prototype.initiateRemoteConnection=function(n,e){var t=this;return PromisePlus$1((function(r,i){t.connectionResolve=r,t.connectionReject=i,t.myClientId=shortid$2();var o="workspace"===t.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window.name,l={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"top"===e||"workspace"===e?"grandChild":"child",bridgeInstanceId:o}};t.logger.debug("sending connection request to "+e),n.postMessage(l,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the opener/top window timed out")},n.prototype.waitParent=function(n,e){var t=this;return PromisePlus$1((function(r){t.parentPingResolve=r;var i={glue42core:{type:"opener"===e?t.messages.platformPing.name:t.messages.parentPing.name}};t.logger.debug("checking for "+e+" window availability"),n.postMessage(i,t.defaultTargetString)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client")},n.prototype.setUpMessageListener=function(){var n=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(e){var t,r=null===(t=e.data)||void 0===t?void 0:t.glue42core;if(r&&!n.rejected)if(n.checkMessageTypeValid(r.type)){var i=r.type;n.logger.debug("received valid glue42core message of type: "+i),n.messages[i].handle(e)}else n.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: "+r.type)}))},n.prototype.setUpUnload=function(){var n=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var e,t,r={glue42core:{type:n.messages.clientUnload.name,data:{clientId:n.myClientId,ownWindowId:null===(e=n.identity)||void 0===e?void 0:e.windowId}}};n.parent&&n.parent.postMessage(r,n.defaultTargetString),null===(t=n.port)||void 0===t||t.postMessage(r)}))},n.prototype.handleParentReady=function(){if(this.logger.debug("handling the ready signal from the parent, by resoling the pending promise."),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handlePlatformReady=function(){if(this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handleConnectionAccepted=function(n){var e,t=null===(e=n.data)||void 0===e?void 0:e.glue42core;return this.myClientId===t.clientId?this.handleAcceptanceOfMyRequest(t):this.handleAcceptanceOfGrandChildRequest(t,n)},n.prototype.handleAcceptanceOfMyRequest=function(n){var e=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),n.port){if(this.publicWindowId="opener"===this.parentType?window.name:"top"===this.parentType?n.parentWindowId:window.name.substring(0,window.name.indexOf("#wsp")),this.identity&&"top"!==this.parentType&&(this.identity.windowId=this.publicWindowId),this.identity&&n.appName&&(this.identity.application=n.appName,this.identity.applicationName=n.appName),this.port=n.port,this.port.onmessage=function(n){return e.registry.execute("onMessage",n.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},n.prototype.handleAcceptanceOfGrandChildRequest=function(n,e){this.logger.debug("handling a connection accepted signal targeted at a grandchild: "+n.clientId);var t=this.children.find((function(e){return e.grandChildId===n.clientId}));t?(t.connected=!0,this.logger.debug("the grandchild connection for "+n.clientId+" is set up, forwarding the success message and the gateway port"),n.parentWindowId=this.publicWindowId,t.source.postMessage(e.data,t.origin,[n.port])):this.logger.error("cannot handle connection accepted for grandchild: "+n.clientId+", because there is no grandchild with this id")},n.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},n.prototype.handleConnectionRequest=function(n){var e=n.source,t=n.data.glue42core;return t.clientType&&"grandChild"===t.clientType?t.clientId?"opener"===this.parentType&&this.parent?(this.logger.debug("handling a connection request for a grandchild: "+t.clientId),this.children.push({grandChildId:t.clientId,source:e,connected:!1,origin:n.origin}),this.logger.debug("grandchild: "+t.clientId+" is prepared, forwarding connection request to the platform"),void this.parent.postMessage(n.data,this.defaultTargetString)):this.rejectConnectionRequest(e,n.origin,"Cannot forward the connection request, because no direct connection to the platform was found"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source did not provide a valid id"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source was not opened by a glue API call")},n.prototype.handleParentPing=function(n){if(this.parentReady)if(this.iAmConnected){var e={glue42core:{type:this.messages.parentReady.name}},t=n.source;this.logger.debug("responding to a parent ping with a ready message"),t.postMessage(e,n.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},n.prototype.handlePlatformUnload=function(n){this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.children.length&&(this.logger.debug("forwarding the platform unload to all known children and starting platform discovery polling"),this.children.forEach((function(e){return e.source.postMessage(n.data,e.origin)}))),this.notifyStatusChanged(!1,"Gateway unloaded")},n.prototype.handleClientUnload=function(n){var e=n.data.glue42core;e.clientId?this.children.find((function(n){return n.grandChildId===e.clientId}))?(this.logger.debug("handling grandchild unload for id: "+e.clientId),this.children=this.children.filter((function(n){return n.grandChildId!==e.clientId}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},n.prototype.handlePlatformPing=function(){this.logger.error("cannot handle platform ping, because this is not a platform calls handling component")},n.prototype.notifyStatusChanged=function(n,e){this.iAmConnected=n,this.registry.execute("onConnectedChanged",n,e)},n.prototype.checkMessageTypeValid=function(n){return"string"==typeof n&&!!this.messages[n]},n.prototype.rejectConnectionRequest=function(n,e,t){this.rejected=!0,this.logger.error(t);var r={glue42core:{type:this.messages.connectionRejected.name}};n.postMessage(r,e)},n}(),Connection$1=function(){function n(n,e){if(this.settings=n,this.logger=e,this.messageHandlers={},this.ids=1,this.registry=lib$1$1(),this._connected=!1,this.isTrace=!1,(n=n||{}).reconnectAttempts=n.reconnectAttempts||10,n.reconnectInterval=n.reconnectInterval||1e3,n.inproc)this.transport=new InProcTransport$1(n.inproc,e.subLogger("inMemory"));else if(n.sharedWorker)this.transport=new SharedWorkerTransport$1(n.sharedWorker,e.subLogger("shared-worker"));else if(n.webPlatform)this.transport=new WebPlatformTransport(n.webPlatform,e.subLogger("web-platform"),n.identity);else{if(void 0===n.ws)throw new Error("No connection information specified");this.transport=new WS$1(n,e.subLogger("ws"))}this.isTrace=e.canPublish("trace"),e.debug("starting with "+this.transport.name()+" transport"),this.protocol=new GW3ProtocolImpl$1(this,n,e.subLogger("protocol")),this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this.transport.onMessage(this.handleTransportMessage.bind(this)),n.replaySpecs&&n.replaySpecs.length&&(this.replayer=new MessageReplayerImpl$1(n.replaySpecs),this.replayer.init(this))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;return null===(n=this.protocol)||void 0===n?void 0:n.protocolVersion},enumerable:!0,configurable:!0}),n.prototype.send=function(n,e){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var t=this.protocol.createObjectMessage(n);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(t)),this.transport.sendObject(t,e)}var r=this.protocol.createStringMessage(n);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,e)},n.prototype.on=function(n,e){n=n.toLowerCase(),void 0===this.messageHandlers[n]&&(this.messageHandlers[n]={});var t=this.ids++;return this.messageHandlers[n][t]=e,{type:n,id:t}},n.prototype.off=function(n){delete this.messageHandlers[n.type.toLowerCase()][n.id]},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.connected=function(n){var e=this;return this.protocol.loggedIn((function(){n(e.settings.ws||e.settings.sharedWorker||"")}))},n.prototype.disconnected=function(n){return this.registry.add("disconnected",n)},n.prototype.login=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t;return __generator$2(this,(function(r){switch(r.label){case 0:return[4,this.transport.open()];case 1:return r.sent(),timer$1("connection").mark("transport-opened"),t=this.protocol.login(n,e),timer$1("connection").mark("protocol-logged-in"),[2,t]}}))}))},n.prototype.logout=function(){return __awaiter$1$2(this,void 0,void 0,(function(){return __generator$2(this,(function(n){switch(n.label){case 0:return[4,this.protocol.logout()];case 1:return n.sent(),[4,this.transport.close()];case 2:return n.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this.protocol.loggedIn(n)},n.prototype.domain=function(n,e,t){return this.protocol.domain(n,this.logger.subLogger("domain="+n),e,t)},n.prototype.authToken=function(){return this.protocol.authToken()},n.prototype.reconnect=function(){return this.transport.reconnect()},n.prototype.distributeMessage=function(n,e){var t=this,r=this.messageHandlers[e.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(e){var i=r[e];if(void 0!==i)try{i(n)}catch(n){try{t.logger.error("Message handler failed with "+n.stack,n)}catch(e){console.log("Message handler failed",n)}}}))},n.prototype.handleConnectionChanged=function(n){this._connected!==n&&(this._connected=n,n?this.registry.execute("connected"):this.registry.execute("disconnected"))},n.prototype.handleTransportMessage=function(n){var e;e="string"==typeof n?this.protocol.processStringMessage(n):this.protocol.processObjectMessage(n),this.isTrace&&this.logger.trace("<< "+JSON.stringify(e)),this.distributeMessage(e.msg,e.msgType)},n}(),order$1=["trace","debug","info","warn","error","off"],Logger$2=function(){function n(n,e,t){this.name=n,this.parent=e,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=n,this.path=e?e.path+"."+n:n,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!t,t&&(this.logFn=t,this.customLogFn=!0)}return n.prototype.subLogger=function(e){var t=this.subLoggers.filter((function(n){return n.name===e}))[0];if(void 0!==t)return t;Object.keys(this).forEach((function(n){if(n===e)throw new Error("This sub logger name is not allowed.")}));var r=new n(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},n.prototype.publishLevel=function(n){var e;return n&&(this._publishLevel=n),this._publishLevel||(null===(e=this.parent)||void 0===e?void 0:e.publishLevel())},n.prototype.consoleLevel=function(n){var e;return n&&(this._consoleLevel=n),this._consoleLevel||(null===(e=this.parent)||void 0===e?void 0:e.consoleLevel())},n.prototype.log=function(n,e,t){this.publishMessage(e||"info",n,t)},n.prototype.trace=function(n){this.log(n,"trace")},n.prototype.debug=function(n){this.log(n,"debug")},n.prototype.info=function(n){this.log(n,"info")},n.prototype.warn=function(n){this.log(n,"warn")},n.prototype.error=function(n,e){this.log(n,"error")},n.prototype.canPublish=function(n,e){return order$1.indexOf(n)>=order$1.indexOf(e||this.consoleLevel()||"trace")},n.prototype.publishMessage=function(e,t,r){var i=this.loggerFullName;if("error"===e&&!r){var o=new Error;o.stack&&(t=t+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(e,this.publishLevel())){var l=n.Interop;if(l)try{l.methods({name:n.InteropMethodName}).length>0&&l.invoke(n.InteropMethodName,{msg:""+t,logger:i,level:e})}catch(n){}}if(this.canPublish(e)){var u="";if(this.includeTimeAndLevel){var s=new Date;u="["+(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+":"+s.getMilliseconds())+"] ["+e+"] "}var a=""+u+i+": "+t;switch(e){case"trace":this.logFn.debug(a);break;case"debug":this.logFn.debug?this.logFn.debug(a):this.logFn.log(a);break;case"info":this.logFn.info(a);break;case"warn":this.logFn.warn(a);break;case"error":this.logFn.error(a,r)}}},n.InteropMethodName="T42.AppLogger.Log",n}(),GW_MESSAGE_CREATE_CONTEXT$1="create-context",GW_MESSAGE_ACTIVITY_CREATED$1="created",GW_MESSAGE_ACTIVITY_DESTROYED$1="destroyed",GW_MESSAGE_CONTEXT_CREATED$1="context-created",GW_MESSAGE_CONTEXT_ADDED$1="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT$1="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT$1="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT$1="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED$1="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT$1="update-context",GW_MESSAGE_CONTEXT_UPDATED$1="context-updated",GW_MESSAGE_JOINED_ACTIVITY$1="joined",ContextMessageReplaySpec$1={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT$1,GW_MESSAGE_ACTIVITY_CREATED$1,GW_MESSAGE_ACTIVITY_DESTROYED$1,GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_CONTEXT_ADDED$1,GW_MESSAGE_SUBSCRIBE_CONTEXT$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1,GW_MESSAGE_DESTROY_CONTEXT$1,GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_UPDATE_CONTEXT$1,GW_MESSAGE_CONTEXT_UPDATED$1,GW_MESSAGE_JOINED_ACTIVITY$1]}},version$3="5.3.0";function prepareConfig$2(n,e,t){var r,i,o,l,u,s;if(Utils$2.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(n){}}function c(){if(n.application)return n.application;if(t)return t.applicationName;var e=shortid$2();return Utils$2.isNode()?s?s.applicationConfig.name:"NodeJS"+e:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" ("+e+")":e}var d=function(){var r,i,o,l,u,a,d,h,f,p,g=n.gateway,w=null!==(r=null==g?void 0:g.protocolVersion)&&void 0!==r?r:3,v=null==g?void 0:g.reconnectInterval,m=null==g?void 0:g.reconnectAttempts,y=null==g?void 0:g.ws,b=null==g?void 0:g.sharedWorker,$=null==g?void 0:g.inproc,_=null!==(i=null==g?void 0:g.webPlatform)&&void 0!==i?i:void 0;t&&(y=t.gwURL),Utils$2.isNode()&&s&&s.gwURL&&(y=s.gwURL),y||b||$||(y="ws://localhost:8385");var S=c(),I=S;void 0!==t?(d=t.windowId,h=t.pid,t.env&&(f=t.env.env,p=t.env.region),I=null!==(o=t.application)&&void 0!==o?o:"glue-app",a=t.appInstanceId):Utils$2.isNode()&&(h=process.pid,s&&(f=s.env,p=s.region,a=s.instanceId));var C=null!==(u=null===(l=n.gateway)||void 0===l?void 0:l.replaySpecs)&&void 0!==u?u:[];return C.push(ContextMessageReplaySpec$1),{identity:{application:I,applicationName:S,windowId:d,instance:a,process:h,region:p,environment:f,api:e.version||version$3},reconnectInterval:v,ws:y,sharedWorker:b,webPlatform:_,inproc:$,protocolVersion:w,reconnectAttempts:m,replaySpecs:C}}(),h=c();if("undefined"!=typeof window){var f=window,p=f.htmlContainer?f.htmlContainer.containerName+"."+f.htmlContainer.application:null===(r=null==f?void 0:f.glue42gd)||void 0===r?void 0:r.application;p&&(h=p)}return{bus:null!==(i=n.bus)&&void 0!==i&&i,application:h,auth:function(){var e,t,r;return"string"==typeof n.auth?{token:n.auth}:n.auth?n.auth:Utils$2.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(e=n.gateway)||void 0===e?void 0:e.webPlatform)||(null===(t=n.gateway)||void 0===t?void 0:t.inproc)||(null===(r=n.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var e,r,i,o=n.logger,l="warn";return o||(o=l),t&&(i=t.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(e=null!=i?i:o.console)&&void 0!==e?e:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:d,metrics:null===(o=n.metrics)||void 0===o||o,contexts:null===(l=n.contexts)||void 0===l||l,version:e.version||version$3,libs:null!==(u=e.libs)&&void 0!==u?u:[],customLogger:n.customLogger}}var GW3ContextData$1=function(){function n(n,e,t,r){this.updateCallbacks={},this.contextId=n,this.name=e,this.isAnnounced=t,this.activityId=r,this.context={}}return n.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},n.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},n}();function applyContextDelta$1(n,e,t){try{if((null==t?void 0:t.canPublish("trace"))&&(null==t||t.trace("applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n))),!e)return n;if(e.reset)return n=__assign$1$1({},e.reset);if(n=deepClone$1(n,void 0),e.commands){for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath$1(n,o.path):"set"===o.type&&setValueToPath$1(n,o.value,o.path)}return n}var l=e.added,u=e.updated,s=e.removed;return l&&Object.keys(l).forEach((function(e){n[e]=l[e]})),u&&Object.keys(u).forEach((function(e){mergeObjectsProperties$1(e,n,u)})),s&&s.forEach((function(e){delete n[e]})),n}catch(r){return null==t||t.error("error applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n),r),n}}function deepClone$1(n,e){if(e=e||new WeakMap,Object(n)!==n)return n;if(n instanceof Set)return new Set(n);if(e.has(n))return e.get(n);var t=n instanceof Date?new Date(n):n instanceof RegExp?new RegExp(n.source,n.flags):n.constructor?new n.constructor:Object.create(null);return e.set(n,t),Object.assign.apply(Object,__spreadArrays$1([t],Object.keys(n).map((function(t){var r;return(r={})[t]=deepClone$1(n[t],e),r}))))}var mergeObjectsProperties$1=function(n,e,t){var r=t[n];if(void 0===r)return e;var i=e[n];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(e[n]=r,e):(e[n]=Object.assign({},i,r),e):(e[n]=r,e)};function deepEqual$1(n,e){if(n===e)return!0;if(!(n instanceof Object&&e instanceof Object))return!1;if(n.constructor!==e.constructor)return!1;for(var t in n)if(n.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(n[t]!==e[t]){if("object"!=typeof n[t])return!1;if(!deepEqual$1(n[t],e[t]))return!1}}for(var t in e)if(e.hasOwnProperty(t)&&!n.hasOwnProperty(t))return!1;return!0}function setValueToPath$1(n,e,t){var r,i=t.split(".");for(r=0;r<i.length-1;r++)n[i[r]]||(n[i[r]]={}),"object"!=typeof n[i[r]]&&(n[i[r]]={}),n=n[i[r]];n[i[r]]=e}function deletePath$1(n,e){var t,r=e.split(".");for(t=0;t<r.length-1;t++){if(!n[r[t]])return;n=n[r[t]]}delete n[r[t]]}var GW3Bridge$2=function(){function n(n){var e,t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._connection=n.connection,this._logger=n.logger,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_CONTEXT_UPDATED$1]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec$1.name,(function(n){var e=n.type;e&&(e===GW_MESSAGE_CONTEXT_CREATED$1||e===GW_MESSAGE_CONTEXT_ADDED$1||e===GW_MESSAGE_ACTIVITY_CREATED$1?t.handleContextCreatedMessage(n):e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1||e===GW_MESSAGE_CONTEXT_UPDATED$1||e===GW_MESSAGE_JOINED_ACTIVITY$1?t.handleContextUpdatedMessage(n):e!==GW_MESSAGE_CONTEXT_DESTROYED$1&&e!==GW_MESSAGE_ACTIVITY_DESTROYED$1||t.handleContextDestroyedMessage(n))}))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;if(!this._protocolVersion){var e=this._connection.availableDomains.find((function(n){return"context"===n.uri}));this._protocolVersion=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){for(var n=0,e=this._gw3Subscriptions;n<e.length;n++){var t=e[n];this._connection.off(t)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},n.prototype.createContext=function(n,e){var t=this;return this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT$1,domain:"global",name:n,data:e,lifetime:"retained"}).then((function(r){t._contextNameToId[n]=r.context_id,t._contextIdToName[r.context_id]=n;var i=t._contextNameToData[n]||new GW3ContextData$1(r.context_id,n,!0,void 0);return i.isAnnounced=!0,i.name=n,i.contextId=r.context_id,i.context=e,t._contextNameToData[n]=i,r.context_id}))},n.prototype.all=function(){var n=this;return Object.keys(this._contextNameToData).filter((function(e){return n._contextNameToData[e].isAnnounced}))},n.prototype.update=function(n,e){var t;return __awaiter$1$2(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator$2(this,(function(u){switch(u.label){case 0:return(r=this._contextNameToData[n])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(n,e)];case 1:i=u.sent(),u.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,e):this.calculateContextDeltaV1(i,e),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(t=o.commands)||void 0===t?void 0:t.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(n){l.handleUpdated(r,o,{updaterId:n.peer_id})}))]:[2,Promise.resolve()]}}))}))},n.prototype.set=function(n,e){var t=this,r=this._contextNameToData[n];return r&&r.isAnnounced?this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:r.contextId,delta:{reset:e}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{reset:e,added:{},removed:[],updated:{}},{updaterId:n.peer_id})})):this.createContext(n,e)},n.prototype.setPath=function(n,e,t){return this.setPathSupported?this.setPaths(n,[{path:e,value:t}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},n.prototype.setPaths=function(n,e){var t=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[n];if(!r||!r.isAnnounced){for(var i={},o=0,l=e;o<l.length;o++){setValueToPath$1(i,(c=l[o]).value,c.path)}return this.createContext(n,i)}for(var u=[],s=0,a=e;s<a.length;s++){var c;null===(c=a[s]).value?u.push({type:"remove",path:c.path}):u.push({type:"set",path:c.path,value:c.value})}return this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:r.contextId,delta:{commands:u}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{added:{},removed:[],updated:{},commands:u},{updaterId:n.peer_id})}))},n.prototype.get=function(n){var e,t=this,r=this._contextNameToData[n];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&!r.hasCallbacks())return new Promise((function(e,r){return __awaiter$1$2(t,void 0,void 0,(function(){var t=this;return __generator$2(this,(function(r){return this.subscribe(n,(function(n,r,i,o){t.unsubscribe(o),e(n)})),[2]}))}))}));var i=null!==(e=null==r?void 0:r.context)&&void 0!==e?e:{};return Promise.resolve(i)},n.prototype.subscribe=function(n,e){var t=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var r=this._contextNameToData[n];if(!r||!r.isAnnounced)return r=r||new GW3ContextData$1(void 0,n,!1,void 0),this._contextNameToData[n]=r,r.updateCallbacks[t]=e,Promise.resolve(t);var i,o=r.hasCallbacks();return r.updateCallbacks[t]=e,o||r.joinedActivity||r.context&&r.sentExplicitSubscription?(e(i=deepClone$1(r.context),i,[],t),Promise.resolve(t)):this.sendSubscribe(r).then((function(){return t}))},n.prototype.unsubscribe=function(n){for(var e=0,t=Object.keys(this._contextNameToData);e<t.length;e++){var r=t[e],i=(this._contextNameToId[r],this._contextNameToData[r]);if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[n],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},n.prototype.destroy=function(n){var e=this._contextNameToData[n];return e?this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT$1,domain:"global",context_id:e.contextId}).then((function(n){})):Promise.reject("context with "+n+" does not exist")},n.prototype.handleUpdated=function(n,e,t){var r=n.context;n.context=applyContextDelta$1(n.context,e,this._logger),this._contextNameToData[n.name]!==n||deepEqual$1(r,n.context)||this.invokeUpdateCallbacks(n,e,t)},n.prototype.subscribeToContextCreatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_ADDED$1,GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_ACTIVITY_CREATED$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextCreatedMessage=function(n){var e=n.type;e===GW_MESSAGE_ACTIVITY_CREATED$1?(this._contextNameToId[n.activity_id]=n.context_id,this._contextIdToName[n.context_id]=n.activity_id):e===GW_MESSAGE_CONTEXT_ADDED$1&&(this._contextNameToId[n.name]=n.context_id,this._contextIdToName[n.context_id]=n.name);var t=this._contextIdToName[n.context_id];if(!t)throw new Error("Received created event for context with unknown name: "+n.context_id);if(!this._contextNameToId[t])throw new Error("Received created event for context with unknown id: "+n.context_id);var r=this._contextNameToData[t];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=n.context_id,r.activityId=n.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[t]=r=new GW3ContextData$1(n.context_id,t,!0,n.activity_id)},n.prototype.subscribeToContextUpdatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_UPDATED$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_JOINED_ACTIVITY$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextUpdatedMessage=function(n){var e=n.type,t=n.context_id,r=this._contextNameToData[this._contextIdToName[t]],i=!r||!r.isAnnounced;if(e===GW_MESSAGE_JOINED_ACTIVITY$1)r?(r.contextId=t,r.isAnnounced=!0,r.activityId=n.activity_id):(r=new GW3ContextData$1(t,n.activity_id,!0,n.activity_id),this._contextNameToData[n.activity_id]=r,this._contextIdToName[t]=n.activity_id,this._contextNameToId[n.activity_id]=t),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1?((r=r||new GW3ContextData$1(t,n.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[n.name]=r,this._contextIdToName[t]=n.name,this._contextNameToId[n.name]=t):this._logger.error("Received 'update' for unknown context: "+t));var o=r.context;if(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1)r.context=n.data||{};else if(e===GW_MESSAGE_JOINED_ACTIVITY$1)r.context=n.context_snapshot||{};else{if(e!==GW_MESSAGE_CONTEXT_UPDATED$1)throw new Error("Unrecognized context update message "+e);r.context=applyContextDelta$1(r.context,n.delta,this._logger)}!i&&deepEqual$1(r.context,o)&&e!==GW_MESSAGE_SUBSCRIBED_CONTEXT$1||this.invokeUpdateCallbacks(r,n.delta,{updaterId:n.updater_id})},n.prototype.invokeUpdateCallbacks=function(n,e,t){if((e=e||{added:{},updated:{},reset:{},removed:[]}).commands){e.added=e.updated=e.reset={},e.removed=[];for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&e.removed.push(o.path),setValueToPath$1(e.updated,null,o.path)):"set"===o.type&&setValueToPath$1(e.updated,o.value,o.path)}}for(var l in n.updateCallbacks)if(n.updateCallbacks.hasOwnProperty(l))try{(0,n.updateCallbacks[l])(deepClone$1(n.context),Object.assign({},e.added||{},e.updated||{},e.reset||{}),e.removed,parseInt(l,10),t)}catch(n){this._logger.debug("callback error: "+JSON.stringify(n))}},n.prototype.subscribeToContextDestroyedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_ACTIVITY_DESTROYED$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextDestroyedMessage=function(n){var e,t;if(n.type===GW_MESSAGE_ACTIVITY_DESTROYED$1){if(t=n.activity_id,!(e=this._contextNameToId[t]))return void this._logger.error("Received 'destroyed' for unknown activity: "+n.activity_id)}else if(e=n.context_id,!(t=this._contextIdToName[e]))return void this._logger.error("Received 'destroyed' for unknown context: "+n.context_id);delete this._contextIdToName[e],delete this._contextNameToId[t];var r=this._contextNameToData[t];delete this._contextNameToData[t],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+e)},n.prototype.sendSubscribe=function(n){return n.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT$1,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.sendUnsubscribe=function(n){return n.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.calculateContextDeltaV1=function(n,e){var t={added:{},updated:{},removed:[],reset:void 0};if(n)for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];-1===Object.keys(e).indexOf(o)||null===e[o]||deepEqual$1(n[o],e[o])||(t.updated[o]=e[o])}for(var l=0,u=Object.keys(e);l<u.length;l++){o=u[l];n&&-1!==Object.keys(n).indexOf(o)?null===e[o]&&t.removed.push(o):null!==e[o]&&(t.added[o]=e[o])}return t},n.prototype.calculateContextDeltaV2=function(n,e){for(var t,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(e);o<l.length;o++){var u=l[o];if(null!==e[u])deepEqual$1(n?n[u]:null,e[u])||null===(t=i.commands)||void 0===t||t.push({type:"set",path:u,value:e[u]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:u})}return i},n}(),ContextsModule$1=function(){function n(n){this._bridge=new GW3Bridge$2(n)}return n.prototype.all=function(){return this._bridge.all()},n.prototype.update=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.update(n,e)},n.prototype.set=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.set(n,e)},n.prototype.setPath=function(n,e,t){return this.checkName(n),this.checkPath(e),""===e?(this.checkData(t),this.set(n,t)):this._bridge.setPath(n,e,t)},n.prototype.setPaths=function(n,e){if(this.checkName(n),!Array.isArray(e))throw new Error("Please provide the paths as an array of PathValues!");for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(n,e)},n.prototype.subscribe=function(n,e){var t=this;if(this.checkName(n),"function"!=typeof e)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(n,(function(n,r,i,o,l){return e(n,r,i,(function(){return t._bridge.unsubscribe(o)}),l)})).then((function(n){return function(){t._bridge.unsubscribe(n)}}))},n.prototype.get=function(n){return this.checkName(n),this._bridge.get(n)},n.prototype.ready=function(){return Promise.resolve(this)},n.prototype.destroy=function(n){return this.checkName(n),this._bridge.destroy(n)},Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),n.prototype.checkName=function(n){if("string"!=typeof n||""===n)throw new Error("Please provide the name as a non-empty string!")},n.prototype.checkPath=function(n){if("string"!=typeof n)throw new Error("Please provide the path as a dot delimited string!")},n.prototype.checkData=function(n){if("object"!=typeof n)throw new Error("Please provide the data as an object!")},n}(),InvokeStatus$1;function promisify$3(n,e,t){return"function"!=typeof e&&"function"!=typeof t?n:("function"!=typeof e?e=function(){}:"function"!=typeof t&&(t=function(){}),n.then(e,t))}function rejectAfter$1(n,e,t){var r;return void 0===n&&(n=0),e.finally((function(){r&&clearTimeout(r)})),new Promise((function(e,i){r=setTimeout((function(){return i(t)}),n)}))}!function(n){n[n.Success=0]="Success",n[n.Error=1]="Error"}(InvokeStatus$1||(InvokeStatus$1={}));var Client$1=function(){function n(n,e,t,r){this.protocol=n,this.repo=e,this.instance=t,this.configuration=r}return n.prototype.subscribe=function(n,e,t,r,i){var o=this,l=function(n,t,r,l){var u;e.methodResponseTimeout=null!==(u=e.methodResponseTimeout)&&void 0!==u?u:e.waitTimeoutMs,o.protocol.client.subscribe(t,e,n,r,l,i)};return promisify$3(new Promise((function(t,r){var i,u=function(n){t(n)},s=function(n){r(n)};if(n)if((i="string"==typeof n?{name:n}:n).name){void 0===e&&(e={});var a=e.target;if(void 0===a&&(a="best"),"string"!=typeof a||"all"===a||"best"===a){void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=e.method_response_timeout,void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=e.wait_for_method_timeout,void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,d=o.getServerMethodsByFilterAndTarget(i,a);if(d.length>0)l(d,d[0].methods[0],u,s);else{var h=function(){if(a&&e.waitTimeoutMs)if(c+=500,(d=o.getServerMethodsByFilterAndTarget(i,a)).length>0){var t=d[0].methods[0];l(d,t,u,s)}else if(c>=e.waitTimeoutMs){l(d,"string"==typeof n?{name:n}:n,u,s)}else setTimeout(h,500)};setTimeout(h,500)}}else r(new Error('"'+a+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")})),t,r)},n.prototype.servers=function(n){var e=void 0===n?void 0:__assign$1$1({},n);return this.getServers(e).map((function(n){return n.server.instance}))},n.prototype.methods=function(n){return n="string"==typeof n?{name:n}:__assign$1$1({},n),this.getMethods(n)},n.prototype.methodsForInstance=function(n){return this.getMethodsForInstance(n)},n.prototype.methodAdded=function(n){return this.repo.onMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.repo.onMethodRemoved(n)},n.prototype.serverAdded=function(n){return this.repo.onServerAdded(n)},n.prototype.serverRemoved=function(n){return this.repo.onServerRemoved((function(e,t){n(e,t)}))},n.prototype.serverMethodAdded=function(n){return this.repo.onServerMethodAdded((function(e,t){n({server:e,method:t})}))},n.prototype.serverMethodRemoved=function(n){return this.repo.onServerMethodRemoved((function(e,t){n({server:e,method:t})}))},n.prototype.invoke=function(n,e,t,r,i,o){return __awaiter$1$2(this,void 0,void 0,(function(){var l=this;return __generator$2(this,(function(u){return[2,promisify$3(function(){return __awaiter$1$2(l,void 0,void 0,(function(){var i,o,l,u,s,a,c,d,h,f,p=this;return __generator$2(this,(function(g){switch(g.label){case 0:if(!(i="string"==typeof n?{name:n}:__assign$1$1({},n)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(e||(e={}),t||(t="best"),"string"==typeof t&&"all"!==t&&"best"!==t&&"skipMine"!==t)return[2,Promise.reject(new Error('"'+t+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!=typeof e)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,t)).length)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,t,r)];case 2:return o=g.sent(),[3,4];case 3:return g.sent(),l=__assign$1$1(__assign$1$1({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[]}),u={method:l,called_with:e,message:"Can not find a method matching "+JSON.stringify(n)+" with server filter "+JSON.stringify(t),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(u)];case 4:return s=r.methodResponseTimeoutMs,a=r,c=o.map((function(n){var t=shortid$2(),r=n.methods[0],i=n.server,o=p.protocol.client.invoke(t,r,e,i,a);return Promise.race([o,rejectAfter$1(s,o,{invocationId:t,message:"Invocation timeout ("+s+" ms) reached for method name: "+(null==r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(a),status:InvokeStatus$1.Error})])})),[4,Promise.all(c)];case 5:return d=g.sent(),h=this.getInvocationResultObj(d,i,e),d.every((function(n){return n.status===InvokeStatus$1.Error}))?[2,Promise.reject(h)]:[2,h]}}))}))}(),i,o)]}))}))},n.prototype.getInvocationResultObj=function(n,e,t){var r=n.filter((function(n){return n.status===InvokeStatus$1.Success})).reduce((function(n,r){return n=__spreadArrays$1(n,[{executed_by:r.instance,returned:r.result,called_with:t,method:e,message:r.message,status:r.status}])}),[]),i=n.filter((function(n){return n.status===InvokeStatus$1.Error})).reduce((function(n,r){return n=__spreadArrays$1(n,[{executed_by:r.instance,called_with:t,name:e.name,message:r.message}])}),[]),o=n[0];return{method:e,called_with:t,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},n.prototype.tryToAwaitForMethods=function(n,e,t){var r=this;return new Promise((function(i,o){if(0!==t.waitTimeoutMs)var l=0,u=setInterval((function(){l+=500;var s=r.getServerMethodsByFilterAndTarget(n,e);if(s.length>0)clearInterval(u),i(s);else if(l>=(t.waitTimeoutMs||1e4))return clearInterval(u),void o()}),500);else o()}))},n.prototype.filterByTarget=function(n,e){var t=this;if("string"!=typeof n){return(Array.isArray(n)?n:[n]).reduce((function(n,r){var i=e.filter((function(n){return t.instanceMatch(r,n.server.instance)}));return n.concat(i)}),[])}if("all"===n)return __spreadArrays$1(e);if("best"===n){var r=e.find((function(n){return n.server.instance.isLocal}));if(r)return[r];if(void 0!==e[0])return[e[0]]}else if("skipMine"===n)return e.filter((function(n){return n.server.instance.peerId!==t.instance.peerId}));return[]},n.prototype.instanceMatch=function(n,e){return this.containsProps(n,e)},n.prototype.methodMatch=function(n,e){return this.containsProps(n,e)},n.prototype.containsProps=function(n,e){return Object.keys(n).filter((function(e){return void 0!==n[e]&&"function"!=typeof n[e]&&"object_types"!==e&&"display_name"!==e&&"id"!==e&&"gatewayId"!==e&&"identifier"!==e&&"_"!==e[0]})).reduce((function(t,r){var i=n[r],o=e[r];if("objectTypes"===r){(i.length>o.length||!1===function(n,e){var t=n.reduce((function(n,e){return n[e]=!1,n}),{});e.forEach((function(n){void 0!==t[n]&&(t[n]=!0)}));return Object.keys(t).reduce((function(n,e){return t[e]||(n=!1),n}),!0)}(i,o))&&(t=!1)}else String(i).toLowerCase()!==String(o).toLowerCase()&&(t=!1);return t}),!0)},n.prototype.getMethods=function(n){var e=this;return void 0===n?this.repo.getMethods():this.repo.getMethods().filter((function(t){return e.methodMatch(n,t)}))},n.prototype.getMethodsForInstance=function(n){var e=this,t=this.repo.getServers().filter((function(t){return e.instanceMatch(n,t.instance)}));if(0===t.length)return[];var r={};return 1===t.length?r=t[0].methods:t.forEach((function(n){Object.keys(n.methods).forEach((function(e){var t=n.methods[e];r[t.identifier]=t}))})),Object.keys(r).map((function(n){return r[n]}))},n.prototype.getServers=function(n){var e=this,t=this.repo.getServers();return void 0===n?t.map((function(n){return{server:n,methods:[]}})):t.reduce((function(t,r){var i=e.repo.getServerMethodsById(r.id).filter((function(t){return e.methodMatch(n,t)}));return i.length>0&&t.push({server:r,methods:i}),t}),[])},n.prototype.getServerMethodsByFilterAndTarget=function(n,e){var t=this.getServers(n);return this.filterByTarget(e,t)},n}(),ServerSubscription$1=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.subscription=t}return Object.defineProperty(n.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),n.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},n.prototype.push=function(n){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,n)},n}(),Request$1=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.requestContext=t,this.arguments=t.arguments,this.instance=t.instance}return n.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},n.prototype.acceptOnBranch=function(n){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,n)},n.prototype.reject=function(n){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,n)},n}(),ServerStreaming$2=function(){function n(n,e){var t=this;this.protocol=n,this.server=e,n.server.onSubRequest((function(n,e){return t.handleSubRequest(n,e)})),n.server.onSubAdded((function(n,e){return t.handleSubAdded(n,e)})),n.server.onSubRemoved((function(n,e){return t.handleSubRemoved(n,e)}))}return n.prototype.handleSubRequest=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRequestHandler){var t=new Request$1(this.protocol,e,n);e.streamCallbacks.subscriptionRequestHandler(t)}},n.prototype.handleSubAdded=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionAddedHandler){var t=new ServerSubscription$1(this.protocol,e,n);e.streamCallbacks.subscriptionAddedHandler(t)}},n.prototype.handleSubRemoved=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRemovedHandler){var t=new ServerSubscription$1(this.protocol,e,n);e.streamCallbacks.subscriptionRemovedHandler(t)}},n}(),ServerBranch$1=function(){function n(n,e,t){this.key=n,this.protocol=e,this.repoMethod=t}return n.prototype.subscriptions=function(){var n=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(e){return new ServerSubscription$1(n.protocol,n.repoMethod,e)}))},n.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},n.prototype.push=function(n){this.protocol.server.pushData(this.repoMethod,n,[this.key])},n}(),ServerStream$1=function(){function n(n,e,t){this._protocol=n,this._repoMethod=e,this._server=t,this.name=this._repoMethod.definition.name}return n.prototype.branches=function(n){var e=this,t=this._protocol.server.getBranchList(this._repoMethod);return n?t.indexOf(n)>-1?new ServerBranch$1(n,this._protocol,this._repoMethod):void 0:t.map((function(n){return new ServerBranch$1(n,e._protocol,e._repoMethod)}))},n.prototype.branch=function(n){return this.branches(n)},n.prototype.subscriptions=function(){var n=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(e){return new ServerSubscription$1(n._protocol,n._repoMethod,e)}))},Object.defineProperty(n.prototype,"definition",{get:function(){var n=this._repoMethod.definition;return{accepts:n.accepts,description:n.description,displayName:n.displayName,name:n.name,objectTypes:n.objectTypes,returns:n.returns,supportsStreaming:n.supportsStreaming}},enumerable:!0,configurable:!0}),n.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},n.prototype.push=function(n,e){if("string"!=typeof e&&!Array.isArray(e)&&void 0!==e)throw new Error("invalid branches should be string or string array");if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,n,e)},n.prototype.updateRepoMethod=function(n){this._repoMethod=n},n}(),Server$1=function(){function n(n,e){this.protocol=n,this.serverRepository=e,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming$2(n,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return n.prototype.createStream=function(n,e,t,r,i){var o=this;return promisify$3(new Promise((function(t,r){if(n){var l;if(!(l="string"==typeof n?{name:""+n}:__assign$1$1({},n)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: "+JSON.stringify(l));if(o.serverRepository.getList().some((function(n){return n.definition.name===l.name})))return r('A stream with the name "'+l.name+'" already exists! Please, provide a unique name for the stream.');l.supportsStreaming=!0,e||(e={}),"function"!=typeof e.subscriptionRequestHandler&&(e.subscriptionRequestHandler=function(n){n.accept()});var u=o.serverRepository.add({definition:l,streamCallbacks:e,protocolState:{}});o.protocol.server.createStream(u).then((function(){var n;i?(n=i,i.updateRepoMethod(u)):n=new ServerStream$1(o.protocol,u,o),u.stream=n,t(n)})).catch((function(n){u.repoId&&o.serverRepository.remove(u.repoId),r(n)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")})),t,r)},n.prototype.register=function(n,e){var t=this;if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var r=function(n,r){return __awaiter$1$2(t,void 0,void 0,(function(){var t,i,o;return __generator$2(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(t=e(n.args,n.instance))&&"function"==typeof t.then?[4,t]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,t),l.label=3;case 3:return[3,5];case 4:return(o=l.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=e,this.registerCore(n,r)},n.prototype.registerAsync=function(n,e){if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var t=function(n,t){try{var r=!1,i=function(n){r||t(void 0,n),r=!0},o=function(n){r||(n||(n=""),t(n,n)),r=!0},l=e(n.args,n.instance,i,o);l&&"function"==typeof l.then&&l.then(i).catch(o)}catch(n){t(n,void 0)}};return t.userCallbackAsync=e,this.registerCore(n,t)},n.prototype.unregister=function(n,e){return void 0===e&&(e=!1),__awaiter$1$2(this,void 0,void 0,(function(){var t,r;return __generator$2(this,(function(i){switch(i.label){case 0:return void 0===n?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof n?[3,2]:[4,this.unregisterWithPredicate(n,e)];case 1:return i.sent(),[2];case 2:return void 0===(t="string"==typeof n?{name:n}:n).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(n){return n.definition.name===t.name&&(n.definition.supportsStreaming||!1)===e})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+t.name+'" does not exist or is not registered by your application!')];case 3:return i.sent(),[2]}}))}))},n.prototype.unregisterWithPredicate=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t;return __generator$2(this,(function(r){switch(r.label){case 0:return(t=this.serverRepository.getList().filter((function(e){return n(e.definition)})).filter((function(n){return(n.definition.supportsStreaming||!1)===e})))&&0!==t.length?[4,this.removeMethodsOrStreams(t)]:[2,Promise.reject("Could not find a "+(e?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},n.prototype.removeMethodsOrStreams=function(n){var e=this,t=[];return n.forEach((function(n){var r=e.protocol.server.unregister(n).then((function(){n.repoId&&e.serverRepository.remove(n.repoId)}));t.push(r),e.addAsCurrentlyUnregistering(n.definition.name,r)})),Promise.all(t)},n.prototype.addAsCurrentlyUnregistering=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t,r=this;return __generator$2(this,(function(i){return t=new Promise((function(n){return setTimeout(n,5e3)})),this.currentlyUnregistering[n]=Promise.race([e,t]).then((function(){delete r.currentlyUnregistering[n]})),[2]}))}))},n.prototype.registerCore=function(n,e){return __awaiter$1$2(this,void 0,void 0,(function(){var t,r,i,o=this;return __generator$2(this,(function(l){switch(l.label){case 0:return(t="string"==typeof n?{name:""+n}:__assign$1$1({},n)).name?(r=this.currentlyUnregistering[t.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: "+JSON.stringify(n))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(n){return n.definition.name===t.name}))?[2,Promise.reject('A method with the name "'+t.name+'" already exists! Please, provide a unique name for the method.')]:t.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want "+t.name+" to be a stream, please use the glue.interop.createStream() method.")]:(i=this.serverRepository.add({definition:t,theFunction:e,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(n){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),n}))])}}))}))},n.prototype.onMethodInvoked=function(n,e,t){var r=this;n&&n.theFunction&&n.theFunction(t,(function(t,i){if(null!=t)if(t.message&&"string"==typeof t.message)t=t.message;else if("string"!=typeof t)try{t=JSON.stringify(t)}catch(n){t="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(t)}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(n,e,t,i)}))},n}(),InstanceWrapper$1=function(){function n(n,e){var t=this;this.wrapped={getMethods:getMethods$1,getStreams:getStreams$1},n&&this.refreshWrappedObject(n),e&&(e.loggedIn((function(){t.refresh(e)})),this.refresh(e))}return n.prototype.unwrap=function(){return this.wrapped},n.prototype.refresh=function(n){if(n){var e=null==n?void 0:n.resolvedIdentity,t=Object.assign({},null!=e?e:{},{peerId:null==n?void 0:n.peerId});this.refreshWrappedObject(t)}},n.prototype.refreshWrappedObject=function(n){var e,t,r;this.wrapped.user=n.user,this.wrapped.instance=n.instance,this.wrapped.application=null!==(e=n.application)&&void 0!==e?e:shortid$2(),this.wrapped.applicationName=n.applicationName,this.wrapped.pid=null!==(r=null!==(t=n.pid)&&void 0!==t?t:n.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=n.machine,this.wrapped.environment=n.environment,this.wrapped.region=n.region,this.wrapped.windowId=n.windowId,this.wrapped.isLocal=!0,this.wrapped.api=n.api,this.wrapped.service=n.service,this.wrapped.peerId=n.peerId},n}();function getMethods$1(){var n;return null===(n=InstanceWrapper$1.API)||void 0===n?void 0:n.methodsForInstance(this)}function getStreams$1(){var n;return null===(n=InstanceWrapper$1.API)||void 0===n?void 0:n.methodsForInstance(this).filter((function(n){return n.supportsStreaming}))}var ClientRepository$1=function(){function n(n){this.logger=n,this.servers={},this.methodsCount={},this.callbacks=lib$1$1()}return n.prototype.addServer=function(n,e){this.logger.debug("adding server "+e);var t=this.servers[e];if(t)return t.id;var r=new InstanceWrapper$1(n),i={id:e,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[e]=i,this.callbacks.execute("onServerAdded",i.instance),e},n.prototype.removeServerById=function(n,e){var t=this,r=this.servers[n];r?(this.logger.debug("removing server "+n),Object.keys(r.methods).forEach((function(e){t.removeServerMethod(n,e)})),delete this.servers[n],this.callbacks.execute("onServerRemoved",r.instance,e)):this.logger.warn("not aware of server "+n+", my state "+JSON.stringify(Object.keys(this.servers)))},n.prototype.addServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");if(!t.methods[e.id]){var r=this.createMethodIdentifier(e),i=this,o={identifier:r,gatewayId:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types||[],accepts:e.input_signature,returns:e.result_signature,supportsStreaming:void 0!==e.flags&&e.flags.streaming,getServers:function(){return i.getServersByMethod(r)}};return o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,t.methods[e.id]=o,this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",o)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",t.instance,o),o}},n.prototype.removeServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");var r=t.methods[e];delete t.methods[e],this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",t.instance,r)},n.prototype.getMethods=function(){var n=this,e={};return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];Object.keys(r.methods).forEach((function(n){var t=r.methods[n];e[t.identifier]=t}))})),Object.keys(e).map((function(n){return e[n]}))},n.prototype.getServers=function(){var n=this,e=[];return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];e.push(r)})),e},n.prototype.getServerMethodsById=function(n){var e=this.servers[n];return Object.keys(e.methods).map((function(n){return e.methods[n]}))},n.prototype.onServerAdded=function(n){var e=this.callbacks.add("onServerAdded",n),t=this.getServers().map((function(n){return n.instance}));return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onMethodAdded=function(n){var e=this.callbacks.add("onMethodAdded",n),t=this.getMethods();return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onServerMethodAdded=function(n){var e=this.callbacks.add("onServerMethodAdded",n),t=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(e){var r=e.methods;Object.keys(r).forEach((function(i){t||n(e.instance,r[i])}))}))}),0),function(){t=!0,e()}},n.prototype.onMethodRemoved=function(n){return this.callbacks.add("onMethodRemoved",n)},n.prototype.onServerRemoved=function(n){return this.callbacks.add("onServerRemoved",n)},n.prototype.onServerMethodRemoved=function(n){return this.callbacks.add("onServerMethodRemoved",n)},n.prototype.getServerById=function(n){return this.servers[n]},n.prototype.reset=function(){var n=this;Object.keys(this.servers).forEach((function(e){n.removeServerById(e,"reset")})),this.servers={},this.methodsCount={}},n.prototype.createMethodIdentifier=function(n){var e=void 0!==n.input_signature?n.input_signature:"",t=void 0!==n.result_signature?n.result_signature:"";return(n.name+e+t).toLowerCase()},n.prototype.getServersByMethod=function(n){var e=this,t=[];return Object.keys(this.servers).forEach((function(r){var i=e.servers[r];Object.keys(i.methods).forEach((function(e){i.methods[e].identifier===n&&t.push(i.instance)}))})),t},n.prototype.returnUnsubWithDelayedReplay=function(n,e,t){var r=!1;return setTimeout((function(){e.forEach((function(n){r||t(n)}))}),0),function(){r=!0,n()}},n}(),ServerRepository$1=function(){function n(){this.nextId=0,this.methods=[]}return n.prototype.add=function(n){return n.repoId=String(this.nextId),this.nextId+=1,this.methods.push(n),n},n.prototype.remove=function(n){if("string"!=typeof n)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(e){return e.repoId!==n}))},n.prototype.getById=function(n){if("string"==typeof n)return this.methods.find((function(e){return e.repoId===n}))},n.prototype.getList=function(){return this.methods.map((function(n){return n}))},n.prototype.length=function(){return this.methods.length},n.prototype.reset=function(){this.methods=[]},n}(),SUBSCRIPTION_REQUEST$1="onSubscriptionRequest",SUBSCRIPTION_ADDED$1="onSubscriptionAdded",SUBSCRIPTION_REMOVED$1="onSubscriptionRemoved",ServerStreaming$1$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.serverRepository=t,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib$1$1(),this.nextStreamId=0,n.on("add-interest",(function(n){r.handleAddInterest(n)})),n.on("remove-interest",(function(n){r.handleRemoveInterest(n)}))}return n.prototype.acceptRequestOnBranch=function(n,e,t){if("string"!=typeof t&&(t=""),"object"!=typeof e.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(e.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(e,t),i=n.msg.subscription_id,o={id:i,arguments:n.arguments,instance:n.instance,branchKey:t,streamId:r,subscribeMsg:n.msg};e.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED$1,o,e)},n.prototype.rejectRequest=function(n,e,t){"string"!=typeof t&&(t=""),this.sendSubscriptionFailed("Subscription rejected by user. "+t,n.msg.subscription_id)},n.prototype.pushData=function(n,e,t){var r=this;if("object"==typeof n&&Array.isArray(n.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof t?t=[t]:(!Array.isArray(t)||t.length<=0)&&(t=[]),n.protocolState.branchKeyToStreamIdMap.filter((function(n){return!t||0===t.length||t.indexOf(n.key)>=0})).map((function(n){return n.streamId})).forEach((function(n){var t={type:"publish",stream_id:n,data:e};r.session.sendFireAndForget(t)}))}},n.prototype.pushDataToSingle=function(n,e,t){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:e.id,data:t};this.session.sendFireAndForget(r)},n.prototype.closeSingleSubscription=function(n,e){n.protocolState.subscriptionsMap&&delete n.protocolState.subscriptionsMap[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(t);e.instance;this.callbacks.execute(SUBSCRIPTION_REMOVED$1,e,n)},n.prototype.closeMultipleSubscriptions=function(n,e){var t=this;if("object"==typeof n&&"object"==typeof n.protocolState.subscriptionsMap&&n.protocolState.subscriptionsMap){var r=n.protocolState.subscriptionsMap,i=Object.keys(r).map((function(n){return r[n]}));"string"==typeof e&&(i=i.filter((function(n){return n.branchKey===e}))),i.forEach((function(n){delete r[n.id];var e={type:"drop-subscription",subscription_id:n.id,reason:"Server dropping all subscriptions on stream_id: "+n.streamId};t.session.sendFireAndForget(e)}))}},n.prototype.getSubscriptionList=function(n,e){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var t=n.protocolState.subscriptionsMap,r=Object.keys(t).map((function(n){return t[n]}));return"string"!=typeof e?r:r.filter((function(n){return n.branchKey===e}))},n.prototype.getBranchList=function(n){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var e=n.protocolState.subscriptionsMap,t=Object.keys(e).map((function(n){return e[n]})),r=[];return t.forEach((function(n){var e="";"object"==typeof n&&"string"==typeof n.branchKey&&(e=n.branchKey),-1===r.indexOf(e)&&r.push(e)})),r},n.prototype.onSubAdded=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED$1,n)},n.prototype.onSubRequest=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST$1,n)},n.prototype.onSubRemoved=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED$1,n)},n.prototype.handleRemoveInterest=function(n){var e=this.serverRepository.getById(n.method_id);if("string"==typeof n.subscription_id&&"object"==typeof e&&e.protocolState.subscriptionsMap&&"object"==typeof e.protocolState.subscriptionsMap[n.subscription_id]){var t=e.protocolState.subscriptionsMap[n.subscription_id];delete e.protocolState.subscriptionsMap[n.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED$1,t,e)}},n.prototype.onSubscriptionLifetimeEvent=function(n,e){this.callbacks.add(n,e)},n.prototype.getNextStreamId=function(){return this.nextStreamId+++""},n.prototype.handleAddInterest=function(n){var e=this.repository.getServerById(n.caller_id).instance,t={msg:n,arguments:n.arguments_kv||{},instance:e},r=this.serverRepository.getById(n.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[n.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+n.subscription_id+" already exists.",n.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST$1,t,r);else{var i="No method with id "+n.method_id+" on this server.";this.sendSubscriptionFailed(i,n.subscription_id)}},n.prototype.sendSubscriptionFailed=function(n,e){var t={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:n,request_id:e};this.session.sendFireAndForget(t)},n.prototype.getStreamId=function(n,e){if("string"!=typeof e&&(e=""),!n.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+n.definition.name+" method without protocol state");var t=n.protocolState.branchKeyToStreamIdMap.filter((function(n){return n.key===e}))[0],r=t?t.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),n.protocolState.branchKeyToStreamIdMap.push({key:e,streamId:r})),r},n}(),ServerProtocol$1=function(){function n(n,e,t,r){var i=this;this.session=n,this.clientRepository=e,this.serverRepository=t,this.logger=r,this.callbacks=lib$1$1(),this.streaming=new ServerStreaming$1$1(n,e,t),this.session.on("invoke",(function(n){return i.handleInvokeMessage(n)}))}return n.prototype.createStream=function(n){return n.protocolState.subscriptionsMap={},n.protocolState.branchKeyToStreamIdMap=[],this.register(n,!0)},n.prototype.register=function(n,e){var t=this,r=n.definition,i={streaming:e||!1},o={type:"register",methods:[{id:n.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:i,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(o,{methodId:n.repoId}).then((function(){t.logger.debug("registered method "+n.definition.name+" with id "+n.repoId)})).catch((function(e){throw t.logger.warn("failed to register method "+n.definition.name+" with id "+n.repoId+" - "+JSON.stringify(e)),e}))},n.prototype.onInvoked=function(n){this.callbacks.add("onInvoked",n)},n.prototype.methodInvocationResult=function(n,e,t,r){var i;i=t||""===t?{type:"error",request_id:e,reason_uri:"agm.errors.client_error",reason:t,context:r,peer_id:void 0}:{type:"yield",invocation_id:e,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},n.prototype.unregister=function(n){return __awaiter$1$2(this,void 0,void 0,(function(){var e;return __generator$2(this,(function(t){switch(t.label){case 0:return e={type:"unregister",methods:[n.repoId]},[4,this.session.send(e)];case 1:return t.sent(),[2]}}))}))},n.prototype.getBranchList=function(n){return this.streaming.getBranchList(n)},n.prototype.getSubscriptionList=function(n,e){return this.streaming.getSubscriptionList(n,e)},n.prototype.closeAllSubscriptions=function(n,e){this.streaming.closeMultipleSubscriptions(n,e)},n.prototype.pushData=function(n,e,t){this.streaming.pushData(n,e,t)},n.prototype.pushDataToSingle=function(n,e,t){this.streaming.pushDataToSingle(n,e,t)},n.prototype.closeSingleSubscription=function(n,e){this.streaming.closeSingleSubscription(n,e)},n.prototype.acceptRequestOnBranch=function(n,e,t){this.streaming.acceptRequestOnBranch(n,e,t)},n.prototype.rejectRequest=function(n,e,t){this.streaming.rejectRequest(n,e,t)},n.prototype.onSubRequest=function(n){this.streaming.onSubRequest(n)},n.prototype.onSubAdded=function(n){this.streaming.onSubAdded(n)},n.prototype.onSubRemoved=function(n){this.streaming.onSubRemoved(n)},n.prototype.handleInvokeMessage=function(n){var e=n.invocation_id,t=n.caller_id,r=n.method_id,i=n.arguments_kv,o=this.serverRepository.getList().filter((function(n){return n.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(t).instance};this.callbacks.execute("onInvoked",o,e,l)}},n}(),UserSubscription$1=function(){function n(n,e){this.repository=n,this.subscriptionData=e}return Object.defineProperty(n.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"servers",{get:function(){var n=this;return this.subscriptionData.trackedServers.filter((function(n){return n.subscriptionId})).map((function(e){return n.repository.getServerById(e.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),n.prototype.onData=function(n){if("function"!=typeof n)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(n),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(e){n(e)}))},n.prototype.onClosed=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(n)},n.prototype.onFailed=function(n){},n.prototype.onConnected=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(n)},n.prototype.close=function(){this.subscriptionData.close()},n.prototype.setNewSubscription=function(n){this.subscriptionData=n},n}(),STATUS_AWAITING_ACCEPT$1="awaitingAccept",STATUS_SUBSCRIBED$1="subscribed",ERR_MSG_SUB_FAILED$1="Subscription failed.",ERR_MSG_SUB_REJECTED$1="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT$1="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT$1="ClientInitiated",ClientStreaming$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(n){var e=n._tag,t=e.subLocalKey,i=r.subscriptionsList[t];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(n){return n.serverId!==e.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT$1){var o="string"==typeof n.reason&&""!==n.reason?' Publisher said "'+n.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED$1+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED$1&&r.callOnClosedHandlers(i);delete r.subscriptionsList[t]}},this.handleSubscribed=function(n){var e=n._tag.subLocalKey,t=r.subscriptionsList[e];if("object"==typeof t){var i=n._tag.serverId,o=t.trackedServers.filter((function(n){return n.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=n.subscription_id,r.subscriptionIdToLocalKeyMap[n.subscription_id]=e;var l=t.status===STATUS_AWAITING_ACCEPT$1;if(t.status=STATUS_SUBSCRIBED$1,l){var u=!1,s=t.subscription;s?(s.setNewSubscription(t),t.success(s),u=!0):(s=new UserSubscription$1(r.repository,t),t.subscription=s,t.success(s));for(var a=0,c=t.handlers.onConnected;a<c.length;a++){var d=c[a];try{d(s.serverInstance,u)}catch(n){}}}}}},this.handleEventData=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.filter((function(e){return e.subscriptionId===n.subscription_id}));if(1===i.length){var o=n.oob,l=i[0].serverId,u=function(){return{data:n.data,server:r.repository.getServerById(l).instance,requestArguments:t.params.arguments,message:void 0,private:o}},s=t.handlers.onData,a=t.queued.data;s.length>0?s.forEach((function(n){"function"==typeof n&&n(u())})):a.push(u())}}}},this.handleSubscriptionCancelled=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.length-1;t.trackedServers=t.trackedServers.filter((function(e){return e.subscriptionId!==n.subscription_id||(t.queued.closers.push(e.serverId),!1)})),t.trackedServers.length===i&&(t.trackedServers.length<=0&&(clearTimeout(t.timeoutId),r.callOnClosedHandlers(t),delete r.subscriptionsList[e]),delete r.subscriptionIdToLocalKeyMap[n.subscription_id])}}},n.on("subscribed",this.handleSubscribed),n.on("event",this.handleEventData),n.on("subscription-cancelled",this.handleSubscriptionCancelled)}return n.prototype.subscribe=function(n,e,t,r,i,o){var l=this;if(0!==t.length){var u=this.getNextSubscriptionLocalKey(),s=this.registerSubscription(u,n,e,r,i,e.methodResponseTimeout||1e4,o);"object"==typeof s?t.forEach((function(t){var r=t.server.id,i=t.methods.find((function(e){return e.name===n.name}));if(i){s.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:e.arguments};l.session.send(o,{serverId:r,subLocalKey:u}).then((function(n){return l.handleSubscribed(n)})).catch((function(n){return l.handleErrorSubscribing(n)}))}else l.logger.error("can not find method "+n.name+" for target "+t.server.id)})):i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$1+" Unable to register the user callbacks."})}else i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$1+" No available servers matched the target params."})},n.prototype.drainSubscriptions=function(){var n=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},n},n.prototype.getNextSubscriptionLocalKey=function(){var n=this.nextSubLocalKey;return this.nextSubLocalKey+=1,n},n.prototype.registerSubscription=function(n,e,t,r,i,o,l){var u=this,s={localKey:n,status:STATUS_AWAITING_ACCEPT$1,method:e,params:t,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return u.closeSubscription(n)},subscription:null==l?void 0:l.subscription};return l||(t.onData&&s.handlers.onData.push(t.onData),t.onClosed&&s.handlers.onClosed.push(t.onClosed),t.onConnected&&s.handlers.onConnected.push(t.onConnected)),this.subscriptionsList[n]=s,s.timeoutId=setTimeout((function(){if(void 0!==u.subscriptionsList[n]){var r=u.subscriptionsList[n];r.status===STATUS_AWAITING_ACCEPT$1?(i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED$1+" Subscription attempt timed out after "+o+" ms."}),delete u.subscriptionsList[n]):r.status===STATUS_SUBSCRIBED$1&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(n){return void 0!==n.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(u.callOnClosedHandlers(r),delete u.subscriptionsList[n]))}}),o),s},n.prototype.callOnClosedHandlers=function(n,e){var t,r=n.queued.closers.length,i=r>0?n.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(t=this.repository.getServerById(i).instance),n.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:e||ON_CLOSE_MSG_SERVER_INIT$1,requestArguments:n.params.arguments||{},server:t,stream:n.method})}))},n.prototype.closeSubscription=function(n){var e=this,t=this.subscriptionsList[n];"object"==typeof t&&(t.trackedServers.forEach((function(n){void 0!==n.subscriptionId&&(t.queued.closers.push(n.serverId),e.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT$1}),delete e.subscriptionIdToLocalKeyMap[n.subscriptionId])})),t.trackedServers=[],this.callOnClosedHandlers(t,ON_CLOSE_MSG_CLIENT_INIT$1),delete this.subscriptionsList[n])},n}(),ClientProtocol$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,n.on("peer-added",(function(n){return r.handlePeerAdded(n)})),n.on("peer-removed",(function(n){return r.handlePeerRemoved(n)})),n.on("methods-added",(function(n){return r.handleMethodsAddedMessage(n)})),n.on("methods-removed",(function(n){return r.handleMethodsRemovedMessage(n)})),this.streaming=new ClientStreaming$1(n,e,t)}return n.prototype.subscribe=function(n,e,t,r,i,o){this.streaming.subscribe(n,e,t,r,i,o)},n.prototype.invoke=function(n,e,t,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:e.gatewayId,arguments_kv:t};return this.session.send(l,{invocationId:n,serverId:o}).then((function(n){return i.handleResultMessage(n)})).catch((function(n){return i.handleInvocationError(n)}))},n.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},n.prototype.handlePeerAdded=function(n){var e=n.new_peer_id,t=n.identity,r=!n.meta||n.meta.local,i=Number(t.process),o={machine:t.machine,pid:isNaN(i)?t.process:i,instance:t.instance,application:t.application,applicationName:t.applicationName,environment:t.environment,region:t.region,user:t.user,windowId:t.windowId,peerId:e,api:t.api,isLocal:r};this.repository.addServer(o,e)},n.prototype.handlePeerRemoved=function(n){var e=n.removed_id,t=n.reason;this.repository.removeServerById(e,t)},n.prototype.handleMethodsAddedMessage=function(n){var e=this,t=n.server_id;n.methods.forEach((function(n){e.repository.addServerMethod(t,n)}))},n.prototype.handleMethodsRemovedMessage=function(n){var e=this,t=n.server_id,r=n.methods,i=this.repository.getServerById(t);Object.keys(i.methods).forEach((function(n){var o=i.methods[n];r.indexOf(o.gatewayId)>-1&&e.repository.removeServerMethod(t,n)}))},n.prototype.handleResultMessage=function(n){var e=n._tag.invocationId,t=n.result,r=n._tag.serverId;return{invocationId:e,result:t,instance:this.repository.getServerById(r).instance,status:InvokeStatus$1.Success,message:""}},n.prototype.handleInvocationError=function(n){if(this.logger.debug("handle invocation error "+JSON.stringify(n)),"_tag"in n){var e=n._tag.invocationId,t=n._tag.serverId,r=this.repository.getServerById(t),i=n.reason;return{invocationId:e,result:n.context,instance:r.instance,status:InvokeStatus$1.Error,message:i}}return{invocationId:"",message:n.message,status:InvokeStatus$1.Error,error:n}},n}();function gW3ProtocolFactory$1(n,e,t,r,i,o){var l,u=i.logger.subLogger("gw3-protocol"),s=new Promise((function(n){l=n})),a=e.domain("agm",["subscribed"]),c=new ServerProtocol$1(a,t,r,u.subLogger("server")),d=new ClientProtocol$1(a,t,u.subLogger("client"));return a.onJoined((function(i){t.addServer(n,e.peerId),i?function(){u.info("reconnected - will replay registered methods and subscriptions");for(var n=0,e=d.drainSubscriptions();n<e.length;n++){var t=e[n],i=t.method,l=Object.assign({},t.params);u.info("trying to re-subscribe to method "+i.name),o.client.subscribe(i,l,void 0,void 0,t)}var s=r.getList();r.reset();for(var a=0,c=s;a<c.length;a++){var h=c[a],f=h.definition;u.info("re-publishing method "+f.name),h.stream?o.server.createStream(f,h.streamCallbacks,void 0,void 0,h.stream):h.theFunction&&h.theFunction.userCallback?o.register(f,h.theFunction.userCallback):h.theFunction&&h.theFunction.userCallbackAsync&&o.registerAsync(f,h.theFunction.userCallbackAsync)}}():l&&(l({client:d,server:c}),l=void 0)})),a.onLeft((function(){t.reset()})),a.join(),s}var Interop$1=function(){function n(n){var e=this;if(void 0===n)throw new Error("configuration is required");if(void 0===n.connection)throw new Error("configuration.connections is required");var t,r=n.connection;if("number"!=typeof n.methodResponseTimeout&&(n.methodResponseTimeout=3e4),"number"!=typeof n.waitTimeoutMs&&(n.waitTimeoutMs=3e4),InstanceWrapper$1.API=this,this.instance=new InstanceWrapper$1(void 0,r).unwrap(),this.clientRepository=new ClientRepository$1(n.logger.subLogger("cRep")),this.serverRepository=new ServerRepository$1,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");t=gW3ProtocolFactory$1(this.instance,r,this.clientRepository,this.serverRepository,n,this),this.readyPromise=t.then((function(t){return e.protocol=t,e.client=new Client$1(e.protocol,e.clientRepository,e.instance,n),e.server=new Server$1(e.protocol,e.serverRepository),e}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.serverRemoved=function(n){return this.client.serverRemoved(n)},n.prototype.serverAdded=function(n){return this.client.serverAdded(n)},n.prototype.serverMethodRemoved=function(n){return this.client.serverMethodRemoved(n)},n.prototype.serverMethodAdded=function(n){return this.client.serverMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.client.methodRemoved(n)},n.prototype.methodAdded=function(n){return this.client.methodAdded(n)},n.prototype.methodsForInstance=function(n){return this.client.methodsForInstance(n)},n.prototype.methods=function(n){return this.client.methods(n)},n.prototype.servers=function(n){return this.client.servers(n)},n.prototype.subscribe=function(n,e,t,r){return this.client.subscribe(n,e,t,r)},n.prototype.createStream=function(n,e,t,r){return this.server.createStream(n,e,t,r)},n.prototype.unregister=function(n){return this.server.unregister(n)},n.prototype.registerAsync=function(n,e){return this.server.registerAsync(n,e)},n.prototype.register=function(n,e){return this.server.register(n,e)},n.prototype.invoke=function(n,e,t,r,i,o){return this.client.invoke(n,e,t,r,i,o)},n}(),successMessages$1=["subscribed","success"],MessageBus$1=function(){function n(n,e){var t=this;this.publish=function(n,e,r){var i=r||{},o=i.routingKey,l=i.target,u=t.removeEmptyValues({type:"publish",topic:n,data:e,peer_id:t.peerId,routing_key:o,target_identity:l});t.session.send(u)},this.subscribe=function(n,e,r){return new Promise((function(i,o){var l=r||{},u=l.routingKey,s=l.target,a=t.removeEmptyValues({type:"subscribe",topic:n,peer_id:t.peerId,routing_key:u,source:s});t.session.send(a).then((function(r){var o=r.subscription_id;t.subscriptions.push({subscription_id:o,topic:n,callback:e,source:s}),i({unsubscribe:function(){return t.session.send({type:"unsubscribe",subscription_id:o,peer_id:t.peerId}),t.subscriptions=t.subscriptions.filter((function(n){return n.subscription_id!==o})),Promise.resolve()}})})).catch((function(n){return o(n)}))}))},this.watchOnEvent=function(){t.session.on("event",(function(n){var e=n.data,r=n.subscription_id,i=n["publisher-identity"],o=t.subscriptions.find((function(n){return n.subscription_id===r}));o&&(o.source?t.keysMatch(o.source,i)&&o.callback(e,o.topic,i):o.callback(e,o.topic,i))}))},this.connection=n,this.logger=e,this.peerId=n.peerId,this.subscriptions=[],this.session=n.domain("bus",successMessages$1),this.readyPromise=this.session.join(),this.readyPromise.then((function(){t.watchOnEvent()}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.removeEmptyValues=function(n){var e={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&null!==n[t]&&(e[t]=n[t])})),e},n.prototype.keysMatch=function(n,e){var t=Object.keys(n),r=!0;return t.forEach((function(t){n[t]!==e[t]&&(r=!1)})),r},n}(),GlueCore$1=function(n,e){var t,r=Utils$2.getGDMajorVersion(),i=Promise.resolve();if(r){if(r<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");r>=3&&(t=window.glue42gd,i=window.gdPreloadPromise||i)}var o,l,u,s,a,c,d,h=timer$1("glue"),f=prepareConfig$2(n=n||{},e=e||{},t),p={};function g(n,e,t){(d=u.canPublish("trace"))&&u.trace("registering "+n+" module");var r=function(){e.initTime=t.stop(),e.initEndTime=t.endTime,e.marks=t.marks,d&&u.trace(n+" is ready - "+(t.endTime-t.startTime))};e.initStartTime=t.startTime,e.ready?e.ready().then((function(){r()})):r(),Array.isArray(n)||(n=[n]),n.forEach((function(n){p[n]=e,GlueCore$1[n]=e}))}function w(){var n=timer$1("interop"),e={connection:o,logger:u.subLogger("interop")};return l=new Interop$1(e),Logger$2.Interop=l,g(["interop","agm"],l,n),Promise.resolve()}function v(){var n=f.activities&&3===o.protocolVersion;if(f.contexts||n){var e=timer$1("contexts");return g("contexts",a=new ContextsModule$1({connection:o,logger:u.subLogger("contexts")}),e),a}var t=o.replayer;t&&t.drain(ContextMessageReplaySpec$1.name)}function m(){return __awaiter$1$2(this,void 0,void 0,(function(){var n;return __generator$2(this,(function(e){return f.bus?(n=timer$1("bus"),g("bus",c=new MessageBus$1(o,u.subLogger("bus")),n),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function y(n){try{return n.forEach((function(n){!function(n,e){var t=timer$1(n),r=e(p);r&&g(n,r,t)}(n.name,n.create)})),Promise.resolve()}catch(n){return Promise.reject(n)}}return i.then((function(){var n,e=timer$1("logger");return(u=new Logger$2(""+(null===(n=f.connection.identity)||void 0===n?void 0:n.application),void 0,f.customLogger)).consoleLevel(f.logger.console),u.publishLevel(f.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,e),Promise.resolve(void 0)})).then((function(){var n=timer$1("connection");o=new Connection$1(f.connection,u.subLogger("connection"));var e=Promise.resolve(f.auth);return f.connection&&!f.auth&&(e=t?t.getGWToken().then((function(n){return{gatewayToken:n}})):Promise.reject("You need to provide auth information")),e.then((function(e){var t;if(n.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));return t=e,o.login(t)})).then((function(){return g("connection",o,n),f})).catch((function(n){throw o&&o.logout(),n}))})).then((function(){return Promise.all([(l=timer$1("metrics"),a=f.metrics,c=null==t?void 0:t.getMetricsPublishingEnabled,d=f.connection.identity,h=c||function(){return!0},p=null!==(n="boolean"!=typeof a&&a.disableAutoAppSystem)&&void 0!==n&&n,g("metrics",s=metrics$1({connection:a?o:void 0,logger:u.subLogger("metrics"),canUpdateMetric:h,system:"Glue42",service:null!==(e=null==d?void 0:d.service)&&void 0!==e?e:"metrics-service",instance:null!==(i=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==i?i:shortid$2(),disableAutoAppSystem:p,pagePerformanceMetrics:"boolean"!=typeof a?null==a?void 0:a.pagePerformanceMetrics:void 0}),l),Promise.resolve()),w(),v(),m()]);var n,e,r,i,l,a,c,d,h,p})).then((function(){return l.readyPromise})).then((function(){return y(f.libs||[])})).then((function(){var n=Object.keys(p).map((function(n){var e=p[n];return e.ready?e.ready():Promise.resolve()}));return Promise.all(n)})).then((function(){var r={coreVersion:version$3,version:f.version};h.stop();var i={feedback:function(n){l&&l.invoke("T42.ACS.Feedback",n,"best")},info:r,logger:u,interop:l,agm:l,connection:o,metrics:s,contexts:a,bus:c,version:f.version,userConfig:n,done:function(){return null==u||u.info("done called by user..."),o.logout()}};if(i.performance={get glueVer(){return f.version},get glueConfig(){return JSON.stringify(n)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var n=getAllTimers$1();return Object.keys(n).map((function(e){var t=n[e];return{name:e,duration:t.endTime-t.startTime,marks:t.marks}}))}},Object.keys(p).forEach((function(n){var e=p[n];i[n]=e})),i.config={},Object.keys(f).forEach((function(n){i.config[n]=f[n]})),e&&e.extOptions&&Object.keys(e.extOptions).forEach((function(n){i.config[n]=null==e?void 0:e.extOptions[n]})),(null==e?void 0:e.enrichGlue)&&e.enrichGlue(i),t&&t.updatePerfData&&t.updatePerfData(i.performance),i.agm){var d=function(n,e,t){return function(){i.logger.warn("glue.js - 'glue.agm."+e+"' method is deprecated, use 'glue.interop."+t+"' instead."),n.apply(i.agm,arguments)}},g=i.agm;g.method_added=d(i.agm.methodAdded,"method_added","methodAdded"),g.method_removed=d(i.agm.methodRemoved,"method_removed","methodRemoved"),g.server_added=d(i.agm.serverAdded,"server_added","serverAdded"),g.server_method_aded=d(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),g.server_method_removed=d(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(n){return Promise.reject({err:n,libs:p})}))};"undefined"!=typeof window&&(window.GlueCore=GlueCore$1),GlueCore$1.version=version$3,GlueCore$1.default=GlueCore$1;var version$1$1="2.0.1";const glueWebFactory=createFactoryFunction(GlueCore$1);if("undefined"!=typeof window){const n=window;n.GlueWeb=glueWebFactory,delete n.GlueCore}glueWebFactory.version=version$1$1;var version$4="1.2.13-beta.0";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __rest$1(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function __awaiter$3(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,u)}s((r=r.apply(n,e||[])).next())}))}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __awaiter$1$3(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,u)}s((r=r.apply(n,e||[])).next())}))}const defaultConfig$1={logger:"trace",gateway:{webPlatform:{}},libraries:[]},parseConfig$1=n=>{var e;const t=Object.assign({},defaultConfig$1,n);return t.systemLogger&&(t.logger=null!==(e=t.systemLogger.level)&&void 0!==e?e:"trace"),t},checkSingleton$1=()=>{const n=window.glue42core;if(n){if(n.webStarted)throw new Error("The Glue42 Core Web has already been started for this application.");n.webStarted=!0}else window.glue42core={webStarted:!0}},enterprise$1=n=>{var e,t;const r={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:n.libraries,logger:null!==(t=null===(e=null==n?void 0:n.systemLogger)||void 0===e?void 0:e.level)&&void 0!==t?t:"warn"};return window.Glue(r)};var ok$1=function(n){return{ok:!0,result:n}},isOk$1=function(n){return!0===n.ok},err$1=function(n){return{ok:!1,error:n}},isErr$1=function(n){return!1===n.ok},asPromise$1=function(n){return!0===n.ok?Promise.resolve(n.result):Promise.reject(n.error)},withDefault$1=function(n,e){return!0===e.ok?e.result:n},withException$1=function(n){if(!0===n.ok)return n.result;throw n.error},successes$1=function(n){return n.reduce((function(n,e){return!0===e.ok?n.concat(e.result):n}),[])},map$1=function(n,e){return!0===e.ok?ok$1(n(e.result)):e},map2$1=function(n,e,t){return!1===e.ok?e:!1===t.ok?t:ok$1(n(e.result,t.result))},mapError$1=function(n,e){return!0===e.ok?e:err$1(n(e.error))},andThen$1=function(n,e){return!0===e.ok?n(e.result):e},result$1=Object.freeze({ok:ok$1,isOk:isOk$1,err:err$1,isErr:isErr$1,asPromise:asPromise$1,withDefault:withDefault$1,withException:withException$1,successes:successes$1,map:map$1,map2:map2$1,mapError:mapError$1,andThen:andThen$1}),__assign$3=function(){return(__assign$3=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __rest$1$1(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function isEqual$1(n,e){if(n===e)return!0;if(null===n&&null===e)return!0;if(typeof n!=typeof e)return!1;if("object"==typeof n){if(Array.isArray(n)){if(!Array.isArray(e))return!1;if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!isEqual$1(n[t],e[t]))return!1;return!0}var r=Object.keys(n);if(r.length!==Object.keys(e).length)return!1;for(t=0;t<r.length;t++){if(!e.hasOwnProperty(r[t]))return!1;if(!isEqual$1(n[r[t]],e[r[t]]))return!1}return!0}}var isJsonArray$1=function(n){return Array.isArray(n)},isJsonObject$1=function(n){return"object"==typeof n&&null!==n&&!isJsonArray$1(n)},typeString$1=function(n){switch(typeof n){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return n instanceof Array?"an array":null===n?"null":"an object";default:return JSON.stringify(n)}},expectedGot$1=function(n,e){return"expected "+n+", got "+typeString$1(e)},printPath$1=function(n){return n.map((function(n){return"string"==typeof n?"."+n:"["+n+"]"})).join("")},prependAt$1=function(n,e){var t=e.at,r=__rest$1$1(e,["at"]);return __assign$3({at:n+(t||"")},r)},Decoder$1=function(){function n(e){var t=this;this.decode=e,this.run=function(n){return mapError$1((function(e){return{kind:"DecoderError",input:n,at:"input"+(e.at||""),message:e.message||""}}),t.decode(n))},this.runPromise=function(n){return asPromise$1(t.run(n))},this.runWithException=function(n){return withException$1(t.run(n))},this.map=function(e){return new n((function(n){return map$1(e,t.decode(n))}))},this.andThen=function(e){return new n((function(n){return andThen$1((function(t){return e(t).decode(n)}),t.decode(n))}))},this.where=function(e,r){return t.andThen((function(t){return e(t)?n.succeed(t):n.fail(r)}))}}return n.string=function(){return new n((function(n){return"string"==typeof n?ok$1(n):err$1({message:expectedGot$1("a string",n)})}))},n.number=function(){return new n((function(n){return"number"==typeof n?ok$1(n):err$1({message:expectedGot$1("a number",n)})}))},n.boolean=function(){return new n((function(n){return"boolean"==typeof n?ok$1(n):err$1({message:expectedGot$1("a boolean",n)})}))},n.constant=function(e){return new n((function(n){return isEqual$1(n,e)?ok$1(e):err$1({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})}))},n.object=function(e){return new n((function(n){if(isJsonObject$1(n)&&e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r].decode(n[r]);if(!0!==i.ok)return void 0===n[r]?err$1({message:"the key '"+r+"' is required but was not present"}):err$1(prependAt$1("."+r,i.error));void 0!==i.result&&(t[r]=i.result)}return ok$1(t)}return isJsonObject$1(n)?ok$1(n):err$1({message:expectedGot$1("an object",n)})}))},n.array=function(e){return new n((function(n){if(isJsonArray$1(n)&&e){return n.reduce((function(n,t,r){return map2$1((function(n,e){return n.concat([e])}),n,function(n,t){return mapError$1((function(n){return prependAt$1("["+t+"]",n)}),e.decode(n))}(t,r))}),ok$1([]))}return isJsonArray$1(n)?ok$1(n):err$1({message:expectedGot$1("an array",n)})}))},n.tuple=function(e){return new n((function(n){if(isJsonArray$1(n)){if(n.length!==e.length)return err$1({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n[r]);if(!i.ok)return err$1(prependAt$1("["+r+"]",i.error));t[r]=i.result}return ok$1(t)}return err$1({message:expectedGot$1("a tuple of length "+e.length,n)})}))},n.union=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n.oneOf.apply(n,[e,t].concat(r))},n.intersection=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new n((function(n){return[e,t].concat(r).reduce((function(e,t){return map2$1(Object.assign,e,t.decode(n))}),ok$1({}))}))},n.anyJson=function(){return new n((function(n){return ok$1(n)}))},n.unknownJson=function(){return new n((function(n){return ok$1(n)}))},n.dict=function(e){return new n((function(n){if(isJsonObject$1(n)){var t={};for(var r in n)if(n.hasOwnProperty(r)){var i=e.decode(n[r]);if(!0!==i.ok)return err$1(prependAt$1("."+r,i.error));t[r]=i.result}return ok$1(t)}return err$1({message:expectedGot$1("an object",n)})}))},n.optional=function(e){return new n((function(n){return null==n?ok$1(void 0):e.decode(n)}))},n.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new n((function(n){for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n);if(!0===i.ok)return i;t[r]=i.error}var o=t.map((function(n){return"at error"+(n.at||"")+": "+n.message})).join('", "');return err$1({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},n.withDefault=function(e,t){return new n((function(n){return ok$1(withDefault$1(e,t.decode(n)))}))},n.valueAt=function(e,t){return new n((function(n){for(var r=n,i=0;i<e.length;i++){if(void 0===r)return err$1({at:printPath$1(e.slice(0,i+1)),message:"path does not exist"});if("string"==typeof e[i]&&!isJsonObject$1(r))return err$1({at:printPath$1(e.slice(0,i+1)),message:expectedGot$1("an object",r)});if("number"==typeof e[i]&&!isJsonArray$1(r))return err$1({at:printPath$1(e.slice(0,i+1)),message:expectedGot$1("an array",r)});r=r[e[i]]}return mapError$1((function(n){return void 0===r?{at:printPath$1(e),message:"path does not exist"}:prependAt$1(printPath$1(e),n)}),t.decode(r))}))},n.succeed=function(e){return new n((function(n){return ok$1(e)}))},n.fail=function(e){return new n((function(n){return err$1({message:e})}))},n.lazy=function(e){return new n((function(n){return e().decode(n)}))},n}(),string$1=Decoder$1.string,number$1=Decoder$1.number,boolean$1=Decoder$1.boolean,anyJson$1=Decoder$1.anyJson,constant$1=Decoder$1.constant,object$1=Decoder$1.object,array$1=Decoder$1.array,optional$1=Decoder$1.optional,oneOf$1=Decoder$1.oneOf,lazy$1=Decoder$1.lazy;const nonEmptyStringDecoder$1=string$1().where((n=>n.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder$1=number$1().where((n=>n>=0),"Expected a non-negative number"),libDomainDecoder$1=oneOf$1(constant$1("windows"),constant$1("appManager"),constant$1("layouts"),constant$1("intents")),windowOperationTypesDecoder$1=oneOf$1(constant$1("openWindow"),constant$1("windowHello"),constant$1("windowAdded"),constant$1("windowRemoved"),constant$1("getBounds"),constant$1("getUrl"),constant$1("moveResize"),constant$1("focus"),constant$1("close"),constant$1("getTitle"),constant$1("setTitle")),appManagerOperationTypesDecoder$1=oneOf$1(constant$1("appHello"),constant$1("applicationAdded"),constant$1("applicationRemoved"),constant$1("applicationChanged"),constant$1("instanceStarted"),constant$1("instanceStopped"),constant$1("applicationStart"),constant$1("instanceStop")),layoutsOperationTypesDecoder$1=oneOf$1(constant$1("layoutAdded"),constant$1("layoutChanged"),constant$1("layoutRemoved"),constant$1("get"),constant$1("getAll"),constant$1("export"),constant$1("import"),constant$1("remove")),windowRelativeDirectionDecoder$1=oneOf$1(constant$1("top"),constant$1("left"),constant$1("right"),constant$1("bottom")),windowOpenSettingsDecoder$1=optional$1(object$1({top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),context:optional$1(anyJson$1()),relativeTo:optional$1(nonEmptyStringDecoder$1),relativeDirection:optional$1(windowRelativeDirectionDecoder$1),windowId:optional$1(nonEmptyStringDecoder$1)})),openWindowConfigDecoder$1=object$1({name:nonEmptyStringDecoder$1,url:nonEmptyStringDecoder$1,options:windowOpenSettingsDecoder$1}),windowHelloDecoder$1=object$1({windowId:optional$1(nonEmptyStringDecoder$1)}),coreWindowDataDecoder$1=object$1({windowId:nonEmptyStringDecoder$1,name:nonEmptyStringDecoder$1}),simpleWindowDecoder$1=object$1({windowId:nonEmptyStringDecoder$1}),helloSuccessDecoder$1=object$1({windows:array$1(coreWindowDataDecoder$1),isWorkspaceFrame:boolean$1()}),windowTitleConfigDecoder$1=object$1({windowId:nonEmptyStringDecoder$1,title:string$1()}),windowMoveResizeConfigDecoder$1=object$1({windowId:nonEmptyStringDecoder$1,top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),relative:optional$1(boolean$1())}),windowBoundsResultDecoder$1=object$1({windowId:nonEmptyStringDecoder$1,bounds:object$1({top:number$1(),left:number$1(),width:nonNegativeNumberDecoder$1,height:nonNegativeNumberDecoder$1})}),windowUrlResultDecoder$1=object$1({windowId:nonEmptyStringDecoder$1,url:nonEmptyStringDecoder$1}),anyDecoder$1=anyJson$1(),boundsDecoder$1=object$1({top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1)}),instanceDataDecoder$1=object$1({id:nonEmptyStringDecoder$1,applicationName:nonEmptyStringDecoder$1}),applicationDetailsDecoder$1=object$1({url:nonEmptyStringDecoder$1,top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1)}),intentDefinitionDecoder$1=object$1({name:nonEmptyStringDecoder$1,displayName:optional$1(string$1()),contexts:optional$1(array$1(string$1())),customConfig:optional$1(object$1())}),applicationDefinitionDecoder$1=object$1({name:nonEmptyStringDecoder$1,title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),customProperties:optional$1(anyJson$1()),icon:optional$1(nonEmptyStringDecoder$1),caption:optional$1(nonEmptyStringDecoder$1),details:applicationDetailsDecoder$1,intents:optional$1(array$1(intentDefinitionDecoder$1))}),appDefinitionOperationDecoder$1=object$1({definitions:array$1(applicationDefinitionDecoder$1),mode:oneOf$1(constant$1("replace"),constant$1("merge"))}),appRemoveConfigDecoder$1=object$1({name:nonEmptyStringDecoder$1}),appsExportOperationDecoder$1=object$1({definitions:array$1(applicationDefinitionDecoder$1)}),applicationDataDecoder$1=object$1({name:nonEmptyStringDecoder$1,instances:array$1(instanceDataDecoder$1),userProperties:optional$1(anyJson$1()),title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),icon:optional$1(nonEmptyStringDecoder$1),caption:optional$1(nonEmptyStringDecoder$1)}),baseApplicationDataDecoder$1=object$1({name:nonEmptyStringDecoder$1,userProperties:anyJson$1(),title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),icon:optional$1(nonEmptyStringDecoder$1),caption:optional$1(nonEmptyStringDecoder$1)}),appHelloSuccessDecoder$1=object$1({apps:array$1(applicationDataDecoder$1)}),basicInstanceDataDecoder$1=object$1({id:nonEmptyStringDecoder$1}),applicationStartConfigDecoder$1=object$1({name:nonEmptyStringDecoder$1,waitForAGMReady:boolean$1(),context:optional$1(anyJson$1()),top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),relativeTo:optional$1(nonEmptyStringDecoder$1),relativeDirection:optional$1(oneOf$1(constant$1("top"),constant$1("left"),constant$1("right"),constant$1("bottom")))}),layoutTypeDecoder$1=oneOf$1(constant$1("Global"),constant$1("Activity"),constant$1("ApplicationDefault"),constant$1("Swimlane"),constant$1("Workspace")),componentTypeDecoder$1=oneOf$1(constant$1("application"),constant$1("activity")),windowLayoutComponentDecoder$1=object$1({type:constant$1("window"),componentType:componentTypeDecoder$1,state:object$1({name:anyJson$1(),context:anyJson$1(),url:nonEmptyStringDecoder$1,bounds:anyJson$1(),id:nonEmptyStringDecoder$1,parentId:optional$1(nonEmptyStringDecoder$1),main:boolean$1()})}),windowLayoutItemDecoder$1=object$1({type:constant$1("window"),config:object$1({appName:nonEmptyStringDecoder$1,url:optional$1(nonEmptyStringDecoder$1)})}),groupLayoutItemDecoder$1=object$1({type:constant$1("group"),config:anyJson$1(),children:array$1(oneOf$1(windowLayoutItemDecoder$1))}),columnLayoutItemDecoder$1=object$1({type:constant$1("column"),config:anyJson$1(),children:array$1(oneOf$1(groupLayoutItemDecoder$1,windowLayoutItemDecoder$1,lazy$1((()=>columnLayoutItemDecoder$1)),lazy$1((()=>rowLayoutItemDecoder$1))))}),rowLayoutItemDecoder$1=object$1({type:constant$1("row"),config:anyJson$1(),children:array$1(oneOf$1(columnLayoutItemDecoder$1,groupLayoutItemDecoder$1,windowLayoutItemDecoder$1,lazy$1((()=>rowLayoutItemDecoder$1))))}),workspaceLayoutComponentDecoder$1=object$1({type:constant$1("Workspace"),state:object$1({config:anyJson$1(),context:anyJson$1(),children:array$1(oneOf$1(rowLayoutItemDecoder$1,columnLayoutItemDecoder$1,groupLayoutItemDecoder$1,windowLayoutItemDecoder$1))})}),glueLayoutDecoder$1=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder$1,components:array$1(oneOf$1(windowLayoutComponentDecoder$1,workspaceLayoutComponentDecoder$1)),context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1())}),newLayoutOptionsDecoder$1=object$1({name:nonEmptyStringDecoder$1,context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1())}),restoreOptionsDecoder$1=object$1({name:nonEmptyStringDecoder$1,context:optional$1(anyJson$1()),closeRunningInstance:optional$1(boolean$1())}),layoutSummaryDecoder$1=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder$1,context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1())}),simpleLayoutConfigDecoder$1=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder$1}),getAllLayoutsConfigDecoder$1=object$1({type:layoutTypeDecoder$1}),allLayoutsFullConfigDecoder$1=object$1({layouts:array$1(glueLayoutDecoder$1)}),importModeDecoder$1=oneOf$1(constant$1("replace"),constant$1("merge")),layoutsImportConfigDecoder$1=object$1({layouts:array$1(glueLayoutDecoder$1),mode:importModeDecoder$1}),allLayoutsSummariesResultDecoder$1=object$1({summaries:array$1(layoutSummaryDecoder$1)}),simpleLayoutResult$1=object$1({layout:glueLayoutDecoder$1}),optionalSimpleLayoutResult$1=object$1({layout:optional$1(glueLayoutDecoder$1)}),intentsOperationTypesDecoder$1=oneOf$1(constant$1("findIntent"),constant$1("getIntents"),constant$1("raiseIntent")),intentHandlerDecoder$1=object$1({applicationName:nonEmptyStringDecoder$1,applicationTitle:string$1(),applicationDescription:optional$1(string$1()),applicationIcon:optional$1(string$1()),type:oneOf$1(constant$1("app"),constant$1("instance")),displayName:optional$1(string$1()),contextTypes:optional$1(array$1(nonEmptyStringDecoder$1)),instanceId:optional$1(string$1()),instanceTitle:optional$1(string$1())}),intentDecoder$1=object$1({name:nonEmptyStringDecoder$1,handlers:array$1(intentHandlerDecoder$1)}),intentTargetDecoder$1=oneOf$1(constant$1("startNew"),constant$1("reuse"),object$1({app:optional$1(nonEmptyStringDecoder$1),instance:optional$1(nonEmptyStringDecoder$1)})),intentContextDecoder$1=object$1({type:optional$1(nonEmptyStringDecoder$1),data:optional$1(object$1())}),intentsDecoder$1=array$1(intentDecoder$1),wrappedIntentsDecoder$1=object$1({intents:intentsDecoder$1}),intentFilterDecoder$1=object$1({name:optional$1(nonEmptyStringDecoder$1),contextType:optional$1(nonEmptyStringDecoder$1)}),findFilterDecoder$1=oneOf$1(nonEmptyStringDecoder$1,intentFilterDecoder$1),wrappedIntentFilterDecoder$1=object$1({filter:optional$1(intentFilterDecoder$1)}),intentRequestDecoder$1=object$1({intent:nonEmptyStringDecoder$1,target:optional$1(intentTargetDecoder$1),context:optional$1(intentContextDecoder$1),options:optional$1(windowOpenSettingsDecoder$1)}),raiseRequestDecoder$1=oneOf$1(nonEmptyStringDecoder$1,intentRequestDecoder$1),intentResultDecoder$1=object$1({request:intentRequestDecoder$1,handler:intentHandlerDecoder$1,result:anyJson$1()}),addIntentListenerRequestDecoder$1=object$1({intent:nonEmptyStringDecoder$1,contextTypes:optional$1(array$1(nonEmptyStringDecoder$1)),displayName:optional$1(string$1()),icon:optional$1(string$1()),description:optional$1(string$1())}),addIntentListenerIntentDecoder$1=oneOf$1(nonEmptyStringDecoder$1,addIntentListenerRequestDecoder$1),channelNameDecoder$1=n=>nonEmptyStringDecoder$1.where((e=>n.includes(e)),"Expected a valid channel name"),operations$4={openWindow:{name:"openWindow",dataDecoder:openWindowConfigDecoder$1,resultDecoder:coreWindowDataDecoder$1},windowHello:{name:"windowHello",dataDecoder:windowHelloDecoder$1,resultDecoder:helloSuccessDecoder$1},windowAdded:{name:"windowAdded",dataDecoder:coreWindowDataDecoder$1},windowRemoved:{name:"windowRemoved",dataDecoder:simpleWindowDecoder$1},getBounds:{name:"getBounds",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowBoundsResultDecoder$1},getUrl:{name:"getUrl",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowUrlResultDecoder$1},moveResize:{name:"moveResize",dataDecoder:windowMoveResizeConfigDecoder$1},focus:{name:"focus",dataDecoder:simpleWindowDecoder$1},close:{name:"close",dataDecoder:simpleWindowDecoder$1},getTitle:{name:"getTitle",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowTitleConfigDecoder$1},setTitle:{name:"setTitle",dataDecoder:windowTitleConfigDecoder$1}};function createRegistry$3(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[]),t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$3.default=createRegistry$3;var lib$5=createRegistry$3;class WebWindowModel$1{constructor(n,e,t){this._id=n,this._name=e,this._bridge=t,this.registry=lib$5(),this.myCtxKey="___window___"+this.id}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}toApi(){return __awaiter$1$3(this,void 0,void 0,(function*(){this.ctxUnsubscribe=yield this._bridge.contextLib.subscribe(this.myCtxKey,(n=>this.registry.execute("context-updated",n)));const n={id:this.id,name:this.name,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this)};return this.me=Object.freeze(n),this.me}))}getURL(){return __awaiter$1$3(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$4.getUrl,{windowId:this.id})).url}))}moveResize(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=boundsDecoder$1.runWithException(n),t=Object.assign({},e,{windowId:this.id,relative:!1});return yield this._bridge.send("windows",operations$4.moveResize,t),this.me}))}resizeTo(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){if(void 0===n&&void 0===e)return this.me;void 0!==n&&nonNegativeNumberDecoder$1.runWithException(n),void 0!==e&&nonNegativeNumberDecoder$1.runWithException(e);const t=Object.assign({},{width:n,height:e},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations$4.moveResize,t),this.me}))}moveTo(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){if(void 0===n&&void 0===e)return this.me;void 0!==n&&number$1().runWithException(n),void 0!==e&&number$1().runWithException(e);const t=Object.assign({},{top:n,left:e},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations$4.moveResize,t),this.me}))}focus(){return __awaiter$1$3(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",operations$4.focus,{windowId:this.id}),this.me}))}close(){return __awaiter$1$3(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",operations$4.close,{windowId:this.id}),this.me}))}getTitle(){return __awaiter$1$3(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$4.getTitle,{windowId:this.id})).title}))}setTitle(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=nonEmptyStringDecoder$1.runWithException(n);return yield this._bridge.send("windows",operations$4.setTitle,{windowId:this.id,title:e}),this.me}))}getBounds(){return __awaiter$1$3(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$4.getBounds,{windowId:this.id})).bounds}))}getContext(){return __awaiter$1$3(this,void 0,void 0,(function*(){return yield this._bridge.contextLib.get(this.myCtxKey)}))}updateContext(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=anyDecoder$1.runWithException(n);return yield this._bridge.contextLib.update(this.myCtxKey,e),this.me}))}setContext(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=anyDecoder$1.runWithException(n);return yield this._bridge.contextLib.set(this.myCtxKey,e),this.me}))}onContextUpdated(n){if("function"!=typeof n)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("context-updated",(e=>{n(e,this.me)}))}}class WindowsController$1{constructor(){this.registry=lib$5(),this.allWindowProjections=[]}start(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=n.connection.transport.publicWindowId,this.actualWindowId=n.interop.instance.windowId,this.addWindowOperationExecutors(),this.ioc=e,this.bridge=e.bridge,this.logger.trace(`set the public window id: ${this.publicWindowId} and actual window id: ${this.actualWindowId}, set the bridge operations and ioc, registering with the platform now`),this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const t=this.toApi();n.windows=t}))}handleBridgeMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){yield this.platformRegistration;const e=windowOperationTypesDecoder$1.runWithException(n.operation),t=operations$4[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}open(n,e,t){return __awaiter$1$3(this,void 0,void 0,(function*(){nonEmptyStringDecoder$1.runWithException(n),nonEmptyStringDecoder$1.runWithException(e);const r=windowOpenSettingsDecoder$1.runWithException(t),i=yield this.bridge.send("windows",operations$4.openWindow,{name:n,url:e,options:r});return(yield this.ioc.buildWebWindow(i.windowId,i.name)).api}))}list(){return this.allWindowProjections.map((n=>n.api))}findById(n){var e;return nonEmptyStringDecoder$1.runWithException(n),null===(e=this.allWindowProjections.find((e=>e.id===n)))||void 0===e?void 0:e.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this)}}addWindowOperationExecutors(){operations$4.windowAdded.execute=this.handleWindowAdded.bind(this),operations$4.windowRemoved.execute=this.handleWindowRemoved.bind(this),operations$4.getBounds.execute=this.handleGetBounds.bind(this),operations$4.getTitle.execute=this.handleGetTitle.bind(this),operations$4.getUrl.execute=this.handleGetUrl.bind(this),operations$4.moveResize.execute=this.handleMoveResize.bind(this),operations$4.setTitle.execute=this.handleSetTitle.bind(this)}my(){return Object.assign({},this.me)}onWindowAdded(n){if("function"!=typeof n)throw new Error("Cannot subscribe to window added, because the provided callback is not a function!");return this.registry.add("window-added",n)}onWindowRemoved(n){if("function"!=typeof n)throw new Error("Cannot subscribe to window removed, because the provided callback is not a function!");return this.registry.add("window-removed",n)}sayHello(){return __awaiter$1$3(this,void 0,void 0,(function*(){return yield this.bridge.send("windows",operations$4.windowHello,{windowId:this.actualWindowId})}))}registerWithPlatform(){return __awaiter$1$3(this,void 0,void 0,(function*(){const{windows:n,isWorkspaceFrame:e}=yield this.sayHello();if(this.logger.trace("the platform responded to the hello message"),!e){this.logger.trace("i am not treated as a workspace frame, setting my window");const e=n.find((n=>n.windowId===this.publicWindowId));if(!e)throw new Error("Cannot initialize the window library, because I received no information about me from the platform");this.me=(yield this.ioc.buildWebWindow(this.publicWindowId,e.name)).api}const t=yield Promise.all(n.map((n=>this.ioc.buildWebWindow(n.windowId,n.name))));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...t)}))}handleWindowAdded(n){return __awaiter$1$3(this,void 0,void 0,(function*(){if(this.allWindowProjections.some((e=>e.id===n.windowId)))return;const e=yield this.ioc.buildWebWindow(n.windowId,n.name);this.allWindowProjections.push(e),this.registry.execute("window-added",e.api)}))}handleWindowRemoved(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=this.allWindowProjections.find((e=>e.id===n.windowId));e&&(this.allWindowProjections=this.allWindowProjections.filter((e=>e.id!==n.windowId)),e.model.clean(),this.registry.execute("window-removed",e.api))}))}handleGetBounds(){return __awaiter$1$3(this,void 0,void 0,(function*(){return{windowId:this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}))}handleGetTitle(){return __awaiter$1$3(this,void 0,void 0,(function*(){return{windowId:this.me.id,title:document.title}}))}handleGetUrl(){return __awaiter$1$3(this,void 0,void 0,(function*(){return{windowId:this.me.id,url:window.location.href}}))}handleMoveResize(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e="number"==typeof n.top?n.top:n.relative?0:window.screenTop,t="number"==typeof n.left?n.left:n.relative?0:window.screenLeft,r="number"==typeof n.height?n.height:n.relative?0:window.innerHeight,i="number"==typeof n.width?n.width:n.relative?0:window.innerWidth,o=n.relative?window.moveBy:window.moveTo,l=n.relative?window.resizeBy:window.resizeTo;o(t,e),l(i,r)}))}handleSetTitle(n){return __awaiter$1$3(this,void 0,void 0,(function*(){document.title=n.title}))}}const PromiseWrap$1=(n,e,t)=>new Promise(((r,i)=>{let o=!0;const l=setTimeout((()=>{if(!o)return;o=!1;i(t||"Promise timeout hit: "+e)}),e);n().then((n=>{o&&(o=!1,clearTimeout(l),r(n))})).catch((n=>{o&&(o=!1,clearTimeout(l),i(n))}))})),PromisePlus$2=(n,e,t)=>new Promise(((r,i)=>{const o=setTimeout((()=>{i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((n=>{clearTimeout(o),r(n)})).catch((n=>{clearTimeout(o),i(n)}))})),GlueWebPlatformControlName$1="T42.Web.Platform.Control",GlueWebPlatformStreamName$1="T42.Web.Platform.Stream",GlueClientControlName$1="T42.Web.Client.Control";class GlueBridge$1{constructor(n){this.coreGlue=n,this.platformMethodTimeoutMs=1e4}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}start(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.controllers=n,yield Promise.all([this.checkWaitMethod(GlueWebPlatformControlName$1),this.checkWaitMethod(GlueWebPlatformStreamName$1)]);const[e]=yield Promise.all([this.coreGlue.interop.subscribe(GlueWebPlatformStreamName$1),this.coreGlue.interop.registerAsync(GlueClientControlName$1,((n,e,t,r)=>this.passMessageController(n,t,r)))]);this.sub=e,this.sub.onData((n=>this.passMessageController(n.data)))}))}getInteropInstance(n){const e=this.coreGlue.interop.servers().find((e=>e.windowId&&e.windowId===n));return{application:null==e?void 0:e.application,applicationName:null==e?void 0:e.applicationName,peerId:null==e?void 0:e.peerId,instance:null==e?void 0:e.instance,windowId:null==e?void 0:e.windowId}}send(n,e,t){return __awaiter$1$3(this,void 0,void 0,(function*(){if(e.dataDecoder)try{e.dataDecoder.runWithException(t)}catch(n){throw new Error(`Unexpected internal outgoing validation error: ${n.message}, for operation: ${e.name} and input: ${JSON.stringify(n.input)}`)}let r;try{r=yield this.transmitMessage(n,e,t),e.resultDecoder&&(r=e.resultDecoder.runWithException(r))}catch(n){if(n.kind)throw new Error(`Unexpected internal incoming validation error: ${n.message}, for operation: ${e.name} and input: ${JSON.stringify(n.input)}`);throw new Error(n.message)}return r}))}checkWaitMethod(n){return PromisePlus$2((e=>{if(this.coreGlue.interop.methods().some((e=>e.name===n)))return e();const t=this.coreGlue.interop.methodAdded((r=>{r.name===n&&(t(),e())}))}),this.platformMethodTimeoutMs,"Cannot initiate Glue Web, because a system method's discovery timed out: "+n)}passMessageController(n,e,t){const r=libDomainDecoder$1.run(n.domain);if(!r.ok)return void(t&&t("Cannot execute this client control, because of domain validation error: "+JSON.stringify(r.error)));const i=r.result;this.controllers[i].handleBridgeMessage(n).then((n=>{e&&e(n)})).catch((n=>{t&&t(n),console.warn(n)}))}transmitMessage(n,e,t){return __awaiter$1$3(this,void 0,void 0,(function*(){const r={domain:n,data:t,operation:e.name};let i;const o=`Internal Platform Communication Error. Attempted operation: ${JSON.stringify(e.name)} with data: ${JSON.stringify(t)}. `;try{if(i=yield this.coreGlue.interop.invoke(GlueWebPlatformControlName$1,r),!i)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(i.all_return_values)||0===i.all_return_values.length)throw new Error("Received unsupported result from the platform - empty values collection")}catch(n){if(n&&n.all_errors&&n.all_errors.length){const e=n.all_errors[0].message;throw new Error(`${o} -> Inner message: ${e}`)}throw new Error(`${o} -> Inner message: ${n.message}`)}return i.all_return_values[0].returned}))}}const operations$1$1={appHello:{name:"appHello",dataDecoder:windowHelloDecoder$1,resultDecoder:appHelloSuccessDecoder$1},applicationAdded:{name:"applicationAdded",dataDecoder:baseApplicationDataDecoder$1},applicationRemoved:{name:"applicationRemoved",dataDecoder:baseApplicationDataDecoder$1},applicationChanged:{name:"applicationChanged",dataDecoder:baseApplicationDataDecoder$1},instanceStarted:{name:"instanceStarted",dataDecoder:instanceDataDecoder$1},instanceStopped:{name:"instanceStopped",dataDecoder:instanceDataDecoder$1},applicationStart:{name:"applicationStart",dataDecoder:applicationStartConfigDecoder$1,resultDecoder:instanceDataDecoder$1},instanceStop:{name:"instanceStop",dataDecoder:basicInstanceDataDecoder$1},import:{name:"import"},remove:{name:"remove",dataDecoder:appRemoveConfigDecoder$1},export:{name:"export",resultDecoder:appsExportOperationDecoder$1}};class AppManagerController$1{constructor(){this.registry=lib$5(),this.applications=[],this.instances=[]}start(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=n.connection.transport.publicWindowId,this.actualWindowId=n.interop.instance.windowId,this.addOperationsExecutors(),this.ioc=e,this.bridge=e.bridge,this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const t=this.toApi();n.appManager=t}))}handleBridgeMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){yield this.platformRegistration;const e=appManagerOperationTypesDecoder$1.runWithException(n.operation),t=operations$1$1[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}onInstanceStarted(n){return this.registry.add("instance-started",n,this.instances)}onInstanceStopped(n){return this.registry.add("instance-stopped",n)}startApplication(n,e,t){var r;return __awaiter$1$3(this,void 0,void 0,(function*(){const i={name:n,waitForAGMReady:null===(r=null==t?void 0:t.waitForAGMReady)||void 0===r||r,context:e,top:null==t?void 0:t.top,left:null==t?void 0:t.left,width:null==t?void 0:t.width,height:null==t?void 0:t.height,relativeTo:null==t?void 0:t.relativeTo,relativeDirection:null==t?void 0:t.relativeDirection},o=yield this.bridge.send("appManager",operations$1$1.applicationStart,i),l=this.applications.find((n=>n.name===o.applicationName));return this.ioc.buildInstance(o,l)}))}toApi(){const n={myInstance:this.me,import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return Object.freeze(n)}addOperationsExecutors(){operations$1$1.applicationAdded.execute=this.handleApplicationAddedMessage.bind(this),operations$1$1.applicationRemoved.execute=this.handleApplicationRemovedMessage.bind(this),operations$1$1.applicationChanged.execute=this.handleApplicationChangedMessage.bind(this),operations$1$1.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),operations$1$1.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}onAppAdded(n){return this.registry.add("application-added",n,this.applications)}onAppRemoved(n){return this.registry.add("application-removed",n)}onAppChanged(n){return this.registry.add("application-changed",n)}handleApplicationAddedMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){if(this.applications.some((e=>e.name===n.name)))return;const e=yield this.ioc.buildApplication(n,[]),t=this.instances.filter((n=>n.application.name===e.name));e.instances.push(...t),this.applications.push(e),this.registry.execute("application-added",e)}))}handleApplicationRemovedMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=this.applications.findIndex((e=>e.name===n.name));if(e<0)return;const t=this.applications[e];this.applications.splice(e,1),this.registry.execute("application-removed",t)}))}handleApplicationChangedMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=this.applications.find((e=>e.name===n.name));if(!e)return this.handleApplicationAddedMessage(n);e.title=n.title,e.version=n.version,e.icon=n.icon,e.caption=n.caption,e.userProperties=n.userProperties,this.registry.execute("application-changed",e)}))}handleInstanceStartedMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){if(this.instances.some((e=>e.id===n.id)))return;const e=this.applications.find((e=>e.name===n.applicationName));if(!e)throw new Error(`Cannot add instance: ${n.id}, because there is no application definition associated with it`);const t=this.ioc.buildInstance(n,e);this.instances.push(t),e.instances.push(t),this.registry.execute("instance-started",t)}))}handleInstanceStoppedMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=this.instances.find((e=>e.id===n.id));if(e){const e=this.instances.findIndex((e=>e.id===n.id));this.instances.splice(e,1)}const t=this.applications.find((e=>e.instances.some((e=>e.id===n.id))));if(t){const e=t.instances.findIndex((e=>e.id===n.id));t.instances.splice(e,1)}e&&this.registry.execute("instance-stopped",e)}))}import(n,e="replace"){return __awaiter$1$3(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$1$1.import,{definitions:n,mode:e})}))}remove(n){return __awaiter$1$3(this,void 0,void 0,(function*(){nonEmptyStringDecoder$1.runWithException(n),yield this.bridge.send("appManager",operations$1$1.remove,{name:n})}))}export(){return __awaiter$1$3(this,void 0,void 0,(function*(){return(yield this.bridge.send("appManager",operations$1$1.export,void 0)).definitions}))}getApplication(n){const e=nonEmptyStringDecoder$1.runWithException(n);return this.applications.find((n=>n.name===e))}getApplications(){return this.applications.slice()}getInstances(){return this.instances.slice()}registerWithPlatform(){return __awaiter$1$3(this,void 0,void 0,(function*(){const n=yield this.bridge.send("appManager",operations$1$1.appHello,{windowId:this.actualWindowId});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=yield Promise.all(n.apps.map((n=>this.ioc.buildApplication(n,n.instances)))),this.instances=this.applications.reduce(((n,e)=>(n.push(...e.instances),n)),[]),this.me=this.findMyInstance(),this.logger.trace(`all applications were parsed and saved. I am ${this.me?"NOT a":"a"} valid instance`)}))}findMyInstance(){for(const n of this.applications){const e=n.instances.find((n=>n.id===this.publicWindowId));if(e)return e}}}class InstanceModel$1{constructor(n,e,t){this.data=n,this.bridge=e,this.application=t,this.myCtxKey="___instance___"+this.data.id}toApi(){const n=this.bridge.getInteropInstance(this.data.id),e={id:this.data.id,agm:n,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(e),this.me}getContext(){return __awaiter$1$3(this,void 0,void 0,(function*(){return this.bridge.contextLib.get(this.myCtxKey)}))}stop(){return __awaiter$1$3(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$1$1.instanceStop,{id:this.data.id})}))}}class ApplicationModel$1{constructor(n,e,t){this.data=n,this.instances=e,this.controller=t}toApi(){const n={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=n,this.me}onInstanceStarted(n){if("function"!=typeof n)throw new Error("OnInstanceStarted requires a single argument of type function");this.controller.onInstanceStarted((e=>{e.application.name===this.data.name&&n(e)}))}onInstanceStopped(n){if("function"!=typeof n)throw new Error("OnInstanceStarted requires a single argument of type function");this.controller.onInstanceStopped((e=>{e.application.name===this.data.name&&n(e)}))}start(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){return this.controller.startApplication(this.data.name,n,e)}))}}const operations$2$1={layoutAdded:{name:"layoutAdded",dataDecoder:glueLayoutDecoder$1},layoutChanged:{name:"layoutChanged",dataDecoder:glueLayoutDecoder$1},layoutRemoved:{name:"layoutRemoved",dataDecoder:glueLayoutDecoder$1},get:{name:"get",dataDecoder:simpleLayoutConfigDecoder$1,resultDecoder:optionalSimpleLayoutResult$1},getAll:{name:"getAll",dataDecoder:getAllLayoutsConfigDecoder$1,resultDecoder:allLayoutsSummariesResultDecoder$1},export:{name:"export",dataDecoder:getAllLayoutsConfigDecoder$1,resultDecoder:allLayoutsFullConfigDecoder$1},import:{name:"import",dataDecoder:layoutsImportConfigDecoder$1},remove:{name:"remove",dataDecoder:simpleLayoutConfigDecoder$1}};class LayoutsController$1{constructor(){this.registry=lib$5()}start(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=e.bridge,this.addOperationsExecutors();const t=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),n.layouts=t}))}handleBridgeMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=layoutsOperationTypesDecoder$1.runWithException(n.operation),t=operations$2$1[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}toApi(){const n={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this)};return Object.freeze(n)}addOperationsExecutors(){operations$2$1.layoutAdded.execute=this.handleOnAdded.bind(this),operations$2$1.layoutChanged.execute=this.handleOnChanged.bind(this),operations$2$1.layoutRemoved.execute=this.handleOnRemoved.bind(this)}get(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){nonEmptyStringDecoder$1.runWithException(n),layoutTypeDecoder$1.runWithException(e);return(yield this.bridge.send("layouts",operations$2$1.get,{name:n,type:e})).layout}))}getAll(n){return __awaiter$1$3(this,void 0,void 0,(function*(){layoutTypeDecoder$1.runWithException(n);return(yield this.bridge.send("layouts",operations$2$1.getAll,{type:n})).summaries}))}export(n){return __awaiter$1$3(this,void 0,void 0,(function*(){n&&layoutTypeDecoder$1.runWithException(n);return(yield this.bridge.send("layouts",operations$2$1.export,{type:"Workspace"})).layouts}))}import(n,e="replace"){return __awaiter$1$3(this,void 0,void 0,(function*(){n.forEach((n=>glueLayoutDecoder$1.runWithException(n))),importModeDecoder$1.runWithException(e),yield this.bridge.send("layouts",operations$2$1.import,{layouts:n,mode:e})}))}save(n){return __awaiter$1$3(this,void 0,void 0,(function*(){throw newLayoutOptionsDecoder$1.runWithException(n),new Error("Save is not supported in Core at the moment")}))}restore(n){return __awaiter$1$3(this,void 0,void 0,(function*(){throw restoreOptionsDecoder$1.runWithException(n),new Error("Restore is not supported in Core at the moment")}))}remove(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){layoutTypeDecoder$1.runWithException(n),nonEmptyStringDecoder$1.runWithException(e),yield this.bridge.send("layouts",operations$2$1.remove,{type:n,name:e})}))}onAdded(n){return this.registry.add(operations$2$1.layoutAdded.name,n)}onChanged(n){return this.registry.add(operations$2$1.layoutChanged.name,n)}onRemoved(n){return this.registry.add(operations$2$1.layoutRemoved.name,n)}handleOnAdded(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.registry.execute(operations$2$1.layoutAdded.name,n)}))}handleOnChanged(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.registry.execute(operations$2$1.layoutChanged.name,n)}))}handleOnRemoved(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.registry.execute(operations$2$1.layoutRemoved.name,n)}))}}class NotificationsController$1{start(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.interop=n.interop;const e=this.toApi();n.notifications=e,this.logger.trace("notifications are ready")}))}handleBridgeMessage(){return __awaiter$1$3(this,void 0,void 0,(function*(){}))}toApi(){const n={raise:this.raise.bind(this)};return Object.freeze(n)}raise(n){return __awaiter$1$3(this,void 0,void 0,(function*(){if(!("Notification"in window))throw new Error("this browser does not support desktop notification");let e;e="granted"===Notification.permission?Promise.resolve("granted"):"denied"===Notification.permission?Promise.reject("no permissions from user"):Notification.requestPermission(),yield e;const t=this.raiseUsingWebApi(n);if(n.clickInterop){const e=n.clickInterop;t.onclick=()=>{var n,t;this.interop.invoke(e.method,null!==(n=null==e?void 0:e.arguments)&&void 0!==n?n:{},null!==(t=null==e?void 0:e.target)&&void 0!==t?t:"best")}}return t}))}raiseUsingWebApi(n){return new Notification(n.title)}}const operations$3$1={getIntents:{name:"getIntents",resultDecoder:wrappedIntentsDecoder$1},findIntent:{name:"findIntent",dataDecoder:wrappedIntentFilterDecoder$1,resultDecoder:wrappedIntentsDecoder$1},raiseIntent:{name:"raiseIntent",dataDecoder:intentRequestDecoder$1,resultDecoder:intentResultDecoder$1}};class IntentsController$1{constructor(){this.myIntents=new Set,this.GlueWebIntentsPrefix="Tick42.FDC3.Intents."}start(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=e.bridge,this.interop=n.interop;const t=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),n.intents=t}))}handleBridgeMessage(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=intentsOperationTypesDecoder$1.runWithException(n.operation),t=operations$3$1[e];if(!t.execute)return;let r=n.data;return t.dataDecoder&&(r=t.dataDecoder.runWithException(n.data)),yield t.execute(r)}))}toApi(){const n={raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),find:this.find.bind(this)};return Object.freeze(n)}raise(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=raiseRequestDecoder$1.runWithException(n);let t;t="string"==typeof e?{intent:e}:e;return yield this.bridge.send("intents",operations$3$1.raiseIntent,t)}))}all(){return __awaiter$1$3(this,void 0,void 0,(function*(){return(yield this.bridge.send("intents",operations$3$1.getIntents,void 0)).intents}))}addIntentListener(n,e){if(addIntentListenerIntentDecoder$1.runWithException(n),"function"!=typeof e)throw new Error("Cannot add intent listener, because the provided handler is not a function!");let t=!0;const r="string"==typeof n?n:n.intent,i=`${this.GlueWebIntentsPrefix}${r}`;if(this.myIntents.has(r))throw new Error(`Intent listener for intent ${r} already registered!`);this.myIntents.add(r);const o={unsubscribe:()=>{t=!1;try{this.interop.unregister(i),this.myIntents.delete(r)}catch(n){this.logger.trace(`Unsubscribed intent listener, but ${i} unregistration failed!`)}}},l="string"==typeof n?void 0:JSON.stringify(n);return this.interop.register({name:i,description:l},(n=>{if(t)return e(n)})),o}find(n){return __awaiter$1$3(this,void 0,void 0,(function*(){let e=void 0;if(void 0!==n){const t=findFilterDecoder$1.runWithException(n);"string"==typeof t?e={filter:{name:t}}:"object"==typeof t&&(e={filter:t})}return(yield this.bridge.send("intents",operations$3$1.findIntent,e)).intents}))}}class ChannelsController$1{constructor(){this.registry=lib$5(),this.GlueWebChannelsPrefix="___channel___",this.SubsKey="subs",this.ChangedKey="changed"}start(n){return __awaiter$1$3(this,void 0,void 0,(function*(){this.logger=n.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=n.contexts,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning");const e=this.toApi();n.channels=e}))}handleBridgeMessage(){return __awaiter$1$3(this,void 0,void 0,(function*(){}))}toApi(){const n={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this)};return Object.freeze(n)}createContextName(n){return`${this.GlueWebChannelsPrefix}${n}`}getAllChannelNames(){return this.contexts.all().filter((n=>n.startsWith(this.GlueWebChannelsPrefix))).map((n=>n.replace(this.GlueWebChannelsPrefix,"")))}unsubscribe(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}switchToChannel(n){return __awaiter$1$3(this,void 0,void 0,(function*(){if(this.unsubscribe(),this.currentChannelName=n,void 0!==n){const e=this.createContextName(n);this.unsubscribeFunc=yield this.contexts.subscribe(e,((n,e,t,r,i)=>{this.registry.execute(this.SubsKey,n.data,n,null==i?void 0:i.updaterId)}))}this.registry.execute(this.ChangedKey,n)}))}updateData(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){const t=this.createContextName(n);if(this.contexts.setPathSupported){const n=Object.keys(e).map((n=>({path:"data."+n,value:e[n]})));yield this.contexts.setPaths(t,n)}else yield this.contexts.update(t,{data:e})}))}subscribe(n){if("function"!=typeof n)throw new Error("Cannot subscribe to channels, because the provided callback is not a function!");return this.registry.add(this.SubsKey,n)}subscribeFor(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();if(channelNameDecoder$1(t).runWithException(n),"function"!=typeof e)throw new Error(`Cannot subscribe to channel ${n}, because the provided callback is not a function!`);const r=this.createContextName(n);return this.contexts.subscribe(r,((n,t,r,i,o)=>{e(n.data,n,null==o?void 0:o.updaterId)}))}))}publish(n,e){if("object"!=typeof n)throw new Error("Cannot publish to channel, because the provided data is not an object!");if(void 0!==e){const t=this.getAllChannelNames();return channelNameDecoder$1(t).runWithException(e),this.updateData(e,n)}if(void 0===this.currentChannelName)throw new Error("Cannot publish to channel, because not joined to a channel!");return this.updateData(this.currentChannelName,n)}all(){return __awaiter$1$3(this,void 0,void 0,(function*(){return this.getAllChannelNames()}))}list(){return __awaiter$1$3(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();return yield Promise.all(n.map((n=>this.get(n))))}))}get(n){const e=this.getAllChannelNames();channelNameDecoder$1(e).runWithException(n);const t=this.createContextName(n);return this.contexts.get(t)}join(n){return __awaiter$1$3(this,void 0,void 0,(function*(){const e=this.getAllChannelNames();channelNameDecoder$1(e).runWithException(n),yield this.switchToChannel(n)}))}leave(){return __awaiter$1$3(this,void 0,void 0,(function*(){yield this.switchToChannel()}))}current(){return this.currentChannelName}my(){return this.current()}changed(n){if("function"!=typeof n)throw new Error("Cannot subscribe to channel changed, because the provided callback is not a function!");return this.registry.add(this.ChangedKey,n)}onChanged(n){return this.changed(n)}add(n){throw new Error("Method `add()` isn't implemented.")}}class IoC$1{constructor(n){this.coreGlue=n,this.controllers={windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController}}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new WindowsController$1),this._windowsControllerInstance}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new AppManagerController$1),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new LayoutsController$1),this._layoutsControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new NotificationsController$1),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new IntentsController$1),this._intentsControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new ChannelsController$1),this._channelsControllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new GlueBridge$1(this.coreGlue)),this._bridgeInstance}buildWebWindow(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){const t=new WebWindowModel$1(n,e,this.bridge),r=yield t.toApi();return{id:n,model:t,api:r}}))}buildApplication(n,e){return __awaiter$1$3(this,void 0,void 0,(function*(){const t=new ApplicationModel$1(n,[],this.appManagerController).toApi(),r=e.map((n=>this.buildInstance(n,t)));return t.instances.push(...r),t}))}buildInstance(n,e){return new InstanceModel$1(n,this.bridge,e).toApi()}}const createFactoryFunction$1=n=>e=>__awaiter$1$3(void 0,void 0,void 0,(function*(){const t=parseConfig$1(e);if(window.glue42gd)return enterprise$1(t);checkSingleton$1();const r=yield PromiseWrap$1((()=>n(t)),3e4,"Glue Web initialization timed out"),i=r.logger.subLogger("web.main.controller"),o=new IoC$1(r);return yield o.bridge.start(o.controllers),i.trace("the bridge has been started, initializing all controllers"),yield Promise.all(Object.values(o.controllers).map((n=>n.start(r,o)))),i.trace("all controllers reported started, starting all additional libraries"),yield Promise.all(t.libraries.map((n=>n(r,t)))),i.trace("all libraries were started, glue is ready, returning it"),r}));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics$3=function(n,e){return(extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function __extends$3(n,e){function t(){this.constructor=n}extendStatics$3(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign$1$2=function(){return(__assign$1$2=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __awaiter$1$1$1(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new t((function(e){e(n.value)})).then(l,u)}s((r=r.apply(n,e||[])).next())}))}function __generator$3(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function __spreadArrays$2(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],l=0,u=o.length;l<u;l++,i++)r[i]=o[l];return r}var MetricTypes$2={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue$2(n){return n.type===MetricTypes$2.TIMESTAMP?"timestamp":n.type===MetricTypes$2.NUMBER?"number":n.type===MetricTypes$2.STRING?"string":n.type===MetricTypes$2.OBJECT?"object":"unknown"}function getTypeByValue$2(n){return n.constructor===Date?"timestamp":"number"==typeof n?"number":"string"==typeof n?"string":"object"==typeof n?"object":"string"}function serializeMetric$2(n){var e={},t=getMetricTypeByValue$2(n);if("object"===t){var r=Object.keys(n.value).reduce((function(e,t){var r=getTypeByValue$2(n.value[t]);if("object"===r){var i=defineNestedComposite$2(n.value[t]);e[t]={type:"object",description:"",context:{},composite:i}}else e[t]={type:r,description:"",context:{}};return e}),{});e.composite=r}return e.name=normalizeMetricName$2(n.path.join("/")+"/"+n.name),e.type=t,e.description=n.description,e.context={},e}function defineNestedComposite$2(n){return Object.keys(n).reduce((function(e,t){var r=getTypeByValue$2(n[t]);return e[t]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite$2(n[t])}:{type:r,description:"",context:{}},e}),{})}function normalizeMetricName$2(n){return void 0!==n&&n.length>0&&"/"!==n[0]?"/"+n:n}function getMetricValueByType$2(n){return"timestamp"===getMetricTypeByValue$2(n)?Date.now():publishNestedComposite$2(n.value)}function publishNestedComposite$2(n){return"object"!=typeof n?n:Object.keys(n).reduce((function(e,t){var r=n[t];return"object"==typeof r&&r.constructor!==Date?e[t]=publishNestedComposite$2(r):r.constructor===Date?e[t]=new Date(r).getTime():r.constructor===Boolean?e[t]=r.toString():e[t]=r,e}),{})}function flatten$2(n){return n.reduce((function(n,e){return n.concat(Array.isArray(e)?flatten$2(e):e)}),[])}function getHighestState$2(n){return n.sort((function(n,e){return n.state?e.state?e.state-n.state:-1:1}))[0]}function aggregateDescription$2(n){var e="";return n.forEach((function(n,t,r){var i=n.path.join(".");t===r.length-1?e+=i+"."+n.name+": "+n.description:e+=i+"."+n.name+": "+n.description+","})),e.length>100?e.slice(0,100)+"...":e}function composeMsgForRootStateMetric$2(n){var e=flatten$2(n.root.getAggregateState()),t=getHighestState$2(e);return{description:aggregateDescription$2(e),value:t.state}}function gw3$2(n,e){var t,r,i=this;if(!n||"object"!=typeof n)throw new Error("Connection is required parameter");var o=function(n){l(n.root)},l=function(n){u(n),n.metrics.forEach((function(n){s(n)})),n.subSystems.forEach((function(n){l(n)}))},u=function(n){return __awaiter$1$1$1(i,void 0,void 0,(function(){var e,i;return __generator$3(this,(function(o){switch(o.label){case 0:return void 0===n.parent?[2]:[4,t];case 1:return o.sent(),e={name:normalizeMetricName$2(n.path.join("/")+"/"+n.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[e]},r.send(i),[2]}}))}))},s=function(n){return __awaiter$1$1$1(i,void 0,void 0,(function(){var e,i,o;return __generator$3(this,(function(l){switch(l.label){case 0:return e=c(n),[4,t];case 1:return l.sent(),i=serializeMetric$2(e),o={type:"define",metrics:[i]},r.send(o),void 0!==e.value&&a(e),[2]}}))}))},a=function(n){if(d()){var e=getMetricValueByType$2(n),t={type:"publish",values:[{name:normalizeMetricName$2(n.path.join("/")+"/"+n.name),value:e,timestamp:Date.now()}]};return r.sendFireAndForget(t)}return Promise.resolve()},c=function(n){var e=__assign$1$2({},n);return"object"==typeof n.value&&null!==n.value&&(e.value=__assign$1$2({},n.value)),e},d=function(){var n;try{return(null!==(n=e.canUpdateMetric)&&void 0!==n?n:function(){return!0})()}catch(n){return!0}};return{init:function(i){var l;t=new Promise((function(n){l=n})),(r=n.domain("metrics")).onJoined((function(n){!n&&l&&(l(),l=void 0);var e={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(e),n&&o(i)})),r.join({system:e.system,service:e.service,instance:e.instance})},createSystem:u,updateSystem:function(e,o){return __awaiter$1$1$1(i,void 0,void 0,(function(){var i,l,u;return __generator$3(this,(function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),i={type:"publish",values:[{name:normalizeMetricName$2(e.path.join("/")+"/"+e.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric$2(e),u={type:"publish",peer_id:n.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(u),[2]}}))}))},createMetric:s,updateMetric:function(n){return __awaiter$1$1$1(i,void 0,void 0,(function(){var e;return __generator$3(this,(function(r){switch(r.label){case 0:return e=c(n),[4,t];case 1:return r.sent(),a(e),[2]}}))}))}}}var Helpers$2={validate:function(n,e,t){if(null===n||"object"!=typeof n)throw new Error("Missing definition");if(null===e||"object"!=typeof e)throw new Error("Missing parent");if(null===t||"object"!=typeof t)throw new Error("Missing transport")}},BaseMetric$2=function(){function n(n,e,t,r,i){this.definition=n,this.system=e,this.transport=t,this.value=r,this.type=i,this.path=[],Helpers$2.validate(n,e,t),this.path=e.path.slice(0),this.path.push(e.name),this.name=n.name,this.description=n.description,t.createMetric(this)}return Object.defineProperty(n.prototype,"repo",{get:function(){var n;return null===(n=this.system)||void 0===n?void 0:n.repo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),n.prototype.update=function(n){return this.value=n,this.transport.updateMetric(this)},n}(),NumberMetric$2=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$2.NUMBER)||this}return __extends$3(e,n),e.prototype.incrementBy=function(n){this.update(this.value+n)},e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.incrementBy(-1)},e.prototype.decrementBy=function(n){this.incrementBy(-1*n)},e}(BaseMetric$2),ObjectMetric$2=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$2.OBJECT)||this}return __extends$3(e,n),e.prototype.update=function(n){return this.mergeValues(n),this.transport.updateMetric(this)},e.prototype.mergeValues=function(n){var e=this;return Object.keys(this.value).forEach((function(t){void 0!==n[t]&&(e.value[t]=n[t])}))},e}(BaseMetric$2),StringMetric$2=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$2.STRING)||this}return __extends$3(e,n),e}(BaseMetric$2),TimestampMetric$2=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$2.TIMESTAMP)||this}return __extends$3(e,n),e.prototype.now=function(){this.update(new Date)},e}(BaseMetric$2);function system$2(n,e,t,r,i){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");var o,l,u=t,s=n,a=i||"",c=e,d=r,h=function n(e){if(!e||!e.parent)return[];var t=n(e.parent);return t.push(e.name),t}(r),f={},p=(l="/",((o=h)&&o.length>0?o.join(l):"")+n),g=e.root,w=[],v=[];function m(n,e,t,r){var i={name:""};i="string"==typeof n?{name:n}:n;var o=v.filter((function(n){return n.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==e)throw new Error("A metric named "+i.name+" is already defined with different type.");return void 0!==t&&l.update(t).catch((function(){})),l}var u=r(i);return v.push(u),u}var y={get name(){return s},get description(){return a},get repo(){return c},get parent(){return d},path:h,id:p,root:g,get subSystems(){return w},get metrics(){return v},subSystem:function(n,e){if(!n||0===n.length)throw new Error("name is required");var t=w.filter((function(e){return e.name===n}));if(t.length>0)return t[0];var r=system$2(n,c,u,y,e);return w.push(r),r},getState:function(){return f},setState:function(n,e){f={state:n,description:e},u.updateSystem(y,f)},stringMetric:function(n,e){return m(n,MetricTypes$2.STRING,e,(function(n){return new StringMetric$2(n,y,u,e)}))},timestampMetric:function(n,e){return m(n,MetricTypes$2.TIMESTAMP,e,(function(n){return new TimestampMetric$2(n,y,u,e)}))},objectMetric:function(n,e){return m(n,MetricTypes$2.OBJECT,e,(function(n){return new ObjectMetric$2(n,y,u,e)}))},numberMetric:function(n,e){return m(n,MetricTypes$2.NUMBER,e,(function(n){return new NumberMetric$2(n,y,u,e)}))},getAggregateState:function(){var n=[];return Object.keys(f).length>0&&n.push({name:s,path:h,state:f.state,description:f.description}),w.forEach((function(e){var t=e.getAggregateState();t.length>0&&n.push.apply(n,t)})),n}};return u.createSystem(y),y}var Repository$2=function(){function n(n,e){e.init(this),this.root=system$2("",this,e),this.addSystemMetrics(this.root,n.clickStream||void 0===n.clickStream)}return n.prototype.addSystemMetrics=function(n,e){if("undefined"!=typeof navigator&&n.stringMetric("UserAgent",navigator.userAgent),e&&"undefined"!=typeof document){var t=n.subSystem("ClickStream"),r=function(n){if(n.target){var e=n.target;t.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:n.target?e.className:"",id:e.id,type:"<"+e.tagName.toLowerCase()+">",href:e.href||""}})}};t.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}n.stringMetric("StartTime",(new Date).toString());var i=n.stringMetric("StartURL",""),o=n.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},n}(),NullProtocol$2=function(){function n(){}return n.prototype.init=function(n){},n.prototype.createSystem=function(n){return Promise.resolve()},n.prototype.updateSystem=function(n,e){return Promise.resolve()},n.prototype.createMetric=function(n){return Promise.resolve()},n.prototype.updateMetric=function(n){return Promise.resolve()},n}(),PerfTracker$2=function(){function n(n,e,t){this.api=n,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=e?e:this.initialPublishTimeout,this.publishInterval=null!=t?t:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return n.prototype.scheduleCollection=function(){var n=this;setTimeout((function(){n.collect(),setInterval((function(){n.collect()}),n.publishInterval)}),this.initialPublishTimeout)},n.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(n){}},n.prototype.collectMemory=function(){var n=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:n.totalJSHeapSize,usedJSHeapSize:n.usedJSHeapSize}))},n.prototype.collectEntries=function(){var n=window.performance.getEntries();n.length<=this.lastCount||(this.lastCount=n.length,this.system.stringMetric("entries",JSON.stringify(n)))},n}(),metrics$2=function(n){var e;e=n.connection&&"object"==typeof n.connection?gw3$2(n.connection,n):new NullProtocol$2;var t=new Repository$2(n,e).root;n.disableAutoAppSystem||(t=t.subSystem("App"));var r=addFAVSupport$2(t);return initPerf$2(r,n.pagePerformanceMetrics),r},perf$2;function initPerf$2(n,e){var t,r;if("undefined"!=typeof window){var i=null===(r=null===(t=null===window||void 0===window?void 0:window.glue42gd)||void 0===t?void 0:t.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(e=i),(null==e?void 0:e.enabled)&&(perf$2=new PerfTracker$2(n,e.initialPublishTimeout,e.publishInterval))}}function addFAVSupport$2(n){var e,t=n.subSystem("reporting"),r={name:"features"};return n.featureMetric=function(n,i,o){if(void 0===n||""===n)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");e?e.update({name:n,action:i,payload:o}):e=t.objectMetric(r,{name:n,action:i,payload:o})},n}function createRegistry$1$2(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$1$2.default=createRegistry$1$2;var lib$1$2=createRegistry$1$2,InProcTransport$2=function(){function n(n,e){var t=this;this.registry=lib$1$2(),this.gw=n.facade,this.gw.connect((function(n,e){t.messageHandler(e)})).then((function(n){t.client=n}))}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.client?(this.client.send(n),Promise.resolve(void 0)):Promise.reject("not connected")},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"in-memory"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),SharedWorkerTransport$2=function(){function n(n,e){var t=this;this.logger=e,this.registry=lib$1$2(),this.worker=new SharedWorker(n),this.worker.port.onmessage=function(n){t.messageHandler(n.data)}}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.worker.port.postMessage(n),Promise.resolve()},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"shared-worker"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),Utils$3=function(){function n(){}return n.getGDMajorVersion=function(){if("undefined"!=typeof window&&window.glueDesktop&&window.glueDesktop.version){var n=Number(window.glueDesktop.version.substr(0,1));return isNaN(n)?void 0:n}},n.isNode=function(){if(void 0!==n._isNode)return n._isNode;if("undefined"!=typeof window)return n._isNode=!1,!1;try{n._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(e){n._isNode=!1}return n._isNode},n}(),PromiseWrapper$2=function(){function n(){var n=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(e,t){n.resolve=function(t){n.resolved=!0,e(t)},n.reject=function(e){n.rejected=!0,t(e)}}))}return n.delay=function(n){return new Promise((function(e){return setTimeout(e,n)}))},Object.defineProperty(n.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),n}(),timers$2={};function getAllTimers$2(){return timers$2}function timer$2(n){var e=timers$2[n];if(e)return e;var t=[];function r(){return(new Date).getTime()}var i,o,l=r();function u(n,e){var i=null!=e?e:r(),o=0;t.length>0&&(o=i-t[t.length-1].time),t.push({name:n,time:i,diff:o})}u("start",l);var s={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return u("end",i=r()),o=i-l},mark:u,marks:t};return timers$2[n]=s,s}var WebSocketConstructor$2=Utils$3.isNode()?require("ws"):window.WebSocket,WS$2=function(){function n(n,e){if(this.startupTimer=timer$2("connection"),this._running=!0,this._registry=lib$1$2(),this.wsRequests=[],this.settings=n,this.logger=e,!this.settings.ws)throw new Error("ws is missing")}return n.prototype.onMessage=function(n){return this._registry.add("onMessage",n)},n.prototype.send=function(n,e){var t=this;return new Promise((function(e,r){t.waitForSocketConnection((function(){var i;try{null===(i=t.ws)||void 0===i||i.send(n),e()}catch(n){r(n)}}),r)}))},n.prototype.open=function(){var n=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(e,t){n.waitForSocketConnection(e,t)}))},n.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},n.prototype.onConnectedChanged=function(n){return this._registry.add("onConnectedChanged",n)},n.prototype.name=function(){return"ws "+this.settings.ws},n.prototype.reconnect=function(){var n;null===(n=this.ws)||void 0===n||n.close();var e=new PromiseWrapper$2;return this.waitForSocketConnection((function(){e.resolve()})),e.promise},n.prototype.waitForSocketConnection=function(n,e){var t;e=null!=e?e:function(){},this._running?1!==(null===(t=this.ws)||void 0===t?void 0:t.readyState)?(this.wsRequests.push({callback:n,failed:e}),this.wsRequests.length>1||this.openSocket()):n():e("wait for socket on "+this.settings.ws+" failed - socket closed by user")},n.prototype.openSocket=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t=this;return __generator$3(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===n&&(n=this.settings.reconnectInterval),void 0!==e){if(0===e)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+e+" more times (every "+n+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===e?void 0:e-1;t.openSocket(n,r)}),n),[3,4];case 4:return[2]}}))}))},n.prototype.initiateSocket=function(){var n=this,e=new PromiseWrapper$2;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new WebSocketConstructor$2(this.settings.ws||""),this.ws.onerror=function(t){var r="";try{r=JSON.stringify(t)}catch(n){var i=new WeakSet;r=JSON.stringify(t,(function(n,e){if("object"==typeof e&&null!==e){if(i.has(e))return;i.add(e)}return e}))}e.reject("error"),n.notifyStatusChanged(!1,r)},this.ws.onclose=function(t){n.logger.info("ws closed "+t),e.reject("closed"),n.notifyStatusChanged(!1)},this.ws.onopen=function(){var t;n.startupTimer.mark("ws-opened"),n.logger.info("ws opened "+(null===(t=n.settings.identity)||void 0===t?void 0:t.application)),e.resolve(),n.notifyStatusChanged(!0)},this.ws.onmessage=function(e){n._registry.execute("onMessage",e.data)},e.promise},n.prototype.notifyForSocketState=function(n){this.wsRequests.forEach((function(e){n?e.failed&&e.failed(n):e.callback()})),this.wsRequests=[]},n.prototype.notifyStatusChanged=function(n,e){this._registry.execute("onConnectedChanged",n,e)},n}();function createCommonjsModule$3(n,e){return n(e={exports:{}},e.exports),e.exports}var seed$3=1;function getNextValue$3(){return(seed$3=(9301*seed$3+49297)%233280)/233280}function setSeed$5(n){seed$3=n}var randomFromSeed$3={nextValue:getNextValue$3,seed:setSeed$5},ORIGINAL$3="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$3,previousSeed$3,shuffled$3;function reset$3(){shuffled$3=!1}function setCharacters$3(n){if(n){if(n!==alphabet$3){if(n.length!==ORIGINAL$3.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$3.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$3.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet$3=n,reset$3()}}else alphabet$3!==ORIGINAL$3&&(alphabet$3=ORIGINAL$3,reset$3())}function characters$3(n){return setCharacters$3(n),alphabet$3}function setSeed$1$2(n){randomFromSeed$3.seed(n),previousSeed$3!==n&&(reset$3(),previousSeed$3=n)}function shuffle$3(){alphabet$3||setCharacters$3(ORIGINAL$3);for(var n,e=alphabet$3.split(""),t=[],r=randomFromSeed$3.nextValue();e.length>0;)r=randomFromSeed$3.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled$3(){return shuffled$3||(shuffled$3=shuffle$3())}function lookup$3(n){return getShuffled$3()[n]}var alphabet_1$3={characters:characters$3,seed:setSeed$1$2,lookup:lookup$3,shuffled:getShuffled$3},crypto$3="object"==typeof window&&(window.crypto||window.msCrypto);function randomByte$3(){if(!crypto$3||!crypto$3.getRandomValues)return 48&Math.floor(256*Math.random());var n=new Uint8Array(1);return crypto$3.getRandomValues(n),48&n[0]}var randomByteBrowser$3=randomByte$3;function encode$3(n,e){for(var t,r=0,i="";!t;)i+=n(e>>4*r&15|randomByteBrowser$3()),t=e<Math.pow(16,r+1),r++;return i}var encode_1$3=encode$3;function decode$3(n){var e=alphabet_1$3.shuffled();return{version:15&e.indexOf(n.substr(0,1)),worker:15&e.indexOf(n.substr(1,1))}}var decode_1$3=decode$3;function isShortId$3(n){if(!n||"string"!=typeof n||n.length<6)return!1;for(var e=alphabet_1$3.characters(),t=n.length,r=0;r<t;r++)if(-1===e.indexOf(n[r]))return!1;return!0}var isValid$3=isShortId$3,lib$1$1$2=createCommonjsModule$3((function(n){var e,t,r=0;function i(){var n="",i=Math.floor(.001*(Date.now()-1459707606518));return i===t?e++:(e=0,t=i),n+=encode_1$3(alphabet_1$3.lookup,6),n+=encode_1$3(alphabet_1$3.lookup,r),e>0&&(n+=encode_1$3(alphabet_1$3.lookup,e)),n+=encode_1$3(alphabet_1$3.lookup,i)}n.exports=i,n.exports.generate=i,n.exports.seed=function(e){return alphabet_1$3.seed(e),n.exports},n.exports.worker=function(e){return r=e,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1$3.characters(n),alphabet_1$3.shuffled()},n.exports.decode=decode_1$3,n.exports.isValid=isValid$3})),lib_1$3=lib$1$1$2.generate,lib_2$3=lib$1$1$2.seed,lib_3$3=lib$1$1$2.worker,lib_4$3=lib$1$1$2.characters,lib_5$3=lib$1$1$2.decode,lib_6$3=lib$1$1$2.isValid,shortid$3=lib$1$1$2;function domainSession$2(n,e,t,r,i){null==n&&(n="global"),r=r||["success"],i=i||["error"];var o,l=!1,u=!1,s=!1,a=lib$1$2();e.disconnected((function(){s=!1,t.debug("connection is down"),l=!1,u=!0,a.execute("onLeft",{disconnected:!0})})),e.loggedIn((function(){s=!0,u&&(t.debug("connection is now up - trying to reconnect..."),d(o))})),e.on("success",(function(n){return f(n)})),e.on("error",(function(n){return h(n)})),e.on("result",(function(n){return f(n)})),r&&r.forEach((function(n){e.on(n,(function(n){return f(n)}))})),i&&i.forEach((function(n){e.on(n,(function(n){return h(n)}))}));var c={};function d(e){return o=e,new Promise((function(r,i){if(l)r();else{var o;if("global"===n)o=s?Promise.resolve({}):Promise.reject("not connected to gateway");else t.debug("joining domain "+n),o=g({type:"join",destination:n,domain:"global",options:e});o.then((function(){!function(){t.debug("did join "+n),l=!0;var e=u;u=!1,a.execute("onJoined",e)}(),r()})).catch((function(e){t.debug("error joining "+n+" domain: "+JSON.stringify(e)),i(e)}))}}))}function h(e){if(n===e.domain){var t=e.request_id;if(t){var r=c[t];r&&r.error(e)}}}function f(e){if(e.domain===n){var t=e.request_id;if(t){var r=c[t];r&&r.success(e)}}}function p(){return shortid$3()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||n,o.skipPeerId||(r.peer_id=e.peerId);var l=r.request_id;return new Promise((function(n,u){c[l]={success:function(e){delete c[l],e._tag=i,n(e)},error:function(n){t.warn("GW error - "+JSON.stringify(n)+" for request "+JSON.stringify(r)),delete c[l],n._tag=i,u(n)}},e.send(r,o).catch((function(n){c[l].error({err:n})}))}))}return{join:d,leave:function(){return"global"===n?Promise.resolve():(t.debug("stopping session "+n+"..."),u=!1,g({type:"leave",destination:n,domain:"global"}).then((function(){l=!1,a.execute("onLeft")})))},onJoined:function(n){return l&&n(!1),a.add("onJoined",n)},onLeft:function(n){return l||n(),a.add("onLeft",n)},send:g,sendFireAndForget:function(t){return t.request_id=t.request_id?t.request_id:p(),t.domain=t.domain||n,t.peer_id=e.peerId,e.send(t)},on:function(r,i){e.on(r,(function(e){if(e.domain===n)try{i(e)}catch(n){t.error("Callback  failed: "+n+" \n "+n.stack+" \n msg was: "+JSON.stringify(e),n)}}))},loggedIn:function(n){return e.loggedIn(n)},connected:function(n){return e.connected(n)},disconnected:function(n){return e.disconnected(n)},get peerId(){return e.peerId},get domain(){return n}}}var GW3ProtocolImpl$2=function(){function n(n,e,t){var r=this;this.connection=n,this.settings=e,this.logger=t,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib$1$2(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],n.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.processStringMessage=function(n){var e=this,t=JSON.parse(n,(function(n,t){if("string"!=typeof t)return t;if(t.length<e.dateMinLen)return t;if(t[0]!==e.datePrefixFirstChar)return t;if(t.substring(0,e.datePrefixLen)!==e.datePrefix)return t;try{var r=parseInt(t.substring(e.datePrefixLen,t.length),10);return isNaN(r)?t:new Date(r)}catch(n){return t}}));return{msg:t,msgType:t.type}},n.prototype.createStringMessage=function(n){var e=Date.prototype.toJSON;try{var t=this.datePrefix;return Date.prototype.toJSON=function(){return t+this.getTime()},JSON.stringify(n)}finally{Date.prototype.toJSON=e}},n.prototype.processObjectMessage=function(n){if(!n.type)throw new Error("Object should have type property");return{msg:n,msgType:n.type}},n.prototype.createObjectMessage=function(n){return n},n.prototype.login=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t,r,i,o,l,u,s,a,c,d;return __generator$3(this,(function(h){switch(h.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=n,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,t={},this.connection.gatewayToken=n.gatewayToken,!n.gatewayToken)return[3,5];if(!e)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return a=h.sent(),n.gatewayToken=a,[3,4];case 3:return r=h.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null==r?void 0:r.message)||r)),[3,4];case 4:return t.method="gateway-token",t.token=n.gatewayToken,this.connection.gatewayToken=n.gatewayToken,[3,10];case 5:return"sspi"!==n.flowName?[3,9]:(t.provider="win",t.method="access-token",n.flowCallback&&n.sessionId?(i=t,[4,n.flowCallback(n.sessionId,null)]):[3,7]);case 6:return i.token=h.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(n.token)t.method="access-token",t.token=n.token;else{if(!n.username)throw new Error("invalid auth message"+JSON.stringify(n));t.method="secret",t.login=n.username,t.secret=n.password}h.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:t},n.sessionId&&(o.request_id=n.sessionId),this.globalDomain=domainSession$2("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),h.label=11;case 11:h.trys.push([11,19,20,21]),u=void 0,h.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(s=h.sent()).type?[3,16]:(a=Buffer.from(s.authentication.token,"base64"),n.flowCallback&&n.sessionId?(c=o.authentication,[4,n.flowCallback(n.sessionId,a)]):[3,15]);case 14:c.token=h.sent().data.toString("base64"),h.label=15;case 15:return o.request_id=n.sessionId,[3,12];case 16:if("welcome"===s.type)return u=s,[3,18];throw"error"===s.type?new Error("Authentication failed: "+s.reason):new Error("Unexpected message type during authentication: "+s.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+u.peer_id),this.connection.peerId=u.peer_id,this.connection.resolvedIdentity=u.resolved_identity,this.connection.availableDomains=u.available_domains,u.options&&(this.connection.token=u.options.access_token,this.connection.info=u.options.info),this.setLoggedIn(!0),[2,u.resolved_identity];case 19:throw d=h.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return n&&n.flowCallback&&n.sessionId&&n.flowCallback(n.sessionId,null),[7];case 21:return[2]}}))}))},n.prototype.logout=function(){return __awaiter$1$1$1(this,void 0,void 0,(function(){var n;return __generator$3(this,(function(e){switch(e.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),n=this.sessions.map((function(n){n.leave()})),[4,Promise.all(n)];case 1:return e.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this._isLoggedIn&&n(),this.registry.add("onLoggedIn",n)},n.prototype.domain=function(n,e,t,r){var i=this.sessions.filter((function(e){return e.domain===n}))[0];return i||(i=domainSession$2(n,this.connection,e,t,r),this.sessions.push(i)),i},n.prototype.handleDisconnected=function(){var n=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(n.handleDisconnected.bind(n),n.settings.reconnectInterval||1e3)}))}},n.prototype.setLoggedIn=function(n){this._isLoggedIn=n,this._isLoggedIn&&this.registry.execute("onLoggedIn")},n.prototype.ping=function(){var n=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){n.ping()}),3e4))},n.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(n){return n.token})):Promise.reject(new Error("no global domain session"))},n.prototype.getNewGWToken=function(){if(void 0!==typeof window){var n=window.glue42gd;if(n)return n.getGWToken()}return Promise.reject(new Error("not running in GD"))},n}(),MessageReplayerImpl$2=function(){function n(n){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var e=0,t=n;e<t.length;e++){var r=t[e];this.specs[r.name]=r,this.specsNames.push(r.name)}}return n.prototype.init=function(n){var e=this;this.connection=n;for(var t=0,r=this.specsNames;t<r.length;t++)for(var i=r[t],o=function(t){var r=l.subsRefCount[t];if(r||(r=0),r+=1,l.subsRefCount[t]=r,r>1)return"continue";var i=n.on(t,(function(n){return e.processMessage(t,n)}));l.subs[t]=i},l=this,u=0,s=this.specs[i].types;u<s.length;u++){o(s[u])}},n.prototype.processMessage=function(n,e){if(!this.isDone&&e)for(var t=0,r=this.specsNames;t<r.length;t++){var i=r[t];if(-1!==this.specs[i].types.indexOf(n)){var o=this.messages[i]||[];this.messages[i]=o,o.push(e)}}},n.prototype.drain=function(n,e){var t;e&&(this.messages[n]||[]).forEach(e),delete this.messages[n];for(var r=0,i=this.specs[n].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(t=this.connection)||void 0===t||t.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[n],this.specs.length||(this.isDone=!0)},n}(),PromisePlus$1$1=function(n,e,t){return new Promise((function(r,i){var o=setTimeout((function(){i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((function(n){clearTimeout(o),r(n)})).catch((function(n){clearTimeout(o),i(n)}))}))},WebPlatformTransport$1=function(){function n(n,e,t){this.settings=n,this.logger=e,this.identity=t,this.parentReady=!1,this.iAmConnected=!1,this.rejected=!1,this.children=[],this.parentPingTimeout=3e3,this.connectionRequestTimeout=5e3,this.defaultTargetString="*",this.registry=lib$1$2(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:this.handleParentReady.bind(this)},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformUnload:{name:"platformUnload",handle:this.handlePlatformUnload.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)}},this.setUpMessageListener(),this.setUpUnload(),this.settings.port||(this.parent=window.opener||window.top,this.parentType=window.opener?"opener":-1!==window.name.indexOf("#wsp")?"workspace":"top")}return Object.defineProperty(n.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return __awaiter$1$1$1(this,void 0,void 0,(function(){return __generator$3(this,(function(e){if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(n),[2]}))}))},Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.send=function(){return Promise.reject("not supported")},n.prototype.onConnectedChanged=function(n){return this.registry.add("onConnectedChanged",n)},n.prototype.open=function(){return __awaiter$1$1$1(this,void 0,void 0,(function(){return __generator$3(this,(function(n){switch(n.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return n.sent(),this.notifyStatusChanged(!0),[2]}}))}))},n.prototype.close=function(){return Promise.resolve()},n.prototype.name=function(){return"web-platform"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.connect=function(){return __awaiter$1$1$1(this,void 0,void 0,(function(){var n=this;return __generator$3(this,(function(e){switch(e.label){case 0:if(this.parentReady)return this.logger.debug("cancelling connection attempt, because this client's parent has already given a ready signal"),[2];if(this.settings.port)return this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.publicWindowId=this.settings.windowId,this.identity&&(this.identity.windowId=this.publicWindowId),this.port.onmessage=function(e){return n.registry.execute("onMessage",e.data)},this.logger.debug("internal web platform connection completed"),[2];if(!this.parentType||!this.parent)throw new Error("Cannot initiate a connection, because there is no opener, no top and no port.");return this.logger.debug("opening a "+("opener"===this.parentType?"child":"grandchild")+" client web platform connection"),[4,this.waitParent(this.parent,this.parentType)];case 1:return e.sent(),[4,this.initiateRemoteConnection(this.parent,this.parentType)];case 2:return e.sent(),this.logger.debug("the "+("opener"===this.parentType?"child":"grandchild")+" client is connected"),[2]}}))}))},n.prototype.initiateRemoteConnection=function(n,e){var t=this;return PromisePlus$1$1((function(r,i){t.connectionResolve=r,t.connectionReject=i,t.myClientId=shortid$3();var o="workspace"===t.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window.name,l={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"top"===e||"workspace"===e?"grandChild":"child",bridgeInstanceId:o}};t.logger.debug("sending connection request to "+e),n.postMessage(l,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the opener/top window timed out")},n.prototype.waitParent=function(n,e){var t=this;return PromisePlus$1$1((function(r){t.parentPingResolve=r;var i={glue42core:{type:"opener"===e?t.messages.platformPing.name:t.messages.parentPing.name}};t.logger.debug("checking for "+e+" window availability"),n.postMessage(i,t.defaultTargetString)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client")},n.prototype.setUpMessageListener=function(){var n=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(e){var t,r=null===(t=e.data)||void 0===t?void 0:t.glue42core;if(r&&!n.rejected)if(n.checkMessageTypeValid(r.type)){var i=r.type;n.logger.debug("received valid glue42core message of type: "+i),n.messages[i].handle(e)}else n.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: "+r.type)}))},n.prototype.setUpUnload=function(){var n=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var e,t,r={glue42core:{type:n.messages.clientUnload.name,data:{clientId:n.myClientId,ownWindowId:null===(e=n.identity)||void 0===e?void 0:e.windowId}}};n.parent&&n.parent.postMessage(r,n.defaultTargetString),null===(t=n.port)||void 0===t||t.postMessage(r)}))},n.prototype.handleParentReady=function(){if(this.logger.debug("handling the ready signal from the parent, by resoling the pending promise."),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handlePlatformReady=function(){if(this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handleConnectionAccepted=function(n){var e,t=null===(e=n.data)||void 0===e?void 0:e.glue42core;return this.myClientId===t.clientId?this.handleAcceptanceOfMyRequest(t):this.handleAcceptanceOfGrandChildRequest(t,n)},n.prototype.handleAcceptanceOfMyRequest=function(n){var e=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),n.port){if(this.publicWindowId="opener"===this.parentType?window.name:"top"===this.parentType?n.parentWindowId:window.name.substring(0,window.name.indexOf("#wsp")),this.identity&&"top"!==this.parentType&&(this.identity.windowId=this.publicWindowId),this.identity&&n.appName&&(this.identity.application=n.appName,this.identity.applicationName=n.appName),this.port=n.port,this.port.onmessage=function(n){return e.registry.execute("onMessage",n.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},n.prototype.handleAcceptanceOfGrandChildRequest=function(n,e){this.logger.debug("handling a connection accepted signal targeted at a grandchild: "+n.clientId);var t=this.children.find((function(e){return e.grandChildId===n.clientId}));t?(t.connected=!0,this.logger.debug("the grandchild connection for "+n.clientId+" is set up, forwarding the success message and the gateway port"),n.parentWindowId=this.publicWindowId,t.source.postMessage(e.data,t.origin,[n.port])):this.logger.error("cannot handle connection accepted for grandchild: "+n.clientId+", because there is no grandchild with this id")},n.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},n.prototype.handleConnectionRequest=function(n){var e=n.source,t=n.data.glue42core;return t.clientType&&"grandChild"===t.clientType?t.clientId?"opener"===this.parentType&&this.parent?(this.logger.debug("handling a connection request for a grandchild: "+t.clientId),this.children.push({grandChildId:t.clientId,source:e,connected:!1,origin:n.origin}),this.logger.debug("grandchild: "+t.clientId+" is prepared, forwarding connection request to the platform"),void this.parent.postMessage(n.data,this.defaultTargetString)):this.rejectConnectionRequest(e,n.origin,"Cannot forward the connection request, because no direct connection to the platform was found"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source did not provide a valid id"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source was not opened by a glue API call")},n.prototype.handleParentPing=function(n){if(this.parentReady)if(this.iAmConnected){var e={glue42core:{type:this.messages.parentReady.name}},t=n.source;this.logger.debug("responding to a parent ping with a ready message"),t.postMessage(e,n.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},n.prototype.handlePlatformUnload=function(n){this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.children.length&&(this.logger.debug("forwarding the platform unload to all known children and starting platform discovery polling"),this.children.forEach((function(e){return e.source.postMessage(n.data,e.origin)}))),this.notifyStatusChanged(!1,"Gateway unloaded")},n.prototype.handleClientUnload=function(n){var e=n.data.glue42core;e.clientId?this.children.find((function(n){return n.grandChildId===e.clientId}))?(this.logger.debug("handling grandchild unload for id: "+e.clientId),this.children=this.children.filter((function(n){return n.grandChildId!==e.clientId}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},n.prototype.handlePlatformPing=function(){this.logger.error("cannot handle platform ping, because this is not a platform calls handling component")},n.prototype.notifyStatusChanged=function(n,e){this.iAmConnected=n,this.registry.execute("onConnectedChanged",n,e)},n.prototype.checkMessageTypeValid=function(n){return"string"==typeof n&&!!this.messages[n]},n.prototype.rejectConnectionRequest=function(n,e,t){this.rejected=!0,this.logger.error(t);var r={glue42core:{type:this.messages.connectionRejected.name}};n.postMessage(r,e)},n}(),Connection$2=function(){function n(n,e){if(this.settings=n,this.logger=e,this.messageHandlers={},this.ids=1,this.registry=lib$1$2(),this._connected=!1,this.isTrace=!1,(n=n||{}).reconnectAttempts=n.reconnectAttempts||10,n.reconnectInterval=n.reconnectInterval||1e3,n.inproc)this.transport=new InProcTransport$2(n.inproc,e.subLogger("inMemory"));else if(n.sharedWorker)this.transport=new SharedWorkerTransport$2(n.sharedWorker,e.subLogger("shared-worker"));else if(n.webPlatform)this.transport=new WebPlatformTransport$1(n.webPlatform,e.subLogger("web-platform"),n.identity);else{if(void 0===n.ws)throw new Error("No connection information specified");this.transport=new WS$2(n,e.subLogger("ws"))}this.isTrace=e.canPublish("trace"),e.debug("starting with "+this.transport.name()+" transport"),this.protocol=new GW3ProtocolImpl$2(this,n,e.subLogger("protocol")),this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this.transport.onMessage(this.handleTransportMessage.bind(this)),n.replaySpecs&&n.replaySpecs.length&&(this.replayer=new MessageReplayerImpl$2(n.replaySpecs),this.replayer.init(this))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;return null===(n=this.protocol)||void 0===n?void 0:n.protocolVersion},enumerable:!0,configurable:!0}),n.prototype.send=function(n,e){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var t=this.protocol.createObjectMessage(n);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(t)),this.transport.sendObject(t,e)}var r=this.protocol.createStringMessage(n);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,e)},n.prototype.on=function(n,e){n=n.toLowerCase(),void 0===this.messageHandlers[n]&&(this.messageHandlers[n]={});var t=this.ids++;return this.messageHandlers[n][t]=e,{type:n,id:t}},n.prototype.off=function(n){delete this.messageHandlers[n.type.toLowerCase()][n.id]},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.connected=function(n){var e=this;return this.protocol.loggedIn((function(){n(e.settings.ws||e.settings.sharedWorker||"")}))},n.prototype.disconnected=function(n){return this.registry.add("disconnected",n)},n.prototype.login=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t;return __generator$3(this,(function(r){switch(r.label){case 0:return[4,this.transport.open()];case 1:return r.sent(),timer$2("connection").mark("transport-opened"),t=this.protocol.login(n,e),timer$2("connection").mark("protocol-logged-in"),[2,t]}}))}))},n.prototype.logout=function(){return __awaiter$1$1$1(this,void 0,void 0,(function(){return __generator$3(this,(function(n){switch(n.label){case 0:return[4,this.protocol.logout()];case 1:return n.sent(),[4,this.transport.close()];case 2:return n.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this.protocol.loggedIn(n)},n.prototype.domain=function(n,e,t){return this.protocol.domain(n,this.logger.subLogger("domain="+n),e,t)},n.prototype.authToken=function(){return this.protocol.authToken()},n.prototype.reconnect=function(){return this.transport.reconnect()},n.prototype.distributeMessage=function(n,e){var t=this,r=this.messageHandlers[e.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(e){var i=r[e];if(void 0!==i)try{i(n)}catch(n){try{t.logger.error("Message handler failed with "+n.stack,n)}catch(e){console.log("Message handler failed",n)}}}))},n.prototype.handleConnectionChanged=function(n){this._connected!==n&&(this._connected=n,n?this.registry.execute("connected"):this.registry.execute("disconnected"))},n.prototype.handleTransportMessage=function(n){var e;e="string"==typeof n?this.protocol.processStringMessage(n):this.protocol.processObjectMessage(n),this.isTrace&&this.logger.trace("<< "+JSON.stringify(e)),this.distributeMessage(e.msg,e.msgType)},n}(),order$2=["trace","debug","info","warn","error","off"],Logger$3=function(){function n(n,e,t){this.name=n,this.parent=e,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=n,this.path=e?e.path+"."+n:n,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!t,t&&(this.logFn=t,this.customLogFn=!0)}return n.prototype.subLogger=function(e){var t=this.subLoggers.filter((function(n){return n.name===e}))[0];if(void 0!==t)return t;Object.keys(this).forEach((function(n){if(n===e)throw new Error("This sub logger name is not allowed.")}));var r=new n(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},n.prototype.publishLevel=function(n){var e;return n&&(this._publishLevel=n),this._publishLevel||(null===(e=this.parent)||void 0===e?void 0:e.publishLevel())},n.prototype.consoleLevel=function(n){var e;return n&&(this._consoleLevel=n),this._consoleLevel||(null===(e=this.parent)||void 0===e?void 0:e.consoleLevel())},n.prototype.log=function(n,e,t){this.publishMessage(e||"info",n,t)},n.prototype.trace=function(n){this.log(n,"trace")},n.prototype.debug=function(n){this.log(n,"debug")},n.prototype.info=function(n){this.log(n,"info")},n.prototype.warn=function(n){this.log(n,"warn")},n.prototype.error=function(n,e){this.log(n,"error")},n.prototype.canPublish=function(n,e){return order$2.indexOf(n)>=order$2.indexOf(e||this.consoleLevel()||"trace")},n.prototype.publishMessage=function(e,t,r){var i=this.loggerFullName;if("error"===e&&!r){var o=new Error;o.stack&&(t=t+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(e,this.publishLevel())){var l=n.Interop;if(l)try{l.methods({name:n.InteropMethodName}).length>0&&l.invoke(n.InteropMethodName,{msg:""+t,logger:i,level:e})}catch(n){}}if(this.canPublish(e)){var u="";if(this.includeTimeAndLevel){var s=new Date;u="["+(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+":"+s.getMilliseconds())+"] ["+e+"] "}var a=""+u+i+": "+t;switch(e){case"trace":this.logFn.debug(a);break;case"debug":this.logFn.debug?this.logFn.debug(a):this.logFn.log(a);break;case"info":this.logFn.info(a);break;case"warn":this.logFn.warn(a);break;case"error":this.logFn.error(a,r)}}},n.InteropMethodName="T42.AppLogger.Log",n}(),GW_MESSAGE_CREATE_CONTEXT$2="create-context",GW_MESSAGE_ACTIVITY_CREATED$2="created",GW_MESSAGE_ACTIVITY_DESTROYED$2="destroyed",GW_MESSAGE_CONTEXT_CREATED$2="context-created",GW_MESSAGE_CONTEXT_ADDED$2="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT$2="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT$2="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT$2="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT$2="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED$2="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT$2="update-context",GW_MESSAGE_CONTEXT_UPDATED$2="context-updated",GW_MESSAGE_JOINED_ACTIVITY$2="joined",ContextMessageReplaySpec$2={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT$2,GW_MESSAGE_ACTIVITY_CREATED$2,GW_MESSAGE_ACTIVITY_DESTROYED$2,GW_MESSAGE_CONTEXT_CREATED$2,GW_MESSAGE_CONTEXT_ADDED$2,GW_MESSAGE_SUBSCRIBE_CONTEXT$2,GW_MESSAGE_SUBSCRIBED_CONTEXT$2,GW_MESSAGE_UNSUBSCRIBE_CONTEXT$2,GW_MESSAGE_DESTROY_CONTEXT$2,GW_MESSAGE_CONTEXT_DESTROYED$2,GW_MESSAGE_UPDATE_CONTEXT$2,GW_MESSAGE_CONTEXT_UPDATED$2,GW_MESSAGE_JOINED_ACTIVITY$2]}},version$5="5.3.0";function prepareConfig$3(n,e,t){var r,i,o,l,u,s;if(Utils$3.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(n){}}function c(){if(n.application)return n.application;if(t)return t.applicationName;var e=shortid$3();return Utils$3.isNode()?s?s.applicationConfig.name:"NodeJS"+e:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" ("+e+")":e}var d=function(){var r,i,o,l,u,a,d,h,f,p,g=n.gateway,w=null!==(r=null==g?void 0:g.protocolVersion)&&void 0!==r?r:3,v=null==g?void 0:g.reconnectInterval,m=null==g?void 0:g.reconnectAttempts,y=null==g?void 0:g.ws,b=null==g?void 0:g.sharedWorker,$=null==g?void 0:g.inproc,_=null!==(i=null==g?void 0:g.webPlatform)&&void 0!==i?i:void 0;t&&(y=t.gwURL),Utils$3.isNode()&&s&&s.gwURL&&(y=s.gwURL),y||b||$||(y="ws://localhost:8385");var S=c(),I=S;void 0!==t?(d=t.windowId,h=t.pid,t.env&&(f=t.env.env,p=t.env.region),I=null!==(o=t.application)&&void 0!==o?o:"glue-app",a=t.appInstanceId):Utils$3.isNode()&&(h=process.pid,s&&(f=s.env,p=s.region,a=s.instanceId));var C=null!==(u=null===(l=n.gateway)||void 0===l?void 0:l.replaySpecs)&&void 0!==u?u:[];return C.push(ContextMessageReplaySpec$2),{identity:{application:I,applicationName:S,windowId:d,instance:a,process:h,region:p,environment:f,api:e.version||version$5},reconnectInterval:v,ws:y,sharedWorker:b,webPlatform:_,inproc:$,protocolVersion:w,reconnectAttempts:m,replaySpecs:C}}(),h=c();if("undefined"!=typeof window){var f=window,p=f.htmlContainer?f.htmlContainer.containerName+"."+f.htmlContainer.application:null===(r=null==f?void 0:f.glue42gd)||void 0===r?void 0:r.application;p&&(h=p)}return{bus:null!==(i=n.bus)&&void 0!==i&&i,application:h,auth:function(){var e,t,r;return"string"==typeof n.auth?{token:n.auth}:n.auth?n.auth:Utils$3.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(e=n.gateway)||void 0===e?void 0:e.webPlatform)||(null===(t=n.gateway)||void 0===t?void 0:t.inproc)||(null===(r=n.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var e,r,i,o=n.logger,l="warn";return o||(o=l),t&&(i=t.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(e=null!=i?i:o.console)&&void 0!==e?e:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:d,metrics:null===(o=n.metrics)||void 0===o||o,contexts:null===(l=n.contexts)||void 0===l||l,version:e.version||version$5,libs:null!==(u=e.libs)&&void 0!==u?u:[],customLogger:n.customLogger}}var GW3ContextData$2=function(){function n(n,e,t,r){this.updateCallbacks={},this.contextId=n,this.name=e,this.isAnnounced=t,this.activityId=r,this.context={}}return n.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},n.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},n}();function applyContextDelta$2(n,e,t){try{if((null==t?void 0:t.canPublish("trace"))&&(null==t||t.trace("applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n))),!e)return n;if(e.reset)return n=__assign$1$2({},e.reset);if(n=deepClone$2(n,void 0),e.commands){for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath$2(n,o.path):"set"===o.type&&setValueToPath$2(n,o.value,o.path)}return n}var l=e.added,u=e.updated,s=e.removed;return l&&Object.keys(l).forEach((function(e){n[e]=l[e]})),u&&Object.keys(u).forEach((function(e){mergeObjectsProperties$2(e,n,u)})),s&&s.forEach((function(e){delete n[e]})),n}catch(r){return null==t||t.error("error applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n),r),n}}function deepClone$2(n,e){if(e=e||new WeakMap,Object(n)!==n)return n;if(n instanceof Set)return new Set(n);if(e.has(n))return e.get(n);var t=n instanceof Date?new Date(n):n instanceof RegExp?new RegExp(n.source,n.flags):n.constructor?new n.constructor:Object.create(null);return e.set(n,t),Object.assign.apply(Object,__spreadArrays$2([t],Object.keys(n).map((function(t){var r;return(r={})[t]=deepClone$2(n[t],e),r}))))}var mergeObjectsProperties$2=function(n,e,t){var r=t[n];if(void 0===r)return e;var i=e[n];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(e[n]=r,e):(e[n]=Object.assign({},i,r),e):(e[n]=r,e)};function deepEqual$2(n,e){if(n===e)return!0;if(!(n instanceof Object&&e instanceof Object))return!1;if(n.constructor!==e.constructor)return!1;for(var t in n)if(n.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(n[t]!==e[t]){if("object"!=typeof n[t])return!1;if(!deepEqual$2(n[t],e[t]))return!1}}for(var t in e)if(e.hasOwnProperty(t)&&!n.hasOwnProperty(t))return!1;return!0}function setValueToPath$2(n,e,t){var r,i=t.split(".");for(r=0;r<i.length-1;r++)n[i[r]]||(n[i[r]]={}),"object"!=typeof n[i[r]]&&(n[i[r]]={}),n=n[i[r]];n[i[r]]=e}function deletePath$2(n,e){var t,r=e.split(".");for(t=0;t<r.length-1;t++){if(!n[r[t]])return;n=n[r[t]]}delete n[r[t]]}var GW3Bridge$3=function(){function n(n){var e,t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._connection=n.connection,this._logger=n.logger,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED$2,GW_MESSAGE_SUBSCRIBED_CONTEXT$2,GW_MESSAGE_CONTEXT_DESTROYED$2,GW_MESSAGE_CONTEXT_UPDATED$2]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec$2.name,(function(n){var e=n.type;e&&(e===GW_MESSAGE_CONTEXT_CREATED$2||e===GW_MESSAGE_CONTEXT_ADDED$2||e===GW_MESSAGE_ACTIVITY_CREATED$2?t.handleContextCreatedMessage(n):e===GW_MESSAGE_SUBSCRIBED_CONTEXT$2||e===GW_MESSAGE_CONTEXT_UPDATED$2||e===GW_MESSAGE_JOINED_ACTIVITY$2?t.handleContextUpdatedMessage(n):e!==GW_MESSAGE_CONTEXT_DESTROYED$2&&e!==GW_MESSAGE_ACTIVITY_DESTROYED$2||t.handleContextDestroyedMessage(n))}))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;if(!this._protocolVersion){var e=this._connection.availableDomains.find((function(n){return"context"===n.uri}));this._protocolVersion=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){for(var n=0,e=this._gw3Subscriptions;n<e.length;n++){var t=e[n];this._connection.off(t)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},n.prototype.createContext=function(n,e){var t=this;return this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT$2,domain:"global",name:n,data:e,lifetime:"retained"}).then((function(r){t._contextNameToId[n]=r.context_id,t._contextIdToName[r.context_id]=n;var i=t._contextNameToData[n]||new GW3ContextData$2(r.context_id,n,!0,void 0);return i.isAnnounced=!0,i.name=n,i.contextId=r.context_id,i.context=e,t._contextNameToData[n]=i,r.context_id}))},n.prototype.all=function(){var n=this;return Object.keys(this._contextNameToData).filter((function(e){return n._contextNameToData[e].isAnnounced}))},n.prototype.update=function(n,e){var t;return __awaiter$1$1$1(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator$3(this,(function(u){switch(u.label){case 0:return(r=this._contextNameToData[n])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(n,e)];case 1:i=u.sent(),u.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,e):this.calculateContextDeltaV1(i,e),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(t=o.commands)||void 0===t?void 0:t.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$2,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(n){l.handleUpdated(r,o,{updaterId:n.peer_id})}))]:[2,Promise.resolve()]}}))}))},n.prototype.set=function(n,e){var t=this,r=this._contextNameToData[n];return r&&r.isAnnounced?this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$2,domain:"global",context_id:r.contextId,delta:{reset:e}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{reset:e,added:{},removed:[],updated:{}},{updaterId:n.peer_id})})):this.createContext(n,e)},n.prototype.setPath=function(n,e,t){return this.setPathSupported?this.setPaths(n,[{path:e,value:t}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},n.prototype.setPaths=function(n,e){var t=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[n];if(!r||!r.isAnnounced){for(var i={},o=0,l=e;o<l.length;o++){setValueToPath$2(i,(c=l[o]).value,c.path)}return this.createContext(n,i)}for(var u=[],s=0,a=e;s<a.length;s++){var c;null===(c=a[s]).value?u.push({type:"remove",path:c.path}):u.push({type:"set",path:c.path,value:c.value})}return this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$2,domain:"global",context_id:r.contextId,delta:{commands:u}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{added:{},removed:[],updated:{},commands:u},{updaterId:n.peer_id})}))},n.prototype.get=function(n){var e,t=this,r=this._contextNameToData[n];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&!r.hasCallbacks())return new Promise((function(e,r){return __awaiter$1$1$1(t,void 0,void 0,(function(){var t=this;return __generator$3(this,(function(r){return this.subscribe(n,(function(n,r,i,o){t.unsubscribe(o),e(n)})),[2]}))}))}));var i=null!==(e=null==r?void 0:r.context)&&void 0!==e?e:{};return Promise.resolve(i)},n.prototype.subscribe=function(n,e){var t=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var r=this._contextNameToData[n];if(!r||!r.isAnnounced)return r=r||new GW3ContextData$2(void 0,n,!1,void 0),this._contextNameToData[n]=r,r.updateCallbacks[t]=e,Promise.resolve(t);var i,o=r.hasCallbacks();return r.updateCallbacks[t]=e,o||r.joinedActivity||r.context&&r.sentExplicitSubscription?(e(i=deepClone$2(r.context),i,[],t),Promise.resolve(t)):this.sendSubscribe(r).then((function(){return t}))},n.prototype.unsubscribe=function(n){for(var e=0,t=Object.keys(this._contextNameToData);e<t.length;e++){var r=t[e],i=(this._contextNameToId[r],this._contextNameToData[r]);if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[n],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},n.prototype.destroy=function(n){var e=this._contextNameToData[n];return e?this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT$2,domain:"global",context_id:e.contextId}).then((function(n){})):Promise.reject("context with "+n+" does not exist")},n.prototype.handleUpdated=function(n,e,t){var r=n.context;n.context=applyContextDelta$2(n.context,e,this._logger),this._contextNameToData[n.name]!==n||deepEqual$2(r,n.context)||this.invokeUpdateCallbacks(n,e,t)},n.prototype.subscribeToContextCreatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_ADDED$2,GW_MESSAGE_CONTEXT_CREATED$2,GW_MESSAGE_ACTIVITY_CREATED$2];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextCreatedMessage=function(n){var e=n.type;e===GW_MESSAGE_ACTIVITY_CREATED$2?(this._contextNameToId[n.activity_id]=n.context_id,this._contextIdToName[n.context_id]=n.activity_id):e===GW_MESSAGE_CONTEXT_ADDED$2&&(this._contextNameToId[n.name]=n.context_id,this._contextIdToName[n.context_id]=n.name);var t=this._contextIdToName[n.context_id];if(!t)throw new Error("Received created event for context with unknown name: "+n.context_id);if(!this._contextNameToId[t])throw new Error("Received created event for context with unknown id: "+n.context_id);var r=this._contextNameToData[t];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=n.context_id,r.activityId=n.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[t]=r=new GW3ContextData$2(n.context_id,t,!0,n.activity_id)},n.prototype.subscribeToContextUpdatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_UPDATED$2,GW_MESSAGE_SUBSCRIBED_CONTEXT$2,GW_MESSAGE_JOINED_ACTIVITY$2];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextUpdatedMessage=function(n){var e=n.type,t=n.context_id,r=this._contextNameToData[this._contextIdToName[t]],i=!r||!r.isAnnounced;if(e===GW_MESSAGE_JOINED_ACTIVITY$2)r?(r.contextId=t,r.isAnnounced=!0,r.activityId=n.activity_id):(r=new GW3ContextData$2(t,n.activity_id,!0,n.activity_id),this._contextNameToData[n.activity_id]=r,this._contextIdToName[t]=n.activity_id,this._contextNameToId[n.activity_id]=t),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$2?((r=r||new GW3ContextData$2(t,n.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[n.name]=r,this._contextIdToName[t]=n.name,this._contextNameToId[n.name]=t):this._logger.error("Received 'update' for unknown context: "+t));var o=r.context;if(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$2)r.context=n.data||{};else if(e===GW_MESSAGE_JOINED_ACTIVITY$2)r.context=n.context_snapshot||{};else{if(e!==GW_MESSAGE_CONTEXT_UPDATED$2)throw new Error("Unrecognized context update message "+e);r.context=applyContextDelta$2(r.context,n.delta,this._logger)}!i&&deepEqual$2(r.context,o)&&e!==GW_MESSAGE_SUBSCRIBED_CONTEXT$2||this.invokeUpdateCallbacks(r,n.delta,{updaterId:n.updater_id})},n.prototype.invokeUpdateCallbacks=function(n,e,t){if((e=e||{added:{},updated:{},reset:{},removed:[]}).commands){e.added=e.updated=e.reset={},e.removed=[];for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&e.removed.push(o.path),setValueToPath$2(e.updated,null,o.path)):"set"===o.type&&setValueToPath$2(e.updated,o.value,o.path)}}for(var l in n.updateCallbacks)if(n.updateCallbacks.hasOwnProperty(l))try{(0,n.updateCallbacks[l])(deepClone$2(n.context),Object.assign({},e.added||{},e.updated||{},e.reset||{}),e.removed,parseInt(l,10),t)}catch(n){this._logger.debug("callback error: "+JSON.stringify(n))}},n.prototype.subscribeToContextDestroyedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_DESTROYED$2,GW_MESSAGE_ACTIVITY_DESTROYED$2];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextDestroyedMessage=function(n){var e,t;if(n.type===GW_MESSAGE_ACTIVITY_DESTROYED$2){if(t=n.activity_id,!(e=this._contextNameToId[t]))return void this._logger.error("Received 'destroyed' for unknown activity: "+n.activity_id)}else if(e=n.context_id,!(t=this._contextIdToName[e]))return void this._logger.error("Received 'destroyed' for unknown context: "+n.context_id);delete this._contextIdToName[e],delete this._contextNameToId[t];var r=this._contextNameToData[t];delete this._contextNameToData[t],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+e)},n.prototype.sendSubscribe=function(n){return n.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT$2,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.sendUnsubscribe=function(n){return n.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT$2,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.calculateContextDeltaV1=function(n,e){var t={added:{},updated:{},removed:[],reset:void 0};if(n)for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];-1===Object.keys(e).indexOf(o)||null===e[o]||deepEqual$2(n[o],e[o])||(t.updated[o]=e[o])}for(var l=0,u=Object.keys(e);l<u.length;l++){o=u[l];n&&-1!==Object.keys(n).indexOf(o)?null===e[o]&&t.removed.push(o):null!==e[o]&&(t.added[o]=e[o])}return t},n.prototype.calculateContextDeltaV2=function(n,e){for(var t,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(e);o<l.length;o++){var u=l[o];if(null!==e[u])deepEqual$2(n?n[u]:null,e[u])||null===(t=i.commands)||void 0===t||t.push({type:"set",path:u,value:e[u]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:u})}return i},n}(),ContextsModule$2=function(){function n(n){this._bridge=new GW3Bridge$3(n)}return n.prototype.all=function(){return this._bridge.all()},n.prototype.update=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.update(n,e)},n.prototype.set=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.set(n,e)},n.prototype.setPath=function(n,e,t){return this.checkName(n),this.checkPath(e),""===e?(this.checkData(t),this.set(n,t)):this._bridge.setPath(n,e,t)},n.prototype.setPaths=function(n,e){if(this.checkName(n),!Array.isArray(e))throw new Error("Please provide the paths as an array of PathValues!");for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(n,e)},n.prototype.subscribe=function(n,e){var t=this;if(this.checkName(n),"function"!=typeof e)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(n,(function(n,r,i,o,l){return e(n,r,i,(function(){return t._bridge.unsubscribe(o)}),l)})).then((function(n){return function(){t._bridge.unsubscribe(n)}}))},n.prototype.get=function(n){return this.checkName(n),this._bridge.get(n)},n.prototype.ready=function(){return Promise.resolve(this)},n.prototype.destroy=function(n){return this.checkName(n),this._bridge.destroy(n)},Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),n.prototype.checkName=function(n){if("string"!=typeof n||""===n)throw new Error("Please provide the name as a non-empty string!")},n.prototype.checkPath=function(n){if("string"!=typeof n)throw new Error("Please provide the path as a dot delimited string!")},n.prototype.checkData=function(n){if("object"!=typeof n)throw new Error("Please provide the data as an object!")},n}(),InvokeStatus$2;function promisify$4(n,e,t){return"function"!=typeof e&&"function"!=typeof t?n:("function"!=typeof e?e=function(){}:"function"!=typeof t&&(t=function(){}),n.then(e,t))}function rejectAfter$2(n,e,t){var r;return void 0===n&&(n=0),e.finally((function(){r&&clearTimeout(r)})),new Promise((function(e,i){r=setTimeout((function(){return i(t)}),n)}))}!function(n){n[n.Success=0]="Success",n[n.Error=1]="Error"}(InvokeStatus$2||(InvokeStatus$2={}));var Client$2=function(){function n(n,e,t,r){this.protocol=n,this.repo=e,this.instance=t,this.configuration=r}return n.prototype.subscribe=function(n,e,t,r,i){var o=this,l=function(n,t,r,l){var u;e.methodResponseTimeout=null!==(u=e.methodResponseTimeout)&&void 0!==u?u:e.waitTimeoutMs,o.protocol.client.subscribe(t,e,n,r,l,i)};return promisify$4(new Promise((function(t,r){var i,u=function(n){t(n)},s=function(n){r(n)};if(n)if((i="string"==typeof n?{name:n}:n).name){void 0===e&&(e={});var a=e.target;if(void 0===a&&(a="best"),"string"!=typeof a||"all"===a||"best"===a){void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=e.method_response_timeout,void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=e.wait_for_method_timeout,void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,d=o.getServerMethodsByFilterAndTarget(i,a);if(d.length>0)l(d,d[0].methods[0],u,s);else{var h=function(){if(a&&e.waitTimeoutMs)if(c+=500,(d=o.getServerMethodsByFilterAndTarget(i,a)).length>0){var t=d[0].methods[0];l(d,t,u,s)}else if(c>=e.waitTimeoutMs){l(d,"string"==typeof n?{name:n}:n,u,s)}else setTimeout(h,500)};setTimeout(h,500)}}else r(new Error('"'+a+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")})),t,r)},n.prototype.servers=function(n){var e=void 0===n?void 0:__assign$1$2({},n);return this.getServers(e).map((function(n){return n.server.instance}))},n.prototype.methods=function(n){return n="string"==typeof n?{name:n}:__assign$1$2({},n),this.getMethods(n)},n.prototype.methodsForInstance=function(n){return this.getMethodsForInstance(n)},n.prototype.methodAdded=function(n){return this.repo.onMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.repo.onMethodRemoved(n)},n.prototype.serverAdded=function(n){return this.repo.onServerAdded(n)},n.prototype.serverRemoved=function(n){return this.repo.onServerRemoved((function(e,t){n(e,t)}))},n.prototype.serverMethodAdded=function(n){return this.repo.onServerMethodAdded((function(e,t){n({server:e,method:t})}))},n.prototype.serverMethodRemoved=function(n){return this.repo.onServerMethodRemoved((function(e,t){n({server:e,method:t})}))},n.prototype.invoke=function(n,e,t,r,i,o){return __awaiter$1$1$1(this,void 0,void 0,(function(){var l=this;return __generator$3(this,(function(u){return[2,promisify$4(function(){return __awaiter$1$1$1(l,void 0,void 0,(function(){var i,o,l,u,s,a,c,d,h,f,p=this;return __generator$3(this,(function(g){switch(g.label){case 0:if(!(i="string"==typeof n?{name:n}:__assign$1$2({},n)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(e||(e={}),t||(t="best"),"string"==typeof t&&"all"!==t&&"best"!==t&&"skipMine"!==t)return[2,Promise.reject(new Error('"'+t+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!=typeof e)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,t)).length)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,t,r)];case 2:return o=g.sent(),[3,4];case 3:return g.sent(),l=__assign$1$2(__assign$1$2({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[]}),u={method:l,called_with:e,message:"Can not find a method matching "+JSON.stringify(n)+" with server filter "+JSON.stringify(t),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(u)];case 4:return s=r.methodResponseTimeoutMs,a=r,c=o.map((function(n){var t=shortid$3(),r=n.methods[0],i=n.server,o=p.protocol.client.invoke(t,r,e,i,a);return Promise.race([o,rejectAfter$2(s,o,{invocationId:t,message:"Invocation timeout ("+s+" ms) reached for method name: "+(null==r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(a),status:InvokeStatus$2.Error})])})),[4,Promise.all(c)];case 5:return d=g.sent(),h=this.getInvocationResultObj(d,i,e),d.every((function(n){return n.status===InvokeStatus$2.Error}))?[2,Promise.reject(h)]:[2,h]}}))}))}(),i,o)]}))}))},n.prototype.getInvocationResultObj=function(n,e,t){var r=n.filter((function(n){return n.status===InvokeStatus$2.Success})).reduce((function(n,r){return n=__spreadArrays$2(n,[{executed_by:r.instance,returned:r.result,called_with:t,method:e,message:r.message,status:r.status}])}),[]),i=n.filter((function(n){return n.status===InvokeStatus$2.Error})).reduce((function(n,r){return n=__spreadArrays$2(n,[{executed_by:r.instance,called_with:t,name:e.name,message:r.message}])}),[]),o=n[0];return{method:e,called_with:t,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},n.prototype.tryToAwaitForMethods=function(n,e,t){var r=this;return new Promise((function(i,o){if(0!==t.waitTimeoutMs)var l=0,u=setInterval((function(){l+=500;var s=r.getServerMethodsByFilterAndTarget(n,e);if(s.length>0)clearInterval(u),i(s);else if(l>=(t.waitTimeoutMs||1e4))return clearInterval(u),void o()}),500);else o()}))},n.prototype.filterByTarget=function(n,e){var t=this;if("string"!=typeof n){return(Array.isArray(n)?n:[n]).reduce((function(n,r){var i=e.filter((function(n){return t.instanceMatch(r,n.server.instance)}));return n.concat(i)}),[])}if("all"===n)return __spreadArrays$2(e);if("best"===n){var r=e.find((function(n){return n.server.instance.isLocal}));if(r)return[r];if(void 0!==e[0])return[e[0]]}else if("skipMine"===n)return e.filter((function(n){return n.server.instance.peerId!==t.instance.peerId}));return[]},n.prototype.instanceMatch=function(n,e){return this.containsProps(n,e)},n.prototype.methodMatch=function(n,e){return this.containsProps(n,e)},n.prototype.containsProps=function(n,e){return Object.keys(n).filter((function(e){return void 0!==n[e]&&"function"!=typeof n[e]&&"object_types"!==e&&"display_name"!==e&&"id"!==e&&"gatewayId"!==e&&"identifier"!==e&&"_"!==e[0]})).reduce((function(t,r){var i=n[r],o=e[r];if("objectTypes"===r){(i.length>o.length||!1===function(n,e){var t=n.reduce((function(n,e){return n[e]=!1,n}),{});e.forEach((function(n){void 0!==t[n]&&(t[n]=!0)}));return Object.keys(t).reduce((function(n,e){return t[e]||(n=!1),n}),!0)}(i,o))&&(t=!1)}else String(i).toLowerCase()!==String(o).toLowerCase()&&(t=!1);return t}),!0)},n.prototype.getMethods=function(n){var e=this;return void 0===n?this.repo.getMethods():this.repo.getMethods().filter((function(t){return e.methodMatch(n,t)}))},n.prototype.getMethodsForInstance=function(n){var e=this,t=this.repo.getServers().filter((function(t){return e.instanceMatch(n,t.instance)}));if(0===t.length)return[];var r={};return 1===t.length?r=t[0].methods:t.forEach((function(n){Object.keys(n.methods).forEach((function(e){var t=n.methods[e];r[t.identifier]=t}))})),Object.keys(r).map((function(n){return r[n]}))},n.prototype.getServers=function(n){var e=this,t=this.repo.getServers();return void 0===n?t.map((function(n){return{server:n,methods:[]}})):t.reduce((function(t,r){var i=e.repo.getServerMethodsById(r.id).filter((function(t){return e.methodMatch(n,t)}));return i.length>0&&t.push({server:r,methods:i}),t}),[])},n.prototype.getServerMethodsByFilterAndTarget=function(n,e){var t=this.getServers(n);return this.filterByTarget(e,t)},n}(),ServerSubscription$2=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.subscription=t}return Object.defineProperty(n.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),n.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},n.prototype.push=function(n){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,n)},n}(),Request$2=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.requestContext=t,this.arguments=t.arguments,this.instance=t.instance}return n.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},n.prototype.acceptOnBranch=function(n){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,n)},n.prototype.reject=function(n){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,n)},n}(),ServerStreaming$3=function(){function n(n,e){var t=this;this.protocol=n,this.server=e,n.server.onSubRequest((function(n,e){return t.handleSubRequest(n,e)})),n.server.onSubAdded((function(n,e){return t.handleSubAdded(n,e)})),n.server.onSubRemoved((function(n,e){return t.handleSubRemoved(n,e)}))}return n.prototype.handleSubRequest=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRequestHandler){var t=new Request$2(this.protocol,e,n);e.streamCallbacks.subscriptionRequestHandler(t)}},n.prototype.handleSubAdded=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionAddedHandler){var t=new ServerSubscription$2(this.protocol,e,n);e.streamCallbacks.subscriptionAddedHandler(t)}},n.prototype.handleSubRemoved=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRemovedHandler){var t=new ServerSubscription$2(this.protocol,e,n);e.streamCallbacks.subscriptionRemovedHandler(t)}},n}(),ServerBranch$2=function(){function n(n,e,t){this.key=n,this.protocol=e,this.repoMethod=t}return n.prototype.subscriptions=function(){var n=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(e){return new ServerSubscription$2(n.protocol,n.repoMethod,e)}))},n.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},n.prototype.push=function(n){this.protocol.server.pushData(this.repoMethod,n,[this.key])},n}(),ServerStream$2=function(){function n(n,e,t){this._protocol=n,this._repoMethod=e,this._server=t,this.name=this._repoMethod.definition.name}return n.prototype.branches=function(n){var e=this,t=this._protocol.server.getBranchList(this._repoMethod);return n?t.indexOf(n)>-1?new ServerBranch$2(n,this._protocol,this._repoMethod):void 0:t.map((function(n){return new ServerBranch$2(n,e._protocol,e._repoMethod)}))},n.prototype.branch=function(n){return this.branches(n)},n.prototype.subscriptions=function(){var n=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(e){return new ServerSubscription$2(n._protocol,n._repoMethod,e)}))},Object.defineProperty(n.prototype,"definition",{get:function(){var n=this._repoMethod.definition;return{accepts:n.accepts,description:n.description,displayName:n.displayName,name:n.name,objectTypes:n.objectTypes,returns:n.returns,supportsStreaming:n.supportsStreaming}},enumerable:!0,configurable:!0}),n.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},n.prototype.push=function(n,e){if("string"!=typeof e&&!Array.isArray(e)&&void 0!==e)throw new Error("invalid branches should be string or string array");if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,n,e)},n.prototype.updateRepoMethod=function(n){this._repoMethod=n},n}(),Server$2=function(){function n(n,e){this.protocol=n,this.serverRepository=e,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming$3(n,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return n.prototype.createStream=function(n,e,t,r,i){var o=this;return promisify$4(new Promise((function(t,r){if(n){var l;if(!(l="string"==typeof n?{name:""+n}:__assign$1$2({},n)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: "+JSON.stringify(l));if(o.serverRepository.getList().some((function(n){return n.definition.name===l.name})))return r('A stream with the name "'+l.name+'" already exists! Please, provide a unique name for the stream.');l.supportsStreaming=!0,e||(e={}),"function"!=typeof e.subscriptionRequestHandler&&(e.subscriptionRequestHandler=function(n){n.accept()});var u=o.serverRepository.add({definition:l,streamCallbacks:e,protocolState:{}});o.protocol.server.createStream(u).then((function(){var n;i?(n=i,i.updateRepoMethod(u)):n=new ServerStream$2(o.protocol,u,o),u.stream=n,t(n)})).catch((function(n){u.repoId&&o.serverRepository.remove(u.repoId),r(n)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")})),t,r)},n.prototype.register=function(n,e){var t=this;if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var r=function(n,r){return __awaiter$1$1$1(t,void 0,void 0,(function(){var t,i,o;return __generator$3(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(t=e(n.args,n.instance))&&"function"==typeof t.then?[4,t]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,t),l.label=3;case 3:return[3,5];case 4:return(o=l.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=e,this.registerCore(n,r)},n.prototype.registerAsync=function(n,e){if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var t=function(n,t){try{var r=!1,i=function(n){r||t(void 0,n),r=!0},o=function(n){r||(n||(n=""),t(n,n)),r=!0},l=e(n.args,n.instance,i,o);l&&"function"==typeof l.then&&l.then(i).catch(o)}catch(n){t(n,void 0)}};return t.userCallbackAsync=e,this.registerCore(n,t)},n.prototype.unregister=function(n,e){return void 0===e&&(e=!1),__awaiter$1$1$1(this,void 0,void 0,(function(){var t,r;return __generator$3(this,(function(i){switch(i.label){case 0:return void 0===n?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof n?[3,2]:[4,this.unregisterWithPredicate(n,e)];case 1:return i.sent(),[2];case 2:return void 0===(t="string"==typeof n?{name:n}:n).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(n){return n.definition.name===t.name&&(n.definition.supportsStreaming||!1)===e})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+t.name+'" does not exist or is not registered by your application!')];case 3:return i.sent(),[2]}}))}))},n.prototype.unregisterWithPredicate=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t;return __generator$3(this,(function(r){switch(r.label){case 0:return(t=this.serverRepository.getList().filter((function(e){return n(e.definition)})).filter((function(n){return(n.definition.supportsStreaming||!1)===e})))&&0!==t.length?[4,this.removeMethodsOrStreams(t)]:[2,Promise.reject("Could not find a "+(e?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},n.prototype.removeMethodsOrStreams=function(n){var e=this,t=[];return n.forEach((function(n){var r=e.protocol.server.unregister(n).then((function(){n.repoId&&e.serverRepository.remove(n.repoId)}));t.push(r),e.addAsCurrentlyUnregistering(n.definition.name,r)})),Promise.all(t)},n.prototype.addAsCurrentlyUnregistering=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t,r=this;return __generator$3(this,(function(i){return t=new Promise((function(n){return setTimeout(n,5e3)})),this.currentlyUnregistering[n]=Promise.race([e,t]).then((function(){delete r.currentlyUnregistering[n]})),[2]}))}))},n.prototype.registerCore=function(n,e){return __awaiter$1$1$1(this,void 0,void 0,(function(){var t,r,i,o=this;return __generator$3(this,(function(l){switch(l.label){case 0:return(t="string"==typeof n?{name:""+n}:__assign$1$2({},n)).name?(r=this.currentlyUnregistering[t.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: "+JSON.stringify(n))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(n){return n.definition.name===t.name}))?[2,Promise.reject('A method with the name "'+t.name+'" already exists! Please, provide a unique name for the method.')]:t.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want "+t.name+" to be a stream, please use the glue.interop.createStream() method.")]:(i=this.serverRepository.add({definition:t,theFunction:e,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(n){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),n}))])}}))}))},n.prototype.onMethodInvoked=function(n,e,t){var r=this;n&&n.theFunction&&n.theFunction(t,(function(t,i){if(null!=t)if(t.message&&"string"==typeof t.message)t=t.message;else if("string"!=typeof t)try{t=JSON.stringify(t)}catch(n){t="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(t)}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(n,e,t,i)}))},n}(),InstanceWrapper$2=function(){function n(n,e){var t=this;this.wrapped={getMethods:getMethods$2,getStreams:getStreams$2},n&&this.refreshWrappedObject(n),e&&(e.loggedIn((function(){t.refresh(e)})),this.refresh(e))}return n.prototype.unwrap=function(){return this.wrapped},n.prototype.refresh=function(n){if(n){var e=null==n?void 0:n.resolvedIdentity,t=Object.assign({},null!=e?e:{},{peerId:null==n?void 0:n.peerId});this.refreshWrappedObject(t)}},n.prototype.refreshWrappedObject=function(n){var e,t,r;this.wrapped.user=n.user,this.wrapped.instance=n.instance,this.wrapped.application=null!==(e=n.application)&&void 0!==e?e:shortid$3(),this.wrapped.applicationName=n.applicationName,this.wrapped.pid=null!==(r=null!==(t=n.pid)&&void 0!==t?t:n.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=n.machine,this.wrapped.environment=n.environment,this.wrapped.region=n.region,this.wrapped.windowId=n.windowId,this.wrapped.isLocal=!0,this.wrapped.api=n.api,this.wrapped.service=n.service,this.wrapped.peerId=n.peerId},n}();function getMethods$2(){var n;return null===(n=InstanceWrapper$2.API)||void 0===n?void 0:n.methodsForInstance(this)}function getStreams$2(){var n;return null===(n=InstanceWrapper$2.API)||void 0===n?void 0:n.methodsForInstance(this).filter((function(n){return n.supportsStreaming}))}var ClientRepository$2=function(){function n(n){this.logger=n,this.servers={},this.methodsCount={},this.callbacks=lib$1$2()}return n.prototype.addServer=function(n,e){this.logger.debug("adding server "+e);var t=this.servers[e];if(t)return t.id;var r=new InstanceWrapper$2(n),i={id:e,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[e]=i,this.callbacks.execute("onServerAdded",i.instance),e},n.prototype.removeServerById=function(n,e){var t=this,r=this.servers[n];r?(this.logger.debug("removing server "+n),Object.keys(r.methods).forEach((function(e){t.removeServerMethod(n,e)})),delete this.servers[n],this.callbacks.execute("onServerRemoved",r.instance,e)):this.logger.warn("not aware of server "+n+", my state "+JSON.stringify(Object.keys(this.servers)))},n.prototype.addServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");if(!t.methods[e.id]){var r=this.createMethodIdentifier(e),i=this,o={identifier:r,gatewayId:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types||[],accepts:e.input_signature,returns:e.result_signature,supportsStreaming:void 0!==e.flags&&e.flags.streaming,getServers:function(){return i.getServersByMethod(r)}};return o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,t.methods[e.id]=o,this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",o)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",t.instance,o),o}},n.prototype.removeServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");var r=t.methods[e];delete t.methods[e],this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",t.instance,r)},n.prototype.getMethods=function(){var n=this,e={};return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];Object.keys(r.methods).forEach((function(n){var t=r.methods[n];e[t.identifier]=t}))})),Object.keys(e).map((function(n){return e[n]}))},n.prototype.getServers=function(){var n=this,e=[];return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];e.push(r)})),e},n.prototype.getServerMethodsById=function(n){var e=this.servers[n];return Object.keys(e.methods).map((function(n){return e.methods[n]}))},n.prototype.onServerAdded=function(n){var e=this.callbacks.add("onServerAdded",n),t=this.getServers().map((function(n){return n.instance}));return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onMethodAdded=function(n){var e=this.callbacks.add("onMethodAdded",n),t=this.getMethods();return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onServerMethodAdded=function(n){var e=this.callbacks.add("onServerMethodAdded",n),t=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(e){var r=e.methods;Object.keys(r).forEach((function(i){t||n(e.instance,r[i])}))}))}),0),function(){t=!0,e()}},n.prototype.onMethodRemoved=function(n){return this.callbacks.add("onMethodRemoved",n)},n.prototype.onServerRemoved=function(n){return this.callbacks.add("onServerRemoved",n)},n.prototype.onServerMethodRemoved=function(n){return this.callbacks.add("onServerMethodRemoved",n)},n.prototype.getServerById=function(n){return this.servers[n]},n.prototype.reset=function(){var n=this;Object.keys(this.servers).forEach((function(e){n.removeServerById(e,"reset")})),this.servers={},this.methodsCount={}},n.prototype.createMethodIdentifier=function(n){var e=void 0!==n.input_signature?n.input_signature:"",t=void 0!==n.result_signature?n.result_signature:"";return(n.name+e+t).toLowerCase()},n.prototype.getServersByMethod=function(n){var e=this,t=[];return Object.keys(this.servers).forEach((function(r){var i=e.servers[r];Object.keys(i.methods).forEach((function(e){i.methods[e].identifier===n&&t.push(i.instance)}))})),t},n.prototype.returnUnsubWithDelayedReplay=function(n,e,t){var r=!1;return setTimeout((function(){e.forEach((function(n){r||t(n)}))}),0),function(){r=!0,n()}},n}(),ServerRepository$2=function(){function n(){this.nextId=0,this.methods=[]}return n.prototype.add=function(n){return n.repoId=String(this.nextId),this.nextId+=1,this.methods.push(n),n},n.prototype.remove=function(n){if("string"!=typeof n)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(e){return e.repoId!==n}))},n.prototype.getById=function(n){if("string"==typeof n)return this.methods.find((function(e){return e.repoId===n}))},n.prototype.getList=function(){return this.methods.map((function(n){return n}))},n.prototype.length=function(){return this.methods.length},n.prototype.reset=function(){this.methods=[]},n}(),SUBSCRIPTION_REQUEST$2="onSubscriptionRequest",SUBSCRIPTION_ADDED$2="onSubscriptionAdded",SUBSCRIPTION_REMOVED$2="onSubscriptionRemoved",ServerStreaming$1$2=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.serverRepository=t,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib$1$2(),this.nextStreamId=0,n.on("add-interest",(function(n){r.handleAddInterest(n)})),n.on("remove-interest",(function(n){r.handleRemoveInterest(n)}))}return n.prototype.acceptRequestOnBranch=function(n,e,t){if("string"!=typeof t&&(t=""),"object"!=typeof e.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(e.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(e,t),i=n.msg.subscription_id,o={id:i,arguments:n.arguments,instance:n.instance,branchKey:t,streamId:r,subscribeMsg:n.msg};e.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED$2,o,e)},n.prototype.rejectRequest=function(n,e,t){"string"!=typeof t&&(t=""),this.sendSubscriptionFailed("Subscription rejected by user. "+t,n.msg.subscription_id)},n.prototype.pushData=function(n,e,t){var r=this;if("object"==typeof n&&Array.isArray(n.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof t?t=[t]:(!Array.isArray(t)||t.length<=0)&&(t=[]),n.protocolState.branchKeyToStreamIdMap.filter((function(n){return!t||0===t.length||t.indexOf(n.key)>=0})).map((function(n){return n.streamId})).forEach((function(n){var t={type:"publish",stream_id:n,data:e};r.session.sendFireAndForget(t)}))}},n.prototype.pushDataToSingle=function(n,e,t){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:e.id,data:t};this.session.sendFireAndForget(r)},n.prototype.closeSingleSubscription=function(n,e){n.protocolState.subscriptionsMap&&delete n.protocolState.subscriptionsMap[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(t);e.instance;this.callbacks.execute(SUBSCRIPTION_REMOVED$2,e,n)},n.prototype.closeMultipleSubscriptions=function(n,e){var t=this;if("object"==typeof n&&"object"==typeof n.protocolState.subscriptionsMap&&n.protocolState.subscriptionsMap){var r=n.protocolState.subscriptionsMap,i=Object.keys(r).map((function(n){return r[n]}));"string"==typeof e&&(i=i.filter((function(n){return n.branchKey===e}))),i.forEach((function(n){delete r[n.id];var e={type:"drop-subscription",subscription_id:n.id,reason:"Server dropping all subscriptions on stream_id: "+n.streamId};t.session.sendFireAndForget(e)}))}},n.prototype.getSubscriptionList=function(n,e){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var t=n.protocolState.subscriptionsMap,r=Object.keys(t).map((function(n){return t[n]}));return"string"!=typeof e?r:r.filter((function(n){return n.branchKey===e}))},n.prototype.getBranchList=function(n){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var e=n.protocolState.subscriptionsMap,t=Object.keys(e).map((function(n){return e[n]})),r=[];return t.forEach((function(n){var e="";"object"==typeof n&&"string"==typeof n.branchKey&&(e=n.branchKey),-1===r.indexOf(e)&&r.push(e)})),r},n.prototype.onSubAdded=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED$2,n)},n.prototype.onSubRequest=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST$2,n)},n.prototype.onSubRemoved=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED$2,n)},n.prototype.handleRemoveInterest=function(n){var e=this.serverRepository.getById(n.method_id);if("string"==typeof n.subscription_id&&"object"==typeof e&&e.protocolState.subscriptionsMap&&"object"==typeof e.protocolState.subscriptionsMap[n.subscription_id]){var t=e.protocolState.subscriptionsMap[n.subscription_id];delete e.protocolState.subscriptionsMap[n.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED$2,t,e)}},n.prototype.onSubscriptionLifetimeEvent=function(n,e){this.callbacks.add(n,e)},n.prototype.getNextStreamId=function(){return this.nextStreamId+++""},n.prototype.handleAddInterest=function(n){var e=this.repository.getServerById(n.caller_id).instance,t={msg:n,arguments:n.arguments_kv||{},instance:e},r=this.serverRepository.getById(n.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[n.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+n.subscription_id+" already exists.",n.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST$2,t,r);else{var i="No method with id "+n.method_id+" on this server.";this.sendSubscriptionFailed(i,n.subscription_id)}},n.prototype.sendSubscriptionFailed=function(n,e){var t={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:n,request_id:e};this.session.sendFireAndForget(t)},n.prototype.getStreamId=function(n,e){if("string"!=typeof e&&(e=""),!n.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+n.definition.name+" method without protocol state");var t=n.protocolState.branchKeyToStreamIdMap.filter((function(n){return n.key===e}))[0],r=t?t.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),n.protocolState.branchKeyToStreamIdMap.push({key:e,streamId:r})),r},n}(),ServerProtocol$2=function(){function n(n,e,t,r){var i=this;this.session=n,this.clientRepository=e,this.serverRepository=t,this.logger=r,this.callbacks=lib$1$2(),this.streaming=new ServerStreaming$1$2(n,e,t),this.session.on("invoke",(function(n){return i.handleInvokeMessage(n)}))}return n.prototype.createStream=function(n){return n.protocolState.subscriptionsMap={},n.protocolState.branchKeyToStreamIdMap=[],this.register(n,!0)},n.prototype.register=function(n,e){var t=this,r=n.definition,i={streaming:e||!1},o={type:"register",methods:[{id:n.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:i,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(o,{methodId:n.repoId}).then((function(){t.logger.debug("registered method "+n.definition.name+" with id "+n.repoId)})).catch((function(e){throw t.logger.warn("failed to register method "+n.definition.name+" with id "+n.repoId+" - "+JSON.stringify(e)),e}))},n.prototype.onInvoked=function(n){this.callbacks.add("onInvoked",n)},n.prototype.methodInvocationResult=function(n,e,t,r){var i;i=t||""===t?{type:"error",request_id:e,reason_uri:"agm.errors.client_error",reason:t,context:r,peer_id:void 0}:{type:"yield",invocation_id:e,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},n.prototype.unregister=function(n){return __awaiter$1$1$1(this,void 0,void 0,(function(){var e;return __generator$3(this,(function(t){switch(t.label){case 0:return e={type:"unregister",methods:[n.repoId]},[4,this.session.send(e)];case 1:return t.sent(),[2]}}))}))},n.prototype.getBranchList=function(n){return this.streaming.getBranchList(n)},n.prototype.getSubscriptionList=function(n,e){return this.streaming.getSubscriptionList(n,e)},n.prototype.closeAllSubscriptions=function(n,e){this.streaming.closeMultipleSubscriptions(n,e)},n.prototype.pushData=function(n,e,t){this.streaming.pushData(n,e,t)},n.prototype.pushDataToSingle=function(n,e,t){this.streaming.pushDataToSingle(n,e,t)},n.prototype.closeSingleSubscription=function(n,e){this.streaming.closeSingleSubscription(n,e)},n.prototype.acceptRequestOnBranch=function(n,e,t){this.streaming.acceptRequestOnBranch(n,e,t)},n.prototype.rejectRequest=function(n,e,t){this.streaming.rejectRequest(n,e,t)},n.prototype.onSubRequest=function(n){this.streaming.onSubRequest(n)},n.prototype.onSubAdded=function(n){this.streaming.onSubAdded(n)},n.prototype.onSubRemoved=function(n){this.streaming.onSubRemoved(n)},n.prototype.handleInvokeMessage=function(n){var e=n.invocation_id,t=n.caller_id,r=n.method_id,i=n.arguments_kv,o=this.serverRepository.getList().filter((function(n){return n.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(t).instance};this.callbacks.execute("onInvoked",o,e,l)}},n}(),UserSubscription$2=function(){function n(n,e){this.repository=n,this.subscriptionData=e}return Object.defineProperty(n.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"servers",{get:function(){var n=this;return this.subscriptionData.trackedServers.filter((function(n){return n.subscriptionId})).map((function(e){return n.repository.getServerById(e.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),n.prototype.onData=function(n){if("function"!=typeof n)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(n),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(e){n(e)}))},n.prototype.onClosed=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(n)},n.prototype.onFailed=function(n){},n.prototype.onConnected=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(n)},n.prototype.close=function(){this.subscriptionData.close()},n.prototype.setNewSubscription=function(n){this.subscriptionData=n},n}(),STATUS_AWAITING_ACCEPT$2="awaitingAccept",STATUS_SUBSCRIBED$2="subscribed",ERR_MSG_SUB_FAILED$2="Subscription failed.",ERR_MSG_SUB_REJECTED$2="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT$2="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT$2="ClientInitiated",ClientStreaming$2=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(n){var e=n._tag,t=e.subLocalKey,i=r.subscriptionsList[t];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(n){return n.serverId!==e.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT$2){var o="string"==typeof n.reason&&""!==n.reason?' Publisher said "'+n.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED$2+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED$2&&r.callOnClosedHandlers(i);delete r.subscriptionsList[t]}},this.handleSubscribed=function(n){var e=n._tag.subLocalKey,t=r.subscriptionsList[e];if("object"==typeof t){var i=n._tag.serverId,o=t.trackedServers.filter((function(n){return n.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=n.subscription_id,r.subscriptionIdToLocalKeyMap[n.subscription_id]=e;var l=t.status===STATUS_AWAITING_ACCEPT$2;if(t.status=STATUS_SUBSCRIBED$2,l){var u=!1,s=t.subscription;s?(s.setNewSubscription(t),t.success(s),u=!0):(s=new UserSubscription$2(r.repository,t),t.subscription=s,t.success(s));for(var a=0,c=t.handlers.onConnected;a<c.length;a++){var d=c[a];try{d(s.serverInstance,u)}catch(n){}}}}}},this.handleEventData=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.filter((function(e){return e.subscriptionId===n.subscription_id}));if(1===i.length){var o=n.oob,l=i[0].serverId,u=function(){return{data:n.data,server:r.repository.getServerById(l).instance,requestArguments:t.params.arguments,message:void 0,private:o}},s=t.handlers.onData,a=t.queued.data;s.length>0?s.forEach((function(n){"function"==typeof n&&n(u())})):a.push(u())}}}},this.handleSubscriptionCancelled=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.length-1;t.trackedServers=t.trackedServers.filter((function(e){return e.subscriptionId!==n.subscription_id||(t.queued.closers.push(e.serverId),!1)})),t.trackedServers.length===i&&(t.trackedServers.length<=0&&(clearTimeout(t.timeoutId),r.callOnClosedHandlers(t),delete r.subscriptionsList[e]),delete r.subscriptionIdToLocalKeyMap[n.subscription_id])}}},n.on("subscribed",this.handleSubscribed),n.on("event",this.handleEventData),n.on("subscription-cancelled",this.handleSubscriptionCancelled)}return n.prototype.subscribe=function(n,e,t,r,i,o){var l=this;if(0!==t.length){var u=this.getNextSubscriptionLocalKey(),s=this.registerSubscription(u,n,e,r,i,e.methodResponseTimeout||1e4,o);"object"==typeof s?t.forEach((function(t){var r=t.server.id,i=t.methods.find((function(e){return e.name===n.name}));if(i){s.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:e.arguments};l.session.send(o,{serverId:r,subLocalKey:u}).then((function(n){return l.handleSubscribed(n)})).catch((function(n){return l.handleErrorSubscribing(n)}))}else l.logger.error("can not find method "+n.name+" for target "+t.server.id)})):i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$2+" Unable to register the user callbacks."})}else i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$2+" No available servers matched the target params."})},n.prototype.drainSubscriptions=function(){var n=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},n},n.prototype.getNextSubscriptionLocalKey=function(){var n=this.nextSubLocalKey;return this.nextSubLocalKey+=1,n},n.prototype.registerSubscription=function(n,e,t,r,i,o,l){var u=this,s={localKey:n,status:STATUS_AWAITING_ACCEPT$2,method:e,params:t,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return u.closeSubscription(n)},subscription:null==l?void 0:l.subscription};return l||(t.onData&&s.handlers.onData.push(t.onData),t.onClosed&&s.handlers.onClosed.push(t.onClosed),t.onConnected&&s.handlers.onConnected.push(t.onConnected)),this.subscriptionsList[n]=s,s.timeoutId=setTimeout((function(){if(void 0!==u.subscriptionsList[n]){var r=u.subscriptionsList[n];r.status===STATUS_AWAITING_ACCEPT$2?(i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED$2+" Subscription attempt timed out after "+o+" ms."}),delete u.subscriptionsList[n]):r.status===STATUS_SUBSCRIBED$2&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(n){return void 0!==n.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(u.callOnClosedHandlers(r),delete u.subscriptionsList[n]))}}),o),s},n.prototype.callOnClosedHandlers=function(n,e){var t,r=n.queued.closers.length,i=r>0?n.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(t=this.repository.getServerById(i).instance),n.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:e||ON_CLOSE_MSG_SERVER_INIT$2,requestArguments:n.params.arguments||{},server:t,stream:n.method})}))},n.prototype.closeSubscription=function(n){var e=this,t=this.subscriptionsList[n];"object"==typeof t&&(t.trackedServers.forEach((function(n){void 0!==n.subscriptionId&&(t.queued.closers.push(n.serverId),e.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT$2}),delete e.subscriptionIdToLocalKeyMap[n.subscriptionId])})),t.trackedServers=[],this.callOnClosedHandlers(t,ON_CLOSE_MSG_CLIENT_INIT$2),delete this.subscriptionsList[n])},n}(),ClientProtocol$2=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,n.on("peer-added",(function(n){return r.handlePeerAdded(n)})),n.on("peer-removed",(function(n){return r.handlePeerRemoved(n)})),n.on("methods-added",(function(n){return r.handleMethodsAddedMessage(n)})),n.on("methods-removed",(function(n){return r.handleMethodsRemovedMessage(n)})),this.streaming=new ClientStreaming$2(n,e,t)}return n.prototype.subscribe=function(n,e,t,r,i,o){this.streaming.subscribe(n,e,t,r,i,o)},n.prototype.invoke=function(n,e,t,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:e.gatewayId,arguments_kv:t};return this.session.send(l,{invocationId:n,serverId:o}).then((function(n){return i.handleResultMessage(n)})).catch((function(n){return i.handleInvocationError(n)}))},n.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},n.prototype.handlePeerAdded=function(n){var e=n.new_peer_id,t=n.identity,r=!n.meta||n.meta.local,i=Number(t.process),o={machine:t.machine,pid:isNaN(i)?t.process:i,instance:t.instance,application:t.application,applicationName:t.applicationName,environment:t.environment,region:t.region,user:t.user,windowId:t.windowId,peerId:e,api:t.api,isLocal:r};this.repository.addServer(o,e)},n.prototype.handlePeerRemoved=function(n){var e=n.removed_id,t=n.reason;this.repository.removeServerById(e,t)},n.prototype.handleMethodsAddedMessage=function(n){var e=this,t=n.server_id;n.methods.forEach((function(n){e.repository.addServerMethod(t,n)}))},n.prototype.handleMethodsRemovedMessage=function(n){var e=this,t=n.server_id,r=n.methods,i=this.repository.getServerById(t);Object.keys(i.methods).forEach((function(n){var o=i.methods[n];r.indexOf(o.gatewayId)>-1&&e.repository.removeServerMethod(t,n)}))},n.prototype.handleResultMessage=function(n){var e=n._tag.invocationId,t=n.result,r=n._tag.serverId;return{invocationId:e,result:t,instance:this.repository.getServerById(r).instance,status:InvokeStatus$2.Success,message:""}},n.prototype.handleInvocationError=function(n){if(this.logger.debug("handle invocation error "+JSON.stringify(n)),"_tag"in n){var e=n._tag.invocationId,t=n._tag.serverId,r=this.repository.getServerById(t),i=n.reason;return{invocationId:e,result:n.context,instance:r.instance,status:InvokeStatus$2.Error,message:i}}return{invocationId:"",message:n.message,status:InvokeStatus$2.Error,error:n}},n}();function gW3ProtocolFactory$2(n,e,t,r,i,o){var l,u=i.logger.subLogger("gw3-protocol"),s=new Promise((function(n){l=n})),a=e.domain("agm",["subscribed"]),c=new ServerProtocol$2(a,t,r,u.subLogger("server")),d=new ClientProtocol$2(a,t,u.subLogger("client"));return a.onJoined((function(i){t.addServer(n,e.peerId),i?function(){u.info("reconnected - will replay registered methods and subscriptions");for(var n=0,e=d.drainSubscriptions();n<e.length;n++){var t=e[n],i=t.method,l=Object.assign({},t.params);u.info("trying to re-subscribe to method "+i.name),o.client.subscribe(i,l,void 0,void 0,t)}var s=r.getList();r.reset();for(var a=0,c=s;a<c.length;a++){var h=c[a],f=h.definition;u.info("re-publishing method "+f.name),h.stream?o.server.createStream(f,h.streamCallbacks,void 0,void 0,h.stream):h.theFunction&&h.theFunction.userCallback?o.register(f,h.theFunction.userCallback):h.theFunction&&h.theFunction.userCallbackAsync&&o.registerAsync(f,h.theFunction.userCallbackAsync)}}():l&&(l({client:d,server:c}),l=void 0)})),a.onLeft((function(){t.reset()})),a.join(),s}var Interop$2=function(){function n(n){var e=this;if(void 0===n)throw new Error("configuration is required");if(void 0===n.connection)throw new Error("configuration.connections is required");var t,r=n.connection;if("number"!=typeof n.methodResponseTimeout&&(n.methodResponseTimeout=3e4),"number"!=typeof n.waitTimeoutMs&&(n.waitTimeoutMs=3e4),InstanceWrapper$2.API=this,this.instance=new InstanceWrapper$2(void 0,r).unwrap(),this.clientRepository=new ClientRepository$2(n.logger.subLogger("cRep")),this.serverRepository=new ServerRepository$2,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");t=gW3ProtocolFactory$2(this.instance,r,this.clientRepository,this.serverRepository,n,this),this.readyPromise=t.then((function(t){return e.protocol=t,e.client=new Client$2(e.protocol,e.clientRepository,e.instance,n),e.server=new Server$2(e.protocol,e.serverRepository),e}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.serverRemoved=function(n){return this.client.serverRemoved(n)},n.prototype.serverAdded=function(n){return this.client.serverAdded(n)},n.prototype.serverMethodRemoved=function(n){return this.client.serverMethodRemoved(n)},n.prototype.serverMethodAdded=function(n){return this.client.serverMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.client.methodRemoved(n)},n.prototype.methodAdded=function(n){return this.client.methodAdded(n)},n.prototype.methodsForInstance=function(n){return this.client.methodsForInstance(n)},n.prototype.methods=function(n){return this.client.methods(n)},n.prototype.servers=function(n){return this.client.servers(n)},n.prototype.subscribe=function(n,e,t,r){return this.client.subscribe(n,e,t,r)},n.prototype.createStream=function(n,e,t,r){return this.server.createStream(n,e,t,r)},n.prototype.unregister=function(n){return this.server.unregister(n)},n.prototype.registerAsync=function(n,e){return this.server.registerAsync(n,e)},n.prototype.register=function(n,e){return this.server.register(n,e)},n.prototype.invoke=function(n,e,t,r,i,o){return this.client.invoke(n,e,t,r,i,o)},n}(),successMessages$2=["subscribed","success"],MessageBus$2=function(){function n(n,e){var t=this;this.publish=function(n,e,r){var i=r||{},o=i.routingKey,l=i.target,u=t.removeEmptyValues({type:"publish",topic:n,data:e,peer_id:t.peerId,routing_key:o,target_identity:l});t.session.send(u)},this.subscribe=function(n,e,r){return new Promise((function(i,o){var l=r||{},u=l.routingKey,s=l.target,a=t.removeEmptyValues({type:"subscribe",topic:n,peer_id:t.peerId,routing_key:u,source:s});t.session.send(a).then((function(r){var o=r.subscription_id;t.subscriptions.push({subscription_id:o,topic:n,callback:e,source:s}),i({unsubscribe:function(){return t.session.send({type:"unsubscribe",subscription_id:o,peer_id:t.peerId}),t.subscriptions=t.subscriptions.filter((function(n){return n.subscription_id!==o})),Promise.resolve()}})})).catch((function(n){return o(n)}))}))},this.watchOnEvent=function(){t.session.on("event",(function(n){var e=n.data,r=n.subscription_id,i=n["publisher-identity"],o=t.subscriptions.find((function(n){return n.subscription_id===r}));o&&(o.source?t.keysMatch(o.source,i)&&o.callback(e,o.topic,i):o.callback(e,o.topic,i))}))},this.connection=n,this.logger=e,this.peerId=n.peerId,this.subscriptions=[],this.session=n.domain("bus",successMessages$2),this.readyPromise=this.session.join(),this.readyPromise.then((function(){t.watchOnEvent()}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.removeEmptyValues=function(n){var e={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&null!==n[t]&&(e[t]=n[t])})),e},n.prototype.keysMatch=function(n,e){var t=Object.keys(n),r=!0;return t.forEach((function(t){n[t]!==e[t]&&(r=!1)})),r},n}(),GlueCore$2=function(n,e){var t,r=Utils$3.getGDMajorVersion(),i=Promise.resolve();if(r){if(r<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");r>=3&&(t=window.glue42gd,i=window.gdPreloadPromise||i)}var o,l,u,s,a,c,d,h=timer$2("glue"),f=prepareConfig$3(n=n||{},e=e||{},t),p={};function g(n,e,t){(d=u.canPublish("trace"))&&u.trace("registering "+n+" module");var r=function(){e.initTime=t.stop(),e.initEndTime=t.endTime,e.marks=t.marks,d&&u.trace(n+" is ready - "+(t.endTime-t.startTime))};e.initStartTime=t.startTime,e.ready?e.ready().then((function(){r()})):r(),Array.isArray(n)||(n=[n]),n.forEach((function(n){p[n]=e,GlueCore$2[n]=e}))}function w(){var n=timer$2("interop"),e={connection:o,logger:u.subLogger("interop")};return l=new Interop$2(e),Logger$3.Interop=l,g(["interop","agm"],l,n),Promise.resolve()}function v(){var n=f.activities&&3===o.protocolVersion;if(f.contexts||n){var e=timer$2("contexts");return g("contexts",a=new ContextsModule$2({connection:o,logger:u.subLogger("contexts")}),e),a}var t=o.replayer;t&&t.drain(ContextMessageReplaySpec$2.name)}function m(){return __awaiter$1$1$1(this,void 0,void 0,(function(){var n;return __generator$3(this,(function(e){return f.bus?(n=timer$2("bus"),g("bus",c=new MessageBus$2(o,u.subLogger("bus")),n),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function y(n){try{return n.forEach((function(n){!function(n,e){var t=timer$2(n),r=e(p);r&&g(n,r,t)}(n.name,n.create)})),Promise.resolve()}catch(n){return Promise.reject(n)}}return i.then((function(){var n,e=timer$2("logger");return(u=new Logger$3(""+(null===(n=f.connection.identity)||void 0===n?void 0:n.application),void 0,f.customLogger)).consoleLevel(f.logger.console),u.publishLevel(f.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,e),Promise.resolve(void 0)})).then((function(){var n=timer$2("connection");o=new Connection$2(f.connection,u.subLogger("connection"));var e=Promise.resolve(f.auth);return f.connection&&!f.auth&&(e=t?t.getGWToken().then((function(n){return{gatewayToken:n}})):Promise.reject("You need to provide auth information")),e.then((function(e){var t;if(n.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));return t=e,o.login(t)})).then((function(){return g("connection",o,n),f})).catch((function(n){throw o&&o.logout(),n}))})).then((function(){return Promise.all([(l=timer$2("metrics"),a=f.metrics,c=null==t?void 0:t.getMetricsPublishingEnabled,d=f.connection.identity,h=c||function(){return!0},p=null!==(n="boolean"!=typeof a&&a.disableAutoAppSystem)&&void 0!==n&&n,g("metrics",s=metrics$2({connection:a?o:void 0,logger:u.subLogger("metrics"),canUpdateMetric:h,system:"Glue42",service:null!==(e=null==d?void 0:d.service)&&void 0!==e?e:"metrics-service",instance:null!==(i=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==i?i:shortid$3(),disableAutoAppSystem:p,pagePerformanceMetrics:"boolean"!=typeof a?null==a?void 0:a.pagePerformanceMetrics:void 0}),l),Promise.resolve()),w(),v(),m()]);var n,e,r,i,l,a,c,d,h,p})).then((function(){return l.readyPromise})).then((function(){return y(f.libs||[])})).then((function(){var n=Object.keys(p).map((function(n){var e=p[n];return e.ready?e.ready():Promise.resolve()}));return Promise.all(n)})).then((function(){var r={coreVersion:version$5,version:f.version};h.stop();var i={feedback:function(n){l&&l.invoke("T42.ACS.Feedback",n,"best")},info:r,logger:u,interop:l,agm:l,connection:o,metrics:s,contexts:a,bus:c,version:f.version,userConfig:n,done:function(){return null==u||u.info("done called by user..."),o.logout()}};if(i.performance={get glueVer(){return f.version},get glueConfig(){return JSON.stringify(n)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var n=getAllTimers$2();return Object.keys(n).map((function(e){var t=n[e];return{name:e,duration:t.endTime-t.startTime,marks:t.marks}}))}},Object.keys(p).forEach((function(n){var e=p[n];i[n]=e})),i.config={},Object.keys(f).forEach((function(n){i.config[n]=f[n]})),e&&e.extOptions&&Object.keys(e.extOptions).forEach((function(n){i.config[n]=null==e?void 0:e.extOptions[n]})),(null==e?void 0:e.enrichGlue)&&e.enrichGlue(i),t&&t.updatePerfData&&t.updatePerfData(i.performance),i.agm){var d=function(n,e,t){return function(){i.logger.warn("glue.js - 'glue.agm."+e+"' method is deprecated, use 'glue.interop."+t+"' instead."),n.apply(i.agm,arguments)}},g=i.agm;g.method_added=d(i.agm.methodAdded,"method_added","methodAdded"),g.method_removed=d(i.agm.methodRemoved,"method_removed","methodRemoved"),g.server_added=d(i.agm.serverAdded,"server_added","serverAdded"),g.server_method_aded=d(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),g.server_method_removed=d(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(n){return Promise.reject({err:n,libs:p})}))};"undefined"!=typeof window&&(window.GlueCore=GlueCore$2),GlueCore$2.version=version$5,GlueCore$2.default=GlueCore$2;var version$1$2="2.0.1";const glueWebFactory$1=createFactoryFunction$1(GlueCore$2);if("undefined"!=typeof window){const n=window;n.GlueWeb=glueWebFactory$1,delete n.GlueCore}glueWebFactory$1.version=version$1$2;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule$1$1(n,e,t){return n(t={path:e,exports:{},require:function(n,e){return commonjsRequire(n,null==e?t.path:e)}},t.exports),t.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(function(){var aa="cljs.core",ca="cljs.pprint",da="cljs.spec.alpha",ea="cljs.test",fa="cljs.tools.reader",ha="gateway-web.core",ja="gateway.auth.impl",ka="gateway.auth.spec",la="gateway.basic-auth.core",ma="gateway.cljs.authenticators",na="gateway.cljs.common",oa="gateway.cljs.local-client",pa="gateway.common.context.ops",qa="gateway.common.context.spec.messages",ra="gateway.common.context.spec.requests",sa="gateway.common.context.state",ta="gateway.common.spec.messages",va="gateway.common.spec.requests",xa="gateway.domain",ya="gateway.domains.activity.activities",za="gateway.domains.activity.core",Aa="gateway.domains.agm.core",Ba="gateway.domains.agm.spec.messages",Ca="gateway.domains.agm.spec.register",Da="gateway.domains.agm.spec.requests",Ea="gateway.domains.agm.spec.unregister",Fa="gateway.domains.agm.subscriptions",Ga="gateway.domains.bus.core",Ha="gateway.domains.context.core",Ia="gateway.domains.global.core",Ja="gateway.domains.global.internal",Ka="gateway.domains.global.spec.messages",La="gateway.domains.global.spec.requests",Ma="gateway.domains.global.state",Na="gateway.domains.metrics.core",Oa="gateway.local-node.core",Pa="gateway.node",Qa="gateway.state.spec.activity",Ra="gateway.state.spec.agm",Sa="gateway.state.spec.bus",Ta="gateway.state.spec.common",Ua="gateway.state.spec.context",Va="gateway.state.spec.domain-registry",Wa="gateway.state.spec.factory",Xa="gateway.state.spec.mthds",Ya="gateway.state.spec.pending-requests",Za="gateway.state.spec.restrictions",$a="gateway.state.spec.state",ab="gateway.state.spec.tokens",bb="instaparse.gll",g,cb=this||self;function db(n){var e=typeof n;if("object"==e){if(!n)return"null";if(n instanceof Array)return"array";if(n instanceof Object)return e;var t=Object.prototype.toString.call(n);if("[object Window]"==t)return"object";if("[object Array]"==t||"number"==typeof n.length&&void 0!==n.splice&&void 0!==n.propertyIsEnumerable&&!n.propertyIsEnumerable("splice"))return"array";if("[object Function]"==t||void 0!==n.call&&void 0!==n.propertyIsEnumerable&&!n.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===n.call)return"object";return e}function eb(n){var e=db(n);return"array"==e||"object"==e&&"number"==typeof n.length}function fb(n){return"function"==db(n)}function hb(n){return n[jb]||(n[jb]=++kb)}var jb="closure_uid_"+(1e9*Math.random()>>>0),kb=0;function lb(n,e,t){return n.call.apply(n.bind,arguments)}function mb(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),n.apply(e,t)}}return function(){return n.apply(e,arguments)}}function nb(n,e,t){return(nb=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?lb:mb).apply(null,arguments)}function qb(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),n.apply(this,e)}}function tb(n,e){n=n.split(".");var t,r=cb;n[0]in r||void 0===r.execScript||r.execScript("var "+n[0]);for(;n.length&&(t=n.shift());)n.length||void 0===e?r=r[t]&&r[t]!==Object.prototype[t]?r[t]:r[t]={}:r[t]=e}function ub(n,e){function t(){}t.prototype=e.prototype,n.$h=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Td=function(n,t,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[t].apply(n,i)}}function vb(n,e){var t=wb;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}function xb(n,e){this.ja=0|n,this.ea=0|e}function yb(n){return 4294967296*n.ea+(n.ja>>>0)}function Cb(n){return 0==n.ja&&0==n.ea}function Db(n){var e=1+~n.ja|0;return zb(e,~n.ea+!e|0)}function Bb(n,e){return n.add(Db(e))}function Ab(n,e){if(Cb(e))throw Error("division by zero");if(0>n.ea){if(n.nd(Eb)){if(e.nd(Fb)||e.nd(Gb))return Eb;if(e.nd(Eb))return Fb;var t=1;if(0==t)t=n;else{var r=n.ea;t=32>t?zb(n.ja>>>t|r<<32-t,r>>t):zb(r>>t-32,0<=r?0:-1)}return(t=Ab(t,e).shiftLeft(1)).nd(Hb)?0>e.ea?Fb:Gb:(n=Bb(n,e.multiply(t)),t.add(Ab(n,e)))}return 0>e.ea?Ab(Db(n),Db(e)):Db(Ab(Db(n),e))}if(Cb(n))return Hb;if(0>e.ea)return e.nd(Eb)?Hb:Db(Ab(n,Db(e)));for(r=Hb;0<=n.compare(e);){t=Math.max(1,Math.floor(yb(n)/yb(e)));var i=Math.ceil(Math.log(t)/Math.LN2);i=48>=i?1:Math.pow(2,i-48);for(var o=Ib(t),l=o.multiply(e);0>l.ea||0<l.compare(n);)l=(o=Ib(t-=i)).multiply(e);Cb(o)&&(o=Fb),r=r.add(o),n=Bb(n,l)}return r}function Ib(n){return 0<n?0x8000000000000000<=n?Jb:new xb(n,n/4294967296):0>n?-0x8000000000000000>=n?Eb:Db(new xb(-n,-n/4294967296)):Hb}function zb(n,e){return new xb(n,e)}g=xb.prototype,g.isSafeInteger=function(){var n=this.ea>>21;return 0==n||-1==n&&!(0==this.ja&&-2097152==this.ea)},g.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(this.isSafeInteger()){var e=yb(this);return 10==n?""+e:e.toString(n)}e=14-(n>>2);var t=Math.pow(n,e),r=zb(t,t/4294967296);t=Ab(this,r),r=Math.abs(yb(Bb(this,t.multiply(r))));var i=10==n?""+r:r.toString(n);return i.length<e&&(i="0000000000000".substr(i.length-e)+i),r=yb(t),(10==n?r:r.toString(n))+i},g.nd=function(n){return this.ja==n.ja&&this.ea==n.ea},g.compare=function(n){return this.ea==n.ea?this.ja==n.ja?0:this.ja>>>0>n.ja>>>0?1:-1:this.ea>n.ea?1:-1},g.add=function(n){var e=this.ea>>>16,t=65535&this.ea,r=this.ja>>>16,i=n.ea>>>16,o=65535&n.ea,l=n.ja>>>16;return r=(l=((n=(65535&this.ja)+(65535&n.ja))>>>16)+(r+l))>>>16,zb((65535&l)<<16|65535&n,(e=((r+=t+o)>>>16)+(e+i)&65535)<<16|65535&r)},g.multiply=function(n){if(Cb(this))return this;if(Cb(n))return n;var e=this.ea>>>16,t=65535&this.ea,r=this.ja>>>16,i=65535&this.ja,o=n.ea>>>16,l=65535&n.ea,u=n.ja>>>16,s=i*(n=65535&n.ja),a=(s>>>16)+r*n,c=a>>>16;c+=(a=(65535&a)+i*u)>>>16;var d=(c+=t*n)>>>16;return zb((65535&a)<<16|65535&s,(d=(d+=(c=(65535&c)+r*u)>>>16)+((c=(65535&c)+i*l)>>>16)+(e*n+t*u+r*l+i*o)&65535)<<16|65535&c)},g.and=function(n){return zb(this.ja&n.ja,this.ea&n.ea)},g.or=function(n){return zb(this.ja|n.ja,this.ea|n.ea)},g.xor=function(n){return zb(this.ja^n.ja,this.ea^n.ea)},g.shiftLeft=function(n){if(0==(n&=63))return this;var e=this.ja;return 32>n?zb(e<<n,this.ea<<n|e>>>32-n):zb(0,e<<n-32)};var Hb=zb(0,0),Fb=zb(1,0),Gb=zb(-1,-1),Jb=zb(4294967295,2147483647),Eb=zb(0,2147483648);function Kb(n){return Array.prototype.concat.apply([],arguments)}function Lb(n){var e=n.length;if(0<e){for(var t=Array(e),r=0;r<e;r++)t[r]=n[r];return t}return[]}function Mb(n,e,t,r){return Array.prototype.splice.apply(n,Nb(arguments,1))}function Nb(n,e,t){return 2>=arguments.length?Array.prototype.slice.call(n,e):Array.prototype.slice.call(n,e,t)}function Ob(n,e){n.sort(e||Pb)}function Qb(n,e){for(var t=Array(n.length),r=0;r<n.length;r++)t[r]={index:r,value:n[r]};var i=e||Pb;for(Ob(t,(function(n,e){return i(n.value,e.value)||n.index-e.index})),r=0;r<n.length;r++)n[r]=t[r].value}function Pb(n,e){return n>e?1:n<e?-1:0}function Rb(n){for(var e=[],t=0;t<n;t++)e[t]=0;return e}function Cc(n){this.kh=n}Cc.prototype.toString=function(){return this.kh};var Um=new Cc("APPLET"),Xm=new Cc("BASE"),Gn=new Cc("EMBED"),fo=new Cc("IFRAME"),Mo=new Cc("LINK"),np=new Cc("MATH"),xp=new Cc("META"),Pq=new Cc("OBJECT"),yr=new Cc("SCRIPT"),Ms=new Cc("STYLE"),st=new Cc("SVG"),Vt=new Cc("TEMPLATE");function Ub(n){var e,t=[],r=0;for(e in n)t[r++]=e;return t}function Vb(n,e){return null!==n&&e in n?n[e]:void 0}function mv(n){var e=arguments.length;if(1==e&&"array"==db(arguments[0]))return mv.apply(null,arguments[0]);for(var t={},r=0;r<e;r++)t[arguments[r]]=!0;return t}function Wb(n,e){this.Hh=n===Xb&&e||"",this.Wf=Yb}var Yb={},Xb={},Zb=new Wb(Xb,"");function $b(){}function ac(n,e){this.yh=n===bc&&e||"",this.Xf=cc}$b.prototype.Jc=function(){return this},(new $b).Jc("");var cc={},bc={};function dc(n,e){var t=n.length-e.length;return 0<=t&&n.indexOf(e,t)==t}function ec(n){return/^[\s\xa0]*$/.test(n)}var fc=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]},hc;function gc(n){return-1!=hc.toLowerCase().indexOf(n.toLowerCase())}function ic(n,e){return n<e?-1:n>e?1:0}function jc(){}function kc(){}jc.prototype.Jc=function(){return this},(new jc).Jc(""),kc.prototype.Jc=function(){return this},(new kc).Jc("");n:{var lc=cb.navigator;if(lc){var nc=lc.userAgent;if(nc){hc=nc;break n}}hc=""}function oc(n){return-1!=hc.indexOf(n)}function pc(){return oc("Firefox")||oc("FxiOS")}function qc(){return(oc("Chrome")||oc("CriOS"))&&!oc("Edge")}function rc(){this.Ef="",this.Vf=sc}function tc(){var n=uc;return n instanceof rc&&n.constructor===rc&&n.Vf===sc?n.Ef:(db(n),"type_error:SafeHtml")}mv(Um,Xm,Gn,fo,Mo,np,xp,Pq,yr,Ms,st,Vt);var sc={};rc.prototype.Jc=function(n){return this.Ef=n,this},(new rc).Jc("<!DOCTYPE html>");var uc=(new rc).Jc("");function vc(n){var e=new ac(bc,Zb instanceof Wb&&Zb.constructor===Wb&&Zb.Wf===Yb?Zb.Hh:"type_error:Const");e instanceof ac&&e.constructor===ac&&e.Xf===cc?e=e.yh:(db(e),e="type_error:TrustedResourceUrl"),n.src=e.toString()}function wc(n){return 1==n.length&&" "<=n&&"~">=n||""<=n&&"">=n}(new rc).Jc("<br>");var yc=String.prototype.repeat?function(n,e){return n.repeat(e)}:function(n,e){return Array(e+1).join(n)};function zc(n,e){null!=n&&this.append.apply(this,arguments)}g=zc.prototype,g.Nc="",g.set=function(n){this.Nc=""+n},g.append=function(n,e,t){if(this.Nc+=String(n),null!=e)for(var r=1;r<arguments.length;r++)this.Nc+=arguments[r];return this},g.clear=function(){this.Nc=""},g.getLength=function(){return this.Nc.length},g.toString=function(){return this.Nc};var Ac={},Bc={},vv,h={},Dc=null,Ec=null,Fc=!0,Gc=!0,Hc=null,Ic=null;function Jc(){return new n(null,5,[Kc,!0,Lc,Gc,Mc,!1,Nc,!1,Oc,Hc],null)}function Pc(){Fc=!1,Ec=function(){return console.log.apply(console,Lb(arguments))}}function p(n){return null!=n&&!1!==n}function Qc(n){return null==n}function Rc(n){return n instanceof Array}function Sc(n){return"number"==typeof n}function Tc(n){return null==n||!1===n}function Uc(n){return null!=n}function Vc(n){return"string"==typeof n}function Wc(){return!0}function Xc(n,e){return!!n[db(null==e?null:e)]||!!n._}function Yc(n){return null==n?null:n.constructor}function Zc(n,e){var t=Yc(e);return t=p(p(t)?t.Ia:t)?t.Da:db(e),Error(["No protocol method ",n," defined for type ",t,": ",e].join(""))}function $c(n){var e=n.Da;return p(e)?e:q.a(n)}var ad="undefined"!=typeof Symbol&&"function"===db(Symbol)?Symbol.iterator:"@@iterator",bd={"]":"_RBRACK_","'":"_SINGLEQUOTE_","=":"_EQ_",'"':"_DOUBLEQUOTE_","!":"_BANG_","*":"_STAR_","%":"_PERCENT_","|":"_BAR_","~":"_TILDE_","/":"_SLASH_","\\":"_BSLASH_","-":"_","?":"_QMARK_","&":"_AMPERSAND_",":":"_COLON_","<":"_LT_","{":"_LBRACE_","}":"_RBRACE_","[":"_LBRACK_","#":"_SHARP_","^":"_CARET_","+":"_PLUS_","@":"_CIRCA_",">":"_GT_"},cd={_RBRACE_:"}",_COLON_:":",_BANG_:"!",_QMARK_:"?",_BSLASH_:"\\\\",_SLASH_:"/",_PERCENT_:"%",_PLUS_:"+",_SHARP_:"#",_LBRACE_:"{",_BAR_:"|",_LBRACK_:"[",_EQ_:"=",_:"-",_TILDE_:"~",_RBRACK_:"]",_GT_:">",_SINGLEQUOTE_:"'",_CIRCA_:"@",_AMPERSAND_:"&",_DOUBLEQUOTE_:'\\"',_CARET_:"^",_LT_:"<",_STAR_:"*"},dd=null;function ed(n){for(var e=n.length,t=Array(e),r=0;r<e;)t[r]=n[r],r+=1;return t}function fd(n){function e(n,e){return n.push(e),n}var t=[];return gd.c?gd.c(e,t,n):gd.call(null,e,t,n)}function nh(n){return"symbol"===db(n)||"undefined"!=typeof Symbol&&n instanceof Symbol}function hd(){}function id(){}function jd(){}function kd(n){if(null!=n&&null!=n.X)n=n.X(n);else{var e=kd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=kd._))throw Zc("ICounted.-count",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ld(){}function md(n){if(null!=n&&null!=n.pa)n=n.pa(n);else{var e=md[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=md._))throw Zc("IEmptyableCollection.-empty",n);n=e.a?e.a(n):e.call(null,n)}}return n}function nd(){}function od(n,e){if(null!=n&&null!=n.ga)n=n.ga(n,e);else{var t=od[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=od._))throw Zc("ICollection.-conj",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function pd(){}var Mz=function(){function n(n,e,t){var r=qd[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=qd._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("IIndexed.-nth",n)}function e(n,e){var t=qd[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=qd._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("IIndexed.-nth",n)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),qd=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function rd(){}function sd(n){if(null!=n&&null!=n.Fa)n=n.Fa(n);else{var e=sd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=sd._))throw Zc("ISeq.-first",n);n=e.a?e.a(n):e.call(null,n)}}return n}function td(n){if(null!=n&&null!=n.Ha)n=n.Ha(n);else{var e=td[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=td._))throw Zc("ISeq.-rest",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ud(){}function vd(n){if(null!=n&&null!=n.za)n=n.za(n);else{var e=vd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=vd._))throw Zc("INext.-next",n);n=e.a?e.a(n):e.call(null,n)}}return n}function wd(){}qd.b=function(n,e){return null!=n&&null!=n.W?n.W(n,e):Mz(n,e)},qd.c=function(n,e,t){return null!=n&&null!=n.wa?n.wa(n,e,t):Mz(n,e,t)},qd.F=3;var UA=function(){function n(n,e,t){var r=xd[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=xd._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("ILookup.-lookup",n)}function e(n,e){var t=xd[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=xd._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("ILookup.-lookup",n)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),xd=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function yd(){}function zd(n,e,t){if(null!=n&&null!=n.fa)n=n.fa(n,e,t);else{var r=zd[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=zd._))throw Zc("IAssociative.-assoc",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function Ad(n,e){if(null!=n&&null!=n.Ac)n=n.Ac(n,e);else{var t=Ad[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Ad._))throw Zc("IFind.-find",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Bd(){}function Cd(n,e){if(null!=n&&null!=n.Ka)n=n.Ka(n,e);else{var t=Cd[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Cd._))throw Zc("IMap.-dissoc",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Dd(n){if(null!=n&&null!=n.Ce)n=n.key;else{var e=Dd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Dd._))throw Zc("IMapEntry.-key",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Ed(n){if(null!=n&&null!=n.De)n=n.m;else{var e=Ed[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Ed._))throw Zc("IMapEntry.-val",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Fd(){}function Gd(n,e){if(null!=n&&null!=n.rf)n=n.rf(n,e);else{var t=Gd[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Gd._))throw Zc("ISet.-disjoin",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Hd(n){if(null!=n&&null!=n.Xb)n=n.Xb(n);else{var e=Hd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Hd._))throw Zc("IStack.-peek",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Id(n){if(null!=n&&null!=n.Yb)n=n.Yb(n);else{var e=Id[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Id._))throw Zc("IStack.-pop",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Jd(){}function Kd(n,e,t){if(null!=n&&null!=n.Ib)n=n.Ib(n,e,t);else{var r=Kd[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=Kd._))throw Zc("IVector.-assoc-n",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function Ld(){}function t(n){if(null!=n&&null!=n.zb)n=n.zb(n);else{var e=t[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=t._))throw Zc("IDeref.-deref",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Md(){}function Nd(n){if(null!=n&&null!=n.N)n=n.N(n);else{var e=Nd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Nd._))throw Zc("IMeta.-meta",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Od(){}function Pd(n,e){if(null!=n&&null!=n.O)n=n.O(n,e);else{var t=Pd[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Pd._))throw Zc("IWithMeta.-with-meta",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Qd(){}xd.b=function(n,e){return null!=n&&null!=n.ia?n.ia(n,e):UA(n,e)},xd.c=function(n,e,t){return null!=n&&null!=n.M?n.M(n,e,t):UA(n,e,t)},xd.F=3;var iC=function(){function n(n,e,t){var r=Rd[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=Rd._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("IReduce.-reduce",n)}function e(n,e){var t=Rd[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=Rd._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("IReduce.-reduce",n)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),Rd=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function Sd(){}function Td(n,e,t){if(null!=n&&null!=n.Aa)n=n.Aa(n,e,t);else{var r=Td[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=Td._))throw Zc("IKVReduce.-kv-reduce",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function Ud(n,e){if(null!=n&&null!=n.Y)n=n.Y(n,e);else{var t=Ud[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Ud._))throw Zc("IEquiv.-equiv",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Vd(n){if(null!=n&&null!=n.Z)n=n.Z(n);else{var e=Vd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Vd._))throw Zc("IHash.-hash",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Wd(){}function Xd(n){if(null!=n&&null!=n.$)n=n.$(n);else{var e=Xd[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Xd._))throw Zc("ISeqable.-seq",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Yd(){}function Zd(){}function $d(){}function ae(){}function be(n){if(null!=n&&null!=n.Bc)n=n.Bc(n);else{var e=be[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=be._))throw Zc("IReversible.-rseq",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ce(n,e){if(null!=n&&null!=n.Pc)n=n.Pc(n,e);else{var t=ce[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=ce._))throw Zc("IWriter.-write",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function de(n){if(null!=n&&null!=n.qc)n=n.qc(n);else{var e=de[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=de._))throw Zc("IWriter.-flush",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ee(){}function fe(n,e,t){if(null!=n&&null!=n.S)n=n.S(n,e,t);else{var r=fe[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=fe._))throw Zc("IPrintWithWriter.-pr-writer",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function ge(){}function he(n){if(null!=n&&null!=n.Bd)n=n.Bd(n);else{var e=he[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=he._))throw Zc("IPending.-realized?",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ie(n,e,t){if(null!=n&&null!=n.Ge)n.Ge(n,e,t);else{var r=ie[db(null==n?null:n)];if(null!=r)r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=ie._))throw Zc("IWatchable.-notify-watches",n);r.c?r.c(n,e,t):r.call(null,n,e,t)}}}function je(n){if(null!=n&&null!=n.hd)n=n.hd(n);else{var e=je[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=je._))throw Zc("IEditableCollection.-as-transient",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ke(n,e){if(null!=n&&null!=n.kd)n=n.kd(n,e);else{var t=ke[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=ke._))throw Zc("ITransientCollection.-conj!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function le(n){if(null!=n&&null!=n.Cd)n=n.Cd(n);else{var e=le[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=le._))throw Zc("ITransientCollection.-persistent!",n);n=e.a?e.a(n):e.call(null,n)}}return n}function me(n,e,t){if(null!=n&&null!=n.jd)n=n.jd(n,e,t);else{var r=me[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=me._))throw Zc("ITransientAssociative.-assoc!",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function ne(n,e){if(null!=n&&null!=n.Fe)n=n.Fe(n,e);else{var t=ne[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=ne._))throw Zc("ITransientMap.-dissoc!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function oe(){}function pe(n,e){if(null!=n&&null!=n.Wb)n=n.Wb(n,e);else{var t=pe[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=pe._))throw Zc("IComparable.-compare",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function qe(n){if(null!=n&&null!=n.ze)n=n.ze(n);else{var e=qe[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=qe._))throw Zc("IChunk.-drop-first",n);n=e.a?e.a(n):e.call(null,n)}}return n}function re(n){if(null!=n&&null!=n.$d)n=n.$d(n);else{var e=re[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=re._))throw Zc("IChunkedSeq.-chunked-first",n);n=e.a?e.a(n):e.call(null,n)}}return n}function se(n){if(null!=n&&null!=n.gd)n=n.gd(n);else{var e=se[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=se._))throw Zc("IChunkedSeq.-chunked-rest",n);n=e.a?e.a(n):e.call(null,n)}}return n}function te(n){if(null!=n&&null!=n.yd)n=n.yd(n);else{var e=te[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=te._))throw Zc("INamed.-name",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ue(n){if(null!=n&&null!=n.zd)n=n.zd(n);else{var e=ue[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=ue._))throw Zc("INamed.-namespace",n);n=e.a?e.a(n):e.call(null,n)}}return n}function ve(n,e){if(null!=n&&null!=n.mg)n=n.mg(n,e);else{var t=ve[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=ve._))throw Zc("IReset.-reset!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}Rd.b=function(n,e){return null!=n&&null!=n.Ba?n.Ba(n,e):iC(n,e)},Rd.c=function(n,e,t){return null!=n&&null!=n.Ca?n.Ca(n,e,t):iC(n,e,t)},Rd.F=3;var WC=function(){function n(n,e,t,r,i){var o=we[db(null==n?null:n)];if(null!=o)return o.K?o.K(n,e,t,r,i):o.call(null,n,e,t,r,i);if(null!=(o=we._))return o.K?o.K(n,e,t,r,i):o.call(null,n,e,t,r,i);throw Zc("ISwap.-swap!",n)}function e(n,e,t,r){var i=we[db(null==n?null:n)];if(null!=i)return i.A?i.A(n,e,t,r):i.call(null,n,e,t,r);if(null!=(i=we._))return i.A?i.A(n,e,t,r):i.call(null,n,e,t,r);throw Zc("ISwap.-swap!",n)}function t(n,e,t){var r=we[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=we._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("ISwap.-swap!",n)}function r(n,e){var t=we[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=we._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("ISwap.-swap!",n)}var i;return(i=function(i,o,l,u,s){switch(arguments.length){case 2:return r.call(this,i,o);case 3:return t.call(this,i,o,l);case 4:return e.call(this,i,o,l,u);case 5:return n.call(this,i,o,l,u,s)}throw Error("Invalid arity: "+arguments.length)}).b=r,i.c=t,i.A=e,i.K=n,i}(),we=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return n.K(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function xe(n,e){if(null!=n&&null!=n.Cc)n.Cc(n,e);else{var t=xe[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=xe._))throw Zc("IVolatile.-vreset!",n);t.b?t.b(n,e):t.call(null,n,e)}}}function ye(){}function ze(n){if(null!=n&&null!=n.ua)n=n.ua(n);else{var e=ze[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=ze._))throw Zc("IIterable.-iterator",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Ae(n){this.Fh=n,this.h=1073741824,this.I=0}function Be(n){var e=new zc,t=new Ae(e);return n.S(null,t,Jc()),t.qc(null),q.a(e)}we.b=function(n,e){return null!=n&&null!=n.ng?n.ng(n,e):WC(n,e)},we.c=function(n,e,t){return null!=n&&null!=n.og?n.og(n,e,t):WC(n,e,t)},we.A=function(n,e,t,r){return null!=n&&null!=n.pg?n.pg(n,e,t,r):WC(n,e,t,r)},we.K=function(n,e,t,r,i){return null!=n&&null!=n.qg?n.qg(n,e,t,r,i):WC(n,e,t,r,i)},we.F=5,Ae.prototype.Pc=function(n,e){return this.Fh.append(e)},Ae.prototype.qc=function(){return null};var Ce="undefined"!=typeof Math&&void 0!==Math.imul&&0!==Math.imul(4294967295,5)?function(n,e){return Math.imul(n,e)}:function(n,e){var t=65535&n,r=65535&e;return t*r+((n>>>16&65535)*r+t*(e>>>16&65535)<<16>>>0)|0};function De(n){return n=Ce(0|n,-862048943),Ce(n<<15|n>>>-15,461845907)}function Ee(n,e){return Ce((n=(0|n)^(0|e))<<13|n>>>-13,5)+-430675100|0}function Fe(n,e){return n=Ce((n=(0|n)^e)^n>>>16,-2048144789),(n=Ce(n^n>>>13,-1028477387))^n>>>16}var Ge={},He=0;function Ie(n){if(255<He&&(Ge={},He=0),null==n)return 0;var e=Ge[n];if("number"==typeof e)n=e;else{n:if(null!=n)if(e=n.length,0<e)for(var t=0,r=0;;){if(!(t<e)){e=r;break n}r=Ce(31,r)+n.charCodeAt(t),t+=1}else e=0;else e=0;Ge[n]=e,He+=1,n=e}return n}function Je(n){if(null!=n&&(4194304&n.h||h===n.Oh))return 0^n.Z(null);if("number"!=typeof n)return!0===n?n=1231:!1===n?n=1237:"string"==typeof n?n=0===(n=Ie(n))?n:Fe(Ee(0,De(n)),4):n=n instanceof Date?0^n.valueOf():null==n?0:0^Vd(n),n;if(p(isFinite(n)))return Math.floor(n)%2147483647;switch(n){case 1/0:return 2146435072;case-1/0:return-1048576;default:return 2146959360}}function Ke(n){var e=n.name;n:for(var t=1,r=0;;){if(!(t<e.length)){t=r;break n}r=Ee(r,De(e.charCodeAt(t-1)|e.charCodeAt(t)<<16)),t+=2}return(e=Fe(1==(1&e.length)?t^De(e.charCodeAt(e.length-1)):t,Ce(2,e.length)))^(n=Ie(n.vb))+2654435769+(e<<6)+(e>>2)}function Le(n,e){if(n.wc===e.wc)return 0;if(p(!!Tc(n.vb)&&e.vb))return-1;if(p(n.vb)){if(Tc(e.vb))return 1;var t=Pb(n.vb,e.vb);return 0===t?Pb(n.name,e.name):t}return Pb(n.name,e.name)}function w(n,e,t,r,i){this.vb=n,this.name=e,this.wc=t,this.ed=r,this.Kb=i,this.h=2154168321,this.I=4096}g=w.prototype,g.toString=function(){return this.wc},g.Y=function(n,e){return e instanceof w&&this.wc===e.wc},g.call=function(){function n(n,e,t){return x.c?x.c(e,this,t):x.call(null,e,this,t)}function e(n,e){return x.b?x.b(e,this):x.call(null,e,this)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+(arguments.length-1))}).b=e,t.c=n,t}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return x.b?x.b(n,this):x.call(null,n,this)},g.b=function(n,e){return x.c?x.c(n,this,e):x.call(null,n,this,e)},g.N=function(){return this.Kb},g.O=function(n,e){return new w(this.vb,this.name,this.wc,this.ed,e)},g.Z=function(){var n=this.ed;return null!=n?n:this.ed=n=Ke(this)},g.yd=function(){return this.name},g.zd=function(){return this.vb},g.S=function(n,e){return ce(e,this.wc)};var Me=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function Ne(n,e,t){this.m=n,this.bd=e,this.Kb=t,this.h=6717441,this.I=0}function Pe(n){return null!=n?!!(131072&n.I||h===n.Ph)||!n.I&&Xc(ye,n):Xc(ye,n)}function B(n){if(null==n)return null;if(null!=n&&(8388608&n.h||h===n.qf))return n.$(null);if(Rc(n)||"string"==typeof n)return 0===n.length?null:new Qe(n,0,null);if(null!=n&&null!=n[ad])return n=Vb(n,ad).call(n),lo.a?lo.a(n):lo.call(null,n);if(Xc(Wd,n))return Xd(n);throw Error([q.a(n)," is not ISeqable"].join(""))}function C(n){return null==n?null:null!=n&&(64&n.h||h===n.D)?n.Fa(null):null==(n=B(n))?null:sd(n)}function Re(n){return null!=n&&(null!=n&&(64&n.h||h===n.D)||(n=B(n)))?n.Ha(null):Se}function D(n){return null==n?null:null!=n&&(128&n.h||h===n.Ad)?n.za(null):B(Re(n))}Me.a=function(n){for(;;){if(n instanceof w)return n;if("string"==typeof n){var e=n.indexOf("/");return 1>e?Me.b(null,n):Me.b(n.substring(0,e),n.substring(e+1,n.length))}if(n instanceof Ne)return n.bd;if(!(n instanceof z))throw Error("no conversion to symbol");n=n.da}},Me.b=function(n,e){return new w(n,e,null!=n?[q.a(n),"/",q.a(e)].join(""):e,null,null)},Me.F=2,g=Ne.prototype,g.toString=function(){return["#'",q.a(this.bd)].join("")},g.zb=function(){return this.m.o?this.m.o():this.m.call(null)},g.N=function(){return this.Kb},g.O=function(n,e){return new Ne(this.m,this.bd,e)},g.Y=function(n,e){return e instanceof Ne&&(n=this.bd,e=e.bd,A.b?A.b(n,e):A.call(null,n,e))},g.Z=function(){return Ke(this.bd)},g.mf=h,g.call=function(){function n(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$){return n=(n=this).m.o?n.m.o():n.m.call(null),Oe.Be?Oe.Be(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$):Oe.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$)}function e(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b){return(n=(n=this).m.o?n.m.o():n.m.call(null)).rb?n.rb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b)}function t(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y){return(n=(n=this).m.o?n.m.o():n.m.call(null)).hb?n.hb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y)}function r(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m){return(n=(n=this).m.o?n.m.o():n.m.call(null)).qb?n.qb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m)}function i(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){return(n=(n=this).m.o?n.m.o():n.m.call(null)).gb?n.gb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v)}function o(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){return(n=(n=this).m.o?n.m.o():n.m.call(null)).pb?n.pb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w)}function l(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g){return(n=(n=this).m.o?n.m.o():n.m.call(null)).fb?n.fb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g)}function u(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p){return(n=(n=this).m.o?n.m.o():n.m.call(null)).ob?n.ob(e,t,r,i,o,l,u,s,a,c,d,h,f,p):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p)}function s(n,e,t,r,i,o,l,u,s,a,c,d,h,f){return(n=(n=this).m.o?n.m.o():n.m.call(null)).eb?n.eb(e,t,r,i,o,l,u,s,a,c,d,h,f):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f)}function a(n,e,t,r,i,o,l,u,s,a,c,d,h){return(n=(n=this).m.o?n.m.o():n.m.call(null)).nb?n.nb(e,t,r,i,o,l,u,s,a,c,d,h):n.call(null,e,t,r,i,o,l,u,s,a,c,d,h)}function c(n,e,t,r,i,o,l,u,s,a,c,d){return(n=(n=this).m.o?n.m.o():n.m.call(null)).cb?n.cb(e,t,r,i,o,l,u,s,a,c,d):n.call(null,e,t,r,i,o,l,u,s,a,c,d)}function d(n,e,t,r,i,o,l,u,s,a,c){return(n=(n=this).m.o?n.m.o():n.m.call(null)).mb?n.mb(e,t,r,i,o,l,u,s,a,c):n.call(null,e,t,r,i,o,l,u,s,a,c)}function h(n,e,t,r,i,o,l,u,s,a){return(n=(n=this).m.o?n.m.o():n.m.call(null)).Xa?n.Xa(e,t,r,i,o,l,u,s,a):n.call(null,e,t,r,i,o,l,u,s,a)}function f(n,e,t,r,i,o,l,u,s){return(n=(n=this).m.o?n.m.o():n.m.call(null)).Ga?n.Ga(e,t,r,i,o,l,u,s):n.call(null,e,t,r,i,o,l,u,s)}function p(n,e,t,r,i,o,l,u){return(n=(n=this).m.o?n.m.o():n.m.call(null)).ib?n.ib(e,t,r,i,o,l,u):n.call(null,e,t,r,i,o,l,u)}function g(n,e,t,r,i,o,l){return(n=(n=this).m.o?n.m.o():n.m.call(null)).la?n.la(e,t,r,i,o,l):n.call(null,e,t,r,i,o,l)}function w(n,e,t,r,i,o){return(n=(n=this).m.o?n.m.o():n.m.call(null)).K?n.K(e,t,r,i,o):n.call(null,e,t,r,i,o)}function v(n,e,t,r,i){return(n=(n=this).m.o?n.m.o():n.m.call(null)).A?n.A(e,t,r,i):n.call(null,e,t,r,i)}function m(n,e,t,r){return(n=(n=this).m.o?n.m.o():n.m.call(null)).c?n.c(e,t,r):n.call(null,e,t,r)}function y(n,e,t){return(n=(n=this).m.o?n.m.o():n.m.call(null)).b?n.b(e,t):n.call(null,e,t)}function b(n,e){return(n=(n=this).m.o?n.m.o():n.m.call(null)).a?n.a(e):n.call(null,e)}function $(n){return(n=(n=this).m.o?n.m.o():n.m.call(null)).o?n.o():n.call(null)}var _;return(_=function(_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L){switch(arguments.length){case 1:return $.call(this,_);case 2:return b.call(this,_,S);case 3:return y.call(this,_,S,I);case 4:return m.call(this,_,S,I,C);case 5:return v.call(this,_,S,I,C,R);case 6:return w.call(this,_,S,I,C,R,A);case 7:return g.call(this,_,S,I,C,R,A,E);case 8:return p.call(this,_,S,I,C,R,A,E,D);case 9:return f.call(this,_,S,I,C,R,A,E,D,x);case 10:return h.call(this,_,S,I,C,R,A,E,D,x,T);case 11:return d.call(this,_,S,I,C,R,A,E,D,x,T,k);case 12:return c.call(this,_,S,I,C,R,A,E,D,x,T,k,O);case 13:return a.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M);case 14:return s.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j);case 15:return u.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N);case 16:return l.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q);case 17:return o.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P);case 18:return i.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G);case 19:return r.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W);case 20:return t.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q);case 21:return e.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J);case 22:return n.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L)}throw Error("Invalid arity: "+(arguments.length-1))}).a=$,_.b=b,_.c=y,_.A=m,_.K=v,_.la=w,_.ib=g,_.Ga=p,_.Xa=f,_.mb=h,_.cb=d,_.nb=c,_.eb=a,_.ob=s,_.fb=u,_.pb=l,_.gb=o,_.qb=i,_.hb=r,_.rb=t,_.Sc=e,_.Be=n,_}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.o=function(){var n=this.m.o?this.m.o():this.m.call(null);return n.o?n.o():n.call(null)},g.a=function(n){var e=this.m.o?this.m.o():this.m.call(null);return e.a?e.a(n):e.call(null,n)},g.b=function(n,e){var t=this.m.o?this.m.o():this.m.call(null);return t.b?t.b(n,e):t.call(null,n,e)},g.c=function(n,e,t){var r=this.m.o?this.m.o():this.m.call(null);return r.c?r.c(n,e,t):r.call(null,n,e,t)},g.A=function(n,e,t,r){var i=this.m.o?this.m.o():this.m.call(null);return i.A?i.A(n,e,t,r):i.call(null,n,e,t,r)},g.K=function(n,e,t,r,i){var o=this.m.o?this.m.o():this.m.call(null);return o.K?o.K(n,e,t,r,i):o.call(null,n,e,t,r,i)},g.la=function(n,e,t,r,i,o){var l=this.m.o?this.m.o():this.m.call(null);return l.la?l.la(n,e,t,r,i,o):l.call(null,n,e,t,r,i,o)},g.ib=function(n,e,t,r,i,o,l){var u=this.m.o?this.m.o():this.m.call(null);return u.ib?u.ib(n,e,t,r,i,o,l):u.call(null,n,e,t,r,i,o,l)},g.Ga=function(n,e,t,r,i,o,l,u){var s=this.m.o?this.m.o():this.m.call(null);return s.Ga?s.Ga(n,e,t,r,i,o,l,u):s.call(null,n,e,t,r,i,o,l,u)},g.Xa=function(n,e,t,r,i,o,l,u,s){var a=this.m.o?this.m.o():this.m.call(null);return a.Xa?a.Xa(n,e,t,r,i,o,l,u,s):a.call(null,n,e,t,r,i,o,l,u,s)},g.mb=function(n,e,t,r,i,o,l,u,s,a){var c=this.m.o?this.m.o():this.m.call(null);return c.mb?c.mb(n,e,t,r,i,o,l,u,s,a):c.call(null,n,e,t,r,i,o,l,u,s,a)},g.cb=function(n,e,t,r,i,o,l,u,s,a,c){var d=this.m.o?this.m.o():this.m.call(null);return d.cb?d.cb(n,e,t,r,i,o,l,u,s,a,c):d.call(null,n,e,t,r,i,o,l,u,s,a,c)},g.nb=function(n,e,t,r,i,o,l,u,s,a,c,d){var h=this.m.o?this.m.o():this.m.call(null);return h.nb?h.nb(n,e,t,r,i,o,l,u,s,a,c,d):h.call(null,n,e,t,r,i,o,l,u,s,a,c,d)},g.eb=function(n,e,t,r,i,o,l,u,s,a,c,d,h){var f=this.m.o?this.m.o():this.m.call(null);return f.eb?f.eb(n,e,t,r,i,o,l,u,s,a,c,d,h):f.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h)},g.ob=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f){var p=this.m.o?this.m.o():this.m.call(null);return p.ob?p.ob(n,e,t,r,i,o,l,u,s,a,c,d,h,f):p.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f)},g.fb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p){var g=this.m.o?this.m.o():this.m.call(null);return g.fb?g.fb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p):g.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p)},g.pb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g){var w=this.m.o?this.m.o():this.m.call(null);return w.pb?w.pb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g):w.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g)},g.gb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){var v=this.m.o?this.m.o():this.m.call(null);return v.gb?v.gb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w):v.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w)},g.qb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){var m=this.m.o?this.m.o():this.m.call(null);return m.qb?m.qb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v):m.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v)},g.hb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m){var y=this.m.o?this.m.o():this.m.call(null);return y.hb?y.hb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m):y.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m)},g.rb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y){var b=this.m.o?this.m.o():this.m.call(null);return b.rb?b.rb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y):b.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y)},g.Sc=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b){var $=this.m.o?this.m.o():this.m.call(null);return Oe.Be?Oe.Be($,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b):Oe.call(null,$,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b)};var A=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function Te(n){this.ha=n}function Ue(n){return new Te(B(n))}function Lo(n,e){this.value=n,this.Se=e,this.Pb=null,this.h=8388672,this.I=0}function lo(n){var e=n.next();return p(e.done)?null:new Lo(e.value,n)}function Ve(n,e){return Fe(Ee(0,De(n)),e)}function We(n){var e=0,t=1;for(n=B(n);;){if(null==n)return Ve(t,e);e+=1,t=Ce(31,t)+Je(C(n))|0,n=D(n)}}A.a=function(){return!0},A.b=function(n,e){return null==n?null==e:n===e||Ud(n,e)},A.g=function(n,e,t){for(;;){if(!A.b(n,e))return!1;if(!D(t))return A.b(e,C(t));n=e,e=C(t),t=D(t)}},A.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},A.F=2,Te.prototype.next=function(){if(null!=this.ha){var n=C(this.ha);return this.ha=D(this.ha),{value:n,done:!1}}return{value:null,done:!0}},Lo.prototype.$=function(){return this},Lo.prototype.Fa=function(){return this.value},Lo.prototype.Ha=function(){return null==this.Pb&&(this.Pb=lo.a?lo.a(this.Se):lo.call(null,this.Se)),this.Pb};var Xe=Ve(1,0);function Ye(n){var e=0,t=0;for(n=B(n);;){if(null==n)return Ve(t,e);e+=1,t=t+Je(C(n))|0,n=D(n)}}var Ze=Ve(0,0),a;function $e(n){return n+1}function af(n){this.m=n,this.h=32768,this.I=0}function bf(n){return new af(n)}function cf(n){return n instanceof af}function df(n){return cf(n)?ef.a?ef.a(n):ef.call(null,n):n}function ef(n){return t(n)}function ff(n,e){var r=n.X(null);if(0===r)return e.o?e.o():e.call(null);for(var i=n.W(null,0),o=1;;){if(!(o<r))return i;var l=n.W(null,o);if(cf(i=e.b?e.b(i,l):e.call(null,i,l)))return t(i);o+=1}}function gf(n,e,r){var i=n.X(null),o=r;for(r=0;;){if(!(r<i))return o;var l=n.W(null,r);if(cf(o=e.b?e.b(o,l):e.call(null,o,l)))return t(o);r+=1}}function hf(n,e){var r=n.length;if(0===n.length)return e.o?e.o():e.call(null);for(var i=n[0],o=1;;){if(!(o<r))return i;var l=n[o];if(cf(i=e.b?e.b(i,l):e.call(null,i,l)))return t(i);o+=1}}function jf(n,e,r){var i=n.length,o=r;for(r=0;;){if(!(r<i))return o;var l=n[r];if(cf(o=e.b?e.b(o,l):e.call(null,o,l)))return t(o);r+=1}}function kf(n,e,r,i){for(var o=n.length;;){if(!(i<o))return r;var l=n[i];if(cf(r=e.b?e.b(r,l):e.call(null,r,l)))return t(r);i+=1}}function lf(n){return null!=n?!!(2&n.h||h===n.bg)||!n.h&&Xc(jd,n):Xc(jd,n)}function mf(n){return null!=n?!!(16&n.h||h===n.pf)||!n.h&&Xc(pd,n):Xc(pd,n)}function nf(n,e,t){var r=F.a?F.a(n):F.call(null,n);if(t>=r)return-1;for(!(0<t)&&0>t&&(t=0>(t+=r)?0:t);;){if(!(t<r))return-1;if(A.b(pf?pf(n,t):qf.call(null,n,t),e))return t;t+=1}}function rf(n,e,t){var r=F.a?F.a(n):F.call(null,n);if(0===r)return-1;for(0<t?t=--r<t?r:t:t=0>t?r+t:t;;){if(!(0<=t))return-1;if(A.b(pf?pf(n,t):qf.call(null,n,t),e))return t;--t}}function sf(n,e){this.l=n,this.J=e}function Qe(n,e,t){this.l=n,this.J=e,this.H=t,this.h=166592766,this.I=139264}function G(n){return 0<n.length?new Qe(n,0,null):null}function tf(n,e,t){this.Zd=n,this.J=e,this.H=t,this.h=32374990,this.I=8192}function zf(n){return C(D(n))}function Af(n){return C(D(n))}function Bf(n){for(;;){var e=D(n);if(null==e)return C(n);n=e}}jd.null=!0,kd.null=function(){return 0},Date.prototype.Y=function(n,e){return e instanceof Date&&this.valueOf()===e.valueOf()},Date.prototype.Oc=h,Date.prototype.Wb=function(n,e){if(e instanceof Date)return Pb(this.valueOf(),e.valueOf());throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},Ud.number=function(n,e){return n===e},hd.function=!0,Md.function=!0,Nd.function=function(){return null},Vd._=function(n){return hb(n)},af.prototype.zb=function(){return this.m},sf.prototype.ra=function(){return this.J<this.l.length},sf.prototype.next=function(){var n=this.l[this.J];return this.J+=1,n},g=Qe.prototype,g.toString=function(){return Be(this)},g.indexOf=((a=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},a.b=function(n,e){return nf(this,n,e)},a),g.lastIndexOf=function(){function n(n){return rf(this,n,F.a?F.a(this):F.call(null,this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.W=function(n,e){if(0<=(n=e+this.J)&&n<this.l.length)return this.l[n];throw Error("Index out of bounds")},g.wa=function(n,e,t){return 0<=(n=e+this.J)&&n<this.l.length?this.l[n]:t},g.ua=function(){return new sf(this.l,this.J)},g.N=function(){return this.H},g.za=function(){return this.J+1<this.l.length?new Qe(this.l,this.J+1,null):null},g.X=function(){var n=this.l.length-this.J;return 0>n?0:n},g.Bc=function(){var n=this.X(null);return 0<n?new tf(this,n-1,null):null},g.Z=function(){return We(this)},g.Y=function(n,e){return uf.b?uf.b(this,e):uf.call(null,this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return kf(this.l,e,this.l[this.J],this.J+1)},g.Ca=function(n,e,t){return kf(this.l,e,t,this.J)},g.Fa=function(){return this.l[this.J]},g.Ha=function(){return this.J+1<this.l.length?new Qe(this.l,this.J+1,null):Se},g.$=function(){return this.J<this.l.length?this:null},g.O=function(n,e){return e===this.H?this:new Qe(this.l,this.J,e)},g.ga=function(n,e){return vf.b?vf.b(e,this):vf.call(null,e,this)},Qe.prototype[ad]=function(){return Ue(this)},g=tf.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F.a?F.a(this):F.call(null,this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return 0<this.J?new tf(this.Zd,this.J-1,null):null},g.X=function(){return this.J+1},g.Z=function(){return We(this)},g.Y=function(n,e){return uf.b?uf.b(this,e):uf.call(null,this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf?wf(e,this):xf.call(null,e,this)},g.Ca=function(n,e,t){return yf?yf(e,t,this):xf.call(null,e,t,this)},g.Fa=function(){return qd(this.Zd,this.J)},g.Ha=function(){return 0<this.J?new tf(this.Zd,this.J-1,null):Se},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new tf(this.Zd,this.J,e)},g.ga=function(n,e){return vf.b?vf.b(e,this):vf.call(null,e,this)},tf.prototype[ad]=function(){return Ue(this)},Ud._=function(n,e){return n===e};var Cf=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function Ef(n){return null==n?null:null!=n&&(4&n.h||h===n.dg)?n.pa(null):(null!=n?4&n.h||h===n.dg||!n.h&&Xc(ld,n):Xc(ld,n))?md(n):null}function F(n){if(null!=n)if(null!=n&&(2&n.h||h===n.bg))n=n.X(null);else if(Rc(n))n=n.length;else if("string"==typeof n)n=n.length;else if(null!=n&&(8388608&n.h||h===n.qf))n:{n=B(n);for(var e=0;;){if(lf(n)){n=e+kd(n);break n}n=D(n),e+=1}}else n=kd(n);else n=0;return n}function Ff(n,e,t){for(;;){if(null==n)return t;if(0===e)return B(n)?C(n):t;if(mf(n))return qd(n,e,t);if(!B(n))return t;n=D(n),--e}}function qf(n){switch(arguments.length){case 2:return pf(arguments[0],arguments[1]);case 3:return J(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function pf(n,e){if("number"!=typeof e)throw Error("Index argument to nth must be a number");if(null==n)return n;if(null!=n&&(16&n.h||h===n.pf))return n.W(null,e);if(Rc(n)){if(-1<e&&e<n.length)return n[0|e];throw Error("Index out of bounds")}if("string"==typeof n){if(-1<e&&e<n.length)return n.charAt(0|e);throw Error("Index out of bounds")}if(null!=n&&(64&n.h||h===n.D)||null!=n&&(16777216&n.h||h===n.Ee)){if(0>e)throw Error("Index out of bounds");n:for(;;){if(null==n)throw Error("Index out of bounds");if(0===e){if(B(n)){n=C(n);break n}throw Error("Index out of bounds")}if(mf(n)){n=qd(n,e);break n}if(!B(n))throw Error("Index out of bounds");n=D(n),--e}return n}if(Xc(pd,n))return qd(n,e);throw Error(["nth not supported on this type ",q.a($c(Yc(n)))].join(""))}function J(n,e,t){if("number"!=typeof e)throw Error("Index argument to nth must be a number.");if(null==n)return t;if(null!=n&&(16&n.h||h===n.pf))return n.wa(null,e,t);if(Rc(n))return-1<e&&e<n.length?n[0|e]:t;if("string"==typeof n)return-1<e&&e<n.length?n.charAt(0|e):t;if(null!=n&&(64&n.h||h===n.D)||null!=n&&(16777216&n.h||h===n.Ee))return 0>e?t:Ff(n,e,t);if(Xc(pd,n))return qd(n,e,t);throw Error(["nth not supported on this type ",q.a($c(Yc(n)))].join(""))}Cf.o=function(){return I},Cf.a=function(n){return n},Cf.b=function(n,e){return null!=n?od(n,e):new Df(null,e,null,1,null)},Cf.g=function(n,e,t){for(;;){if(!p(t))return Cf.b(n,e);n=Cf.b(n,e),e=C(t),t=D(t)}},Cf.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},Cf.F=2;var x=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};x.b=function(n,e){return null==n?null:null!=n&&(256&n.h||h===n.hg)?n.ia(null,e):Rc(n)?null!=e&&e<n.length?n[0|e]:null:"string"==typeof n?null!=e&&-1<e&&e<n.length?n.charAt(0|e):null:Xc(wd,n)?xd(n,e):null},x.c=function(n,e,t){return null!=n?null!=n&&(256&n.h||h===n.hg)?n.M(null,e,t):Rc(n)?null!=e&&-1<e&&e<n.length?n[0|e]:t:"string"==typeof n?null!=e&&-1<e&&e<n.length?n.charAt(0|e):t:Xc(wd,n)?xd(n,e,t):t:t},x.F=3;var K=function n(e){switch(arguments.length){case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],new Qe(t.slice(3),0,null))}};K.c=function(n,e,t){return null!=n&&(512&n.h||h===n.ag)?n.fa(null,e,t):null!=n?zd(n,e,t):Gf([e,t])},K.g=function(n,e,t,r){for(;;){if(n=K.c(n,e,t),!p(r))return n;e=C(r),t=zf(r),r=D(D(r))}},K.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);return t=C(r),r=D(r),this.g(e,n,t,r)},K.F=3;var Hf=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function If(n){var e=fb(n);return e||(null!=n?h===n.mf||!n.Ke&&Xc(hd,n):Xc(hd,n))}function Jf(n,e){this.P=n,this.H=e,this.h=393217,this.I=0}function Kf(n,e){return fb(n)?new Jf(n,e):null==n?null:Pd(n,e)}function Lf(n){return null!=n&&(null!=n?131072&n.h||h===n.xd||!n.h&&Xc(Md,n):Xc(Md,n))?Nd(n):null}function Mf(n){return null==n?null:Hd(n)}function Nf(n){return null==n?null:Id(n)}Hf.a=function(n){return n},Hf.b=function(n,e){return null==n?null:Cd(n,e)},Hf.g=function(n,e,t){for(;;){if(null==n)return null;if(n=Hf.b(n,e),!p(t))return n;e=C(t),t=D(t)}},Hf.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},Hf.F=2,g=Jf.prototype,g.N=function(){return this.H},g.O=function(n,e){return new Jf(this.P,e)},g.mf=h,g.call=function(){function n(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$){return n=this,Oe.Be?Oe.Be(n.P,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$):Oe.call(null,n.P,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$)}function e(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b){return(n=this).P.rb?n.P.rb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b)}function t(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y){return(n=this).P.hb?n.P.hb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y)}function r(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m){return(n=this).P.qb?n.P.qb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m)}function i(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){return(n=this).P.gb?n.P.gb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v)}function o(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){return(n=this).P.pb?n.P.pb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w)}function l(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g){return(n=this).P.fb?n.P.fb(e,t,r,i,o,l,u,s,a,c,d,h,f,p,g):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g)}function u(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p){return(n=this).P.ob?n.P.ob(e,t,r,i,o,l,u,s,a,c,d,h,f,p):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,p)}function s(n,e,t,r,i,o,l,u,s,a,c,d,h,f){return(n=this).P.eb?n.P.eb(e,t,r,i,o,l,u,s,a,c,d,h,f):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f)}function a(n,e,t,r,i,o,l,u,s,a,c,d,h){return(n=this).P.nb?n.P.nb(e,t,r,i,o,l,u,s,a,c,d,h):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d,h)}function c(n,e,t,r,i,o,l,u,s,a,c,d){return(n=this).P.cb?n.P.cb(e,t,r,i,o,l,u,s,a,c,d):n.P.call(null,e,t,r,i,o,l,u,s,a,c,d)}function d(n,e,t,r,i,o,l,u,s,a,c){return(n=this).P.mb?n.P.mb(e,t,r,i,o,l,u,s,a,c):n.P.call(null,e,t,r,i,o,l,u,s,a,c)}function h(n,e,t,r,i,o,l,u,s,a){return(n=this).P.Xa?n.P.Xa(e,t,r,i,o,l,u,s,a):n.P.call(null,e,t,r,i,o,l,u,s,a)}function f(n,e,t,r,i,o,l,u,s){return(n=this).P.Ga?n.P.Ga(e,t,r,i,o,l,u,s):n.P.call(null,e,t,r,i,o,l,u,s)}function p(n,e,t,r,i,o,l,u){return(n=this).P.ib?n.P.ib(e,t,r,i,o,l,u):n.P.call(null,e,t,r,i,o,l,u)}function g(n,e,t,r,i,o,l){return(n=this).P.la?n.P.la(e,t,r,i,o,l):n.P.call(null,e,t,r,i,o,l)}function w(n,e,t,r,i,o){return(n=this).P.K?n.P.K(e,t,r,i,o):n.P.call(null,e,t,r,i,o)}function v(n,e,t,r,i){return(n=this).P.A?n.P.A(e,t,r,i):n.P.call(null,e,t,r,i)}function m(n,e,t,r){return(n=this).P.c?n.P.c(e,t,r):n.P.call(null,e,t,r)}function y(n,e,t){return(n=this).P.b?n.P.b(e,t):n.P.call(null,e,t)}function b(n,e){return(n=this).P.a?n.P.a(e):n.P.call(null,e)}function $(n){return(n=this).P.o?n.P.o():n.P.call(null)}var _;return(_=function(_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L){switch(arguments.length){case 1:return $.call(this,_);case 2:return b.call(this,_,S);case 3:return y.call(this,_,S,I);case 4:return m.call(this,_,S,I,C);case 5:return v.call(this,_,S,I,C,R);case 6:return w.call(this,_,S,I,C,R,A);case 7:return g.call(this,_,S,I,C,R,A,E);case 8:return p.call(this,_,S,I,C,R,A,E,D);case 9:return f.call(this,_,S,I,C,R,A,E,D,x);case 10:return h.call(this,_,S,I,C,R,A,E,D,x,T);case 11:return d.call(this,_,S,I,C,R,A,E,D,x,T,k);case 12:return c.call(this,_,S,I,C,R,A,E,D,x,T,k,O);case 13:return a.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M);case 14:return s.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j);case 15:return u.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N);case 16:return l.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q);case 17:return o.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P);case 18:return i.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G);case 19:return r.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W);case 20:return t.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q);case 21:return e.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J);case 22:return n.call(this,_,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L)}throw Error("Invalid arity: "+(arguments.length-1))}).a=$,_.b=b,_.c=y,_.A=m,_.K=v,_.la=w,_.ib=g,_.Ga=p,_.Xa=f,_.mb=h,_.cb=d,_.nb=c,_.eb=a,_.ob=s,_.fb=u,_.pb=l,_.gb=o,_.qb=i,_.hb=r,_.rb=t,_.Sc=e,_.Be=n,_}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.o=function(){return this.P.o?this.P.o():this.P.call(null)},g.a=function(n){return this.P.a?this.P.a(n):this.P.call(null,n)},g.b=function(n,e){return this.P.b?this.P.b(n,e):this.P.call(null,n,e)},g.c=function(n,e,t){return this.P.c?this.P.c(n,e,t):this.P.call(null,n,e,t)},g.A=function(n,e,t,r){return this.P.A?this.P.A(n,e,t,r):this.P.call(null,n,e,t,r)},g.K=function(n,e,t,r,i){return this.P.K?this.P.K(n,e,t,r,i):this.P.call(null,n,e,t,r,i)},g.la=function(n,e,t,r,i,o){return this.P.la?this.P.la(n,e,t,r,i,o):this.P.call(null,n,e,t,r,i,o)},g.ib=function(n,e,t,r,i,o,l){return this.P.ib?this.P.ib(n,e,t,r,i,o,l):this.P.call(null,n,e,t,r,i,o,l)},g.Ga=function(n,e,t,r,i,o,l,u){return this.P.Ga?this.P.Ga(n,e,t,r,i,o,l,u):this.P.call(null,n,e,t,r,i,o,l,u)},g.Xa=function(n,e,t,r,i,o,l,u,s){return this.P.Xa?this.P.Xa(n,e,t,r,i,o,l,u,s):this.P.call(null,n,e,t,r,i,o,l,u,s)},g.mb=function(n,e,t,r,i,o,l,u,s,a){return this.P.mb?this.P.mb(n,e,t,r,i,o,l,u,s,a):this.P.call(null,n,e,t,r,i,o,l,u,s,a)},g.cb=function(n,e,t,r,i,o,l,u,s,a,c){return this.P.cb?this.P.cb(n,e,t,r,i,o,l,u,s,a,c):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c)},g.nb=function(n,e,t,r,i,o,l,u,s,a,c,d){return this.P.nb?this.P.nb(n,e,t,r,i,o,l,u,s,a,c,d):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d)},g.eb=function(n,e,t,r,i,o,l,u,s,a,c,d,h){return this.P.eb?this.P.eb(n,e,t,r,i,o,l,u,s,a,c,d,h):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h)},g.ob=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f){return this.P.ob?this.P.ob(n,e,t,r,i,o,l,u,s,a,c,d,h,f):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f)},g.fb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p){return this.P.fb?this.P.fb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p)},g.pb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g){return this.P.pb?this.P.pb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g)},g.gb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){return this.P.gb?this.P.gb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w)},g.qb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){return this.P.qb?this.P.qb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v)},g.hb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m){return this.P.hb?this.P.hb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m)},g.rb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y){return this.P.rb?this.P.rb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y):this.P.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y)},g.Sc=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b){return Oe.Be?Oe.Be(this.P,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b):Oe.call(null,this.P,n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b)};var Of=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function Pf(n){return null==n||Tc(B(n))}function Qf(n){return null!=n&&(null!=n?!!(8&n.h||h===n.Lh)||!n.h&&Xc(nd,n):Xc(nd,n))}function Rf(n){return null!=n&&(null!=n?!!(4096&n.h||h===n.Wh)||!n.h&&Xc(Fd,n):Xc(Fd,n))}function Sf(n){return null!=n?!!(512&n.h||h===n.ag)||!n.h&&Xc(yd,n):Xc(yd,n)}function Tf(n){return null!=n?!!(16777216&n.h||h===n.Ee)||!n.h&&Xc(Yd,n):Xc(Yd,n)}function M(n){return null!=n&&(null!=n?!!(1024&n.h||h===n.Sh)||!n.h&&Xc(Bd,n):Xc(Bd,n))}function Uf(n){return null!=n?!!(67108864&n.h||h===n.kg)||!n.h&&Xc($d,n):Xc($d,n)}function Vf(n){return null!=n?!!(16384&n.h||h===n.Xh)||!n.h&&Xc(Jd,n):Xc(Jd,n)}function Wf(n){return null!=n&&!!(512&n.I||h===n.Kh)}function Xf(n,e,t,r,i){for(;0!==i;)t[r]=n[e],r+=1,--i,e+=1}Of.a=function(n){return n},Of.b=function(n,e){return null==n?null:Gd(n,e)},Of.g=function(n,e,t){for(;;){if(null==n)return null;if(n=Of.b(n,e),!p(t))return n;e=C(t),t=D(t)}},Of.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},Of.F=2;var Yf={};function Zf(n){return!0===n||!1===n}function $f(n){return null!=n&&(null!=n?!!(64&n.h||h===n.D)||!n.h&&Xc(rd,n):Xc(rd,n))}function ag(n){return null!=n&&!1!==n}function bg(n){return"number"==typeof n&&!isNaN(n)&&1/0!==n&&parseFloat(n)===parseInt(n,10)}function cg(n){return bg(n)||n instanceof xb}function N(n,e){return x.c(n,e,Yf)!==Yf}function dg(n,e){if(n===e)return 0;if(null==n)return-1;if(null==e)return 1;if("number"==typeof n){if("number"==typeof e)return Pb(n,e);throw Error(["Cannot compare ",q.a(n)," to ",q.a(e)].join(""))}if(null!=n?2048&n.I||h===n.Oc||!n.I&&Xc(oe,n):Xc(oe,n))return pe(n,e);if("string"!=typeof n&&!Rc(n)&&!0!==n&&!1!==n||Yc(n)!==Yc(e))throw Error(["Cannot compare ",q.a(n)," to ",q.a(e)].join(""));return Pb(n,e)}function eg(n,e){var t=F(n),r=F(e);if(t<r)n=-1;else if(t>r)n=1;else if(0===t)n=0;else n:for(r=0;;){var i=dg(pf(n,r),pf(e,r));if(!(0===i&&r+1<t)){n=i;break n}r+=1}return n}function fg(n){return A.b(n,dg)?dg:function(e,t){var r=n.b?n.b(e,t):n.call(null,e,t);return"number"==typeof r?r:p(r)?-1:p(n.b?n.b(t,e):n.call(null,t,e))?1:0}}function gg(n){var e=Ub(cd);return B(e)?(Qb(e=hg.a?hg.a(e):hg.call(null,e),fg(n)),B(e)):Se}function xf(n){switch(arguments.length){case 2:return wf(arguments[0],arguments[1]);case 3:return yf(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function wf(n,e){var t=B(e);return t?(e=C(t),t=D(t),gd.c?gd.c(n,e,t):gd.call(null,n,e,t)):n.o?n.o():n.call(null)}function yf(n,e,r){for(r=B(r);;){if(!r)return e;var i=C(r);if(cf(e=n.b?n.b(e,i):n.call(null,e,i)))return t(e);r=D(r)}}function ig(n,e){if(!p((n=ze(n)).ra()))return e.o?e.o():e.call(null);for(var r=n.next();;){if(!n.ra())return r;var i=n.next();if(cf(r=e.b?e.b(r,i):e.call(null,r,i)))return t(r)}}function jg(n,e,r){for(n=ze(n);;){if(!n.ra())return r;var i=n.next();if(cf(r=e.b?e.b(r,i):e.call(null,r,i)))return t(r)}}var gd=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function kg(n,e,t){return null!=t?Td(t,n,e):e}function lg(n){return n}function mg(n,e){return function(){function t(e,t){return n.b?n.b(e,t):n.call(null,e,t)}function r(n){return e.a?e.a(n):e.call(null,n)}function i(){return n.o?n.o():n.call(null)}var o;return(o=function(n,e){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,n);case 2:return t.call(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).o=i,o.a=r,o.b=t,o}()}function ng(n,e,t){return og(n,e,e.o?e.o():e.call(null),t)}function og(n,e,t,r){return n=n.a?n.a(e):n.call(null,e),t=gd.c(n,t,r),n.a?n.a(t):n.call(null,t)}gd.b=function(n,e){return null!=e&&(524288&e.h||h===e.lg)?e.Ba(null,n):Rc(e)||"string"==typeof e?hf(e,n):Xc(Qd,e)?Rd(e,n):Pe(e)?ig(e,n):wf(n,e)},gd.c=function(n,e,t){return null!=t&&(524288&t.h||h===t.lg)?t.Ca(null,n,e):Rc(t)||"string"==typeof t?jf(t,n,e):Xc(Qd,t)?Rd(t,n,e):Pe(t)?jg(t,n,e):yf(n,e,t)},gd.F=3;var pg=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};pg.o=function(){return 0},pg.a=function(n){return n},pg.b=function(n,e){return n+e},pg.g=function(n,e,t){return gd.c(pg,n+e,t)},pg.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},pg.F=2;var qg=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function rg(n){if("number"==typeof n)return String.fromCharCode(n);if("string"==typeof n&&1===n.length)return n;throw Error("Argument to char must be a character or number")}function sg(n){return 0<=n?Math.floor(n):Math.ceil(n)}function tg(n,e){return sg((n-n%e)/e)}function ug(n,e){return n-e*tg(n,e)}function vg(n){return 16843009*((n=(858993459&(n-=n>>1&1431655765))+(n>>2&858993459))+(n>>4)&252645135)>>24}function wg(n){switch(arguments.length){case 1:return!0;case 2:return Ud(arguments[0],arguments[1]);default:for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;n:for(t=arguments[0],r=arguments[1],e=new Qe(e.slice(2),0,null);;){if(t!==r){t=!1;break n}if(!D(e)){t=r===C(e);break n}t=r,r=C(e),e=D(e)}return t}}function xg(n,e){return Ud(n,e)}function yg(n){return 0<n}qg.a=function(){return!0},qg.b=function(n,e){return n>e},qg.g=function(n,e,t){for(;;){if(!(n>e))return!1;if(!D(t))return e>C(t);n=e,e=C(t),t=D(t)}},qg.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},qg.F=2;var q=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],new Qe(t.slice(1),0,null))}};function zg(n){switch(arguments.length){case 2:return arguments[0].substring(arguments[1]);case 3:return arguments[0].substring(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function Ag(n,e){return n.substring(e)}function Bg(n,e,t){return n.substring(e,t)}function uf(n,e){if(Tf(e))if(lf(n)&&lf(e)&&F(n)!==F(e))n=!1;else n:for(n=B(n),e=B(e);;){if(null==n){n=null==e;break n}if(null==e||!A.b(C(n),C(e))){n=!1;break n}n=D(n),e=D(e)}else n=null;return ag(n)}function Df(n,e,t,r,i){this.H=n,this.first=e,this.ab=t,this.count=r,this.B=i,this.h=65937646,this.I=8192}function Cg(n){return null!=n?!!(33554432&n.h||h===n.Rh)||!n.h&&Xc(Zd,n):Xc(Zd,n)}function Dg(n){this.H=n,this.h=65937614,this.I=8192}q.o=function(){return""},q.a=function(n){return null==n?"":[n].join("")},q.g=function(n,e){for(n=new zc(q.a(n));;){if(!p(e))return n.toString();n=n.append(q.a(C(e))),e=D(e)}},q.G=function(n){var e=C(n);return n=D(n),this.g(e,n)},q.F=1,g=Df.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,this.count)}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return 1===this.count?null:this.ab},g.X=function(){return this.count},g.Xb=function(){return this.first},g.Yb=function(){return this.Ha(null)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Pd(Se,this.H)},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return this.first},g.Ha=function(){return 1===this.count?Se:this.ab},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new Df(e,this.first,this.ab,this.count,this.B)},g.ga=function(n,e){return new Df(this.H,e,this,this.count+1,null)},Df.prototype[ad]=function(){return Ue(this)},g=Dg.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return null},g.X=function(){return 0},g.Xb=function(){return null},g.Yb=function(){throw Error("Can't pop empty list")},g.Z=function(){return Xe},g.Y=function(n,e){return!(!Cg(e)&&!Tf(e))&&null==B(e)},g.pa=function(){return this},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return null},g.Ha=function(){return Se},g.$=function(){return null},g.O=function(n,e){return e===this.H?this:new Dg(e)},g.ga=function(n,e){return new Df(this.H,e,null,1,null)};var Se=new Dg(null);function Eg(n){return(null!=n?134217728&n.h||h===n.Vh||!n.h&&Xc(ae,n):Xc(ae,n))?(n=be(n))?n:Se:gd.c(Cf,Se,n)}Dg.prototype[ad]=function(){return Ue(this)};var O=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function Fg(n,e,t,r){this.H=n,this.first=e,this.ab=t,this.B=r,this.h=65929452,this.I=8192}function vf(n,e){return null==e?new Df(null,n,null,1,null):null!=e&&(64&e.h||h===e.D)?new Fg(null,n,e,null):new Fg(null,n,B(e),null)}function Gg(n,e){if(n.da===e.da)return 0;if(p(!!Tc(n.vb)&&e.vb))return-1;if(p(n.vb)){if(Tc(e.vb))return 1;var t=Pb(n.vb,e.vb);return 0===t?Pb(n.name,e.name):t}return Pb(n.name,e.name)}function z(n,e,t,r){this.vb=n,this.name=e,this.da=t,this.ed=r,this.h=2153775105,this.I=4096}function Hg(n){return n instanceof z}function P(n,e){return n===e||n instanceof z&&e instanceof z&&n.da===e.da}function Ig(n){if(null!=n&&(4096&n.I||h===n.jg))return n.zd(null);throw Error(["Doesn't support namespace: ",q.a(n)].join(""))}function Jg(n){return n instanceof z||n instanceof w}O.g=function(n){if(n instanceof Qe&&0===n.J)var e=n.l;else n:for(e=[];null!=n;)e.push(sd(n)),n=vd(n);n=e.length;for(var t=Se;;){if(!(0<n))return t;var r=n-1;t=od(t,e[n-1]),n=r}},O.F=0,O.G=function(n){return this.g(B(n))},g=Fg.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return null==this.ab?null:B(this.ab)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return this.first},g.Ha=function(){return null==this.ab?Se:this.ab},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new Fg(e,this.first,this.ab,this.B)},g.ga=function(n,e){return new Fg(null,e,this,null)},Fg.prototype[ad]=function(){return Ue(this)},g=z.prototype,g.toString=function(){return[":",q.a(this.da)].join("")},g.Y=function(n,e){return e instanceof z&&this.da===e.da},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return x.b(e,this);case 3:return x.c(e,this,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return x.b(e,this)},n.c=function(n,e,t){return x.c(e,this,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return x.b(n,this)},g.b=function(n,e){return x.c(n,this,e)},g.Z=function(){var n=this.ed;return null!=n?n:this.ed=n=Ke(this)+2654435769|0},g.yd=function(){return this.name},g.zd=function(){return this.vb},g.S=function(n,e){return ce(e,[":",q.a(this.da)].join(""))};var Kg=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function Mg(n,e,t,r){this.H=n,this.od=e,this.ha=t,this.B=r,this.h=32374988,this.I=1}function Ng(n){return null!=n.od&&(n.ha=n.od.o?n.od.o():n.od.call(null),n.od=null),n.ha}function Og(n){this.ca=n,this.end=0,this.h=2,this.I=0}function Qg(n){return new Og(Array(n))}function Pg(n,e,t){this.l=n,this.$a=e,this.end=t,this.h=524306,this.I=0}function Rg(n,e,t,r){this.Bb=n,this.lc=e,this.H=t,this.B=r,this.h=31850732,this.I=1536}function Sg(n,e){return 0===kd(n)?e:new Rg(n,e,null,null)}function Tg(n,e){n.add(e)}function Ug(n){return n.Bb()}function hg(n){var e=[];for(n=B(n);;){if(null==n)return e;e.push(C(n)),n=D(n)}}function Vg(n,e){if(lf(e))return F(e);var t=0;for(e=B(e);;){if(!(null!=e&&t<n))return t;t+=1,e=D(e)}}Kg.a=function(n){if(n instanceof z)return n;if(n instanceof w)return new z(Ig(n),Lg.a?Lg.a(n):Lg.call(null,n),n.wc,null);if(A.b("/",n))return new z(null,n,n,null);if("string"==typeof n){var e=n.split("/");return 2===e.length?new z(e[0],e[1],n,null):new z(null,e[0],n,null)}return null},Kg.b=function(n,e){return new z(n=n instanceof z||n instanceof w?Lg.a?Lg.a(n):Lg.call(null,n):n,e=e instanceof z||e instanceof w?Lg.a?Lg.a(e):Lg.call(null,e):e,[p(n)?[q.a(n),"/"].join(""):null,q.a(e)].join(""),null)},Kg.F=2,g=Mg.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return this.$(null),null==this.ha?null:D(this.ha)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Pd(Se,this.H)},g.Bd=function(){return Tc(this.od)},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return this.$(null),null==this.ha?null:C(this.ha)},g.Ha=function(){return this.$(null),null!=this.ha?Re(this.ha):Se},g.$=function(){if(Ng(this),null==this.ha)return null;for(var n=this.ha;;){if(!(n instanceof Mg))return this.ha=n,B(this.ha);n=Ng(n)}},g.O=function(n,e){var t=this;return e===this.H?t:new Mg(e,(function(){return t.$(null)}),null,this.B)},g.ga=function(n,e){return vf(e,this)},Mg.prototype[ad]=function(){return Ue(this)},Og.prototype.add=function(n){return this.ca[this.end]=n,this.end+=1},Og.prototype.Bb=function(){var n=new Pg(this.ca,0,this.end);return this.ca=null,n},Og.prototype.X=function(){return this.end},g=Pg.prototype,g.X=function(){return this.end-this.$a},g.W=function(n,e){return this.l[this.$a+e]},g.wa=function(n,e,t){return 0<=e&&e<this.end-this.$a?this.l[this.$a+e]:t},g.ze=function(){if(this.$a===this.end)throw Error("-drop-first of empty chunk");return new Pg(this.l,this.$a+1,this.end)},g.Ba=function(n,e){return kf(this.l,e,this.l[this.$a],this.$a+1)},g.Ca=function(n,e,t){return kf(this.l,e,t,this.$a)},g=Rg.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return 1<kd(this.Bb)?new Rg(qe(this.Bb),this.lc,null,null):null==this.lc?null:Xd(this.lc)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Fa=function(){return qd(this.Bb,0)},g.Ha=function(){return 1<kd(this.Bb)?new Rg(qe(this.Bb),this.lc,null,null):null==this.lc?Se:this.lc},g.$=function(){return this},g.$d=function(){return this.Bb},g.gd=function(){return null==this.lc?Se:this.lc},g.O=function(n,e){return e===this.H?this:new Rg(this.Bb,this.lc,e,this.B)},g.ga=function(n,e){return vf(e,this)},g.Ae=function(){return null==this.lc?null:this.lc},Rg.prototype[ad]=function(){return Ue(this)};var Wg=function n(e){if(null==e)return null;var t=D(e);return null==t?B(C(e)):vf(C(e),n.a?n.a(t):n.call(null,t))},Xg=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};Xg.o=function(){return new Mg(null,(function(){return null}),null,null)},Xg.a=function(n){return new Mg(null,(function(){return n}),null,null)},Xg.b=function(n,e){return new Mg(null,(function(){var t=B(n);return t?Wf(t)?Sg(re(t),Xg.b(se(t),e)):vf(C(t),Xg.b(Re(t),e)):e}),null,null)},Xg.g=function(n,e,t){return function n(e,t){return new Mg(null,(function(){var r=B(e);return r?Wf(r)?Sg(re(r),n(se(r),t)):vf(C(r),n(Re(r),t)):p(t)?n(C(t),D(t)):null}),null,null)}(Xg.b(n,e),t)},Xg.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},Xg.F=2;var Yg=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function Zg(n,e,t){return me(n,e,t)}function $g(n,e,t){var r=B(t);if(0===e)return n.o?n.o():n.call(null);t=sd(r);var i=td(r);if(1===e)return n.a?n.a(t):n.call(null,t);r=sd(i);var o=td(i);if(2===e)return n.b?n.b(t,r):n.call(null,t,r);i=sd(o);var l=td(o);if(3===e)return n.c?n.c(t,r,i):n.call(null,t,r,i);o=sd(l);var u=td(l);if(4===e)return n.A?n.A(t,r,i,o):n.call(null,t,r,i,o);l=sd(u);var s=td(u);if(5===e)return n.K?n.K(t,r,i,o,l):n.call(null,t,r,i,o,l);u=sd(s);var a=td(s);if(6===e)return n.la?n.la(t,r,i,o,l,u):n.call(null,t,r,i,o,l,u);s=sd(a);var c=td(a);if(7===e)return n.ib?n.ib(t,r,i,o,l,u,s):n.call(null,t,r,i,o,l,u,s);a=sd(c);var d=td(c);if(8===e)return n.Ga?n.Ga(t,r,i,o,l,u,s,a):n.call(null,t,r,i,o,l,u,s,a);c=sd(d);var h=td(d);if(9===e)return n.Xa?n.Xa(t,r,i,o,l,u,s,a,c):n.call(null,t,r,i,o,l,u,s,a,c);d=sd(h);var f=td(h);if(10===e)return n.mb?n.mb(t,r,i,o,l,u,s,a,c,d):n.call(null,t,r,i,o,l,u,s,a,c,d);h=sd(f);var p=td(f);if(11===e)return n.cb?n.cb(t,r,i,o,l,u,s,a,c,d,h):n.call(null,t,r,i,o,l,u,s,a,c,d,h);f=sd(p);var g=td(p);if(12===e)return n.nb?n.nb(t,r,i,o,l,u,s,a,c,d,h,f):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f);p=sd(g);var w=td(g);if(13===e)return n.eb?n.eb(t,r,i,o,l,u,s,a,c,d,h,f,p):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p);g=sd(w);var v=td(w);if(14===e)return n.ob?n.ob(t,r,i,o,l,u,s,a,c,d,h,f,p,g):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g);w=sd(v);var m=td(v);if(15===e)return n.fb?n.fb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w);v=sd(m);var y=td(m);if(16===e)return n.pb?n.pb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v);m=sd(y);var b=td(y);if(17===e)return n.gb?n.gb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m);y=sd(b);var $=td(b);if(18===e)return n.qb?n.qb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y);if(b=sd($),$=td($),19===e)return n.hb?n.hb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b);var _=sd($);if(td($),20===e)return n.rb?n.rb(t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,_):n.call(null,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,_);throw Error("Only up to 20 arguments supported on functions")}function ah(n){return null!=n&&(128&n.h||h===n.Ad)?n.za(null):B(Re(n))}function bh(n,e,t){return null==t?n.a?n.a(e):n.call(n,e):ch(n,e,sd(t),ah(t))}function ch(n,e,t,r){return null==r?n.b?n.b(e,t):n.call(n,e,t):dh(n,e,t,sd(r),ah(r))}function dh(n,e,t,r,i){return null==i?n.c?n.c(e,t,r):n.call(n,e,t,r):eh(n,e,t,r,sd(i),ah(i))}function eh(n,e,t,r,i,o){if(null==o)return n.A?n.A(e,t,r,i):n.call(n,e,t,r,i);var l=sd(o),u=D(o);if(null==u)return n.K?n.K(e,t,r,i,l):n.call(n,e,t,r,i,l);o=sd(u);var s=D(u);if(null==s)return n.la?n.la(e,t,r,i,l,o):n.call(n,e,t,r,i,l,o);u=sd(s);var a=D(s);if(null==a)return n.ib?n.ib(e,t,r,i,l,o,u):n.call(n,e,t,r,i,l,o,u);s=sd(a);var c=D(a);if(null==c)return n.Ga?n.Ga(e,t,r,i,l,o,u,s):n.call(n,e,t,r,i,l,o,u,s);a=sd(c);var d=D(c);if(null==d)return n.Xa?n.Xa(e,t,r,i,l,o,u,s,a):n.call(n,e,t,r,i,l,o,u,s,a);c=sd(d);var h=D(d);if(null==h)return n.mb?n.mb(e,t,r,i,l,o,u,s,a,c):n.call(n,e,t,r,i,l,o,u,s,a,c);d=sd(h);var f=D(h);if(null==f)return n.cb?n.cb(e,t,r,i,l,o,u,s,a,c,d):n.call(n,e,t,r,i,l,o,u,s,a,c,d);h=sd(f);var p=D(f);if(null==p)return n.nb?n.nb(e,t,r,i,l,o,u,s,a,c,d,h):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h);f=sd(p);var g=D(p);if(null==g)return n.eb?n.eb(e,t,r,i,l,o,u,s,a,c,d,h,f):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f);p=sd(g);var w=D(g);if(null==w)return n.ob?n.ob(e,t,r,i,l,o,u,s,a,c,d,h,f,p):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p);g=sd(w);var v=D(w);if(null==v)return n.fb?n.fb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g);w=sd(v);var m=D(v);if(null==m)return n.pb?n.pb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w);v=sd(m);var y=D(m);if(null==y)return n.gb?n.gb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v);m=sd(y);var b=D(y);if(null==b)return n.qb?n.qb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m);y=sd(b);var $=D(b);if(null==$)return n.hb?n.hb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m,y):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m,y);if(b=sd($),null==($=D($)))return n.rb?n.rb(e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m,y,b):n.call(n,e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m,y,b);for(e=[e,t,r,i,l,o,u,s,a,c,d,h,f,p,g,w,v,m,y,b],t=$;t;)e.push(sd(t)),t=D(t);return n.apply(n,e)}function Oe(n){switch(arguments.length){case 2:return fh(arguments[0],arguments[1]);case 3:return gh(arguments[0],arguments[1],arguments[2]);case 4:return hh(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return ih(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return jh(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],new Qe(e.slice(5),0,null))}}function fh(n,e){if(n.G){var t=n.F,r=Vg(t+1,e);return r<=t?$g(n,r,e):n.G(e)}return null==(e=B(e))?n.o?n.o():n.call(n):bh(n,sd(e),ah(e))}function gh(n,e,t){if(n.G){e=vf(e,t);var r=n.F;return(t=Vg(r,t)+1)<=r?$g(n,t,e):n.G(e)}return bh(n,e,B(t))}function hh(n,e,t,r){return n.G?(e=vf(e,vf(t,r)),(r=2+Vg((t=n.F)-1,r))<=t?$g(n,r,e):n.G(e)):ch(n,e,t,B(r))}function ih(n,e,t,r,i){return n.G?(e=vf(e,vf(t,vf(r,i))),(i=3+Vg((t=n.F)-2,i))<=t?$g(n,i,e):n.G(e)):dh(n,e,t,r,B(i))}function jh(n,e,t,r,i,o){return n.G?(e=vf(e,vf(t,vf(r,vf(i,o=Wg(o))))),(o=4+Vg((t=n.F)-3,o))<=t?$g(n,o,e):n.G(e)):eh(n,e,t,r,i,Wg(o))}Yg.o=function(){return je(I)},Yg.a=function(n){return n},Yg.b=function(n,e){return ke(n,e)},Yg.g=function(n,e,t){for(;;){if(n=ke(n,e),!p(t))return n;e=C(t),t=D(t)}},Yg.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},Yg.F=2;var kh=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function lh(n){return B(n)?n:null}function mh(){return void 0!==Ac&&void 0!==Bc&&void 0!==vv||((vv=function(n){this.hh=n,this.h=393216,this.I=0}).prototype.O=function(n,e){return new vv(e)},vv.prototype.N=function(){return this.hh},vv.prototype.ra=function(){return!1},vv.prototype.next=function(){return Error("No such element")},vv.prototype.remove=function(){return Error("Unsupported operation")},vv.Pa=function(){return new Q(null,1,5,R,[CD],null)},vv.Ia=!0,vv.Da="cljs.core/t_cljs$core7592",vv.Ja=function(n){return ce(n,"cljs.core/t_cljs$core7592")}),new vv(S)}function oh(n){this.ha=n,this.J=0}function ph(n){this.l=n,this.J=0}kh.a=function(){return!1},kh.b=function(n,e){return!A.b(n,e)},kh.g=function(n,e,t){return Tc(hh(A,n,e,t))},kh.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},kh.F=2,oh.prototype.ra=function(){return this.J<this.ha.length},oh.prototype.next=function(){var n=this.ha.charAt(this.J);return this.J+=1,n},oh.prototype.remove=function(){return Error("Unsupported operation")},ph.prototype.ra=function(){return this.J<this.l.length},ph.prototype.next=function(){var n=this.l[this.J];return this.J+=1,n},ph.prototype.remove=function(){return Error("Unsupported operation")};var qh={},rh={};function sh(n){this.vd=qh,this.Hb=n}function th(n){if(Pe(n))return ze(n);if(null==n)return mh();if("string"==typeof n)return new oh(n);if(Rc(n))return new ph(n);var e=null==n;if(e||(e=(e=null!=n?!!(8388608&n.h||h===n.qf)||!n.h&&Xc(Wd,n):Xc(Wd,n))?e:Rc(n)||"string"==typeof n),e)return new sh(n);throw Error(["Cannot create iterator from ",q.a(n)].join(""))}function uh(n){this.te=n}sh.prototype.ra=function(){return this.vd===qh?(this.vd=rh,this.Hb=B(this.Hb)):this.vd===this.Hb&&(this.Hb=D(this.vd)),null!=this.Hb},sh.prototype.next=function(){if(this.ra())return this.vd=this.Hb,C(this.Hb);throw Error("No such element")},sh.prototype.remove=function(){return Error("Unsupported operation")},uh.prototype.add=function(n){return this.te.push(n),this},uh.prototype.remove=function(){return this.te.shift()},uh.prototype.Nd=function(){return 0===this.te.length},uh.prototype.toString=function(){return["Many: ",q.a(this.te)].join("")};var vh={};function wh(n){this.m=n}function xh(){}wh.prototype.add=function(n){return this.m===vh?(this.m=n,this):new uh([this.m,n])},wh.prototype.remove=function(){if(this.m===vh)throw Error("Removing object from empty buffer");var n=this.m;return this.m=vh,n},wh.prototype.Nd=function(){return this.m===vh},wh.prototype.toString=function(){return["Single: ",q.a(this.m)].join("")},xh.prototype.add=function(n){return new wh(n)},xh.prototype.remove=function(){throw Error("Removing object from empty buffer")},xh.prototype.Nd=function(){return!0},xh.prototype.toString=function(){return"Empty"};var yh=new xh,zh=function n(e){return new Mg(null,(function(){if(!e.ra())return null;for(var t=[],r=0;;){var i=e.ra();if(!p(p(i)?32>r:i))return Sg(new Pg(t,0,r),n.a?n.a(e):n.call(null,e));t[r]=e.next(),r+=1}}),null,null)};function Ah(n){this.buffer=yh,this.Hb=vh,this.Ne=!1,this.pc=null,this.Ze=n,this.oh=!1}function Bh(n,e){var t,r=new Ah(e);return r.pc=(t=function(){function n(n,e){return r.buffer=r.buffer.add(e),n}var e;return(e=function(e,t){switch(arguments.length){case 0:return null;case 1:return e;case 2:return n.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).o=function(){return null},e.a=function(n){return n},e.b=n,e}(),n.a?n.a(t):n.call(null,t)),r}function Ch(n){return $f(n)||(n=B(n))?n:Se}function Dh(n,e){for(;;){if(null==B(e))return!0;var t=C(e);if(!p(t=n.a?n.a(t):n.call(null,t)))return!1;e=D(e)}}function Eh(n,e){for(;;){if(!(e=B(e)))return null;var t=C(e);if(p(t=n.a?n.a(t):n.call(null,t)))return t;e=D(e)}}function Fh(n){if(bg(n))return 0==(1&n);throw Error(["Argument must be an integer: ",q.a(n)].join(""))}function Gh(n){return function(){function e(e,t){return Tc(n.b?n.b(e,t):n.call(null,e,t))}function t(e){return Tc(n.a?n.a(e):n.call(null,e))}function r(){return Tc(n.o?n.o():n.call(null))}var i,o=function(){function e(n,e,r){var i=null;if(2<arguments.length){i=0;for(var o=Array(arguments.length-2);i<o.length;)o[i]=arguments[i+2],++i;i=new Qe(o,0,null)}return t.call(this,n,e,i)}function t(e,t,r){return Tc(hh(n,e,t,r))}return e.F=2,e.G=function(n){return t(C(n),C(n=D(n)),n=Re(n))},e.g=t,e}();return(i=function(n,i,l){switch(arguments.length){case 0:return r.call(this);case 1:return t.call(this,n);case 2:return e.call(this,n,i);default:var u=null;if(2<arguments.length){u=0;for(var s=Array(arguments.length-2);u<s.length;)s[u]=arguments[u+2],++u;u=new Qe(s,0,null)}return o.g(n,i,u)}}).F=2,i.G=o.G,i.o=r,i.a=t,i.b=e,i.g=o.g,i}()}function Hh(n){return function(){function e(e){if(0<arguments.length)for(var t=0,r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;return n}return e.F=0,e.G=function(e){return B(e),n},e.g=function(){return n},e}()}Ah.prototype.step=function(){if(this.Hb!==vh)return!0;for(;;){if(this.Hb!==vh)return!0;if(this.buffer.Nd()){if(this.Ne)return!1;if(this.Ze.ra()){if(this.oh)var n=fh(this.pc,vf(null,this.Ze.next()));else n=this.Ze.next(),n=this.pc.b?this.pc.b(null,n):this.pc.call(null,null,n);cf(n)&&(this.pc.a?this.pc.a(null):this.pc.call(null,null),this.Ne=!0)}else this.pc.a?this.pc.a(null):this.pc.call(null,null),this.Ne=!0}else this.Hb=this.buffer.remove()}},Ah.prototype.ra=function(){return this.step()},Ah.prototype.next=function(){if(this.ra()){var n=this.Hb;return this.Hb=vh,n}throw Error("No such element")},Ah.prototype.remove=function(){return Error("Unsupported operation")},Ah.prototype[ad]=function(){return Ue(this)};var Ih=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],new Qe(t.slice(3),0,null))}};function Jh(n,e){return function(){function t(t,r,i){return n.A?n.A(e,t,r,i):n.call(null,e,t,r,i)}function r(t,r){return n.c?n.c(e,t,r):n.call(null,e,t,r)}function i(t){return n.b?n.b(e,t):n.call(null,e,t)}function o(){return n.a?n.a(e):n.call(null,e)}var l,u=function(){function t(n,e,t,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return r.call(this,n,e,t,o)}function r(t,r,i,o){return jh(n,e,t,r,i,G([o]))}return t.F=3,t.G=function(n){return r(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},t.g=r,t}();return(l=function(n,e,l,s){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,n);case 2:return r.call(this,n,e);case 3:return t.call(this,n,e,l);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Qe(c,0,null)}return u.g(n,e,l,a)}}).F=3,l.G=u.G,l.o=o,l.a=i,l.b=r,l.c=t,l.g=u.g,l}()}function Kh(n,e,t){return function(){function r(r,i,o){return n.K?n.K(e,t,r,i,o):n.call(null,e,t,r,i,o)}function i(r,i){return n.A?n.A(e,t,r,i):n.call(null,e,t,r,i)}function o(r){return n.c?n.c(e,t,r):n.call(null,e,t,r)}function l(){return n.b?n.b(e,t):n.call(null,e,t)}var u,s=function(){function r(n,e,t,r){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return i.call(this,n,e,t,o)}function i(r,i,o,l){return jh(n,e,t,r,i,G([o,l]))}return r.F=3,r.G=function(n){return i(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},r.g=i,r}();return(u=function(n,e,t,u){switch(arguments.length){case 0:return l.call(this);case 1:return o.call(this,n);case 2:return i.call(this,n,e);case 3:return r.call(this,n,e,t);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Qe(c,0,null)}return s.g(n,e,t,a)}}).F=3,u.G=s.G,u.o=l,u.a=o,u.b=i,u.c=r,u.g=s.g,u}()}function Lh(n,e,t,r){return function(){function i(i,o,l){return n.la?n.la(e,t,r,i,o,l):n.call(null,e,t,r,i,o,l)}function o(i,o){return n.K?n.K(e,t,r,i,o):n.call(null,e,t,r,i,o)}function l(i){return n.A?n.A(e,t,r,i):n.call(null,e,t,r,i)}function u(){return n.c?n.c(e,t,r):n.call(null,e,t,r)}var s,a=function(){function i(n,e,t,r){var i=null;if(3<arguments.length){i=0;for(var l=Array(arguments.length-3);i<l.length;)l[i]=arguments[i+3],++i;i=new Qe(l,0,null)}return o.call(this,n,e,t,i)}function o(i,o,l,u){return jh(n,e,t,r,i,G([o,l,u]))}return i.F=3,i.G=function(n){return o(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},i.g=o,i}();return(s=function(n,e,t,r){switch(arguments.length){case 0:return u.call(this);case 1:return l.call(this,n);case 2:return o.call(this,n,e);case 3:return i.call(this,n,e,t);default:var s=null;if(3<arguments.length){s=0;for(var c=Array(arguments.length-3);s<c.length;)c[s]=arguments[s+3],++s;s=new Qe(c,0,null)}return a.g(n,e,t,s)}}).F=3,s.G=a.G,s.o=u,s.a=l,s.b=o,s.c=i,s.g=a.g,s}()}function Mh(n,e){return function(){function t(t,r,i){return t=null==t?e:t,n.c?n.c(t,r,i):n.call(null,t,r,i)}function r(t,r){return t=null==t?e:t,n.b?n.b(t,r):n.call(null,t,r)}function i(t){return t=null==t?e:t,n.a?n.a(t):n.call(null,t)}var o,l=function(){function t(n,e,t,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return r.call(this,n,e,t,o)}function r(t,r,i,o){return ih(n,null==t?e:t,r,i,o)}return t.F=3,t.G=function(n){return r(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},t.g=r,t}();return(o=function(n,e,o,u){switch(arguments.length){case 1:return i.call(this,n);case 2:return r.call(this,n,e);case 3:return t.call(this,n,e,o);default:var s=null;if(3<arguments.length){s=0;for(var a=Array(arguments.length-3);s<a.length;)a[s]=arguments[s+3],++s;s=new Qe(a,0,null)}return l.g(n,e,o,s)}}).F=3,o.G=l.G,o.a=i,o.b=r,o.c=t,o.g=l.g,o}()}function Nh(n){this.state=n,this.bf=this.Tf=this.H=null,this.I=16386,this.h=6455296}function Oh(n){return new Nh(n)}function Ph(n,e){if(n instanceof Nh){var t=n.Tf;if(null!=t&&!p(t.a?t.a(e):t.call(null,e)))throw Error("Validator rejected reference state");return t=n.state,n.state=e,null!=n.bf&&n.Ge(null,t,e),e}return ve(n,e)}function Qh(n,e){var t=n.Tf;if(null!=t&&!p(t.a?t.a(e):t.call(null,e)))throw Error("Validator rejected reference state");return t=n.state,n.state=e,null!=n.bf&&ie(n,t,e),new Q(null,2,5,R,[t,e],null)}Ih.o=function(){return lg},Ih.a=function(n){return n},Ih.b=function(n,e){return function(){function t(t,r,i){return t=e.c?e.c(t,r,i):e.call(null,t,r,i),n.a?n.a(t):n.call(null,t)}function r(t,r){return t=e.b?e.b(t,r):e.call(null,t,r),n.a?n.a(t):n.call(null,t)}function i(t){return t=e.a?e.a(t):e.call(null,t),n.a?n.a(t):n.call(null,t)}function o(){var t=e.o?e.o():e.call(null);return n.a?n.a(t):n.call(null,t)}var l,u=function(){function t(n,e,t,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return r.call(this,n,e,t,o)}function r(t,r,i,o){return t=ih(e,t,r,i,o),n.a?n.a(t):n.call(null,t)}return t.F=3,t.G=function(n){return r(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},t.g=r,t}();return(l=function(n,e,l,s){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,n);case 2:return r.call(this,n,e);case 3:return t.call(this,n,e,l);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Qe(c,0,null)}return u.g(n,e,l,a)}}).F=3,l.G=u.G,l.o=o,l.a=i,l.b=r,l.c=t,l.g=u.g,l}()},Ih.c=function(n,e,t){return function(){function r(r,i,o){return r=t.c?t.c(r,i,o):t.call(null,r,i,o),r=e.a?e.a(r):e.call(null,r),n.a?n.a(r):n.call(null,r)}function i(r,i){return r=t.b?t.b(r,i):t.call(null,r,i),r=e.a?e.a(r):e.call(null,r),n.a?n.a(r):n.call(null,r)}function o(r){return r=t.a?t.a(r):t.call(null,r),r=e.a?e.a(r):e.call(null,r),n.a?n.a(r):n.call(null,r)}function l(){var r=t.o?t.o():t.call(null);return r=e.a?e.a(r):e.call(null,r),n.a?n.a(r):n.call(null,r)}var u,s=function(){function r(n,e,t,r){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return i.call(this,n,e,t,o)}function i(r,i,o,l){return r=ih(t,r,i,o,l),r=e.a?e.a(r):e.call(null,r),n.a?n.a(r):n.call(null,r)}return r.F=3,r.G=function(n){return i(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},r.g=i,r}();return(u=function(n,e,t,u){switch(arguments.length){case 0:return l.call(this);case 1:return o.call(this,n);case 2:return i.call(this,n,e);case 3:return r.call(this,n,e,t);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Qe(c,0,null)}return s.g(n,e,t,a)}}).F=3,u.G=s.G,u.o=l,u.a=o,u.b=i,u.c=r,u.g=s.g,u}()},Ih.g=function(n,e,t,r){var i=Eg(vf(n,vf(e,vf(t,r))));return function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){n=fh(C(i),n);for(var e=D(i);;){if(!e)return n;var t=C(e);n=t.a?t.a(n):t.call(null,n),e=D(e)}}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}()},Ih.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);return t=C(r),r=D(r),this.g(e,n,t,r)},Ih.F=3,g=Nh.prototype,g.Y=function(n,e){return this===e},g.zb=function(){return this.state},g.N=function(){return this.H},g.Ge=function(n,e,t){n=B(this.bf);for(var r=null,i=0,o=0;;)if(o<i){var l=r.W(null,o),u=J(l,0,null);(l=J(l,1,null)).A?l.A(u,this,e,t):l.call(null,u,this,e,t),o+=1}else{if(!(n=B(n)))return null;Wf(n)?(r=re(n),n=se(n),u=r,i=F(r),r=u):(u=J(r=C(n),0,null),(l=J(r,1,null)).A?l.A(u,this,e,t):l.call(null,u,this,e,t),n=D(n),r=null,i=0),o=0}},g.Z=function(){return hb(this)};var Rh=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],arguments[3],new Qe(t.slice(4),0,null))}};function Sh(n,e){var t=n.state;return Qh(n,e=e.a?e.a(t):e.call(null,t))}function Th(n,e){var t=n.state;return Qh(n,e=Hf.b?Hf.b(t,e):Hf.call(null,t,e))}function Uh(n){this.state=n,this.h=32768,this.I=0}function Vh(n,e){xe(n,e)}Rh.b=function(n,e){if(n instanceof Nh){var t=n.state;n=Ph(n,e=e.a?e.a(t):e.call(null,t))}else n=we(n,e);return n},Rh.c=function(n,e,t){if(n instanceof Nh){var r=n.state;n=Ph(n,e=e.b?e.b(r,t):e.call(null,r,t))}else n=we(n,e,t);return n},Rh.A=function(n,e,t,r){if(n instanceof Nh){var i=n.state;n=Ph(n,e=e.c?e.c(i,t,r):e.call(null,i,t,r))}else n=we(n,e,t,r);return n},Rh.g=function(n,e,t,r,i){return n instanceof Nh?Ph(n,ih(e,n.state,t,r,i)):we(n,e,t,r,i)},Rh.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);t=C(r);var i=D(r);return r=C(i),i=D(i),this.g(e,n,t,r,i)},Rh.F=4,Uh.prototype.Cc=function(n,e){return this.state=e},Uh.prototype.zb=function(){return this.state};var Wh=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],arguments[3],new Qe(t.slice(4),0,null))}};Wh.a=function(n){return function(e){return function(){function t(t,r){return r=n.a?n.a(r):n.call(null,r),e.b?e.b(t,r):e.call(null,t,r)}function r(n){return e.a?e.a(n):e.call(null,n)}function i(){return e.o?e.o():e.call(null)}var o,l=function(){function t(n,e,t){var i=null;if(2<arguments.length){i=0;for(var o=Array(arguments.length-2);i<o.length;)o[i]=arguments[i+2],++i;i=new Qe(o,0,null)}return r.call(this,n,e,i)}function r(t,r,i){return r=gh(n,r,i),e.b?e.b(t,r):e.call(null,t,r)}return t.F=2,t.G=function(n){return r(C(n),C(n=D(n)),n=Re(n))},t.g=r,t}();return(o=function(n,e,o){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,n);case 2:return t.call(this,n,e);default:var u=null;if(2<arguments.length){u=0;for(var s=Array(arguments.length-2);u<s.length;)s[u]=arguments[u+2],++u;u=new Qe(s,0,null)}return l.g(n,e,u)}}).F=2,o.G=l.G,o.o=i,o.a=r,o.b=t,o.g=l.g,o}()}},Wh.b=function(n,e){return new Mg(null,(function(){var t,r=B(e);if(r){if(Wf(r)){for(var i=re(r),o=F(i),l=Qg(o),u=0;u<o;)Tg(l,(t=void 0,t=qd(i,u),n.a?n.a(t):n.call(null,t))),u+=1;return Sg(Ug(l),Wh.b(n,se(r)))}return vf(function(){var e=C(r);return n.a?n.a(e):n.call(null,e)}(),Wh.b(n,Re(r)))}return null}),null,null)},Wh.c=function(n,e,t){return new Mg(null,(function(){var r=B(e),i=B(t);if(r&&i){var o=C(r),l=C(i);r=vf(o=n.b?n.b(o,l):n.call(null,o,l),Wh.c(n,Re(r),Re(i)))}else r=null;return r}),null,null)},Wh.A=function(n,e,t,r){return new Mg(null,(function(){var i=B(e),o=B(t),l=B(r);if(i&&o&&l){var u=C(i),s=C(o),a=C(l);i=vf(u=n.c?n.c(u,s,a):n.call(null,u,s,a),Wh.A(n,Re(i),Re(o),Re(l)))}else i=null;return i}),null,null)},Wh.g=function(n,e,t,r,i){return Wh.b((function(e){return fh(n,e)}),function n(e){return new Mg(null,(function(){var t=Wh.b(B,e);return Dh(lg,t)?vf(Wh.b(C,t),n(Wh.b(Re,t))):null}),null,null)}(Cf.g(i,r,G([t,e]))))},Wh.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);t=C(r);var i=D(r);return r=C(i),i=D(i),this.g(e,n,t,r,i)},Wh.F=4;var Xh=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function Yh(n,e){return new Mg(null,(function(){n:for(var t=n,r=e;r=B(r),0<t&&r;)--t,r=Re(r);return r}),null,null)}function Zh(n,e){return Wh.c((function(n){return n}),e,Yh(n,e))}function $h(n,e,t,r){this.H=n,this.count=e,this.m=t,this.next=r,this.B=null,this.h=32374988,this.I=1}function ai(n,e){return 0<n?new $h(null,n,e,null):Se}Xh.a=function(n){return function(e){var r=new Uh(n);return function(){function n(n,i){var o=t(r),l=r.Cc(null,r.zb(null)-1);return n=0<o?e.b?e.b(n,i):e.call(null,n,i):n,0<l||cf(n)?n:bf(n)}function i(n){return e.a?e.a(n):e.call(null,n)}function o(){return e.o?e.o():e.call(null)}var l;return(l=function(e,t){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return n.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).o=o,l.a=i,l.b=n,l}()}},Xh.b=function(n,e){return new Mg(null,(function(){if(0<n){var t=B(e);return t?vf(C(t),Xh.b(n-1,Re(t))):null}return null}),null,null)},Xh.F=2,g=$h.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,this.count)}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){return null==this.next?1<this.count?this.next=new $h(null,this.count-1,this.m,null):-1===this.count?this:null:this.next},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Bd=function(){return!1},g.Ba=function(n,e){if(-1===this.count)for(var r=e.b?e.b(this.m,this.m):e.call(null,this.m,this.m);;){if(cf(r))return t(r);r=e.b?e.b(r,this.m):e.call(null,r,this.m)}else for(n=1,r=this.m;;){if(!(n<this.count))return r;if(cf(r=e.b?e.b(r,this.m):e.call(null,r,this.m)))return t(r);n+=1}},g.Ca=function(n,e,r){if(-1===this.count)for(r=e.b?e.b(r,this.m):e.call(null,r,this.m);;){if(cf(r))return t(r);r=e.b?e.b(r,this.m):e.call(null,r,this.m)}else for(n=0;;){if(!(n<this.count))return r;if(cf(r=e.b?e.b(r,this.m):e.call(null,r,this.m)))return t(r);n+=1}},g.Fa=function(){return this.m},g.Ha=function(){return null==this.next?1<this.count?this.next=new $h(null,this.count-1,this.m,null):-1===this.count?this:Se:this.next},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new $h(e,this.count,this.m,this.next)},g.ga=function(n,e){return vf(e,this)};var bi=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],new Qe(t.slice(2),0,null))}};function ci(){return function(n){var e=new Uh(!1);return function(){function r(r,i){return p(t(e))?cf(r=n.b?n.b(r," "):n.call(null,r," "))?r:n.b?n.b(r,i):n.call(null,r,i):(xe(e,!0),n.b?n.b(r,i):n.call(null,r,i))}function i(e){return n.a?n.a(e):n.call(null,e)}function o(){return n.o?n.o():n.call(null)}var l;return(l=function(n,e){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,n);case 2:return r.call(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).o=o,l.a=i,l.b=r,l}()}}function di(n,e){return Yh(1,bi.b(new $h(null,-1,n,null),e))}function ei(n,e){return fh(Xg,gh(Wh,n,e))}bi.o=function(){return Se},bi.a=function(n){return new Mg(null,(function(){return n}),null,null)},bi.b=function(n,e){return new Mg(null,(function(){var t=B(n),r=B(e);return t&&r?vf(C(t),vf(C(r),bi.b(Re(t),Re(r)))):null}),null,null)},bi.g=function(n,e,t){return new Mg(null,(function(){var r=Wh.b(B,Cf.g(t,e,G([n])));return Dh(lg,r)?Xg.b(Wh.b(C,r),fh(bi,Wh.b(Re,r))):null}),null,null)},bi.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},bi.F=2;var fi=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};fi.a=function(n){return function(e){return function(){function t(t,r){return p(n.a?n.a(r):n.call(null,r))?e.b?e.b(t,r):e.call(null,t,r):t}function r(n){return e.a?e.a(n):e.call(null,n)}function i(){return e.o?e.o():e.call(null)}var o;return(o=function(n,e){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,n);case 2:return t.call(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).o=i,o.a=r,o.b=t,o}()}},fi.b=function(n,e){return new Mg(null,(function(){var t=B(e);if(t){if(Wf(t)){for(var r=re(t),i=F(r),o=Qg(i),l=0;l<i;){var u=qd(r,l);p(u=n.a?n.a(u):n.call(null,u))&&(u=qd(r,l),o.add(u)),l+=1}return Sg(Ug(o),fi.b(n,se(t)))}return r=C(t),t=Re(t),p(n.a?n.a(r):n.call(null,r))?vf(r,fi.b(n,t)):fi.b(n,t)}return null}),null,null)},fi.F=2;var gi=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function hi(n){return function n(e){return new Mg(null,(function(){return vf(e,p(Tf.a?Tf.a(e):Tf.call(null,e))?ei(n,G([B.a?B.a(e):B.call(null,e)])):null)}),null,null)}(n)}function ii(n){return fi.b((function(n){return!Tf(n)}),Re(hi(n)))}gi.a=function(n){return fi.a(Gh(n))},gi.b=function(n,e){return fi.b(Gh(n),e)},gi.F=2;var ji=function n(e){switch(arguments.length){case 0:return n.o();case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};ji.o=function(){return I},ji.a=function(n){return n},ji.b=function(n,e){return null!=n?null!=n&&(4&n.I||h===n.cg)?Pd(le(gd.c(ke,je(n),e)),Lf(n)):gd.c(od,n,e):gd.c(Cf,n,e)},ji.c=function(n,e,t){return null!=n&&(4&n.I||h===n.cg)?Pd(le(og(e,Yg,je(n),t)),Lf(n)):og(e,Cf,n,t)},ji.F=3;var ki=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],arguments[3],new Qe(t.slice(4),0,null))}};function li(n,e){return le(gd.c((function(e,t){return p(n.a?n.a(t):n.call(null,t))?Yg.b(e,t):e}),je(I),e))}ki.b=function(n,e){return le(gd.c((function(e,t){return Yg.b(e,n.a?n.a(t):n.call(null,t))}),je(I),e))},ki.c=function(n,e,t){return ji.b(I,Wh.c(n,e,t))},ki.A=function(n,e,t,r){return ji.b(I,Wh.A(n,e,t,r))},ki.g=function(n,e,t,r,i){return ji.b(I,jh(Wh,n,e,t,r,G([i])))},ki.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);t=C(r);var i=D(r);return r=C(i),i=D(i),this.g(e,n,t,r,i)},ki.F=4;var mi=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};mi.b=function(n,e){return gd.c(x,n,e)},mi.c=function(n,e,t){var r=Yf;for(e=B(e);;){if(null==e)return n;if(r===(n=x.c(n,C(e),r)))return t;e=D(e)}},mi.F=3;var ni=function n(e,t,r){var i,o=C(t=B(t)),l=D(t);return l?K.c(e,o,(i=x.b(e,o),n.c?n.c(i,l,r):n.call(null,i,l,r))):K.c(e,o,r)},oi=function n(e){switch(arguments.length){case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return n.K(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return n.la(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],new Qe(t.slice(6),0,null))}};function pi(n,e,t){return K.c(n,e,(r=x.b(n,e),t.a?t.a(r):t.call(null,r)));var r}function qi(n,e,t,r){return K.c(n,e,(i=x.b(n,e),t.b?t.b(i,r):t.call(null,i,r)));var i}function ri(n,e){this.va=n,this.l=e}function si(n){return new ri(n,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])}function ti(n){return new ri(n.va,ed(n.l))}function ui(n){return 32>(n=n.C)?0:n-1>>>5<<5}function vi(n,e,t){for(;;){if(0===e)return t;var r=si(n);r.l[0]=t,t=r,e-=5}}oi.c=function(n,e,t){var r,i=C(e=B(e));return(e=D(e))?K.c(n,i,oi.c(x.b(n,i),e,t)):K.c(n,i,(r=x.b(n,i),t.a?t.a(r):t.call(null,r)))},oi.A=function(n,e,t,r){var i,o=C(e=B(e));return(e=D(e))?K.c(n,o,oi.A(x.b(n,o),e,t,r)):K.c(n,o,(i=x.b(n,o),t.b?t.b(i,r):t.call(null,i,r)))},oi.K=function(n,e,t,r,i){var o,l=C(e=B(e));return(e=D(e))?K.c(n,l,oi.K(x.b(n,l),e,t,r,i)):K.c(n,l,(o=x.b(n,l),t.c?t.c(o,r,i):t.call(null,o,r,i)))},oi.la=function(n,e,t,r,i,o){var l,u=C(e=B(e));return(e=D(e))?K.c(n,u,oi.la(x.b(n,u),e,t,r,i,o)):K.c(n,u,(l=x.b(n,u),t.A?t.A(l,r,i,o):t.call(null,l,r,i,o)))},oi.g=function(n,e,t,r,i,o,l){var u=B(e);return e=C(u),(u=D(u))?K.c(n,e,jh(oi,x.b(n,e),u,t,r,G([i,o,l]))):K.c(n,e,jh(t,x.b(n,e),r,i,o,G([l])))},oi.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);t=C(r);var i=D(r);r=C(i);var o=D(i);i=C(o);var l=D(o);return o=C(l),l=D(l),this.g(e,n,t,r,i,o,l)},oi.F=6;var wi=function n(e,t,r,i){var o=ti(r),l=e.C-1>>>t&31;return 5===t?o.l[l]=i:(null!=(r=r.l[l])?(t-=5,e=n.A?n.A(e,t,r,i):n.call(null,e,t,r,i)):e=vi(null,t-5,i),o.l[l]=e),o};function xi(n,e){throw Error(["No item ",q.a(n)," in vector of length ",q.a(e)].join(""))}function yi(n,e){if(e>=ui(n))return n.ta;var t=n.root;for(n=n.shift;;){if(!(0<n))return t.l;var r=n-5;t=t.l[e>>>n&31],n=r}}function zi(n,e){return 0<=e&&e<n.C?yi(n,e):xi(e,n.C)}var Ai=function n(e,t,r,i,o){var l=ti(r);if(0===t)l.l[31&i]=o;else{var u=i>>>t&31;t-=5,r=r.l[u],e=n.K?n.K(e,t,r,i,o):n.call(null,e,t,r,i,o),l.l[u]=e}return l},Bi=function n(e,t,r){var i=e.C-2>>>t&31;if(5<t){t-=5;var o=r.l[i];return null==(e=n.c?n.c(e,t,o):n.call(null,e,t,o))&&0===i?null:((r=ti(r)).l[i]=e,r)}return 0===i?null:((r=ti(r)).l[i]=null,r)};function Ci(n,e,t,r,i,o){this.J=n,this.Td=e,this.l=t,this.ka=r,this.start=i,this.end=o}function Di(n,e,t){return new Ci(e,e-e%32,e<F(n)?yi(n,e):null,n,e,t)}function Ei(n,e,t,r){return t<r?Fi(n,e,pf(n,t),t+1,r):e.o?e.o():e.call(null)}function Fi(n,e,r,i,o){var l=r;for(r=i,i=yi(n,i);;){if(!(r<o))return l;var u=31&r;if(u=(i=0===u?yi(n,r):i)[u],cf(l=e.b?e.b(l,u):e.call(null,l,u)))return t(l);r+=1}}function Q(n,e,t,r,i,o){this.H=n,this.C=e,this.shift=t,this.root=r,this.ta=i,this.B=o,this.h=167666463,this.I=139268}Ci.prototype.ra=function(){return this.J<this.end},Ci.prototype.next=function(){32==this.J-this.Td&&(this.l=yi(this.ka,this.J),this.Td+=32);var n=this.l[31&this.J];return this.J+=1,n},g=Q.prototype,g.Ac=function(n,e){return 0<=e&&e<this.C?new Gi(e,yi(this,e)[31&e]):null},g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return"number"==typeof e?this.wa(null,e,t):t},g.Aa=function(n,e,r){n=0;for(var i=r;;){if(!(n<this.C))return i;var o=yi(this,n);r=o.length;n:for(var l=0;;){if(!(l<r)){o=i;break n}var u=l+n,s=o[l];if(cf(i=e.c?e.c(i,u,s):e.call(null,i,u,s))){o=i;break n}l+=1}if(cf(o))return t(o);n+=r,i=o}},g.ye=h,g.W=function(n,e){return zi(this,e)[31&e]},g.wa=function(n,e,t){return 0<=e&&e<this.C?yi(this,e)[31&e]:t},g.Ib=function(n,e,t){if(0<=e&&e<this.C)return ui(this)<=e?((n=ed(this.ta))[31&e]=t,new Q(this.H,this.C,this.shift,this.root,n,null)):new Q(this.H,this.C,this.shift,Ai(this,this.shift,this.root,e,t),this.ta,null);if(e===this.C)return this.ga(null,t);throw Error(["Index ",q.a(e)," out of bounds  [0,",q.a(this.C),"]"].join(""))},g.ua=function(){return Di(this,0,this.C)},g.N=function(){return this.H},g.X=function(){return this.C},g.Xb=function(){return 0<this.C?this.W(null,this.C-1):null},g.Yb=function(){if(0===this.C)throw Error("Can't pop empty vector");if(1===this.C)return Pd(I,this.H);if(1<this.C-ui(this))return new Q(this.H,this.C-1,this.shift,this.root,this.ta.slice(0,-1),null);var n=yi(this,this.C-2),e=Bi(this,this.shift,this.root);e=null==e?R:e;var t=this.C-1;return 5<this.shift&&null==e.l[1]?new Q(this.H,t,this.shift-5,e.l[0],n,null):new Q(this.H,t,this.shift,e,n,null)},g.Bc=function(){return 0<this.C?new tf(this,this.C-1,null):null},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){if(!(e instanceof Q))return uf(this,e);if(this.C!==F(e))return!1;for(n=this.ua(null),e=e.ua(null);;){if(!n.ra())return!0;var t=n.next(),r=e.next();if(!A.b(t,r))return!1}},g.hd=function(){return new Hi(this.C,this.shift,Ii.a?Ii.a(this.root):Ii.call(null,this.root),Ji.a?Ji.a(this.ta):Ji.call(null,this.ta))},g.pa=function(){return Pd(I,this.H)},g.Ba=function(n,e){return Ei(this,e,0,this.C)},g.Ca=function(n,e,r){n=0;for(var i=r;;){if(!(n<this.C))return i;var o=yi(this,n);r=o.length;n:for(var l=0;;){if(!(l<r)){o=i;break n}var u=o[l];if(cf(i=e.b?e.b(i,u):e.call(null,i,u))){o=i;break n}l+=1}if(cf(o))return t(o);n+=r,i=o}},g.fa=function(n,e,t){if("number"==typeof e)return this.Ib(null,e,t);throw Error("Vector's key for assoc must be a number.")},g.$=function(){if(0===this.C)return null;if(32>=this.C)return new Qe(this.ta,0,null);n:for(var n=this.root,e=this.shift;;){if(!(0<e)){n=n.l;break n}e-=5,n=n.l[0]}return Ki?Ki(this,n,0,0):Li.call(null,this,n,0,0)},g.O=function(n,e){return e===this.H?this:new Q(e,this.C,this.shift,this.root,this.ta,this.B)},g.ga=function(n,e){if(32>this.C-ui(this)){n=this.ta.length;for(var t=Array(n+1),r=0;r<n;)t[r]=this.ta[r],r+=1;return t[n]=e,new Q(this.H,this.C+1,this.shift,this.root,t,null)}return n=(t=this.C>>>5>1<<this.shift)?this.shift+5:this.shift,t?((t=si(null)).l[0]=this.root,r=vi(null,this.shift,new ri(null,this.ta)),t.l[1]=r):t=wi(this,this.shift,this.root,new ri(null,this.ta)),new Q(this.H,this.C+1,n,t,[e],null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.W(null,e);case 3:return this.wa(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.W(null,e)},n.c=function(n,e,t){return this.wa(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.W(null,n)},g.b=function(n,e){return this.wa(null,n,e)};var R=new ri(null,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),I=new Q(null,0,5,R,[],Xe);function Mi(n,e){var t=n.length;if(n=e?n:ed(n),32>t)return new Q(null,t,5,R,n,null);e=32;for(var r=new Q(null,32,5,R,n.slice(0,32),null).hd(null);;){if(!(e<t))return le(r);var i=e+1;r=Yg.b(r,n[e]),e=i}}function Ni(n){return p(Oi.a?Oi.a(n):Oi.call(null,n))?new Q(null,2,5,R,[Pi.a?Pi.a(n):Pi.call(null,n),Qi.a?Qi.a(n):Qi.call(null,n)],null):Vf(n)?Kf(n,null):Rc(n)?Mi(n,!0):le(gd.c(ke,je(I),n))}Q.prototype[ad]=function(){return Ue(this)};var Ri=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function Si(n,e,t,r,i){this.Gb=n,this.node=e,this.J=t,this.$a=r,this.H=i,this.B=null,this.h=32375020,this.I=1536}function Li(n){switch(arguments.length){case 3:var e=arguments[0],t=arguments[1],r=arguments[2];return new Si(e,zi(e,t),t,r,null);case 4:return Ki(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return Ti(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function Ki(n,e,t,r){return new Si(n,e,t,r,null)}function Ti(n,e,t,r,i){return new Si(n,e,t,r,i)}function Ui(n,e,t,r,i){this.H=n,this.ka=e,this.start=t,this.end=r,this.B=i,this.h=167666463,this.I=139264}function Vi(n,e,t,r,i){for(;;){if(!(e instanceof Ui)){if(!Vf(e))throw Error("v must satisfy IVector");if(0>t||r<t||r>F(e))throw Error("Index out of bounds");return new Ui(n,e,t,r,i)}t=e.start+t,r=e.start+r,e=e.ka}}function Wi(n,e,t){return Vi(null,n,0|e,0|t,null)}function Xi(n,e){return n===e.va?e:new ri(n,ed(e.l))}function Ii(n){return new ri({},ed(n.l))}function Ji(n){var e=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];return Xf(n,0,e,0,n.length),e}Ri.g=function(n){return n instanceof Qe&&0===n.J?Mi(n.l,!Rc(n.l)):Ni(n)},Ri.F=0,Ri.G=function(n){return this.g(B(n))},g=Si.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){if(this.$a+1<this.node.length){var n=this.Gb,e=this.node,t=this.J,r=this.$a+1;return null==(n=Ki?Ki(n,e,t,r):Li.call(null,n,e,t,r))?null:n}return this.Ae()},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return Ei(this.Gb,e,this.J+this.$a,F(this.Gb))},g.Ca=function(n,e,t){return Fi(this.Gb,e,t,this.J+this.$a,F(this.Gb))},g.Fa=function(){return this.node[this.$a]},g.Ha=function(){if(this.$a+1<this.node.length){var n=this.Gb,e=this.node,t=this.J,r=this.$a+1;return null==(n=Ki?Ki(n,e,t,r):Li.call(null,n,e,t,r))?Se:n}return this.gd(null)},g.$=function(){return this},g.$d=function(){var n=this.node;return new Pg(n,this.$a,n.length)},g.gd=function(){var n=this.J+this.node.length;if(n<kd(this.Gb)){var e=this.Gb,t=yi(this.Gb,n);return Ki?Ki(e,t,n,0):Li.call(null,e,t,n,0)}return Se},g.O=function(n,e){return e===this.H?this:Ti?Ti(this.Gb,this.node,this.J,this.$a,e):Li.call(null,this.Gb,this.node,this.J,this.$a,e)},g.ga=function(n,e){return vf(e,this)},g.Ae=function(){var n=this.J+this.node.length;if(n<kd(this.Gb)){var e=this.Gb,t=yi(this.Gb,n);return Ki?Ki(e,t,n,0):Li.call(null,e,t,n,0)}return null},Si.prototype[ad]=function(){return Ue(this)},g=Ui.prototype,g.Ac=function(n,e){return 0>e?null:(n=this.start+e)<this.end?new Gi(e,xd(this.ka,n)):null},g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return"number"==typeof e?this.wa(null,e,t):t},g.Aa=function(n,e,r){n=this.start;for(var i=0;;){if(!(n<this.end))return r;var o=i,l=qd(this.ka,n);if(cf(r=e.c?e.c(r,o,l):e.call(null,r,o,l)))return t(r);i+=1,n+=1}},g.W=function(n,e){return 0>e||this.end<=this.start+e?xi(e,this.end-this.start):qd(this.ka,this.start+e)},g.wa=function(n,e,t){return 0>e||this.end<=this.start+e?t:qd(this.ka,this.start+e,t)},g.Ib=function(n,e,t){if(n=this.start+e,0>e||this.end+1<=n)throw Error(["Index ",q.a(e)," out of bounds [0,",q.a(this.X(null)),"]"].join(""));e=this.H,t=K.c(this.ka,n,t);var r=this.start,i=this.end;return n=i>(n+=1)?i:n,Vi.K?Vi.K(e,t,r,n,null):Vi.call(null,e,t,r,n,null)},g.ua=function(){return null!=this.ka&&h===this.ka.ye?Di(this.ka,this.start,this.end):new sh(this)},g.N=function(){return this.H},g.X=function(){return this.end-this.start},g.Xb=function(){return this.start===this.end?null:qd(this.ka,this.end-1)},g.Yb=function(){if(this.start===this.end)throw Error("Can't pop empty vector");var n=this.H,e=this.ka,t=this.start,r=this.end-1;return Vi.K?Vi.K(n,e,t,r,null):Vi.call(null,n,e,t,r,null)},g.Bc=function(){return this.start!==this.end?new tf(this,this.end-this.start-1,null):null},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Pd(I,this.H)},g.Ba=function(n,e){return null!=this.ka&&h===this.ka.ye?Ei(this.ka,e,this.start,this.end):ff(this,e)},g.Ca=function(n,e,t){return null!=this.ka&&h===this.ka.ye?Fi(this.ka,e,t,this.start,this.end):gf(this,e,t)},g.fa=function(n,e,t){if("number"==typeof e)return this.Ib(null,e,t);throw Error("Subvec's key for assoc must be a number.")},g.$=function(){var n=this;return function e(t){return t===n.end?null:vf(qd(n.ka,t),new Mg(null,(function(){return e(t+1)}),null,null))}(n.start)},g.O=function(n,e){return e===this.H?this:Vi.K?Vi.K(e,this.ka,this.start,this.end,this.B):Vi.call(null,e,this.ka,this.start,this.end,this.B)},g.ga=function(n,e){n=this.H,e=Kd(this.ka,this.end,e);var t=this.start,r=this.end+1;return Vi.K?Vi.K(n,e,t,r,null):Vi.call(null,n,e,t,r,null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.W(null,e);case 3:return this.wa(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.W(null,e)},n.c=function(n,e,t){return this.wa(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.W(null,n)},g.b=function(n,e){return this.wa(null,n,e)},Ui.prototype[ad]=function(){return Ue(this)};var Yi=function n(e,t,r,i){r=Xi(e.root.va,r);var o=e.C-1>>>t&31;if(5===t)e=i;else{var l=r.l[o];null!=l?(t-=5,e=n.A?n.A(e,t,l,i):n.call(null,e,t,l,i)):e=vi(e.root.va,t-5,i)}return r.l[o]=e,r};function Hi(n,e,t,r){this.C=n,this.shift=e,this.root=t,this.ta=r,this.I=88,this.h=275}function Zi(n,e,t){if(n.root.va){if(0<=e&&e<n.C){if(ui(n)<=e)n.ta[31&e]=t;else{var r=function r(i,o){if(o=Xi(n.root.va,o),0===i)o.l[31&e]=t;else{var l=e>>>i&31;i=r(i-5,o.l[l]),o.l[l]=i}return o}(n.shift,n.root);n.root=r}return n}if(e===n.C)return n.kd(null,t);throw Error(["Index ",q.a(e)," out of bounds for TransientVector of length",q.a(n.C)].join(""))}throw Error("assoc! after persistent!")}function $i(n,e){this.pd=n,this.Rd=e}function aj(n,e,t,r){this.H=n,this.Ab=e,this.Fb=t,this.B=r,this.h=31850700,this.I=0}function bj(n,e,t,r,i){this.H=n,this.count=e,this.Ab=t,this.Fb=r,this.B=i,this.I=139264,this.h=31858766}g=Hi.prototype,g.kd=function(n,e){if(this.root.va){if(32>this.C-ui(this))this.ta[31&this.C]=e;else{n=new ri(this.root.va,this.ta);var t=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];t[0]=e,this.ta=t,this.C>>>5>1<<this.shift?(e=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],t=this.shift+5,e[0]=this.root,e[1]=vi(this.root.va,this.shift,n),this.root=new ri(this.root.va,e),this.shift=t):this.root=Yi(this,this.shift,this.root,n)}return this.C+=1,this}throw Error("conj! after persistent!")},g.Cd=function(){if(this.root.va){this.root.va=null;var n=this.C-ui(this),e=Array(n);return Xf(this.ta,0,e,0,n),new Q(null,this.C,this.shift,this.root,e,null)}throw Error("persistent! called twice")},g.jd=function(n,e,t){if("number"==typeof e)return Zi(this,e,t);throw Error("TransientVector's key for assoc! must be a number.")},g.X=function(){if(this.root.va)return this.C;throw Error("count after persistent!")},g.W=function(n,e){if(this.root.va)return zi(this,e)[31&e];throw Error("nth after persistent!")},g.wa=function(n,e,t){return 0<=e&&e<this.C?this.W(null,e):t},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){if(this.root.va)return"number"==typeof e?this.wa(null,e,t):t;throw Error("lookup after persistent!")},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)},$i.prototype.ra=function(){var n=null!=this.pd&&B(this.pd);return n||null!=this.Rd&&this.Rd.ra()},$i.prototype.next=function(){if(null!=this.pd){var n=C(this.pd);return this.pd=D(this.pd),n}if(null!=this.Rd&&this.Rd.ra())return this.Rd.next();throw Error("No such element")},$i.prototype.remove=function(){return Error("Unsupported operation")},g=aj.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){var n=D(this.Ab);return n?new aj(this.H,n,this.Fb,null):null!=this.Fb?new aj(this.H,this.Fb,null,null):null},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Pd(Se,this.H)},g.Fa=function(){return C(this.Ab)},g.Ha=function(){var n=D(this.Ab);return n?new aj(this.H,n,this.Fb,null):null==this.Fb?this.pa(null):new aj(this.H,this.Fb,null,null)},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new aj(e,this.Ab,this.Fb,this.B)},g.ga=function(n,e){return vf(e,this)},aj.prototype[ad]=function(){return Ue(this)},g=bj.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,this.count.a?this.count.a(this):this.count.call(null,this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.ua=function(){return new $i(this.Ab,ze(this.Fb))},g.N=function(){return this.H},g.X=function(){return this.count},g.Xb=function(){return C(this.Ab)},g.Yb=function(){if(p(this.Ab)){var n=D(this.Ab);return n?new bj(this.H,this.count-1,n,this.Fb,null):new bj(this.H,this.count-1,B(this.Fb),I,null)}return this},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Pd(cj,this.H)},g.Fa=function(){return C(this.Ab)},g.Ha=function(){return Re(B(this))},g.$=function(){var n=B(this.Fb),e=this.Ab;return p(p(e)?e:n)?new aj(null,this.Ab,B(n),null):null},g.O=function(n,e){return e===this.H?this:new bj(e,this.count,this.Ab,this.Fb,this.B)},g.ga=function(n,e){return p(this.Ab)?(n=this.Fb,e=new bj(this.H,this.count+1,this.Ab,Cf.b(p(n)?n:I,e),null)):e=new bj(this.H,this.count+1,Cf.b(this.Ab,e),I,null),e};var cj=new bj(null,0,null,I,Xe);function dj(){this.h=2097152,this.I=0}bj.prototype[ad]=function(){return Ue(this)},dj.prototype.Y=function(){return!1};var ej=new dj;function fj(n,e){return ag(M(e)&&!Uf(e)&&F(n)===F(e)?(null!=n?1048576&n.h||h===n.Qh||!n.h&&Xc(Sd,n):Xc(Sd,n))?kg((function(n,t,r){return!!A.b(x.c(e,t,ej),r)||bf(!1)}),!0,n):Dh((function(n){return A.b(x.c(e,C(n),ej),zf(n))}),n):null)}function gj(n,e,t,r){this.J=0,this.zh=n,this.jf=e,this.Vc=t,this.vf=r}function hj(n){this.ha=n}function ij(n){this.ha=n}function jj(n,e){if(e instanceof z)n:{var t=n.length;e=e.da;for(var r=0;;){if(t<=r){n=-1;break n}if(n[r]instanceof z&&e===n[r].da){n=r;break n}r+=2}}else if("string"==typeof e||"number"==typeof e)n:for(t=n.length,r=0;;){if(t<=r){n=-1;break n}if(e===n[r]){n=r;break n}r+=2}else if(e instanceof w)n:for(t=n.length,e=e.wc,r=0;;){if(t<=r){n=-1;break n}if(n[r]instanceof w&&e===n[r].wc){n=r;break n}r+=2}else if(null==e)n:for(e=n.length,t=0;;){if(e<=t){n=-1;break n}if(null==n[t]){n=t;break n}t+=2}else n:for(t=n.length,r=0;;){if(t<=r){n=-1;break n}if(A.b(e,n[r])){n=r;break n}r+=2}return n}function Gi(n,e){this.key=n,this.m=e,this.B=null,this.h=166619935,this.I=0}function Oi(n){return null!=n&&!!(2048&n.h||h===n.Th)}function kj(n,e,t){this.l=n,this.J=e,this.Kb=t,this.h=32374990,this.I=0}function lj(n,e){this.l=n,this.J=0,this.C=e}function n(n,e,t,r){this.H=n,this.C=e,this.l=t,this.B=r,this.h=16647951,this.I=139268}gj.prototype.ra=function(){var n=this.J<this.jf;return n||this.vf.ra()},gj.prototype.next=function(){if(this.J<this.jf){var n=pf(this.Vc,this.J);return this.J+=1,new Gi(n,xd(this.zh,n))}return this.vf.next()},gj.prototype.remove=function(){return Error("Unsupported operation")},hj.prototype.next=function(){if(null!=this.ha){var n=C(this.ha),e=J(n,0,null);return n=J(n,1,null),this.ha=D(this.ha),{value:[e,n],done:!1}}return{value:null,done:!0}},ij.prototype.next=function(){if(null!=this.ha){var n=C(this.ha);return this.ha=D(this.ha),{value:[n,n],done:!1}}return{value:null,done:!0}},g=Gi.prototype,g.Ac=function(n,e){switch(e){case 0:return new Gi(0,this.key);case 1:return new Gi(1,this.m);default:return null}},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.ia=function(n,e){return this.wa(null,e,null)},g.M=function(n,e,t){return this.wa(null,e,t)},g.W=function(n,e){if(0===e)return this.key;if(1===e)return this.m;throw Error("Index out of bounds")},g.wa=function(n,e,t){return 0===e?this.key:1===e?this.m:t},g.Ib=function(n,e,t){return new Q(null,2,5,R,[this.key,this.m],null).Ib(null,e,t)},g.N=function(){return null},g.X=function(){return 2},g.Ce=function(){return this.key},g.De=function(){return this.m},g.Xb=function(){return this.m},g.Yb=function(){return new Q(null,1,5,R,[this.key],null)},g.Bc=function(){return new Qe([this.m,this.key],0,null)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return null},g.Ba=function(n,e){return ff(this,e)},g.Ca=function(n,e,t){return gf(this,e,t)},g.fa=function(n,e,t){return K.c(new Q(null,2,5,R,[this.key,this.m],null),e,t)},g.$=function(){return new Qe([this.key,this.m],0,null)},g.O=function(n,e){return Kf(new Q(null,2,5,R,[this.key,this.m],null),e)},g.ga=function(n,e){return new Q(null,3,5,R,[this.key,this.m,e],null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.W(null,e);case 3:return this.wa(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.W(null,e)},n.c=function(n,e,t){return this.wa(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.W(null,n)},g.b=function(n,e){return this.wa(null,n,e)},g=kj.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.Kb},g.za=function(){return this.J<this.l.length-2?new kj(this.l,this.J+2,null):null},g.X=function(){return(this.l.length-this.J)/2},g.Z=function(){return We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return new Gi(this.l[this.J],this.l[this.J+1])},g.Ha=function(){return this.J<this.l.length-2?new kj(this.l,this.J+2,null):Se},g.$=function(){return this},g.O=function(n,e){return e===this.Kb?this:new kj(this.l,this.J,e)},g.ga=function(n,e){return vf(e,this)},kj.prototype[ad]=function(){return Ue(this)},lj.prototype.ra=function(){return this.J<this.C},lj.prototype.next=function(){var n=new Gi(this.l[this.J],this.l[this.J+1]);return this.J+=2,n},g=n.prototype,g.Ac=function(n,e){return-1===(n=jj(this.l,e))?null:new Gi(this.l[n],this.l[n+1])},g.toString=function(){return Be(this)},g.keys=function(){return Ue(mj.a?mj.a(this):mj.call(null,this))},g.entries=function(){return new hj(B(B(this)))},g.values=function(){return Ue(nj.a?nj.a(this):nj.call(null,this))},g.has=function(n){return N(this,n)},g.get=function(n,e){return this.M(null,n,e)},g.forEach=function(n){for(var e=B(this),t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i),l=J(o,0,null);o=J(o,1,null),n.b?n.b(o,l):n.call(null,o,l),i+=1}else{if(!(e=B(e)))return null;Wf(e)?(t=re(e),e=se(e),l=t,r=F(t),t=l):(l=J(t=C(e),0,null),o=J(t,1,null),n.b?n.b(o,l):n.call(null,o,l),e=D(e),t=null,r=0),i=0}},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return-1===(n=jj(this.l,e))?t:this.l[n+1]},g.Aa=function(n,e,r){n=this.l.length;for(var i=0;;){if(!(i<n))return r;var o=this.l[i],l=this.l[i+1];if(cf(r=e.c?e.c(r,o,l):e.call(null,r,o,l)))return t(r);i+=2}},g.ua=function(){return new lj(this.l,2*this.C)},g.N=function(){return this.H},g.X=function(){return this.C},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=Ye(this)},g.Y=function(n,e){if(!M(e)||Uf(e))return!1;if(n=this.l.length,this.C!==e.X(null))return!1;for(var t=0;;){if(!(t<n))return!0;var r=e.M(null,this.l[t],Yf);if(r===Yf)return!1;if(!A.b(this.l[t+1],r))return!1;t+=2}},g.hd=function(){return new oj(this.l.length,ed(this.l))},g.pa=function(){return Pd(S,this.H)},g.Ba=function(n,e){return ig(this,e)},g.Ca=function(n,e,t){return jg(this,e,t)},g.Ka=function(e,t){if(!(0<=jj(this.l,t)))return this;var r=(e=this.l.length)-2;if(0===r)return this.pa(null);r=Array(r);for(var i=0,o=0;;){if(i>=e)return new n(this.H,this.C-1,r,null);A.b(t,this.l[i])||(r[o]=this.l[i],r[o+1]=this.l[i+1],o+=2),i+=2}},g.fa=function(e,t,r){if(-1===(e=jj(this.l,t))){if(this.C<pj){for(var i=(e=this.l).length,o=Array(i+2),l=0;l<i;)o[l]=e[l],l+=1;return o[i]=t,o[i+1]=r,new n(this.H,this.C+1,o,null)}return Pd(zd(ji.b(qj,this),t,r),this.H)}return r===this.l[e+1]?this:((t=ed(this.l))[e+1]=r,new n(this.H,this.C,t,null))},g.$=function(){var n=this.l;return 0<=n.length-2?new kj(n,0,null):null},g.O=function(e,t){return t===this.H?this:new n(t,this.C,this.l,this.B)},g.ga=function(n,e){if(Vf(e))return this.fa(null,qd(e,0),qd(e,1));for(n=this,e=B(e);;){if(null==e)return n;var t=C(e);if(!Vf(t))throw Error("conj on a map takes map entries or seqables of map entries");n=zd(n,qd(t,0),qd(t,1)),e=D(e)}},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)};var S=new n(null,0,[],Ze),pj=8;function rj(e){return new n(null,e.length/2,e,null)}function Gf(e){for(var t=[],r=0;r<e.length;){var i=e[r],o=e[r+1],l=jj(t,i);-1===l?((l=t).push(i),l.push(o)):t[l+1]=o,r+=2}return new n(null,t.length/2,t,null)}function oj(n,e){this.Uc={},this.jc=n,this.l=e,this.h=259,this.I=56}function sj(n,e){for(var t=je(qj),r=0;;){if(!(r<n))return t;t=me(t,e[r],e[r+1]),r+=2}}function tj(){this.m=!1}function uj(n,e){return n===e||(!!P(n,e)||A.b(n,e))}function vj(n,e,t){return(n=ed(n))[e]=t,n}function wj(n,e){var t=Array(n.length-2);return Xf(n,0,t,0,2*e),Xf(n,2*(e+1),t,2*e,t.length-2*e),t}function xj(n,e,t,r){return(n=n.Gc(e)).l[t]=r,n}function yj(n,e,t){for(var r=n.length,i=0,o=t;;){if(!(i<r))return o;if(null!=(t=n[i])){var l=n[i+1];t=e.c?e.c(o,t,l):e.call(null,o,t,l)}else t=null!=(t=n[i+1])?t.ad(e,o):o;if(cf(t))return t;i+=2,o=t}}function zj(n){this.l=n,this.J=0,this.mc=this.Pd=null}function Aj(n,e,t){this.va=n,this.oa=e,this.l=t,this.I=131072,this.h=0}function Bj(n,e,t,r){if(n.oa===t)return null;var i=(e=(n=n.Gc(e)).l).length;return n.oa^=t,Xf(e,2*(r+1),e,2*r,i-2*(r+1)),e[i-2]=null,e[i-1]=null,n}n.prototype[ad]=function(){return Ue(this)},g=oj.prototype,g.X=function(){if(this.Uc)return tg(this.jc,2);throw Error("count after persistent!")},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){if(this.Uc)return-1===(n=jj(this.l,e))?t:this.l[n+1];throw Error("lookup after persistent!")},g.kd=function(n,e){if(!this.Uc)throw Error("conj! after persistent!");if(Oi(e))return this.jd(null,Pi.a?Pi.a(e):Pi.call(null,e),Qi.a?Qi.a(e):Qi.call(null,e));if(Vf(e))return this.jd(null,e.a?e.a(0):e.call(null,0),e.a?e.a(1):e.call(null,1));for(n=B(e),e=this;;){var t=C(n);if(!p(t))return e;n=D(n),e=me(e,Pi.a?Pi.a(t):Pi.call(null,t),Qi.a?Qi.a(t):Qi.call(null,t))}},g.Cd=function(){if(this.Uc)return this.Uc=!1,new n(null,tg(this.jc,2),this.l,null);throw Error("persistent! called twice")},g.jd=function(n,e,t){if(this.Uc)return-1===(n=jj(this.l,e))?this.jc+2<=2*pj?(this.jc+=2,this.l.push(e),this.l.push(t),this):Zg(sj.b?sj.b(this.jc,this.l):sj.call(null,this.jc,this.l),e,t):(t!==this.l[n+1]&&(this.l[n+1]=t),this);throw Error("assoc! after persistent!")},g.Fe=function(n,e){if(this.Uc)return 0<=(n=jj(this.l,e))&&(this.l[n]=this.l[this.jc-2],this.l[n+1]=this.l[this.jc-1],(n=this.l).pop(),n.pop(),this.jc-=2),this;throw Error("dissoc! after persistent!")},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.M(null,e,null);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.M(null,e,null)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.M(null,n,null)},g.b=function(n,e){return this.M(null,n,e)},zj.prototype.advance=function(){for(var n=this.l.length;;){if(!(this.J<n))return!1;var e=this.l[this.J],t=this.l[this.J+1];if(null!=e?e=this.Pd=new Gi(e,t):null!=t?e=!!(e=ze(t)).ra()&&(this.mc=e):e=!1,this.J+=2,e)return!0}},zj.prototype.ra=function(){var n=null!=this.Pd;return n||((n=null!=this.mc)?n:this.advance())},zj.prototype.next=function(){if(null!=this.Pd){var n=this.Pd;return this.Pd=null,n}if(null!=this.mc)return n=this.mc.next(),this.mc.ra()||(this.mc=null),n;if(this.advance())return this.next();throw Error("No such element")},zj.prototype.remove=function(){return Error("Unsupported operation")},g=Aj.prototype,g.Gc=function(n){if(n===this.va)return this;var e=vg(this.oa),t=Array(0>e?4:2*(e+1));return Xf(this.l,0,t,0,2*e),new Aj(n,this.oa,t)},g.Md=function(n,e,t,r,i){var o=1<<(t>>>e&31);if(0==(this.oa&o))return this;var l=vg(this.oa&o-1),u=this.l[2*l],s=this.l[2*l+1];return null==u?(e=s.Md(n,e+5,t,r,i))===s?this:null!=e?xj(this,n,2*l+1,e):this.oa===o?null:Bj(this,n,o,l):uj(r,u)?(i.m=!0,Bj(this,n,o,l)):this},g.Kd=function(){return Cj?Cj(this.l):Dj.call(null,this.l)},g.ad=function(n,e){return yj(this.l,n,e)},g.$c=function(n,e,t,r){var i=1<<(e>>>n&31);if(0==(this.oa&i))return r;var o=vg(this.oa&i-1);return i=this.l[2*o],o=this.l[2*o+1],null==i?o.$c(n+5,e,t,r):uj(t,i)?o:r},g.ic=function(n,e,t,r,i,o){var l=1<<(t>>>e&31),u=vg(this.oa&l-1);if(0==(this.oa&l)){var s=vg(this.oa);if(2*s<this.l.length){for(e=(n=this.Gc(n)).l,o.m=!0,o=2*u+((t=2*(s-u))-1),s=2*(u+1)+(t-1);0!==t;)e[s]=e[o],--s,--t,--o;return e[2*u]=r,e[2*u+1]=i,n.oa|=l,n}if(16<=s){for((u=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])[t>>>e&31]=Ej.ic(n,e+5,t,r,i,o),i=r=0;32>r;)0==(this.oa>>>r&1)||(u[r]=null!=this.l[i]?Ej.ic(n,e+5,Je(this.l[i]),this.l[i],this.l[i+1],o):this.l[i+1],i+=2),r+=1;return new Fj(n,s+1,u)}return e=Array(2*(s+4)),Xf(this.l,0,e,0,2*u),e[2*u]=r,e[2*u+1]=i,Xf(this.l,2*u,e,2*(u+1),2*(s-u)),o.m=!0,(n=this.Gc(n)).l=e,n.oa|=l,n}return s=this.l[2*u],l=this.l[2*u+1],null==s?(s=l.ic(n,e+5,t,r,i,o))===l?this:xj(this,n,2*u+1,s):uj(r,s)?i===l?this:xj(this,n,2*u+1,i):(o.m=!0,o=e+5,r=Gj?Gj(n,o,s,l,t,r,i):Hj.call(null,n,o,s,l,t,r,i),i=2*u,u=2*u+1,(n=this.Gc(n)).l[i]=null,n.l[u]=r,n)},g.hc=function(n,e,t,r,i){var o=1<<(e>>>n&31),l=vg(this.oa&o-1);if(0==(this.oa&o)){var u=vg(this.oa);if(16<=u){for((l=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])[e>>>n&31]=Ej.hc(n+5,e,t,r,i),r=t=0;32>t;)0==(this.oa>>>t&1)||(l[t]=null!=this.l[r]?Ej.hc(n+5,Je(this.l[r]),this.l[r],this.l[r+1],i):this.l[r+1],r+=2),t+=1;return new Fj(null,u+1,l)}return n=Array(2*(u+1)),Xf(this.l,0,n,0,2*l),n[2*l]=t,n[2*l+1]=r,Xf(this.l,2*l,n,2*(l+1),2*(u-l)),i.m=!0,new Aj(null,this.oa|o,n)}var s=this.l[2*l];return o=this.l[2*l+1],null==s?(u=o.hc(n+5,e,t,r,i))===o?this:new Aj(null,this.oa,vj(this.l,2*l+1,u)):uj(t,s)?r===o?this:new Aj(null,this.oa,vj(this.l,2*l+1,r)):(i.m=!0,i=this.oa,u=this.l,n+=5,n=Ij?Ij(n,s,o,e,t,r):Hj.call(null,n,s,o,e,t,r),t=2*l,l=2*l+1,(r=ed(u))[t]=null,r[l]=n,new Aj(null,i,r))},g.Jd=function(n,e,t,r){var i=1<<(e>>>n&31);if(0==(this.oa&i))return r;var o=vg(this.oa&i-1);return i=this.l[2*o],o=this.l[2*o+1],null==i?o.Jd(n+5,e,t,r):uj(t,i)?new Gi(i,o):r},g.Ld=function(n,e,t){var r=1<<(e>>>n&31);if(0==(this.oa&r))return this;var i=vg(this.oa&r-1),o=this.l[2*i],l=this.l[2*i+1];return null==o?(n=l.Ld(n+5,e,t))===l?this:null!=n?new Aj(null,this.oa,vj(this.l,2*i+1,n)):this.oa===r?null:new Aj(null,this.oa^r,wj(this.l,i)):uj(t,o)?new Aj(null,this.oa^r,wj(this.l,i)):this},g.ua=function(){return new zj(this.l)};var Ej=new Aj(null,0,[]);function Jj(n,e,t){var r=n.l,i=r.length;n=Array(2*(n.C-1));for(var o=0,l=1,u=0;;){if(!(o<i))return new Aj(e,u,n);o!==t&&null!=r[o]?(n[l]=r[o],l+=2,u|=1<<o,o+=1):o+=1}}function Kj(n){this.l=n,this.J=0,this.mc=null}function Fj(n,e,t){this.va=n,this.C=e,this.l=t,this.I=131072,this.h=0}function Nj(n,e,t){e*=2;for(var r=0;;){if(!(r<e))return-1;if(uj(t,n[r]))return r;r+=2}}function Oj(n,e,t,r){this.va=n,this.Ec=e,this.C=t,this.l=r,this.I=131072,this.h=0}function Hj(n){switch(arguments.length){case 6:return Ij(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 7:return Gj(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function Ij(n,e,t,r,i,o){var l=Je(e);if(l===r)return new Oj(null,l,2,[e,t,i,o]);var u=new tj;return Ej.hc(n,l,e,t,u).hc(n,r,i,o,u)}function Gj(n,e,t,r,i,o,l){var u=Je(t);if(u===i)return new Oj(null,u,2,[t,r,o,l]);var s=new tj;return Ej.ic(n,e,u,t,r,s).ic(n,e,i,o,l,s)}function Pj(n,e,t,r,i){this.H=n,this.sa=e,this.J=t,this.ha=r,this.B=i,this.h=32374988,this.I=0}function Dj(n){switch(arguments.length){case 1:return Cj(arguments[0]);case 3:return Qj(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function Cj(n){return Qj(n,0,null)}function Qj(n,e,t){if(null!=t)return new Pj(null,n,e,t,null);for(t=n.length;;){if(!(e<t))return null;if(null!=n[e])return new Pj(null,n,e,null,null);var r=n[e+1];if(p(r)&&p(r=r.Kd()))return new Pj(null,n,e+2,r,null);e+=2}}function Rj(n,e,t,r,i){this.H=n,this.sa=e,this.J=t,this.ha=r,this.B=i,this.h=32374988,this.I=0}function Mj(n){switch(arguments.length){case 1:return Lj(arguments[0]);case 3:return Sj(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function Lj(n){return Sj(n,0,null)}function Sj(n,e,t){if(null!=t)return new Rj(null,n,e,t,null);for(t=n.length;;){if(!(e<t))return null;var r=n[e];if(p(r)&&p(r=r.Kd()))return new Rj(null,n,e+1,r,null);e+=1}}function Tj(n,e){this.Za=n,this.Pf=e,this.Ye=!1}function Uj(n,e,t,r,i,o){this.H=n,this.C=e,this.root=t,this.Ya=r,this.Za=i,this.B=o,this.h=16123663,this.I=139268}Kj.prototype.ra=function(){for(var n=this.l.length;;){if(null!=this.mc&&this.mc.ra())return!0;if(!(this.J<n))return!1;var e=this.l[this.J];this.J+=1,null!=e&&(this.mc=ze(e))}},Kj.prototype.next=function(){if(this.ra())return this.mc.next();throw Error("No such element")},Kj.prototype.remove=function(){return Error("Unsupported operation")},g=Fj.prototype,g.Gc=function(n){return n===this.va?this:new Fj(n,this.C,ed(this.l))},g.Md=function(n,e,t,r,i){var o=t>>>e&31,l=this.l[o];return null==l||(e=l.Md(n,e+5,t,r,i))===l?this:null==e?8>=this.C?Jj(this,n,o):(--(n=xj(this,n,o,e)).C,n):xj(this,n,o,e)},g.Kd=function(){return Lj?Lj(this.l):Mj.call(null,this.l)},g.ad=function(n,e){for(var t=this.l.length,r=0;;){if(!(r<t))return e;var i=this.l[r];if(null!=i){if(cf(e=i.ad(n,e)))return e;r+=1}else r+=1}},g.$c=function(n,e,t,r){var i=this.l[e>>>n&31];return null!=i?i.$c(n+5,e,t,r):r},g.ic=function(n,e,t,r,i,o){var l=t>>>e&31,u=this.l[l];return null==u?((n=xj(this,n,l,Ej.ic(n,e+5,t,r,i,o))).C+=1,n):(e=u.ic(n,e+5,t,r,i,o))===u?this:xj(this,n,l,e)},g.hc=function(n,e,t,r,i){var o=e>>>n&31,l=this.l[o];return null==l?new Fj(null,this.C+1,vj(this.l,o,Ej.hc(n+5,e,t,r,i))):(n=l.hc(n+5,e,t,r,i))===l?this:new Fj(null,this.C,vj(this.l,o,n))},g.Jd=function(n,e,t,r){var i=this.l[e>>>n&31];return null!=i?i.Jd(n+5,e,t,r):r},g.Ld=function(n,e,t){var r=e>>>n&31,i=this.l[r];return null!=i?(n=i.Ld(n+5,e,t))===i?this:null==n?8>=this.C?Jj(this,null,r):new Fj(null,this.C-1,vj(this.l,r,n)):new Fj(null,this.C,vj(this.l,r,n)):this},g.ua=function(){return new Kj(this.l)},g=Oj.prototype,g.Gc=function(n){if(n===this.va)return this;var e=Array(2*(this.C+1));return Xf(this.l,0,e,0,2*this.C),new Oj(n,this.Ec,this.C,e)},g.Md=function(n,e,t,r,i){return-1===(e=Nj(this.l,this.C,r))?this:(i.m=!0,1===this.C?null:((i=(n=this.Gc(n)).l)[e]=i[2*this.C-2],i[e+1]=i[2*this.C-1],i[2*this.C-1]=null,i[2*this.C-2]=null,--n.C,n))},g.Kd=function(){return Cj?Cj(this.l):Dj.call(null,this.l)},g.ad=function(n,e){return yj(this.l,n,e)},g.$c=function(n,e,t,r){return 0>(n=Nj(this.l,this.C,t))?r:uj(t,this.l[n])?this.l[n+1]:r},g.ic=function(n,e,t,r,i,o){return t===this.Ec?-1===(e=Nj(this.l,this.C,r))?this.l.length>2*this.C?(e=2*this.C,t=2*this.C+1,(n=this.Gc(n)).l[e]=r,n.l[t]=i,o.m=!0,n.C+=1,n):(t=this.l.length,e=Array(t+2),Xf(this.l,0,e,0,t),e[t]=r,e[t+1]=i,o.m=!0,r=this.C+1,n===this.va?(this.l=e,this.C=r,n=this):n=new Oj(this.va,this.Ec,r,e),n):this.l[e+1]===i?this:xj(this,n,e+1,i):new Aj(n,1<<(this.Ec>>>e&31),[null,this,null,null]).ic(n,e,t,r,i,o)},g.hc=function(n,e,t,r,i){return e===this.Ec?-1===(n=Nj(this.l,this.C,t))?(n=2*this.C,e=Array(n+2),Xf(this.l,0,e,0,n),e[n]=t,e[n+1]=r,i.m=!0,new Oj(null,this.Ec,this.C+1,e)):A.b(this.l[n+1],r)?this:new Oj(null,this.Ec,this.C,vj(this.l,n+1,r)):new Aj(null,1<<(this.Ec>>>n&31),[null,this]).hc(n,e,t,r,i)},g.Jd=function(n,e,t,r){return 0>(n=Nj(this.l,this.C,t))?r:uj(t,this.l[n])?new Gi(this.l[n],this.l[n+1]):r},g.Ld=function(n,e,t){return-1===(n=Nj(this.l,this.C,t))?this:1===this.C?null:new Oj(null,this.Ec,this.C-1,wj(this.l,tg(n,2)))},g.ua=function(){return new zj(this.l)},g=Pj.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){if(null==this.ha){var n=this.sa,e=this.J+2;return Qj?Qj(n,e,null):Dj.call(null,n,e,null)}n=this.sa,e=this.J;var t=D(this.ha);return Qj?Qj(n,e,t):Dj.call(null,n,e,t)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return null==this.ha?new Gi(this.sa[this.J],this.sa[this.J+1]):C(this.ha)},g.Ha=function(){var n,e,t=this,r=null==t.ha?(n=t.sa,e=t.J+2,Qj?Qj(n,e,null):Dj.call(null,n,e,null)):function(){var n=t.sa,e=t.J,r=D(t.ha);return Qj?Qj(n,e,r):Dj.call(null,n,e,r)}();return null!=r?r:Se},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new Pj(e,this.sa,this.J,this.ha,this.B)},g.ga=function(n,e){return vf(e,this)},Pj.prototype[ad]=function(){return Ue(this)},g=Rj.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){var n=this.sa,e=this.J,t=D(this.ha);return Sj?Sj(n,e,t):Mj.call(null,n,e,t)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return C(this.ha)},g.Ha=function(){var n=this.sa,e=this.J,t=D(this.ha);return null!=(n=Sj?Sj(n,e,t):Mj.call(null,n,e,t))?n:Se},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new Rj(e,this.sa,this.J,this.ha,this.B)},g.ga=function(n,e){return vf(e,this)},Rj.prototype[ad]=function(){return Ue(this)},Tj.prototype.ra=function(){return!this.Ye||this.Pf.ra()},Tj.prototype.next=function(){return this.Ye?this.Pf.next():(this.Ye=!0,new Gi(null,this.Za))},Tj.prototype.remove=function(){return Error("Unsupported operation")},g=Uj.prototype,g.Ac=function(n,e){return null==e?this.Ya?new Gi(null,this.Za):null:null==this.root?null:this.root.Jd(0,Je(e),e,null)},g.toString=function(){return Be(this)},g.keys=function(){return Ue(mj.a?mj.a(this):mj.call(null,this))},g.entries=function(){return new hj(B(B(this)))},g.values=function(){return Ue(nj.a?nj.a(this):nj.call(null,this))},g.has=function(n){return N(this,n)},g.get=function(n,e){return this.M(null,n,e)},g.forEach=function(n){for(var e=B(this),t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i),l=J(o,0,null);o=J(o,1,null),n.b?n.b(o,l):n.call(null,o,l),i+=1}else{if(!(e=B(e)))return null;Wf(e)?(t=re(e),e=se(e),l=t,r=F(t),t=l):(l=J(t=C(e),0,null),o=J(t,1,null),n.b?n.b(o,l):n.call(null,o,l),e=D(e),t=null,r=0),i=0}},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return null==e?this.Ya?this.Za:t:null==this.root?t:this.root.$c(0,Je(e),e,t)},g.Aa=function(n,e,r){return cf(n=this.Ya?e.c?e.c(r,null,this.Za):e.call(null,r,null,this.Za):r)?t(n):null!=this.root?df(this.root.ad(e,n)):n},g.ua=function(){var n=this.root?ze(this.root):mh();return this.Ya?new Tj(this.Za,n):n},g.N=function(){return this.H},g.X=function(){return this.C},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=Ye(this)},g.Y=function(n,e){return fj(this,e)},g.hd=function(){return new Vj(this.root,this.C,this.Ya,this.Za)},g.pa=function(){return Pd(qj,this.H)},g.Ka=function(n,e){return null==e?this.Ya?new Uj(this.H,this.C-1,this.root,!1,null,null):this:null==this.root||(n=this.root.Ld(0,Je(e),e))===this.root?this:new Uj(this.H,this.C-1,n,this.Ya,this.Za,null)},g.fa=function(n,e,t){return null==e?this.Ya&&t===this.Za?this:new Uj(this.H,this.Ya?this.C:this.C+1,this.root,!0,t,null):(n=new tj,(e=(null==this.root?Ej:this.root).hc(0,Je(e),e,t,n))===this.root?this:new Uj(this.H,n.m?this.C+1:this.C,e,this.Ya,this.Za,null))},g.$=function(){if(0<this.C){var n=null!=this.root?this.root.Kd():null;return this.Ya?vf(new Gi(null,this.Za),n):n}return null},g.O=function(n,e){return e===this.H?this:new Uj(e,this.C,this.root,this.Ya,this.Za,this.B)},g.ga=function(n,e){if(Vf(e))return this.fa(null,qd(e,0),qd(e,1));for(n=this,e=B(e);;){if(null==e)return n;var t=C(e);if(!Vf(t))throw Error("conj on a map takes map entries or seqables of map entries");n=zd(n,qd(t,0),qd(t,1)),e=D(e)}},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)};var qj=new Uj(null,0,null,!1,null,Ze);function Wj(n){for(var e=n.length,t=0,r=je(qj);;){if(!(t<e))return le(r);var i=t+2;r=me(r,n[t],n[t+1]),t=i}}function Xj(n,e){for(var t=n.length,r=0,i=je(qj);;){if(!(r<t))return le(i);var o=r+1;i=me(i,n[r],e[r]),r=o}}function Vj(n,e,t,r){this.va={},this.root=n,this.count=e,this.Ya=t,this.Za=r,this.h=259,this.I=56}function Yj(n,e,t){if(n.va){if(null==e)n.Za!==t&&(n.Za=t),n.Ya||(n.count+=1,n.Ya=!0);else{var r=new tj;(e=(null==n.root?Ej:n.root).ic(n.va,0,Je(e),e,t,r))!==n.root&&(n.root=e),r.m&&(n.count+=1)}return n}throw Error("assoc! after persistent!")}function Zj(n,e,t){for(var r=e;;){if(null==n)return r;e=t?n.left:n.right,r=Cf.b(r,n),n=e}}function ak(n,e,t,r,i){this.H=n,this.stack=e,this.Rc=t,this.C=r,this.B=i,this.h=32374990,this.I=0}function bk(n,e,t){return new ak(null,Zj(n,null,e),e,t,null)}function ck(n,e,t,r){return t instanceof dk?t.left instanceof dk?new dk(t.key,t.m,t.left.xc(),new ek(n,e,t.right,r)):t.right instanceof dk?new dk(t.right.key,t.right.m,new ek(t.key,t.m,t.left,t.right.left),new ek(n,e,t.right.right,r)):new ek(n,e,t,r):new ek(n,e,t,r)}function fk(n,e,t,r){return r instanceof dk?r.right instanceof dk?new dk(r.key,r.m,new ek(n,e,t,r.left),r.right.xc()):r.left instanceof dk?new dk(r.left.key,r.left.m,new ek(n,e,t,r.left.left),new ek(r.key,r.m,r.left.right,r.right)):new ek(n,e,t,r):new ek(n,e,t,r)}function gk(n,e,t,r){if(t instanceof dk)return new dk(n,e,t.xc(),r);if(r instanceof ek)return fk(n,e,t,r.Qd());if(r instanceof dk&&r.left instanceof ek)return new dk(r.left.key,r.left.m,new ek(n,e,t,r.left.left),fk(r.key,r.m,r.left.right,r.right.Qd()));throw Error("red-black tree invariant violation")}function hk(n,e,t,r){if(r instanceof dk)return new dk(n,e,t,r.xc());if(t instanceof ek)return ck(n,e,t.Qd(),r);if(t instanceof dk&&t.right instanceof ek)return new dk(t.right.key,t.right.m,ck(t.key,t.m,t.left.Qd(),t.right.left),new ek(n,e,t.right.right,r));throw Error("red-black tree invariant violation")}Uj.prototype[ad]=function(){return Ue(this)},g=Vj.prototype,g.X=function(){if(this.va)return this.count;throw Error("count after persistent!")},g.ia=function(n,e){return null==e?this.Ya?this.Za:null:null==this.root?null:this.root.$c(0,Je(e),e)},g.M=function(n,e,t){return null==e?this.Ya?this.Za:t:null==this.root?t:this.root.$c(0,Je(e),e,t)},g.kd=function(n,e){n:{if(!this.va)throw Error("conj! after persistent");if(Oi(e))n=Yj(this,Pi.a?Pi.a(e):Pi.call(null,e),Qi.a?Qi.a(e):Qi.call(null,e));else if(Vf(e))n=Yj(this,e.a?e.a(0):e.call(null,0),e.a?e.a(1):e.call(null,1));else for(n=B(e),e=this;;){var t=C(n);if(!p(t)){n=e;break n}n=D(n),e=Yj(e,Pi.a?Pi.a(t):Pi.call(null,t),Qi.a?Qi.a(t):Qi.call(null,t))}}return n},g.Cd=function(){if(!this.va)throw Error("persistent! called twice");return this.va=null,new Uj(null,this.count,this.root,this.Ya,this.Za,null)},g.jd=function(n,e,t){return Yj(this,e,t)},g.Fe=function(n,e){if(!this.va)throw Error("dissoc! after persistent!");return null==e?this.Ya&&(this.Ya=!1,this.Za=null,--this.count):null!=this.root&&(n=new tj,(e=this.root.Md(this.va,0,Je(e),e,n))!==this.root&&(this.root=e),n.m&&--this.count),this},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)},g=ak.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.H},g.za=function(){var n=C(this.stack);return null==(n=Zj(this.Rc?n.right:n.left,D(this.stack),this.Rc))?null:new ak(null,n,this.Rc,this.C-1,null)},g.X=function(){return 0>this.C?F(D(this))+1:this.C},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return Mf(this.stack)},g.Ha=function(){var n=C(this.stack);return null!=(n=Zj(this.Rc?n.right:n.left,D(this.stack),this.Rc))?new ak(null,n,this.Rc,this.C-1,null):Se},g.$=function(){return this},g.O=function(n,e){return e===this.H?this:new ak(e,this.stack,this.Rc,this.C,this.B)},g.ga=function(n,e){return vf(e,this)},ak.prototype[ad]=function(){return Ue(this)};var ik=function n(e,t,r){var i,o=null!=e.left?(i=e.left,n.c?n.c(i,t,r):n.call(null,i,t,r)):r;if(cf(o))return o;var l=function(){var n=e.key,r=e.m;return t.c?t.c(o,n,r):t.call(null,o,n,r)}();if(cf(l))return l;if(null!=e.right){var u=e.right;return n.c?n.c(u,t,l):n.call(null,u,t,l)}return l};function ek(n,e,t,r){this.key=n,this.m=e,this.left=t,this.right=r,this.B=null,this.h=166619935,this.I=0}function dk(n,e,t,r){this.key=n,this.m=e,this.left=t,this.right=r,this.B=null,this.h=166619935,this.I=0}g=ek.prototype,g.Ac=function(n,e){switch(e){case 0:return new Gi(0,this.key);case 1:return new Gi(1,this.m);default:return null}},g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.ef=function(n){return n.hf(this)},g.Qd=function(){return new dk(this.key,this.m,this.left,this.right)},g.xc=function(){return this},g.df=function(n){return n.gf(this)},g.replace=function(n,e,t,r){return new ek(n,e,t,r)},g.gf=function(n){return new ek(n.key,n.m,this,n.right)},g.hf=function(n){return new ek(n.key,n.m,n.left,this)},g.ad=function(n,e){return ik(this,n,e)},g.ia=function(n,e){return this.wa(null,e,null)},g.M=function(n,e,t){return this.wa(null,e,t)},g.W=function(n,e){if(0===e)return this.key;if(1===e)return this.m;throw Error("Index out of bounds")},g.wa=function(n,e,t){return 0===e?this.key:1===e?this.m:t},g.Ib=function(n,e,t){return new Q(null,2,5,R,[this.key,this.m],null).Ib(null,e,t)},g.N=function(){return null},g.X=function(){return 2},g.Ce=function(){return this.key},g.De=function(){return this.m},g.Xb=function(){return this.m},g.Yb=function(){return new Q(null,1,5,R,[this.key],null)},g.Bc=function(){return new Qe([this.m,this.key],0,null)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return null},g.Ba=function(n,e){return ff(this,e)},g.Ca=function(n,e,t){return gf(this,e,t)},g.fa=function(n,e,t){return K.c(new Q(null,2,5,R,[this.key,this.m],null),e,t)},g.$=function(){return new Qe([this.key,this.m],0,null)},g.O=function(n,e){return Pd(new Q(null,2,5,R,[this.key,this.m],null),e)},g.ga=function(n,e){return new Q(null,3,5,R,[this.key,this.m,e],null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.W(null,e);case 3:return this.wa(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.W(null,e)},n.c=function(n,e,t){return this.wa(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.W(null,n)},g.b=function(n,e){return this.wa(null,n,e)},ek.prototype[ad]=function(){return Ue(this)},g=dk.prototype,g.Ac=function(n,e){switch(e){case 0:return new Gi(0,this.key);case 1:return new Gi(1,this.m);default:return null}},g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.ef=function(n){return new dk(this.key,this.m,this.left,n)},g.Qd=function(){throw Error("red-black tree invariant violation")},g.xc=function(){return new ek(this.key,this.m,this.left,this.right)},g.df=function(n){return new dk(this.key,this.m,n,this.right)},g.replace=function(n,e,t,r){return new dk(n,e,t,r)},g.gf=function(n){return this.left instanceof dk?new dk(this.key,this.m,this.left.xc(),new ek(n.key,n.m,this.right,n.right)):this.right instanceof dk?new dk(this.right.key,this.right.m,new ek(this.key,this.m,this.left,this.right.left),new ek(n.key,n.m,this.right.right,n.right)):new ek(n.key,n.m,this,n.right)},g.hf=function(n){return this.right instanceof dk?new dk(this.key,this.m,new ek(n.key,n.m,n.left,this.left),this.right.xc()):this.left instanceof dk?new dk(this.left.key,this.left.m,new ek(n.key,n.m,n.left,this.left.left),new ek(this.key,this.m,this.left.right,this.right)):new ek(n.key,n.m,n.left,this)},g.ad=function(n,e){return ik(this,n,e)},g.ia=function(n,e){return this.wa(null,e,null)},g.M=function(n,e,t){return this.wa(null,e,t)},g.W=function(n,e){if(0===e)return this.key;if(1===e)return this.m;throw Error("Index out of bounds")},g.wa=function(n,e,t){return 0===e?this.key:1===e?this.m:t},g.Ib=function(n,e,t){return new Q(null,2,5,R,[this.key,this.m],null).Ib(null,e,t)},g.N=function(){return null},g.X=function(){return 2},g.Ce=function(){return this.key},g.De=function(){return this.m},g.Xb=function(){return this.m},g.Yb=function(){return new Q(null,1,5,R,[this.key],null)},g.Bc=function(){return new Qe([this.m,this.key],0,null)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return null},g.Ba=function(n,e){return ff(this,e)},g.Ca=function(n,e,t){return gf(this,e,t)},g.fa=function(n,e,t){return K.c(new Q(null,2,5,R,[this.key,this.m],null),e,t)},g.$=function(){return new Qe([this.key,this.m],0,null)},g.O=function(n,e){return Pd(new Q(null,2,5,R,[this.key,this.m],null),e)},g.ga=function(n,e){return new Q(null,3,5,R,[this.key,this.m,e],null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.W(null,e);case 3:return this.wa(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.W(null,e)},n.c=function(n,e,t){return this.wa(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.W(null,n)},g.b=function(n,e){return this.wa(null,n,e)},dk.prototype[ad]=function(){return Ue(this)};var jk=function n(e,t,r,i,o){if(null==t)return new dk(r,i,null,null);var l,u=(l=t.key,e.b?e.b(r,l):e.call(null,r,l));return 0===u?(o[0]=t,null):0>u?null!=(u=function(){var l=t.left;return n.K?n.K(e,l,r,i,o):n.call(null,e,l,r,i,o)}())?t.df(u):null:null!=(u=function(){var l=t.right;return n.K?n.K(e,l,r,i,o):n.call(null,e,l,r,i,o)}())?t.ef(u):null},kk=function n(e,t){if(null==e)return t;if(null==t)return e;if(e instanceof dk){if(t instanceof dk){var r=(i=e.right,o=t.left,n.b?n.b(i,o):n.call(null,i,o));return r instanceof dk?new dk(r.key,r.m,new dk(e.key,e.m,e.left,r.left),new dk(t.key,t.m,r.right,t.right)):new dk(e.key,e.m,e.left,new dk(t.key,t.m,r,t.right))}return new dk(e.key,e.m,e.left,function(){var r=e.right;return n.b?n.b(r,t):n.call(null,r,t)}())}var i,o;return t instanceof dk?new dk(t.key,t.m,function(){var r=t.left;return n.b?n.b(e,r):n.call(null,e,r)}(),t.right):(r=function(){var r=e.right,i=t.left;return n.b?n.b(r,i):n.call(null,r,i)}())instanceof dk?new dk(r.key,r.m,new ek(e.key,e.m,e.left,r.left),new ek(t.key,t.m,r.right,t.right)):gk(e.key,e.m,e.left,new ek(t.key,t.m,r,t.right))},lk=function n(e,t,r,i){if(null!=t){var o=(l=t.key,e.b?e.b(r,l):e.call(null,r,l));return 0===o?(i[0]=t,kk(t.left,t.right)):0>o?null!=(o=function(){var o=t.left;return n.A?n.A(e,o,r,i):n.call(null,e,o,r,i)}())||null!=i[0]?t.left instanceof ek?gk(t.key,t.m,o,t.right):new dk(t.key,t.m,o,t.right):null:null!=(o=function(){var o=t.right;return n.A?n.A(e,o,r,i):n.call(null,e,o,r,i)}())||null!=i[0]?t.right instanceof ek?hk(t.key,t.m,t.left,o):new dk(t.key,t.m,t.left,o):null}var l;return null},mk=function n(e,t,r,i){var o,l=t.key,u=e.b?e.b(r,l):e.call(null,r,l);return 0===u?t.replace(l,i,t.left,t.right):0>u?t.replace(l,t.m,(o=t.left,n.A?n.A(e,o,r,i):n.call(null,e,o,r,i)),t.right):t.replace(l,t.m,t.left,function(){var o=t.right;return n.A?n.A(e,o,r,i):n.call(null,e,o,r,i)}())};function nk(n,e,t,r,i){this.Ob=n,this.Mc=e,this.C=t,this.H=r,this.B=i,this.h=418776847,this.I=8192}function ok(n,e){for(var t=n.Mc;;){if(null==t)return null;var r=t.key;if(0===(r=n.Ob.b?n.Ob.b(e,r):n.Ob.call(null,e,r)))return t;t=0>r?t.left:t.right}}g=nk.prototype,g.Ac=function(n,e){return ok(this,e)},g.forEach=function(n){for(var e=B(this),t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i),l=J(o,0,null);o=J(o,1,null),n.b?n.b(o,l):n.call(null,o,l),i+=1}else{if(!(e=B(e)))return null;Wf(e)?(t=re(e),e=se(e),l=t,r=F(t),t=l):(l=J(t=C(e),0,null),o=J(t,1,null),n.b?n.b(o,l):n.call(null,o,l),e=D(e),t=null,r=0),i=0}},g.get=function(n,e){return this.M(null,n,e)},g.entries=function(){return new hj(B(B(this)))},g.toString=function(){return Be(this)},g.keys=function(){return Ue(mj.a?mj.a(this):mj.call(null,this))},g.values=function(){return Ue(nj.a?nj.a(this):nj.call(null,this))},g.has=function(n){return N(this,n)},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return null!=(n=ok(this,e))?n.m:t},g.Aa=function(n,e,t){return null!=this.Mc?df(ik(this.Mc,e,t)):t},g.N=function(){return this.H},g.X=function(){return this.C},g.Bc=function(){return 0<this.C?bk(this.Mc,!1,this.C):null},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=Ye(this)},g.Y=function(n,e){return fj(this,e)},g.pa=function(){return new nk(this.Ob,null,0,this.H,0)},g.Ka=function(n,e){return n=[null],null==(e=lk(this.Ob,this.Mc,e,n))?null==pf(n,0)?this:new nk(this.Ob,null,0,this.H,null):new nk(this.Ob,e.xc(),this.C-1,this.H,null)},g.fa=function(n,e,t){n=[null];var r=jk(this.Ob,this.Mc,e,t,n);return null==r?(n=pf(n,0),A.b(t,n.m)?this:new nk(this.Ob,mk(this.Ob,this.Mc,e,t),this.C,this.H,null)):new nk(this.Ob,r.xc(),this.C+1,this.H,null)},g.$=function(){return 0<this.C?bk(this.Mc,!0,this.C):null},g.O=function(n,e){return e===this.H?this:new nk(this.Ob,this.Mc,this.C,e,this.B)},g.ga=function(n,e){if(Vf(e))return this.fa(null,qd(e,0),qd(e,1));for(n=this,e=B(e);;){if(null==e)return n;var t=C(e);if(!Vf(t))throw Error("conj on a map takes map entries or seqables of map entries");n=zd(n,qd(t,0),qd(t,1)),e=D(e)}},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)};var pk=new nk(dg,null,0,null,Ze);nk.prototype[ad]=function(){return Ue(this)};var qk=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};qk.g=function(n){n=B(n);for(var e=je(qj);;){if(!n)return le(e);var t=D(D(n));e=Zg(e,C(n),zf(n)),n=t}},qk.F=0,qk.G=function(n){return this.g(B(n))};var rk=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function sk(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;n:for(e=B(0<e.length?new Qe(e.slice(0),0,null):null),r=pk;e;)t=D(D(e)),r=K.c(r,C(e),zf(e)),e=t;return r}function tk(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;n:for(t=arguments[0],e=B(1<e.length?new Qe(e.slice(1),0,null):null),r=new nk(fg(t),null,0,null,0);e;)t=D(D(e)),r=K.c(r,C(e),zf(e)),e=t;return r}function uk(n,e){this.na=n,this.Kb=e,this.h=32374988,this.I=0}function mj(n){return(n=B(n))?new uk(n,null):null}function Pi(n){return Dd(n)}function vk(n,e){this.na=n,this.Kb=e,this.h=32374988,this.I=0}function nj(n){return(n=B(n))?new vk(n,null):null}function Qi(n){return Ed(n)}rk.g=function(n){return Gf(n=n instanceof Qe&&0===n.J?n.l:fd(n))},rk.F=0,rk.G=function(n){return this.g(B(n))},g=uk.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.Kb},g.za=function(){var n=(null!=this.na?128&this.na.h||h===this.na.Ad||!this.na.h&&Xc(ud,this.na):Xc(ud,this.na))?this.na.za(null):D(this.na);return null==n?null:new uk(n,null)},g.Z=function(){return We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return this.na.Fa(null).key},g.Ha=function(){var n=(null!=this.na?128&this.na.h||h===this.na.Ad||!this.na.h&&Xc(ud,this.na):Xc(ud,this.na))?this.na.za(null):D(this.na);return null!=n?new uk(n,null):Se},g.$=function(){return this},g.O=function(n,e){return e===this.Kb?this:new uk(this.na,e)},g.ga=function(n,e){return vf(e,this)},uk.prototype[ad]=function(){return Ue(this)},g=vk.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.N=function(){return this.Kb},g.za=function(){var n=(null!=this.na?128&this.na.h||h===this.na.Ad||!this.na.h&&Xc(ud,this.na):Xc(ud,this.na))?this.na.za(null):D(this.na);return null==n?null:new vk(n,null)},g.Z=function(){return We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return wf(e,this)},g.Ca=function(n,e,t){return yf(e,t,this)},g.Fa=function(){return this.na.Fa(null).m},g.Ha=function(){var n=(null!=this.na?128&this.na.h||h===this.na.Ad||!this.na.h&&Xc(ud,this.na):Xc(ud,this.na))?this.na.za(null):D(this.na);return null!=n?new vk(n,null):Se},g.$=function(){return this},g.O=function(n,e){return e===this.Kb?this:new vk(this.na,e)},g.ga=function(n,e){return vf(e,this)},vk.prototype[ad]=function(){return Ue(this)};var wk=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};wk.g=function(n){return p(Eh(lg,n))?gd.b((function(n,e){return Cf.b(p(n)?n:S,e)}),n):null},wk.F=0,wk.G=function(n){return this.g(B(n))};var xk=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],1<t.length?new Qe(t.slice(1),0,null):null)};function yk(n,e){var t=S;for(e=B(e);;){if(!e)return Pd(t,Lf(n));var r=C(e),i=x.c(n,r,zk);t=kh.b(i,zk)?K.c(t,r,i):t,e=D(e)}}function Ak(n){this.Se=n}function Bk(n,e,t){this.H=n,this.Hc=e,this.B=t,this.h=15077647,this.I=139268}xk.g=function(n,e){if(p(Eh(lg,e))){var t=function(e,t){var r,i=Dd(t),o=Ed(t);return N(e,i)?K.c(e,i,(r=x.b(e,i),n.b?n.b(r,o):n.call(null,r,o))):K.c(e,i,o)};return gd.b((function(n,e){return gd.c(t,p(n)?n:S,B(e))}),e)}return null},xk.F=1,xk.G=function(n){var e=C(n);return n=D(n),this.g(e,n)},Ak.prototype.ra=function(){return this.Se.ra()},Ak.prototype.next=function(){if(this.Se.ra())return this.Se.next().key;throw Error("No such element")},Ak.prototype.remove=function(){return Error("Unsupported operation")},g=Bk.prototype,g.toString=function(){return Be(this)},g.keys=function(){return Ue(B(this))},g.entries=function(){return new ij(B(B(this)))},g.values=function(){return Ue(B(this))},g.has=function(n){return N(this,n)},g.forEach=function(n){for(var e=B(this),t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i),l=J(o,0,null);o=J(o,1,null),n.b?n.b(o,l):n.call(null,o,l),i+=1}else{if(!(e=B(e)))return null;Wf(e)?(t=re(e),e=se(e),l=t,r=F(t),t=l):(l=J(t=C(e),0,null),o=J(t,1,null),n.b?n.b(o,l):n.call(null,o,l),e=D(e),t=null,r=0),i=0}},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return p(n=Ad(this.Hc,e))?Dd(n):t},g.ua=function(){return new Ak(ze(this.Hc))},g.N=function(){return this.H},g.X=function(){return kd(this.Hc)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=Ye(this)},g.Y=function(n,e){if(!Rf(e))return!1;if(F(this)!==F(e))return!1;try{return kg((function(n,t){return(n=N(e,t))?n:bf(!1)}),!0,this.Hc)}catch(n){if(n instanceof Error)return!1;throw n}},g.hd=function(){return new Ck(je(this.Hc))},g.pa=function(){return Pd(Dk,this.H)},g.rf=function(n,e){return new Bk(this.H,Cd(this.Hc,e),null)},g.$=function(){return mj(this.Hc)},g.O=function(n,e){return e===this.H?this:new Bk(e,this.Hc,this.B)},g.ga=function(n,e){return new Bk(this.H,K.c(this.Hc,e,null),null)},g.call=function(){var n;return(n=function(n,e,t){switch(arguments.length){case 2:return this.ia(null,e);case 3:return this.M(null,e,t)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return this.ia(null,e)},n.c=function(n,e,t){return this.M(null,e,t)},n}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return this.ia(null,n)},g.b=function(n,e){return this.M(null,n,e)};var Dk=new Bk(null,S,Ze);function Ek(n){for(var e=n.length,t=je(Dk),r=0;r<e;)ke(t,n[r]),r+=1;return le(t)}function Ck(n){this.cd=n,this.I=136,this.h=259}function Fk(n){if(Rf(n))return Kf(n,null);if(null==(n=B(n)))return Dk;if(n instanceof Qe&&0===n.J)return Ek(n.l);for(var e=je(Dk);;){if(null==n)return le(e);var t=D(n);e=ke(e,sd(n)),n=t}}function Gk(n){return function n(e,t){return new Mg(null,(function(){var r;n:{var i=e;for(r=t;;){var o=i;if(i=J(o,0,null),!(o=B(o))){r=null;break n}if(!N(r,i)){r=vf(i,n(Re(o),Cf.b(r,i)));break n}i=Re(o)}}return r}),null,null)}(n,Dk)}function Hk(n){for(var e=I;;){if(!D(n))return B(e);e=Cf.b(e,C(n)),n=D(n)}}function Lg(n){if(null!=n&&(4096&n.I||h===n.jg))return n.yd(null);if("string"==typeof n)return n;throw Error(["Doesn't support name: ",q.a(n)].join(""))}function Ik(n,e){var t=je(S);for(n=B(n),e=B(e);;){if(!n||!e)return le(t);t=Zg(t,C(n),C(e)),n=D(n),e=D(e)}}Bk.prototype[ad]=function(){return Ue(this)},g=Ck.prototype,g.kd=function(n,e){return this.cd=me(this.cd,e,null),this},g.Cd=function(){return new Bk(null,le(this.cd),null)},g.X=function(){return F(this.cd)},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){return xd(this.cd,e,Yf)===Yf?t:e},g.call=function(){function n(n,e,t){return xd(this.cd,e,Yf)===Yf?t:e}function e(n,e){return xd(this.cd,e,Yf)===Yf?null:e}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+(arguments.length-1))}).b=e,t.c=n,t}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return xd(this.cd,n,Yf)===Yf?null:n},g.b=function(n,e){return xd(this.cd,n,Yf)===Yf?e:n};var Jk=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],new Qe(t.slice(3),0,null))}};function Kk(){this.l=[]}function Lk(){return function(n){var e=new Kk;return function(){function t(t,r){return e.add(r),2===e.size()?(r=Ni(e.l),e.clear(),n.b?n.b(t,r):n.call(null,t,r)):t}function r(t){if(!p(e.Nd())){var r=Ni(e.l);e.clear(),t=df(n.b?n.b(t,r):n.call(null,t,r))}return n.a?n.a(t):n.call(null,t)}function i(){return n.o?n.o():n.call(null)}var o;return(o=function(n,e){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,n);case 2:return t.call(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).o=i,o.a=r,o.b=t,o}()}}function Mk(n,e){return new Mg(null,(function(){var t=B(e);if(t){var r=C(t);t=p(r=n.a?n.a(r):n.call(null,r))?vf(C(t),Mk(n,Re(t))):null}else t=null;return t}),null,null)}function Nk(n,e,t){this.start=n,this.step=e,this.count=t,this.h=82,this.I=0}function Ok(n,e,t){this.J=n,this.end=e,this.step=t}function Pk(n,e,t,r,i,o,l){this.H=n,this.start=e,this.end=t,this.step=r,this.Bb=i,this.Yd=o,this.B=l,this.h=32375006,this.I=140800}function Qk(n){if(null==n.Bb){var e=n.X(null);32<e?(n.Yd=new Pk(null,n.start+32*n.step,n.end,n.step,null,null,null),n.Bb=new Nk(n.start,n.step,32)):n.Bb=new Nk(n.start,n.step,e)}}function Rk(n,e){return e<=n?Se:new Pk(null,n,e,1,null,null,null)}function Sk(n,e){return new Mg(null,(function(){var t=B(e);return t?vf(C(t),Sk(n,Yh(n,t))):null}),null,null)}function Tk(n){return le(gd.c((function(n,e){return Zg(n,e,x.c(n,e,0)+1)}),je(S),n))}function Uk(n,e){return function(){function t(t,r,i){return new Q(null,2,5,R,[n.c?n.c(t,r,i):n.call(null,t,r,i),e.c?e.c(t,r,i):e.call(null,t,r,i)],null)}function r(t,r){return new Q(null,2,5,R,[n.b?n.b(t,r):n.call(null,t,r),e.b?e.b(t,r):e.call(null,t,r)],null)}function i(t){return new Q(null,2,5,R,[n.a?n.a(t):n.call(null,t),e.a?e.a(t):e.call(null,t)],null)}function o(){return new Q(null,2,5,R,[n.o?n.o():n.call(null),e.o?e.o():e.call(null)],null)}var l,u=function(){function t(n,e,t,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return r.call(this,n,e,t,o)}function r(t,r,i,o){return new Q(null,2,5,R,[ih(n,t,r,i,o),ih(e,t,r,i,o)],null)}return t.F=3,t.G=function(n){return r(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},t.g=r,t}();return(l=function(n,e,l,s){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,n);case 2:return r.call(this,n,e);case 3:return t.call(this,n,e,l);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Qe(c,0,null)}return u.g(n,e,l,a)}}).F=3,l.G=u.G,l.o=o,l.a=i,l.b=r,l.c=t,l.g=u.g,l}()}function Vk(n){n:for(var e=n;e=B(e);)e=D(e);return n}function Wk(n,e){if("string"==typeof e)return null!=(n=n.exec(e))&&A.b(n[0],e)?1===n.length?n[0]:Ni(n):null;throw new TypeError("re-matches must match against a string.")}function Xk(n,e){if("string"==typeof e)return null==(n=n.exec(e))?null:1===n.length?n[0]:Ni(n);throw new TypeError("re-find must match against a string.")}Jk.b=function(n,e){return e},Jk.c=function(n,e,t){return(n.a?n.a(e):n.call(null,e))>(n.a?n.a(t):n.call(null,t))?e:t},Jk.g=function(n,e,t,r){return gd.c((function(e,t){return Jk.c(n,e,t)}),Jk.c(n,e,t),r)},Jk.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);return t=C(r),r=D(r),this.g(e,n,t,r)},Jk.F=3,Kk.prototype.add=function(n){return this.l.push(n)},Kk.prototype.size=function(){return this.l.length},Kk.prototype.clear=function(){return this.l=[]},Kk.prototype.Nd=function(){return 0===this.l.length},g=Nk.prototype,g.X=function(){return this.count},g.Fa=function(){return this.start},g.W=function(n,e){return this.start+e*this.step},g.wa=function(n,e,t){return 0<=e&&e<this.count?this.start+e*this.step:t},g.ze=function(){if(1>=this.count)throw Error("-drop-first of empty chunk");return new Nk(this.start+this.step,this.step,this.count-1)},Ok.prototype.ra=function(){return 0<this.step?this.J<this.end:this.J>this.end},Ok.prototype.next=function(){var n=this.J;return this.J+=this.step,n},g=Pk.prototype,g.toString=function(){return Be(this)},g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.W=function(n,e){if(0<=e&&e<this.X(null))return this.start+e*this.step;if(0<=e&&this.start>this.end&&0===this.step)return this.start;throw Error("Index out of bounds")},g.wa=function(n,e,t){return 0<=e&&e<this.X(null)?this.start+e*this.step:0<=e&&this.start>this.end&&0===this.step?this.start:t},g.ua=function(){return new Ok(this.start,this.end,this.step)},g.N=function(){return this.H},g.za=function(){return 0<this.step?this.start+this.step<this.end?new Pk(null,this.start+this.step,this.end,this.step,null,null,null):null:this.start+this.step>this.end?new Pk(null,this.start+this.step,this.end,this.step,null,null,null):null},g.X=function(){return Math.ceil((this.end-this.start)/this.step)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=We(this)},g.Y=function(n,e){return uf(this,e)},g.pa=function(){return Se},g.Ba=function(n,e){return ff(this,e)},g.Ca=function(n,e,r){for(n=this.start;;){if(!(0<this.step?n<this.end:n>this.end))return r;if(cf(r=e.b?e.b(r,n):e.call(null,r,n)))return t(r);n+=this.step}},g.Fa=function(){return this.start},g.Ha=function(){var n=this.za(null);return null==n?Se:n},g.$=function(){return this},g.$d=function(){return Qk(this),this.Bb},g.gd=function(){return Qk(this),null==this.Yd?Se:this.Yd},g.O=function(n,e){return e===this.H?this:new Pk(e,this.start,this.end,this.step,this.Bb,this.Yd,this.B)},g.ga=function(n,e){return vf(e,this)},g.Ae=function(){return B(this.gd(null))},Pk.prototype[ad]=function(){return Ue(this)};var Yk=function n(e,t){var r=e.exec(t);if(null==r)return null;var i=r[0];return vf(1===r.length?i:Ni(r),new Mg(null,(function(){var o=i.length;return(o=r.index+(1>o?1:o))<=t.length?(o=t.substring(o),n.b?n.b(e,o):n.call(null,e,o)):null}),null,null))};function Zk(n){if(n instanceof RegExp)return n;var e=Xk(/^\(\?([idmsux]*)\)/,n),t=J(e,0,null);return e=J(e,1,null),new RegExp(n.substring(null==t?0:t.length),p(e)?e:"")}function $k(n,e,t,r,i,o,l){var u,s=Ic;Ic=null==Ic?null:Ic-1;try{if(null!=Ic&&0>Ic)return ce(n,"#");if(ce(n,t),0===Oc.a(o))B(l)&&ce(n,p(u=al.a(o))?u:"...");else{if(B(l)){var a=C(l);e.c?e.c(a,n,o):e.call(null,a,n,o)}for(var c=D(l),d=Oc.a(o)-1;;){if(!c||null!=d&&0===d){B(c)&&0===d&&(ce(n,r),ce(n,function(){var n=al.a(o);return p(n)?n:"..."}()));break}ce(n,r);var h=C(c);t=n,l=o,e.c?e.c(h,t,l):e.call(null,h,t,l),c=D(c),d=t=d-1}}return ce(n,i)}finally{Ic=s}}function bl(n,e){e=B(e);for(var t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i);ce(n,o),i+=1}else{if(!(e=B(e)))return null;Wf(t=e)?(e=re(t),r=se(t),t=e,o=F(e),e=r,r=o):(ce(n,o=C(t)),e=D(t),t=null,r=0),i=0}}function cl(n){if(null==Ec)throw Error("No *print-fn* fn set for evaluation environment");return Ec.call(null,n),null}var dl={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"};function el(n){return['"',q.a(n.replace(/[\\"\b\f\n\r\t]/g,(function(n){return dl[n]}))),'"'].join("")}function fl(n,e){return!!ag(x.b(n,Mc))&&(!(null==e||!(131072&e.h||h===e.xd))&&null!=Lf(e))}function gl(n,e,t){if(null==n)return ce(e,"nil");if(fl(t,n)){ce(e,"^");var r=Lf(n);hl.c?hl.c(r,e,t):hl.call(null,r,e,t),ce(e," ")}if(n.Ia)return n.Ja(e);if(null!=n?2147483648&n.h||h===n.ma||!n.h&&Xc(ee,n):Xc(ee,n))return fe(n,e,t);if(!0===n||!1===n)return ce(e,q.a(n));if("number"==typeof n)return ce(e,isNaN(n)?"##NaN":n===Number.POSITIVE_INFINITY?"##Inf":n===Number.NEGATIVE_INFINITY?"##-Inf":q.a(n));if(null!=n&&n.constructor===Object)return ce(e,"#js "),r=Wh.b((function(e){return new Gi(null!=Wk(/[A-Za-z_\*\+\?!\-'][\w\*\+\?!\-']*/,e)?Kg.a(e):e,n[e])}),Ub(n)),il.A?il.A(r,hl,e,t):il.call(null,r,hl,e,t);if(Rc(n))return $k(e,hl,"#js ["," ","]",t,n);if("string"==typeof n)return p(Lc.a(t))?ce(e,el(n)):ce(e,n);if(fb(n)){var i=n.name;return bl(e,G(["#object[",t=p(null==i||ec(i))?"Function":i,p(!1)?[' "',q.a(n),'"'].join(""):"","]"]))}return n instanceof Date?(t=function(n,e){for(n=q.a(n);;){if(!(n.length<e))return n;n=["0",n].join("")}},bl(e,G(['#inst "',q.a(n.getUTCFullYear()),"-",t(n.getUTCMonth()+1,2),"-",t(n.getUTCDate(),2),"T",t(n.getUTCHours(),2),":",t(n.getUTCMinutes(),2),":",t(n.getUTCSeconds(),2),".",t(n.getUTCMilliseconds(),3),"-",'00:00"']))):n instanceof RegExp?bl(e,G(['#"',n.source,'"'])):nh(n)?bl(e,G(["#object[",n.toString(),"]"])):p(function(){var e=null==n?null:n.constructor;return null==e?null:e.Da}())?bl(e,G(["#object[",n.constructor.Da.replace(/\//g,"."),"]"])):(i=function(){var e=null==n?null:n.constructor;return null==e?null:e.name}(),t=p(function(){var n=null==i;return n||ec(i)}())?"Object":i,null==n.constructor?bl(e,G(["#object[",t,"]"])):bl(e,G(["#object[",t," ",q.a(n),"]"])))}function hl(n,e,t){var r=jl.a(t);return p(r)?(t=K.c(t,kl,gl),r.c?r.c(n,e,t):r.call(null,n,e,t)):gl(n,e,t)}function ll(n,e){var t=new zc,r=new Ae(t);n:{hl(C(n),r,e),n=B(D(n));for(var i=null,o=0,l=0;;)if(l<o){var u=i.W(null,l);ce(r," "),hl(u,r,e),l+=1}else{if(!(n=B(n)))break n;Wf(i=n)?(n=re(i),o=se(i),i=n,u=F(n),n=o,o=u):(u=C(i),ce(r," "),hl(u,r,e),n=D(i),i=null,o=0),l=0}}return r.qc(null),t}function ml(n,e){return Pf(n)?"":q.a(ll(n,e))}function nl(n,e){return cl(ml(n,e))}var ol=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};ol.g=function(n){return ml(n,Jc())},ol.F=0,ol.G=function(n){return this.g(B(n))};var pl=function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return nl(n,K.c(Jc(),Lc,!1))}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),ql=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function rl(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;sl(0<e.length?new Qe(e.slice(0),0,null):null)}function sl(n){return nl(n,K.c(Jc(),Lc,!1)),p(Fc)?(n=Jc(),cl("\n"),x.b(n,Kc),n=null):n=null,n}function tl(n){return n instanceof w?Me.b(null,Lg(n)):Kg.b(null,Lg(n))}function ul(n){if(!p(!1))return null;var e=B(n),t=B(e),r=C(t);for(D(t),J(r,0,null),J(r,1,null),t=Ef(n),n=null;;){r=n,n=C(e=B(e));var i=D(e),o=n;if(n=J(o,0,null),e=J(o,1,null),!p(o))return new Q(null,2,5,R,[r,t],null);if(!(n instanceof z||n instanceof w))return null;if(p(r)){if(!A.b(r,Ig(n)))return null;t=K.c(t,tl(n),e),n=r,e=i}else{if(!p(r=Ig(n)))return null;t=K.c(t,tl(n),e),n=r,e=i}}}function vl(n,e,t,r,i){return $k(r,(function(n,e,r){var i=Dd(n);return t.c?t.c(i,e,r):t.call(null,i,e,r),ce(e," "),n=Ed(n),t.c?t.c(n,e,r):t.call(null,n,e,r)}),[q.a(n),"{"].join(""),", ","}",i,B(e))}function il(n,e,t,r){var i=M(n)?ul(n):null,o=J(i,0,null);return i=J(i,1,null),p(o)?vl(["#:",q.a(o)].join(""),i,e,t,r):vl(null,n,e,t,r)}function xl(n){this.La=n,this.value=null,this.h=2147516416,this.I=1}function Bl(n){return n instanceof xl?t(n):n}function Cl(n,e){this.ue=n,this.be=e,this.h=2173173760,this.I=131072}function Dl(n){return new Cl(fh(Ih,Hk(n)),Bf(n))}function El(){}function Fl(n){if(null!=n&&null!=n.gg)n=n.gg(n);else{var e=Fl[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=Fl._))throw Zc("IEncodeJS.-clj->js",n);n=e.a?e.a(n):e.call(null,n)}}return n}function Gl(n,e){return(null!=n?h===n.fg||!n.Ke&&Xc(El,n):Xc(El,n))?Fl(n):"string"==typeof n||"number"==typeof n||n instanceof z||n instanceof w?e.a?e.a(n):e.call(null,n):ol.g(G([n]))}ql.g=function(n){return ml(n,K.c(Jc(),Lc,!1))},ql.F=0,ql.G=function(n){return this.g(B(n))},Uh.prototype.ma=h,Uh.prototype.S=function(e,t,r){return ce(t,"#object[cljs.core.Volatile "),hl(new n(null,1,[wl,this.state],null),t,r),ce(t,"]")},Ne.prototype.ma=h,Ne.prototype.S=function(n,e,t){return ce(e,"#'"),hl(this.bd,e,t)},Qe.prototype.ma=h,Qe.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Mg.prototype.ma=h,Mg.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Gi.prototype.ma=h,Gi.prototype.S=function(n,e,t){return $k(e,hl,"["," ","]",t,this)},ak.prototype.ma=h,ak.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Pj.prototype.ma=h,Pj.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},ek.prototype.ma=h,ek.prototype.S=function(n,e,t){return $k(e,hl,"["," ","]",t,this)},kj.prototype.ma=h,kj.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Lo.prototype.ma=h,Lo.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Si.prototype.ma=h,Si.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Fg.prototype.ma=h,Fg.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},tf.prototype.ma=h,tf.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Uj.prototype.ma=h,Uj.prototype.S=function(n,e,t){return il(this,hl,e,t)},Rj.prototype.ma=h,Rj.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Ui.prototype.ma=h,Ui.prototype.S=function(n,e,t){return $k(e,hl,"["," ","]",t,this)},nk.prototype.ma=h,nk.prototype.S=function(n,e,t){return il(this,hl,e,t)},Bk.prototype.ma=h,Bk.prototype.S=function(n,e,t){return $k(e,hl,"#{"," ","}",t,this)},Rg.prototype.ma=h,Rg.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Nh.prototype.ma=h,Nh.prototype.S=function(e,t,r){return ce(t,"#object[cljs.core.Atom "),hl(new n(null,1,[wl,this.state],null),t,r),ce(t,"]")},vk.prototype.ma=h,vk.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},dk.prototype.ma=h,dk.prototype.S=function(n,e,t){return $k(e,hl,"["," ","]",t,this)},$h.prototype.ma=h,$h.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Q.prototype.ma=h,Q.prototype.S=function(n,e,t){return $k(e,hl,"["," ","]",t,this)},aj.prototype.ma=h,aj.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Dg.prototype.ma=h,Dg.prototype.S=function(n,e){return ce(e,"()")},bj.prototype.ma=h,bj.prototype.S=function(n,e,t){return $k(e,hl,"#queue ["," ","]",t,B(this))},n.prototype.ma=h,n.prototype.S=function(n,e,t){return il(this,hl,e,t)},Pk.prototype.ma=h,Pk.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Ah.prototype.ma=h,Ah.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},uk.prototype.ma=h,uk.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Df.prototype.ma=h,Df.prototype.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},w.prototype.Oc=h,w.prototype.Wb=function(n,e){if(e instanceof w)return Le(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},z.prototype.Oc=h,z.prototype.Wb=function(n,e){if(e instanceof z)return Gg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},Ui.prototype.Oc=h,Ui.prototype.Wb=function(n,e){if(Vf(e))return eg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},Q.prototype.Oc=h,Q.prototype.Wb=function(n,e){if(Vf(e))return eg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},Gi.prototype.Oc=h,Gi.prototype.Wb=function(n,e){if(Vf(e))return eg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},ek.prototype.Oc=h,ek.prototype.Wb=function(n,e){if(Vf(e))return eg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},dk.prototype.Oc=h,dk.prototype.Wb=function(n,e){if(Vf(e))return eg(this,e);throw Error(["Cannot compare ",q.a(this)," to ",q.a(e)].join(""))},xl.prototype.zb=function(){return p(this.La)&&(this.value=this.La.o?this.La.o():this.La.call(null),this.La=null),this.value},xl.prototype.Bd=function(){return Tc(this.La)},xl.prototype.S=function(e,t,r){return ce(t,"#object[cljs.core.Delay "),hl(new n(null,2,[yl,null==this.La?zl:Al,wl,this.value],null),t,r),ce(t,"]")},g=Cl.prototype,g.indexOf=function(){var n;return(n=function(n,e){switch(arguments.length){case 1:return nf(this,n,0);case 2:return nf(this,n,e)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return nf(this,n,0)},n.b=function(n,e){return nf(this,n,e)},n}(),g.lastIndexOf=function(){function n(n){return rf(this,n,F(this))}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return rf(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return rf(this,n,e)},e}(),g.ua=function(){var n=th(this.be);return Bh(this.ue,n)},g.$=function(){var n=th(this.be);return n=Bh(this.ue,n),B(p(n=zh(n))?n:Se)},g.Ba=function(n,e){return ng(this.ue,mg(e,lg),this.be)},g.Ca=function(n,e,t){return og(this.ue,mg(e,lg),t,this.be)},g.S=function(n,e,t){return $k(e,hl,"("," ",")",t,this)},Cl.prototype[ad]=function(){return Ue(this)};var Hl=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],1<t.length?new Qe(t.slice(1),0,null):null)};function Jl(){}function Kl(n,e){if(null!=n&&null!=n.eg)n=n.eg(n,e);else{var t=Kl[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=Kl._))throw Zc("IEncodeClojure.-js->clj",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function Ll(n){return Ml(n,G([Nl,!1]))}function Ml(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,r=p(t=x.b(t,Nl))?Kg:q;return function n(t){return(null!=t?h===t.Mh||!t.Ke&&Xc(Jl,t):Xc(Jl,t))?Kl(t,fh(rk,e)):$f(t)?Vk(Wh.b(n,t)):Oi(t)?new Gi(n(Dd(t)),n(Ed(t))):Qf(t)?ji.c(Ef(t),Wh.a(n),t):Rc(t)?le(gd.c((function(e,t){return Yg.b(e,n(t))}),je(I),t)):Yc(t)===Object?le(gd.c((function(e,i){return Zg(e,r.a?r.a(i):r.call(null,i),n(Vb(t,i)))}),je(S),Ub(t))):t}(n)}function Ol(n,e){return le(gd.c((function(e,t){var r=n.a?n.a(t):n.call(null,t);return Zg(e,r,Cf.b(x.c(e,r,I),t))}),je(S),e))}Hl.g=function(n,e){e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;var t=x.c(e,Il,Lg),r=function n(e){if(null==e)return null;if(null!=e?h===e.fg||!e.Ke&&Xc(El,e):Xc(El,e))return Fl(e);if(e instanceof z)return t.a?t.a(e):t.call(null,e);if(e instanceof w)return q.a(e);if(M(e)){var i={};e=B(e);for(var o=null,l=0,u=0;;)if(u<l){var s=o.W(null,u),a=J(s,0,null);s=J(s,1,null),a=Gl(a,r),s=n(s),i[a]=s,u+=1}else{if(!(e=B(e)))break;Wf(e)?(l=re(e),e=se(e),o=l,l=F(l)):(o=J(l=C(e),0,null),l=J(l,1,null),o=Gl(o,r),l=n(l),i[o]=l,e=D(e),o=null,l=0),u=0}return i}if(Qf(e)){for(i=[],e=B(Wh.b(n,e)),o=null,u=l=0;;)if(u<l)a=o.W(null,u),i.push(a),u+=1;else{if(!(e=B(e)))break;Wf(o=e)?(e=re(o),u=se(o),o=e,l=F(e),e=u):(e=C(o),i.push(e),e=D(o),o=null,l=0),u=0}return i}return e};return r(n)},Hl.F=1,Hl.G=function(n){var e=C(n);return n=D(n),this.g(e,n)};var Pl=null;function Ql(){return null==Pl&&(Pl=Oh(new n(null,3,[Rl,S,Sl,S,Tl,S],null))),Pl}function Ul(n,e,t){var r=A.b(e,t);if(r)return r;if(r=N(r=(r=Tl.a(n)).a?r.a(e):r.call(null,e),t))return r;if(!Vf(t))return!1;if(!Vf(e))return!1;if(F(t)!==F(e))return!1;r=!0;for(var i=0;;){if(!r||i===F(t))return r;r=Ul(n,e.a?e.a(i):e.call(null,i),t.a?t.a(i):t.call(null,i)),i+=1}}function Vl(n){var e=t(Ql());return lh(x.b(Rl.a(e),n))}function Wl(n,e,r,i){Rh.b(n,(function(){return t(e)})),Rh.b(r,(function(){return t(i)}))}var Xl=function n(e,r,i){var o,l=(o=t(i)).a?o.a(e):o.call(null,e);return l=!!p(p(l)?l.a?l.a(r):l.call(null,r):l)||null,(p(l)||p(l=function(){for(var t=Vl(r);;){if(!(0<F(t)))return null;var o=C(t);n.c?n.c(e,o,i):n.call(null,e,o,i),t=Re(t)}}())||!!p(l=function(){for(var t=Vl(e);;){if(!(0<F(t)))return null;var o=C(t);n.c?n.c(o,r,i):n.call(null,o,r,i),t=Re(t)}}()))&&l};function Yl(n,e,t,r){return p(t=Xl(n,e,t))?t:Ul(r,n,e)}var Zl=function n(e,r,i,o,l,u,s,a){var c=gd.c((function(n,o){var u=J(o,0,null);if(J(o,1,null),Ul(t(i),r,u)){if(n=null==n||Yl(u,C(n),l,t(i))?o:n,!Yl(C(n),u,l,t(i)))throw Error(["Multiple methods in multimethod '",q.a(e),"' match dispatch value: ",q.a(r)," -> ",q.a(u)," and ",q.a(C(n)),", and neither is preferred"].join(""));return n}return n}),null,t(o)),d=function(){if(null==c){var n=t(o);n=n.a?n.a(a):n.call(null,a)}else n=!1;return p(n)?new Q(null,2,5,R,[a,n],null):c}();return p(d)?A.b(t(s),t(i))?(Rh.A(u,K,r,zf(d)),zf(d)):(Wl(u,o,s,i),n.Ga?n.Ga(e,r,i,o,l,u,s,a):n.call(null,e,r,i,o,l,u,s,a)):null};function $l(n,e,t){if(null!=n&&null!=n.v)n.v(n,e,t);else{var r=$l[db(null==n?null:n)];if(null!=r)r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=$l._))throw Zc("IMultiFn.-add-method",n);r.c?r.c(n,e,t):r.call(null,n,e,t)}}}function am(n,e){if(null!=n&&null!=n.Ea)n=n.Ea(n,e);else{var t=am[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=am._))throw Zc("IMultiFn.-get-method",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function bm(n){if(null!=n&&null!=n.ig)n=n.R;else{var e=bm[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=bm._))throw Zc("IMultiFn.-dispatch-fn",n);n=e.a?e.a(n):e.call(null,n)}}return n}function cm(n,e){throw Error(["No method in multimethod '",q.a(n),"' for dispatch value: ",q.a(e)].join(""))}function dm(n,e,t,r,i,o,l){var u=em;this.name=n,this.R=e,this.vg=u,this.fe=t,this.ke=r,this.xh=i,this.je=o,this.Ud=l,this.h=4194305,this.I=4352}function fm(n){this.dd=n,this.B=null,this.h=2153775104,this.I=2048}function gm(){function n(){return Math.floor(16*Math.random()).toString(16)}var e=(8|3&Math.floor(16*Math.random())).toString(16);return new fm([q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),"-",q.a(n()),q.a(n()),q.a(n()),q.a(n()),"-4",q.a(n()),q.a(n()),q.a(n()),"-",q.a(e),q.a(n()),q.a(n()),q.a(n()),"-",q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n()),q.a(n())].join("").toLowerCase())}function hm(n,e,t){var r=Error(n);return this.message=n,this.data=e,this.lf=t,this.name=r.name,this.description=r.description,this.number=r.number,this.fileName=r.fileName,this.lineNumber=r.lineNumber,this.columnNumber=r.columnNumber,this.stack=r.stack,this}function im(n,e){return jm(n,e,null)}function jm(n,e,t){return new hm(n,e,t)}function km(n){return n instanceof hm?n.data:null}function lm(n){return n instanceof Error?n.message:null}function mm(e){return N(new Bk(null,new n(null,24,[nm,"null",om,"null",pm,"null",qm,"null",rm,"null",sm,"null",tm,"null",um,"null",vm,"null",wm,"null",xm,"null",ym,"null",zm,"null",Am,"null",Bm,"null",Cm,"null",Dm,"null",Em,"null",Fm,"null",Gm,"null",Hm,"null",Im,"null",Jm,"null",Km,"null"],null),null),e)}function Lm(n,e){this.tag=n,this.form=e,this.h=2153775360,this.I=0}g=dm.prototype,g.call=function(){function n(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$,_){var S=jh((n=this).R,e,t,r,i,G([o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$,_])),I=this.Ea(null,S);return p(I)||cm(n.name,S),jh(I,e,t,r,i,G([o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$,_]))}function e(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$){var _=(n=this).R.rb?n.R.rb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$),S=this.Ea(null,_);return p(S)||cm(n.name,_),S.rb?S.rb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$):S.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$)}function t(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b){var $=(n=this).R.hb?n.R.hb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b),_=this.Ea(null,$);return p(_)||cm(n.name,$),_.hb?_.hb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b):_.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b)}function r(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y){var b=(n=this).R.qb?n.R.qb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y),$=this.Ea(null,b);return p($)||cm(n.name,b),$.qb?$.qb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y):$.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y)}function i(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m){var y=(n=this).R.gb?n.R.gb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m),b=this.Ea(null,y);return p(b)||cm(n.name,y),b.gb?b.gb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m):b.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m)}function o(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v){var m=(n=this).R.pb?n.R.pb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v),y=this.Ea(null,m);return p(y)||cm(n.name,m),y.pb?y.pb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v):y.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v)}function l(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w){var v=(n=this).R.fb?n.R.fb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w),m=this.Ea(null,v);return p(m)||cm(n.name,v),m.fb?m.fb(e,t,r,i,o,l,u,s,a,c,d,h,f,g,w):m.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w)}function u(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g){var w=(n=this).R.ob?n.R.ob(e,t,r,i,o,l,u,s,a,c,d,h,f,g):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g),v=this.Ea(null,w);return p(v)||cm(n.name,w),v.ob?v.ob(e,t,r,i,o,l,u,s,a,c,d,h,f,g):v.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f,g)}function s(n,e,t,r,i,o,l,u,s,a,c,d,h,f){var g=(n=this).R.eb?n.R.eb(e,t,r,i,o,l,u,s,a,c,d,h,f):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f),w=this.Ea(null,g);return p(w)||cm(n.name,g),w.eb?w.eb(e,t,r,i,o,l,u,s,a,c,d,h,f):w.call(null,e,t,r,i,o,l,u,s,a,c,d,h,f)}function a(n,e,t,r,i,o,l,u,s,a,c,d,h){var f=(n=this).R.nb?n.R.nb(e,t,r,i,o,l,u,s,a,c,d,h):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d,h),g=this.Ea(null,f);return p(g)||cm(n.name,f),g.nb?g.nb(e,t,r,i,o,l,u,s,a,c,d,h):g.call(null,e,t,r,i,o,l,u,s,a,c,d,h)}function c(n,e,t,r,i,o,l,u,s,a,c,d){var h=(n=this).R.cb?n.R.cb(e,t,r,i,o,l,u,s,a,c,d):n.R.call(null,e,t,r,i,o,l,u,s,a,c,d),f=this.Ea(null,h);return p(f)||cm(n.name,h),f.cb?f.cb(e,t,r,i,o,l,u,s,a,c,d):f.call(null,e,t,r,i,o,l,u,s,a,c,d)}function d(n,e,t,r,i,o,l,u,s,a,c){var d=(n=this).R.mb?n.R.mb(e,t,r,i,o,l,u,s,a,c):n.R.call(null,e,t,r,i,o,l,u,s,a,c),h=this.Ea(null,d);return p(h)||cm(n.name,d),h.mb?h.mb(e,t,r,i,o,l,u,s,a,c):h.call(null,e,t,r,i,o,l,u,s,a,c)}function h(n,e,t,r,i,o,l,u,s,a){var c=(n=this).R.Xa?n.R.Xa(e,t,r,i,o,l,u,s,a):n.R.call(null,e,t,r,i,o,l,u,s,a),d=this.Ea(null,c);return p(d)||cm(n.name,c),d.Xa?d.Xa(e,t,r,i,o,l,u,s,a):d.call(null,e,t,r,i,o,l,u,s,a)}function f(n,e,t,r,i,o,l,u,s){var a=(n=this).R.Ga?n.R.Ga(e,t,r,i,o,l,u,s):n.R.call(null,e,t,r,i,o,l,u,s),c=this.Ea(null,a);return p(c)||cm(n.name,a),c.Ga?c.Ga(e,t,r,i,o,l,u,s):c.call(null,e,t,r,i,o,l,u,s)}function g(n,e,t,r,i,o,l,u){var s=(n=this).R.ib?n.R.ib(e,t,r,i,o,l,u):n.R.call(null,e,t,r,i,o,l,u),a=this.Ea(null,s);return p(a)||cm(n.name,s),a.ib?a.ib(e,t,r,i,o,l,u):a.call(null,e,t,r,i,o,l,u)}function w(n,e,t,r,i,o,l){var u=(n=this).R.la?n.R.la(e,t,r,i,o,l):n.R.call(null,e,t,r,i,o,l),s=this.Ea(null,u);return p(s)||cm(n.name,u),s.la?s.la(e,t,r,i,o,l):s.call(null,e,t,r,i,o,l)}function v(n,e,t,r,i,o){var l=(n=this).R.K?n.R.K(e,t,r,i,o):n.R.call(null,e,t,r,i,o),u=this.Ea(null,l);return p(u)||cm(n.name,l),u.K?u.K(e,t,r,i,o):u.call(null,e,t,r,i,o)}function m(n,e,t,r,i){var o=(n=this).R.A?n.R.A(e,t,r,i):n.R.call(null,e,t,r,i),l=this.Ea(null,o);return p(l)||cm(n.name,o),l.A?l.A(e,t,r,i):l.call(null,e,t,r,i)}function y(n,e,t,r){var i=(n=this).R.c?n.R.c(e,t,r):n.R.call(null,e,t,r),o=this.Ea(null,i);return p(o)||cm(n.name,i),o.c?o.c(e,t,r):o.call(null,e,t,r)}function b(n,e,t){var r=(n=this).R.b?n.R.b(e,t):n.R.call(null,e,t),i=this.Ea(null,r);return p(i)||cm(n.name,r),i.b?i.b(e,t):i.call(null,e,t)}function $(n,e){var t=(n=this).R.a?n.R.a(e):n.R.call(null,e),r=this.Ea(null,t);return p(r)||cm(n.name,t),r.a?r.a(e):r.call(null,e)}function _(n){var e=(n=this).R.o?n.R.o():n.R.call(null),t=this.Ea(null,e);return p(t)||cm(n.name,e),t.o?t.o():t.call(null)}var S;return(S=function(p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L){switch(arguments.length){case 1:return _.call(this,p);case 2:return $.call(this,p,S);case 3:return b.call(this,p,S,I);case 4:return y.call(this,p,S,I,C);case 5:return m.call(this,p,S,I,C,R);case 6:return v.call(this,p,S,I,C,R,A);case 7:return w.call(this,p,S,I,C,R,A,E);case 8:return g.call(this,p,S,I,C,R,A,E,D);case 9:return f.call(this,p,S,I,C,R,A,E,D,x);case 10:return h.call(this,p,S,I,C,R,A,E,D,x,T);case 11:return d.call(this,p,S,I,C,R,A,E,D,x,T,k);case 12:return c.call(this,p,S,I,C,R,A,E,D,x,T,k,O);case 13:return a.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M);case 14:return s.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j);case 15:return u.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N);case 16:return l.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q);case 17:return o.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P);case 18:return i.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G);case 19:return r.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W);case 20:return t.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q);case 21:return e.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J);case 22:return n.call(this,p,S,I,C,R,A,E,D,x,T,k,O,M,j,N,Q,P,G,W,q,J,L)}throw Error("Invalid arity: "+(arguments.length-1))}).a=_,S.b=$,S.c=b,S.A=y,S.K=m,S.la=v,S.ib=w,S.Ga=g,S.Xa=f,S.mb=h,S.cb=d,S.nb=c,S.eb=a,S.ob=s,S.fb=u,S.pb=l,S.gb=o,S.qb=i,S.hb=r,S.rb=t,S.Sc=e,S.Be=n,S}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.o=function(){var n=this.R.o?this.R.o():this.R.call(null),e=this.Ea(null,n);return p(e)||cm(this.name,n),e.o?e.o():e.call(null)},g.a=function(n){var e=this.R.a?this.R.a(n):this.R.call(null,n),t=this.Ea(null,e);return p(t)||cm(this.name,e),t.a?t.a(n):t.call(null,n)},g.b=function(n,e){var t=this.R.b?this.R.b(n,e):this.R.call(null,n,e),r=this.Ea(null,t);return p(r)||cm(this.name,t),r.b?r.b(n,e):r.call(null,n,e)},g.c=function(n,e,t){var r=this.R.c?this.R.c(n,e,t):this.R.call(null,n,e,t),i=this.Ea(null,r);return p(i)||cm(this.name,r),i.c?i.c(n,e,t):i.call(null,n,e,t)},g.A=function(n,e,t,r){var i=this.R.A?this.R.A(n,e,t,r):this.R.call(null,n,e,t,r),o=this.Ea(null,i);return p(o)||cm(this.name,i),o.A?o.A(n,e,t,r):o.call(null,n,e,t,r)},g.K=function(n,e,t,r,i){var o=this.R.K?this.R.K(n,e,t,r,i):this.R.call(null,n,e,t,r,i),l=this.Ea(null,o);return p(l)||cm(this.name,o),l.K?l.K(n,e,t,r,i):l.call(null,n,e,t,r,i)},g.la=function(n,e,t,r,i,o){var l=this.R.la?this.R.la(n,e,t,r,i,o):this.R.call(null,n,e,t,r,i,o),u=this.Ea(null,l);return p(u)||cm(this.name,l),u.la?u.la(n,e,t,r,i,o):u.call(null,n,e,t,r,i,o)},g.ib=function(n,e,t,r,i,o,l){var u=this.R.ib?this.R.ib(n,e,t,r,i,o,l):this.R.call(null,n,e,t,r,i,o,l),s=this.Ea(null,u);return p(s)||cm(this.name,u),s.ib?s.ib(n,e,t,r,i,o,l):s.call(null,n,e,t,r,i,o,l)},g.Ga=function(n,e,t,r,i,o,l,u){var s=this.R.Ga?this.R.Ga(n,e,t,r,i,o,l,u):this.R.call(null,n,e,t,r,i,o,l,u),a=this.Ea(null,s);return p(a)||cm(this.name,s),a.Ga?a.Ga(n,e,t,r,i,o,l,u):a.call(null,n,e,t,r,i,o,l,u)},g.Xa=function(n,e,t,r,i,o,l,u,s){var a=this.R.Xa?this.R.Xa(n,e,t,r,i,o,l,u,s):this.R.call(null,n,e,t,r,i,o,l,u,s),c=this.Ea(null,a);return p(c)||cm(this.name,a),c.Xa?c.Xa(n,e,t,r,i,o,l,u,s):c.call(null,n,e,t,r,i,o,l,u,s)},g.mb=function(n,e,t,r,i,o,l,u,s,a){var c=this.R.mb?this.R.mb(n,e,t,r,i,o,l,u,s,a):this.R.call(null,n,e,t,r,i,o,l,u,s,a),d=this.Ea(null,c);return p(d)||cm(this.name,c),d.mb?d.mb(n,e,t,r,i,o,l,u,s,a):d.call(null,n,e,t,r,i,o,l,u,s,a)},g.cb=function(n,e,t,r,i,o,l,u,s,a,c){var d=this.R.cb?this.R.cb(n,e,t,r,i,o,l,u,s,a,c):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c),h=this.Ea(null,d);return p(h)||cm(this.name,d),h.cb?h.cb(n,e,t,r,i,o,l,u,s,a,c):h.call(null,n,e,t,r,i,o,l,u,s,a,c)},g.nb=function(n,e,t,r,i,o,l,u,s,a,c,d){var h=this.R.nb?this.R.nb(n,e,t,r,i,o,l,u,s,a,c,d):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d),f=this.Ea(null,h);return p(f)||cm(this.name,h),f.nb?f.nb(n,e,t,r,i,o,l,u,s,a,c,d):f.call(null,n,e,t,r,i,o,l,u,s,a,c,d)},g.eb=function(n,e,t,r,i,o,l,u,s,a,c,d,h){var f=this.R.eb?this.R.eb(n,e,t,r,i,o,l,u,s,a,c,d,h):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h),g=this.Ea(null,f);return p(g)||cm(this.name,f),g.eb?g.eb(n,e,t,r,i,o,l,u,s,a,c,d,h):g.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h)},g.ob=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f){var g=this.R.ob?this.R.ob(n,e,t,r,i,o,l,u,s,a,c,d,h,f):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f),w=this.Ea(null,g);return p(w)||cm(this.name,g),w.ob?w.ob(n,e,t,r,i,o,l,u,s,a,c,d,h,f):w.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f)},g.fb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g){var w=this.R.fb?this.R.fb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g),v=this.Ea(null,w);return p(v)||cm(this.name,w),v.fb?v.fb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g):v.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g)},g.pb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w){var v=this.R.pb?this.R.pb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w),m=this.Ea(null,v);return p(m)||cm(this.name,v),m.pb?m.pb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w):m.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w)},g.gb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v){var m=this.R.gb?this.R.gb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v),y=this.Ea(null,m);return p(y)||cm(this.name,m),y.gb?y.gb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v):y.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v)},g.qb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m){var y=this.R.qb?this.R.qb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m),b=this.Ea(null,y);return p(b)||cm(this.name,y),b.qb?b.qb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m):b.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m)},g.hb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y){var b=this.R.hb?this.R.hb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y),$=this.Ea(null,b);return p($)||cm(this.name,b),$.hb?$.hb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y):$.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y)},g.rb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b){var $=this.R.rb?this.R.rb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b):this.R.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b),_=this.Ea(null,$);return p(_)||cm(this.name,$),_.rb?_.rb(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b):_.call(null,n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b)},g.Sc=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$){var _=jh(this.R,n,e,t,r,G([i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$])),S=this.Ea(null,_);return p(S)||cm(this.name,_),jh(S,n,e,t,r,G([i,o,l,u,s,a,c,d,h,f,g,w,v,m,y,b,$]))},g.ig=function(){return this.R},g.v=function(n,e,t){return Rh.A(this.ke,K,e,t),Wl(this.je,this.ke,this.Ud,this.fe),this},g.Ea=function(n,e){return A.b(t(this.Ud),t(this.fe))||Wl(this.je,this.ke,this.Ud,this.fe),p(n=(n=t(this.je)).a?n.a(e):n.call(null,e))?n:Zl(this.name,e,this.fe,this.ke,this.xh,this.je,this.Ud,this.vg)},g.yd=function(){return te(this.name)},g.zd=function(){return ue(this.name)},g.Z=function(){return hb(this)},g=fm.prototype,g.toString=function(){return this.dd},g.Y=function(n,e){return e instanceof fm&&this.dd===e.dd},g.S=function(n,e){return ce(e,['#uuid "',q.a(this.dd),'"'].join(""))},g.Z=function(){return null==this.B&&(this.B=Je(this.dd)),this.B},g.Wb=function(n,e){return Pb(this.dd,e.dd)},hm.prototype.__proto__=Error.prototype,hm.prototype.ma=h,hm.prototype.S=function(n,e,t){return ce(e,"#error {:message "),hl(this.message,e,t),p(this.data)&&(ce(e,", :data "),hl(this.data,e,t)),p(this.lf)&&(ce(e,", :cause "),hl(this.lf,e,t)),ce(e,"}")},hm.prototype.toString=function(){return Be(this)},g=Lm.prototype,g.toString=function(){return Be(this)},g.Y=function(n,e){return e instanceof Lm&&A.b(this.tag,e.tag)&&A.b(this.form,e.form)},g.Z=function(){return 31*Je(this.tag)+Je(this.form)},g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"tag":return this.tag;case"form":return this.form;default:return t}},g.S=function(n,e,t){return ce(e,["#",q.a(this.tag)," "].join("")),hl(this.form,e,t)};var Mm="arguments abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield methods null constructor".split(" "),Nm=null;function Om(n){return null==Nm&&(Nm=gd.c((function(n,e){return n[e]=!0,n}),{},Mm)),Nm.hasOwnProperty(n)}function Pm(){return p(dd)||(dd=function(){for(var n=gg((function(n,e){return e.length-n.length})),e="";;){if(!B(n))return[e,"|\\$"].join("");var t=D(n),r=[(i=void 0,i=e,""!==e?[i,"|"].join(""):i),q.a(C(n))].join("");n=t,e=r}var i}()),dd}function Qm(n){var e=q.a(n);if("_DOT__DOT_"===e)var t="..";else n:{t=new RegExp(Pm(),"g"),e=p(dc(e,"$"))?e.substring(0,e.length-1):e;for(var r="",i=0;;){var o=t.exec(e);if(!p(o)){t=[r,q.a(e.substring(i,e.length))].join("");break n}o=J(o,0,null),r=[r,q.a(e.substring(i,t.lastIndex-o.length)),q.a("$"===o?"/":Vb(cd,o))].join(""),i=t.lastIndex}}return(n=n instanceof w?Me:q).a?n.a(t):n.call(null,t)}function Rm(n){this.name=n,this.h=6291456,this.I=0}Rm.prototype.toString=function(){return q.a(this.name)},Rm.prototype.Y=function(n,e){return e instanceof Rm&&A.b(this.name,e.name)},Rm.prototype.Z=function(){return Je(this.name)};var Sm=null;"undefined"!=typeof console&&Pc(),Pc();var Tm=new z(ta,"type","gateway.common.spec.messages/type",2118883938),jo=new z(ra,"type","gateway.common.context.spec.requests/type",372560587),Vm=new z(Da,"snapshot","gateway.domains.agm.spec.requests/snapshot",476154767),Wm=new w(null,"argm","argm",-181546357,null),Ym=new z(null,"metrics","metrics",394093469),Zm=new w(null,"not-native","not-native",-236392494,null),$m=new z(Ka,"creator_id","gateway.domains.global.spec.messages/creator_id",2015161290),an=new z(null,"local?","local?",-1422786101),bn=new z(Ua,"lifetime","gateway.state.spec.context/lifetime",-510268810),cn=new z(null,"level","level",1290497552),dn=new z(null,"?err_","?err_",789480858),en=new z(null,"line","line",212345235),fn=new z(null,"repeat","repeat",832692087),XE=new w(null,"p__11461","p__11461",1947099634,null),gn=new z(null,"client-request","client-request",-1402967032),hn=new z(Da,"stream_id","gateway.domains.agm.spec.requests/stream_id",-1290121066),jn=new z(null,"ALPHA","ALPHA",-1463859144),kn=new z(null,"repository-factories","repository-factories",-545628132),rm=new w(null,"ns*","ns*",1840949383,null),ln=new z(null,"initiator","initiator",217480362),mn=new z(null,"left","left",-399115937),nn=new z(Ta,"activity-id","gateway.state.spec.common/activity-id",245315645),nF=new w(null,"meta12351","meta12351",-1022518466,null),on=new z(null,"context-added","context-added",-639543900),pn=new z(null,"signature-key","signature-key",-1652526996),qn=new z(null,"start-block-t","start-block-t",-373430594),rn=new z(Ta,"type","gateway.state.spec.common/type",-877512429),sn=new z(null,"per-line-prefix","per-line-prefix",846941813),tn=new z(null,"local-ip","local-ip",302001740),un=new z(null,"blacklist-ns","blacklist-ns",1200193567),vn=new z(null,"low","low",-1601362409),wn=new z(Ua,"members","gateway.state.spec.context/members",1219498589),xn=new z(null,"string","string",-1989541586),yn=new z(null,"data","data",-232669377),yF=new w(null,"p__12315","p__12315",1435898405,null),zn=new z(null,"factor","factor",-2103172748),An=new z(null,"parsers","parsers",-804353827),Bn=new z(Ea,"unregister","gateway.domains.agm.spec.unregister/unregister",388278210),Cn=new z(Qa,"id","gateway.state.spec.activity/id",1251756953),Dn=new z(null,"peers","peers",2005345354),En=new z(da,"amp","cljs.spec.alpha/amp",831147508),Fn=new z(Za,"string-restrictions","gateway.state.spec.restrictions/string-restrictions",-382592371),Hn=new z(null,"done-nl","done-nl",-381024340),In=new z(Ua,"timestamp","gateway.state.spec.context/timestamp",1704984480),Jn=new z(null,"private","private",-558947994),Kn=new z(da,"alt","cljs.spec.alpha/alt",523685437),yl=new z(null,"status","status",-1997798413),Ln=new z(null,"version","version",425292698),Mn=new z(null,"trace?","trace?",1730690679),Nn=new z(null,"last-access","last-access",1110221580),On=new z(ta,"peer-message","gateway.common.spec.messages/peer-message",823378764),Pn=new z(null,"days","days",-1394072564),Qn=new w(null,"opt-un","opt-un",-1770993273,null),Rn=new z(null,"description","description",-1428560544),Sn=new z(null,"process-id","process-id",-2118975265),Tn=new z(null,"available_domains","available_domains",-981328192),Un=new w(aa,"deref","cljs.core/deref",1901963335,null),Vn=new z(null,"parser2","parser2",1013754688),Wn=new z(Ba,"meta","gateway.domains.agm.spec.messages/meta",520804499),Xn=new z(null,"parser1","parser1",-439601422),Yn=new z(da,"nil","cljs.spec.alpha/nil",1733813950),Zn=new z(da,"kind-form","cljs.spec.alpha/kind-form",-1047104697),$n=new z(null,"interests","interests",1200294902),ao=new z(null,"contexts","contexts",4351546),bo=new w(null,"conform-into","conform-into",-1039113729,null),co=new z(null,"begin-test-var","begin-test-var",-908571100),eo=new z(Sa,"subscription-id","gateway.state.spec.bus/subscription-id",-1920104157),go=new z(null,"mandatory","mandatory",542802336),ho=new z(null,"end-column","end-column",1425389514),io=new w(da,"multi-spec","cljs.spec.alpha/multi-spec",175821274,null),ko=new z(null,"resolved_identity","resolved_identity",-874947112),NF=new w(null,"meta10588","meta10588",-43678257,null),mo=new z(null,"interop","interop",-1183783726),no=new z(null,"end-of-string","end-of-string",1567354241),oo=new z(null,"delta","delta",108939957),po=new z(null,"service?","service?",-2064761863),qo=new z(null,"base-args","base-args",-1268706822),ro=new z(ra,"updated","gateway.common.context.spec.requests/updated",-286888249),so=new w(null,"message-body","message-body",-554118051,null),zk=new z(aa,"not-found","cljs.core/not-found",-1572889185),to=new z(null,"create-token","create-token",-1564000484),uo=new z(null,"vargs_","vargs_",552132148),vo=new z(null,"server","server",1499190120),wo=new z(null,"grammar","grammar",1881328267),xo=new z(Xa,"method","gateway.state.spec.mthds/method",1887447044),yo=new z(null,"def","def",-1043430536),zo=new z(null,"destination","destination",-253872483),Ao=new w(null,"max-count","max-count",-1115250464,null),Bo=new w(aa,"string?","cljs.core/string?",-2072921719,null),Co=new z(null,"auto-whitespace","auto-whitespace",741152317),Do=new w(null,"forms","forms",-608443419,null),Eo=new z(null,"right-margin","right-margin",-810413306),Fo=new z($a,"activity-subscribers","gateway.state.spec.state/activity-subscribers",-776389065),Go=new z(null,"ref-counted","ref-counted",-1035328654),Ho=new z(Ra,"subscriber","gateway.state.spec.agm/subscriber",2009954326),sG=new z(null,"destroy_peer_id","destroy_peer_id",388079342),Io=new z(null,"ready?","ready?",-105765697),Jo=new z(La,"write_permissions","gateway.domains.global.spec.requests/write_permissions",774911915),Ko=new z(null,"exponentchar","exponentchar",1986664222),No=new z(null,"start-time","start-time",814801386),Oo=new w(null,"pred","pred",-727012372,null),Po=new z(Za,"empty-restrictions","gateway.state.spec.restrictions/empty-restrictions",1011650447),Qo=new z(null,"directive","directive",793559132),Ro=new z(null,"secret","secret",618547054),So=new z(da,"name","cljs.spec.alpha/name",205233570),To=new z(Va,"registered-domains","gateway.state.spec.domain-registry/registered-domains",511803772),Uo=new z(Xa,"version","gateway.state.spec.mthds/version",1762403198),Vo=new z(Ra,"calls","gateway.state.spec.agm/calls",16611731),Wo=new z(Da,"remove-interest","gateway.domains.agm.spec.requests/remove-interest",-328528457),Xo=new z(La,"context_id","gateway.domains.global.spec.requests/context_id",-1750912658),Yo=new z(Ta,"node","gateway.state.spec.common/node",-570411717),Zo=new z(null,"topic","topic",-1960480691),$o=new w(ka,"response-type","gateway.auth.spec/response-type",724325508,null),ap=new z(null,"context-id","context-id",1979873501),bp=new z(null,"trailing-white-space","trailing-white-space",1496006996),cp=new z(null,"destroy-peer","destroy-peer",-1747489061),dp=new w(null,"address-type","address-type",-1732576165,null),ep=new w(null,"keyword?","keyword?",1917797069,null),fp=new z(null,"arg-filter-fn","arg-filter-fn",1576945932),gp=new z($a,"signature-key","gateway.state.spec.state/signature-key",1283598087),hp=new z(bb,"end-index","instaparse.gll/end-index",-1851404441),ip=new z(null,"agm-domain","agm-domain",1137239322),jp=new z(null,"instance","instance",-2121349050),kp=new z(null,"right-params","right-params",-1790676237),lp=new z(null,"activity_types","activity_types",-1792673047),mp=new z(Xa,"flags","gateway.state.spec.mthds/flags",408816343),Am=new w(null,"let*","let*",1920721458,null),op=new w(null,"config","config",-1659574354,null),pp=new z(null,"option","option",65132272),qp=new z($a,"id","gateway.state.spec.state/id",2050905551),rp=new z(La,"lifetime","gateway.domains.global.spec.requests/lifetime",-1145821948),sp=new w(null,"when-first","when-first",821699168,null),tp=new z(null,"ns-blacklist","ns-blacklist",1957763142),up=new z(null,"result_signature","result_signature",-1204398780),vp=new z(null,"input_signature","input_signature",158735218),wp=new z($a,"state","gateway.state.spec.state/state",-1032276972),yp=new w(null,"k->s","k->s",-1685112801,null),zp=new w(null,"g","g",-916345864,null),Ap=new w(null,"f","f",43394975,null),Bp=new z(Ua,"id","gateway.state.spec.context/id",1782620593),Cp=new z(null,"allowed","allowed",1436019743),U=new z(null,"type","type",1174270348),Dp=new z(null,"types-added","types-added",1274011029),Ep=new z(null,"none","none",1333468478),Fp=new z(null,"peer-id","peer-id",387144350),Gp=new w(null,"_","_",-1201019570,null),Hp=new w(aa,"seq","cljs.core/seq",-1649497689,null),Ip=new z(null,"reader-error","reader-error",1610253121),Jp=new w(null,"v","v",1661996586,null),Kp=new w(null,"m","m",-1021758608,null),Lp=new w(null,"k","k",-505765866,null),Mp=new z(null,"optional","optional",2053951509),Np=new w(null,"opt-specs","opt-specs",1255626077,null),aF=new w(null,"p1__9613#","p1__9613#",-1973599680,null),Op=new w(null,"cpred","cpred",-540353554,null),Pp=new w(null,"re","re",1869207729,null),qG=new w(null,"map__11463","map__11463",842169409,null),Qp=new w(aa,"keyword?","cljs.core/keyword?",713156450,null),Rp=new w(null,"max-columns","max-columns",-912112507,null),OG=new w(null,"map__12316","map__12316",431203874,null),Sp=new z(ra,"context-destroy","gateway.common.context.spec.requests/context-destroy",-2019226956),Tp=new z(Ua,"updates","gateway.state.spec.context/updates",-1191134395),Up=new z(Ka,"updater_id","gateway.domains.global.spec.messages/updater_id",-1794190419),Vp=new z(null,"creator_id","creator_id",1398967087),Wp=new z(ta,"request","gateway.common.spec.messages/request",712202569),Xp=new w(aa,"keyword","cljs.core/keyword",-337316415,null),Yp=new z(null,"node","node",581201198),Zp=new z(La,"leave","gateway.domains.global.spec.requests/leave",101292368),$p=new z(null,"token","token",-1211463215),aq=new z("instaparse","failure","instaparse/failure",1422918607),bq=new z(Ra,"subscription","gateway.state.spec.agm/subscription",1556334291),cq=new z(null,"high","high",2027297808),dq=new z(ka,"remote_identity","gateway.auth.spec/remote_identity",-1701598746),eq=new z(null,"plus","plus",211540661),fq=new z(Va,"domain","gateway.state.spec.domain-registry/domain",-1376202493),gq=new w(aa,"number?","cljs.core/number?",-811857295,null),hq=new w(da,"coll-of","cljs.spec.alpha/coll-of",1019430407,null),iq=new z(null,"auth","auth",1389754926),jq=new z(Da,"call","gateway.domains.agm.spec.requests/call",442214083),kq=new z(null,"arguments","arguments",-1182834456),lq=new z(null,"colinc","colinc",-584873385),mq=new z(null,"auto","auto",-566279492),nq=new z(null,"logical-block","logical-block",-581022564),oq=new z(null,"node-builder","node-builder",-1956562605),pq=new z(Ta,"endpoint","gateway.state.spec.common/endpoint",-2063041997),qq=new z(Ka,"reason","gateway.domains.global.spec.messages/reason",-1756219178),rq=new z(null,"your-version","your-version",-351781765),sq=new z(null,"col","col",-1959363084),tq=new z(null,"domain","domain",1847214937),uq=new z(null,"?ns-str","?ns-str",2012733966),vq=new z(null,"reset","reset",-800929946),wq=new z(null,"current","current",-1088038603),xq=new z(null,"writing","writing",-1486865108),yq=new z(Sa,"topic-repattern","gateway.state.spec.bus/topic-repattern",736554526),zq=new z(Ta,"peer-id","gateway.state.spec.common/peer-id",-1398853323),Aq=new z(null,"suppress-namespaces","suppress-namespaces",2130686956),Bq=new z(Da,"unsubscribe","gateway.domains.agm.spec.requests/unsubscribe",-1898794870),Cq=new z(Da,"server_id","gateway.domains.agm.spec.requests/server_id",172340651),Dq=new z(null,"parent","parent",-878878779),Eq=new z(Qa,"visibility","gateway.state.spec.activity/visibility",-1264422156),Fq=new w(da,"conform","cljs.spec.alpha/conform",763100824,null),Gq=new z(null,"bus-domain","bus-domain",1136396472),Hq=new w(aa,"map?","cljs.core/map?",-1390345523,null),HH=new w(null,"meta11901","meta11901",-854950149,null),nm=new w(null,"&","&",-2144855648,null),Iq=new z(null,"HTAB","HTAB",11392612),Jq=new z(null,"snapshot","snapshot",-1274785710),Kq=new z(null,"right-bracket","right-bracket",951856080),Lq=new z(null,"req-id","req-id",-471642231),Mq=new z(Qa,"context-id","gateway.state.spec.activity/context-id",341891962),Nq=new z(Wa,"factory","gateway.state.spec.factory/factory",1055781172),Oq=new z(null,"req-in","req-in",960021885),Qq=new z(null,"current-id","current-id",210783650),Rq=new z(null,"ttl","ttl",-1115275118),Sq=new z(Qa,"owner_type","gateway.state.spec.activity/owner_type",-1823895667),Tq=new z(Qa,"initiator","gateway.state.spec.activity/initiator",735796495),em=new z(null,"default","default",-1987822328),Uq=new z(null,"secs","secs",1532330091),Vq=new z(Ra,"interest","gateway.state.spec.agm/interest",1248511583),Wq=new z(null,"initial_context","initial_context",-797433349),Xq=new w("clojure.core","deref","clojure.core/deref",188719157,null),Yq=new w(null,"miser-width","miser-width",330482090,null),Zq=new z(null,"system","system",-29381724),$q=new z(null,"partial","partial",241141745),ar=new z(Da,"publish","gateway.domains.agm.spec.requests/publish",-1020033829),br=new z(ka,"login","gateway.auth.spec/login",532129350),cr=new z(ra,"context-update","gateway.common.context.spec.requests/context-update",562123698),dr=new z(Ra,"call","gateway.state.spec.agm/call",399063183),er=new z(null,"handler-ch","handler-ch",2044105199),fr=new z(null,"reader-exception","reader-exception",-1938323098),gr=new w(da,"tuple","cljs.spec.alpha/tuple",-415901908,null),hr=new z(Da,"context","gateway.domains.agm.spec.requests/context",-1915055426),ir=new z(null,"req-un","req-un",1074571008),jr=new z(null,"forms","forms",2045992350),kr=new z(null,"cur","cur",1153190599),lr=new z(Xa,"result_signature","gateway.state.spec.mthds/result_signature",-1987803736),mr=new z(Qa,"ready-members","gateway.state.spec.activity/ready-members",-939559218),nr=new z(null,"filters","filters",974726919),Km=new w(null,"def","def",597100991,null),or=new z(La,"context-update","gateway.domains.global.spec.requests/context-update",-1728804708),Nl=new z(null,"keywordize-keys","keywordize-keys",1310784252),pr=new z(null,"pos","pos",-864607220),qr=new z(null,"initiated","initiated",2096076574),rr=new z(da,"v","cljs.spec.alpha/v",552625740),sr=new z(null,"message","message",-406056002),tr=new z(Qa,"types","gateway.state.spec.activity/types",-2083568052),ur=new z(da,"k","cljs.spec.alpha/k",-1602615178),vr=new z(null,"output-fn","output-fn",1600951539),wr=new z("mem","del","mem/del",574870667),xr=new z(null,"total","total",1916810418),zr=new z(null,"domains","domains",1410387719),Ar=new z(null,"CR","CR",-1654295403),Br=new z(Ta,"source","gateway.state.spec.common/source",1883706108),Cr=new z(null,"typ","typ",-1304536900),Dr=new z(null,"form","form",-1624062471),V=new w(null,"%","%",-950237169,null),Er=new z(null,"pretty-writer","pretty-writer",-1222834267),Fr=new w(null,"..","..",-300507420,null),Gr=new z(null,"accepted","accepted",-1953464374),Hr=new z(null,"removed","removed",609626430),Ir=new w(ta,"message-body","gateway.common.spec.messages/message-body",-1647648637,null),Jr=new z(null,"pretty","pretty",-1916372486),Kr=new z(null,"summary","summary",380847952),Lr=new z(null,"peer-requested","peer-requested",1452118887),Mr=new z(null,"application","application",551185447),Nr=new z(da,"invalid","cljs.spec.alpha/invalid",-1220295119),Or=new z(da,"pcat","cljs.spec.alpha/pcat",26406623),Pr=new z(ra,"read_permissions","gateway.common.context.spec.requests/read_permissions",-45173714),Qr=new z(null,"caller","caller",-1275362879),Rr=new z(Wa,"id","gateway.state.spec.factory/id",-395012522),Sr=new z(null,"LWSP","LWSP",782998598),Tr=new z(null,"activity","activity",-1179221455),Ur=new z(null,"dec-val","dec-val",-1263870894),Vr=new z(null,"activity-types","activity-types",-397260556),Wr=new z(Qa,"configuration","gateway.state.spec.activity/configuration",1853083827),Xr=new z(null,"arguments_kv","arguments_kv",739148125),Yr=new z(null,"callee","callee",-156445786),Zr=new z(null,"activity_id","activity_id",-240070853),$r=new z(Ya,"activity","gateway.state.spec.pending-requests/activity",1935677687),as=new w(null,"read-string*","read-string*",1046768315,null),bs=new w(null,"unc","unc",-465250751,null),cs=new z($a,"identities","gateway.state.spec.state/identities",-204237049),ds=new z(null,"join","join",-758861890),es=new w(null,"uuid","uuid",-504564192,null),fs=new z(null,"participants","participants",673603367),gs=new z(null,"full-results","full-results",-1500225407),hs=new z(null,"own-ident","own-ident",1422237852),is=new z(null,"request_id","request_id",-208950594),js=new w(null,"queue","queue",-1198599890,null),ks=new z(null,"else","else",-1508377146),om=new w(null,"case*","case*",-1938255072,null),ls=new z(null,"hide","hide",-596913169),ms=new w(null,ka,ka,1721169563,null),ns=new z(null,"params","params",710516235),os=new z(null,"restrictions","restrictions",1874752994),LH=new w(null,"p1__13236#","p1__13236#",790017356,null),ps=new z(ra,"join","gateway.common.context.spec.requests/join",94453629),qs=new z(La,"context-destroy","gateway.domains.global.spec.requests/context-destroy",1322892186),rs=new z(ta,"broadcast","gateway.common.spec.messages/broadcast",-1460237246),kI=new w(null,"meta13318","meta13318",1225772791,null),ss=new w(null,"struct-map","struct-map",-1387540878,null),ts=new z(null,"rest","rest",-1241696419),us=new z(null,"commachar","commachar",652859327),vs=new z(null,"activities","activities",1654844313),ws=new z(Ta,"channel","gateway.state.spec.common/channel",426185507),xs=new z(null,"error-level?","error-level?",778415885),ys=new z(La,"reset","gateway.domains.global.spec.requests/reset",-116815601),zs=new z(null,"begin-test-ns","begin-test-ns",-1701237033),As=new z(null,"msg-cache","msg-cache",-733775070),Bs=new z(Da,"post","gateway.domains.agm.spec.requests/post",-1221170496),wl=new z(null,"val","val",128701612),Cs=new w(aa,"zipmap","cljs.core/zipmap",-1902130674,null),Ds=new z(null,"buffer-size","buffer-size",1047120420),Es=new z(Ra,"server","gateway.state.spec.agm/server",1918098797),Fs=new z(null,"local","local",-1497766724),Gs=new z(null,"login","login",55217519),Hs=new z(null,"add-peer-factories","add-peer-factories",-1612194889),Is=new z(null,"stream_id","stream_id",-871396659),Im=new w(null,"catch","catch",-1616370245,null),Js=new w(null,"describe-form","describe-form",-1410156588,null),Ks=new z(Ya,"gateway-requests","gateway.state.spec.pending-requests/gateway-requests",-1212651271),Ls=new z(da,"kvs->map","cljs.spec.alpha/kvs->map",579713455),Ns=new z(Ya,"id","gateway.state.spec.pending-requests/id",-199997554),Os=new z(null,"kind","kind",-717265803),Ps=new z(null,"Epsilon","Epsilon",133418452),Qs=new z(Xa,"methods","gateway.state.spec.mthds/methods",-868139122),Rs=new z(null,"endpoint","endpoint",447890044),Ss=new z(Sa,"subscriptions","gateway.state.spec.bus/subscriptions",359149340),Ts=new z(null,"method","method",55703592),Us=new z(null,"reloading","reloading",961158984),Vs=new w(null,"cnt","cnt",1924510325,null),Ws=new w(null,"opt-keys","opt-keys",-1391747508,null),Xs=new z(ka,"user","gateway.auth.spec/user",803364081),Ys=new z(null,"write_permissions","write_permissions",-2075461534),Zs=new z(null,"years","years",-1298579689),MJ=new w(null,"meta12453","meta12453",-1196160356,null),$s=new z(da,"accept","cljs.spec.alpha/accept",370988198),hK=new z(null,"commands","commands",161008658),at=new z(Ca,"methods","gateway.domains.agm.spec.register/methods",-209946928),bt=new z(null,"services","services",970478783),ct=new z(null,"context-domain","context-domain",-563887528),dt=new z(null,"user","user",1532431356),et=new z(null,"hostname_","hostname_",-2091647379),ft=new w(aa,"vec","cljs.core/vec",307622519,null),gt=new w(aa,"concat","cljs.core/concat",-1133584918,null),ht=new z(Qa,"context_id","gateway.state.spec.activity/context_id",1100878008),it=new z(null,"features","features",-1146962336),jt=new z(null,"?msg-fmt","?msg-fmt",-852453891),kt=new z(null,"sections","sections",-886710106),lt=new z(null,"lines","lines",-700165781),um=new w(null,"do","do",1686842252,null),mt=new z(null,"colon","colon",-965200945),nt=new z(null,"unregister","unregister",2105339971),ot=new z(null,"keys-pred","keys-pred",858984739),pt=new w(null,"cpred?","cpred?",35589515,null),qt=new z(null,"testing-vars","testing-vars",-2114769150),rt=new z(null,"max-age","max-age",-270129271),tt=new z(null,"minpad","minpad",323570901),ut=new z(null,"remove-interest","remove-interest",-1017752998),vt=new w(null,Fa,Fa,-340272132,null),wt=new w(da,"keys","cljs.spec.alpha/keys",1109346032,null),xt=new z(null,"hide-nt","hide-nt",-228813845),yt=new z(qa,"context_id","gateway.common.context.spec.messages/context_id",745790948),zt=new z(null,"formatter","formatter",-483008823),At=new z(null,"skip-validation","skip-validation",-195677600),Bt=new z(null,"measurements","measurements",82224007),Ct=new z(null,"rulename","rulename",948914160),Dt=new z(null,"context_id","context_id",1618636315),Et=new z(null,"regexp","regexp",-541372782),Ft=new z(Qa,"helper_types","gateway.state.spec.activity/helper_types",-920321960),Gt=new z(null,"unhide","unhide",-413983695),qm=new w(null,"try","try",-1273693247,null),Ht=new z(null,"location","location",1815599388),It=new w(fa,"read-string*","cljs.tools.reader/read-string*",1492661621,null),Jt=new w(null,"ch","ch",1085813622,null),Kt=new w(null,"cb","cb",-2064487928,null),Lt=new w(null,"specs","specs",-1227865028,null),Mt=new z(null,"composite","composite",-257118970),Nt=new z(ta,"peer_id","gateway.common.spec.messages/peer_id",-1253667286),Ot=new z($a,"user-name","gateway.state.spec.state/user-name",-1129365610),Pt=new z(null,"raw","raw",1604651272),Qt=new w(null,"let","let",358118826,null),Kc=new z(null,"flush-on-newline","flush-on-newline",-151457939),Rt=new z($a,"creation-request","gateway.state.spec.state/creation-request",473028997),St=new z(Da,"add-interest","gateway.domains.agm.spec.requests/add-interest",1660124918),Tt=new z(null,"destroy-context","destroy-context",-1305625710),Ut=new z(La,"destination","gateway.domains.global.spec.requests/destination",165081940),Wt=new z(null,"pred-exprs","pred-exprs",1792271395),Xt=new w(null,"id","id",252129435,null),wm=new w(null,"if","if",1181717262,null),Yt=new z(null,"concatenation","concatenation",-951369614),Zt=new z(null,"timestamp","timestamp",579478971),$t=new z(Ra,"invocation","gateway.state.spec.agm/invocation",-928333769),au=new z($a,"contexts","gateway.state.spec.state/contexts",-1321025323),bu=new z(null,"leave","leave",1022579443),cu=new z(null,"min-count","min-count",1594709013),du=new z(null,"context-created","context-created",-436520594),eu=new z(null,"messages","messages",345434482),fu=new z(ra,"context-unsubscribe","gateway.common.context.spec.requests/context-unsubscribe",46104946),lK=new w(null,"meta11517","meta11517",-200391237,null),Hm=new w(null,"quote","quote",1377916282,null),gu=new w(null,"gen-into","gen-into",592640985,null),hu=new w(null,"gw","gw",1384842711,null),iu=new z(La,"context-subscribe","gateway.domains.global.spec.requests/context-subscribe",614257563),iK=new z(null,"remove","remove",-131428414),ju=new z(La,"join","gateway.domains.global.spec.requests/join",-837980557),ku=new z(null,"hierarchy","hierarchy",-1053470341),lu=new z(null,"left_id","left_id",730267975),mu=new z(null,"trace","trace",-1082747415),nu=new z("rl","reset","rl/reset",-800926172),ou=new w(null,"fn","fn",465265323,null),pu=new z(null,"context-compatibility-mode?","context-compatibility-mode?",564867301),qu=new z(null,"invocation_id","invocation_id",1947784937),ru=new z(null,"strable","strable",1877668047),su=new z(null,"remote_identity","remote_identity",1864550587),tu=new z(Ya,"type","gateway.state.spec.pending-requests/type",-1681171358),uu=new w("s","keys","s/keys",-1586011188,null),vu=new z(null,"identities","identities",-2100677764),wu=new z(Qa,"children","gateway.state.spec.activity/children",651398237),xu=new z(null,"symbol","symbol",-1038572696),yu=new z(null,"iss","iss",1130086696),zu=new w(null,"fields","fields",-291534703,null),Au=new z(null,"char-range","char-range",1443391389),Bu=new z(null,"parsed-restrictions","parsed-restrictions",-1665101931),Cu=new w(null,"lift-ns","lift-ns",602311926,null),Du=new z(null,"leave-activity","leave-activity",-484899731),Eu=new z(null,"middleware","middleware",1462115504),Fu=new z(Ya,"gateway_token","gateway.state.spec.pending-requests/gateway_token",-1747123785),Gu=new z(null,"access_token","access_token",1591156073),Hu=new z(null,"red","red",-969428204),jK=new z(null,"value","value",305978217),Iu=new z($a,"no-user","gateway.state.spec.state/no-user",-565346809),Ju=new z(null,"enabled?","enabled?",-1376075057),Ku=new z(null,"rep","rep",-1226820564),ym=new w(null,"ns","ns",2082130287,null),Lu=new z(null,"req","req",-326448303),Mu=new z(null,"ret","ret",-468222814),Nu=new z(null,"subscribe","subscribe",416253756),Ou=new w(null,"partial","partial",1881673272,null),Pu=new z(null,"create-context","create-context",-1362772644),Qu=new z(null,"both","both",-393648840),Ru=new z(null,"result","result",1415092211),Su=new w(null,"keys-pred","keys-pred",-1795451030,null),wK=new w(null,"meta11984","meta11984",1741232023,null),Tu=new z(null,"server_id","server_id",-518165566),FO=new z(null,"keep","keep",-2133338530),Uu=new z(null,"vector","vector",1902966158),Vu=new z(null,"peer_name","peer_name",-245526270),Wu=new z(null,"end","end",-268185958),Xu=new z(null,"buffer-blob","buffer-blob",-1830112173),Yu=new z(Da,"accepted","gateway.domains.agm.spec.requests/accepted",1383451047),Zu=new w("clojure.core","unquote","clojure.core/unquote",843087510,null),$u=new z(null,"alt-or-ord","alt-or-ord",310249425),av=new z(Ta,"address","gateway.state.spec.common/address",394563279),bv=new w(null,"lb","lb",950310490,null),cv=new z(null,"create","create",-1301499256),dv=new z(Qa,"user","gateway.state.spec.activity/user",-93065379),ev=new z(Da,"result","gateway.domains.agm.spec.requests/result",1027857196),fv=new z(null,"flags","flags",1775418075),gv=new z(null,"eof","eof",-489063237),hv=new z(Xa,"description","gateway.state.spec.mthds/description",-129583756),iv=new w(null,"js","js",-886355190,null),jv=new z(null,"relative-to","relative-to",-470100051),kv=new w(null,"doseq","doseq",221164135,null),nv=new z(Ba,"new_peer_id","gateway.domains.agm.spec.messages/new_peer_id",-2026004018),ov=new z(null,"source_type","source_type",-144028049),pv=new z(null,"CHAR","CHAR",-1280338086),qv=new w(aa,"list?","cljs.core/list?",-684796618,null),rv=new z(ta,"outgoing-message","gateway.common.spec.messages/outgoing-message",1952031218),sv=new z(null,"joined_id","joined_id",35485948),tv=new z(ta,"response","gateway.common.spec.messages/response",69665082),uv=new z(Ka,"resolved_identity","gateway.domains.global.spec.messages/resolved_identity",-685850501),wv=new z(null,"parser","parser",-1543495310),xv=new w(da,"merge","cljs.spec.alpha/merge",1420080689,null),yv=new z(Qa,"name","gateway.state.spec.activity/name",113237718),zv=new z(Ba,"reason","gateway.domains.agm.spec.messages/reason",-1483891292),Av=new z(null,"users","users",-713552705),Bv=new z(null,"welcome","welcome",-578152123),Cv=new z(null,"char-val","char-val",1408617933),Dv=new z(null,"doc","doc",1913296891),Ev=new z(null,"dump","dump",-356261477),Fv=new z(null,"expr","expr",745722291),Gv=new z(Qa,"activity-peer","gateway.state.spec.activity/activity-peer",-1499406427),Hv=new z(null,"origin","origin",1037372088),Iv=new z(null,"remove-peer-factories","remove-peer-factories",-316522514),Jv=new z(null,"lookahead","lookahead",-400102393),Kv=new z(ab,"token-data","gateway.state.spec.tokens/token-data",-481150767),Lv=new z(null,"hash_","hash_",-827203612),Mv=new z(va,"restrictions","gateway.common.spec.requests/restrictions",-1264539352),Nv=new z(null,"comment","comment",532206069),Ov=new z(null,"add-types","add-types",-711550002),Pv=new z(null,"?file","?file",1533429675),Qv=new z(null,"added","added",2057651688),Rv=new z(null,"segment","segment",-964921196),Sv=new w(null,"gfn","gfn",-1862918295,null),Tv=new z(null,"map","map",1371690461),Uv=new z(null,"display_name","display_name",-1494335013),Vv=new z(null,"rulename-left","rulename-left",-1824251564),Wv=new z(null,"remote-identity","remote-identity",1289489893),Xv=new z(null,"body","body",-2049205669),Yv=new z(bb,"start-index","instaparse.gll/start-index",404653620),Zv=new z(null,"cluster","cluster",535175621),$v=new z(null,"uri","uri",-774711847),aw=new z(null,"mode","mode",654403691),bw=new z(null,"max","max",61366548),cw=new z(Wa,"configuration","gateway.state.spec.factory/configuration",154272470),dw=new z($a,"peers","gateway.state.spec.state/peers",75810773),ew=new z(null,"token-ttl","token-ttl",-103977687),fw=new z(null,"register","register",1968522516),gw=new z(null,"count","count",2139924085),hw=new z(null,"clauses","clauses",1454841241),iw=new z(null,"miser-width","miser-width",-1310049437),jw=new w(null,"binding","binding",-2114503176,null),kw=new z(null,"hide-tag-rule","hide-tag-rule",150267589),lw=new w(null,"kps","kps",-1157342767,null),mw=new z(null,"call","call",-519999866),nw=new z($a,"ids","gateway.state.spec.state/ids",259664151),ow=new z(null,"peer_id","peer_id",1920005364),pw=new z(null,"next-stack","next-stack",-481930728),qw=new w(null,"tag","tag",350170304,null),rw=new z(null,"available","available",-1470697127),sw=new z(null,"splice","splice",449588165),tw=new z(null,"dispatch","dispatch",1319337009),uw=new w(null,"inst","inst",-2008473268,null),vw=new z(Da,"invoke","gateway.domains.agm.spec.requests/invoke",1837084336),ww=new z(qa,"reason","gateway.common.context.spec.messages/reason",-795974116),xw=new z(null,"?meta","?meta",-793560773),yw=new z(null,"name","name",1843675177),zw=new z(null,"VCHAR","VCHAR",1962437706),Aw=new z(null,"peer-created","peer-created",-1509421151),Bw=new w(null,"loop","loop",1244978678,null),Cw=new z(null,"appender","appender",1267426510),Dw=new z(Ya,"gateway-request","gateway.state.spec.pending-requests/gateway-request",796467142),Ew=new z(null,"parameter-from-args","parameter-from-args",-758446196),Fw=new z(null,"end-test-ns","end-test-ns",1620675645),Gw=new w(aa,"pos?","cljs.core/pos?",-652182749,null),Hw=new z(null,"destroyed","destroyed",-427566535),Iw=new z(null,"properties","properties",685819552),Jw=new z(null,"hide-tag","hide-tag",1347642501),Kw=new z(null,"whitelist-ns","whitelist-ns",868974100),Lw=new z($a,"node-id","gateway.state.spec.state/node-id",-982277841),Mw=new z(null,"ownership","ownership",892314581),Nw=new z(null,"CTL","CTL",-9995632),Ow=new z(null,"section","section",-300141526),Pw=new z(null,"bracket-info","bracket-info",-1600092774),Qw=new z(null,"subscribe-context","subscribe-context",1009129400),Rw=new w(null,"Inf","Inf",647172781,null),Sw=new z(null,"validation","validation",-2141396518),Tw=new w(aa,"map","cljs.core/map",-338988913,null),Nc=new z(null,"dup","dup",556298533),Uw=new z(null,"subscription-cancelled","subscription-cancelled",1868207049),Vw=new z(Ka,"available_domains","gateway.domains.global.spec.messages/available_domains",-1472037229),Ww=new z(da,"rep","cljs.spec.alpha/rep",1483217317),Xw=new z(null,"invocations","invocations",-1981777494),Yw=new z(null,"suffix","suffix",367373057),Zw=new z(null,"methods","methods",453930866),$w=new w(null,"defn-","defn-",1097765044,null),ax=new z(null,"required","required",1807647006),bx=new z(null,"unsubscribe-context","unsubscribe-context",-1695207834),cx=new z(null,"buffer","buffer",617295198),dx=new z(null,"inherit","inherit",-1840815422),ex=new z(null,"factory_ids","factory_ids",1173653523),fx=new z(null,"msg_","msg_",-1925147e3),gx=new z(null,"peer_factory","peer_factory",1685625260),hx=new z(null,"opt-keys","opt-keys",1262688261),ix=new w(null,"when-not","when-not",-1223136340,null),jx=new w(null,Ta,Ta,27478502,null),kx=new w(null,"reader","reader",1810192380,null),lx=new z(null,"end-test-all-vars","end-test-all-vars",548827253),mx=new z(xa,"operation-result","gateway.domain/operation-result",-1509018323),nx=new w(null,"opts","opts",1795607228,null),ox=new z(null,"post","post",269697687),px=new z(null,"iat","iat",-353315170),qx=new z(null,"min","min",444991522),rx=new z(null,"types_override","types_override",391099757),sx=new w(aa,"sequence","cljs.core/sequence",1908459032,null),tx=new z(La,"added","gateway.domains.global.spec.requests/added",-1820753011),ux=new z(null,"column","column",2078222095),vx=new z(va,"join","gateway.common.spec.requests/join",-1713603460),wx=new z(ra,"delta","gateway.common.context.spec.requests/delta",-694068490),xx=new w(null,"drop-interest-rq","drop-interest-rq",-842860790,null),yx=new z(null,"up-arrow","up-arrow",1705310333),zx=new w(aa,"with-meta","cljs.core/with-meta",749126446,null),Ax=new z(null,"logical-block-callback","logical-block-callback",1612691194),Bx=new w(aa,"nil?","cljs.core/nil?",945071861,null),Cx=new z(Fa,"drop-interest","gateway.domains.agm.subscriptions/drop-interest",-1584375112),Dx=new z(null,"weeks","weeks",1844596125),Ex=new z(Ua,"owner","gateway.state.spec.context/owner",-1445790718),Fx=new z(null,"regex","regex",939488856),Gx=new z(null,"read-cond","read-cond",1056899244),Hx=new z(null,"mincol","mincol",1230695445),Ix=new z("promesa.core","default","promesa.core/default",1773193826),Jx=new z(null,"end-run-tests","end-run-tests",267300563),Kx=new z(null,"visibility","visibility",1338380893),Lx=new z(null,"deref","deref",-145586795),Mx=new z(null,"ids","ids",-998535796),Nx=new z(da,"unknown","cljs.spec.alpha/unknown",651034818),Ox=new z(null,"yield","yield",177875009),Px=new z(null,"max-iterations","max-iterations",2021275563),Qx=new z(null,"output_","output_",-36797880),Rx=new z(null,"hex-char","hex-char",764443568),Sx=new z(null,"report-counters","report-counters",-1702609242),Tx=new z(null,"joined","joined",-231861661),Ux=new z(null,"inside-comment","inside-comment",1258069708),Vx=new z(null,"runtime-exception","runtime-exception",-1495664514),Wx=new z(Ta,"identity","gateway.state.spec.common/identity",-343306948),Xx=new z(Ba,"oob","gateway.domains.agm.spec.messages/oob",-285361976),Yx=new z(null,"config","config",994861415),Zx=new z(null,"joined_name","joined_name",-1159730335),$x=new z(null,"whitespace","whitespace",-1340035483),ay=new z(Va,"info","gateway.state.spec.domain-registry/info",754617108),by=new z(null,"activity-domain","activity-domain",1896268503),cy=new z(null,"machine","machine",-1389886154),zm=new w(null,"deftype*","deftype*",962659890,null),dy=new z(null,"rep+","rep+",-281382396),ey=new z(ka,"message","gateway.auth.spec/message",212934373),fy=new w(null,"pred-exprs","pred-exprs",-862164374,null),gy=new z(Ra,"interests","gateway.state.spec.agm/interests",1622331889),hy=new w(null,"spec","spec",1988051928,null),iy=new w(null,"NaN","NaN",666918153,null),jy=new z(null,"unsupported-operation","unsupported-operation",1890540953),ky=new z(null,"msecs","msecs",1711980553),ly=new z(null,"subscribed-context","subscribed-context",-451582146),my=new z(null,"authenticator","authenticator",728866366),ny=new z(null,"reduction-type","reduction-type",-488293450),oy=new w(null,"defmacro","defmacro",2054157304,null),py=new z(Ra,"callee","gateway.state.spec.agm/callee",1100257697),qy=new z(null,"subscriptions","subscriptions",1250949776),ry=new z(Ra,"caller","gateway.state.spec.agm/caller",-1898628116),sy=new z(da,"conform-all","cljs.spec.alpha/conform-all",45201917),ty=new z(null,"whitelist","whitelist",-979294437),uy=new w(aa,"hash-map","cljs.core/hash-map",303385767,null),vy=new z(Ra,"invocation_id","gateway.state.spec.agm/invocation_id",-822050570),wy=new z(ta,"outgoing-messages","gateway.common.spec.messages/outgoing-messages",-924999491),xy=new z(null,"full-listeners","full-listeners",50621827),yy=new z(null,"owner?","owner?",-839891990),zy=new z($a,"peer","gateway.state.spec.state/peer",-2119577277),Ay=new z(null,"nt","nt",-835425781),By=new z(null,"ns","ns",441598760),Cy=new z(null,"expected","expected",1583670997),Dy=new z(Da,"invocation_id","gateway.domains.agm.spec.requests/invocation_id",-621605438),Ey=new z(Sa,"routing-key","gateway.state.spec.bus/routing-key",554216520),sS=new w(null,"meta11255","meta11255",-111844645,null),Fy=new z(null,"receiver","receiver",1768630781),Gy=new z(Ua,"contexts","gateway.state.spec.context/contexts",-1052863269),Hy=new w(null,aa,aa,770546058,null),Iy=new z(La,"read_permissions","gateway.domains.global.spec.requests/read_permissions",75711320),Jy=new z(Qa,"parent","gateway.state.spec.activity/parent",-359694046),Ky=new z(null,"joined_type","joined_type",973647374),Ly=new z(null,"p2","p2",905500641),pm=new w(null,"defrecord*","defrecord*",-1936366207,null),My=new z(null,"p1","p1",-936759954),Ny=new z(null,"type-tag","type-tag",-1873863267),Oy=new z(null,"ms","ms",-1152709733),Py=new z(null,"middleware-fn","middleware-fn",-61585752),tS=new w(null,"meta12119","meta12119",1659150026,null),Qy=new z(null,"no-user","no-user",793713538),Ry=new z(null,"readers","readers",-2118263030),Sy=new z(Qa,"owner","gateway.state.spec.activity/owner",-1983556102),Ty=new z(null,"DIGIT","DIGIT",341251338),Uy=new w(null,"string?","string?",-1129175764,null),Vy=new z(null,"defined-as","defined-as",-474679152),Wy=new z(null,"comma","comma",1699024745),Xy=new z(Ua,"name","gateway.state.spec.context/name",-1494107954),Yy=new z(Ya,"client-request","gateway.state.spec.pending-requests/client-request",1663875818),Zy=new z(null,"lo","lo",-931799889),$y=new z(null,"node-id","node-id",779482292),vT=new w(null,"meta13894","meta13894",-1452766245,null),az=new z(ea,"pprint","cljs.test/pprint",1627393641),bz=new z(null,"requestor_id","requestor_id",-1253857801),cz=new w(null,"keys->specnames","keys->specnames",1791294693,null),dz=new w(null,"conform-keys","conform-keys",-159510287,null),ez=new z(La,"hello","gateway.domains.global.spec.requests/hello",-398737422),fz=new z(null,"end-line","end-line",1837326455),gz=new z(null,"read_permissions","read_permissions",766082539),Cm=new w(null,"fn*","fn*",-752876845,null),hz=new z(null,"ks","ks",1900203942),iz=new z(null,"start-production","start-production",687546537),jz=new z(null,"allow","allow",-1857325745),kz=new z(Ka,"remote-identity","gateway.domains.global.spec.messages/remote-identity",1498525882),lz=new z(null,"source","source",-433931539),mz=new w("s","coll-of","s/coll-of",-1705285349,null),nz=new z(null,"memory","memory",-1449401430),W=new w(aa,"fn","cljs.core/fn",-1065745098,null),oz=new z(null,"circle","circle",1903212362),pz=new z(null,"registered-domains","registered-domains",-559729182),qz=new z(null,"success","success",1890645906),Sl=new z(null,"descendants","descendants",1824886031),rz=new z(null,"report","report",1394055010),sz=new z(null,"start","start",-355208981),tz=new z(null,"ns-whitelist","ns-whitelist",-1717299774),uz=new z(Da,"yield","gateway.domains.agm.spec.requests/yield",1398099968),vz=new z(null,"repos","repos",647483789),wz=new z(null,"num-val","num-val",1497434478),xz=new z(Da,"flags","gateway.domains.agm.spec.requests/flags",989202486),yz=new z(null,"recur","recur",-437573268),zz=new z(null,"caller_id","caller_id",5404558),Az=new z(Sa,"topic","gateway.state.spec.bus/topic",-1241703207),Bz=new z(null,"alternation","alternation",-1162147630),Cz=new z(ra,"lifetime","gateway.common.context.spec.requests/lifetime",-228133926),Dz=new z(null,"subscriber","subscriber",-2064338413),Ez=new z(null,"length","length",588987862),Fz=new z(null,"appender-id","appender-id",-1917983538),Gz=new z(null,"subscribed","subscribed",1012088257),Hz=new w(null,"with-open","with-open",172119667,null),Iz=new z(null,"ps","ps",292358046),Jz=new z(null,"not-delivered","not-delivered",1599158697),Kz=new w(null,"if-not","if-not",-265415609,null),Lz=new z(null,"blacklist","blacklist",1248093170),Nz=new z("gateway.common.commands","source-removed","gateway.common.commands/source-removed",701959101),Oz=new z(Da,"method_id","gateway.domains.agm.spec.requests/method_id",926663112),Pz=new z(Ba,"reason_uri","gateway.domains.agm.spec.messages/reason_uri",577151711),Qz=new z(ab,"impersonate-peer","gateway.state.spec.tokens/impersonate-peer",1018065912),Rz=new z(null,"default_context","default_context",-1148569539),Sz=new z(null,"state","state",-1988618099),Tz=new w(aa,"unquote","cljs.core/unquote",1013085760,null),Uz=new z(Va,"uri","gateway.state.spec.domain-registry/uri",301088755),Vz=new z(null,"os","os",795021913),Wz=new z(null,"or","or",235744169),Xz=new z(null,"end-test-vars","end-test-vars",-1394419713),Yz=new z(null,"join-activity","join-activity",1683531460),Zz=new z(null,"lifetime","lifetime",-1568939561),$z=new z(Aa,"peer-methods","gateway.domains.agm.core/peer-methods",639951360),aA=new w(null,"dotimes","dotimes",-818708397,null),bA=new z(null,"raw-console?","raw-console?",-2061489061),cA=new z(null,"conform-keys","conform-keys",-1800041814),sm=new w(null,"finally","finally",-1065347064,null),dA=new w(null,"/","/",-1371932971,null),eA=new z(null,"buffering","buffering",-876713613),fA=new z(null,"subscription_id","subscription_id",1241304848),gA=new z(null,"illegal-argument","illegal-argument",-1845493170),hA=new z("mem","all","mem/all",892075139),iA=new z(null,"opt-un","opt-un",883442496),jA=new z(null,"calls","calls",-433802344),kA=new z(null,"rule","rule",729973257),wT=new w(null,"meta13849","meta13849",-270052681,null),lA=new z(null,"nodes","nodes",-2099585805),mA=new z(null,"owner_id","owner_id",1001956033),nA=new z(null,"values","values",372645556),oA=new z(null,"owner","owner",-392611939),pA=new w(null,"locking","locking",1542862874,null),qA=new z(null,"look","look",-539441433),rA=new w(null,"kfn","kfn",729311001,null),sA=new z(null,"opt-whitespace","opt-whitespace",1115207927),tA=new w(null,"cform","cform",1319506748,null),uA=new z(null,"negative-lookahead","negative-lookahead",874382387),vA=new w(null,"kind-form","kind-form",1155997457,null),wA=new z(null,"seq","seq",-1817803783),xA=new z(null,"ident","ident",-742346),yA=new z(null,"set","set",304602554),xT=new w(null,"meta13824","meta13824",34801754,null),zA=new z(null,"epsilon","epsilon",-730158570),AA=new z(Qa,"type","gateway.state.spec.activity/type",-462200009),BA=new z(null,"updated","updated",-1627192056),CA=new w(null,"some?","some?",234752293,null),DA=new z(null,"expecting","expecting",-57706705),EA=new z(null,"rule-separator","rule-separator",1539322213),FA=new z(null,"enlive","enlive",1679023921),GA=new z(Va,"domain-uri","gateway.state.spec.domain-registry/domain-uri",636341057),HA=new z(null,"updates","updates",2013983452),IA=new z(null,"error","error",-978969032),JA=new z(Ta,"peer_id","gateway.state.spec.common/peer_id",1217199451),KA=new w(null,"set?","set?",1636014792,null),LA=new z(null,"base","base",185279322),MA=new z(null,"actual","actual",107306363),NA=new z(Qa,"participants","gateway.state.spec.activity/participants",-1995832242),OA=new z(null,"event","event",301435442),vm=new w(null,"letfn*","letfn*",-110097810,null),PA=new w(null,"opt","opt",845825158,null),QA=new z(null,"scavenger","scavenger",107984617),RA=new z(Ra,"subscriptions","gateway.state.spec.agm/subscriptions",359122069),SA=new z(null,"prefix","prefix",-265908465),TA=new z(null,"methods-removed","methods-removed",-724408194),VA=new z(null,"start-pos","start-pos",668789086),WA=new z(null,"method-filter-fn","method-filter-fn",-283131748),XA=new w(Ta,"address-type","gateway.state.spec.common/address-type",-283204142,null),Il=new z(null,"keyword-fn","keyword-fn",-64566675),YA=new z(null,"first","first",-644103046),ZA=new w(null,"last-was-whitespace?","last-was-whitespace?",-1073928093,null),$A=new w(aa,"partial","cljs.core/partial",1483172485,null),aB=new z(null,"bin-char","bin-char",-1662780697),bB=new z(ta,"local","gateway.common.spec.messages/local",1736687122),cB=new z(null,"ebnf","ebnf",31967825),dB=new z(null,"new_peer_id","new_peer_id",1380469887),eB=new z(null,"?err","?err",549653299),fB=new z(null,"fail","fail",1706214930),gB=new z(ka,"access_token","gateway.auth.spec/access_token",-1170576318),hB=new z(null,"preserve","preserve",1276846509),iB=new z(La,"authentication","gateway.domains.global.spec.requests/authentication",2133771245),jB=new z(null,"repo-id","repo-id",-402847325),kB=new z(Xa,"no-methods","gateway.state.spec.mthds/no-methods",658181793),Dm=new w(null,"recur","recur",1202958259,null),lB=new z(Qa,"activity","gateway.state.spec.activity/activity",449324238),GO=new z(ra,"command","gateway.common.context.spec.requests/command",-1702281587),mB=new z(ab,"lifetime","gateway.state.spec.tokens/lifetime",887565809),nB=new z(Ua,"read_permissions","gateway.state.spec.context/read_permissions",-559958390),oB=new z(null,"illegal-state","illegal-state",-1519851182),pB=new z(da,"op","cljs.spec.alpha/op",-1269055252),qB=new z(Da,"methods","gateway.domains.agm.spec.requests/methods",-366393681),rB=new z($a,"services","gateway.state.spec.state/services",-925305284),sB=new z(Ka,"reason_uri","gateway.domains.global.spec.messages/reason_uri",1393708653),tB=new z(null,"async?","async?",1523057758),uB=new z(Xa,"name","gateway.state.spec.mthds/name",393834509),vB=new z(null,"rulelist","rulelist",-1871218473),wB=new w(null,"count","count",-514511684,null),xB=new z(null,"no-stacktrace?","no-stacktrace?",1701072694),yB=new z(Va,"version","gateway.state.spec.domain-registry/version",-650577592),zB=new z(ra,"restrictions","gateway.common.context.spec.requests/restrictions",-1766361),AB=new z(null,"hex-val","hex-val",1267737401),BB=new z(null,"create-peer","create-peer",631977540),CB=new w(null,ta,ta,-1797487288,null),DB=new z(Qa,"activity-subscribers","gateway.state.spec.activity/activity-subscribers",-1579465715),EB=new z(null,"publisher-identity","publisher-identity",1716891391),FB=new w(null,fa,fa,-831293977,null),GB=new z(Qa,"ready?","gateway.state.spec.activity/ready?",-1768127396),HB=new z(null,"fail-index","fail-index",248726923),IB=new z(null,"nbf","nbf",-1785694926),JB=new z(ra,"context-create","gateway.common.context.spec.requests/context-create",-947794767),KB=new z(null,"intra-block-nl","intra-block-nl",1808826875),LB=new z(null,"target_id","target_id",-124012080),MB=new z(null,"gen-max","gen-max",-793680445),Mc=new z(null,"meta","meta",1499536964),NB=new w(null,"addcv","addcv",-1552991247,null),OB=new z(null,"drop-subscription","drop-subscription",-1853238873),PB=new z(null,"context-updated","context-updated",744419706),QB=new z(null,"right","right",-452581833),RB=new z(Qa,"context","gateway.state.spec.activity/context",798551178),SB=new z(null,"err","err",-2089457205),TB=new w(null,"when","when",1064114221,null),UB=new z(Da,"arguments_kv","gateway.domains.agm.spec.requests/arguments_kv",-220182488),VB=new w(aa,"set?","cljs.core/set?",-1176684971,null),WB=new z(null,"context_snapshot","context_snapshot",-703318056),XB=new z(null,"logical-blocks","logical-blocks",-1466339776),YB=new z(null,"authentication","authentication",1746273042),ZB=new w(da,"or","cljs.spec.alpha/or",-831679639,null),$B=new z(null,"fatal","fatal",1874419888),aC=new z(null,"gateway-requests","gateway-requests",2114123587),bC=new w(aa,"list","cljs.core/list",-1331406371,null),cC=new z(ra,"added","gateway.common.context.spec.requests/added",-1410443097),dC=new z(ta,"reason","gateway.common.spec.messages/reason",1129095963),eC=new z(null,"rate-limit","rate-limit",1748082022),fC=new w("clojure.walk","keywordize-keys","clojure.walk/keywordize-keys",-1055520580,null),gC=new z(null,"created_id","created_id",-1653142250),hC=new z(null,"repetition","repetition",1938392115),jC=new w(null,"min-count","min-count",-1059726756,null),kC=new z(Ka,"context_id","gateway.domains.global.spec.messages/context_id",-1799893258),lC=new z(null,"failure","failure",720415879),mC=new z(ra,"reset","gateway.common.context.spec.requests/reset",6157861),nC=new z(null,"alg","alg",-830920638),oC=new z(Qa,"properties","gateway.state.spec.activity/properties",-914053381),pC=new z(null,"neq","neq",1883246164),qC=new w(null,"any?","any?",-318999933,null),rC=new z(null,"start-col","start-col",668080143),sC=new z(Ba,"local","gateway.domains.agm.spec.messages/local",63355787),tC=new z(null,"neg","neg",1800032960),uC=new z(null,"into","into",-150836029),Em=new w(null,"set!","set!",250714521,null),vC=new w(null,"response-type","response-type",146761069,null),wC=new z(null,"target_identity","target_identity",-786887198),xC=new z(null,"alt","alt",-3214426),yC=new z(null,"all","all",892129742),zC=new z(null,"string-ci","string-ci",374631805),AC=new z(Ja,"authenticated","gateway.domains.global.internal/authenticated",-1621463770),BC=new z(null,"instant","instant",655498374),CC=new z(null,"stack","stack",-793405930),DC=new z(null,"hiccup","hiccup",1218876238),EC=new z(ea,"default","cljs.test/default",-1581405322),FC=new z(null,"ex-kind","ex-kind",1581199296),GC=new w(aa,"int?","cljs.core/int?",50730120,null),HC=new z(null,"histo","histo",-821552278),IC=new z(ra,"context-subscribe","gateway.common.context.spec.requests/context-subscribe",-318176635),JC=new z(null,"amp","amp",271690571),KC=new z(Da,"subscribe","gateway.domains.agm.spec.requests/subscribe",1050374291),LC=new z(null,"and","and",-971899817),MC=new w(null,"preds","preds",150921777,null),NC=new z(da,"cpred","cljs.spec.alpha/cpred",-693471218),OC=new w(null,"predx","predx",2063470948,null),PC=new z(null,"authentication-request","authentication-request",-2091151542),QC=new w(null,"-Inf","-Inf",-2123243689,null),RC=new z(ka,"request","gateway.auth.spec/request",-1915554438),SC=new z(null,"max-connections-per-user","max-connections-per-user",-1995174555),TC=new z(ta,"incoming-message","gateway.common.spec.messages/incoming-message",-528171747),UC=new z(null,"padchar","padchar",2018584530),VC=new z(ab,"gw-request-id","gateway.state.spec.tokens/gw-request-id",146927020),XC=new z(null,"star","star",279424429),YC=new z(null,"children","children",-940561982),ZC=new z(Ua,"version","gateway.state.spec.context/version",-664315203),Oc=new z(null,"print-length","print-length",1931866356),$C=new z(null,"nil","nil",99600501),aD=new z(null,"activity-joined","activity-joined",-1584889318),bD=new z(null,"exp","exp",-261706262),cD=new z($a,"options","gateway.state.spec.state/options",-722288524),dD=new w(aa,"empty?","cljs.core/empty?",1866613644,null),eD=new z(null,"buffer-block","buffer-block",-10937307),fD=new z(null,"remaining","remaining",-138926777),gD=new z(null,"remaining-arg-count","remaining-arg-count",-1216589335),hD=new z(null,"impersonate-peer","impersonate-peer",-1409232482),iD=new z(ta,"new_peer_id","gateway.common.spec.messages/new_peer_id",326805829),jD=new z(null,"methods-added","methods-added",2044022595),kD=new w(da,"and","cljs.spec.alpha/and",-2060279705,null),lD=new z(null,"channel","channel",734187692),mD=new z(Ra,"stream-id","gateway.state.spec.agm/stream-id",-1404324586),nD=new z(null,"bin-val","bin-val",1705209105),oD=new z(Ra,"stream","gateway.state.spec.agm/stream",1961075649),pD=new z(null,"identity","identity",1647396035),HO=new z(ra,"commands","gateway.common.context.spec.requests/commands",1656863185),qD=new z(null,"remove-types","remove-types",-1777229898),rD=new w(null,"retag","retag",528972725,null),sD=new z(null,"info","info",-317069002),tD=new z(null,"members","members",159001018),uD=new z(null,"testing-contexts","testing-contexts",-1485646523),vD=new z(null,"commainterval","commainterval",-1980061083),wD=new z(null,"generation","generation",-2132542044),xD=new z(null,"separator","separator",-1628749125),yD=new w(null,"dval","dval",835211877,null),zD=new z($a,"users","gateway.state.spec.state/users",-2072351172),AD=new z(null,"streams","streams",1465783789),BD=new w(null,"defonce","defonce",-1681484013,null),DD=new z(Qa,"activity-domain","gateway.state.spec.activity/activity-domain",292185460),ED=new z(null,"basic","basic",1043717368),FD=new z(null,"inactive_seconds","inactive_seconds",-1714688448),GD=new z(null,"buffer-level","buffer-level",928864731),HD=new z(Da,"data-message","gateway.domains.agm.spec.requests/data-message",-153411654),ID=new z(null,"dec-char","dec-char",-646625154),JD=new z("rl","all","rl/all",892118056),Al=new z(null,"pending","pending",-220036727),KD=new z(Xa,"input_signature","gateway.state.spec.mthds/input_signature",2082802494),LD=new z(Xa,"method-def","gateway.state.spec.mthds/method-def",858475302),Lc=new z(null,"readably","readably",1129599760),MD=new z(null,"aud","aud",357659490),ND=new z(null,"invoke","invoke",1145927159),OD=new z(null,"file","file",-1269645878),PD=new z(Qa,"default_context","gateway.state.spec.activity/default_context",1517722536),QD=new z(ta,"reason_uri","gateway.common.spec.messages/reason_uri",-14574488),RD=new w("clojure.core","unquote-splicing","clojure.core/unquote-splicing",-552003150,null),SD=new z(null,"fill","fill",883462889),TD=new z(null,"cause","cause",231901252),UD=new z(Ta,"string","gateway.state.spec.common/string",885967163),VD=new z(Qa,"activity-type","gateway.state.spec.activity/activity-type",1221900323),WD=new z(null,"now","now",-1650525531),XD=new z(null,"months","months",-45571637),YD=new z(null,"radix","radix",857016463),ZD=new z(null,"text","text",-1790561697),$D=new w(null,"kind","kind",923265724,null),aE=new z(null,"distinct","distinct",-1788879121),bE=new z(qa,"updater_id","gateway.common.context.spec.messages/updater_id",-850230629),cE=new z(null,"sequence","sequence",926807414),dE=new z(ab,"gateway-token","gateway.state.spec.tokens/gateway-token",1169641187),eE=new z(null,"block","block",664686210),fE=new z(ka,"type","gateway.auth.spec/type",552402611),gE=new z(ra,"write_permissions","gateway.common.context.spec.requests/write_permissions",-194247007),hE=new z(ta,"meta","gateway.common.spec.messages/meta",-2108831238),iE=new z(Ea,"methods","gateway.domains.agm.spec.unregister/methods",1593198071),Tl=new z(null,"ancestors","ancestors",-776045424),jE=new z(null,"listeners","listeners",394544445),kE=new z(null,"clients","clients",1436018090),lE=new w(aa,"array-map","cljs.core/array-map",-1519210683,null),mE=new z(null,"peer-removed","peer-removed",1752359546),nE=new z(null,"metrics-domain","metrics-domain",-1136423917),oE=new z(Ka,"type","gateway.domains.global.spec.messages/type",708595817),pE=new z(null,"min-remaining","min-remaining",962687677),qE=new z(null,"offset","offset",296498311),rE=new z(null,"define","define",-2006590705),sE=new z(null,"content","content",15833224),tE=new z(null,"activity_type","activity_type",-194821832),uE=new z(null,"reason_uri","reason_uri",1062203786),vE=new z(Qa,"activities","gateway.state.spec.activity/activities",1132481734),wE=new w(null,"->","->",-2139605430,null),xE=new z(Xa,"display_name","gateway.state.spec.mthds/display_name",1469788607),yE=new z(null,"timeout","timeout",-318625318),zE=new z(null,"reload","reload",863702807),AE=new z(null,"arglists","arglists",1661989754),BE=new z(Ra,"invocations","gateway.state.spec.agm/invocations",-1391969355),CE=new z(null,"updater_id","updater_id",-2125909548),DE=new z(Ja,"authentication-request","gateway.domains.global.internal/authentication-request",502904463),Bm=new w(null,"js*","js*",-1134233646,null),EE=new z(null,"end-pos","end-pos",-1643883926),FE=new z(null,"min-version","min-version",-1697197126),GE=new z(null,"pred-forms","pred-forms",172611832),HE=new z(null,"hours","hours",58380855),IE=new z(null,"pass","pass",1574159993),JE=new z(La,"updated","gateway.domains.global.spec.requests/updated",-1219870803),KE=new z(null,"context-destroyed","context-destroyed",-1281742589),LE=new z(null,"NUM","NUM",-218662260),ME=new z(null,"LF","LF",1177033158),NE=new z(ta,"domain","gateway.common.spec.messages/domain",755510455),OE=new w(null,"defn","defn",-126010802,null),PE=new w(null,"struct","struct",325972931,null),QE=new z(Ja,"authentication-failed","gateway.domains.global.internal/authentication-failed",1518002013),RE=new z(null,"reporter","reporter",-805360621),SE=new z(null,"peer-added","peer-added",322139575),TE=new z(null,"gfn","gfn",791517474),UE=new w(null,"check?","check?",409539557,null),zT=new w(null,"meta12211","meta12211",-2002153449,null),VE=new z(null,"namespaced-map","namespaced-map",1235665380),WE=new z(Ua,"context","gateway.state.spec.context/context",-1884667246),YE=new z(null,"rulename-right","rulename-right",1125609193),ZE=new z(null,"mins","mins",467369676),X=new z(null,"tag","tag",-1290361223),$E=new z(null,"types","types",590030639),bF=new z(null,"linear","linear",872268697),xm=new w(null,"new","new",-444906321,null),cF=new z(ta,"removed_id","gateway.common.spec.messages/removed_id",-1304577413),dF=new z(null,"number","number",1570378438),eF=new z(Ya,"owner?","gateway.state.spec.pending-requests/owner?",346289860),fF=new z(null,"continue","continue",-207346553),gF=new z(Ra,"stream-peer-info","gateway.state.spec.agm/stream-peer-info",1892226854),hF=new z(Wa,"factories","gateway.state.spec.factory/factories",-1725265010),iF=new z(null,"?line","?line",-631853385),jF=new z(null,"test","test",577538877),kF=new z(null,"owner-changed","owner-changed",-1569176886),lF=new w(null,"=","=",-1501502141,null),mF=new z(null,"topic-repattern","topic-repattern",1187945138),AT=new w(null,"meta11315","meta11315",-2065702453,null),oF=new z(null,"cat","cat",-1457810207),jl=new z(null,"alt-impl","alt-impl",670969595),pF=new z(null,"types-removed","types-removed",-1458332519),qF=new w(null,"pending-forms","pending-forms",-1225172071,null),rF=new z(qa,"reason_uri","gateway.common.context.spec.messages/reason_uri",-1687789209),sF=new z(Ra,"agm-domain","gateway.state.spec.agm/agm-domain",686860067),tF=new z(null,"tags","tags",1771418977),uF=new z(null,"given","given",716253602),JO=new z(null,"path","path",-188191168),vF=new w(null,"with-local-vars","with-local-vars",837642072,null),CD=new w(null,"meta7593","meta7593",1831708302,null),wF=new w(null,"form","form",16469056,null),xF=new w(null,"req-un","req-un",-1579864761,null),zF=new z(Va,"description","gateway.state.spec.domain-registry/description",-350920838),AF=new z(Da,"caller_id","gateway.domains.agm.spec.requests/caller_id",-211861801),BF=new w(null,"req-specs","req-specs",-2100473456,null),CF=new z(La,"context-create","gateway.domains.global.spec.requests/context-create",-1370416261),tT=new z(ra,"path","gateway.common.context.spec.requests/path",614939647),DF=new z(La,"removed","gateway.domains.global.spec.requests/removed",-1641157465),EF=new z(null,"activity-subscribers","activity-subscribers",12051372),FF=new w(null,"req-keys","req-keys",-2140116548,null),Jm=new w(null,"throw","throw",595905694,null),GF=new z(Ta,"request_id","gateway.state.spec.common/request_id",2099278405),HF=new w("s","map-of","s/map-of",-1464752791,null),IF=new z(Da,"data","gateway.domains.agm.spec.requests/data",688691322),JF=new z(null,"opt-specs","opt-specs",-384905450),KF=new w("s","or","s/or",1876282981,null),LF=new z(xa,"leave","gateway.domain/leave",-1366936831),MF=new z(null,"rules","rules",1198912366),eK=new w(null,"meta14812","meta14812",-855915521,null),OF=new w(null,"keys","keys",-1586012071,null),PF=new z(null,"character","character",380652989),QF=new z(da,"kfn","cljs.spec.alpha/kfn",672643897),RF=new z(Ba,"removed_id","gateway.domains.agm.spec.messages/removed_id",-1904544764),tm=new w(null,"loop*","loop*",615029416,null),SF=new w(null,"conform-all","conform-all",-980179459,null),TF=new z(null,"publisher","publisher",-153364540),UF=new z(La,"delta","gateway.domains.global.spec.requests/delta",299143136),VF=new z(null,"last","last",1105735132),WF=new z(null,"initial-context","initial-context",-32910095),XF=new w(aa,"vector?","cljs.core/vector?",-1550392028,null),YF=new w(aa,"lift-ns","cljs.core/lift-ns",463499081,null),ZF=new z(null,"factories","factories",1443149712),$F=new z(null,"k","k",-2146297393),aG=new z(null,"helper_types","helper_types",1747427755),bG=new z(null,"e","e",1381269198),cG=new z(null,"f","f",-1597136552),dG=new z(null,"d","d",1972142424),eG=new z(null,"w","w",354169001),BT=new w(null,"meta11761","meta11761",830711190,null),fG=new z(null,"p","p",151049309),gG=new z(Ra,"request_id","gateway.state.spec.agm/request_id",-1401687879),hG=new z(null,"n","n",562130025),iG=new z(null,"func","func",-238706040),jG=new w(aa,"contains?","cljs.core/contains?",-976526835,null),kG=new z(ta,"message-type","gateway.common.spec.messages/message-type",929650450),lG=new z(null,"SP","SP",124290284),mG=new z(null,"indent-t","indent-t",528318969),nG=new z(null,"char","char",-641587586),oG=new z(null,"optimize","optimize",-1912349448),pG=new z(Da,"sequence","gateway.domains.agm.spec.requests/sequence",1051925549),rG=new z($a,"activity-types","gateway.state.spec.state/activity-types",1532142687),kl=new z(null,"fallback-impl","fallback-impl",-1501286995),CT=new w(null,"meta13926","meta13926",-962679467,null),tG=new w(null,"writer","writer",1362963291,null),uG=new w(aa,"apply","cljs.core/apply",1757277831,null),vG=new z(Ca,"register","gateway.domains.agm.spec.register/register",-572048018),wG=new z(null,"publish","publish",-1178026850),xG=new w(null,"cfns","cfns",1335482066,null),yG=new w(null,"gen-max","gen-max",846851082,null),zG=new z(null,"ready-members","ready-members",757058983),AG=new z(null,"debug","debug",-1608172596),BG=new z(null,"dispose-peer","dispose-peer",68303444),CG=new z(null,"req-specs","req-specs",553962313),DG=new w(null,"distinct","distinct",-148347594,null),EG=new w(null,"capped","capped",-1650988402,null),FG=new z(null,"allows-separator","allows-separator",-818967742),GG=new z(Ba,"source_type","gateway.domains.agm.spec.messages/source_type",276727970),HG=new z(null,"appenders","appenders",1245583998),IG=new w("clojure.core","list","clojure.core/list",-1119203325,null),JG=new z(Da,"subscription_id","gateway.domains.agm.spec.requests/subscription_id",1666574151),KG=new z(null,"group","group",582596132),LG=new z(null,"colon-up-arrow","colon-up-arrow",244853007),MG=new z("rl","peek","rl/peek",-291391771),NG=new z(null,"negative-listeners","negative-listeners",55241092),PG=new z(null,"gateway_token","gateway_token",1638490713),QG=new z(null,"enabled","enabled",1195909756),RG=new z(Xa,"id","gateway.state.spec.mthds/id",2078923376),VG=new z(null,"BIT","BIT",-1854474115),WG=new z(null,"request-id","request-id",-985684093),XG=new z(null,"WSP","WSP",-1046948716),YG=new w(da,"conformer","cljs.spec.alpha/conformer",2140085535,null),ZG=new z(Sa,"bus-domain","gateway.state.spec.bus/bus-domain",1755593660),DT=new w(null,"meta16172","meta16172",-171069597,null),$G=new z(Ra,"method_id","gateway.state.spec.agm/method_id",1007252604),al=new z(null,"more-marker","more-marker",-14717935),aH=new w(null,"mmvar","mmvar",-1714325675,null),bH=new z($a,"current-id","gateway.state.spec.state/current-id",798109991),cH=new w(null,"val","val",1769233139,null),dH=new z(null,"creation-request","creation-request",1261647120),eH=new z(Ya,"gw-request-id","gateway.state.spec.pending-requests/gw-request-id",-996681140),fH=new z(null,"nl-t","nl-t",-1608382114),Gm=new w(null,"var","var",870848730,null),gH=new z(null,"qualifier","qualifier",125841738),zl=new z(null,"ready","ready",1086465795),hH=new z(null,"unsubscribe","unsubscribe",632650147),iH=new z(null,"leeway","leeway",-355669977),dU=new w(null,"p1__13235#","p1__13235#",-1120814410,null),jH=new w(aa,"boolean?","cljs.core/boolean?",1400713761,null),kH=new z(da,"gfn","cljs.spec.alpha/gfn",-593120375),lH=new z(null,"non-matched","non-matched",-624651186),mH=new z(null,"add-interest","add-interest",-1148631141),nH=new z(Za,"restrictions","gateway.state.spec.restrictions/restrictions",181113171),oH=new w(null,"cond","cond",1606708055,null),pH=new w(aa,"=","cljs.core/=",-1891498332,null),qH=new z(qa,"creator_id","gateway.common.context.spec.messages/creator_id",2137586424),rH=new z(null,"element","element",1974019749),sH=new z(null,"char-format","char-format",-1016499218),tH=new z(null,"match","match",1220059550),uH=new z(null,"owner_type","owner_type",846064882),vH=new z(null,"max-columns","max-columns",1742323262),wH=new z(ka,"response","gateway.auth.spec/response",1690727657),xH=new z(xa,"join","gateway.domain/join",1465372684),yH=new w(null,"when-let","when-let",-1383043480,null),zH=new z(null,"routing_key","routing_key",1236069137),AH=new z(null,"gw-request-id","gw-request-id",2114687330),BH=new z(null,"hello","hello",-245025397),CH=new z(null,"publishers","publishers",1474752298),DH=new z(null,"index","index",-1531685915),EH=new z(Wa,"peer_type","gateway.state.spec.factory/peer_type",-885367633),FH=new z(null,"peer-factories-added","peer-factories-added",-2010470480),GH=new z(null,"subscriber_id","subscriber_id",972810975),Fm=new w(null,".",".",1975675962,null),IH=new z(null,"at","at",1476951349),JH=new z(null,"started?","started?",-1301062863),KH=new z(null,"peer_type","peer_type",371163309),MH=new z(null,"routing-key","routing-key",238118868),NH=new z(da,"describe","cljs.spec.alpha/describe",1883026911),OH=new z(null,"CRLF","CRLF",11418756),PH=new z(null,"configuration","configuration",1431842520),QH=new z(null,"vargs","vargs",-966597273),RH=new z(null,"full","full",436801220),SH=new z(null,"output-format","output-format",-1826382676),TH=new z(null,"queue","queue",1455835879),UH=new z(null,"stacktrace-fonts","stacktrace-fonts",830799382),VH=new z(null,"warn","warn",-436710552),WH=new w(null,"pred-forms","pred-forms",1813143359,null),XH=new z(Xa,"peer-methods","gateway.state.spec.mthds/peer-methods",-639609469),YH=new z(Da,"arguments","gateway.domains.agm.spec.requests/arguments",-1906298417),ZH=new z(null,"selector","selector",762528866),$H=new z(null,"sqn","sqn",2076851999),aI=new z(null,"retained","retained",630238157),bI=new z(null,"created","created",-704993748),cI=new z(null,"miser","miser",-556060186),dI=new z("mem","fresh","mem/fresh",-1179989133),eI=new z(null,"options","options",99638489),fI=new z(null,"context","context",-830191113),gI=new z(null,"paren","paren",-294107600),hI=new z(null,"gw-request","gw-request",1009584674),iI=new z(null,"colnum","colnum",2023796854),jI=new z(null,"standard","standard",-1769206695),uT=new z(ra,"value","gateway.common.context.spec.requests/value",1114622378),lI=new w(aa,"some?","cljs.core/some?",-440439360,null),mI=new z(null,"provider","provider",-302056900),nI=new z(null,"DQUOTE","DQUOTE",-571169808),oI=new w(aa,"hash-set","cljs.core/hash-set",1130426749,null),pI=new z(null,"timestamp_","timestamp_",-954533417),qI=new z(null,"fn","fn",-1175266204),rI=new z(null,"args","args",1315556576),sI=new z(Qa,"child","gateway.state.spec.activity/child",-942548506),tI=new z(Ua,"write_permissions","gateway.state.spec.context/write_permissions",1195182789),uI=new z(null,"environment","environment",-666037640),HK=new w(null,"meta15331","meta15331",-458586899,null),vI=new w(da,"map-of","cljs.spec.alpha/map-of",153715093,null),wI=new z(null,"peer-factories-removed","peer-factories-removed",-1429529592),xI=new z(null,"eq","eq",-618539067),yI=new z(null,"str","str",1089608819),zI=new z(null,"console","console",1228072057),AI=new z(null,"hash","hash",-13781596),BI=new w(aa,"any?","cljs.core/any?",-2068111842,null),CI=new z(null,"rules-or-parser","rules-or-parser",-314380386),DI=new z(ra,"removed","gateway.common.context.spec.requests/removed",-732316803),EI=new z(Ra,"subscription-id","gateway.state.spec.agm/subscription-id",-1920105558),FI=new z(null,"arg3","arg3",-1486822496),GI=new z(null,"min-level","min-level",1634684919),HI=new z(null,"arg1","arg1",951899358),II=new z(null,"arg2","arg2",1729550917),JI=new z(null,"list","list",765357683),KI=new z(ka,"authentication","gateway.auth.spec/authentication",-2005184469),LI=new z(Ua,"data","gateway.state.spec.context/data",790358174),MI=new z(null,"method_id","method_id",1349548671),NI=new z(null,"key","key",-1516042587),OI=new z($a,"handler-ch","gateway.state.spec.state/handler-ch",-891933338),PI=new z(null,"generator-fn","generator-fn",811851656),QI=new z(null,"req-keys","req-keys",514319221),RI=new z(null,"destroy","destroy",-843660405),SI=new z(null,"overflowchar","overflowchar",-1620088106),TI=new z(null,"splicing?","splicing?",-428596366),UI=new z(null,"oob","oob",707302005),Rl=new z(null,"parents","parents",-2027538891),VI=new z(null,"js","js",1768080579),WI=new z(null,"peer","peer",1319662792),eU=new w(null,"meta12266","meta12266",-345451167,null),XI=new z(Sa,"subscription","gateway.state.spec.bus/subscription",1556343370),YI=new z(ta,"body","gateway.common.spec.messages/body",-1028765771),ZI=new w(null,"if-let","if-let",1803593690,null),$I=new w(null,"req","req",1314083224,null),aJ=new z(Ra,"streams","gateway.state.spec.agm/streams",-460960790),bJ=new w(null,"condp","condp",1054325175,null),cJ=new z(null,"ping","ping",-1670114784),dJ=new z(null,"limits","limits",-2101003399),eJ=new z(null,"member","member",-2012020816),fJ=new z(Wa,"flags","gateway.state.spec.factory/flags",-1898127651),gJ=new z(null,"subscription","subscription",1949009182),hJ=new w(null,"blockable","blockable",-28395259,null),iJ=new z(null,"NOT","NOT",-1689245341),jJ=new z(null,"opt","opt",-794706369),kJ=new z(null,"reason","reason",-2070751759),lJ=new z(null,"service","service",-1963054559),mJ=new z(null,"sym","sym",-1444860305),nJ=new w(Fa,"drop-interest-rq","gateway.domains.agm.subscriptions/drop-interest-rq",1736302176,null),oJ=new z(La,"context-unsubscribe","gateway.domains.global.spec.requests/context-unsubscribe",-602451908),pJ=new z(null,"update-context","update-context",1410241659),qJ=new z(null,"id","id",-1388402092),rJ=new z(ra,"context_id","gateway.common.context.spec.requests/context_id",1348419676),sJ=new z(null,"stream","stream",1534941648),tJ=new z(null,"end-test-var","end-test-var",984198545),uJ=new z(null,"results","results",-1134170113),vJ=new z(null,"input-format","input-format",-422703481),wJ=new z(Da,"drop-subscription","gateway.domains.agm.spec.requests/drop-subscription",938907886),xJ=new z(null,"indent","indent",-148200125),yJ=new z(null,"hi","hi",-1821422114),zJ=new z(null,"HEXDIG","HEXDIG",-200221072),AJ=new z(null,"ord","ord",1142548323),BJ=new z(null,"OCTET","OCTET",-743420682),CJ=new w(da,"nilable","cljs.spec.alpha/nilable",1628308748,null),DJ=new z(ta,"receiver","gateway.common.spec.messages/receiver",679023931),EJ=new z(null,"removed_id","removed_id",1940625745),FJ=new z(null,"keyword","keyword",811389747),GJ=new z(Ta,"keyword","gateway.state.spec.common/keyword",-1409778786),HJ=new z(null,"else-params","else-params",-832171646),fU=new w(null,"meta13105","meta13105",1244327015,null),IJ=new z(Za,"parsed-restrictions","gateway.state.spec.restrictions/parsed-restrictions",1374812996),JJ=new z(null,"end-block-t","end-block-t",1544648735),KJ=new z(null,"max-count","max-count",1539185305),LJ={},gU,NJ={};function OJ(n,e){var t=PK;if(null!=n&&null!=n.Je)n=n.Je(n,e,t);else{var r=OJ[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=OJ._))throw Zc("WritePort.put!",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function PJ(n){if(null!=n&&null!=n.Ed)n=n.Ed(n);else{var e=PJ[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=PJ._))throw Zc("Channel.close!",n);n=e.a?e.a(n):e.call(null,n)}}return n}function QJ(n){if(null!=n&&null!=n.sf)n=!0;else{var e=QJ[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=QJ._))throw Zc("Handler.active?",n);n=e.a?e.a(n):e.call(null,n)}}return n}function RJ(n){if(null!=n&&null!=n.tf)n=n.La;else{var e=RJ[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=RJ._))throw Zc("Handler.commit",n);n=e.a?e.a(n):e.call(null,n)}}return n}function SJ(n,e){if(null!=n&&null!=n.ae)n=n.ae(n,e);else{var t=SJ[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=SJ._))throw Zc("Buffer.add!*",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}var TJ=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function UJ(n,e,t,r,i){for(var o=0;o<i;)t[r+o]=n[e+o],o+=1}function VJ(n){this.length=this.ta=this.head=0,this.l=n}function MK(n,e){n.length+1===n.l.length&&n.resize(),n.unshift(e)}function NK(n,e){for(var t=n.length,r=0;r<t;){var i=n.pop();(e.a?e.a(i):e.call(null,i))&&n.unshift(i),r+=1}}function WJ(n){return new VJ(Array(n))}function XJ(n,e){this.ca=n,this.n=e,this.h=2,this.I=0}function YJ(n,e){this.ca=n,this.n=e,this.h=2,this.I=0}function ZJ(){return oc("iPhone")&&!oc("iPod")&&!oc("iPad")}TJ.a=function(n){return n},TJ.b=function(n,e){return SJ(n,e)},TJ.F=2,VJ.prototype.pop=function(){if(0===this.length)return null;var n=this.l[this.ta];return this.l[this.ta]=null,this.ta=(this.ta+1)%this.l.length,--this.length,n},VJ.prototype.unshift=function(n){return this.l[this.head]=n,this.head=(this.head+1)%this.l.length,this.length+=1,null},VJ.prototype.resize=function(){var n=Array(2*this.l.length);return this.ta<this.head?(UJ(this.l,this.ta,n,0,this.length),this.ta=0,this.head=this.length,this.l=n):this.ta>this.head?(UJ(this.l,this.ta,n,0,this.l.length-this.ta),UJ(this.l,0,n,this.l.length-this.ta,this.head),this.ta=0,this.head=this.length,this.l=n):this.ta===this.head?(this.head=this.ta=0,this.l=n):null},XJ.prototype.Dd=function(){return this.ca.length>=this.n},XJ.prototype.ae=function(n,e){return MK(this.ca,e),this},XJ.prototype.X=function(){return this.ca.length},YJ.prototype.Dd=function(){return!1},YJ.prototype.ae=function(n,e){return this.ca.length!==this.n&&this.ca.unshift(e),this},YJ.prototype.X=function(){return this.ca.length};var $J=oc("Opera"),aK=oc("Trident")||oc("MSIE"),bK=oc("Edge"),cK=oc("Gecko")&&!(gc("WebKit")&&!oc("Edge"))&&!(oc("Trident")||oc("MSIE"))&&!oc("Edge"),dK=gc("WebKit")&&!oc("Edge");dK&&oc("Mobile"),oc("Macintosh"),oc("Windows"),oc("Linux")||oc("CrOS");var IO=cb.navigator||null,gK;function fK(){var n=cb.document;return n?n.documentMode:void 0}IO&&(IO.appVersion||"").indexOf("X11"),oc("Android"),ZJ(),oc("iPad"),oc("iPod"),ZJ()||oc("iPad")||oc("iPod"),gc("KaiOS"),gc("GAFP");n:{var OQ="",pS=function(){var n=hc;return cK?/rv:([^\);]+)(\)|;)/.exec(n):bK?/Edge\/([\d\.]+)/.exec(n):aK?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):dK?/WebKit\/(\S+)/.exec(n):$J?/(?:Version)[ \/]?(\S+)/.exec(n):void 0}();if(pS&&(OQ=pS?pS[1]:""),aK){var qS=fK();if(null!=qS&&qS>parseFloat(OQ)){gK=String(qS);break n}}gK=OQ}var wb={},rS,nK;function kK(n){return vb(n,(function(){for(var e=0,t=fc(String(gK)).split("."),r=fc(String(n)).split("."),i=Math.max(t.length,r.length),o=0;0==e&&o<i;o++){var l=t[o]||"",u=r[o]||"";do{if(l=/(\d*)(\D*)(.*)/.exec(l)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==l[0].length&&0==u[0].length)break;e=ic(e=0==l[1].length?0:parseInt(l[1],10),0==u[1].length?0:parseInt(u[1],10))||ic(0==l[2].length,0==u[2].length)||ic(l[2],u[2]),l=l[3],u=u[3]}while(0==e)}return 0<=e}))}function mK(n){var e=document;return n=String(n),"application/xhtml+xml"===e.contentType&&(n=n.toLowerCase()),e.createElement(n)}function oK(){var n=cb.MessageChannel;if(void 0===n&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!oc("Presto")&&(n=function(){var n=mK(fo);n.style.display="none",vc(n),document.documentElement.appendChild(n);var e=n.contentWindow;(n=e.document).open(),n.write(tc()),n.close();var t="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;n=nb((function(n){"*"!=r&&n.origin!=r||n.data!=t||this.port1.onmessage()}),this),e.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(t,r)}}}),void 0!==n&&!oc("Trident")&&!oc("MSIE")){var e=new n,t={},r=t;return e.port1.onmessage=function(){if(void 0!==t.next){var n=(t=t.next).Wd;t.Wd=null,n()}},function(n){r.next={Wd:n},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in mK(yr)?function(n){var e=mK(yr);e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,n(),n=null},document.documentElement.appendChild(e)}:function(n){cb.setTimeout(n,0)}}rS=cb.document&&aK?fK():void 0,!cK&&!aK||aK&&9<=Number(rS)||cK&&kK("1.9.1"),aK&&kK("9");var pK=WJ(32),qK=!1,rK=!1;function sK(){qK=!0,rK=!1;for(var n=0;;){var e=pK.pop();if(!(null!=e&&(e.o?e.o():e.call(null),1024>n)))break;n+=1}return qK=!1,0<pK.length?tK.o?tK.o():tK.call(null):null}function tK(){if(rK&&qK)return null;rK=!0,!fb(cb.setImmediate)||cb.Window&&cb.Window.prototype&&!oc("Edge")&&cb.Window.prototype.setImmediate==cb.setImmediate?(nK||(nK=oK()),nK(sK)):cb.setImmediate(sK)}function uK(n){MK(pK,n),tK()}var vK={},hU;function xK(n){return void 0!==Ac&&void 0!==Bc&&void 0!==LJ&&void 0!==NJ&&void 0!==vK&&void 0!==hU||((hU=function(n,e){this.m=n,this.Ng=e,this.h=425984,this.I=0}).prototype.O=function(n,e){return new hU(this.m,e)},hU.prototype.N=function(){return this.Ng},hU.prototype.zb=function(){return this.m},hU.Pa=function(){return new Q(null,2,5,R,[cH,AT],null)},hU.Ia=!0,hU.Da="cljs.core.async.impl.channels/t_cljs$core$async$impl$channels11314",hU.Ja=function(n){return ce(n,"cljs.core.async.impl.channels/t_cljs$core$async$impl$channels11314")}),new hU(n,S)}function yK(n,e){this.Id=n,this.m=e}function zK(n){return QJ(n.Id)}function AK(n,e,t,r){this.ud=n,this.ee=0,this.Kc=e,this.de=0,this.ca=t,this.closed=!1,this.Lb=r}function BK(n){for(;;){var e=n.Kc.pop();if(null!=e){var t=e.Id;uK(function(n){return function(){return n.a?n.a(!0):n.call(null,!0)}}(t.La,e.m))}break}NK(n.Kc,Hh(!1)),n.Ed(null)}function CK(n,e){if(null!=n.ca&&0<F(n.ca)){if(p(e=e.La)){var t=n.ca.ca.pop(),r=Tc(n.ca.Dd())&&0<n.Kc.length?function(){for(var e=I;;){var t=n.Kc.pop(),r=t.m;if(e=p(t=t.Id.La)?Cf.b(e,t):e,!(Tc(r=p(t)?cf(n.Lb.b?n.Lb.b(n.ca,r):n.Lb.call(null,n.ca,r)):null)&&Tc(n.ca.Dd())&&0<n.Kc.length))return new Q(null,2,5,R,[r,e],null)}}():null,i=J(r,0,null),o=J(r,1,null);p(i)&&BK(n);for(var l=B(o),u=null,s=0,a=0;;)if(a<s){var c=u.W(null,a);uK(function(n,e,t,r,i){return function(){return i.a?i.a(!0):i.call(null,!0)}}(0,0,0,0,c)),a+=1}else{var d=B(l);if(!d)break;Wf(c=d)?(l=re(c),a=se(c),u=l,s=F(l),l=a):(uK(function(n,e,t,r,i){return function(){return i.a?i.a(!0):i.call(null,!0)}}(0,0,0,0,C(c))),l=D(c),u=null,s=0),a=0}return xK(t)}return null}if(t=function(){for(;;){var e=n.Kc.pop();if(!p(e))return null;if(QJ(e.Id))return e}}(),p(t)){var h=RJ(t.Id);return uK((function(){return h.a?h.a(!0):h.call(null,!0)})),xK(t.m)}return p(n.closed)?(p(n.ca)&&(n.Lb.a?n.Lb.a(n.ca):n.Lb.call(null,n.ca)),p(!p(!0)||e.La)?(e=p(f=n.ca)?0<F(n.ca):f,xK(t=p(e)?n.ca.ca.pop():null)):null):(64<n.ee?(n.ee=0,NK(n.ud,QJ)):n.ee+=1,p(e.Ie())&&MK(n.ud,e),null);var f}function DK(n){return console.log(n),null}function EK(n,e){var t=p(null)?null:DK;return null==(e=t.a?t.a(e):t.call(null,e))?n:TJ.b(n,e)}function FK(n){return new AK(WJ(32),WJ(32),n,(e=p(null)?null.a?null.a(TJ):null.call(null,TJ):TJ,function(){function n(n,t){try{return e.b?e.b(n,t):e.call(null,n,t)}catch(e){return EK(n,e)}}function t(n){try{return e.a?e.a(n):e.call(null,n)}catch(e){return EK(n,e)}}var r;return(r=function(e,r){switch(arguments.length){case 1:return t.call(this,e);case 2:return n.call(this,e,r)}throw Error("Invalid arity: "+arguments.length)}).a=t,r.b=n,r}()));var e}AK.prototype.Je=function(n,e,t){var r,i=this,o=i.closed;if(o)return xK(!o);if(p(p(r=i.ca)?Tc(i.ca.Dd()):r)){var l=cf(i.Lb.b?i.Lb.b(i.ca,e):i.Lb.call(null,i.ca,e));if(t=function(){for(var n=I;;){if(!(0<i.ud.length&&0<F(i.ca)))return n;var e=i.ud.pop().La,t=i.ca.ca.pop();n=Cf.b(n,function(n,e,t){return function(){return e.a?e.a(t):e.call(null,t)}}(0,e,t))}}(),l&&BK(this),B(t)){t=B(t),n=null;for(var u=0,s=0;;)if(s<u){uK(n.W(null,s)),s+=1}else{if(!(t=B(t)))break;Wf(n=t)?(t=re(n),s=se(n),n=t,u=F(t),t=s):(uK(t=C(n)),t=D(n),n=null,u=0),s=0}}return xK(!0)}if(n=function(){for(;;){var n=i.ud.pop();if(!p(n))return null;if(p(!0))return n}}(),p(n)){var a=n.La;return uK((function(){return a.a?a.a(e):a.call(null,e)})),xK(!0)}return 64<i.de?(i.de=0,NK(i.Kc,zK)):i.de+=1,p(t.Ie())&&MK(i.Kc,new yK(t,e)),null},AK.prototype.Ed=function(){var n,e=this;if(!e.closed)for(e.closed=!0,p((n=void 0,p(n=e.ca)?0===e.Kc.length:n))&&(e.Lb.a?e.Lb.a(e.ca):e.Lb.call(null,e.ca));;){var t=e.ud.pop();if(null==t)break;uK(function(n,e){return function(){return n.a?n.a(e):n.call(null,e)}}(t.La,p(function(){var n=e.ca;return p(n)?0<F(e.ca):n}())?e.ca.ca.pop():null))}return null};var GK={},iU;function IK(n){return void 0!==Ac&&void 0!==Bc&&void 0!==LJ&&void 0!==NJ&&void 0!==GK&&void 0!==iU||((iU=function(n,e){this.La=n,this.sg=e,this.h=393216,this.I=0}).prototype.O=function(n,e){return new iU(this.La,e)},iU.prototype.N=function(){return this.sg},iU.prototype.sf=function(){return!0},iU.prototype.Ie=function(){return!0},iU.prototype.tf=function(){return this.La},iU.Pa=function(){return new Q(null,2,5,R,[Ap,NF],null)},iU.Ia=!0,iU.Da="cljs.core.async.impl.ioc-helpers/t_cljs$core$async$impl$ioc_helpers10587",iU.Ja=function(n){return ce(n,"cljs.core.async.impl.ioc-helpers/t_cljs$core$async$impl$ioc_helpers10587")}),new iU(n,S)}function JK(n){try{var e=n[0];return e.a?e.a(n):e.call(null,n)}catch(t){if(t instanceof Object)throw e=t,n[6].Ed(null),e;throw t}}function KK(n,e){return p(e=CK(e,IK((function(e){return n[2]=e,n[1]=4,JK(n)}))))?(n[2]=t(e),n[1]=4,yz):null}function LK(n,e){return n=n[6],null!=e&&n.Je(null,e,IK((function(){return null}))),n.Ed(null),n}function OK(n){return FK("number"==typeof(n=A.b(n,0)?null:n)?new XJ(WJ(n),n):n)}var PK=(void 0!==Ac&&void 0!==Bc&&void 0!==LJ&&void 0!==gU||((gU=function(n,e,t){this.La=n,this.kf=e,this.eh=t,this.h=393216,this.I=0}).prototype.O=function(n,e){return new gU(this.La,this.kf,e)},gU.prototype.N=function(){return this.eh},gU.prototype.sf=function(){return!0},gU.prototype.Ie=function(){return this.kf},gU.prototype.tf=function(){return this.La},gU.Pa=function(){return new Q(null,3,5,R,[Ap,hJ,DT],null)},gU.Ia=!0,gU.Da="cljs.core.async/t_cljs$core$async16171",gU.Ja=function(n){return ce(n,"cljs.core.async/t_cljs$core$async16171")}),new gU((function(){return null}),!0,S));function QK(n,e){return!p(n=OJ(n,e))||t(n)}function RK(n,e){var r=I,i=OK(1);return uK((function(){var o,l=function(){function i(i){var o=i[1];if(7===o)return i[2]=i[2],i[1]=3,yz;if(1===o)return o=r,i[7]=o,i[2]=null,i[1]=2,yz;if(4===o)return o=i[2],i[8]=o,i[1]=p(null==o)?5:6,yz;if(6===o){var l=i[8];return o=i[7],l=cf(o=n.b?n.b(o,l):n.call(null,o,l)),i[9]=o,i[1]=l?8:9,yz}return 3===o?LK(i,i[2]):2===o?KK(i,e):9===o?(o=i[9],i[7]=o,i[2]=null,i[1]=2,yz):5===o?(o=i[7],i[2]=o,i[1]=7,yz):10===o?(i[2]=i[2],i[1]=7,yz):8===o?(o=t(o=i[9]),i[2]=o,i[1]=10,yz):null}return function(){function n(n){for(;;){n:try{for(;;){var e=i(n);if(!P(e,yz)){var t=e;break n}}}catch(e){if(t=e,n[2]=t,!B(n[4]))throw t;n[1]=C(n[4]),t=yz}if(!P(t,yz))return t}}function e(){var n=[null,null,null,null,null,null,null,null,null,null];return n[0]=t,n[1]=1,n}var t=null;return(t=function(t){switch(arguments.length){case 0:return e.call(this);case 1:return n.call(this,t)}throw Error("Invalid arity: "+arguments.length)}).o=e,t.a=n,t}()}();return JK(((o=l())[6]=i,o))})),i}var SK={};function TK(){return(new Date).getTime()}var UK=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],2<t.length?new Qe(t.slice(2),0,null):null)};function VK(n,e,t){return ih(oi,n,e,Mh(Cf,Dk),t)}function WK(n,e,t){return oi.A(n,e,ji,t)}UK.g=function(n,e,t){if(t=J(t,0,null),M(n)&&(e=B(e))){var r=B(e);return e=C(r),B(r=D(r))?0===F(r=UK.g(x.b(n,e),r,G([t])))&&Tc(FO.a(t))?Hf.b(n,e):K.c(n,e,r):Hf.b(n,e)}return n},UK.F=2,UK.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)};var XK=function n(e,t,r){if(p(t)){var i=B(t);if(t=C(i),Tc(B(i=D(i))))r=Of.b(x.b(e,t),r);else{var o=x.b(e,t);r=n.c?n.c(o,i,r):n.call(null,o,i,r)}return 0===F(r)?Hf.b(e,t):K.c(e,t,r)}return e};function YK(n){return p(n)?(PJ(n),RK((function(){return null}),n)):null}function ZK(n,e){return gd.c((function(e,t){return A.b(t,n)?e:Cf.b(e,t)}),I,e)}function $K(n,e){return gd.b((function(e,t){return p(n.a?n.a(t):n.call(null,t))?bf(t):null}),e)}function aL(n,e){return Tc(x.b(n,e))?K.c(n,e,S):n}function bL(n){return kg((function(n,e,t){return K.c(n,Kg.a(e),t)}),S,n)}function cL(){return fh(q,gi.b(new Bk(null,new n(null,1,["-",null],null),null),q.a(gm())))}function dL(n){return $y.a(n)}function eL(n){var e=Qq.b(n,1),t=["r-",q.a($y.a(n)),"-",q.a(e)].join("");return new Q(null,2,5,R,[K.c(n,Qq,e+1),t],null)}function fL(n){var e=Qq.b(n,1),t=["c-",q.a($y.a(n)),"-",q.a(e)].join("");return new Q(null,2,5,R,[K.c(n,Qq,e+1),t],null)}function gL(n){var e=Qq.b(n,1),t=["p-",q.a($y.a(n)),"-",q.a(e)].join("");return new Q(null,2,5,R,[K.c(n,Qq,e+1),t],null)}function hL(n,e,t,r,i){this.uri=n,this.message=e,this.Mb=t,this.j=r,this.B=i,this.h=2230716170,this.I=139264}function iL(n,e){return new hL(n,e,null,null,null)}function jL(n,e){var t=km(n);return new hL(e=$v.b(t,e),p(t=sr.a(t))?t:lm(n),null,null,null)}function kL(n,e){throw im(e,iL(n,e))}function lL(n){return iL(uE.a(n),kJ.a(n))}function mL(n,e){return iL(n,e)}function nL(e){var t=cL();return new n(null,2,[Mx,new n(null,2,[$y,e,Qq,1],null),pn,t],null)}function oL(e,t,r,i){return oi.A(ni(e,new Q(null,3,5,R,[Dn,t,r],null),p(i)?new n(null,1,[os,i],null):S),new Q(null,2,5,R,[zr,r],null),Mh(Cf,Dk),t)}function pL(n,e,t){return XK(oi.A(n,new Q(null,2,5,R,[Dn,e],null),Hf,t),new Q(null,2,5,R,[zr,t],null),e)}function qL(n,e,t){return mi.b(n,new Q(null,3,5,R,[zr,t,e],null))}function rL(n,e,t){return p(e)?ni(n,new Q(null,2,5,R,[aC,e],null),t):n}function sL(n,e){return Uk(UK,mi)(n,new Q(null,2,5,R,[aC,e],null))}function tL(n,e){return mi.b(n,new Q(null,3,5,R,[pz,e,tq],null))}function uL(e,t){return new n(null,2,[Fy,e,Xv,t],null)}function vL(e,t){return K.c(uL(new n(null,1,[U,Zv],null),t),lz,e)}function wL(n,e,t){return K.c(uL(e,t),lz,n)}g=hL.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"uri":return this.uri;case"message":return this.message;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#gateway.reason.Reason{",", ","}",t,Xg.b(new Q(null,2,5,R,[new Q(null,2,5,R,[$v,this.uri],null),new Q(null,2,5,R,[sr,this.message],null)],null),this.j))},g.ua=function(){return new gj(this,2,new Q(null,2,5,R,[$v,sr],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 2+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=57548305^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.uri,e.uri)&&A.b(this.message,e.message)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,2,[$v,null,sr,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new hL(this.uri,this.message,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b($v,e):P.call(null,$v,e))?new hL(t,this.message,this.Mb,this.j,null):p(P.b?P.b(sr,e):P.call(null,sr,e))?new hL(this.uri,t,this.Mb,this.j,null):new hL(this.uri,this.message,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,2,5,R,[new Gi($v,this.uri),new Gi(sr,this.message)],null),this.j))},g.O=function(n,e){return new hL(this.uri,this.message,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)};var xL=function n(e){switch(arguments.length){case 6:return n.la(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 5:return n.K(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};xL.la=function(e,t,r,i,o,l){return e=new n(null,6,[tq,e,U,IA,is,r,ow,i,uE,$v.a(o),kJ,sr.a(o)],null),uL(t,l=p(l)?K.c(e,fI,l):e)},xL.K=function(n,e,t,r,i){return xL.la(n,e,t,r,i,null)},xL.F=6;var yL=function n(e){switch(arguments.length){case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function zL(n){return A.b(U.a(n),Fs)}yL.A=function(n,e,t,r){return uL(e,yL.c(n,t,r))},yL.c=function(e,t,r){return new n(null,4,[tq,e,U,qz,is,t,ow,r],null)},yL.F=4;var AL=function n(e){switch(arguments.length){case 6:return n.la(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 5:return n.K(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};AL.la=function(n,e,t,r,i,o){return uL(e,AL.K(n,t,r,i,o))},AL.K=function(e,t,r,i,o){return new n(null,6,[tq,e,U,SE,ow,t,dB,r,pD,i,Mc,o],null)},AL.F=6;var BL=function n(e){switch(arguments.length){case 5:return n.K(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function CL(n,e){if(null!=n&&null!=n.Qc)n=n.Qc(n,e);else{var t=CL[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=CL._))throw Zc("ConjFlat.conj-flat",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function DL(n,e){for(n=mi.b(n,e);;){if(!p(EL.a?EL.a(n):EL.call(null,n)))return e;n=x.b(n,0),e=Cf.b(e,0)}}function FL(n,e){return new Mg(null,(function(){var t=mi.b(n,e);n:for(var r=n,i=e;;){if(A.b(F(i),1)){r=Mf(i)<(GL.a?GL.a(r):GL.call(null,r))-1?DL(r,new Q(null,1,5,R,[Mf(i)+1],null)):null;break n}var o=Mf(i),l=mi.b(r,Nf(i));if(o<(l=GL.a?GL.a(l):GL.call(null,l))-1){r=DL(r,Cf.b(Nf(i),Mf(i)+1));break n}i=Nf(i)}return vf(t,p(r)?FL(n,r):null)}),null,null)}function HL(n,e,t,r,i){this.ka=n,this.pe=e,this.Ic=t,this.C=r,this.md=i,this.Vd=null,this.h=31850958,this.I=0}function JL(n,e){var t=F(e);n:if(0===t)t=1;else{t|=0;for(var r=1,i=31;;){var o=Fh(t);if(t=tg(t,2),o)i=Ce(i,i);else{if(0===t){t=Ce(i,r);break n}r=Ce(i,r),i=Ce(i,i)}}}return Ce(t|=0,n.pe)+(e.pe-t)}function KL(n){n:for(var e=1,t=B(n=Ni(n));null!=t;)e=Ce(31,e)+Je(C(t))|0,t=D(t);return new HL(n,e,Je(n),F(n),!1)}BL.K=function(n,e,t,r,i){return uL(e,BL.A(n,t,r,i))},BL.A=function(e,t,r,i){return new n(null,6,[tq,e,U,mE,ow,t,EJ,r,uE,$v.a(i),kJ,sr.a(i)],null)},BL.F=5,g=HL.prototype,g.toString=function(){return Be(B(this))},g.ia=function(n,e){return this.ka.ia(null,e)},g.M=function(n,e,t){return this.ka.M(null,e,t)},g.N=function(){return Lf(this.ka)},g.za=function(){return D(B(this))},g.X=function(){return this.C},g.Z=function(){return this.Ic},g.Y=function(n,e){return A.b(this.Ic,Je(e))&&A.b(this.C,F(e))&&(A.b(this.C,0)||A.b(B(this),e))},g.pa=function(){return Kf(IL,Lf(this))},g.Fa=function(){return C(B(this))},g.Ha=function(){return Re(B(this))},g.$=function(){if(!p(this.Vd)){if(this.md){var n=this.ka;n=0<F(n)?FL(n,DL(n,new Q(null,1,5,R,[0],null))):null}else n=B(this.ka);this.Vd=n}return this.Vd},g.O=function(n,e){return new HL(Kf(this.ka,e),this.pe,this.Ic,this.C,this.md)},g.ga=function(n,e){return vf(e,this)},g.Qc=function(n,e){if(null==e)return this;if(p(EL.a?EL.a(e):EL.call(null,e))){if(0===this.C)return e;if(32>=F(e)){n=JL.b?JL.b(this,e):JL.call(null,this,e);var t=this.C+F(e),r=ji.b(this.ka,e),i=this.md;return new HL(r,n,Ve(n,t),t,i||e.md)}return n=JL.b?JL.b(this,e):JL.call(null,this,e),t=this.C+F(e),new HL(Cf.b(this.ka,e),n,Ve(n,t),t,!0)}return n=Ce(31,this.pe)+Je(e),t=this.C+1,new HL(Cf.b(this.ka,e),n,Ve(n,t),t,this.md)},g.ma=h,g.S=function(n,e,t){return fe(B(this),e,t)};var IL=KL(I);function EL(n){return n instanceof HL}function GL(n){return EL(n)?F(n.ka):F(n)}var LL=function n(e,t){for(;;){if(!B(t))return e;var r=C(t);EL(r)?(e=n.b?n.b(e,r):n.call(null,e,r),t=D(t)):(e=Yg.b(e,r),t=D(t))}};function ML(n,e,t,r){this.ka=n,this.Ic=e,this.C=t,this.flat=r,this.h=167142175,this.I=2048}function NL(n){return Tc(t(n.flat))&&(Rh.b(n.flat,(function(){var e=t(n.ka);return Kf(e=le(LL(je(I),e)),Lf(t(n.ka)))})),Rh.b(n.ka,(function(){return null}))),t(n.flat)}function OL(n){return p(n.md)?p(n.Vd)?Ni(B(n)):new ML(Oh(n.ka),n.Ic,n.C,Oh(null)):n.ka}function PL(n,e,t){var r=p(e.ignoreCase)?"gi":"g";return r=p(e.multiline)?[r,"m"].join(""):r,n.replace(new RegExp(e.source,p(e.Jh)?[r,"u"].join(""):r),t)}function QL(n){return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=Zh(2,e),A.b(F(e),1)?(e=C(e),n.a?n.a(e):n.call(null,e)):(e=Ni(e),n.a?n.a(e):n.call(null,e))}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}function RL(n,e,t){if("string"==typeof e)return n.replace(new RegExp(String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),t);if(e instanceof RegExp)return PL(n,e,"string"==typeof t?t:QL(t));throw["Invalid match arg: ",q.a(e)].join("")}function SL(n,e){var t=new zc;for(e=B(e);;){if(null==e)return t.toString();t.append(q.a(C(e))),null!=(e=D(e))&&t.append(n)}}function TL(n,e){return 0>=e||e>=2+F(n)?Cf.b(Ni(vf("",Wh.b(q,B(n)))),""):p(xg?Ud(1,e):wg.call(null,1,e))?new Q(null,1,5,R,[n],null):p(xg?Ud(2,e):wg.call(null,2,e))?new Q(null,2,5,R,["",n],null):(e-=2,Cf.b(Ni(vf("",Wi(Ni(Wh.b(q,B(n))),0,e))),n.substring(e)))}function UL(n,e,t){if("/(?:)/"===q.a(e))e=TL(n,t);else if(1>t)e=Ni(q.a(n).split(e));else n:for(var r=t,i=I;;){if(1===r){e=Cf.b(i,n);break n}var o=Xk(e,n);if(null==o){e=Cf.b(i,n);break n}var l=n.indexOf(o);o=n.substring(l+F(o)),--r,i=Cf.b(i,n.substring(0,l)),n=o}if(0===t&&1<F(e))n:for(t=e;""===Mf(t);)t=Nf(t);else t=e;return t}function VL(n,e,t){return Tc(e)?(e=t.a?t.a(X):t.call(null,X),n=n.a?n.a(e):n.call(null,e)):n=!1,p(n)?["(",q.a(WL?WL(t,!1):XL.call(null,t,!1)),")"].join(""):WL?WL(t,!1):XL.call(null,t,!1)}g=ML.prototype,g.toString=function(){return Be(NL(this))},g.ia=function(n,e){return NL(this).ia(null,e)},g.M=function(n,e,t){return NL(this).M(null,e,t)},g.Aa=function(n,e,t){return NL(this).Aa(null,e,t)},g.W=function(n,e){return NL(this).W(null,e)},g.wa=function(n,e,t){return NL(this).wa(null,e,t)},g.Ib=function(n,e,t){return NL(this).Ib(null,e,t)},g.N=function(){return p(t(this.flat))?Lf(t(this.flat)):Lf(t(this.ka))},g.X=function(){return this.C},g.Xb=function(){return NL(this).Xb(null)},g.Yb=function(){return NL(this).Yb(null)},g.Bc=function(){return 0<this.C?be(NL(this)):null},g.Z=function(){return this.Ic},g.Y=function(n,e){return A.b(this.Ic,Je(e))&&A.b(this.C,F(e))&&A.b(NL(this),e)},g.pa=function(){return Kf(I,Lf(this))},g.fa=function(n,e,t){return K.c(NL(this),e,t)},g.$=function(){return B(NL(this))},g.O=function(n,e){return p(t(this.flat))?new ML(Oh(t(this.ka)),this.Ic,this.C,Oh(Kf(t(this.flat),e))):new ML(Oh(Kf(t(this.ka),e)),this.Ic,this.C,Oh(t(this.flat)))},g.ga=function(n,e){return Cf.b(NL(this),e)},g.call=function(){function n(n,e,t){return NL(this).c(null,e,t)}function e(n,e){return NL(this).b(null,e)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+(arguments.length-1))}).b=e,t.c=n,t}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return NL(this).b(null,n)},g.b=function(n,e){return NL(this).c(null,n,e)},g.Wb=function(n,e){return pe(NL(this),e)},g.ma=h,g.S=function(n,e,t){return fe(NL(this),e,t)};var YL=Jh(VL,new Bk(null,new n(null,3,[oF,null,AJ,null,xC,null],null),null));function ZL(n){switch(n){case"\n":return"\\n";case"\b":return"\\b";case"\f":return"\\f";case"\r":return"\\r";case"\t":return"\\t";default:return n}}function $L(n){return RL(['#"',n.source.substring(1),'"'].join(""),/[\s]/,ZL)}function aM(n){return 4095>=n?["0000",q.a(n.toString(16))].join("").substr(-4):n.toString(16)}function bM(n){var e=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;return n=x.b(e,Zy),e=x.b(e,yJ),A.b(n,e)?["%x",q.a(aM(n))].join(""):["%x",q.a(aM(n)),"-",q.a(aM(e))].join("")}function XL(n){switch(arguments.length){case 1:return WL(arguments[0],!1);case 2:return WL(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function WL(e,t){e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;var r=x.b(e,wv),i=x.b(e,Xn),o=x.b(e,Vn),l=x.b(e,An),u=x.b(e,X);if(p(!!Tc(t)&&ls.a(e)))return["<",q.a(WL(e,!0)),">"].join("");switch(u=u instanceof z?u.da:null){case"epsilon":return"";case"opt":return[q.a(YL(t,r)),"?"].join("");case"plus":return[q.a(YL(t,r)),"+"].join("");case"star":return[q.a(YL(t,r)),"*"].join("");case"rep":return kh.b(qx.a(e),bw.a(e))?[q.a(YL(t,r)),"{",q.a(qx.a(e)),",",q.a(bw.a(e)),"}"].join(""):[q.a(YL(t,r)),"{",q.a(qx.a(e)),"}"].join("");case"alt":return SL(" | ",Wh.b(Kh(VL,new Bk(null,new n(null,1,[AJ,null],null),null),t),l));case"ord":return[q.a(VL(new Bk(null,new n(null,1,[xC,null],null),null),t,i))," / ",q.a(VL(new Bk(null,new n(null,1,[xC,null],null),null),t,o))].join("");case"cat":return SL(" ",Wh.b(Kh(VL,new Bk(null,new n(null,2,[AJ,null,xC,null],null),null),t),l));case"string":var s=new zc;t=Fc,r=Ec,Fc=!0,Ec=function(n){return s.append(n)};try{nl(G([xn.a(e)]),Jc())}finally{Ec=r,Fc=t}return q.a(s);case"string-ci":s=new zc,t=Fc,r=Ec,Fc=!0,Ec=function(n){return s.append(n)};try{nl(G([xn.a(e)]),Jc())}finally{Ec=r,Fc=t}return q.a(s);case"char":return bM(e);case"regexp":return $L(Et.a(e));case"nt":return Ag(q.a(FJ.a(e)),1);case"look":return["&",q.a(YL(t,r))].join("");case"neg":return["!",q.a(YL(t,r))].join("");default:throw Error(["No matching clause: ",q.a(u)].join(""))}}function cM(n,e){return A.b(ny.a(Hu.a(e)),Pt)?["<",Lg(n),"> = ",q.a(WL(e,!1))].join(""):[Lg(n)," = ",q.a(WL(e,!1))].join("")}function dM(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var e=x.b(n,wo),t=x.b(n,iz);return SL("\n",vf(cM(t,e.a?e.a(t):e.call(null,t)),function n(e){return new Mg(null,(function(){for(var r=e;;){if(!(r=B(r)))return null;if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),kh.b(a,t)&&(a=cM(a,s),l.add(a)),u+=1}return Sg(Ug(l),i?n(se(r)):null)}if(l=J(i=C(r),0,null),i=J(i,1,null),kh.b(l,t))return vf(cM(l,i),n(Re(r)));r=Re(r)}}),null,null)}(e)))}function eM(e,t){for(t=B(RL(t,"\r\n","\n"));;){if(Pf(t))return"";if(A.b(e,1))return fh(q,Mk(Gh(new Bk(null,new n(null,1,["\n",null],null),null)),t));A.b("\n",C(t))?(t=D(t),--e):t=D(t)}}function fM(n){p(iJ.a(n))?(pl.g(G(["NOT "])),pl.g(G([iJ.a(n)]))):p(Au.a(n))?pl.g(G([bM(n)])):n instanceof RegExp?pl.g(G([$L(n)])):nl(G([n]),Jc())}function gM(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var e=x.b(n,en),t=x.b(n,ux),r=x.b(n,ZD);n=x.b(n,kJ),sl(G([["Parse error at line ",q.a(e),", column ",q.a(t),":"].join("")])),sl(G([r])),sl(G([e=bg(t)?1>=t?"^":fh(q,Xg.b(ai(t-1," "),new Q(null,1,5,R,["^"],null))):null])),e=Gk(Wh.b(DA,fi.b(RH,n))),n=Gk(Wh.b(DA,fi.b(Gh(RH),n))),0!==(t=F(e)+F(n))&&(A.b(1,t)?sl(G(["Expected:"])):sl(G(["Expected one of:"]))),e=B(e),t=null;for(var i=r=0;;)if(i<r){fM(t.W(null,i)),sl(G([" (followed by end-of-string)"])),i+=1}else{if(!(e=B(e)))break;Wf(t=e)?(e=re(t),i=se(t),t=e,r=F(e),e=i):(fM(e=C(t)),sl(G([" (followed by end-of-string)"])),e=D(t),t=null,r=0),i=0}for(n=B(n),e=null,i=r=0;;)if(i<r)fM(t=e.W(null,i)),rl(),i+=1;else{if(!(n=B(n)))break;Wf(e=n)?(n=re(e),r=se(e),e=n,t=F(n),n=r,r=t):(fM(t=C(e)),rl(),n=D(e),e=null,r=0),i=0}}function hM(n){throw fh(q,n)}function iM(n){throw fh(q,n)}function jM(n){var e=p(n.ignoreCase)?"i":"";return e=p(n.multiline)?[e,"m"].join(""):e,p(n.Jh)?[e,"u"].join(""):e}function kM(n){return B(n)&&Tc(D(n))}function lM(n){return K.c(n,Hu,mM)}var mM=new n(null,1,[ny,Pt],null),nM=new n(null,2,[DC,function(e){return new n(null,2,[ny,DC,NI,e],null)},FA,function(e){return new n(null,2,[ny,FA,NI,e],null)}],null),oM=new n(null,2,[FA,function(e,t){return new n(null,2,[X,e,sE,new Df(null,t,null,1,null)],null)},DC,function(n,e){return new Q(null,2,5,R,[n,e],null)}],null);function pM(e,t){var r=ny.a(e);switch(r instanceof z?r.da:null){case"raw":return IL.Qc(null,t);case"hiccup":return OL(KL(new Q(null,1,5,R,[NI.a(e)],null)).Qc(null,t));case"enlive":return t=IL.Qc(null,t),new n(null,2,[X,NI.a(e),sE,0===F(t)?null:t],null);default:return e.a?e.a(t):e.call(null,t)}}function qM(n,e){var t=nM.a?nM.a(n):nM.call(null,n);return p(t)?ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var r=B(e);if(r){if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),a=p(Hu.a(s))?new Q(null,2,5,R,[a,s],null):new Q(null,2,5,R,[a,K.c(s,Hu,t.a?t.a(a):t.call(null,a))],null),l.add(a),u+=1}return Sg(Ug(l),i?n(se(r)):null)}return l=J(i=C(r),0,null),i=J(i,1,null),vf(p(Hu.a(i))?new Q(null,2,5,R,[l,i],null):new Q(null,2,5,R,[l,K.c(i,Hu,t.a?t.a(l):t.call(null,l))],null),n(Re(r)))}return null}}),null,null)}(e)):iM(G(["Invalid output format ",n,". Use :enlive or :hiccup."]))}var rM=new n(null,1,[X,zA],null);function sM(e){return A.b(e,rM)?rM:new n(null,2,[X,jJ,wv,e],null)}function tM(e){return A.b(e,rM)?rM:new n(null,2,[X,eq,wv,e],null)}function uM(e){return A.b(e,rM)?rM:new n(null,2,[X,XC,wv,e],null)}function vM(e,t,r){return A.b(r,rM)?rM:new n(null,4,[X,Ku,wv,r,qx,e,bw,t],null)}var wM=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};wM.g=function(e){return Dh(Jh(A,rM),e)?rM:kM(e)?C(e):new n(null,2,[X,xC,An,e],null)},wM.F=0,wM.G=function(n){return this.g(B(n))};var xM=function n(e){switch(arguments.length){case 0:return n.o();default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],new Qe(t.slice(1),0,null))}};xM.o=function(){return rM},xM.g=function(e,t){return B(t=A.b(e,rM)?gi.b(Ek([rM]),t):t)&&(t=fh(xM,t),e=new n(null,3,[X,AJ,Xn,e,Vn,t],null)),e},xM.G=function(n){var e=C(n);return n=D(n),this.g(e,n)},xM.F=1;var yM=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function zM(e){return A.b(e,"")?rM:new n(null,2,[X,xn,xn,e],null)}function AM(e){return A.b(e,"")?rM:new n(null,2,[X,zC,xn,e],null)}function BM(e,t){return new n(null,3,[X,nG,Zy,e,yJ,t],null)}function CM(e){return A.b(e,"")?e=rM:(e=(e=Zk(e))instanceof RegExp?new RegExp(["^",q.a(e.source)].join(""),jM(e)):e,e=new n(null,2,[X,Et,Et,e],null)),e}function DM(e){return new n(null,2,[X,Ay,FJ,e],null)}function EM(e){return new n(null,2,[X,qA,wv,e],null)}function FM(e){return new n(null,2,[X,tC,wv,e],null)}function GM(n){return K.c(n,ls,!0)}yM.g=function(e){return Dh(Jh(A,rM),e)?rM:kM(e=gi.b(Ek([rM]),e))?C(e):new n(null,2,[X,oF,An,e],null)},yM.F=0,yM.G=function(n){return this.g(B(n))};var HM=function n(e){var t,r=p(ls.a(e))?Hf.b(e,ls):e;return p(wv.a(r))?K.c(r,wv,(t=wv.a(r),n.a?n.a(t):n.call(null,t))):p(An.a(r))?K.c(r,An,Wh.b(n,An.a(r))):A.b(X.a(r),AJ)?K.g(r,Xn,function(){var e=Xn.a(r);return n.a?n.a(e):n.call(null,e)}(),G([Vn,function(){var e=Vn.a(r);return n.a?n.a(e):n.call(null,e)}()])):r};function IM(n){return ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l),s=J(u,0,null);u=J(u,1,null),s=new Q(null,2,5,R,[s,HM(u)],null),o.add(s),l+=1}return Sg(Ug(o),r?n(se(t)):null)}return o=J(r=C(t),0,null),r=J(r,1,null),vf(new Q(null,2,5,R,[o,HM(r)],null),n(Re(t)))}return null}}),null,null)}(n))}function JM(n,e){var t=nM.a?nM.a(n):nM.call(null,n);return p(t)?ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var r=B(e);if(r){if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),a=new Q(null,2,5,R,[a,K.c(s,Hu,t.a?t.a(a):t.call(null,a))],null),l.add(a),u+=1}return Sg(Ug(l),i?n(se(r)):null)}return l=J(i=C(r),0,null),i=J(i,1,null),vf(new Q(null,2,5,R,[l,K.c(i,Hu,t.a?t.a(l):t.call(null,l))],null),n(Re(r)))}return null}}),null,null)}(e)):iM(G(["Invalid output format ",n,". Use :enlive or :hiccup."]))}function KM(n,e){var t=nM.a?nM.a(n):nM.call(null,n);return p(t)?ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var r=B(e);if(r){if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),a=new Q(null,2,5,R,[a,K.c(HM(s),Hu,t.a?t.a(a):t.call(null,a))],null),l.add(a),u+=1}return Sg(Ug(l),i?n(se(r)):null)}return l=J(i=C(r),0,null),i=J(i,1,null),vf(new Q(null,2,5,R,[l,K.c(HM(i),Hu,t.a?t.a(l):t.call(null,l))],null),n(Re(r)))}return null}}),null,null)}(e)):iM(G(["Invalid output format ",n,". Use :enlive or :hiccup."]))}var LM=function n(e,t){var r,i=X.a(e);switch(i=i instanceof z?i.da:null){case"nt":case"epsilon":return e;case"opt":case"plus":case"star":case"rep":case"look":case"neg":return oi.A(e,new Q(null,1,5,R,[wv],null),n,t);case"alt":case"cat":return K.c(e,An,Wh.b((function(e){return n.b?n.b(e,t):n.call(null,e,t)}),An.a(e)));case"ord":return K.g(e,Xn,(r=Xn.a(e),n.b?n.b(r,t):n.call(null,r,t)),G([Vn,function(){var r=Vn.a(e);return n.b?n.b(r,t):n.call(null,r,t)}()]));case"string":case"string-ci":case"regexp":return p(Hu.a(e))?K.c(yM.g(G([t,Hf.b(e,Hu)])),Hu,Hu.a(e)):yM.g(G([t,e]));default:throw Error(["No matching clause: ",q.a(i)].join(""))}};function MM(n,e,t,r){var i=GM(sM(DM(r)));return t=K.c(t,r,lM(t.a?t.a(r):t.call(null,r))),r=ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),o=F(r),l=Qg(o);n:for(var u=0;;){if(!(u<o)){r=!0;break n}var s=qd(r,u),a=J(s,0,null);s=J(s,1,null),a=new Q(null,2,5,R,[a,LM(s,i)],null),l.add(a),u+=1}return Sg(Ug(l),r?n(se(t)):null)}return l=J(r=C(t),0,null),r=J(r,1,null),vf(new Q(null,2,5,R,[l,LM(r,i)],null),n(Re(t)))}return null}}),null,null)}(n)),e=K.c(r,e,K.c(yM.g(G([Hf.b(r.a?r.a(e):r.call(null,e),Hu),i])),Hu,Hu.a(r.a?r.a(e):r.call(null,e)))),wk.g(G([e,t]))}function NM(n){if(null==n||!(0<=n&&1114111>=n))return null;if(65536<=n&&1114111>=n){var e=56320+(1023&n);return String.fromCharCode(55232+(n>>10))+String.fromCharCode(e)}return String.fromCharCode(n)}function OM(n,e){var t=n.charCodeAt(e);if(55296<=t&&56319>=t&&e+1<n.length){if(56320<=(n=n.charCodeAt(e+1))&&57343>=n)return 55296<=t&&56319>=t&&56320<=n&&57343>=n?(t<<10)-56623104+(n-56320+65536):null}else if(56320<=t&&57343>=t&&0<e&&(55296<=(n=n.charCodeAt(e-1))&&56319>=n))return-(55296<=n&&56319>=n&&56320<=t&&57343>=t?(n<<10)-56623104+(t-56320+65536):0);return t}function PM(n,e,t){var r=X.a(n);switch(r=r instanceof z?r.da:null){case"nt":return QM.c?QM.c(n,e,t):QM.call(null,n,e,t);case"alt":return RM.c?RM.c(n,e,t):RM.call(null,n,e,t);case"cat":return SM.c?SM.c(n,e,t):SM.call(null,n,e,t);case"string":return TM.c?TM.c(n,e,t):TM.call(null,n,e,t);case"string-ci":return UM.c?UM.c(n,e,t):UM.call(null,n,e,t);case"char":return VM.c?VM.c(n,e,t):VM.call(null,n,e,t);case"epsilon":return WM.c?WM.c(n,e,t):WM.call(null,n,e,t);case"opt":return XM.c?XM.c(n,e,t):XM.call(null,n,e,t);case"plus":return YM.c?YM.c(n,e,t):YM.call(null,n,e,t);case"rep":return ZM.c?ZM.c(n,e,t):ZM.call(null,n,e,t);case"star":return $M.c?$M.c(n,e,t):$M.call(null,n,e,t);case"regexp":return aN.c?aN.c(n,e,t):aN.call(null,n,e,t);case"look":return bN.c?bN.c(n,e,t):bN.call(null,n,e,t);case"neg":return cN.c?cN.c(n,e,t):cN.call(null,n,e,t);case"ord":return dN.c?dN.c(n,e,t):dN.call(null,n,e,t);default:throw Error(["No matching clause: ",q.a(r)].join(""))}}function eN(n,e,t){var r=X.a(n);switch(r=r instanceof z?r.da:null){case"nt":return fN.c?fN.c(n,e,t):fN.call(null,n,e,t);case"alt":return gN.c?gN.c(n,e,t):gN.call(null,n,e,t);case"cat":return hN.c?hN.c(n,e,t):hN.call(null,n,e,t);case"string":return iN.c?iN.c(n,e,t):iN.call(null,n,e,t);case"string-ci":return jN.c?jN.c(n,e,t):jN.call(null,n,e,t);case"char":return kN.c?kN.c(n,e,t):kN.call(null,n,e,t);case"epsilon":return lN.c?lN.c(n,e,t):lN.call(null,n,e,t);case"opt":return mN.c?mN.c(n,e,t):mN.call(null,n,e,t);case"plus":return nN.c?nN.c(n,e,t):nN.call(null,n,e,t);case"rep":return oN.c?oN.c(n,e,t):oN.call(null,n,e,t);case"star":return pN.c?pN.c(n,e,t):pN.call(null,n,e,t);case"regexp":return qN.c?qN.c(n,e,t):qN.call(null,n,e,t);case"look":return rN.c?rN.c(n,e,t):rN.call(null,n,e,t);case"neg":return cN.c?cN.c(n,e,t):cN.call(null,n,e,t);case"ord":return sN.c?sN.c(n,e,t):sN.call(null,n,e,t);default:throw Error(["No matching clause: ",q.a(r)].join(""))}}function tN(n,e,t,r,i){this.index=n,this.reason=e,this.Mb=t,this.j=r,this.B=i,this.h=2230716170,this.I=139264}g=tN.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"index":return this.index;case"reason":return this.reason;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#instaparse.gll.Failure{",", ","}",t,Xg.b(new Q(null,2,5,R,[new Q(null,2,5,R,[DH,this.index],null),new Q(null,2,5,R,[kJ,this.reason],null)],null),this.j))},g.ua=function(){return new gj(this,2,new Q(null,2,5,R,[DH,kJ],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 2+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-1140991288^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.index,e.index)&&A.b(this.reason,e.reason)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,2,[DH,null,kJ,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new tN(this.index,this.reason,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(DH,e):P.call(null,DH,e))?new tN(t,this.reason,this.Mb,this.j,null):p(P.b?P.b(kJ,e):P.call(null,kJ,e))?new tN(this.index,t,this.Mb,this.j,null):new tN(this.index,this.reason,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,2,5,R,[new Gi(DH,this.index),new Gi(kJ,this.reason)],null),this.j))},g.O=function(n,e){return new tN(this.index,this.reason,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g.ma=h,g.S=function(n,e){var t=this;return ce(e,function(){var n=new zc,e=Fc,r=Ec;Fc=!0,Ec=function(e){return n.append(e)};try{gM(t)}finally{Ec=r,Fc=e}return q.a(n)}())};var uN=Yc(new tN(null,null,null,null,null));function vN(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){this.qa=n,this.text=e,this.Ua=t,this.Ma=r,this.Ta=i,this.stack=o,this.Sa=l,this.Oa=u,this.Ra=s,this.Qa=a,this.sa=c,this.Va=d,this.Na=h,this.Wa=f,this.Mb=p,this.j=g,this.B=w,this.h=2230716170,this.I=139264}function wN(n,e,t,r,i){return new vN(n,e,t,r,i,Oh(I),Oh(I),Oh(0),Oh(tk(qg)),Oh(S),Oh(S),Oh(null),Oh(new tN(0,I,null,null,null)),!1,null,null,null)}function xN(e,t){return new n(null,2,[Ru,e,DH,t],null)}function yN(n,e){return A.b(F(ZD.a(n)),DH.a(e))}function zN(n,e,t,r,i,o,l){this.kc=n,this.cc=e,this.results=t,this.dc=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}function AN(n,e){return Rh.c(CC.a(n),Cf,e)}function BN(n,e,r){function i(){return e.a?e.a(r):e.call(null,r)}var o=As.a(n),l=DH.a(r);l=new Q(null,2,5,R,[e,l],null);var u=x.c(t(o),l,0);u>t(wD.a(n))?Rh.c(pw.a(n),Cf,i):Rh.c(CC.a(n),Cf,i),Rh.A(o,K,l,u+1)}function CN(n,e){return p(e=(n=t(n=lA.a(n))).a?n.a(e):n.call(null,e))?0<F(t(jE.a(e))):null}function DN(n,e){return p(e=(n=t(n=lA.a(n))).a?n.a(e):n.call(null,e))?0<F(t(xy.a(e)))||0<F(t(jE.a(e))):null}function EN(n,e){return p(e=(n=t(n=lA.a(n))).a?n.a(e):n.call(null,e))?0<F(t(gs.a(e)))||0<F(t(uJ.a(e))):null}function FN(n,e){var r=t(n=lA.a(n));return p(r=r.a?r.a(e):r.call(null,e))||(r=new zN(Oh(I),Oh(I),Oh(Dk),Oh(Dk),null,null,null),Rh.A(n,K,e,r)),r}function GN(n,e){return(null!=n?262144&n.h||h===n.He||!n.h&&Xc(Od,n):Xc(Od,n))?Kf(n,e):n}function HN(e,r,i){var o,l=FN(e,r),u=r.a?r.a(1):r.call(null,1),s=p(ls.a(u))?K.c(i,Ru,null):i,a=p(o=Hu.a(u))?xN(GN(pM(o,Ru.a(s)),new n(null,2,[Yv,r.a?r.a(0):r.call(null,0),hp,DH.a(s)],null)),DH.a(s)):s,c=(i=yN(e,a))?gs.a(l):uJ.a(l);if(!Tc(function(){var n=t(c);return n.a?n.a(a):n.call(null,a)}()))return null;Rh.c(c,Cf,a);for(var d=B(t(jE.a(l))),h=null,f=0,g=0;;)if(g<f){BN(e,h.W(null,g),a),g+=1}else{if(!(d=B(d)))break;Wf(h=d)?(d=re(h),g=se(h),h=d,f=F(d),d=g):(BN(e,d=C(h),a),d=D(h),h=null,f=0),g=0}if(!i)return null;for(l=B(t(xy.a(l))),i=null,f=h=0;;)if(f<h)BN(e,d=i.W(null,f),a),f+=1;else{if(!(l=B(l)))return null;Wf(i=l)?(l=re(i),h=se(i),i=l,d=F(l),l=h,h=d):(BN(e,d=C(i),a),l=D(i),i=null,h=0),f=0}}function IN(n,e,r){var i=CN(n,e),o=FN(n,e),l=jE.a(o);Rh.c(l,Cf,r),l=B(t(uJ.a(o)));for(var u=null,s=0,a=0;;)if(a<s){var c=u.W(null,a);BN(n,r,c),a+=1}else{if(!(l=B(l)))break;Wf(u=l)?(l=re(u),a=se(u),u=l,s=F(l),l=a):(l=C(u),BN(n,r,l),l=D(u),u=null,s=0),a=0}for(o=B(t(gs.a(o))),l=null,s=u=0;;)if(s<u)a=l.W(null,s),BN(n,r,a),s+=1;else{if(!(o=B(o)))break;Wf(l=o)?(o=re(l),s=se(l),l=o,u=F(o),o=s):(o=C(l),BN(n,r,o),o=D(l),l=null,u=0),s=0}return Tc(i)?AN(n,(function(){return PM(e.a?e.a(1):e.call(null,1),e.a?e.a(0):e.call(null,0),n)})):null}function JN(n,e,r){var i=DN(n,e),o=FN(n,e),l=xy.a(o);Rh.c(l,Cf,r),o=B(t(gs.a(o))),l=null;for(var u=0,s=0;;)if(s<u){var a=l.W(null,s);BN(n,r,a),s+=1}else{if(!(o=B(o)))break;Wf(l=o)?(o=re(l),s=se(l),l=o,u=F(o),o=s):(o=C(l),BN(n,r,o),o=D(l),l=null,u=0),s=0}return Tc(i)?AN(n,(function(){return eN(e.a?e.a(1):e.call(null,1),e.a?e.a(0):e.call(null,0),n)})):null}g=vN.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"grammar":return this.qa;case"text":return this.text;case"segment":return this.Ua;case"fail-index":return this.Ma;case"node-builder":return this.Ta;case"stack":return this.stack;case"next-stack":return this.Sa;case"generation":return this.Oa;case"negative-listeners":return this.Ra;case"msg-cache":return this.Qa;case"nodes":return this.sa;case"success":return this.Va;case"failure":return this.Na;case"trace?":return this.Wa;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#instaparse.gll.Tramp{",", ","}",t,Xg.b(new Q(null,14,5,R,[new Q(null,2,5,R,[wo,this.qa],null),new Q(null,2,5,R,[ZD,this.text],null),new Q(null,2,5,R,[Rv,this.Ua],null),new Q(null,2,5,R,[HB,this.Ma],null),new Q(null,2,5,R,[oq,this.Ta],null),new Q(null,2,5,R,[CC,this.stack],null),new Q(null,2,5,R,[pw,this.Sa],null),new Q(null,2,5,R,[wD,this.Oa],null),new Q(null,2,5,R,[NG,this.Ra],null),new Q(null,2,5,R,[As,this.Qa],null),new Q(null,2,5,R,[lA,this.sa],null),new Q(null,2,5,R,[qz,this.Va],null),new Q(null,2,5,R,[lC,this.Na],null),new Q(null,2,5,R,[Mn,this.Wa],null)],null),this.j))},g.ua=function(){return new gj(this,14,new Q(null,14,5,R,[wo,ZD,Rv,HB,oq,CC,pw,wD,NG,As,lA,qz,lC,Mn],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 14+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=166878148^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.qa,e.qa)&&A.b(this.text,e.text)&&A.b(this.Ua,e.Ua)&&A.b(this.Ma,e.Ma)&&A.b(this.Ta,e.Ta)&&A.b(this.stack,e.stack)&&A.b(this.Sa,e.Sa)&&A.b(this.Oa,e.Oa)&&A.b(this.Ra,e.Ra)&&A.b(this.Qa,e.Qa)&&A.b(this.sa,e.sa)&&A.b(this.Va,e.Va)&&A.b(this.Na,e.Na)&&A.b(this.Wa,e.Wa)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,14,[As,null,NG,null,wD,null,lC,null,HB,null,wo,null,qz,null,lA,null,oq,null,Rv,null,CC,null,Mn,null,pw,null,ZD,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(wo,e):P.call(null,wo,e))?new vN(t,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(ZD,e):P.call(null,ZD,e))?new vN(this.qa,t,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(Rv,e):P.call(null,Rv,e))?new vN(this.qa,this.text,t,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(HB,e):P.call(null,HB,e))?new vN(this.qa,this.text,this.Ua,t,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(oq,e):P.call(null,oq,e))?new vN(this.qa,this.text,this.Ua,this.Ma,t,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(CC,e):P.call(null,CC,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,t,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(pw,e):P.call(null,pw,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,t,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(wD,e):P.call(null,wD,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,t,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(NG,e):P.call(null,NG,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,t,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(As,e):P.call(null,As,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,t,this.sa,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(lA,e):P.call(null,lA,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,t,this.Va,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(qz,e):P.call(null,qz,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,t,this.Na,this.Wa,this.Mb,this.j,null):p(P.b?P.b(lC,e):P.call(null,lC,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,t,this.Wa,this.Mb,this.j,null):p(P.b?P.b(Mn,e):P.call(null,Mn,e))?new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,t,this.Mb,this.j,null):new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,14,5,R,[new Gi(wo,this.qa),new Gi(ZD,this.text),new Gi(Rv,this.Ua),new Gi(HB,this.Ma),new Gi(oq,this.Ta),new Gi(CC,this.stack),new Gi(pw,this.Sa),new Gi(wD,this.Oa),new Gi(NG,this.Ra),new Gi(As,this.Qa),new Gi(lA,this.sa),new Gi(qz,this.Va),new Gi(lC,this.Na),new Gi(Mn,this.Wa)],null),this.j))},g.O=function(n,e){return new vN(this.qa,this.text,this.Ua,this.Ma,this.Ta,this.stack,this.Sa,this.Oa,this.Ra,this.Qa,this.sa,this.Va,this.Na,this.Wa,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=zN.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"listeners":return this.kc;case"full-listeners":return this.cc;case"results":return this.results;case"full-results":return this.dc;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#instaparse.gll.Node{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[jE,this.kc],null),new Q(null,2,5,R,[xy,this.cc],null),new Q(null,2,5,R,[uJ,this.results],null),new Q(null,2,5,R,[gs,this.dc],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[jE,xy,uJ,gs],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-1610074144^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.kc,e.kc)&&A.b(this.cc,e.cc)&&A.b(this.results,e.results)&&A.b(this.dc,e.dc)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[gs,null,xy,null,jE,null,uJ,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new zN(this.kc,this.cc,this.results,this.dc,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(jE,e):P.call(null,jE,e))?new zN(t,this.cc,this.results,this.dc,this.Mb,this.j,null):p(P.b?P.b(xy,e):P.call(null,xy,e))?new zN(this.kc,t,this.results,this.dc,this.Mb,this.j,null):p(P.b?P.b(uJ,e):P.call(null,uJ,e))?new zN(this.kc,this.cc,t,this.dc,this.Mb,this.j,null):p(P.b?P.b(gs,e):P.call(null,gs,e))?new zN(this.kc,this.cc,this.results,t,this.Mb,this.j,null):new zN(this.kc,this.cc,this.results,this.dc,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(jE,this.kc),new Gi(xy,this.cc),new Gi(uJ,this.results),new Gi(gs,this.dc)],null),this.j))},g.O=function(n,e){return new zN(this.kc,this.cc,this.results,this.dc,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)};var KN=Jh(xk,ji);function LN(n,e,t){return Rh.c(NG.a(n),KN,Gf([e.a?e.a(0):e.call(null,0),new Q(null,1,5,R,[t],null)]))}function MN(n,e,t,r){return Rh.b(lC.a(n),(function(n){var e=DH.a(n);switch(e=dg(t,e)){case 1:return new tN(t,new Q(null,1,5,R,[r],null),null,null,null);case 0:return new tN(t,Cf.b(kJ.a(n),r),null,null,null);case-1:return n;default:throw Error(["No matching clause: ",q.a(e)].join(""))}})),A.b(t,HB.a(n))?HN(n,e,xN(function(){var e=oq.a(n),r=ZD.a(n);r=Ag?r.substring(t):zg.call(null,r,t);var i=F(ZD.a(n));return NN.K?NN.K(e,aq,r,t,i):NN.call(null,e,aq,r,t,i)}(),F(ZD.a(n)))):null}function ON(n){var e=Mf(t(n));Rh.b(n,Nf),e.o?e.o():e.call(null)}function PN(n,e){for(;;){var r=CC.a(n);if(p(t(qz.a(n))))return vf(Ru.a(t(qz.a(n))),new Mg(null,function(n){return function(){return Ph(qz.a(n),null),PN(n,!0)}}(n),null,null));if(0<F(t(r)))ON(r);else if(0<F(t(NG.a(n)))){var i=C(t(NG.a(n)));r=J(i,0,null);var o=Mf(i=J(i,1,null));o.o?o.o():o.call(null),A.b(F(i),1)?Rh.c(NG.a(n),Hf,r):Rh.A(NG.a(n),oi,new Q(null,1,5,R,[r],null),Nf)}else{if(!p(e))return null;Ph(r,t(e=pw.a(n))),Ph(e,I),Rh.b(wD.a(n),$e),e=null}}}function QN(n,e){return function(t){return HN(e,n,t)}}function RN(n,e){return function(){return HN(e,n,xN(null,n.a?n.a(0):n.call(null,0)))}}var SN=function n(e,t,r,i){return function(o){var l=null!=o&&(64&o.h||h===o.D)?fh(qk,o):o;if(o=x.b(l,Ru),l=x.b(l,DH),o=CL(e,o),B(t)){l=new Q(null,2,5,R,[l,C(t)],null);var u=D(t);o=n.A?n.A(o,u,r,i):n.call(null,o,u,r,i),o=IN(i,l,o)}else o=HN(i,r,xN(o,l));return o}},TN=function n(e,t,r,i){return function(o){var l=null!=o&&(64&o.h||h===o.D)?fh(qk,o):o;o=x.b(l,Ru),l=x.b(l,DH);var u,s=CL(e,o);return kM(t)?JN(i,new Q(null,2,5,R,[l,C(t)],null),(u=D(t),n.A?n.A(s,u,r,i):n.call(null,s,u,r,i))):B(t)?IN(i,new Q(null,2,5,R,[l,C(t)],null),function(){var e=D(t);return n.A?n.A(s,e,r,i):n.call(null,s,e,r,i)}()):HN(i,r,xN(s,l))}},UN=function n(e,t,r,i,o){return function(l){var u=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l;return l=x.b(u,Ru),u=x.b(u,DH),A.b(u,r)?0===F(e)?HN(o,i,xN(null,u)):null:(l=CL(e,l),IN(o,new Q(null,2,5,R,[u,t],null),n.K?n.K(l,t,u,i,o):n.call(null,l,t,u,i,o)),HN(o,i,xN(l,u)))}},VN=function n(e,t,r,i,o){return function(l){var u=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l;return l=x.b(u,Ru),u=x.b(u,DH),A.b(u,r)?0===F(e)?HN(o,i,xN(null,u)):null:(l=CL(e,l),A.b(u,F(ZD.a(o)))?HN(o,i,xN(l,u)):IN(o,new Q(null,2,5,R,[u,t],null),n.K?n.K(l,t,u,i,o):n.call(null,l,t,u,i,o)))}},WN=function n(e,t,r,i,o,l,u,s){return function(l){l=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l;var a=x.b(l,Ru);l=x.b(l,DH),a=CL(e,a);var c=t+1;return i<=c&&c<=o&&HN(s,u,xN(a,l)),c<o?IN(s,new Q(null,2,5,R,[l,r],null),n.Ga?n.Ga(a,c,r,i,o,l,u,s):n.call(null,a,c,r,i,o,l,u,s)):null}},XN=function n(e,t,r,i,o,l,u,s){return function(l){l=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l;var a=x.b(l,Ru);l=x.b(l,DH),a=CL(e,a);var c=t+1;return A.b(l,F(ZD.a(s)))?i<=c&&c<=o?HN(s,u,xN(a,l)):null:c<o?IN(s,new Q(null,2,5,R,[l,r],null),n.Ga?n.Ga(a,c,r,i,o,l,u,s):n.call(null,a,c,r,i,o,l,u,s)):null}};function YN(n){return function(e){return Ph(qz.a(n),e)}}function TM(e,t,r){var i=xn.a(e),o=ZD.a(r),l=F(o),u=t+F(i);return l=l<u?l:u,o=Bg?o.substring(t,l):zg.call(null,o,t,l),A.b(i,o)?HN(r,new Q(null,2,5,R,[t,e],null),xN(i,l)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,xn,DA,i],null))}function iN(e,t,r){var i=xn.a(e),o=ZD.a(r),l=F(o),u=t+F(i);return l=l<u?l:u,u=Bg?o.substring(t,l):zg.call(null,o,t,l),A.b(l,F(o))&&A.b(i,u)?HN(r,new Q(null,2,5,R,[t,e],null),xN(i,l)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,3,[X,xn,DA,i,RH,!0],null))}function UM(e,t,r){var i=xn.a(e),o=ZD.a(r),l=F(o),u=t+F(i);return l=l<u?l:u,o=Bg?o.substring(t,l):zg.call(null,o,t,l),A.b(i.toUpperCase(),o.toUpperCase())?HN(r,new Q(null,2,5,R,[t,e],null),xN(i,l)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,xn,DA,i],null))}function jN(e,t,r){var i=xn.a(e),o=ZD.a(r),l=F(o),u=t+F(i);return l=l<u?l:u,u=Bg?o.substring(t,l):zg.call(null,o,t,l),A.b(l,F(o))&&A.b(i.toUpperCase(),u.toUpperCase())?HN(r,new Q(null,2,5,R,[t,e],null),xN(i,l)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,3,[X,xn,DA,i,RH,!0],null))}function VM(e,t,r){var i=Zy.a(e),o=yJ.a(e),l=ZD.a(r);if(t>=F(l))return MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null)],null));if(65535>=o)return i<=(l=l.charCodeAt(t))&&l<=o?HN(r,new Q(null,2,5,R,[t,e],null),xN(q.a(rg(l)),t+1)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null)],null));var u=NM(l=OM(l,0|t));return i<=l&&l<=o?HN(r,new Q(null,2,5,R,[t,e],null),xN(u,t+F(u))):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null)],null))}function kN(e,t,r){var i=Zy.a(e),o=yJ.a(e),l=ZD.a(r),u=F(l);if(t>=F(l))return MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null)],null));if(65535>=o)return l=l.charCodeAt(t),A.b(t+1,u)&&i<=l&&l<=o?HN(r,new Q(null,2,5,R,[t,e],null),xN(q.a(rg(l)),u)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null)],null));var s=NM(l=OM(l,0|t));return A.b(t+F(s),u)&&i<=l&&l<=o?HN(r,new Q(null,2,5,R,[t,e],null),xN(s,u)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,3,[X,nG,DA,new n(null,3,[Au,!0,Zy,i,yJ,o],null),RH,!0],null))}function ZN(n,e){return p(p(n=new RegExp(n.source,["g",jM(n)].join("")).exec(e))?0===n.index:n)?C(n):null}function aN(e,t,r){var i=Et.a(e),o=Rv.a(r);return p(o=ZN(i,o=Ag?o.substring(t):zg.call(null,o,t)))?HN(r,new Q(null,2,5,R,[t,e],null),xN(o,t+F(o))):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,Et,DA,i],null))}function qN(e,t,r){var i=Et.a(e),o=Rv.a(r),l=Ag?o.substring(t):zg.call(null,o,t);l=ZN(i,l);var u=F(o)-t;return p(p(l)?A.b(F(l),u):l)?HN(r,new Q(null,2,5,R,[t,e],null),xN(l,F(o))):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,3,[X,Et,DA,i,RH,!0],null))}function SM(n,e,t){var r=An.a(n);return IN(t,new Q(null,2,5,R,[e,C(r)],null),SN(IL,D(r),new Q(null,2,5,R,[e,n],null),t))}function hN(n,e,t){var r=An.a(n);return IN(t,new Q(null,2,5,R,[e,C(r)],null),TN(IL,D(r),new Q(null,2,5,R,[e,n],null),t))}function YM(n,e,t){var r=wv.a(n);return IN(t,new Q(null,2,5,R,[e,r],null),UN(IL,r,e,new Q(null,2,5,R,[e,n],null),t))}function nN(n,e,t){var r=wv.a(n);return IN(t,new Q(null,2,5,R,[e,r],null),VN(IL,r,e,new Q(null,2,5,R,[e,n],null),t))}function ZM(n,e,t){var r=wv.a(n),i=qx.a(n),o=bw.a(n);return 0===i?(HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e)),1<=o?IN(t,new Q(null,2,5,R,[e,r],null),WN(IL,0,r,1,o,e,new Q(null,2,5,R,[e,n],null),t)):null):IN(t,new Q(null,2,5,R,[e,r],null),WN(IL,0,r,i,o,e,new Q(null,2,5,R,[e,n],null),t))}function oN(n,e,t){var r=wv.a(n),i=qx.a(n),o=bw.a(n);return 0===i?(HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e)),1<=o?IN(t,new Q(null,2,5,R,[e,r],null),XN(IL,0,r,1,o,e,new Q(null,2,5,R,[e,n],null),t)):null):IN(t,new Q(null,2,5,R,[e,r],null),XN(IL,0,r,i,o,e,new Q(null,2,5,R,[e,n],null),t))}function $M(n,e,t){var r=wv.a(n);return IN(t,new Q(null,2,5,R,[e,r],null),UN(IL,r,e,new Q(null,2,5,R,[e,n],null),t)),HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e))}function pN(n,e,t){var r=wv.a(n);return A.b(e,F(ZD.a(t)))?HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e)):IN(t,new Q(null,2,5,R,[e,r],null),VN(IL,r,e,new Q(null,2,5,R,[e,n],null),t))}function RM(n,e,t){var r=An.a(n);r=B(r);for(var i=null,o=0,l=0;;)if(l<o){var u=i.W(null,l);IN(t,new Q(null,2,5,R,[e,u],null),QN(new Q(null,2,5,R,[e,n],null),t)),l+=1}else{if(!(r=B(r)))return null;Wf(i=r)?(r=re(i),o=se(i),i=r,u=F(r),r=o,o=u):(u=C(i),IN(t,new Q(null,2,5,R,[e,u],null),QN(new Q(null,2,5,R,[e,n],null),t)),r=D(i),i=null,o=0),l=0}}function gN(n,e,t){var r=An.a(n);r=B(r);for(var i=null,o=0,l=0;;)if(l<o){var u=i.W(null,l);JN(t,new Q(null,2,5,R,[e,u],null),QN(new Q(null,2,5,R,[e,n],null),t)),l+=1}else{if(!(r=B(r)))return null;Wf(i=r)?(r=re(i),o=se(i),i=r,u=F(r),r=o,o=u):(u=C(i),JN(t,new Q(null,2,5,R,[e,u],null),QN(new Q(null,2,5,R,[e,n],null),t)),r=D(i),i=null,o=0),l=0}}function dN(n,e,t){var r=Xn.a(n),i=Vn.a(n);r=new Q(null,2,5,R,[e,r],null);var o=new Q(null,2,5,R,[e,i],null),l=QN(new Q(null,2,5,R,[e,n],null),t);return IN(t,r,l),LN(t,r,(function(){return IN(t,o,l)}))}function sN(n,e,t){var r=Xn.a(n),i=Vn.a(n);r=new Q(null,2,5,R,[e,r],null);var o=new Q(null,2,5,R,[e,i],null),l=QN(new Q(null,2,5,R,[e,n],null),t);return JN(t,r,l),LN(t,r,(function(){return JN(t,o,l)}))}function XM(n,e,t){var r=wv.a(n);return IN(t,new Q(null,2,5,R,[e,r],null),QN(new Q(null,2,5,R,[e,n],null),t)),HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e))}function mN(e,t,r){var i=wv.a(e);return JN(r,new Q(null,2,5,R,[t,i],null),QN(new Q(null,2,5,R,[t,e],null),r)),A.b(t,F(ZD.a(r)))?HN(r,new Q(null,2,5,R,[t,e],null),xN(null,t)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,Mp,DA,no],null))}function QM(n,e,t){var r=wo.a(t),i=FJ.a(n);return r=x.c(r,i,i),IN(t,new Q(null,2,5,R,[e,r],null),QN(new Q(null,2,5,R,[e,n],null),t))}function fN(n,e,t){var r=wo.a(t),i=FJ.a(n);return r=x.c(r,i,i),JN(t,new Q(null,2,5,R,[e,r],null),QN(new Q(null,2,5,R,[e,n],null),t))}function bN(n,e,t){var r=wv.a(n);return IN(t,new Q(null,2,5,R,[e,r],null),RN(new Q(null,2,5,R,[e,n],null),t))}function rN(e,t,r){return A.b(t,F(ZD.a(r)))?bN(e,t,r):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,Jv,DA,no],null))}function cN(e,t,r){var i,o=wv.a(e),l=new Q(null,2,5,R,[t,o],null);return p(EN(r,l))?MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,1,[X,uA],null)):(IN(r,l,(i=new xl((function(){return MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,uA,DA,new n(null,1,[iJ,WL(o,!1)],null)],null))})),function(){return Bl(i)})),LN(r,l,(function(){return Tc(EN(r,l))?HN(r,new Q(null,2,5,R,[t,e],null),xN(null,t)):null})))}function WM(n,e,t){return HN(t,new Q(null,2,5,R,[e,n],null),xN(null,e))}function lN(e,t,r){return A.b(t,F(ZD.a(r)))?HN(r,new Q(null,2,5,R,[t,e],null),xN(null,t)):MN(r,new Q(null,2,5,R,[t,e],null),t,new n(null,2,[X,Ps,DA,no],null))}function $N(n,e,t){p(t)?IN(n,new Q(null,2,5,R,[0,e],null),YN(n)):JN(n,new Q(null,2,5,R,[0,e],null),YN(n))}function aO(e,r,i,o){if($N(e=wN(e,i,i,-1,null),DM(r),o),p(r=PN(e,null)))i=C(r);else{r=t(lC.a(e));n:{o=DH.a(r);for(var l=e=1,u=0;;){if(A.b(o,u)){o=new n(null,2,[en,e,ux,l],null);break n}A.b("\n",x.b(i,u))?(u+=1,e+=1,l=1):(u+=1,l+=1)}}i=wk.g(G([r,o,new n(null,1,[ZD,eM(en.a(o),i)],null)]))}return i}function NN(e,t,r,i,o){return Kf(e.b?e.b(t,r):e.call(null,t,r),new n(null,2,[Yv,i,hp,o],null))}function bO(n,e){return(null!=n?262144&n.h||h===n.He||!n.h&&Xc(Od,n):Xc(Od,n))?Kf(n,wk.g(G([e,Lf(n)]))):n}var cO=function n(e,t){var r=X.a(t);return p(r=e.a?e.a(r):e.call(null,r))?bO(fh(r,Wh.b(Jh(n,e),sE.a(t))),Lf(t)):p(X.a(t))?K.c(t,sE,Wh.b(Jh(n,e),sE.a(t))):t},dO=function n(e,t){if(Tf(t)&&B(t)){var r=C(t);return p(r=e.a?e.a(r):e.call(null,r))?bO(fh(r,Wh.b(Jh(n,e),D(t))),Lf(t)):Kf(ji.b(new Q(null,1,5,R,[C(t)],null),Wh.b(Jh(n,e),D(t))),Lf(t))}return t},eO=function n(e,t){return"string"==typeof t?t:p(!!M(t)&&X.a(t))?cO(e,t):Vf(t)&&C(t)instanceof z?dO(e,t):Tf(t)?Kf(Wh.b(Jh(n,e),t),Lf(t)):t instanceof tN?t:iM(G(["Invalid parse-tree, not recognized as either enlive or hiccup format."]))};function fO(n,e,t){if(Cg(t)){var r=fh(O,Wh.b(n,t));return e.a?e.a(r):e.call(null,r)}return Oi(t)?(r=new Gi((i=Dd(t),n.a?n.a(i):n.call(null,i)),function(){var e=Ed(t);return n.a?n.a(e):n.call(null,e)}()),e.a?e.a(r):e.call(null,r)):$f(t)?(r=Vk(Wh.b(n,t)),e.a?e.a(r):e.call(null,r)):Uf(t)?(r=gd.c((function(e,t){return Cf.b(e,n.a?n.a(t):n.call(null,t))}),t,t),e.a?e.a(r):e.call(null,r)):Qf(t)?(r=ji.b(Ef(t),Wh.b(n,t)),e.a?e.a(r):e.call(null,r)):e.a?e.a(t):e.call(null,t);var i}var gO=function n(e,t){return fO(Jh(n,e),e,t)};function hO(n){function e(n){var e=J(n,0,null);return n=J(n,1,null),new Q(null,2,5,R,"string"==typeof e?[Kg.a(e),n]:[e,n],null)}return gO((function(n){return M(n)?ji.b(S,Wh.b(e,n)):n}),n)}function iO(n){return null==n?null:rg(n)}function jO(n,e,t,r,i){this.vc=n,this.form=e,this.Mb=t,this.j=r,this.B=i,this.h=2230716170,this.I=139264}function kO(n,e){return new jO(e,n,null,null,null)}g=jO.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"splicing?":return this.vc;case"form":return this.form;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.tools.reader.impl.utils.ReaderConditional{",", ","}",t,Xg.b(new Q(null,2,5,R,[new Q(null,2,5,R,[TI,this.vc],null),new Q(null,2,5,R,[Dr,this.form],null)],null),this.j))},g.ua=function(){return new gj(this,2,new Q(null,2,5,R,[TI,Dr],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 2+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-209062840^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.vc,e.vc)&&A.b(this.form,e.form)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,2,[TI,null,Dr,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new jO(this.vc,this.form,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(TI,e):P.call(null,TI,e))?new jO(t,this.form,this.Mb,this.j,null):p(P.b?P.b(Dr,e):P.call(null,Dr,e))?new jO(this.vc,t,this.Mb,this.j,null):new jO(this.vc,this.form,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,2,5,R,[new Gi(TI,this.vc),new Gi(Dr,this.form)],null),this.j))},g.O=function(n,e){return new jO(this.vc,this.form,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g.ma=h,g.S=function(n,e,t){return ce(e,["#?",p(this.vc)?"@":null].join("")),hl(this.form,e,t)};var lO=/[\s]/;function mO(n){return null==n?null:","===n||lO.test(n)}function nO(n){return null==n?null:!/[^0-9]/.test(n)}function oO(e){return e instanceof z?Gf([e,!0]):e instanceof w||"string"==typeof e?new n(null,1,[X,e],null):e}var pO=Oh(0);function qO(n,e){return function e(t){return new Mg(null,(function(){for(;;){var r=B(t);if(r){if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);return function(){for(var e=0;;){if(!(e<o))return!0;var t=qd(i,e),r=l;if(t instanceof w||t instanceof z){var u=Uk(Ig,Lg)(t),s=J(u,0,null);u=J(u,1,null);var a=t instanceof w?Me:Kg;t=null==s?a.b?a.b(n,u):a.call(null,n,u):A.b("_",s)?a.a?a.a(u):a.call(null,u):t}r.add(t),e+=1}}()?Sg(Ug(l),e(se(r))):Sg(Ug(l),null)}var u=C(r);return vf(u instanceof w||u instanceof z?function(){var e=Uk(Ig,Lg)(u),t=J(e,0,null);e=J(e,1,null);var r=u instanceof w?Me:Kg;return null==t?r.b?r.b(n,e):r.call(null,n,e):A.b("_",t)?r.a?r.a(e):r.call(null,e):u}():u,e(Re(r)))}return null}}),null,null)}(e)}function rO(n){var e=J(n,0,null);return n=J(n,1,null),p(e)?null:n}function sO(n,e){return n=parseInt(n,e),p(isNaN(n))?-1:n}function tO(n){if(null!=n&&null!=n.xa)n=n.xa(n);else{var e=tO[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=tO._))throw Zc("Reader.read-char",n);n=e.a?e.a(n):e.call(null,n)}}return n}function uO(n){if(null!=n&&null!=n.Dc)n=n.Dc(n);else{var e=uO[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=uO._))throw Zc("Reader.peek-char",n);n=e.a?e.a(n):e.call(null,n)}}return n}function vO(n,e){if(null!=n&&null!=n.Fd)n.Fd(n,e);else{var t=vO[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=vO._))throw Zc("IPushbackReader.unread",n);t.b?t.b(n,e):t.call(null,n,e)}}}function wO(n){if(null!=n&&null!=n.Hd)n=n.Hd(n);else{var e=wO[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=wO._))throw Zc("IndexingReader.get-line-number",n);n=e.a?e.a(n):e.call(null,n)}}return n}function xO(n){if(null!=n&&null!=n.Gd)n=n.Gd(n);else{var e=xO[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=xO._))throw Zc("IndexingReader.get-column-number",n);n=e.a?e.a(n):e.call(null,n)}}return n}function yO(n){if(null!=n&&null!=n.Me)n=n.Me(n);else{var e=yO[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=yO._))throw Zc("IndexingReader.get-file-name",n);n=e.a?e.a(n):e.call(null,n)}}return n}function zO(n,e){this.ha=n,this.Qf=e,this.sd=0}function AO(n,e){this.Nf=n,this.ca=e,this.Vb=this.xe=1}function BO(n){return null!=n&&h===n.Yh}function CO(n){n=new zO(n,F(n));n:{var e=Array(1);if($f(null))for(var t=0,r=B(null);;){if(!(r&&1>t))break n;e[t]=C(r),t+=1,r=D(r)}else for(t=0;1>t;)e[t]=null,t+=1}return new AO(n,e)}function DO(n,e,t,r){var i=F(e);return n=p(n)?0:10<i?10:i,e=Wh.b(Jh(EO,!0),Xh.b(n,e)),e=fh(q,di(" ",e)),i=n<i?"...":null,[q.a(t),q.a(e),i,q.a(r)].join("")}zO.prototype.xa=function(){if(this.Qf>this.sd){var n=this.ha.charAt(this.sd);return this.sd+=1,n}return null},zO.prototype.Dc=function(){return this.Qf>this.sd?this.ha.charAt(this.sd):null},AO.prototype.xa=function(){var n=this.Vb<this.xe?this.ca[this.Vb]:this.Nf.xa(null);return this.Vb<this.xe&&(this.Vb+=1),iO(n)},AO.prototype.Dc=function(){return iO(this.Vb<this.xe?this.ca[this.Vb]:this.Nf.Dc(null))},AO.prototype.Fd=function(n,e){if(p(e)){if(0===this.Vb)throw Error("Pushback buffer is full");return--this.Vb,this.ca[this.Vb]=e}return null};var EO,uS=Oh(S),vS=Oh(S),wS=Oh(S),xS=Oh(S),yS=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));function KO(e,t,r){t=new n(null,2,[U,fr,FC,t],null),e=BO(e)?K.g(t,OD,yO(e),G([en,wO(e),sq,xO(e)])):t;var i=OD.a(e);t=en.a(e);var o=sq.a(e);throw i=p(i)?[q.a(i)," "].join(""):null,t=p(t)?["[line ",q.a(t),", col ",q.a(o),"]"].join(""):null,im(r=ih(q,i,t,p(p(i)?i:t)?" ":null,r),e)}function LO(n,e){return KO(n,Ip,G([fh(q,e)]))}function MO(n,e){return KO(n,gA,G([fh(q,e)]))}function NO(n,e){return KO(n,gv,G([fh(q,e)]))}function OO(n,e,t,r,i){return NO(n,G(["Unexpected EOF while reading ",p(i)?["item ",q.a(i)," of "].join(""):null,Lg(e),p(t)?[", starting at line ",q.a(t)," and column ",q.a(r)].join(""):null,"."]))}function PO(n,e,t,r){LO(n,G(["The map literal starting with ",EO.b(!1,C(r)),p(e)?[" on line ",q.a(e)," column ",q.a(t)].join(""):null," contains ",F(r)," form(s). Map literals must contain an even number of forms."]))}function QO(n){throw MO(null,G(["Invalid unicode literal: \\",n,"."]))}function RO(n,e){return LO(n,G(["Invalid unicode escape: \\u",e,"."]))}function SO(n,e,t){return LO(n,G(["Invalid ",Lg(e),": ",t,"."]))}function TO(n,e){return NO(n,G(["Unexpected EOF while reading start of ",Lg(e),"."]))}function UO(n,e,t){return LO(n,G(["Invalid character: ",t," found while reading ",Lg(e),"."]))}function VO(n){return NO(n,G(["Unexpected EOF while reading dispatch character."]))}function WO(n,e,t){n:{var r=e instanceof z?e.da:null;switch(r){case"regex":r='#"';break n;case"string":r='"';break n;default:throw Error(["No matching clause: ",q.a(r)].join(""))}}return NO(n,G(["Unexpected EOF reading ",Lg(e)," starting ",gh(q,r,t),"."]))}function XO(n,e){return MO(null,G(["Invalid digit ",n," in unicode character \\",e,"."]))}function YO(n,e){return MO(n,G(["Invalid digit ",e," in unicode character."]))}function ZO(n,e,t){return MO(n,G(["Invalid unicode literal. Unicode literals should be ",t,"characters long.  ","value suppled is ",e,"characters long."]))}function $O(n,e){return LO(n,G(["Invalid character literal \\u",e,"."]))}function aP(n,e){return LO(n,G(["Invalid octal escape sequence in a character literal:",e,". Octal escape sequences must be 3 or fewer digits."]))}function bP(n){return LO(n,G(["Octal escape sequence must be in range [0, 377]."]))}function cP(n){return NO(n,G(["Unexpected EOF while reading character."]))}function dP(n,e){return LO(n,G(["Unsupported escape character: \\",e,"."]))}function eP(n){return LO(n,G(["A single colon is not a valid keyword."]))}function fP(n,e){LO(n,G(["Metadata cannot be ",EO.b(!1,e),". Metadata must be a Symbol, Keyword, String or Map."]))}function gP(n,e){return LO(n,G(["Metadata can not be applied to ",EO.b(!1,e),". ","Metadata can only be applied to IMetas."]))}function hP(n,e){return LO(n,G(["Namespaced map with namespace ",e," does not specify a map."]))}function iP(n,e){return LO(n,G(["Invalid value used as namespace in namespaced map: ",e,"."]))}function jP(n,e){LO(n,G(["Invalid reader tag: ",EO.b(!1,e),". Reader tags must be symbols."]))}function kP(n,e){return LO(n,G(["No reader function for tag ",EO.b(!1,e),"."]))}function lP(n,e){return e=function n(e){return new Mg(null,(function(){for(var t=e;;){if(!(t=B(t)))return null;if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l),s=J(u,0,null);1<J(u,1,null)&&o.add(s),l+=1}return Sg(Ug(o),r?n(se(t)):null)}if(r=J(o=C(t),0,null),1<J(o,1,null))return vf(r,n(Re(t)));t=Re(t)}}),null,null)}(Tk(e)),ih(q,n,1<F(e)?"s":null,": ",di(", ",e))}function mP(n,e,t){return e=Lg(e),LO(n,G([lP([String(e.charAt(0)).toUpperCase()+String(e.substr(1)).toLowerCase()," literal contains duplicate key"].join(""),t)]))}function nP(n,e){return p(e)?NO(n,G(["EOF while reading, starting at line ",e,"."])):NO(n,G(["EOF while reading."]))}function oP(n){for(var e=n.xa(null);;){if(!(mO.a?mO.a(e):mO.call(null,e)))return e;e=n.xa(null)}}EO=new dm(Me.b("cljs.tools.reader.impl.inspect","inspect*"),(function(n,e){return null==e?$C:"string"==typeof e?xn:e instanceof z||"number"==typeof e||e instanceof w?ru:Vf(e)?Uu:Cg(e)?JI:M(e)?Tv:Rf(e)?yA:A.b(e,!0)||A.b(e,!1)?ru:Yc(e)}),yS,uS,vS,wS,xS),EO.v(null,xn,(function(n,e){n=p(n)?5:20;var t=e.length>n?'..."':'"',r=e.length;return['"',q.a(e.substring(0,n<r?n:r)),t].join("")})),EO.v(null,ru,(function(n,e){return q.a(e)})),EO.v(null,Qe,(function(){return"<indexed seq>"})),EO.v(null,kj,(function(){return"<map seq>"})),EO.v(null,Pj,(function(){return"<map seq>"})),EO.v(null,Fg,(function(){return"<cons>"})),EO.v(null,Mg,(function(){return"<lazy seq>"})),EO.v(null,$C,(function(){return"nil"})),EO.v(null,JI,(function(n,e){return DO(n,e,"(",")")})),EO.v(null,Tv,(function(n,e){var t=F(e),r=p(n)?0:t;return DO(n,e=fh(Xg,Xh.b(r,e)),"{",t>r?"...}":"}")})),EO.v(null,yA,(function(n,e){return DO(n,e,"#{","}")})),EO.v(null,Uu,(function(n,e){return DO(n,e,"[","]")})),EO.v(null,em,(function(n,e){return ol.g(G([Yc(e)]))}));var pP=/^([-+]?)(?:(0)|([1-9][0-9]*)|0[xX]([0-9A-Fa-f]+)|0([0-7]+)|([1-9][0-9]?)[rR]([0-9A-Za-z]+)|0[0-9]+)(N)?$/,qP=/([-+]?[0-9]+)\/([0-9]+)/,rP=/([-+]?[0-9]+(\.[0-9]*)?([eE][-+]?[0-9]+)?)(M)?/;function sP(n,e){return J(n=Xk(n,e),0,null)===e}function tP(n){if(sP(pP,n)){var e=Ni(Xk(pP,n));if(null!=(e.a?e.a(2):e.call(null,2)))n=0;else{n="-"===(e.a?e.a(1):e.call(null,1));var t=(e=null!=(e.a?e.a(3):e.call(null,3))?new Q(null,2,5,R,[e.a?e.a(3):e.call(null,3),10],null):null!=(e.a?e.a(4):e.call(null,4))?new Q(null,2,5,R,[e.a?e.a(4):e.call(null,4),16],null):null!=(e.a?e.a(5):e.call(null,5))?new Q(null,2,5,R,[e.a?e.a(5):e.call(null,5),8],null):null!=(e.a?e.a(7):e.call(null,7))?new Q(null,2,5,R,[e.a?e.a(7):e.call(null,7),parseInt(e.a?e.a(6):e.call(null,6))],null):new Q(null,2,5,R,[null,null],null)).a?e.a(0):e.call(null,0);null==t?n=null:(e=parseInt(t,e.a?e.a(1):e.call(null,1)),n=n?-1*e:e,n=p(isNaN(n))?null:n)}}else sP(rP,n)?n=null!=((e=Ni(Xk(rP,n))).a?e.a(4):e.call(null,4))?parseFloat(e.a?e.a(1):e.call(null,1)):parseFloat(n):sP(qP,n)?(n=(e=Ni(Xk(qP,n))).a?e.a(1):e.call(null,1),e=e.a?e.a(2):e.call(null,2),n=p(Xk(/^\+/,n))?n.substring(1):n,n=parseInt(n)/parseInt(e)):n=null;return n}function uP(n){if(""===n||!0===/:$/.test(n)||!0===/^::/.test(n))return null;var e=n.indexOf("/"),t=0<e?n.substring(0,e):null;return null!=t?(e+=1)===F(n)||nO(pf(n=n.substring(e),0))||""===n||!1!==/:$/.test(t)||"/"!==n&&-1!==n.indexOf("/")?null:new Q(null,2,5,R,[t,n],null):"/"===n||-1===n.indexOf("/")?new Q(null,2,5,R,[null,n],null):null}var vP=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],1<t.length?new Qe(t.slice(1),0,null):null)};function wP(n){return function(){function e(n,e){var r=null;if(1<arguments.length){r=0;for(var i=Array(arguments.length-1);r<i.length;)i[r]=arguments[r+1],++r;r=new Qe(i,0,null)}return t.call(this,n,r)}function t(e){return LO(e,G([n]))}return e.F=1,e.G=function(n){var e=C(n);return n=Re(n),t(e)},e.g=t,e}()}function xP(n){switch(n){case'"':case";":case"@":case"^":case"`":case"~":case"(":case")":case"[":case"]":case"{":case"}":case"\\":return!0;default:return!1}}vP.g=function(n){for(;;){var e=n.xa(null);if("\n"===e||"\n"===e||null==e)break}return n},vP.F=1,vP.G=function(n){var e=C(n);return n=D(n),this.g(e,n)};var yP=new zc;function zP(n,e,t){if(null==t)return TO(n,e);for(yP.clear(),e=t;;){if(mO(e)||xP(e)||null==e)return null!=e&&n.Fd(null,e),yP.toString();yP.append(e),e=n.xa(null)}}function AP(n,e,t,r){if(p(e=n.xa(null))){var i=BP.a?BP.a(e):BP.call(null,e);return p(i)?i.A?i.A(n,e,t,r):i.call(null,n,e,t,r):(n.Fd(null,e),CP.A?CP.A(n,e,t,r):CP.call(null,n,e,t,r))}return VO(n)}function DP(n,e){return LO(n,G(["Unmatched delimiter ",e,"."]))}function EP(n){for(var e=new zc,t=n.xa(null);;){if('"'===t)return Zk(q.a(e));if(null==t)return WO(n,Fx,G([e]));e.append(t),"\\"===t&&(null==(t=n.xa(null))&&WO(n,Fx,G([e])),e.append(t)),t=n.xa(null)}}function FP(n,e,t){e=1+e,F(n)!==e&&QO(n);for(var r=1,i=0;;){if(r===e)return String.fromCharCode(i);var o=sO(pf(n,r),t);if(-1===o)return XO(pf(n,r),n);i=o+i*t,r+=1}}function GP(n,e,t,r,i){for(var o=1,l=sO(e,t);;){if(-1===l)return YO(n,e);if(o===r)return String.fromCharCode(l);var u=n.Dc(null),s=mO(u);if(s||(s=p(s=HP.a?HP.a(u):HP.call(null,u))?s:null==u),p(s))return p(i)?ZO(n,o,r):String.fromCharCode(l);if(s=sO(u,t),n.xa(null),-1===s)return YO(n,u);l=s+l*t,o+=1}}function IP(n){var e=n.xa(null);if(null!=e){var t=(e=xP(e)||mO(e)?q.a(e):zP(n,PF,e)).length;return 1===t?e.charAt(0):A.b(e,"newline")?"\n":A.b(e,"space")?" ":A.b(e,"tab")?"\t":A.b(e,"backspace")?"\b":A.b(e,"formfeed")?"\f":A.b(e,"return")?"\r":p(0==e.lastIndexOf("u",0))?55295<(t=(e=FP(e,4,16)).charCodeAt(0))&&57344>t?$O(n,t.toString(16)):e:p(0==e.lastIndexOf("o",0))?3<--t?aP(n,e):(t=FP(e,t,8),255>=parseInt(e.substring(1),8)?t:bP(n)):LO(n,G(["Unsupported character: ",e,"."]))}return cP(n)}function JP(n){return BO(n)?new Q(null,2,5,R,[n.Hd(null),n.Gd(null)-1|0],null):null}function KP(n){return BO(n)?new Q(null,2,5,R,[n.Hd(null),n.Gd(null)],null):null}var LP={},MP={},NP=!1;function OP(n,e,t,r,i){var o=NP;NP=!0;try{n:for(var l=JP(t),u=J(l,0,null),s=J(l,1,null),a=iO(e),c=je(I);;){var d=PP?PP(t,!1,LP,a,r,i):QP.call(null,t,!1,LP,a,r,i);if(d===MP){var h=le(c);break n}if(d===LP){h=OO(t,n,u,s,F(c));break n}c=Yg.b(c,d)}return h}finally{NP=o}}function RP(e,t,r,i){var o=JP(e);t=J(o,0,null),o=J(o,1,null),r=OP(JI,")",e,r,i);var l,u=KP(e);return i=J(u,0,null),u=J(u,1,null),Kf(Pf(r)?Se:fh(O,r),p(t)?wk.g(G([(l=yO(e),p(l)?new n(null,1,[OD,l],null):null),new n(null,4,[en,t,ux,o,fz,i,ho,u],null)])):null)}function SP(e,t,r,i){var o=JP(e);t=J(o,0,null),o=J(o,1,null),r=OP(Uu,"]",e,r,i);var l,u=KP(e);return i=J(u,0,null),u=J(u,1,null),Kf(r,p(t)?wk.g(G([(l=yO(e),p(l)?new n(null,1,[OD,l],null):null),new n(null,4,[en,t,ux,o,fz,i,ho,u],null)])):null)}function TP(e,t,r,i){var o=JP(e);t=J(o,0,null),o=J(o,1,null),i=F(r=OP(Tv,"}",e,r,i));var l,u=Sk(2,r),s=Fk(u),a=KP(e),c=J(a,0,null);return a=J(a,1,null),!Fh(i)&&PO(e,t,o,r),A.b(F(s),F(u))||mP(e,Tv,u),Kf(i<=2*pj?rj(hg(r)):Wj(hg(r)),p(t)?wk.g(G([(l=yO(e),p(l)?new n(null,1,[OD,l],null):null),new n(null,4,[en,t,ux,o,fz,c,ho,a],null)])):null)}function UP(n,e){for(var t=(l=void 0,(l=new zc).append(e),l),r=n.xa(null);;){if(p(function(){var n=mO(r);return n||(p(n=HP.a?HP.a(r):HP.call(null,r))?n:null==r)}())){var i=q.a(t);n.Fd(null,r);var o=tP(i);return p(o)?o:LO(n,G(["Invalid number: ",i,"."]))}i=function(){var n=t;return n.append(r),n}(),o=n.xa(null),t=i,r=o}var l}function VP(n){var e=n.xa(null);switch(e){case"t":return"\t";case"r":return"\r";case"n":return"\n";case"\\":return"\\";case'"':return'"';case"b":return"\b";case"f":return"\f";case"u":return e=n.xa(null),-1===parseInt(0|e,16)?RO(n,e):GP(n,e,16,4,!0);default:return nO(e)?255<(0|(e=GP(n,e,8,3,!1)))?bP(n):e:dP(n,e)}}function WP(n){for(var e=new zc,t=n.xa(null);;){if(null==t)return WO(n,xn,G(['"',e]));switch(t){case"\\":var r=(o=void 0,(o=e).append(VP(n)),o),i=n.xa(null);e=r,t=i;continue;case'"':return q.a(e);default:r=function(){var n=e;return n.append(t),n}(),i=n.xa(null),e=r,t=i}}var o}function XP(e,t,r){if(null==t)return null;var i=yO(e);i=null==i?null:new n(null,1,[OD,i],null);var o=KP(e);return e=J(o,0,null),o=J(o,1,null),wk.g(G([i,new n(null,4,[en,t,ux,r,fz,e,ho,o],null)]))}function YP(n,e){var t=JP(n),r=J(t,0,null);if(t=J(t,1,null),null==(e=zP(n,xu,e)))return null;switch(e){case"nil":return null;case"true":return!0;case"false":return!1;case"/":return dA;default:var i=uP(e);return null!=i?Me.b(i.W(null,0),i.W(null,1)).O(null,XP(n,r,t)):SO(n,xu,e)}}function ZP(n){var e=n.xa(null);if(mO(e))return eP(n);var t=uP(e=zP(n,FJ,e));if(null!=t){var r=t.W(null,0);return t=t.W(null,1),":"===e.charAt(0)?null!=r?p(r=x.b(null,Me.a(r.substring(1))))?Kg.b(q.a(r),t):SO(n,FJ,[":",q.a(e)].join("")):p(r=null)?Kg.b(q.a(r),t.substring(1)):LO(n,G(["Invalid token: :",e])):Kg.b(r,t)}return SO(n,FJ,[":",q.a(e)].join(""))}function $P(n){return function(e,t,r,i){return new Df(null,n,new Df(null,aQ?aQ(e,!0,null,r,i):QP.call(null,e,!0,null,r,i),null,1,null),2,null)}}function bQ(n,e,t,r){var i=JP(n);e=J(i,0,null),i=J(i,1,null);var o=oO(aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r));return M(o)||fP(n,o),null!=(t=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r))&&(131072&t.h||h===t.xd)?(n=p(p(e)?$f(t):e)?K.g(o,en,e,G([ux,i])):o,null!=t&&(262144&t.h||h===t.He)?Kf(t,wk.g(G([Lf(t),n]))):t.H=n):gP(n,t)}function cQ(e,t,r,i){var o=JP(e);t=J(o,0,null),o=p(o=J(o,1,null))?o-1|0:null,i=Fk(r=OP(yA,"}",e,r,i));var l,u=KP(e),s=J(u,0,null);return u=J(u,1,null),A.b(F(r),F(i))||LO(e,G([mP(e,yA,r)])),Kf(i,p(t)?wk.g(G([(l=yO(e),p(l)?new n(null,1,[OD,l],null):null),new n(null,4,[en,t,ux,o,fz,s,ho,u],null)])):null)}function dQ(n,e,t,r){return aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r),n}function eQ(n,e,t,r){return e=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r),A.b(iy,e)?Number.NaN:A.b(QC,e)?Number.NEGATIVE_INFINITY:A.b(Rw,e)?Number.POSITIVE_INFINITY:LO(n,G([["Invalid token: ##",q.a(e)].join("")]))}var fQ=new Bk(null,new n(null,2,[ks,null,Ep,null],null),null);function gQ(n,e,t,r){var i=hQ;hQ=!0;try{var o=PP?PP(e,!1,LP,")",t,r):QP.call(null,e,!1,LP,")",t,r);return o===LP&&nP(e,0>n&&n),o===MP?MP:null}finally{hQ=i}}var iQ={};function jQ(n,e,t,r){var i=BO(n)?wO(n):-1;n:for(var o=iQ,l=null;;)if(o===iQ){o=i,l=n;var u=t,s=r,a=PP?PP(l,!1,LP,")",u,s):QP.call(null,l,!1,LP,")",u,s);if(a===LP&&nP(l,0>o&&o),A.b(a,MP))o=MP;else{var c=l,d=a;p(x.b(fQ,d))&&LO(c,G(["Feature name ",d," is reserved"])),c=l,d=u,(a instanceof z?A.b(em,a)||N(x.b(d,it),a):LO(c,G(["Feature should be a keyword: ",a])))?((u=PP?PP(l,!1,LP,")",u,s):QP.call(null,l,!1,LP,")",u,s))===LP&&nP(l,0>o&&o),u===MP&&LO(l,G(0>o?["read-cond requires an even number of forms"]:["read-cond starting on line ",o," requires an even number of forms"])),o=u):o=p(o=gQ(o,l,u,s))?o:iQ}if(o===MP){t=MP;break n}l=null}else{if(l===MP){t=o;break n}l=gQ(i,n,t,r)}return t===MP?n:p(e)?null!=t&&(16777216&t.h||h===t.Ee)?(e=hg(t),qb(Mb,r,0,0).apply(null,e),n):LO(n,G(["Spliced form list in read-cond-splicing must implement ISequential"])):t}function kQ(e,t,r,i){if(Tc(function(){if(p(r)){var e=Gx.a(r),t=new Bk(null,new n(null,2,[hB,null,jz,null],null),null);return t.a?t.a(e):t.call(null,e)}return r}()))throw im("Conditional read not allowed",new n(null,1,[U,Vx],null));var o=e.xa(null);if(!p(o))return cP(e);if(o=(t=A.b(o,"@"))?e.xa(null):o,t&&(p(NP)||LO(e,G(["cond-splice not in list"]))),!p(o=mO(o)?oP(e):o))return cP(e);if(kh.b(o,"("))throw im("read-cond body must be a list",new n(null,1,[U,Vx],null));var l,u=hQ;hQ=p(l=hQ)?l:A.b(hB,Gx.a(r));try{return p(hQ)?kO(RP(e,o,r,i),t):jQ(e,t,r,i)}finally{hQ=u}}var lQ=null;function mQ(n){return Me.a([-1===n?"rest":["p",q.a(n)].join(""),"__",q.a(Rh.b(pO,$e)),"#"].join(""))}function nQ(e,t,r,i){if(p(lQ))throw im("Nested #()s are not allowed",new n(null,1,[U,oB],null));t=lQ,lQ=sk();try{vO(e,"(");var o=aQ?aQ(e,!0,null,r,i):QP.call(null,e,!0,null,r,i),l=be(lQ),u=l?(s=Dd(C(l)),a=function(){for(var n=1,e=je(I);;){if(n>s)return le(e);var t=n+1;e=Yg.b(e,(r=void 0,p(r=x.b(lQ,n))?r:mQ(n))),n=t}var r}(),p(lQ.call(null,-1))?Cf.g(a,nm,G([lQ.call(null,-1)])):a):I;return new Df(null,Cm,new Df(null,u,new Df(null,o,null,1,null),2,null),3,null)}finally{lQ=t}var s,a}function oQ(e){if(p(lQ)){var t=lQ.call(null,e);return p(t)||(t=mQ(e),lQ=K.c(lQ,e,t)),t}throw im("Arg literal not in #()",new n(null,1,[U,oB],null))}function pQ(e,t,r,i){if(null==lQ)return YP(e,t);if(mO(t=e.Dc(null))||xP(t)||null==t)return oQ(1);if(A.b(t,"&"))return e.xa(null),oQ(-1);if(bg(e=aQ?aQ(e,!0,null,r,i):QP.call(null,e,!0,null,r,i)))return oQ(e);throw im("Arg literal must be %, %& or %integer",new n(null,1,[U,oB],null))}var qQ=null;function rQ(n,e,t,r){return p(e=n.Dc(null))?A.b("@",e)?(e=$P(RD),n.xa(null),n=e(n,"@",t,r)):n=$P(Zu)(n,"~",t,r):n=null,n}function sQ(n){return $f(n)&&A.b(C(n),RD)}function tQ(n){return $f(n)&&A.b(C(n),Zu)}function uQ(n){n=B(n);for(var e=je(I);;){if(!n)return B(le(e));var t=C(n);n=D(n),e=Yg.b(Yg.b(e,Dd(t)),Ed(t))}}function vQ(e){if(Tc(qQ))throw im("Gensym literal not in syntax-quote",new n(null,1,[U,oB],null));var t=x.b(qQ,e);return p(t)||(t=Me.a([Bg(Lg(e),0,Lg(e).length-1),"__",q.a(Rh.b(pO,$e)),"__auto__"].join("")),qQ=K.c(qQ,e,t)),t}function wQ(n,e){return null!=n&&(262144&n.h||h===n.He)&&B(Hf.g(Lf(n),en,G([ux,fz,ho,OD,lz])))&&(n=Lf(n),n=xQ.a?xQ.a(n):xQ.call(null,n),e=new Df(null,zx,new Df(null,e,new Df(null,n,null,1,null),2,null),3,null)),e}function yQ(n,e){n:{e=B(e);for(var t=je(I);;){if(!e){e=B(le(t));break n}var r=C(e);t=Yg.b(t,tQ(r)?new Df(null,IG,new Df(null,zf(r),null,1,null),2,null):sQ(r)?zf(r):new Df(null,IG,new Df(null,xQ.a?xQ.a(r):xQ.call(null,r),null,1,null),2,null)),e=D(e)}}return e=new Df(null,sx,new Df(null,vf(gt,e),null,1,null),2,null),p(n)?new Df(null,uG,new Df(null,n,new Df(null,e,null,1,null),2,null),3,null):e}function zQ(e){throw im("resolve-symbol is not implemented",new n(null,1,[mJ,e],null))}function xQ(e){if(mm(e))var t=new Df(null,Hm,new Df(null,e,null,1,null),2,null);else if(e instanceof w)t=new Df(null,Hm,new Df(null,p(!!Tc(Ig(e))&&dc(Lg(e),"#"))?vQ(e):p(dc(r=q.a(e),"."))?(r=Me.a(r.substring(0,r.length-1)),Me.a([q.a(zQ.call(null,r)),"."].join(""))):zQ.call(null,e),null,1,null),2,null);else if(tQ(e))t=zf(e);else{if(sQ(e))throw im("unquote-splice not in list",new n(null,1,[U,oB],null));if(Qf(e))if(null!=e&&(67108864&e.h||h===e.kg))t=e;else if(M(e))t=yQ(16<=F(e)?uy:lE,uQ(e));else if(Vf(e))t=new Df(null,ft,new Df(null,yQ(null,e),null,1,null),2,null);else if(Rf(e))t=yQ(oI,e);else{if(!$f(e)&&!Cg(e))throw im("Unknown Collection type",new n(null,1,[U,jy],null));t=function(){var n=B(e);return n?yQ(null,n):O(bC)}()}else t=e instanceof z||"number"==typeof e||"string"==typeof e||null==e||e instanceof Boolean||!0===e||!1===e||e instanceof RegExp?e:new Df(null,Hm,new Df(null,e,null,1,null),2,null)}var r;return wQ(e,t)}function AQ(n,e,t,r){e=qQ,qQ=S;try{return xQ(aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r))}finally{qQ=e}}function BQ(n,e,r,i){var o,l=zP(n,VE,tO(n));return e=A.b(l,":")?null.name:A.b(":",C(l))?function(){var n=null==l?null:l.substring(1);if(null==(n=null==(n=null==(n=null==n?null:uP(n))?null:rO(n))?null:Me.a(n)))n=null;else{var e=x.b(null,n);if(p(e))n=e;else{if(null==Sm&&(Sm=Oh(S)),null!=(e=x.b(t(Sm),n)))n=e;else{e=q.a(n);for(var r=q.a(e),i=new zc,o=0;o<r.length;){var u=r.charAt(o),s=Vb(bd,u);null!=s?i.append(s):i.append(u),o+=1}r=".."===(r=i.toString())?"_DOT__DOT_":p(Om(r))?[r,"$"].join(""):r;n:for(e=(e instanceof w?Me.a(r):r).split("."),r=cb;;){if(null==r){e=null;break n}if(null==e){e=r;break n}r=Vb(r,C(e)),e=D(e)}null==e?n=null:(e=new Rm(n),Rh.A(Sm,K,n,e),n=e)}n=p(n)?Me.a(n.name):null}}return n}():null==(o=null==l?null:uP(l))?null:rO(o),p(e)?"{"===oP(n)?(!Fh(F(r=OP(VE,"}",n,r,i)))&&PO(n,null,null,r),i=qO(q.a(e),Sk(2,r)),r=Sk(2,Re(r)),A.b(F(Fk(i)),F(i))||mP(n,VE,i),Ik(i,r)):hP(n,l):iP(n,l)}function HP(n){switch(n){case'"':return WP;case":":return ZP;case";":return vP;case"'":return $P(Hm);case"@":return $P(Xq);case"^":return bQ;case"`":return AQ;case"~":return rQ;case"(":return RP;case")":return DP;case"[":return SP;case"]":return DP;case"{":return TP;case"}":return DP;case"\\":return IP;case"%":return pQ;case"#":return AP;default:return null}}function BP(n){switch(n){case"^":return bQ;case"'":return $P(Gm);case"(":return nQ;case"{":return cQ;case"<":return wP("Unreadable form");case"=":return wP("read-eval not supported");case'"':return EP;case"!":return vP;case"_":return dQ;case"?":return kQ;case":":return BQ;case"#":return eQ;default:return null}}function CP(n,e,t,r){if((e=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r))instanceof w||jP(n,e),p(hQ))return new Lm(e,n=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r));var i=S.call(null,e);return i=p(i)?i:S.a?S.a(e):S.call(null,e),p(i)?(e=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r),i.a?i.a(e):i.call(null,e)):p(CQ)?(i=CQ,n=aQ?aQ(n,!0,null,t,r):QP.call(null,n,!0,null,t,r),i.b?i.b(e,n):i.call(null,e,n)):kP(n,e)}var CQ=null,hQ=!1;function QP(n){switch(arguments.length){case 5:return aQ(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return PP(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function aQ(n,e,t,r,i){return PP(n,e,t,null,r,i)}function PP(e,t,r,i,o,l){try{n:for(;;){if(0!=l.length){var u=l[0];Array.prototype.splice.call(l,0,1),a=u;break n}var s=e.xa(null);if(!mO(s)){if(null==s){var a=t?nP(e,null):r;break n}if(s===i){a=MP;break n}if(nO(s)||("+"===s||"-"===s)&&nO(e.Dc(null))){a=UP(e,s);break n}var c=HP(s);if(null==c){a=YP(e,s);break n}var d=c.A?c.A(e,s,o,l):c.call(null,e,s,o,l);if(d!==e){a=d;break n}}}return a}catch(i){if(i instanceof Error){if((t=i)instanceof hm){if(r=km(t),A.b(fr,U.a(r)))throw t;throw jm(t.message,wk.g(G([new n(null,1,[U,fr],null),r,BO(e)?new n(null,3,[en,e.Hd(null),ux,e.Gd(null),OD,e.Me(null)],null):null])),t)}throw jm(t.message,wk.g(G([new n(null,1,[U,fr],null),BO(e)?new n(null,3,[en,e.Hd(null),ux,e.Gd(null),OD,e.Me(null)],null):null])),t)}throw i}}var DQ=em;function EQ(n,e){var t=DQ;if(A.b(!0,t))return AM(n);if(A.b(!1,t))return zM(n);if(A.b(em,t))return p(e)?AM(n):zM(n);throw Error(["No matching clause: ",q.a(t)].join(""))}var FQ=Zk(/'[^'\\]*(?:\\.[^'\\]*)*'/),GQ=Zk(/#'[^'\\]*(?:\\.[^'\\]*)*'/),HQ=Zk(/"[^"\\]*(?:\\.[^"\\]*)*"/),IQ=Zk(/#"[^"\\]*(?:\\.[^"\\]*)*"/),JQ=/(?:(?!(?:\(\*|\*\)))[\s\S])*/,KQ=Zk("[,\\s]*"),LQ=GM(DM(sA)),MQ=qM(DC,Xj([tC,oF,AJ,EA,xC,qA,kA,Ay,xt,Ux,XC,xn,MF,ls,gI,$u,Et,zn,Nv,eq,zA,sA,CI,jJ],[yM.g(G([GM(zM("!")),LQ,DM(zn)])),tM(yM.g(G([LQ,wM.g(G([DM(zn),DM(qA),DM(tC)])),LQ]))),yM.g(G([DM(oF),tM(yM.g(G([LQ,GM(zM("/")),LQ,DM(oF)])))])),wM.g(G([zM(":"),zM(":="),zM("::="),zM("=")])),yM.g(G([DM(oF),uM(yM.g(G([LQ,GM(zM("|")),LQ,DM(oF)])))])),yM.g(G([GM(zM("&")),LQ,DM(zn)])),yM.g(G([wM.g(G([DM(Ay),DM(xt)])),LQ,GM(DM(EA)),LQ,DM($u),GM(wM.g(G([DM(sA),yM.g(G([DM(sA),wM.g(G([zM(";"),zM(".")])),DM(sA)]))])))])),yM.g(G([FM(DM(zA)),CM(Zk("[^, \\r\\t\\n<>(){}\\[\\]+*?:=|'\"#&!;./]+"))])),yM.g(G([GM(zM("<")),LQ,DM(Ay),LQ,GM(zM(">"))])),yM.g(G([CM(JQ),uM(yM.g(G([DM(Nv),CM(JQ)])))])),wM.g(G([yM.g(G([GM(zM("{")),LQ,DM($u),LQ,GM(zM("}"))])),yM.g(G([DM(zn),LQ,GM(zM("*"))]))])),wM.g(G([CM(FQ),CM(HQ)])),lM(yM.g(G([LQ,tM(DM(kA))]))),yM.g(G([GM(zM("<")),LQ,DM($u),LQ,GM(zM(">"))])),yM.g(G([GM(zM("(")),LQ,DM($u),LQ,GM(zM(")"))])),lM(wM.g(G([DM(xC),DM(AJ)]))),wM.g(G([CM(GQ),CM(IQ)])),lM(wM.g(G([DM(Ay),DM(xn),DM(Et),DM(jJ),DM(XC),DM(eq),DM(gI),DM(ls),DM(zA)]))),yM.g(G([zM("(*"),DM(Ux),zM("*)")])),yM.g(G([DM(zn),LQ,GM(zM("+"))])),wM.g(G([zM("Epsilon"),zM("epsilon"),zM("EPSILON"),zM("eps"),zM("")])),yM.g(G([CM(KQ),uM(yM.g(G([DM(Nv),CM(KQ)])))])),lM(wM.g(G([DM(MF),DM($u)]))),wM.g(G([yM.g(G([GM(zM("[")),LQ,DM($u),LQ,GM(zM("]"))])),yM.g(G([DM(zn),LQ,GM(zM("?"))]))]))]));function NQ(n){for(var e=B(n),t=I;;){var r=C(e);if(!p(r))return fh(q,t);switch(r){case"\\":var i=zf(e);if(p(i)){A.b(i,"'")?(e=Yh(2,e),t=Cf.b(t,i)):(e=Yh(2,e),t=Cf.g(t,r,G([i])));continue}return hM(G(["Encountered backslash character at end of string: ",n]));case'"':e=D(e),t=Cf.g(t,"\\",G(['"']));continue;default:e=D(e),t=Cf.b(t,r)}}}var $W=t(new Ne((function(){return WP}),It,Xj([Jn,By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[!0,FB,as,"cljs/tools/reader.cljs",20,1,305,305,O(new Q(null,4,5,R,[Kf(kx,new n(null,1,[X,Zm],null)),Gp,nx,qF],null)),null,p(WP)?WP.ld:null])));function PQ(n){return n=NQ(n=Bg(n,1,F(n)-1)),n=CO(n=[q.a(n),'"'].join("")),$W.A?$W.A(n,null,null,null):$W.call(null,n,null,null,null)}function QQ(n){return Zk(n=NQ(n=Bg(n,2,F(n)-1)))}var RQ=function n(e){for(;;){var t=C.a?C.a(e):C.call(null,e);switch(t=t instanceof z?t.da:null){case"rule":var r=J(t=D.a?D.a(e):D.call(null,e),0,null);return t=J(t,1,null),A.b(C.a?C.a(r):C.call(null,r),xt)?new Q(null,2,5,R,[Kg.a((i=void 0,i=Af.a?Af.a(r):Af.call(null,r),Af.a?Af.a(i):Af.call(null,i))),lM(n.a?n.a(t):n.call(null,t))],null):new Q(null,2,5,R,[Kg.a(Af.a?Af.a(r):Af.call(null,r)),n.a?n.a(t):n.call(null,t)],null);case"nt":return DM(Kg.a(Af.a?Af.a(e):Af.call(null,e)));case"alt":return fh(wM,Wh.b(n,D.a?D.a(e):D.call(null,e)));case"ord":return fh(xM,Wh.b(n,D.a?D.a(e):D.call(null,e)));case"paren":e=Af.a?Af.a(e):Af.call(null,e);continue;case"hide":return GM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"cat":return fh(yM,Wh.b(n,D.a?D.a(e):D.call(null,e)));case"string":return EQ(PQ(Af.a?Af.a(e):Af.call(null,e)),!1);case"regexp":return CM(QQ(Af.a?Af.a(e):Af.call(null,e)));case"opt":return sM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"star":return uM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"plus":return tM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"look":return EM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"neg":return FM(function(){var t=Af.a?Af.a(e):Af.call(null,e);return n.a?n.a(t):n.call(null,t)}());case"epsilon":return rM;default:throw Error(["No matching clause: ",q.a(t)].join(""))}}var i},SQ=function n(e){for(;;){var t=X.a(e);switch(t=t instanceof z?t.da:null){case"nt":return new Q(null,1,5,R,[FJ.a(e)],null);case"string":case"string-ci":case"char":case"regexp":case"epsilon":return I;case"opt":case"plus":case"star":case"look":case"neg":case"rep":e=wv.a(e);continue;case"alt":case"cat":return ei(n,G([An.a(e)]));case"ord":return ei(n,G([new Q(null,2,5,R,[Xn.a(e),Vn.a(e)],null)]));default:throw Error(["No matching clause: ",q.a(t)].join(""))}}};function TQ(n){for(var e=Fk(mj(n)),t=B(Gk(ei(SQ,G([nj(n)])))),r=null,i=0,o=0;;)if(o<i){var l=r.W(null,o);p(e.a?e.a(l):e.call(null,l))||hM(G([Ag(q.a(l),1)," occurs on the right-hand side of your grammar, but not on the left"])),o+=1}else{if(!(t=B(t)))break;Wf(r=t)?(t=re(r),o=se(r),r=t,i=F(t),t=o):(t=C(r),p(e.a?e.a(t):e.call(null,t))||hM(G([Ag(q.a(t),1)," occurs on the right-hand side of your grammar, but not on the left"])),t=D(r),r=null,i=0),o=0}return n}function UQ(e,t){var r=aO(MQ,MF,e,!1);if(r instanceof tN)return hM(G(["Error parsing grammar specification:\n",function(){var n=new zc,e=Fc,t=Ec;Fc=!0,Ec=function(e){return n.append(e)};try{sl(G([r]))}finally{Ec=t,Fc=e}return q.a(n)}()]));var i=C(C(e=Wh.b(RQ,r)));return new n(null,3,[wo,TQ(qM(t,ji.b(S,e))),iz,i,SH,t],null)}function VQ(e,t,r){return null==r?iM(G(["When you build a parser from a map of parser combinators, you must provide a start production using the :start keyword argument."])):new n(null,3,[wo,TQ(qM(t,e)),iz,r,SH,t],null)}function WQ(n,e){var t=Array.prototype.slice.call(arguments),r=t.shift();if(void 0===r)throw Error("[goog.string.format] Template required");return r.replace(/%([0\- \+]*)(\d+)?(\.(\d+))?([%sfdiu])/g,(function(n,e,r,i,o,l,u,s){if("%"==l)return"%";var a=t.shift();if(void 0===a)throw Error("[goog.string.format] Not enough arguments");return arguments[0]=a,WQ.Fc[l].apply(null,arguments)}))}WQ.Fc={},WQ.Fc.s=function(n,e,t){return isNaN(t)||""==t||n.length>=Number(t)?n:n=-1<e.indexOf("-",0)?n+yc(" ",Number(t)-n.length):yc(" ",Number(t)-n.length)+n},WQ.Fc.f=function(n,e,t,r,i){r=n.toString(),isNaN(i)||""==i||(r=parseFloat(n).toFixed(i));var o=0>Number(n)?"-":0<=e.indexOf("+")?"+":0<=e.indexOf(" ")?" ":"";return 0<=Number(n)&&(r=o+r),isNaN(t)||r.length>=Number(t)||(r=isNaN(i)?Math.abs(Number(n)).toString():Math.abs(Number(n)).toFixed(i),n=Number(t)-r.length-o.length,0<=e.indexOf("-",0)?r=o+r+yc(" ",n):(e=0<=e.indexOf("0",0)?"0":" ",r=o+yc(e,n)+r)),r},WQ.Fc.d=function(n,e,t,r,i,o,l,u){return WQ.Fc.f(parseInt(n,10),e,t,r,0,o,l,u)},WQ.Fc.i=WQ.Fc.d,WQ.Fc.u=WQ.Fc.d;var XQ=Xj([OH,Iq,Sr,ME,zw,Ty,lG,zJ,Nw,nI,XG,Ar,BJ,jn,pv,VG],[zM("\r\n"),zM("\t"),wM.g(G([wM.g(G([zM(" "),zM("\t")])),uM(yM.g(G([zM("\r\n"),wM.g(G([zM(" "),zM("\t")]))])))])),zM("\n"),CM("[\\u0021-\\u007E]"),CM("[0-9]"),zM(" "),CM("[0-9a-fA-F]"),CM("[\\u0000-\\u001F|\\u007F]"),zM('"'),wM.g(G([zM(" "),zM("\t")])),zM("\r"),CM("[\\u0000-\\u00FF]"),CM("[a-zA-Z]"),CM("[\\u0001-\\u007F]"),CM("[01]")]),YQ=Xj([tC,KG,Jw,$x,rH,kw,qA,aB,kA,YE,Ty,LE,Cv,wz,ls,Vy,zJ,pp,Rx,Ct,nD,Ur,Yt,Bz,Et,hC,Vv,vB,sA,fn,AB,ID,CI],[new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"!"],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,rH],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,tC],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"("],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,sA],null),new Df(null,new n(null,2,[X,xn,xn,")"],null),null,1,null),2,null),ls,!0],null),null,1,null),2,null),3,null),Hu,new n(null,1,[ny,Pt],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"<"],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Vv],null),new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,sA],null),new Df(null,new n(null,2,[X,xn,xn,">"],null),null,1,null),2,null),ls,!0],null),null,1,null),2,null),3,null),Hu,new n(null,1,[ny,Pt],null)],null),wk.g(G([CM("\\s+(?:;.*?\\u000D?\\u000A\\s*)*"),new n(null,1,[Hu,new n(null,2,[ny,DC,NI,$x],null)],null)])),new n(null,3,[X,xC,An,new Df(null,new n(null,2,[X,Ay,FJ,YE],null),new Df(null,new n(null,2,[X,Ay,FJ,KG],null),new Df(null,new n(null,2,[X,Ay,FJ,ls],null),new Df(null,new n(null,2,[X,Ay,FJ,pp],null),new Df(null,new n(null,2,[X,Ay,FJ,Cv],null),new Df(null,new n(null,2,[X,Ay,FJ,wz],null),new Df(null,new n(null,2,[X,Ay,FJ,qA],null),new Df(null,new n(null,2,[X,Ay,FJ,tC],null),new Df(null,new n(null,2,[X,Ay,FJ,Et],null),null,1,null),2,null),3,null),4,null),5,null),6,null),7,null),8,null),9,null),Hu,new n(null,1,[ny,Pt],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,Jw],null),new Df(null,new n(null,3,[X,Ay,FJ,Vy,ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),null,1,null),2,null),3,null),4,null),Hu,new n(null,2,[ny,DC,NI,kw],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"&"],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,rH],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,qA],null)],null),new n(null,3,[X,eq,wv,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,xn,xn,"0"],null),new Df(null,new n(null,2,[X,xn,xn,"1"],null),null,1,null),2,null)],null),Hu,new n(null,2,[ny,DC,NI,aB],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,Vv],null),new Df(null,new n(null,3,[X,Ay,FJ,Vy,ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),null,1,null),2,null),3,null),4,null),Hu,new n(null,2,[ny,DC,NI,kA],null)],null),new n(null,3,[X,Ay,FJ,Ct,Hu,new n(null,2,[ny,DC,NI,YE],null)],null),wk.g(G([CM("[0-9]"),new n(null,1,[Hu,new n(null,1,[ny,Pt],null)],null)])),new n(null,3,[X,eq,wv,new n(null,2,[X,Ay,FJ,Ty],null),Hu,new n(null,2,[ny,DC,NI,LE],null)],null),new n(null,3,[X,xC,An,new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,'"',ls,!0],null),new Df(null,new n(null,2,[X,XC,wv,wk.g(G([CM("[\\u0020-\\u0021\\u0023-\\u007E]"),S]))],null),new Df(null,new n(null,3,[X,xn,xn,'"',ls,!0],null),null,1,null),2,null),3,null)],null),new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,"'",ls,!0],null),new Df(null,new n(null,2,[X,XC,wv,wk.g(G([CM("[\\u0020-\\u0026(-~]"),S]))],null),new Df(null,new n(null,3,[X,xn,xn,"'",ls,!0],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,Cv],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,"%",ls,!0],null),new Df(null,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,Ay,FJ,nD],null),new Df(null,new n(null,2,[X,Ay,FJ,Ur],null),new Df(null,new n(null,2,[X,Ay,FJ,AB],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Hu,new n(null,1,[ny,Pt],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"<"],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,sA],null),new Df(null,new n(null,2,[X,xn,xn,">"],null),null,1,null),2,null),ls,!0],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,ls],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),new Df(null,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,xn,xn,"="],null),new Df(null,new n(null,2,[X,xn,xn,"=/"],null),null,1,null),2,null)],null),new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,Vy],null)],null),wk.g(G([CM("[0-9a-fA-F]"),new n(null,1,[Hu,new n(null,1,[ny,Pt],null)],null)])),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"["],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,sA],null),new Df(null,new n(null,2,[X,xn,xn,"]"],null),null,1,null),2,null),ls,!0],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,pp],null)],null),new n(null,3,[X,eq,wv,new n(null,2,[X,Ay,FJ,zJ],null),Hu,new n(null,2,[ny,DC,NI,Rx],null)],null),wk.g(G([CM("[a-zA-Z][-a-zA-Z0-9]*"),new n(null,1,[Hu,new n(null,1,[ny,Pt],null)],null)])),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,"b",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,aB],null),new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,eq,wv,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,".",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,aB],null),null,1,null),2,null)],null)],null),new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"-"],null),new Df(null,new n(null,2,[X,Ay,FJ,aB],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,nD],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,"d",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,ID],null),new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,eq,wv,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,".",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,ID],null),null,1,null),2,null)],null)],null),new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"-"],null),new Df(null,new n(null,2,[X,Ay,FJ,ID],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,Ur],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,hC],null),new Df(null,new n(null,2,[X,XC,wv,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,Ay,FJ,$x,ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,hC],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,Yt],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,Yt],null),new Df(null,new n(null,2,[X,XC,wv,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,Ay,FJ,sA],null),new Df(null,new n(null,2,[X,xn,xn,"/"],null),new Df(null,new n(null,2,[X,Ay,FJ,sA],null),null,1,null),2,null),3,null),ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Yt],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,Bz],null)],null),new n(null,3,[X,xC,An,new Df(null,wk.g(G([CM("#'[^'\\\\]*(?:\\\\.[^'\\\\]*)*'"),S])),new Df(null,wk.g(G([CM('#\\"[^\\"\\\\]*(?:\\\\.[^\\"\\\\]*)*\\"'),S])),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,Et],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,Ay,FJ,fn],null)],null),new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,rH],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,hC],null)],null),new n(null,3,[X,Ay,FJ,Ct,Hu,new n(null,2,[ny,DC,NI,Vv],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,Ay,FJ,sA,ls,!0],null),new Df(null,new n(null,2,[X,eq,wv,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,Ay,FJ,kA],null),new Df(null,new n(null,2,[X,Ay,FJ,kw],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Hu,new n(null,1,[ny,Pt],null)],null),wk.g(G([CM("\\s*(?:;.*?(?:\\u000D?\\u000A\\s*|$))*"),new n(null,1,[Hu,new n(null,2,[ny,DC,NI,sA],null)],null)])),new n(null,3,[X,xC,An,new Df(null,new n(null,2,[X,Ay,FJ,LE],null),new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,Ay,FJ,LE],null)],null),new Df(null,new n(null,2,[X,xn,xn,"*"],null),new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,Ay,FJ,LE],null)],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Hu,new n(null,2,[ny,DC,NI,fn],null)],null),new n(null,3,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,"x",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Rx],null),new Df(null,new n(null,2,[X,jJ,wv,new n(null,2,[X,xC,An,new Df(null,new n(null,2,[X,eq,wv,new n(null,2,[X,oF,An,new Df(null,new n(null,3,[X,xn,xn,".",ls,!0],null),new Df(null,new n(null,2,[X,Ay,FJ,Rx],null),null,1,null),2,null)],null)],null),new Df(null,new n(null,2,[X,oF,An,new Df(null,new n(null,2,[X,xn,xn,"-"],null),new Df(null,new n(null,2,[X,Ay,FJ,Rx],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Hu,new n(null,2,[ny,DC,NI,AB],null)],null),new n(null,3,[X,eq,wv,new n(null,2,[X,Ay,FJ,Ty],null),Hu,new n(null,2,[ny,DC,NI,ID],null)],null),new n(null,3,[X,xC,An,new Df(null,new n(null,2,[X,Ay,FJ,vB],null),new Df(null,new n(null,2,[X,Ay,FJ,Bz],null),null,1,null),2,null),Hu,new n(null,1,[ny,Pt],null)],null)]),ZQ=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function $Q(n,e){return ji.b(S,function e(t){return new Mg(null,(function(){for(var r=t;;){if(!(r=B(r)))return null;if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u);N(n,s)&&(s=new Q(null,2,5,R,[s,n.a?n.a(s):n.call(null,s)],null),l.add(s)),u+=1}return Sg(Ug(l),i?e(se(r)):null)}if(l=C(r),N(n,l))return vf(new Q(null,2,5,R,[l,n.a?n.a(l):n.call(null,l)],null),e(Re(r)));r=Re(r)}}),null,null)}(e))}function aR(n){return wk.g(G([$Q(XQ,Gk(ei(SQ,G([nj(n)])))),n]))}function bR(n,e){var t=A.b(Hu.a(n),mM),r=A.b(Hu.a(e),mM);return t&&r?lM(wM.g(G([Hf.b(n,Hu),Hf.b(e,Hu)]))):t?lM(wM.g(G([Hf.b(n,Hu),e]))):r?lM(wM.g(G([n,Hf.b(e,Hu)]))):wM.g(G([n,e]))}ZQ.g=function(n){if(A.b("-",zf(n))){var e=J(n,0,null);return J(n,1,null),BM(e,J(n,2,null))}return fh(yM,function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l);o.add(BM(u,u)),l+=1}return Sg(Ug(o),r?n(se(t)):null)}return vf(BM(o=C(t),o),n(Re(t)))}return null}}),null,null)}(n))},ZQ.F=0,ZQ.G=function(n){return this.g(B(n))};var cR=parseInt,dR=Xj([tC,kw,qA,aB,kA,YE,LE,Cv,ls,pp,Rx,nD,Ur,Yt,Bz,Et,hC,Vv,fn,AB,ID],[FM,function(n,e){return Gf([n,lM(e)])},EM,function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return cR(fh(q,n),2)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),qk,function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return p(!1)?DM(Kg.a(fh(q,n).toUpperCase())):DM(Kg.a(fh(q,n)))}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return cR(fh(q,n))}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return EQ(fh(q,n),!0)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),GM,sM,function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return cR(fh(q,n),16)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),ZQ,ZQ,yM,wM,Ih.b(CM,QQ),function(){function n(n,e){return Pf(n)?uM(e):A.b(F(n),2)?vM(vn.a(n),cq.a(n),e):A.b(vn.a(n),1)?tM(e):A.b(cq.a(n),1)?sM(e):vM(p(t=vn.a(n))?t:0,function(){var e=cq.a(n);return p(e)?e:1/0}(),e);var t}var e;return(e=function(e,t){switch(arguments.length){case 1:return e;case 2:return n.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)}).a=function(n){return n},e.b=n,e}(),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return p(!1)?Kg.a(fh(q,n).toUpperCase()):Kg.a(fh(q,n))}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}(),function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){var t=F(e);switch(t){case 1:return A.b(C(e),"*")?S:new n(null,2,[vn,C(e),cq,C(e)],null);case 2:return A.b(C(e),"*")?new n(null,1,[cq,zf(e)],null):new n(null,1,[vn,C(e)],null);case 3:return new n(null,2,[vn,C(e),cq,pf(e,2)],null);default:throw Error(["No matching clause: ",q.a(t)].join(""))}}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}(),ZQ,function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return cR(fh(q,n))}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}()]);function eR(e,t){var r=aO(YQ,vB,e,!1);if(r instanceof tN)return hM(G(["Error parsing grammar specification:\n",function(){var n=new zc,e=Fc,t=Ec;Fc=!0,Ec=function(e){return n.append(e)};try{sl(G([r]))}finally{Ec=t,Fc=e}return q.a(n)}()]));var i=eO(dR,r);return e=aR(gh(xk,bR,i)),i=C(C(C(i))),new n(null,3,[wo,TQ(qM(t,e)),iz,i,SH,t],null)}function fR(n){var e=Lf(n);return n=Yv.a(e),e=hp.a(e),p(p(n)?e:n)?new Q(null,2,5,R,[n,e],null):null}function gR(n){return Vf(n)&&A.b(F(n),1)||M(n)&&N(n,X)&&Pf(x.b(n,sE))||Pf(n)}var hR=new tN(null,null,null,null,null),iR=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function jR(n,e,t,r,i){return IN(n=wN(n,t,r,-1,null),new Q(null,2,5,R,[i,e],null),YN(n)),PN(n,null)}function kR(n,e,t,r,i,o){var l=F(t);for(o=B(o);;){if(!o)return null;var u=C(o),s=fR(u);if(J(s,0,null),s=p(s=J(s,1,null))?s:i+F(u),A.b(s,l))return new Q(null,3,5,R,[u,s,null],null);var a=B(jR(n,e,t,r,s));if(a)return new Q(null,3,5,R,[u,s,a],null);o=D(o)}}function lR(e,t,r,i,o){var l=F(r),u=jR(e,t,r,i,o),s=kR(e,t,r,i,o=sg(o),u);for(J(s,0,null),J(s,1,null),J(s,2,null),u=o,o=IL;;){var a=s,c=J(a,0,null);s=J(a,1,null);var d=J(a,2,null);if(null==a||A.b(u,s))return hR;if(null==d)return GN(CL(o,c),new n(null,3,[oG,nz,Yv,0,hp,l],null));u=sg(s),o=CL(o,c),s=kR(e,t,r,i,s,d)}}function mR(e,t,r,i,o){if(A.b(r,DC))n:{r=F(o);var l=jR(e,t,o,o,0),u=sg(0),s=KL(new Q(null,1,5,R,[i],null));for(J(l=kR(e,t,o,o,u,l),0,null),J(l,1,null),J(l,2,null),i=u,u=s,s=l;;){var a=s,c=J(a,0,null);if(s=J(a,1,null),l=J(a,2,null),null==a||A.b(i,s)){e=hR;break n}if(null==l){e=GN(OL(CL(u,c)),new n(null,3,[oG,nz,Yv,0,hp,r],null));break n}i=sg(s),u=CL(u,c),s=kR(e,t,o,o,s,l)}}else if(A.b(r,FA))n:for(r=F(o),s=jR(e,t,o,o,0),u=sg(0),l=kR(e,t,o,o,u,s),J(l,0,null),J(l,1,null),J(l,2,null),s=IL;;){var d=l;if(a=J(d,0,null),l=J(d,1,null),c=J(d,2,null),null==d||A.b(u,l)){e=hR;break n}if(null==c){e=GN(new n(null,2,[X,i,sE,B(CL(s,a))],null),new n(null,3,[oG,nz,Yv,0,hp,r],null));break n}u=sg(l),s=CL(s,a),l=kR(e,t,o,o,l,c)}else e=null;return e}function nR(e,t,r,i,o,l){var u=F(l),s=jR(e,t,l,l,0),a=Pf(s);if(p(t=a||ls.a(t)))return hR;if(s=gh(Jk,iR,s),t=iR.a(s),e=lR(e,wv.a(r),l,l,t),u=new n(null,3,[oG,nz,Yv,0,hp,u],null),e instanceof tN||A.b(X.a(r),XC)&&gR(e))return hR;switch(i instanceof z?i.da:null){case"enlive":return GN(new n(null,2,[X,o,sE,CL(IL.Qc(null,s),e)],null),u);case"hiccup":return GN(OL(CL(KL(new Q(null,1,5,R,[o],null)).Qc(null,s),e)),u);default:return GN(CL(IL.Qc(null,s),e),u)}}function oR(e,t,r,i,o){var l=An.a(i),u=Bf(l);if(A.b(X.a(i),oF)){var s=X.a(u),a=new Bk(null,new n(null,2,[XC,null,eq,null],null),null);s=p(s=a.a?a.a(s):a.call(null,s))?Tc(ls.a(u))&&Tc(ls.a(wv.a(u))):s}else s=!1;return Tc(s)?hR:(l=fh(yM,Hk(l)),A.b(Hu.a(i),mM)?nR(e,l,u,null,r,t):nR(e,l,u,o,r,t))}function pR(n,e,t){var r=wo.a(n);n=SH.a(n);var i=x.b(r,t);return A.b(ls.a(i),!0)?hR:A.b(Hu.a(i),mM)?A.b(X.a(i),XC)?lR(r,t=wv.a(i),e,e,0):A.b(X.a(i),eq)?gR(e=lR(r,t=wv.a(i),e,e,0))?hR:e:oR(r,e,t,i,n):A.b(X.a(i),XC)?mR(r,wv.a(i),n,t,e):A.b(X.a(i),eq)?gR(e=mR(r,wv.a(i),n,t,e))?hR:e:oR(r,e,t,i,n)}function qR(n,e){if(A.b(null,e))return n;if(A.b(sE,e))return K.c(n,wo,IM(wo.a(n)));if(A.b(tF,e))return K.c(n,wo,JM(SH.a(n),wo.a(n)));if(A.b(yC,e))return K.c(n,wo,KM(SH.a(n),wo.a(n)));throw Error(["No matching clause: ",q.a(e)].join(""))}iR.a=function(n){var e=fR(n);return J(e,0,null),p(e=J(e,1,null))?sg(e):F(n)},iR.b=function(n,e){var t=fR(n);return J(t,0,null),p(t=J(t,1,null))?sg(t):e+F(n)},iR.F=2;var rR=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],2<t.length?new Qe(t.slice(2),0,null):null)};function tR(n,e,t,r,i,o){this.qa=n,this.oc=e,this.sc=t,this.Mb=r,this.j=i,this.B=o,this.h=2230716171,this.I=139264}function uR(n){var e=Hf.g(n,wo,G([iz,SH]));return e=Uf(n)?ji.b(S,e):e,new tR(wo.a(n),iz.a(n),SH.a(n),null,lh(e),null)}function vR(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return wR(arguments[0],1<e.length?new Qe(e.slice(1),0,null):null)}function wR(n,e){var t,r=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,i=x.c(r,vJ,cB),o=x.c(r,SH,DC),l=x.c(r,sz,null);e="string"==typeof n?function(){n:{var e=DQ;DQ=zC.b(r,em);try{var t=i instanceof z?i.da:null;switch(t){case"abnf":var u=eR(n,o);break n;case"ebnf":u=UQ(n,o);break n;default:throw Error(["No matching clause: ",q.a(t)].join(""))}}finally{DQ=e}u=void 0}return p(l)?uR(K.c(u,iz,l)):uR(u)}():M(n)?uR(VQ(n,o,l)):Vf(n)?(t=p(l)?l:n.a?n.a(0):n.call(null,0),uR(t=VQ(fh(qk,n),o,t))):iM(G(["Expected string, map, or vector as grammar specification, got ",ol.g(G([n]))]));var u=x.b(r,Co);if(p(u=u instanceof z?x.b(xR,u):u)){var s=null!=u&&(64&u.h||h===u.D)?fh(qk,u):u;return u=x.b(s,wo),s=x.b(s,iz),K.c(e,wo,MM(e.qa,e.oc,u,s))}return e}function sR(n){return n instanceof uN||Lf(n)instanceof uN}rR.g=function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.c(r,sz,iz.a(n));var i=x.c(r,$q,!1),o=x.c(r,oG,!1),l=x.b(r,Gt);return x.c(r,mu,!1),n=qR(n,l),p(xr.a(r))?(o=wo.a(n),n=SH.a(n),r=oM.a?oM.a(n):oM.call(null,n),(n=aO(o,t,e,i))instanceof tN?($N(o=wN(o,e,e,l=DH.a(n),r),DM(t),i),p(i=PN(o,null))?e=C(i):(i=NN(r,aq,e,0,F(e)),e=NN(r,t,i,0,F(e))),e=Kf(e,wk.g(G([n,Lf(e)])))):e=n,e):p(p(o)?Tc(i):o)?(r=pR(n,e,t),p(sR.a?sR.a(r):sR.call(null,r))?aO(wo.a(n),t,e,i):r):aO(wo.a(n),t,e,i)},rR.F=2,rR.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)},g=tR.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"grammar":return this.qa;case"start-production":return this.oc;case"output-format":return this.sc;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#instaparse.core.Parser{",", ","}",t,Xg.b(new Q(null,3,5,R,[new Q(null,2,5,R,[wo,this.qa],null),new Q(null,2,5,R,[iz,this.oc],null),new Q(null,2,5,R,[SH,this.sc],null)],null),this.j))},g.ua=function(){return new gj(this,3,new Q(null,3,5,R,[wo,iz,SH],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 3+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-360509877^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.qa,e.qa)&&A.b(this.oc,e.oc)&&A.b(this.sc,e.sc)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,3,[iz,null,wo,null,SH,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new tR(this.qa,this.oc,this.sc,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(wo,e):P.call(null,wo,e))?new tR(t,this.oc,this.sc,this.Mb,this.j,null):p(P.b?P.b(iz,e):P.call(null,iz,e))?new tR(this.qa,t,this.sc,this.Mb,this.j,null):p(P.b?P.b(SH,e):P.call(null,SH,e))?new tR(this.qa,this.oc,t,this.Mb,this.j,null):new tR(this.qa,this.oc,this.sc,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,3,5,R,[new Gi(wo,this.qa),new Gi(iz,this.oc),new Gi(SH,this.sc)],null),this.j))},g.O=function(n,e){return new tR(this.qa,this.oc,this.sc,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g.call=function(){function n(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$){return jh(rR,this,e,t,r,G([i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$]))}function e(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){return rR.g(this,e,G([t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v]))}function t(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v){return rR.g(this,e,G([t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v]))}function r(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g){return rR.g(this,e,G([t,r,i,o,l,u,s,a,c,d,h,f,p,g]))}function i(n,e,t,r,i,o,l,u,s,a,c,d,h,f){return rR.g(this,e,G([t,r,i,o,l,u,s,a,c,d,h,f]))}function o(n,e,t,r,i,o,l,u,s,a,c,d){return rR.g(this,e,G([t,r,i,o,l,u,s,a,c,d]))}function l(n,e,t,r,i,o,l,u,s,a){return rR.g(this,e,G([t,r,i,o,l,u,s,a]))}function u(n,e,t,r,i,o,l,u){return rR.g(this,e,G([t,r,i,o,l,u]))}function s(n,e,t,r,i,o){return rR.g(this,e,G([t,r,i,o]))}function a(n,e,t,r){return rR.g(this,e,G([t,r]))}var c;return(c=function(c,d,h,f,p,g,w,v,m,y,b,$,_,S,I,C,R,A,E,D,x,T){switch(arguments.length){case 2:return rR(this,d);case 4:return a.call(this,c,d,h,f);case 6:return s.call(this,c,d,h,f,p,g);case 8:return u.call(this,c,d,h,f,p,g,w,v);case 10:return l.call(this,c,d,h,f,p,g,w,v,m,y);case 12:return o.call(this,c,d,h,f,p,g,w,v,m,y,b,$);case 14:return i.call(this,c,d,h,f,p,g,w,v,m,y,b,$,_,S);case 16:return r.call(this,c,d,h,f,p,g,w,v,m,y,b,$,_,S,I,C);case 18:return t.call(this,c,d,h,f,p,g,w,v,m,y,b,$,_,S,I,C,R,A);case 20:return e.call(this,c,d,h,f,p,g,w,v,m,y,b,$,_,S,I,C,R,A,E,D);case 22:return n.call(this,c,d,h,f,p,g,w,v,m,y,b,$,_,S,I,C,R,A,E,D,x,T)}throw Error("Invalid arity: "+(arguments.length-1))}).b=function(n,e){return rR(this,e)},c.A=a,c.la=s,c.Ga=u,c.mb=l,c.nb=o,c.ob=i,c.pb=r,c.qb=t,c.rb=e,c.Be=n,c}(),g.apply=function(n,e){return this.call.apply(this,[this].concat(ed(e)))},g.a=function(n){return rR(this,n)},g.c=function(n,e,t){return rR.g(this,n,G([e,t]))},g.K=function(n,e,t,r,i){return rR.g(this,n,G([e,t,r,i]))},g.ib=function(n,e,t,r,i,o,l){return rR.g(this,n,G([e,t,r,i,o,l]))},g.Xa=function(n,e,t,r,i,o,l,u,s){return rR.g(this,n,G([e,t,r,i,o,l,u,s]))},g.cb=function(n,e,t,r,i,o,l,u,s,a,c){return rR.g(this,n,G([e,t,r,i,o,l,u,s,a,c]))},g.eb=function(n,e,t,r,i,o,l,u,s,a,c,d,h){return rR.g(this,n,G([e,t,r,i,o,l,u,s,a,c,d,h]))},g.fb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p){return rR.g(this,n,G([e,t,r,i,o,l,u,s,a,c,d,h,f,p]))},g.gb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){return rR.g(this,n,G([e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w]))},g.hb=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w){return rR.g(this,n,G([e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w]))},g.Sc=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b){return jh(rR,this,n,e,t,G([r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b]))},g.ma=h,g.S=function(n,e){return ce(e,dM(this))};var xR=new n(null,2,[jI,vR("whitespace = #'\\s+'"),Wy,vR("whitespace = #'[,\\s]+'")],null);function yR(n){return"#"!==n&&("'"!==n&&(":"!==n&&(zR.a?zR.a(n):zR.call(null,n))))}function AR(n){return"@"===n||"`"===n||"~"===n}function BR(n,e,t,r){if(Tc(t))return TO(n,e);if(p(p(r)?AR(t):r))return UO(n,e,t);for(r=new zc,vO(n,t);;){if(mO(t)||yR(t)||null==t)return q.a(r);if(AR(t))return UO(n,e,t);r.append(tO(n)),t=uO(n)}}function CR(n,e,t){if(p(e=tO(n))){var r=DR.a?DR.a(e):DR.call(null,e);return p(r)?r.c?r.c(n,e,t):r.call(null,n,e,t):(vO(n,e),ER.c?ER.c(n,e,t):ER.call(null,n,e,t))}return VO(n)}function FR(n,e){return LO(n,G(["Unmatched delimiter ",e,"."]))}function GR(n,e,t){e=1+e,F(n)!==e&&QO(n);for(var r=1,i=0;;){if(r===e)return String.fromCharCode(i);var o=sO(pf(n,r),t);if(-1===o)return XO(pf(n,r),n);i=o+i*t,r+=1}}function HR(n,e,t,r,i){for(var o=1,l=sO(e,t);;){if(-1===l)return YO(n,e);if(o===r)return String.fromCharCode(l);var u=uO(n),s=mO(u);if(s||(s=p(s=zR.a?zR.a(u):zR.call(null,u))?s:null==u),p(s))return p(i)?ZO(n,o,r):String.fromCharCode(l);if(s=sO(u,t),tO(n),-1===s)return YO(n,u);l=s+l*t,o+=1}}function IR(n){var e=tO(n);if(null!=e){var t=(e=yR(e)||AR(e)||mO(e)?q.a(e):BR(n,PF,e,!1)).length;return 1===t?pf(e,0):"newline"===e?"\n":"space"===e?" ":"tab"===e?"\t":"backspace"===e?"\b":"formfeed"===e?"\f":"return"===e?"\r":p(0==e.lastIndexOf("u",0))?55295<(t=(e=GR(e,4,16)).charCodeAt())&&57344>t?$O(n,t.toString(16)):e:p(0==e.lastIndexOf("o",0))?3<--t?aP(n,e):255<(0|(e=GR(e,t,8)))?bP(n):e:LO(n,G(["Unsupported character: ",e,"."]))}return cP(n)}function JR(n){return BO(n)?new Q(null,2,5,R,[wO(n),(0|xO(n))-1|0],null):null}function KR(n,e,t,r){var i=JR(t),o=J(i,0,null);i=J(i,1,null),e=iO(e);for(var l=je(I);;){var u=oP(t);if(p(u)||OO(t,n,o,i,F(l)),A.b(e,iO(u)))return le(l);var s=zR.a?zR.a(u):zR.call(null,u);p(s)?l=(u=s.c?s.c(t,u,r):s.call(null,t,u,r))!==t?Yg.b(l,u):l:(vO(t,u),l=(u=LR?LR(t,!0,null,r):MR.call(null,t,!0,null,r))!==t?Yg.b(l,u):l)}}function NR(n,e,t){return Pf(n=KR(JI,")",n,t))?Se:fh(O,n)}function OR(n,e,t){return KR(Uu,"]",n,t)}function PR(n,e,t){var r=JR(n);e=J(r,0,null),r=J(r,1,null);var i=F(t=KR(Tv,"}",n,t)),o=Sk(2,t),l=Fk(o);return!Fh(i)&&PO(n,e,r,t),A.b(F(l),F(o))||mP(n,Tv,o),i<=2*pj?rj(hg(t)):Wj(hg(t))}function QR(n,e){for(var t=(l=void 0,(l=new zc).append(e),l),r=tO(n);;){if(p(function(){var n=mO(r);return n||(p(n=zR.a?zR.a(r):zR.call(null,r))?n:null==r)}())){var i=q.a(t);vO(n,r);var o=tP(i);return p(o)?o:LO(n,G(["Invalid number: ",i,"."]))}i=function(){var n=t;return n.append(r),n}(),o=tO(n),t=i,r=o}var l}function RR(n){var e=tO(n);switch(e){case"t":return"\t";case"r":return"\r";case"n":return"\n";case"\\":return"\\";case'"':return'"';case"b":return"\b";case"f":return"\f";case"u":return e=tO(n),-1===parseInt(0|e,16)?RO(n,e):HR(n,e,16,4,!0);default:return nO(e)?255<(0|(e=HR(n,e,8,3,!1)))?bP(n):e:dP(n,e)}}function SR(n){for(var e=new zc,t=tO(n);;){var r=t;if(A.b(null,r))return WO(n,xn,G(['"',e]));if(A.b("\\",r)){o=void 0,(o=e).append(RR(n)),r=o;var i=tO(n);e=r,t=i}else{if(A.b('"',r))return q.a(e);r=function(){var n=e;return n.append(t),n}(),i=tO(n),e=r,t=i}}var o}function TR(n,e){if(!p(e=BR(n,xu,e,!0)))return null;switch(e){case"nil":return null;case"true":return!0;case"false":return!1;case"/":return dA;default:var t=uP(e);return t=p(t)?Me.b(t.a?t.a(0):t.call(null,0),t.a?t.a(1):t.call(null,1)):null,p(t)?t:SO(n,xu,e)}}function UR(n){var e=tO(n);if(mO(e))return eP(n);var t=uP(e=BR(n,FJ,e,!0));if(p(p(t)?-1===e.indexOf("::"):t)){var r=t.a?t.a(0):t.call(null,0);return t=t.a?t.a(1):t.call(null,1),":"===pf(e,0)?SO(n,FJ,e):Kg.b(r,t)}return SO(n,FJ,e)}function VR(n,e,t){return M(e=oO(LR?LR(n,!0,null,t):MR.call(null,n,!0,null,t)))||fP(n,e),null!=(t=LR?LR(n,!0,null,t):MR.call(null,n,!0,null,t))&&(131072&t.h||h===t.xd)?Kf(t,wk.g(G([Lf(t),e]))):gP(n,t)}function WR(n,e,t){return t=Fk(e=KR(yA,"}",n,t)),A.b(F(e),F(t))||mP(n,yA,e),t}function YR(n){return LR?LR(n,!0,null,!0):MR.call(null,n,!0,null,!0),n}function ZR(n,e,t){e=tO(n);var r=null==(e=BR(n,VE,e,!0))?null:uP(e);return p(r=null==r?null:rO(r))?"{"===oP(n)?(!Fh(F(t=KR(VE,"}",n,t)))&&PO(n,null,null,t),e=qO(q.a(r),Sk(2,t)),t=Sk(2,Re(t)),A.b(F(Fk(e)),F(e))||mP(n,VE,e),Ik(e,t)):hP(n,e):iP(n,e)}function $R(n,e,t){return e=LR?LR(n,!0,null,t):MR.call(null,n,!0,null,t),A.b(iy,e)?Number.NaN:A.b(QC,e)?Number.NEGATIVE_INFINITY:A.b(Rw,e)?Number.POSITIVE_INFINITY:LO(n,G([["Invalid token: ##",q.a(e)].join("")]))}function zR(n){switch(n){case'"':return SR;case":":return UR;case";":return vP;case"^":return VR;case"(":return NR;case")":return FR;case"[":return OR;case"]":return FR;case"{":return PR;case"}":return FR;case"\\":return IR;case"#":return CR;default:return null}}function DR(n){switch(n){case"^":return VR;case"{":return WR;case"<":return wP("Unreadable form");case"!":return vP;case"_":return YR;case":":return ZR;case"#":return $R;default:return null}}function ER(n,e,t){e=LR?LR(n,!0,null,t):MR.call(null,n,!0,null,t);var r=LR?LR(n,!0,null,t):MR.call(null,n,!0,null,t);e instanceof w||jP(n,"Reader tag must be a symbol");var i=x.b(Ry.a(t),e);return i=p(i)?i:S.a?S.a(e):S.call(null,e),p(i)?i.a?i.a(r):i.call(null,r):p(t=em.a(t))?t.b?t.b(e,r):t.call(null,e,r):kP(n,e)}function MR(n){switch(arguments.length){case 1:return aS(S,arguments[0]);case 2:return aS(arguments[0],arguments[1]);case 4:return LR(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function aS(n,e){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var t=x.b(n,gv);return LR(e,!N(n,gv),t,n)}function LR(e,t,r,i){try{for(;;){var o=tO(e);if(!mO(o)){if(null==o)return p(t)?nP(e,null):r;if(nO(o)||("+"===o||"-"===o)&&nO(e.Dc(null)))return QR(e,o);var l=zR(o);if(!p(l))return TR(e,o);var u=l.c?l.c(e,o,i):l.call(null,e,o,i);if(u!==e)return u}}}catch(i){if(i instanceof Error){if((t=i)instanceof hm){if(r=km(t),A.b(fr,U.a(r)))throw t;throw jm(t.message,wk.g(G([new n(null,1,[U,fr],null),r,BO(e)?new n(null,3,[en,wO(e),ux,xO(e),OD,yO(e)],null):null])),t)}throw jm(t.message,wk.g(G([new n(null,1,[U,fr],null),BO(e)?new n(null,3,[en,wO(e),ux,xO(e),OD,yO(e)],null):null])),t)}throw i}}function bS(n,e){return p(p(e)?kh.b(e,""):e)?aS(n,CO(e)):null}var cS=function(){var n=new Q(null,13,5,R,[null,31,28,31,30,31,30,31,31,30,31,30,31],null),e=new Q(null,13,5,R,[null,31,29,31,30,31,30,31,31,30,31,30,31],null);return function(t,r){return x.b(p(r)?e:n,t)}}(),dS=/(\d\d\d\d)(?:-(\d\d)(?:-(\d\d)(?:[T](\d\d)(?::(\d\d)(?::(\d\d)(?:[.](\d+))?)?)?)?)?)?(?:[Z]|([-+])(\d\d):(\d\d))?/;function eS(n){return n=parseInt(n,10),Tc(isNaN(n))?n:null}function fS(n,e,t,r){if(!(n<=e&&e<=t))throw Error([q.a(r)," Failed:  ",q.a(n),"<=",q.a(e),"<=",q.a(t)].join(""));return e}function gS(n){var e=Wk(dS,n);J(e,0,null);var t,r=J(e,1,null),i=J(e,2,null),o=J(e,3,null),l=J(e,4,null),u=J(e,5,null),s=J(e,6,null),a=J(e,7,null),c=J(e,8,null),d=J(e,9,null),h=J(e,10,null);if(Tc(e))throw Error(["Unrecognized date/time syntax: ",q.a(n)].join(""));n=eS(r),e=p(t=eS(i))?t:1,r=function(){var n=eS(o);return p(n)?n:1}();var f=function(){var n=eS(l);return p(n)?n:0}(),g=function(){var n=eS(u);return p(n)?n:0}(),w=function(){var n=eS(s);return p(n)?n:0}(),v=function(){n:if(A.b(3,F(a)))var n=a;else if(3<F(a))n=a.substring(0,3);else for(n=new zc(a);;){if(!(3>n.getLength())){n=n.toString();break n}n=n.append("0")}return p(n=eS(n))?n:0}();return c=A.b(c,"-")?-1:1,c*=60*function(){var n=eS(d);return p(n)?n:0}()+function(){var n=eS(h);return p(n)?n:0}(),new Q(null,8,5,R,[n,fS(1,e,12,"timestamp month field must be in range 1..12"),fS(1,r,cS(e,0==(n%4+4)%4&&(0!=(n%100+100)%100||0==(n%400+400)%400)),"timestamp day field must be in range 1..last day in month"),fS(0,f,23,"timestamp hour field must be in range 0..23"),fS(0,g,59,"timestamp minute field must be in range 0..59"),fS(0,w,A.b(g,59)?60:59,"timestamp second field must be in range 0..60"),fS(0,v,999,"timestamp millisecond field must be in range 0..999"),c],null)}var hS=Oh(null),iS=Oh(wk.g(G([new n(null,4,[uw,function(n){if("string"==typeof n){var e=gS(n);if(!p(e))throw Error(["Unrecognized date/time syntax: ",q.a(n)].join(""));n=J(e,0,null);var t=J(e,1,null),r=J(e,2,null),i=J(e,3,null),o=J(e,4,null),l=J(e,5,null),u=J(e,6,null);return e=J(e,7,null),e=new Date(Date.UTC(n,t-1,r,i,o,l,u)-6e4*e)}throw Error("Instance literal expects a string for its timestamp.")},es,function(n){if("string"==typeof n)return new fm(n.toLowerCase());throw Error("UUID literal expects a string as its representation.")},js,function(n){if(Vf(n))return ji.b(cj,n);throw Error("Queue literal expects a vector for its elements.")},iv,function(n){if(Vf(n)){var e=[];n=B(n);for(var t=null,r=0,i=0;;)if(i<r){var o=t.W(null,i);e.push(o),i+=1}else{if(!(n=B(n)))break;Wf(t=n)?(n=re(t),i=se(t),t=n,r=F(n),n=i):(n=C(t),e.push(n),n=D(t),t=null,r=0),i=0}return e}if(M(n)){for(e={},n=B(n),t=null,i=r=0;;)if(i<r){var l=t.W(null,i);o=J(l,0,null),l=J(l,1,null),e[o=Lg(o)]=l,i+=1}else{if(!(n=B(n)))break;Wf(n)?(r=re(n),n=se(n),t=r,r=F(r)):(t=J(r=C(n),0,null),r=J(r,1,null),e[t=Lg(t)]=r,n=D(n),t=null,r=0),i=0}return e}throw Error("JS literal expects a vector or map containing only string or unqualified keyword keys")}],null),S]))),jS=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};jS.a=function(e){return bS(new n(null,3,[Ry,t(iS),em,t(hS),gv,null],null),e)},jS.b=function(e,r){return bS(pi(wk.g(G([new n(null,1,[em,t(hS)],null),e])),Ry,(function(n){return wk.g(G([t(iS),n]))})),r)},jS.F=2;var kS=vR("\n    expr=and-or\n    <and-or>=<ws*> (eq-neq | and | or)\n    <eq-neq>=<ws*> (term | eq | neq | match)\n    and=and-or <ws*> <'&&'> eq-neq\n    or=and-or <ws*> <'||'> eq-neq\n    eq=eq-neq <ws*> <'=='> term\n    neq=eq-neq <ws*> <'!='> term\n    match=eq-neq <ws*> <'?'> term\n    <term>=<ws*> (ident | own-ident | number | str | lparen and-or rparen)\n    <lparen> = <ws*'('ws*>\n    <rparen> = <ws*')'ws*>\n    ident=<'$'> word\n    own-ident=<'#'> word\n    str=<'\\''> #'[^\\']+' <'\\''>\n    word=#'[a-zA-Z]+'\n    number=#'[-+]?[0-9]*\\.?[0-9]+'\n    ws=#'[\\s\\t]+'\n    ");function lS(e){if(B(e)){if(null==(e=rR(kS,e)))var t=null;else t=p(t=e instanceof uN?e:Lf(e)instanceof uN?Lf(e):null)?q.a(t):null;if(p(t))throw im(["Error parsing restrictions ",t].join(""),new n(null,1,[sr,t],null));return e}return null}function mS(n,e,t){return!B(n)||eO(Xj([xI,dF,Wz,yI,Fv,pC,xA,LC,hs,tH],[A,jS,function(n,e){return p(n)?n:e},lg,lg,kh,function(n){J(n,0,null),n=J(n,1,null);var e=x.b(t,n);return p(e)?e:x.b(t,Kg.a(n))},function(n,e){return A.b(n,e)},function(n){J(n,0,null),n=J(n,1,null);var t=x.b(e,n);return p(t)?t:x.b(e,Kg.a(n))},function(n,e){return p(p(e)?n:e)?Wk(Zk(e),n):null}]),n)}var nS={},oS={},aX,bX,cX,dX,rX,sX,tX,uX,vX,SY;function zS(n,e){if(null!=n&&null!=n.Zb)n=n.Zb(n,e);else{var t=zS[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=zS._))throw Zc("Spec.conform*",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function AS(n,e){if(null!=n&&null!=n.$b)n=n.$b(n,e);else{var t=AS[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=AS._))throw Zc("Spec.with-gen*",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}var BS=Oh(S);function CS(n){if(Jg(n)){var e=t(BS);if(Jg(n=x.b(e,n)))n:for(;;){if(!Jg(n)){e=n;break n}n=x.b(e,n)}else e=n;return e}return n}function DS(n){if(Jg(n)){var e=CS(n);if(p(e))return e;throw Error(["Unable to resolve spec: ",q.a(n)].join(""))}return n}function ES(n){return null!=n&&h===n.rc?n:null}function FS(n){var e=pB.a(n);return p(e)?n:e}function GS(n,e){return Jg(n)?n:p(FS(n))?K.c(n,So,e):null!=n&&(131072&n.h||h===n.xd)?Kf(n,K.c(Lf(n),So,e)):null}function HS(n){return Jg(n)?n:p(FS(n))?So.a(n):null!=n&&(131072&n.h||h===n.xd)?So.a(Lf(n)):null}function IS(n){var e,t=p(e=!!Jg(n)&&CS(n))||p(e=ES(n))||p(e=FS(n))?e:null;return p(FS(t))?GS(JS(t,null),HS(t)):t}function KS(n){var e=IS(n);if(p(e))return e;if(Jg(n))throw Error(["Unable to resolve spec: ",q.a(n)].join(""));return null}function LS(n){if(ec(null==n?"":String(n)))return null;if(2<=F(n=Wh.b(Qm,UL(n,"$",0)))&&Dh((function(n){return!ec(null==n?"":String(n))}),n)){var e=Uk(Hk,Bf)(n);return n=J(e,0,null),e=J(e,1,null),Me.a([SL(".",n),"/",q.a(e)].join(""))}return null}var wZ=function(){function n(n,e){var t=MS[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=MS._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("Specize.specize*",n)}function e(n){var e=MS[db(null==n?null:n)];if(null!=e)return e.a?e.a(n):e.call(null,n);if(null!=(e=MS._))return e.a?e.a(n):e.call(null,n);throw Zc("Specize.specize*",n)}var t;return(t=function(t,r){switch(arguments.length){case 1:return e.call(this,t);case 2:return n.call(this,t,r)}throw Error("Invalid arity: "+arguments.length)}).a=e,t.b=n,t}(),MS=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};MS.a=function(n){return null!=n&&null!=n.Db?n.Db(n):wZ(n)},MS.b=function(n,e){return null!=n&&null!=n.Eb?n.Eb(n,e):wZ(n,e)},MS.F=2,z.prototype.Db=function(){return MS(DS(this))},z.prototype.Eb=function(){return MS(DS(this))},w.prototype.Db=function(){return MS(DS(this))},w.prototype.Eb=function(){return MS(DS(this))},Bk.prototype.Db=function(){return NS(this,this,null,null,null)},Bk.prototype.Eb=function(n,e){return NS(e,this,null,null,null)},MS._=function(){function n(n){var e=!!If(n)&&LS(n.name);return p(e)?NS(e,n,null,null,null):NS(Nx,n,null,null,null)}var e;return(e=function(e,t){switch(arguments.length){case 1:return n.call(this,e);case 2:return NS(t,e,null,null,null)}throw Error("Invalid arity: "+arguments.length)}).a=n,e.b=function(n,e){return NS(e,n,null,null,null)},e}();var OS=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function PS(n){return P(Nr,n)}function QS(n,e){return zS(OS.a(n),e)}function RS(n,e){return p(FS(n=CS(n)))?K.c(n,kH,e):AS(OS.a(n),e)}function Z(n,e,r){if(null==r)Rh.c(BS,Hf,n);else{var i=ES(r);p(i)||(i=p(i=FS(r))?i:x.b(t(BS),r)),e=p(i)?r:NS(e,r,null,null,null),Rh.A(BS,K,n,GS(e,n))}}function SS(n,e,t){if(p(n)){var r=KS(n);if(p(r))return QS(r,e);if(If(n)||(null!=n?1&n.h||h===n.Nh||!n.h&&Xc(id,n):Xc(id,n)))return p(null)?n.a?n.a(e):n.call(null,e):p(n.a?n.a(e):n.call(null,e))?e:Nr;throw Error([ol.g(G([t]))," is not a fn, expected predicate fn"].join(""))}return e}function TS(n,e){return!PS(zS(n=OS.a(n),e))}OS.a=function(n){var e=ES(n);return p(e)?e:MS(n)},OS.b=function(n,e){var t=ES(n);return p(t)?t:MS(n,e)},OS.F=2;var US=function n(e){var r=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,i=x.b(r,jJ),o=x.b(r,ir),l=x.b(r,iA),u=x.b(r,TE),s=x.b(r,Wt),a=x.b(r,ot),c=x.b(r,hx),d=x.b(r,CG),f=x.b(r,Lu),g=x.b(r,QI),w=x.b(r,JF),v=x.b(r,GE),m=Ik(Xg.b(g,c),Xg.b(d,w)),y=gm();return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==aX||((aX=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m){this.Qb=n,this.he=e,this.ph=t,this.Eh=r,this.sh=i,this.jb=o,this.vh=l,this.ie=u,this.ff=s,this.qh=a,this.Dh=c,this.ih=d,this.Bh=h,this.id=f,this.Ch=p,this.rh=g,this.Ig=w,this.wh=v,this.Og=m,this.h=393216,this.I=0}).prototype.O=function(n,e){return new aX(this.Qb,this.he,this.ph,this.Eh,this.sh,this.jb,this.vh,this.ie,this.ff,this.qh,this.Dh,this.ih,this.Bh,this.id,this.Ch,this.rh,this.Ig,this.wh,e)},aX.prototype.N=function(){return this.Og},aX.prototype.Db=function(){return this},aX.prototype.Eb=function(){return this},aX.prototype.rc=h,aX.prototype.Zb=function(n,e){if(!p(this.ie.a?this.ie.a(e):this.ie.call(null,e)))return Nr;n=t(BS);var r=B(e),i=C(r);for(D(r),J(i,0,null),J(i,1,null),i=r=e;;){e=r;var o=B(i);r=C(o);var l=D(o);if(r=J(o=r,0,null),o=J(o,1,null),!p(i))return e;if(i=this.he.a?this.he.a(r):this.he.call(null,r),p(i=x.b(n,i))){if(PS(i=QS(i,o)))return Nr;e=i===o?e:K.c(e,r,i),i=l,r=e}else i=l,r=e}},aX.prototype.$b=function(e,t){return e=K.c(this.ff,TE,t),n.a?n.a(e):n.call(null,e)},aX.Pa=function(){return new Q(null,19,5,R,[qG,cz,PA,xF,Qn,Sv,fy,Su,Wm,Ws,BF,XE,$I,Xt,FF,Np,yp,WH,lK],null)},aX.Ia=!0,aX.Da="cljs.spec.alpha/t_cljs$spec$alpha11516",aX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha11516")}),new aX(r,(function(n){var e=m.a?m.a(n):m.call(null,n);return p(e)?e:n}),i,o,l,u,s,a,r,c,d,e,f,y,g,w,m,v,S)};function NS(n,e,t,r,i){return p(ES(e))?p(t)?RS(e,t):e:p(FS(e))?JS(e,t):Jg(e)?(n=KS(e),p(t)?RS(n,t):n):(void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==bX||((bX=function(n,e,t,r,i,o){this.form=n,this.Sb=e,this.jb=t,this.Oe=r,this.Sf=i,this.Qg=o,this.h=393216,this.I=0}).prototype.O=function(n,e){return new bX(this.form,this.Sb,this.jb,this.Oe,this.Sf,e)},bX.prototype.N=function(){return this.Qg},bX.prototype.Db=function(){return this},bX.prototype.Eb=function(){return this},bX.prototype.rc=h,bX.prototype.Zb=function(n,e){return n=this.Sb.a?this.Sb.a(e):this.Sb.call(null,e),p(this.Oe)?n:p(n)?e:Nr},bX.prototype.$b=function(n,e){return NS(this.form,this.Sb,e,this.Oe,this.Sf)},bX.Pa=function(){return new Q(null,6,5,R,[wF,Oo,Sv,pt,bs,BT],null)},bX.Ia=!0,bX.Da="cljs.spec.alpha/t_cljs$spec$alpha11760",bX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha11760")}),new bX(n,e,t,r,i,S))}function VS(n,e){return WS(n,e,U,null)}function WS(n,e,r,i){var o=gm(),l=r instanceof z?function(n,e){return K.c(n,r,e)}:r;return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==cX||((cX=function(n,e,t,r,i,o,l,u,s){this.form=n,this.Cf=e,this.Of=t,this.jb=r,this.id=i,this.oe=o,this.yg=l,this.tag=u,this.Rg=s,this.h=393216,this.I=0}).prototype.O=function(n,e){return new cX(this.form,this.Cf,this.Of,this.jb,this.id,this.oe,this.yg,this.tag,e)},cX.prototype.N=function(){return this.Rg},cX.prototype.Db=function(){return this},cX.prototype.Eb=function(){return this},cX.prototype.rc=h,cX.prototype.Zb=function(n,e){return p(n=this.oe.a?this.oe.a(e):this.oe.call(null,e))?SS(n,e,this.form):Nr},cX.prototype.$b=function(n,e){return WS(this.form,this.Cf,this.Of,e)},cX.Pa=function(){return new Q(null,9,5,R,[wF,aH,rD,Sv,Xt,OC,yD,qw,HH],null)},cX.Ia=!0,cX.Da="cljs.spec.alpha/t_cljs$spec$alpha11900",cX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha11900")}),new cX(n,e,r,i,o,(function(n){var r=t(e),i=bm(r);return p(i=am(r,i=i.a?i.a(n):i.call(null,n)))?r.a?r.a(n):r.call(null,n):i}),(function(n){var r=bm(t(e));return r.a?r.a(n):r.call(null,n)}),l,S)}function XS(n,e){return YS(n,e,null)}function YS(n,e,r){var i=new xl((function(){return ki.c(OS,e,n)})),o=F(e);return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==dX||((dX=function(n,e,t,r,i,o){this.forms=n,this.Cb=e,this.jb=t,this.td=r,this.C=i,this.Sg=o,this.h=393216,this.I=0}).prototype.O=function(n,e){return new dX(this.forms,this.Cb,this.jb,this.td,this.C,e)},dX.prototype.N=function(){return this.Sg},dX.prototype.Db=function(){return this},dX.prototype.Eb=function(){return this},dX.prototype.rc=h,dX.prototype.Zb=function(n,e){if(n=t(this.td),!Vf(e)||!A.b(F(e),this.C))return Nr;for(var r=e,i=0;;){if(A.b(i,this.C))return r;var o=e.a?e.a(i):e.call(null,i),l=zS(n.a?n.a(i):n.call(null,i),o);if(PS(l))return Nr;r=l===o?r:K.c(r,i,l),i+=1}},dX.prototype.$b=function(n,e){return YS(this.forms,this.Cb,e)},dX.Pa=function(){return new Q(null,6,5,R,[Do,MC,Sv,Lt,Vs,wK],null)},dX.Ia=!0,dX.Da="cljs.spec.alpha/t_cljs$spec$alpha11983",dX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha11983")}),new dX(n,e,r,i,o,S)}function ZS(n,e){return new Gi(n,e)}var $S=function n(e,r,i,o){var l=gm(),u=Ik(e,i),s=new xl((function(){return ki.c(OS,i,r)})),a=function(){switch(F(i)){case 2:return function(n){var r=t(s),i=zS(r.a?r.a(0):r.call(null,0),n);return PS(i)?PS(n=zS(r.a?r.a(1):r.call(null,1),n))?Nr:ZS(e.a?e.a(1):e.call(null,1),n):ZS(e.a?e.a(0):e.call(null,0),i)};case 3:return function(n){var r=t(s),i=zS(r.a?r.a(0):r.call(null,0),n);return PS(i)?PS(i=zS(r.a?r.a(1):r.call(null,1),n))?PS(n=zS(r.a?r.a(2):r.call(null,2),n))?Nr:ZS(e.a?e.a(2):e.call(null,2),n):ZS(e.a?e.a(1):e.call(null,1),i):ZS(e.a?e.a(0):e.call(null,0),i)};default:return function(n){for(var r=t(s),i=0;;){if(!(i<F(r)))return Nr;var o=r.a?r.a(i):r.call(null,i);if(!PS(o=zS(o,n)))return ZS(e.a?e.a(i):e.call(null,i),o);i+=1}}}}();return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==rX||((rX=function(n,e,t,r,i,o,l,u,s){this.keys=n,this.forms=e,this.Cb=t,this.jb=r,this.id=i,this.Lg=o,this.td=l,this.yc=u,this.Tg=s,this.h=393216,this.I=0}).prototype.O=function(n,e){return new rX(this.keys,this.forms,this.Cb,this.jb,this.id,this.Lg,this.td,this.yc,e)},rX.prototype.N=function(){return this.Tg},rX.prototype.Db=function(){return this},rX.prototype.Eb=function(){return this},rX.prototype.rc=h,rX.prototype.Zb=function(n,e){return this.yc.a?this.yc.a(e):this.yc.call(null,e)},rX.prototype.$b=function(e,t){return n.A?n.A(this.keys,this.forms,this.Cb,t):n.call(null,this.keys,this.forms,this.Cb,t)},rX.Pa=function(){return new Q(null,9,5,R,[OF,Do,MC,Sv,Xt,lw,Lt,tA,tS],null)},rX.Ia=!0,rX.Da="cljs.spec.alpha/t_cljs$spec$alpha12118",rX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha12118")}),new rX(e,r,i,o,l,u,s,a,S)};function aT(n,e,t){var r=B(e);for(C(r),D(r),C(r=B(t)),D(r),r=t;;){t=n,n=C(e=B(e)),e=D(e);var i=B(r),o=r=C(i);if(r=i=D(i),!p(n))return t;if(PS(t=SS(n,t,o)))return Nr;n=t}}var bT=function n(e,r,i){var o=new xl((function(){return ki.c(OS,r,e)})),l=function(){switch(F(r)){case 2:return function(n){var e=t(o);return PS(n=zS(e.a?e.a(0):e.call(null,0),n))?Nr:zS(e.a?e.a(1):e.call(null,1),n)};case 3:return function(n){var e=t(o);return PS(n=zS(e.a?e.a(0):e.call(null,0),n))||PS(n=zS(e.a?e.a(1):e.call(null,1),n))?Nr:zS(e.a?e.a(2):e.call(null,2),n)};default:return function(n){for(var e=t(o),r=0;;){if(!(r<F(e)))return n;if(PS(n=zS(e.a?e.a(r):e.call(null,r),n)))return Nr;r+=1}}}}();return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==sX||((sX=function(n,e,t,r,i,o){this.forms=n,this.Cb=e,this.jb=t,this.td=r,this.yc=i,this.Ug=o,this.h=393216,this.I=0}).prototype.O=function(n,e){return new sX(this.forms,this.Cb,this.jb,this.td,this.yc,e)},sX.prototype.N=function(){return this.Ug},sX.prototype.Db=function(){return this},sX.prototype.Eb=function(){return this},sX.prototype.rc=h,sX.prototype.Zb=function(n,e){return this.yc.a?this.yc.a(e):this.yc.call(null,e)},sX.prototype.$b=function(e,t){return n.c?n.c(this.forms,this.Cb,t):n.call(null,this.forms,this.Cb,t)},sX.Pa=function(){return new Q(null,6,5,R,[Do,MC,Sv,Lt,tA,zT],null)},sX.Ia=!0,sX.Da="cljs.spec.alpha/t_cljs$spec$alpha12210",sX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha12210")}),new sX(e,r,i,o,l,S)},cT=function n(e,t,r){return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==tX||((tX=function(n,e,t,r){this.forms=n,this.Cb=e,this.jb=t,this.Vg=r,this.h=393216,this.I=0}).prototype.O=function(n,e){return new tX(this.forms,this.Cb,this.jb,e)},tX.prototype.N=function(){return this.Vg},tX.prototype.Db=function(){return this},tX.prototype.Eb=function(){return this},tX.prototype.rc=h,tX.prototype.Zb=function(n,e){return p(Eh(PS,n=Wh.c((function(n,t){return SS(n,e,t)}),this.Cb,this.forms)))?Nr:fh(wk,n)},tX.prototype.$b=function(e,t){return n.c?n.c(this.forms,this.Cb,t):n.call(null,this.forms,this.Cb,t)},tX.Pa=function(){return new Q(null,4,5,R,[Do,MC,Sv,eU],null)},tX.Ia=!0,tX.Da="cljs.spec.alpha/t_cljs$spec$alpha12265",tX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha12265")}),new tX(e,t,r,S)},dT=new n(null,4,[XF,I,VB,Dk,qv,Se,Hq,S],null);function eT(n,e,r,i){function o(n,e,t,r){return Cf.b(n,r)}var l=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,u=x.b(l,KJ),s=x.b(l,Zn),a=x.c(l,MB,20),c=x.b(l,NC),d=x.b(l,cA),f=x.b(l,NH),g=x.b(l,aE),w=x.b(l,QF),v=x.b(l,gw),m=x.b(l,cu),y=x.b(l,Os),b=x.b(l,sy),$=x.b(l,uC),_=p($)?Ef($):x.b(dT,s),I=new xl((function(){return OS.a(e)})),E=p(w)?w:function(n){return n};return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==uX||((uX=function(n,e,t,r,i,o,l,u,s,a,c,d,h,f,p,g,w,v,m,y,b,$,_,S,I){this.form=n,this.Pg=e,this.Tb=t,this.jh=r,this.$f=i,this.jb=o,this.Hg=l,this.Sb=u,this.ce=s,this.ug=a,this.Kg=c,this.Yf=d,this.Xd=h,this.wg=f,this.xg=p,this.Sd=g,this.Jg=w,this.Gg=v,this.count=m,this.mh=y,this.Df=b,this.kind=$,this.uf=_,this.tg=S,this.Wg=I,this.h=393216,this.I=0}).prototype.O=function(n,e){return new uX(this.form,this.Pg,this.Tb,this.jh,this.$f,this.jb,this.Hg,this.Sb,this.ce,this.ug,this.Kg,this.Yf,this.Xd,this.wg,this.xg,this.Sd,this.Jg,this.Gg,this.count,this.mh,this.Df,this.kind,this.uf,this.tg,e)},uX.prototype.N=function(){return this.Wg},uX.prototype.Db=function(){return this},uX.prototype.Eb=function(){return this},uX.prototype.rc=h,uX.prototype.Zb=function(n,e){if(n=t(this.Sd),Tc(this.ce.a?this.ce.a(e):this.ce.call(null,e)))return Nr;if(p(this.uf)){var r=this.Xd.a?this.Xd.a(e):this.Xd.call(null,e),i=J(r,0,null),o=J(r,1,null);r=J(r,2,null);var l=i.a?i.a(e):i.call(null,e);i=0;var u=B(e);for(C(e=B(u)),D(e),e=l;;){var s=u;if(u=C(l=B(s)),l=D(l),!s)return r.a?r.a(e):r.call(null,e);if(PS(s=zS(n,u)))return Nr;e=o.A?o.A(e,i,u,s):o.call(null,e,i,u,s),i+=1,u=l}}else if(mf(e))for(o=1>(o=sg(F(e)/101))?1:o,i=0;;){if(i>=F(e))return e;if(!TS(n,pf(e,i)))return Nr;i+=o}else for(i=0,o=B(e),C(r=B(o)),D(r);;){if(r=C(u=B(o)),l=D(u),u=r,null==(s=o)||A.b(i,101))return e;if(!TS(n,u))return Nr;o=l,i+=1}},uX.prototype.$b=function(n,e){return eT(this.form,this.Sb,this.Df,e)},uX.Pa=function(){return new Q(null,25,5,R,[wF,Ao,OG,yF,UE,Sv,yG,Oo,Op,dz,vA,NB,xG,Js,DG,hy,rA,gu,wB,jC,nx,$D,SF,bo,nF],null)},uX.Ia=!0,uX.Da="cljs.spec.alpha/t_cljs$spec$alpha12350",uX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha12350")}),new uX(n,u,l,r,(function(n){return TS(t(I),n)}),i,a,e,c,d,s,o,(function(n){return Vf(n)&&(Tc($)||Vf($))?new Q(null,3,5,R,[lg,function(n,e,t,r){return t===r?n:K.c(n,e,r)},lg],null):p(!!M(n)&&(e=p(y)?Tc($):y,p(e)?e:M($)))?new Q(null,3,5,R,[p(d)?Ef:lg,function(n,e,t,r){return t===r&&Tc(d)?n:K.c(n,pf(p(d)?r:t,0),pf(r,1))},lg],null):Cg($)||$f($)||Tc($)&&(Cg(n)||$f(n))?new Q(null,3,5,R,[Ef,o,Eg],null):new Q(null,3,5,R,[function(n){return Ef(p($)?$:n)},o,lg],null);var e}),f,g,I,E,_,v,m,l,y,b,$,S)}function fT(e){return new n(null,2,[pB,$s,Mu,e],null)}function gT(n){return n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n,n=x.b(n,pB),A.b($s,n)}var hT=function e(t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,Iz),o=C(t=B(i));t=D(t);var l=x.b(r,hz),u=B(l),s=C(u);u=D(u);var a=x.b(r,jr),c=B(a);C(c),c=D(c);var d=x.b(r,Mu);return r=x.b(r,dy),Dh(lg,i)?gT(o)?(i=Mu.a(o),i=Cf.b(d,p(l)?Gf([s,i]):i),t?(t=new n(null,4,[Iz,t,hz,u,jr,c,Mu,i],null),e.a?e.a(t):e.call(null,t)):fT(i)):new n(null,6,[pB,Or,Iz,i,Mu,d,hz,l,jr,a,dy,r],null):null};function iT(e,t,r,i,o){return p(e)?(i=new n(null,5,[pB,Ww,Ly,t,sw,i,jr,o,qJ,gm()],null),gT(e)?K.g(i,My,t,G([Mu,Cf.b(r,Mu.a(e))])):K.g(i,My,e,G([Mu,r]))):null}function jT(n,e,t,r){return p(p(e)?e:t)?(n=fi.b((function(n){return n=C(n),r.a?r.a(n):r.call(null,n)}),Wh.A(Ri,n,B(e)||new $h(null,-1,null,null),function(){var n=B(t);return n||new $h(null,-1,null,null)}())),new Q(null,3,5,R,[B(Wh.b(C,n)),p(e)?B(Wh.b(zf,n)):null,p(t)?B(Wh.b((function(n){return pf(n,2)}),n)):null],null)):new Q(null,3,5,R,[B(fi.b(r,n)),e,t],null)}function kT(e,t,r){var i=jT(e,t,r,lg);e=C(r=B(t=J(i,0,null))),r=D(r);var o=J(i,1,null),l=J(o,0,null);return i=J(i,2,null),p(t)?(t=new n(null,4,[pB,Kn,Iz,t,hz,o,jr,i],null),null==r?p(l)?gT(e)?fT(ZS(l,Mu.a(e))):t:e:t):null}function lT(n,e){return p(p(n)?e:n)?kT(G([n,e]),null,null):p(n)?n:e}var mT=function n(e){var t=null!=(e=DS(e))&&(64&e.h||h===e.D)?fh(qk,e):e,r=x.b(t,pB),i=x.b(t,Iz);e=x.b(t,My);var o=x.b(t,Ly);if(t=x.b(t,jr),A.b($s,r))return!0;if(A.b(null,r))return null;if(A.b(En,r))return p(r=n.a?n.a(e):n.call(null,e))?!PS(e=aT(nT(e),i,D(t))):r;if(A.b(Ww,r))return(i=e===o)?i:n.a?n.a(e):n.call(null,e);if(A.b(Or,r))return Dh(n,i);if(A.b(Kn,r))return Eh(n,i);throw Error(["No matching clause: ",q.a(r)].join(""))},nT=function e(t){var r=null!=(t=DS(t))&&(64&t.h||h===t.D)?fh(qk,t):t,i=B(t=x.b(r,Iz)),o=C(i);D(i);var l=x.b(r,hz),u=J(l,0,null),s=x.b(r,pB);i=x.b(r,My);var a=x.b(r,Mu);if(r=x.b(r,jr),A.b($s,s))return a;if(A.b(null,s))return null;if(A.b(En,s))return o=e.a?e.a(i):e.call(null,i),(l=A.b(o,Yn))?i=l:(i=pB.a(DS(i)),i=p(i=(l=new Bk(null,new n(null,2,[Ww,null,Or,null],null),null)).a?l.a(i):l.call(null,i))?Pf(o):i,i=p(i)?i:null),p(i)?Yn:aT(o,t,r);if(A.b(Ww,s))return oT(i,a,u);if(A.b(Or,s))return oT(o,a,u);if(A.b(Kn,s))return t=J(r=jT(t,l,r,mT),0,null),t=J(t,0,null),r=J(r,1,null),r=J(r,0,null),t=null==t?Yn:e.a?e.a(t):e.call(null,t),p(r)?ZS(r,t):t;throw Error(["No matching clause: ",q.a(s)].join(""))};function oT(n,e,t){var r=null!=(n=DS(n))&&(64&n.h||h===n.D)?fh(qk,n):n,i=x.b(r,pB);if(x.b(r,Iz),n=x.b(r,sw),A.b(null,i))return e;if(A.b(Kn,i)||A.b($s,i)||A.b(En,i))return n=nT(r),A.b(n,Yn)?e:Cf.b(e,p(t)?Gf([t,n]):n);if(A.b(Ww,i)||A.b(Or,i))return Pf(r=nT(r))||(t=p(t)?Gf([t,r]):r,e=(n=p(n)?ji:Cf).b?n.b(e,t):n.call(null,e,t)),e;throw Error(["No matching clause: ",q.a(i)].join(""))}var pT=function e(t,r){var i=null!=(t=DS(t))&&(64&t.h||h===t.D)?fh(qk,t):t,o=x.b(i,jr),l=x.b(i,Ly),u=B(t=x.b(i,Iz)),s=C(u),a=D(u),c=x.b(i,Mu);u=x.b(i,pB);var d=x.b(i,sw),f=x.b(i,hz),g=B(f),w=C(g),v=D(g);g=x.b(i,JC);var m,y=x.b(i,My);if(p(i)){if(A.b($s,u))return null;if(A.b(null,u))return PS(t=SS(i,r,i))?null:fT(t);if(A.b(En,u))return p(i=e.b?e.b(y,r):e.call(null,y,r))?A.b($s,pB.a(i))?PS(t=aT(nT(i),t,D(o)))?null:fT(t):new n(null,5,[pB,En,My,i,JC,g,Iz,t,jr,o],null):null;if(A.b(Or,u))return lT(hT(new n(null,4,[Iz,vf(e.b?e.b(s,r):e.call(null,s,r),a),hz,f,jr,o,Mu,c],null)),p(mT(s))?(m=hT(new n(null,4,[Iz,a,hz,v,jr,D(o),Mu,oT(s,c,w)],null)),e.b?e.b(m,r):e.call(null,m,r)):null);if(A.b(Kn,u))return kT(Wh.b((function(n){return e.b?e.b(n,r):e.call(null,n,r)}),t),f,o);if(A.b(Ww,u))return lT(iT(e.b?e.b(y,r):e.call(null,y,r),l,c,d,o),p(mT(y))?function(){var n=iT(l,l,oT(y,c,null),d,o);return e.b?e.b(n,r):e.call(null,n,r)}():null);throw Error(["No matching clause: ",q.a(u)].join(""))}return null};function qT(n,e){for(;;){var t=B(e),r=C(t);if(t=D(t),Pf(e))return p(mT(n))?(n=nT(n),A.b(n,Yn)?null:n):Nr;if(!p(n=pT(n,r)))return Nr;e=t}}var JS=function n(e,t){return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==vX||((vX=function(n,e,t){this.qe=n,this.jb=e,this.Yg=t,this.h=393216,this.I=0}).prototype.O=function(n,e){return new vX(this.qe,this.jb,e)},vX.prototype.N=function(){return this.Yg},vX.prototype.Db=function(){return this},vX.prototype.Eb=function(){return this},vX.prototype.rc=h,vX.prototype.Zb=function(n,e){return null==e||Tf(e)?qT(this.qe,B(e)):Nr},vX.prototype.$b=function(e,t){return n.b?n.b(this.qe,t):n.call(null,this.qe,t)},vX.Pa=function(){return new Q(null,3,5,R,[Pp,Sv,fU],null)},vX.Ia=!0,vX.Da="cljs.spec.alpha/t_cljs$spec$alpha13104",vX.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha13104")}),new vX(e,t,S)};Z(Ls,O(YG,O(Cm,new Q(null,1,5,R,[dU],null),O(Cs,O(Tw,ur,dU),O(Tw,rr,dU))),O(Cm,new Q(null,1,5,R,[LH],null),O(Tw,O(W,new Q(null,1,5,R,[new Q(null,2,5,R,[Lp,Jp],null)],null),new n(null,2,[ur,Lp,rr,Jp],null)),LH))),NS(O(YG,O(W,new Q(null,1,5,R,[V],null),O(Cs,O(Tw,ur,V),O(Tw,rr,V))),O(W,new Q(null,1,5,R,[V],null),O(Tw,O(W,new Q(null,1,5,R,[new Q(null,2,5,R,[Lp,Jp],null)],null),new n(null,2,[ur,Lp,rr,Jp],null)),V))),(function(n){return Ik(Wh.b(ur,n),Wh.b(rr,n))}),null,!0,(function(e){return Wh.b((function(e){var t=J(e,0,null);return e=J(e,1,null),new n(null,2,[ur,t,rr,e],null)}),e)})));var rT=function n(e,r,i){var o=new xl((function(){return OS.b(r,e)}));return void 0!==Ac&&void 0!==nS&&void 0!==oS&&void 0!==SY||((SY=function(n,e,t,r,i){this.form=n,this.Sb=e,this.jb=t,this.Sd=r,this.Zg=i,this.h=393216,this.I=0}).prototype.O=function(n,e){return new SY(this.form,this.Sb,this.jb,this.Sd,e)},SY.prototype.N=function(){return this.Zg},SY.prototype.Db=function(){return this},SY.prototype.Eb=function(){return this},SY.prototype.rc=h,SY.prototype.Zb=function(n,e){return null==e?null:zS(t(this.Sd),e)},SY.prototype.$b=function(e,t){return n.c?n.c(this.form,this.Sb,t):n.call(null,this.form,this.Sb,t)},SY.Pa=function(){return new Q(null,5,5,R,[wF,Oo,Sv,hy,kI],null)},SY.Ia=!0,SY.Da="cljs.spec.alpha/t_cljs$spec$alpha13317",SY.Ja=function(n){return ce(n,"cljs.spec.alpha/t_cljs$spec$alpha13317")}),new SY(e,r,i,o,S)};Z(Uz,Bo,Vc),Z(zF,Bo,Vc),Z(yB,Gw,yg),Z(fq,lI,Uc),Z(ay,O(wt,ir,new Q(null,3,5,R,[Uz,zF,yB],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Uz,zF,yB],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,$v)},function(n){return N(n,Rn)},function(n){return N(n,Ln)}],null),function(n){return M(n)&&N(n,$v)&&N(n,Rn)&&N(n,Ln)},I,new Q(null,3,5,R,[Uz,zF,yB],null),null,new Q(null,3,5,R,[$v,Rn,Ln],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,$v)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Rn)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Ln))],null),null]))),Z(GA,Bo,Vc),Z(To,O(vI,GA,O(wt,ir,new Q(null,2,5,R,[fq,ay],null))),eT(O(gr,GA,O(uu,ir,new Q(null,2,5,R,[fq,ay],null))),XS(new Q(null,2,5,R,[GA,O(wt,ir,new Q(null,2,5,R,[fq,ay],null))],null),new Q(null,2,5,R,[GA,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[fq,ay],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,tq)},function(n){return N(n,sD)}],null),function(n){return M(n)&&N(n,tq)&&N(n,sD)},I,new Q(null,2,5,R,[fq,ay],null),null,new Q(null,2,5,R,[tq,sD],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,tq)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,sD))],null),null]))],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,GA,O(wt,ir,new Q(null,2,5,R,[fq,ay],null)))],null),null)),Z(JA,Bo,Vc),Z(GF,O(CJ,Bo),rT(Bo,Vc,null)),Z(nn,GC,cg),Z(pq,Bo,Vc);var sT,xZ=Oh(S),yZ=Oh(S),zZ=Oh(S),AZ=Oh(S),F0=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));sT=new dm(Me.b(Ta,"address-type"),U,F0,xZ,yZ,zZ,AZ),Z(ws,BI,Wc),sT.v(null,Fs,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[rn,ws],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,lD)}],null),function(n){return M(n)&&N(n,U)&&N(n,lD)},I,new Q(null,2,5,R,[rn,ws],null),null,new Q(null,2,5,R,[U,lD],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,lD))],null),null]))})),Z(Yo,Bo,Vc),sT.v(null,WI,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[rn,zq,Yo],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,Fp)},function(n){return N(n,Yp)}],null),function(n){return M(n)&&N(n,U)&&N(n,Fp)&&N(n,Yp)},I,new Q(null,3,5,R,[rn,zq,Yo],null),null,new Q(null,3,5,R,[U,Fp,Yp],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Fp)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Yp))],null),null]))})),sT.v(null,Zv,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[rn],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,U)}],null),function(n){return M(n)&&N(n,U)},I,new Q(null,1,5,R,[rn],null),null,new Q(null,1,5,R,[U],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U))],null),null]))})),sT.v(null,Yp,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[rn,Yo],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,Yp)}],null),function(n){return M(n)&&N(n,U)&&N(n,Yp)},I,new Q(null,2,5,R,[rn,Yo],null),null,new Q(null,2,5,R,[U,Yp],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Yp))],null),null]))})),sT.v(null,em,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[rn],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,U)}],null),function(n){return M(n)&&N(n,U)},I,new Q(null,1,5,R,[rn],null),null,new Q(null,1,5,R,[U],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U))],null),null]))})),Z(av,O(io,XA,U),VS(XA,new Ne((function(){return sT}),XA,Xj([By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[jx,dp,"gateway/state/spec/common.cljc",23,1,10,10,Se,null,p(sT)?sT.ld:null])))),Z(Br,O(io,XA,U),VS(XA,new Ne((function(){return sT}),XA,Xj([By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[jx,dp,"gateway/state/spec/common.cljc",23,1,10,10,Se,null,p(sT)?sT.ld:null])))),Z(Wx,O(vI,O(ZB,UD,Bo,GJ,Qp),BI),eT(O(gr,O(KF,UD,Uy,GJ,ep),qC),XS(new Q(null,2,5,R,[O(ZB,UD,Bo,GJ,Qp),BI],null),new Q(null,2,5,R,[$S(new Q(null,2,5,R,[UD,GJ],null),new Q(null,2,5,R,[Bo,Qp],null),new Q(null,2,5,R,[Vc,Hg],null),null),Wc],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,O(ZB,UD,Bo,GJ,Qp),BI)],null),null)),Z(nH,O(ZB,Po,Bx,Fn,Bo,IJ,XF),$S(new Q(null,3,5,R,[Po,Fn,IJ],null),new Q(null,3,5,R,[Bx,Bo,XF],null),new Q(null,3,5,R,[Qc,Vc,Vf],null),null)),Z(Bp,O(kD,Bo,Hp),bT(new Q(null,2,5,R,[Bo,Hp],null),new Q(null,2,5,R,[Vc,B],null),null)),Z(Xy,Bo,Vc),Z(LI,O(CJ,Hq),rT(Hq,M,null)),Z(nB,nH,nH),Z(tI,nH,nH),Z(bn,O(kD,Qp,O(Cm,new Q(null,1,5,R,[aF],null),O(jG,new Bk(null,new n(null,4,[aI,"null",Tr,"null",Go,"null",Mw,"null"],null),null),aF))),bT(new Q(null,2,5,R,[Qp,O(W,new Q(null,1,5,R,[V],null),O(jG,new Bk(null,new n(null,4,[aI,"null",Tr,"null",Go,"null",Mw,"null"],null),null),V))],null),new Q(null,2,5,R,[Hg,function(e){return N(new Bk(null,new n(null,4,[aI,null,Tr,null,Go,null,Mw,null],null),null),e)}],null),null)),Z(wn,O(hq,JA,Os,VB),eT(JA,JA,new n(null,5,[Zn,VB,NC,function(n){return Rf(n)},Os,Rf,sy,!0,NH,O(hq,JA,Os,VB)],null),null)),Z(Ex,JA,JA),Z(Tp,gq,Sc),Z(In,gq,Sc),Z(ZC,O(wt,ir,new Q(null,2,5,R,[Tp,In],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Tp,In],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,HA)},function(n){return N(n,Zt)}],null),function(n){return M(n)&&N(n,HA)&&N(n,Zt)},I,new Q(null,2,5,R,[Tp,In],null),null,new Q(null,2,5,R,[HA,Zt],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,HA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zt))],null),null]))),Z(WE,O(wt,ir,new Q(null,3,5,R,[Bp,bn,wn],null),iA,new Q(null,6,5,R,[Xy,nB,tI,LI,Ex,ZC],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Bp,bn,wn],null),new Q(null,6,5,R,[Xy,nB,tI,LI,Ex,ZC],null),null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,qJ)},function(n){return N(n,Zz)},function(n){return N(n,tD)}],null),function(n){return M(n)&&N(n,qJ)&&N(n,Zz)&&N(n,tD)},new Q(null,6,5,R,[yw,gz,Ys,yn,oA,Ln],null),new Q(null,3,5,R,[Bp,bn,wn],null),null,new Q(null,3,5,R,[qJ,Zz,tD],null),new Q(null,6,5,R,[Xy,nB,tI,LI,Ex,ZC],null),new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,tD))],null),null]))),Z(Gy,O(vI,Bp,WE),eT(O(gr,Bp,WE),XS(new Q(null,2,5,R,[Bp,WE],null),new Q(null,2,5,R,[Bp,WE],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,Bp,WE)],null),null)),Z(Rr,GC,cg),Z(EH,Bo,Vc),Z(cw,O(vI,lI,BI),eT(O(gr,CA,qC),XS(new Q(null,2,5,R,[lI,BI],null),new Q(null,2,5,R,[Uc,Wc],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,lI,BI)],null),null)),Z(fJ,O(vI,lI,BI),eT(O(gr,CA,qC),XS(new Q(null,2,5,R,[lI,BI],null),new Q(null,2,5,R,[Uc,Wc],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,lI,BI)],null),null)),Z(Nq,O(wt,ir,new Q(null,2,5,R,[Rr,EH],null),iA,new Q(null,2,5,R,[cw,fJ],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Rr,EH],null),new Q(null,2,5,R,[cw,fJ],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,qJ)},function(n){return N(n,KH)}],null),function(n){return M(n)&&N(n,qJ)&&N(n,KH)},new Q(null,2,5,R,[PH,fv],null),new Q(null,2,5,R,[Rr,EH],null),null,new Q(null,2,5,R,[qJ,KH],null),new Q(null,2,5,R,[cw,fJ],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,KH))],null),null]))),Z(hF,O(vI,EH,Nq),eT(O(gr,EH,Nq),XS(new Q(null,2,5,R,[EH,Nq],null),new Q(null,2,5,R,[EH,Nq],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,EH,Nq)],null),null)),Z(AA,Bo,Vc),Z(yv,AA,AA),Z(Wr,O(vI,lI,lI),eT(O(gr,CA,CA),XS(new Q(null,2,5,R,[lI,lI],null),new Q(null,2,5,R,[Uc,Uc],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,lI,lI)],null),null)),Z(Gv,O(wt,ir,new Q(null,1,5,R,[AA],null),iA,new Q(null,2,5,R,[yv,Wr],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[AA],null),new Q(null,2,5,R,[yv,Wr],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,U)}],null),function(n){return M(n)&&N(n,U)},new Q(null,2,5,R,[yw,PH],null),new Q(null,1,5,R,[AA],null),null,new Q(null,1,5,R,[U],null),new Q(null,2,5,R,[yv,Wr],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U))],null),null]))),Z(Sq,Gv,Gv),Z(Ft,O(hq,Gv,Os,XF),eT(Gv,Gv,new n(null,5,[Zn,XF,NC,function(n){return Vf(n)},Os,Vf,sy,!0,NH,O(hq,Gv,Os,XF)],null),null)),Z(PD,O(vI,lI,lI),eT(O(gr,CA,CA),XS(new Q(null,2,5,R,[lI,lI],null),new Q(null,2,5,R,[Uc,Uc],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,lI,lI)],null),null)),Z(Eq,nH,nH),Z(VD,O(wt,ir,new Q(null,2,5,R,[yv,Sq],null),iA,new Q(null,3,5,R,[Ft,PD,Eq],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[yv,Sq],null),new Q(null,3,5,R,[Ft,PD,Eq],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,yw)},function(n){return N(n,uH)}],null),function(n){return M(n)&&N(n,yw)&&N(n,uH)},new Q(null,3,5,R,[aG,Rz,Kx],null),new Q(null,2,5,R,[yv,Sq],null),null,new Q(null,2,5,R,[yw,uH],null),new Q(null,3,5,R,[Ft,PD,Eq],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uH))],null),null]))),Z(dv,Bo,Vc),Z(tr,O(vI,dv,O(vI,AA,VD)),eT(O(gr,dv,O(HF,AA,VD)),XS(new Q(null,2,5,R,[dv,O(vI,AA,VD)],null),new Q(null,2,5,R,[dv,eT(O(gr,AA,VD),XS(new Q(null,2,5,R,[AA,VD],null),new Q(null,2,5,R,[AA,VD],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,AA,VD)],null),null)],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,dv,O(vI,AA,VD))],null),null)),Z(Cn,Bo,Vc),Z(ht,Bp,Bp),Z(Tq,JA,JA),Z(Sy,JA,JA),Z(mr,O(hq,JA,Os,VB),eT(JA,JA,new n(null,5,[Zn,VB,NC,function(n){return Rf(n)},Os,Rf,sy,!0,NH,O(hq,JA,Os,VB)],null),null)),Z(NA,O(hq,JA,Os,VB),eT(JA,JA,new n(null,5,[Zn,VB,NC,function(n){return Rf(n)},Os,Rf,sy,!0,NH,O(hq,JA,Os,VB)],null),null)),Z(RB,WE,WE),Z(sI,O(wt,ir,new Q(null,3,5,R,[AA,RB,Sy],null),iA,new Q(null,3,5,R,[NA,oC,wu],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[AA,RB,Sy],null),new Q(null,3,5,R,[NA,oC,wu],null),null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,fI)},function(n){return N(n,oA)}],null),function(n){return M(n)&&N(n,U)&&N(n,fI)&&N(n,oA)},new Q(null,3,5,R,[fs,Iw,YC],null),new Q(null,3,5,R,[AA,RB,Sy],null),null,new Q(null,3,5,R,[U,fI,oA],null),new Q(null,3,5,R,[NA,oC,wu],null),new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,oA))],null),null]))),Z(wu,O(vI,Cn,sI),eT(O(gr,Cn,sI),XS(new Q(null,2,5,R,[Cn,sI],null),new Q(null,2,5,R,[Cn,sI],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,Cn,sI)],null),null)),Z(Jy,Cn,Cn),Z(GB,jH,Zf),Z(lB,O(wt,ir,new Q(null,4,5,R,[Cn,AA,Mq,Tq],null),iA,new Q(null,5,5,R,[GB,Sy,NA,mr,wu],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,4,5,R,[Cn,AA,Mq,Tq],null),new Q(null,5,5,R,[GB,Sy,NA,mr,wu],null),null,new Q(null,5,5,R,[function(n){return M(n)},function(n){return N(n,qJ)},function(n){return N(n,U)},function(n){return N(n,ap)},function(n){return N(n,ln)}],null),function(n){return M(n)&&N(n,qJ)&&N(n,U)&&N(n,ap)&&N(n,ln)},new Q(null,5,5,R,[Io,oA,fs,zG,YC],null),new Q(null,4,5,R,[Cn,AA,Mq,Tq],null),null,new Q(null,4,5,R,[qJ,U,ap,ln],null),new Q(null,5,5,R,[GB,Sy,NA,mr,wu],null),new Q(null,5,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ap)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ln))],null),null]))),Z(vE,O(vI,Cn,lB),eT(O(gr,Cn,lB),XS(new Q(null,2,5,R,[Cn,lB],null),new Q(null,2,5,R,[Cn,lB],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,Cn,lB)],null),null)),Z(DD,O(wt,iA,new Q(null,1,5,R,[hF],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,1,5,R,[hF],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,1,5,R,[ZF],null),I,null,I,new Q(null,1,5,R,[hF],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(DB,O(vI,O(ZB,U,AA,yC,O($A,pH,yC)),O(hq,JA,Os,VB)),eT(O(gr,O(KF,U,AA,yC,O(Ou,lF,yC)),O(mz,JA,Os,KA)),XS(new Q(null,2,5,R,[O(ZB,U,AA,yC,O($A,pH,yC)),O(hq,JA,Os,VB)],null),new Q(null,2,5,R,[$S(new Q(null,2,5,R,[U,yC],null),new Q(null,2,5,R,[AA,O($A,pH,yC)],null),new Q(null,2,5,R,[AA,Jh(A,yC)],null),null),eT(JA,JA,new n(null,5,[Zn,VB,NC,function(n){return Rf(n)},Os,Rf,sy,!0,NH,O(hq,JA,Os,VB)],null),null)],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,O(ZB,U,AA,yC,O($A,pH,yC)),O(hq,JA,Os,VB))],null),null)),Z(RG,GC,cg),Z(uB,Bo,Vc),Z(Uo,GC,cg),Z(KD,Bo,Vc),Z(lr,Bo,Vc),Z(xE,Bo,Vc),Z(hv,Bo,Vc),Z(LD,O(wt,ir,new Q(null,6,5,R,[RG,uB,Uo,mp,KD,lr],null),iA,new Q(null,3,5,R,[xE,hv,nH],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,6,5,R,[RG,uB,Uo,mp,KD,lr],null),new Q(null,3,5,R,[xE,hv,nH],null),null,new Q(null,7,5,R,[function(n){return M(n)},function(n){return N(n,qJ)},function(n){return N(n,yw)},function(n){return N(n,Ln)},function(n){return N(n,fv)},function(n){return N(n,vp)},function(n){return N(n,up)}],null),function(n){return M(n)&&N(n,qJ)&&N(n,yw)&&N(n,Ln)&&N(n,fv)&&N(n,vp)&&N(n,up)},new Q(null,3,5,R,[Uv,Rn,os],null),new Q(null,6,5,R,[RG,uB,Uo,mp,KD,lr],null),null,new Q(null,6,5,R,[qJ,yw,Ln,fv,vp,up],null),new Q(null,3,5,R,[xE,hv,nH],null),new Q(null,7,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Ln)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fv)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,vp)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,up))],null),null]))),Z(XH,O(ZB,kB,dD,xo,O(vI,RG,LD)),$S(new Q(null,2,5,R,[kB,xo],null),new Q(null,2,5,R,[dD,O(vI,RG,LD)],null),new Q(null,2,5,R,[Pf,eT(O(gr,RG,LD),XS(new Q(null,2,5,R,[RG,LD],null),new Q(null,2,5,R,[RG,LD],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,RG,LD)],null),null)],null),null)),Z(Qs,O(vI,JA,XH),eT(O(gr,JA,XH),XS(new Q(null,2,5,R,[JA,XH],null),new Q(null,2,5,R,[JA,XH],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,JA,XH)],null),null)),Z($G,RG,RG),Z(vy,GF,GF),Z(EI,GF,GF),Z(gG,GF,GF),Z(py,JA,JA),Z(dr,O(wt,ir,new Q(null,3,5,R,[py,$G,vy],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[py,$G,vy],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Yr)},function(n){return N(n,MI)},function(n){return N(n,qu)}],null),function(n){return M(n)&&N(n,Yr)&&N(n,MI)&&N(n,qu)},I,new Q(null,3,5,R,[py,$G,vy],null),null,new Q(null,3,5,R,[Yr,MI,qu],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Yr)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qu))],null),null]))),Z(Vo,O(vI,gG,dr),eT(O(gr,gG,dr),XS(new Q(null,2,5,R,[gG,dr],null),new Q(null,2,5,R,[gG,dr],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,gG,dr)],null),null)),Z(ry,JA,JA),Z($t,O(wt,ir,new Q(null,3,5,R,[ry,$G,gG],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[ry,$G,gG],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Qr)},function(n){return N(n,MI)},function(n){return N(n,is)}],null),function(n){return M(n)&&N(n,Qr)&&N(n,MI)&&N(n,is)},I,new Q(null,3,5,R,[ry,$G,gG],null),null,new Q(null,3,5,R,[Qr,MI,is],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Qr)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is))],null),null]))),Z(BE,O(vI,vy,$t),eT(O(gr,vy,$t),XS(new Q(null,2,5,R,[vy,$t],null),new Q(null,2,5,R,[vy,$t],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,vy,$t)],null),null)),Z(mD,Bo,Vc),Z(oD,mD,mD),Z(Es,JA,JA),Z(bq,O(wt,ir,new Q(null,3,5,R,[Es,$G,gG],null),iA,new Q(null,1,5,R,[oD],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Es,$G,gG],null),new Q(null,1,5,R,[oD],null),null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,vo)},function(n){return N(n,MI)},function(n){return N(n,is)}],null),function(n){return M(n)&&N(n,vo)&&N(n,MI)&&N(n,is)},new Q(null,1,5,R,[sJ],null),new Q(null,3,5,R,[Es,$G,gG],null),null,new Q(null,3,5,R,[vo,MI,is],null),new Q(null,1,5,R,[oD],null),new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,vo)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is))],null),null]))),Z(RA,O(vI,EI,bq),eT(O(gr,EI,bq),XS(new Q(null,2,5,R,[EI,bq],null),new Q(null,2,5,R,[EI,bq],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,EI,bq)],null),null)),Z(Ho,JA,JA),Z(Vq,O(wt,Oq,new Q(null,2,5,R,[Ho,RG],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,null,null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},I,I,null,I,I,new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(gy,O(vI,EI,Vq),eT(O(gr,EI,Vq),XS(new Q(null,2,5,R,[EI,Vq],null),new Q(null,2,5,R,[EI,Vq],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,EI,Vq)],null),null)),Z(gF,O(vI,JA,O(hq,EI,Os,VB)),eT(O(gr,JA,O(mz,EI,Os,KA)),XS(new Q(null,2,5,R,[JA,O(hq,EI,Os,VB)],null),new Q(null,2,5,R,[JA,eT(EI,EI,new n(null,5,[Zn,VB,NC,function(n){return Rf(n)},Os,Rf,sy,!0,NH,O(hq,EI,Os,VB)],null),null)],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,JA,O(hq,EI,Os,VB))],null),null)),Z(aJ,O(vI,mD,gF),eT(O(gr,mD,gF),XS(new Q(null,2,5,R,[mD,gF],null),new Q(null,2,5,R,[mD,gF],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,mD,gF)],null),null)),Z(sF,O(wt,iA,new Q(null,7,5,R,[nH,Qs,Vo,BE,RA,gy,aJ],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,7,5,R,[nH,Qs,Vo,BE,RA,gy,aJ],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,7,5,R,[os,Zw,jA,Xw,qy,$n,AD],null),I,null,I,new Q(null,7,5,R,[nH,Qs,Vo,BE,RA,gy,aJ],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(eo,GF,GF),Z(Az,Bo,Vc),Z(yq,BI,Wc),Z(XI,O(wt,ir,new Q(null,1,5,R,[Az],null),iA,new Q(null,2,5,R,[yq,Ey],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Az],null),new Q(null,2,5,R,[yq,Ey],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Zo)}],null),function(n){return M(n)&&N(n,Zo)},new Q(null,2,5,R,[mF,MH],null),new Q(null,1,5,R,[Az],null),null,new Q(null,1,5,R,[Zo],null),new Q(null,2,5,R,[yq,Ey],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zo))],null),null]))),Z(Ss,O(vI,eo,XI),eT(O(gr,eo,XI),XS(new Q(null,2,5,R,[eo,XI],null),new Q(null,2,5,R,[eo,XI],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,eo,XI)],null),null)),Z(ZG,O(wt,iA,new Q(null,1,5,R,[Ss],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,1,5,R,[Ss],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,1,5,R,[qy],null),I,null,I,new Q(null,1,5,R,[Ss],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(dE,Bo,Vc),Z(mB,GC,cg),Z(Qz,JA,JA),Z(VC,GF,GF),Z(Kv,O(wt,ir,new Q(null,2,5,R,[Qz,VC],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Qz,VC],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,hD)},function(n){return N(n,AH)}],null),function(n){return M(n)&&N(n,hD)&&N(n,AH)},I,new Q(null,2,5,R,[Qz,VC],null),null,new Q(null,2,5,R,[hD,AH],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,hD)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,AH))],null),null]))),Z(eH,GF,GF),Z(Ns,Bo,Vc),Z(eF,jH,Zf),Z($r,O(wt,Oq,new Q(null,2,5,R,[Ns,eF],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,null,null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},I,I,null,I,I,new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(Fu,dE,dE),Z(tu,new Bk(null,new n(null,2,[BB,"null",Tr,"null"],null),null),new Bk(null,new n(null,2,[BB,null,Tr,null],null),null)),Z(Dw,O(wt,ir,new Q(null,2,5,R,[Ns,tu],null),iA,new Q(null,3,5,R,[Yy,$r,EH],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Ns,tu],null),new Q(null,3,5,R,[Yy,$r,EH],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,qJ)},function(n){return N(n,U)}],null),function(n){return M(n)&&N(n,qJ)&&N(n,U)},new Q(null,3,5,R,[gn,Tr,KH],null),new Q(null,2,5,R,[Ns,tu],null),null,new Q(null,2,5,R,[qJ,U],null),new Q(null,3,5,R,[Yy,$r,EH],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U))],null),null]))),Z(Ks,O(vI,eH,Dw),eT(O(gr,eH,Dw),XS(new Q(null,2,5,R,[eH,Dw],null),new Q(null,2,5,R,[eH,Dw],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,eH,Dw)],null),null)),Z(qp,GC,cg),Z(Rt,Dw,Dw),Z(zy,O(wt,ir,new Q(null,2,5,R,[Br,Wx],null),iA,new Q(null,6,5,R,[cD,sF,DD,ZG,Rt,EH],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Br,Wx],null),new Q(null,6,5,R,[cD,sF,DD,ZG,Rt,EH],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,lz)},function(n){return N(n,pD)}],null),function(n){return M(n)&&N(n,lz)&&N(n,pD)},new Q(null,6,5,R,[eI,ip,by,Gq,dH,KH],null),new Q(null,2,5,R,[Br,Wx],null),null,new Q(null,2,5,R,[lz,pD],null),new Q(null,6,5,R,[cD,sF,DD,ZG,Rt,EH],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,lz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD))],null),null]))),Z(dw,O(vI,JA,zy),eT(O(gr,JA,zy),XS(new Q(null,2,5,R,[JA,zy],null),new Q(null,2,5,R,[JA,zy],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,JA,zy)],null),null)),Z(zD,O(vI,O(ZB,Ot,Bo,Iu,new Bk(null,new n(null,1,[Qy,"null"],null),null)),O(hq,JA)),eT(O(gr,O(KF,Ot,Uy,Iu,new Bk(null,new n(null,1,[Qy,"null"],null),null)),O(mz,JA)),XS(new Q(null,2,5,R,[O(ZB,Ot,Bo,Iu,new Bk(null,new n(null,1,[Qy,"null"],null),null)),O(hq,JA)],null),new Q(null,2,5,R,[$S(new Q(null,2,5,R,[Ot,Iu],null),new Q(null,2,5,R,[Bo,new Bk(null,new n(null,1,[Qy,"null"],null),null)],null),new Q(null,2,5,R,[Vc,new Bk(null,new n(null,1,[Qy,null],null),null)],null),null),eT(JA,JA,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,JA)],null),null)],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,O(ZB,Ot,Bo,Iu,new Bk(null,new n(null,1,[Qy,"null"],null),null)),O(hq,JA))],null),null)),Z(rB,O(hq,JA),eT(JA,JA,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,JA)],null),null)),Z(au,Gy,Gy),Z(rG,tr,tr),Z(Fo,DB,DB),Z(cs,O(vI,Wx,JA),eT(O(gr,Wx,JA),XS(new Q(null,2,5,R,[Wx,JA],null),new Q(null,2,5,R,[Wx,JA],null)),new n(null,7,[uC,S,Zn,Hq,NC,function(n){return M(n)},Os,M,QF,function(n,e){return pf(e,0)},sy,!0,NH,O(vI,Wx,JA)],null),null)),Z(OI,BI,Wc),Z(Lw,Bo,Vc),Z(bH,Gw,yg),Z(nw,O(wt,ir,new Q(null,2,5,R,[Lw,bH],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Lw,bH],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,$y)},function(n){return N(n,Qq)}],null),function(n){return M(n)&&N(n,$y)&&N(n,Qq)},I,new Q(null,2,5,R,[Lw,bH],null),null,new Q(null,2,5,R,[$y,Qq],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,$y)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Qq))],null),null]))),Z(gp,Bo,Vc),Z(wp,O(wt,ir,new Q(null,2,5,R,[nw,gp],null),iA,new Q(null,11,5,R,[OI,To,dw,zD,rB,cs,au,Ks,vE,rG,Fo],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[nw,gp],null),new Q(null,11,5,R,[OI,To,dw,zD,rB,cs,au,Ks,vE,rG,Fo],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Mx)},function(n){return N(n,pn)}],null),function(n){return M(n)&&N(n,Mx)&&N(n,pn)},new Q(null,11,5,R,[er,pz,Dn,Av,bt,vu,ao,aC,vs,Vr,EF],null),new Q(null,2,5,R,[nw,gp],null),null,new Q(null,2,5,R,[Mx,pn],null),new Q(null,11,5,R,[OI,To,dw,zD,rB,cs,au,Ks,vE,rG,Fo],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Mx)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pn))],null),null]))),Z(NE,Bo,Vc),Z(Tm,Qp,Hg);var yT,G0=Oh(S),H0=Oh(S),I0=Oh(S),J0=Oh(S),e2=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));function ET(n){if(null!=n&&null!=n.Yc)n=n.Yc(n);else{var e=ET[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=ET._))throw Zc("Domain.info",n);n=e.a?e.a(n):e.call(null,n)}}return n}function FT(n,e){if(null!=n&&null!=n.Zc)n=n.Zc(n,e);else{var t=FT[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=FT._))throw Zc("Domain.init",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function GT(n,e){if(null!=n&&null!=n.Wc)n=n.Wc(n,e);else{var t=GT[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=GT._))throw Zc("Domain.destroy",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function HT(n,e,t){if(null!=n&&null!=n.Xc)n=n.Xc(n,e,t);else{var r=HT[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=HT._))throw Zc("Domain.handle-message",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}function IT(n,e,t,r,i,o,l){this.id=n,this.fc=e,this.source=t,this.options=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}yT=new dm(Me.b(ta,"message-body"),U,e2,G0,H0,I0,J0),Z(QD,Bo,Vc),Z(dC,Bo,Vc),Z(Nt,O(CJ,JA),rT(JA,JA,null)),Z(kG,O(wt,ir,new Q(null,2,5,R,[NE,Tm],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[NE,Tm],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,tq)},function(n){return N(n,U)}],null),function(n){return M(n)&&N(n,tq)&&N(n,U)},I,new Q(null,2,5,R,[NE,Tm],null),null,new Q(null,2,5,R,[tq,U],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,tq)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U))],null),null]))),Z(Wp,O(wt,ir,new Q(null,2,5,R,[GF,JA],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[GF,JA],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,is)},function(n){return N(n,ow)}],null),function(n){return M(n)&&N(n,is)&&N(n,ow)},I,new Q(null,2,5,R,[GF,JA],null),null,new Q(null,2,5,R,[is,ow],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow))],null),null]))),Z(On,O(wt,ir,new Q(null,1,5,R,[JA],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[JA],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,ow)}],null),function(n){return M(n)&&N(n,ow)},I,new Q(null,1,5,R,[JA],null),null,new Q(null,1,5,R,[ow],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow))],null),null]))),Z(rs,O(xv,kG,On),cT(new Q(null,2,5,R,[kG,On],null),new Q(null,2,5,R,[kG,On],null),null)),Z(tv,O(xv,kG,On,O(wt,ir,new Q(null,1,5,R,[GF],null))),cT(new Q(null,3,5,R,[kG,On,O(wt,ir,new Q(null,1,5,R,[GF],null))],null),new Q(null,3,5,R,[kG,On,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[GF],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,is)}],null),function(n){return M(n)&&N(n,is)},I,new Q(null,1,5,R,[GF],null),null,new Q(null,1,5,R,[is],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is))],null),null]))],null),null)),yT.v(null,IA,(function(){return cT(new Q(null,2,5,R,[kG,O(wt,ir,new Q(null,2,5,R,[QD,dC],null),iA,new Q(null,1,5,R,[Nt],null))],null),new Q(null,2,5,R,[kG,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[QD,dC],null),new Q(null,1,5,R,[Nt],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,uE)&&N(n,kJ)},new Q(null,1,5,R,[ow],null),new Q(null,2,5,R,[QD,dC],null),null,new Q(null,2,5,R,[uE,kJ],null),new Q(null,1,5,R,[Nt],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)})),yT.v(null,qz,(function(){return cT(new Q(null,2,5,R,[kG,O(wt,iA,new Q(null,1,5,R,[Nt],null))],null),new Q(null,2,5,R,[kG,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,1,5,R,[Nt],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,1,5,R,[ow],null),I,null,I,new Q(null,1,5,R,[Nt],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))],null),null)})),Z(YI,O(io,Ir,U),VS(Ir,new Ne((function(){return yT}),Ir,Xj([By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[CB,so,"gateway/common/spec/messages.cljc",23,1,8,8,Se,null,p(yT)?yT.ld:null])))),Z(DJ,av,av),Z(TC,O(wt,ir,new Q(null,2,5,R,[Br,YI],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Br,YI],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,lz)},function(n){return N(n,Xv)}],null),function(n){return M(n)&&N(n,lz)&&N(n,Xv)},I,new Q(null,2,5,R,[Br,YI],null),null,new Q(null,2,5,R,[lz,Xv],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,lz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Xv))],null),null]))),Z(rv,O(wt,ir,new Q(null,2,5,R,[DJ,YI],null),iA,new Q(null,1,5,R,[Br],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[DJ,YI],null),new Q(null,1,5,R,[Br],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Fy)},function(n){return N(n,Xv)}],null),function(n){return M(n)&&N(n,Fy)&&N(n,Xv)},new Q(null,1,5,R,[lz],null),new Q(null,2,5,R,[DJ,YI],null),null,new Q(null,2,5,R,[Fy,Xv],null),new Q(null,1,5,R,[Br],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Fy)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Xv))],null),null]))),Z(wy,O(CJ,O(hq,rv)),rT(O(hq,rv),eT(rv,rv,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,rv)],null),null),null)),Z(bB,jH,Zf),Z(hE,O(wt,ir,new Q(null,1,5,R,[bB],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[bB],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Fs)}],null),function(n){return M(n)&&N(n,Fs)},I,new Q(null,1,5,R,[bB],null),null,new Q(null,1,5,R,[Fs],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Fs))],null),null]))),yT.v(null,SE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[iD,Wx,hE],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[iD,Wx,hE],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,dB)},function(n){return N(n,pD)},function(n){return N(n,Mc)}],null),function(n){return M(n)&&N(n,dB)&&N(n,pD)&&N(n,Mc)},I,new Q(null,3,5,R,[iD,Wx,hE],null),null,new Q(null,3,5,R,[dB,pD,Mc],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,dB)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Mc))],null),null]))],null),null)})),Z(cF,JA,JA),yT.v(null,mE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[cF,QD,dC],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[cF,QD,dC],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,EJ)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,EJ)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[cF,QD,dC],null),null,new Q(null,3,5,R,[EJ,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,EJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)})),Z(mx,O(CJ,O(gr,O(CJ,wp),O(CJ,O(hq,rv)))),rT(O(gr,O(CJ,wp),O(CJ,O(hq,rv))),XS(new Q(null,2,5,R,[O(CJ,wp),O(CJ,O(hq,rv))],null),new Q(null,2,5,R,[rT(wp,wp,null),rT(O(hq,rv),eT(rv,rv,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,rv)],null),null),null)],null)),null)),g=IT.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"id":return this.id;case"identity":return this.fc;case"source":return this.source;case"options":return this.options;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#gateway.state.peers.Peer{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[qJ,this.id],null),new Q(null,2,5,R,[pD,this.fc],null),new Q(null,2,5,R,[lz,this.source],null),new Q(null,2,5,R,[eI,this.options],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[qJ,pD,lz,eI],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=802532213^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.id,e.id)&&A.b(this.fc,e.fc)&&A.b(this.source,e.source)&&A.b(this.options,e.options)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[pD,null,lz,null,qJ,null,eI,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new IT(this.id,this.fc,this.source,this.options,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(qJ,e):P.call(null,qJ,e))?new IT(t,this.fc,this.source,this.options,this.Mb,this.j,null):p(P.b?P.b(pD,e):P.call(null,pD,e))?new IT(this.id,t,this.source,this.options,this.Mb,this.j,null):p(P.b?P.b(lz,e):P.call(null,lz,e))?new IT(this.id,this.fc,t,this.options,this.Mb,this.j,null):p(P.b?P.b(eI,e):P.call(null,eI,e))?new IT(this.id,this.fc,this.source,t,this.Mb,this.j,null):new IT(this.id,this.fc,this.source,this.options,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(qJ,this.id),new Gi(pD,this.fc),new Gi(lz,this.source),new Gi(eI,this.options)],null),this.j))},g.O=function(n,e){return new IT(this.id,this.fc,this.source,this.options,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)};var JT=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function KT(n,e){if(null==e)throw im("Peer id is missing",S);if(p(n=JT.b(n,e)))return n;throw im(["Unable to find peer with id ",q.a(e)].join(""),S)}function LT(n,e,t){if(null==e)throw im("Peer id is missing",S);if(p(n=JT.c(n,e,t)))return n;throw im(["Unable to find peer with id ",q.a(e)," in domain ",q.a(t)].join(""),S)}function MT(n){return A.b(Fs,mi.b(n,new Q(null,2,5,R,[lz,U],null)))}function NT(n,e){return Dl(G([Wh.a(Jh(JT,n)),mi.b(n,new Q(null,2,5,R,[zr,e],null))]))}function OT(n,e){var t=U.a(e);switch(t instanceof z?t.da:null){case"node":return A.b(Yp.a(e),Yp.a(n));case"peer":return A.b(Yp.a(e),Yp.a(n))&&A.b(Fp.a(e),Fp.a(n));case"local":return A.b(lD.a(e),lD.a(n));default:return!1}}function PT(n,e){return Dl(G([Ih.b(Wh.a(Qi),fi.a((function(n){return OT(lz.a(n),e)}))),Dn.a(n)]))}function QT(n,e,t){return Dl(G([fi.a((function(n){return OT(lz.a(n),e)})),NT(n,t)]))}function RT(n,e,t,r,i,o){var l,u=JT.b(n,t);if(p(u)){var s=u;return new Q(null,2,5,R,[n,s],null)}l=new IT(t,r,e,o,null,null,null),s=p(i)?K.c(l,dH,i):l;var a=dt.b(r,Qy);return u=function(){var e=ni(oi.A(ni(n,new Q(null,2,5,R,[vu,r],null),t),new Q(null,2,5,R,[Av,a],null),Mh(Cf,Dk),t),new Q(null,2,5,R,[Dn,t],null),s);return p(po.a(o))?qi(e,bt,Mh(Cf,Dk),t):e}(),new Q(null,2,5,R,[u,s],null)}function ST(n,e){var t=pD.a(e),r=qJ.a(e),i=dt.b(t,Qy);return qi(qi(pi(qi(n,vu,Hf,t),Av,(function(n){var e=Of.b(x.b(n,i),r);return B(e)?K.c(n,i,e):Hf.b(n,i)})),Dn,Hf,r),bt,Mh(Of,Dk),r)}function TT(n,e,t){return ni(n,new Q(null,2,5,R,[Dn,e],null),t)}function UT(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return ih(oi,arguments[0],new Q(null,2,5,R,[Dn,arguments[1]],null),arguments[2],3<e.length?new Qe(e.slice(3),0,null):null)}JT.b=function(n,e){return p(e)?mi.b(n,new Q(null,2,5,R,[Dn,e],null)):null},JT.c=function(n,e,t){return n=JT.b(n,e),p(x.b(n,t))?n:null},JT.F=3;var VT=function n(e){switch(arguments.length){case 6:return n.la(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function WT(n,e,t,r){return Dl(G([fi.a((function(n){var i=VT.c(e,t,n);return p(i)?i:p(r)?A.b(qJ.a(n),qJ.a(t)):r})),Xg.b(NT(n,e),Wh.b(Jh(JT,n),bt.a(n)))]))}function XT(n,e,t,r){if(p(mi.b(t,new Q(null,2,5,R,[eI,po],null))))return WT(n,e,t,r);var i=mi.b(t,new Q(null,2,5,R,[pD,dt],null));return p(i)?Dl(G([Ih.b(Wh.a(Jh(JT,n)),fi.a((function(n){var i=x.b(n,e);return i=p(i)?VT.c(e,t,n):i,p(i)?i:p(r)?A.b(qJ.a(n),qJ.a(t)):r}))),Xg.b(mi.b(n,new Q(null,2,5,R,[Av,i],null)),bt.a(n))])):WT(n,e,t,r)}function YT(e,t,r,i,o){return gd.c((function(t,r){var l=pD.a(r),u=qJ.a(r),s=qJ.a(o),a=MT(o);return t=a?Cf.b(t,AL.la(e,i,s,u,l,new n(null,1,[Fs,a],null))):t,MT(r)?Cf.b(t,AL.la(e,lz.a(r),u,s,pD.a(o),new n(null,1,[Fs,a],null))):t}),I,XT(r,t,o,!1))}function ZT(n,e,t,r,i,o){var l=qJ.a(r);return new Q(null,2,5,R,[pL(t,l,e),gd.c((function(e,t){return e=Cf.b(e,BL.K(n,lz.a(t),qJ.a(t),l,i)),Tc(o)?Cf.b(e,BL.K(n,lz.a(r),l,qJ.a(t),i)):e}),I,XT(t,e,r,!1))],null)}function $T(n,e){var t=gh(Jk,n,e);return vf(t,gi.b((function(n){return t===n}),e))}function aU(n,e){return F(n)<F(e)?gd.c(Cf,e,n):gd.c(Cf,n,e)}function bU(n,e,t){return n=$T(F,Cf.g(t,e,G([n]))),gd.c(ji,C(n),Re(n))}VT.la=function(n,e,t,r,i,o){return null==e&&null==i?(r=dt.a(r),n=dt.a(n),p(o)?o:p(t)?t:A.b(r,n)):p(t=mS(e,n,r))?mS(i,r,n):t},VT.c=function(n,e,t){var r=pD.a(e),i=mi.b(e,new Q(null,2,5,R,[n,os],null)),o=mi.b(e,new Q(null,2,5,R,[eI,po],null)),l=pD.a(t);n=mi.b(t,new Q(null,2,5,R,[n,os],null));var u=mi.b(t,new Q(null,2,5,R,[eI,po],null));return!!kh.b(qJ.a(t),qJ.a(e))&&VT.la(r,i,o,l,n,u)},VT.F=6;var cU={},Z2,F3,R4,X4,Y4,$4,jU=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};jU.g=function(n){return ce(Dc,fh(ql,n))},jU.F=0,jU.G=function(n){return this.g(B(n))};var kU=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};function lU(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;fh(kU,0<e.length?new Qe(e.slice(0),0,null):null),ce(Dc,"\n")}function mU(n){if("number"==typeof n)return n;if("string"==typeof n&&1===n.length)return n.charCodeAt(0);throw Error("Argument to char must be a character or number")}function nU(n,e,t){var r=t;for(t=I;;){if(Pf(r))return new Q(null,2,5,R,[t,e],null);var i=C(r);r=D(r),e=J(i=fh(n,new Q(null,2,5,R,[i,e],null)),0,null),i=J(i,1,null),t=Cf.b(t,e),e=i}}function oU(n,e){var t=e;for(e=I;;){var r=fh(n,new Q(null,1,5,R,[t],null));if(t=J(r,0,null),r=J(r,1,null),Tc(t))return new Q(null,2,5,R,[e,r],null);e=Cf.b(e,t),t=r}}function pU(n){return new Q(null,2,5,R,[ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l),s=J(u,0,null);u=J(u,1,null);var a=J(u,0,null);J(u,1,null),o.add(new Q(null,2,5,R,[s,a],null)),l+=1}return Sg(Ug(o),r?n(se(t)):null)}return o=J(r=C(t),0,null),r=J(r,1,null),i=J(r,0,null),J(r,1,null),vf(new Q(null,2,5,R,[o,i],null),n(Re(t)))}return null}}),null,null)}(n)),ji.b(S,function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l),s=J(u,0,null);u=J(u,1,null),J(u,0,null),u=J(u,1,null),o.add(new Q(null,2,5,R,[s,u],null)),l+=1}return Sg(Ug(o),r?n(se(t)):null)}return o=J(r=C(t),0,null),r=J(r,1,null),J(r,0,null),r=J(r,1,null),vf(new Q(null,2,5,R,[o,r],null),n(Re(t)))}return null}}),null,null)}(n))],null)}function qU(n,e){return ji.b(S,function n(t){return new Mg(null,(function(){for(;;){var r=B(t);if(r){if(Wf(r)){var i=re(r),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),l.add(new Q(null,2,5,R,[a,new Q(null,2,5,R,[s,e],null)],null)),u+=1}return Sg(Ug(l),i?n(se(r)):null)}return l=J(i=C(r),0,null),i=J(i,1,null),vf(new Q(null,2,5,R,[l,new Q(null,2,5,R,[i,e],null)],null),n(Re(r)))}return null}}),null,null)}(n))}function rU(){var n=Dc;if(null!=n&&null!=n.Le)n=n.Le(n);else{var e=rU[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=rU._))throw Zc("IPrettyFlush.-ppflush",n);n=e.a?e.a(n):e.call(null,n)}}return n}function sU(n,e){return n=t(t(n)),e.a?e.a(n):e.call(null,n)}function tU(n,e,r){Rh.A(t(n),K,e,r)}function uU(n,e){return A.b(e,"\n")?(tU(n,kr,0),tU(n,en,sU(n,en)+1)):tU(n,kr,sU(n,kr)+1),ce(sU(n,LA),e)}function vU(e,t){var r=Oh(new n(null,4,[bw,t,kr,0,en,0,LA,e],null));return void 0!==Ac&&void 0!==cU&&void 0!==Z2||((Z2=function(n,e,t,r){this.ya=n,this.Ve=e,this.Vc=t,this.zg=r,this.h=1074167808,this.I=0}).prototype.O=function(n,e){return new Z2(this.ya,this.Ve,this.Vc,e)},Z2.prototype.N=function(){return this.zg},Z2.prototype.zb=function(){return this.Vc},Z2.prototype.qc=function(){return de(this.ya)},Z2.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n)))return 0>(n=e.lastIndexOf("\n"))?tU(this,kr,sU(this,kr)+F(e)):(tU(this,kr,F(e)-n-1),tU(this,en,sU(this,en)+F(fi.b((function(n){return A.b(n,"\n")}),e)))),ce(sU(this,LA),e);if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return uU(this,e);throw Error(["No matching clause: ",q.a(n)].join(""))},Z2.Pa=function(){return new Q(null,4,5,R,[tG,Rp,zu,sS],null)},Z2.Ia=!0,Z2.Da="cljs.pprint/t_cljs$pprint11254",Z2.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint11254")}),new Z2(e,t,r,S)}function wU(n,e,t,r,i,o,l,u,s,a,c,d,h){this.parent=n,this.xb=e,this.lb=t,this.kb=r,this.sb=i,this.tb=o,this.prefix=l,this.wb=u,this.yb=s,this.ub=a,this.Mb=c,this.j=d,this.B=h,this.h=2230716170,this.I=139264}function xU(n,e){for(e=Dq.a(e);;){if(null==e)return!1;if(n===e)return!0;e=Dq.a(e)}}function yU(n,e,t,r,i,o,l,u){this.V=n,this.data=e,this.Ub=t,this.U=r,this.T=i,this.Mb=o,this.j=l,this.B=u,this.h=2230716170,this.I=139264}function zU(n,e,t,r,i,o,l,u){this.V=n,this.type=e,this.ba=t,this.U=r,this.T=i,this.Mb=o,this.j=l,this.B=u,this.h=2230716170,this.I=139264}function AU(n,e,t,r,i,o,l){this.V=n,this.ba=e,this.U=t,this.T=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}function BU(n,e,t,r,i,o,l){this.V=n,this.ba=e,this.U=t,this.T=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}function CU(n,e,t,r,i,o,l,u,s){this.V=n,this.ba=e,this.Jb=t,this.offset=r,this.U=i,this.T=o,this.Mb=l,this.j=u,this.B=s,this.h=2230716170,this.I=139264}kU.g=function(n){return ce(Dc,fh(ol,n))},kU.F=0,kU.G=function(n){return this.g(B(n))},g=wU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"parent":return this.parent;case"section":return this.xb;case"start-col":return this.lb;case"indent":return this.kb;case"done-nl":return this.sb;case"intra-block-nl":return this.tb;case"prefix":return this.prefix;case"per-line-prefix":return this.wb;case"suffix":return this.yb;case"logical-block-callback":return this.ub;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.logical-block{",", ","}",t,Xg.b(new Q(null,10,5,R,[new Q(null,2,5,R,[Dq,this.parent],null),new Q(null,2,5,R,[Ow,this.xb],null),new Q(null,2,5,R,[rC,this.lb],null),new Q(null,2,5,R,[xJ,this.kb],null),new Q(null,2,5,R,[Hn,this.sb],null),new Q(null,2,5,R,[KB,this.tb],null),new Q(null,2,5,R,[SA,this.prefix],null),new Q(null,2,5,R,[sn,this.wb],null),new Q(null,2,5,R,[Yw,this.yb],null),new Q(null,2,5,R,[Ax,this.ub],null)],null),this.j))},g.ua=function(){return new gj(this,10,new Q(null,10,5,R,[Dq,Ow,rC,xJ,Hn,KB,SA,sn,Yw,Ax],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 10+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=1977012399^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.parent,e.parent)&&A.b(this.xb,e.xb)&&A.b(this.lb,e.lb)&&A.b(this.kb,e.kb)&&A.b(this.sb,e.sb)&&A.b(this.tb,e.tb)&&A.b(this.prefix,e.prefix)&&A.b(this.wb,e.wb)&&A.b(this.yb,e.yb)&&A.b(this.ub,e.ub)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,10,[Yw,null,xJ,null,Dq,null,Ow,null,Hn,null,rC,null,SA,null,sn,null,Ax,null,KB,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Dq,e):P.call(null,Dq,e))?new wU(t,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(Ow,e):P.call(null,Ow,e))?new wU(this.parent,t,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(rC,e):P.call(null,rC,e))?new wU(this.parent,this.xb,t,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(xJ,e):P.call(null,xJ,e))?new wU(this.parent,this.xb,this.lb,t,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(Hn,e):P.call(null,Hn,e))?new wU(this.parent,this.xb,this.lb,this.kb,t,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(KB,e):P.call(null,KB,e))?new wU(this.parent,this.xb,this.lb,this.kb,this.sb,t,this.prefix,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(SA,e):P.call(null,SA,e))?new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,t,this.wb,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(sn,e):P.call(null,sn,e))?new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,t,this.yb,this.ub,this.Mb,this.j,null):p(P.b?P.b(Yw,e):P.call(null,Yw,e))?new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,t,this.ub,this.Mb,this.j,null):p(P.b?P.b(Ax,e):P.call(null,Ax,e))?new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,t,this.Mb,this.j,null):new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,10,5,R,[new Gi(Dq,this.parent),new Gi(Ow,this.xb),new Gi(rC,this.lb),new Gi(xJ,this.kb),new Gi(Hn,this.sb),new Gi(KB,this.tb),new Gi(SA,this.prefix),new Gi(sn,this.wb),new Gi(Yw,this.yb),new Gi(Ax,this.ub)],null),this.j))},g.O=function(n,e){return new wU(this.parent,this.xb,this.lb,this.kb,this.sb,this.tb,this.prefix,this.wb,this.yb,this.ub,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=yU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"type-tag":return this.V;case"data":return this.data;case"trailing-white-space":return this.Ub;case"start-pos":return this.U;case"end-pos":return this.T;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.buffer-blob{",", ","}",t,Xg.b(new Q(null,5,5,R,[new Q(null,2,5,R,[Ny,this.V],null),new Q(null,2,5,R,[yn,this.data],null),new Q(null,2,5,R,[bp,this.Ub],null),new Q(null,2,5,R,[VA,this.U],null),new Q(null,2,5,R,[EE,this.T],null)],null),this.j))},g.ua=function(){return new gj(this,5,new Q(null,5,5,R,[Ny,yn,bp,VA,EE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 5+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=1809113693^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.V,e.V)&&A.b(this.data,e.data)&&A.b(this.Ub,e.Ub)&&A.b(this.U,e.U)&&A.b(this.T,e.T)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,5,[EE,null,bp,null,Ny,null,VA,null,yn,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new yU(this.V,this.data,this.Ub,this.U,this.T,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Ny,e):P.call(null,Ny,e))?new yU(t,this.data,this.Ub,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(yn,e):P.call(null,yn,e))?new yU(this.V,t,this.Ub,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(bp,e):P.call(null,bp,e))?new yU(this.V,this.data,t,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(VA,e):P.call(null,VA,e))?new yU(this.V,this.data,this.Ub,t,this.T,this.Mb,this.j,null):p(P.b?P.b(EE,e):P.call(null,EE,e))?new yU(this.V,this.data,this.Ub,this.U,t,this.Mb,this.j,null):new yU(this.V,this.data,this.Ub,this.U,this.T,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,5,5,R,[new Gi(Ny,this.V),new Gi(yn,this.data),new Gi(bp,this.Ub),new Gi(VA,this.U),new Gi(EE,this.T)],null),this.j))},g.O=function(n,e){return new yU(this.V,this.data,this.Ub,this.U,this.T,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=zU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"type-tag":return this.V;case"type":return this.type;case"logical-block":return this.ba;case"start-pos":return this.U;case"end-pos":return this.T;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.nl-t{",", ","}",t,Xg.b(new Q(null,5,5,R,[new Q(null,2,5,R,[Ny,this.V],null),new Q(null,2,5,R,[U,this.type],null),new Q(null,2,5,R,[nq,this.ba],null),new Q(null,2,5,R,[VA,this.U],null),new Q(null,2,5,R,[EE,this.T],null)],null),this.j))},g.ua=function(){return new gj(this,5,new Q(null,5,5,R,[Ny,U,nq,VA,EE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 5+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-1640656800^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.V,e.V)&&A.b(this.type,e.type)&&A.b(this.ba,e.ba)&&A.b(this.U,e.U)&&A.b(this.T,e.T)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,5,[EE,null,U,null,nq,null,Ny,null,VA,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new zU(this.V,this.type,this.ba,this.U,this.T,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Ny,e):P.call(null,Ny,e))?new zU(t,this.type,this.ba,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(U,e):P.call(null,U,e))?new zU(this.V,t,this.ba,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(nq,e):P.call(null,nq,e))?new zU(this.V,this.type,t,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(VA,e):P.call(null,VA,e))?new zU(this.V,this.type,this.ba,t,this.T,this.Mb,this.j,null):p(P.b?P.b(EE,e):P.call(null,EE,e))?new zU(this.V,this.type,this.ba,this.U,t,this.Mb,this.j,null):new zU(this.V,this.type,this.ba,this.U,this.T,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,5,5,R,[new Gi(Ny,this.V),new Gi(U,this.type),new Gi(nq,this.ba),new Gi(VA,this.U),new Gi(EE,this.T)],null),this.j))},g.O=function(n,e){return new zU(this.V,this.type,this.ba,this.U,this.T,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=AU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"type-tag":return this.V;case"logical-block":return this.ba;case"start-pos":return this.U;case"end-pos":return this.T;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.start-block-t{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[Ny,this.V],null),new Q(null,2,5,R,[nq,this.ba],null),new Q(null,2,5,R,[VA,this.U],null),new Q(null,2,5,R,[EE,this.T],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[Ny,nq,VA,EE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-414877272^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.V,e.V)&&A.b(this.ba,e.ba)&&A.b(this.U,e.U)&&A.b(this.T,e.T)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[EE,null,nq,null,Ny,null,VA,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new AU(this.V,this.ba,this.U,this.T,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Ny,e):P.call(null,Ny,e))?new AU(t,this.ba,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(nq,e):P.call(null,nq,e))?new AU(this.V,t,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(VA,e):P.call(null,VA,e))?new AU(this.V,this.ba,t,this.T,this.Mb,this.j,null):p(P.b?P.b(EE,e):P.call(null,EE,e))?new AU(this.V,this.ba,this.U,t,this.Mb,this.j,null):new AU(this.V,this.ba,this.U,this.T,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(Ny,this.V),new Gi(nq,this.ba),new Gi(VA,this.U),new Gi(EE,this.T)],null),this.j))},g.O=function(n,e){return new AU(this.V,this.ba,this.U,this.T,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=BU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"type-tag":return this.V;case"logical-block":return this.ba;case"start-pos":return this.U;case"end-pos":return this.T;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.end-block-t{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[Ny,this.V],null),new Q(null,2,5,R,[nq,this.ba],null),new Q(null,2,5,R,[VA,this.U],null),new Q(null,2,5,R,[EE,this.T],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[Ny,nq,VA,EE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=1365867980^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.V,e.V)&&A.b(this.ba,e.ba)&&A.b(this.U,e.U)&&A.b(this.T,e.T)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[EE,null,nq,null,Ny,null,VA,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new BU(this.V,this.ba,this.U,this.T,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Ny,e):P.call(null,Ny,e))?new BU(t,this.ba,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(nq,e):P.call(null,nq,e))?new BU(this.V,t,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(VA,e):P.call(null,VA,e))?new BU(this.V,this.ba,t,this.T,this.Mb,this.j,null):p(P.b?P.b(EE,e):P.call(null,EE,e))?new BU(this.V,this.ba,this.U,t,this.Mb,this.j,null):new BU(this.V,this.ba,this.U,this.T,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(Ny,this.V),new Gi(nq,this.ba),new Gi(VA,this.U),new Gi(EE,this.T)],null),this.j))},g.O=function(n,e){return new BU(this.V,this.ba,this.U,this.T,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=CU.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"type-tag":return this.V;case"logical-block":return this.ba;case"relative-to":return this.Jb;case"offset":return this.offset;case"start-pos":return this.U;case"end-pos":return this.T;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.indent-t{",", ","}",t,Xg.b(new Q(null,6,5,R,[new Q(null,2,5,R,[Ny,this.V],null),new Q(null,2,5,R,[nq,this.ba],null),new Q(null,2,5,R,[jv,this.Jb],null),new Q(null,2,5,R,[qE,this.offset],null),new Q(null,2,5,R,[VA,this.U],null),new Q(null,2,5,R,[EE,this.T],null)],null),this.j))},g.ua=function(){return new gj(this,6,new Q(null,6,5,R,[Ny,nq,jv,qE,VA,EE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 6+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-1602780238^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.V,e.V)&&A.b(this.ba,e.ba)&&A.b(this.Jb,e.Jb)&&A.b(this.offset,e.offset)&&A.b(this.U,e.U)&&A.b(this.T,e.T)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,6,[qE,null,EE,null,jv,null,nq,null,Ny,null,VA,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new CU(this.V,this.ba,this.Jb,this.offset,this.U,this.T,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(Ny,e):P.call(null,Ny,e))?new CU(t,this.ba,this.Jb,this.offset,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(nq,e):P.call(null,nq,e))?new CU(this.V,t,this.Jb,this.offset,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(jv,e):P.call(null,jv,e))?new CU(this.V,this.ba,t,this.offset,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(qE,e):P.call(null,qE,e))?new CU(this.V,this.ba,this.Jb,t,this.U,this.T,this.Mb,this.j,null):p(P.b?P.b(VA,e):P.call(null,VA,e))?new CU(this.V,this.ba,this.Jb,this.offset,t,this.T,this.Mb,this.j,null):p(P.b?P.b(EE,e):P.call(null,EE,e))?new CU(this.V,this.ba,this.Jb,this.offset,this.U,t,this.Mb,this.j,null):new CU(this.V,this.ba,this.Jb,this.offset,this.U,this.T,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,6,5,R,[new Gi(Ny,this.V),new Gi(nq,this.ba),new Gi(jv,this.Jb),new Gi(qE,this.offset),new Gi(VA,this.U),new Gi(EE,this.T)],null),this.j))},g.O=function(n,e){return new CU(this.V,this.ba,this.Jb,this.offset,this.U,this.T,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)};var DU=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(ca,"write-token"),(function(n,e){return Ny.a(e)}),i,n,e,t,r)}();function FU(n,e,r){e=B(e);for(var i=null,o=0,l=0;;)if(l<o){var u=i.W(null,l);if(!A.b(Ny.a(u),fH)){var s=bp.a(t(t(n)));p(s)&&ce(LA.a(t(t(n))),s)}DU.b(n,u),Rh.A(t(n),K,bp,bp.a(u)),u=bp.a(t(t(n))),p(p(r)?u:r)&&(ce(LA.a(t(t(n))),u),Rh.A(t(n),K,bp,null)),l+=1}else{if(!(e=B(e)))break;Wf(e)?(i=re(e),e=se(e),u=i,o=F(i),i=u):(u=C(e),A.b(Ny.a(u),fH)||p(i=bp.a(t(t(n))))&&ce(LA.a(t(t(n))),i),DU.b(n,u),Rh.A(t(n),K,bp,bp.a(u)),u=bp.a(t(t(n))),p(p(r)?u:r)&&(ce(LA.a(t(t(n))),u),Rh.A(t(n),K,bp,null)),e=D(e),i=null,o=0),l=0}}function GU(n,e){var r,i=sU(LA.a(t(t(n))),bw);return(r=null==i)||(r=(n=sU(LA.a(t(t(n))),kr))+(e=(e=B(e))?EE.a(Bf(e))-VA.a(C(e)):0)<i),r}function HU(n,e,r){return p(e=t(Hn.a(e)))?e:!GU(n,r)}function IU(n,e,r){var i=iw.a(t(t(n))),o=sU(LA.a(t(t(n))),bw);return p(i)?p(o)?t(rC.a(e))>=o-i&&HU(n,e,r):o:i}DU.v(null,qn,(function(n,e){var r=Ax.a(t(t(n)));return p(r)&&(r.a?r.a(sz):r.call(null,sz)),e=nq.a(e),p(r=SA.a(e))&&ce(LA.a(t(t(n))),r),n=sU(LA.a(t(t(n))),kr),Ph(rC.a(e),n),Ph(xJ.a(e),n)})),DU.v(null,JJ,(function(n,e){var r=Ax.a(t(t(n)));return p(r)&&(r.a?r.a(Wu):r.call(null,Wu)),p(e=Yw.a(nq.a(e)))?ce(LA.a(t(t(n))),e):null})),DU.v(null,mG,(function(n,e){var r=nq.a(e),i=xJ.a(r),o=qE.a(e);if(e=jv.a(e),p(A.b?A.b(eE,e):A.call(null,eE,e)))n=t(rC.a(r));else{if(!p(A.b?A.b(wq,e):A.call(null,wq,e)))throw Error(["No matching clause: ",q.a(e)].join(""));n=sU(LA.a(t(t(n))),kr)}return Ph(i,o+n)})),DU.v(null,Xu,(function(n,e){return ce(LA.a(t(t(n))),yn.a(e))})),DU.v(null,fH,(function(n,e){var r=(r=A.b(U.a(e),go))?r:!A.b(U.a(e),SD)&&t(Hn.a(nq.a(e)));return p(r)?EU.b?EU.b(n,e):EU.call(null,n,e):p(e=bp.a(t(t(n))))&&ce(LA.a(t(t(n))),e),Rh.A(t(n),K,bp,null)}));var JU=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(ca,"emit-nl?"),(function(n){return U.a(n)}),i,n,e,t,r)}();function KU(n){var e=C(n),t=nq.a(e);return e=B(Mk((function(n){return!(A.b(Ny.a(n),fH)&&xU(nq.a(n),t))}),D(n))),new Q(null,2,5,R,[e,B(Yh(F(e)+1,n))],null)}function LU(n){var e=C(n),t=nq.a(e);return B(Mk((function(n){var e=nq.a(n);return!(A.b(Ny.a(n),fH)&&(A.b(e,t)||xU(e,t)))}),D(n)))}function EU(n,e){ce(LA.a(t(t(n))),"\n"),Rh.A(t(n),K,bp,null),e=nq.a(e);var r=sn.a(e);p(r)&&ce(LA.a(t(t(n))),r),r=fh(q,ai(t(xJ.a(e))-F(r)," ")),ce(LA.a(t(t(n))),r);n:for(Ph(KB.a(e),!0),Ph(Hn.a(e),!0),n=Dq.a(e);p(n);)Ph(Hn.a(n),!0),Ph(KB.a(n),!0),n=Dq.a(n);return null}function MU(n){var e=B(Mk((function(n){return!A.b(Ny.a(n),fH)}),n));return new Q(null,2,5,R,[e,B(Yh(F(e),n))],null)}JU.v(null,bF,(function(n,e,t){return HU(e,n=nq.a(n),t)})),JU.v(null,cI,(function(n,e,t){return IU(e,n=nq.a(n),t)})),JU.v(null,SD,(function(n,e,r,i){n=nq.a(n);var o=t(KB.a(n));return p(o)?o:(i=!GU(e,i))?i:IU(e,n,r)})),JU.v(null,go,(function(){return!0}));var NU=function n(e,t){var r=MU(t);t=J(r,0,null);var i=J(r,1,null);if(p(t)&&FU(e,t,!1),p(i)){t=J(r=KU(i),0,null),r=J(r,1,null);var o=C(i);return p(JU.A(o,e,t,LU(i)))&&(EU(e,o),i=D(i)),GU(e,i)?e=i:(i=n.b?n.b(e,t):n.call(null,e,t),A.b(i,t)?(FU(e,t,!1),e=r):e=ji.b(I,Xg.b(i,r))),e}return null};function OU(n){for(var e=cx.a(t(t(n)));;){if(Rh.A(t(n),K,cx,ji.b(I,e)),GU(n,e))return null;var r=NU(n,e);if(e===r)return null;e=r}}function PU(n,e){return Rh.A(t(n),K,cx,Cf.b(cx.a(t(t(n))),e)),GU(n,cx.a(t(t(n))))?null:OU(n)}function QU(n){var e=bp.a(t(t(n)));return p(e)?(ce(LA.a(t(t(n))),e),Rh.A(t(n),K,bp,null)):null}function RU(n,e){var r=UL(e,"\n",-1);if(A.b(F(r),1))return e;e=sn.a(C(XB.a(t(t(n)))));var i=C(r);if(A.b(eA,aw.a(t(t(n))))){var o=pr.a(t(t(n))),l=o+F(i);Rh.A(t(n),K,pr,l),PU(n,new yU(Xu,i,null,o,l,null,null,null)),OU(n),p(i=cx.a(t(t(n))))&&(FU(n,i,!0),Rh.A(t(n),K,cx,I))}else QU(n),ce(LA.a(t(t(n))),i);ce(LA.a(t(t(n))),"\n"),i=B(D(Hk(r))),o=null;for(var u=l=0;;)if(u<l){var s=o.W(null,u);ce(LA.a(t(t(n))),s),ce(LA.a(t(t(n))),"\n"),p(e)&&ce(LA.a(t(t(n))),e),u+=1}else{if(!(i=B(i)))break;Wf(o=i)?(i=re(o),u=se(o),o=i,l=F(i),i=u):(i=C(o),ce(LA.a(t(t(n))),i),ce(LA.a(t(t(n))),"\n"),p(e)&&ce(LA.a(t(t(n))),e),i=D(o),o=null,l=0),u=0}return Rh.A(t(n),K,eA,xq),Bf(r)}function SU(n){var e=TU,r=UU,i=new wU(null,null,Oh(0),Oh(0),Oh(!1),Oh(!1),null,null,null,null,null,null,null),o=Oh(Xj([XB,iw,eD,Er,kt,aw,pr,bp,LA,GD,cx],[i,r,i,!0,null,xq,0,null,vU(n,e),1,I]));return void 0!==Ac&&void 0!==cU&&void 0!==F3||((F3=function(n,e,t,r,i,o){this.ya=n,this.Ve=e,this.nh=t,this.Mg=r,this.Vc=i,this.Xg=o,this.h=1074167808,this.I=0}).prototype.O=function(n,e){return new F3(this.ya,this.Ve,this.nh,this.Mg,this.Vc,e)},F3.prototype.N=function(){return this.Xg},F3.prototype.zb=function(){return this.Vc},F3.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n))){var r=RU(this,e);e=r.replace(/\s+$/,""),n=r.substring(e.length);var i=aw.a(t(t(this)));return A.b(i,xq)?(QU(this),ce(LA.a(t(t(this))),e),Rh.A(t(this),K,bp,n)):(r=(i=pr.a(t(t(this))))+F(r),Rh.A(t(this),K,pr,r),PU(this,new yU(Xu,e,n,i,r,null,null,null)))}if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return A.b(aw.a(t(t(this))),xq)?(QU(this),e=ce(LA.a(t(t(this))),e)):A.b(e,"\n")?e=RU(this,"\n"):(r=(n=pr.a(t(t(this))))+1,Rh.A(t(this),K,pr,r),e=rg(e),e=PU(this,new yU(Xu,e,null,n,r,null,null,null))),e;throw Error(["No matching clause: ",q.a(n)].join(""))},F3.prototype.qc=function(){return this.Le(null),de(LA.a(t(t(this))))},F3.prototype.Le=function(){return A.b(aw.a(t(t(this))),eA)?(FU(this,cx.a(t(t(this))),!0),Rh.A(t(this),K,cx,I)):QU(this)},F3.Pa=function(){return new Q(null,6,5,R,[tG,Rp,Yq,bv,zu,MJ],null)},F3.Ia=!0,F3.Da="cljs.pprint/t_cljs$pprint12452",F3.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint12452")}),new F3(n,e,r,i,o,S)}function VU(n,e){var r=Dc;if(e=new wU(XB.a(t(t(r))),null,Oh(0),Oh(0),Oh(!1),Oh(!1),n,null,e,null,null,null,null),Rh.A(t(r),K,XB,e),A.b(aw.a(t(t(r))),xq)){QU(r);var i=Ax.a(t(t(r)));p(i)&&(i.a?i.a(sz):i.call(null,sz)),p(n)&&ce(LA.a(t(t(r))),n),r=sU(LA.a(t(t(r))),kr),Ph(e.lb,r),Ph(e.kb,r)}else n=(i=pr.a(t(t(r))))+(p(n)?F(n):0),Rh.A(t(r),K,pr,n),PU(r,new AU(qn,e,i,n,null,null,null))}function WU(){var n=Dc,e=XB.a(t(t(n))),r=Yw.a(e);if(A.b(aw.a(t(t(n))),xq)){QU(n),p(r)&&ce(LA.a(t(t(n))),r);var i=Ax.a(t(t(n)));p(i)&&(i.a?i.a(Wu):i.call(null,Wu))}else r=(i=pr.a(t(t(n))))+(p(r)?F(r):0),Rh.A(t(n),K,pr,r),PU(n,new BU(JJ,e,i,r,null,null,null));Rh.A(t(n),K,XB,Dq.a(e))}var XU=!0,YU=null,TU=72,UU=40,ZU=null,$U=null,aV=null,bV=null,cV=10,dV=0,eV=null;function fV(n){return!!(null!=n?32768&n.h||h===n.nf||!n.h&&Xc(Ld,n):Xc(Ld,n))&&Er.a(t(t(n)))}function gV(n){var e=eV;return p(e)&&(e=p(e=Hc)?eV>=Hc:e),Tc(XU)?kU.call(null,n):p(e)?ce(Dc,"..."):(p(eV)&&(eV+=1),YU.call(null,n)),e}var hV=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],1<t.length?new Qe(t.slice(1),0,null):null)};hV.g=function(e,t){var r=wk.g(G([new n(null,1,[sJ,!0],null),fh(qk,t)]));t=cV;var i=$U,o=Hc,l=Ic,u=ZU,s=UU,a=YU,c=XU,d=bV,h=Gc,f=TU,g=aV,w=LA.b(r,cV),v=oz.b(r,$U),m=Ez.b(r,Hc),y=cn.b(r,Ic),b=lt.b(r,ZU),$=iw.b(r,UU),_=tw.b(r,YU),S=Jr.b(r,XU),I=YD.b(r,bV),C=Lc.b(r,Gc),R=Eo.b(r,TU),A=Aq.b(r,aV);cV=w,$U=v,Hc=m,Ic=y,ZU=b,UU=$,YU=_,XU=S,bV=I,Gc=C,TU=R,aV=A;try{var E=new zc,D=!N(r,sJ)||sJ.a(r),x=!0===D||null==D?new Ae(E):D;if(p(XU)){var T=Tc(fV(x));r=Dc,Dc=T?SU(x):x;try{gV(e),rU()}finally{Dc=r}}else{T=Dc,Dc=x;try{kU.call(null,e)}finally{Dc=T}}return!0===D&&cl(q.a(E)),null==D?q.a(E):null}finally{aV=g,TU=f,Gc=h,bV=d,XU=c,YU=a,UU=s,ZU=u,Ic=l,Hc=o,$U=i,cV=t}},hV.F=1,hV.G=function(n){var e=C(n);return n=D(n),this.g(e,n)};var iV=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function jV(n,e){if(Tc(e.a?e.a(n):e.call(null,n)))throw Error(["Bad argument: ",q.a(n),". It must be one of ",q.a(e)].join(""))}function kV(){var n=Ic;return p(n)?dV>=Ic:n}function lV(e){jV(e,new Bk(null,new n(null,4,[go,null,cI,null,SD,null,bF,null],null),null));var r=Dc;Rh.A(t(r),K,aw,eA);var i=pr.a(t(t(r))),o=XB.a(t(t(r)));PU(r,new zU(fH,e,o,i,i,null,null,null))}function mV(e,r){jV(e,new Bk(null,new n(null,2,[eE,null,wq,null],null),null));var i=Dc,o=XB.a(t(t(i)));if(A.b(aw.a(t(t(i))),xq)){QU(i);var l=xJ.a(o);if(p(A.b?A.b(eE,e):A.call(null,eE,e)))e=t(rC.a(o));else{if(!p(A.b?A.b(wq,e):A.call(null,wq,e)))throw Error(["No matching clause: ",q.a(e)].join(""));e=sU(LA.a(t(t(i))),kr)}Ph(l,r+e)}else l=pr.a(t(t(i))),PU(i,new CU(mG,o,e,r,l,l,null,null,null))}function nV(n,e,t){e="string"==typeof e?oV(e):e,t=pV(t);n:{var r=new zc,i=Tc(n)||!0===n?new Ae(r):n,o=qV(e)&&Tc(fV(i))?p(fV(i))?i:SU(i):i,l=Dc;Dc=o;try{try{rV(e,t)}finally{i!==o&&de(o)}var u=Tc(n)?q.a(r):!0===n?cl(q.a(r)):null;break n}finally{Dc=l}u=void 0}return u}iV.a=function(n){var e=new zc,t=Dc;Dc=new Ae(e);try{return iV.b(n,Dc),cl(q.a(e))}finally{Dc=t}},iV.b=function(n,e){var t=Tc(fV(e)),r=Dc;Dc=t?SU(e):e;try{e=XU,XU=!0;try{gV(n)}finally{XU=e}return A.b(0,sU(Dc,kr))||ce(Dc,"\n"),rU()}finally{Dc=r}},iV.F=2;var sV=null;function tV(n,e){throw n=[q.a(n),"\n",q.a(sV),"\n",q.a(fh(q,ai(e," "))),"^\n"].join(""),Error(n)}function uV(n,e,t,r,i,o){this.uc=n,this.ab=e,this.tc=t,this.Mb=r,this.j=i,this.B=o,this.h=2230716170,this.I=139264}function pV(n){return new uV(n=B(n),n,0,null,null,null)}function vV(n){var e=ts.a(n);if(p(e))return new Q(null,2,5,R,[C(e),new uV(wA.a(n),D(e),pr.a(n)+1,null,null,null)],null);throw Error("Not enough arguments for format definition")}function wV(n){var e=vV(n);return n=J(e,0,null),e=J(e,1,null),n="string"==typeof n?oV(n):n,new Q(null,2,5,R,[n,e],null)}function xV(n,e){return e>=pr.a(n)?(e=pr.a(n)-e,yV.b?yV.b(n,e):yV.call(null,n,e)):new uV(wA.a(n),Yh(e,wA.a(n)),e,null,null,null)}function yV(n,e){var t=pr.a(n)+e;return 0>e?xV(n,t):new uV(wA.a(n),Yh(e,ts.a(n)),t,null,null,null)}function zV(n,e,t,r,i,o,l){this.ec=n,this.bc=e,this.nc=t,this.offset=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}function AV(e,t){var r=J(e,0,null);e=J(e,1,null);var i=J(e,0,null);return e=J(e,1,null),t=J(i=N(new Bk(null,new n(null,2,[mt,null,IH,null],null),null),r)?new Q(null,2,5,R,[i,t],null):A.b(i,Ew)?vV(t):A.b(i,gD)?new Q(null,2,5,R,[F(ts.a(t)),t],null):new Q(null,2,5,R,[i,t],null),0,null),i=J(i,1,null),new Q(null,2,5,R,[new Q(null,2,5,R,[r,new Q(null,2,5,R,[t,e],null)],null),i],null)}function BV(n,e){return n=J(e=nU(AV,e,n),0,null),e=J(e,1,null),new Q(null,2,5,R,[ji.b(S,n),e],null)}g=uV.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"seq":return this.uc;case"rest":return this.ab;case"pos":return this.tc;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.arg-navigator{",", ","}",t,Xg.b(new Q(null,3,5,R,[new Q(null,2,5,R,[wA,this.uc],null),new Q(null,2,5,R,[ts,this.ab],null),new Q(null,2,5,R,[pr,this.tc],null)],null),this.j))},g.ua=function(){return new gj(this,3,new Q(null,3,5,R,[wA,ts,pr],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 3+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-402038447^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.uc,e.uc)&&A.b(this.ab,e.ab)&&A.b(this.tc,e.tc)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,3,[pr,null,wA,null,ts,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new uV(this.uc,this.ab,this.tc,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(wA,e):P.call(null,wA,e))?new uV(t,this.ab,this.tc,this.Mb,this.j,null):p(P.b?P.b(ts,e):P.call(null,ts,e))?new uV(this.uc,t,this.tc,this.Mb,this.j,null):p(P.b?P.b(pr,e):P.call(null,pr,e))?new uV(this.uc,this.ab,t,this.Mb,this.j,null):new uV(this.uc,this.ab,this.tc,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,3,5,R,[new Gi(wA,this.uc),new Gi(ts,this.ab),new Gi(pr,this.tc)],null),this.j))},g.O=function(n,e){return new uV(this.uc,this.ab,this.tc,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},g=zV.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"func":return this.ec;case"def":return this.bc;case"params":return this.nc;case"offset":return this.offset;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#cljs.pprint.compiled-directive{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[iG,this.ec],null),new Q(null,2,5,R,[yo,this.bc],null),new Q(null,2,5,R,[ns,this.nc],null),new Q(null,2,5,R,[qE,this.offset],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[iG,yo,ns,qE],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=-829256337^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.ec,e.ec)&&A.b(this.bc,e.bc)&&A.b(this.nc,e.nc)&&A.b(this.offset,e.offset)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[qE,null,iG,null,ns,null,yo,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new zV(this.ec,this.bc,this.nc,this.offset,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(iG,e):P.call(null,iG,e))?new zV(t,this.bc,this.nc,this.offset,this.Mb,this.j,null):p(P.b?P.b(yo,e):P.call(null,yo,e))?new zV(this.ec,t,this.nc,this.offset,this.Mb,this.j,null):p(P.b?P.b(ns,e):P.call(null,ns,e))?new zV(this.ec,this.bc,t,this.offset,this.Mb,this.j,null):p(P.b?P.b(qE,e):P.call(null,qE,e))?new zV(this.ec,this.bc,this.nc,t,this.Mb,this.j,null):new zV(this.ec,this.bc,this.nc,this.offset,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(iG,this.ec),new Gi(yo,this.bc),new Gi(ns,this.nc),new Gi(qE,this.offset)],null),this.j))},g.O=function(n,e){return new zV(this.ec,this.bc,this.nc,this.offset,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)};var CV=new n(null,3,[2,"#b",8,"#o",16,"#x"],null);function DV(n){return bg(n)?A.b(cV,10)?[q.a(n),p(bV)?".":null].join(""):[q.a(p(bV)?(e=x.b(CV,cV),p(e)?e:["#",q.a(cV),"r"].join("")):null),q.a(EV(cV,n))].join(""):null;var e}function FV(n,e,t){var r=J(t=vV(t),0,null);t=J(t,1,null);var i=DV(r);return i=(i=(r=(n=p(i)?i:n.a?n.a(r):n.call(null,r)).length)+tt.a(e))>=Hx.a(e)?i:i+(tg(Hx.a(e)-i-1,lq.a(e))+1)*lq.a(e),r=fh(q,ai(i-r,UC.a(e))),p(IH.a(e))?jU.g(G([[q.a(r),q.a(n)].join("")])):jU.g(G([[q.a(n),q.a(r)].join("")])),t}function GV(n){return!!bg(n)||"number"==typeof n&&!isNaN(n)&&1/0!==n&&parseFloat(n)!==parseInt(n,10)&&A.b(n,Math.floor(n))}function HV(n,e){return Eg(C(oU((function(e){return new Q(null,2,5,R,0<e?[ug(e,n),tg(e,n)]:[null,null],null)}),e)))}function EV(n,e){return 0===e?"0":fh(q,Wh.b((function(n){return rg(10>n?mU("0")+n:mU("a")+(n-10))}),HV(n,e)))}function IV(n,e){return Eg(C(oU((function(e){return new Q(null,2,5,R,[B(Eg(Xh.b(n,e))),B(Yh(n,e))],null)}),Eg(e))))}function JV(e,t,r){var i,o,l=J(r=vV(r),0,null);if(r=J(r,1,null),GV(l)){var u=0>l,s=EV(e,u?-l:l);e=p(mt.a(t))?(i=Wh.b((function(n){return fh(q,n)}),IV(vD.a(t),s)),o=ai(F(i),us.a(t)),fh(q,D(bi.b(o,i)))):s,e=(e=u?["-",q.a(e)].join(""):p(IH.a(t))?["+",q.a(e)].join(""):e).length<Hx.a(t)?[q.a(fh(q,ai(Hx.a(t)-e.length,UC.a(t)))),q.a(e)].join(""):e,jU.g(G([e]))}else FV(ql,new n(null,5,[Hx,Hx.a(t),lq,1,tt,0,UC,UC.a(t),IH,!0],null),pV(new Q(null,1,5,R,[l],null)));return r}var KV=new Q(null,20,5,R,"zero one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen".split(" "),null),LV=new Q(null,20,5,R,"zeroth first second third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth".split(" "),null),MV=new Q(null,10,5,R,"  twenty thirty forty fifty sixty seventy eighty ninety".split(" "),null),NV=new Q(null,10,5,R,"  twentieth thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" "),null),OV=new Q(null,22,5,R," thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion decillion undecillion duodecillion tredecillion quattuordecillion quindecillion sexdecillion septendecillion octodecillion novemdecillion vigintillion".split(" "),null);function PV(n){var e,t,r=tg(n,100),i=ug(n,100);return[0<r?[q.a(pf(KV,r))," hundred"].join(""):null,0<r&&0<i?" ":null,q.a(0<i?20>i?pf(KV,i):(e=tg(i,10),t=ug(i,10),[q.a(0<e?pf(MV,e):null),0<e&&0<t?"-":null,q.a(0<t?pf(KV,t):null)].join("")):null)].join("")}function QV(n,e){var t=F(n),r=I;--t;var i=C(n);for(n=D(n);;){if(null==n)return[q.a(fh(q,di(", ",r))),Pf(i)||Pf(r)?null:", ",q.a(i),!Pf(i)&&0<t+e?[" ",q.a(pf(OV,t+e))].join(""):null].join("");r=Pf(i)?r:Cf.b(r,[q.a(i)," ",q.a(pf(OV,t+e))].join("")),--t,i=C(n),n=D(n)}}function RV(n){var e,t,r=tg(n,100),i=ug(n,100);return[0<r?[q.a(pf(KV,r))," hundred"].join(""):null,0<r&&0<i?" ":null,q.a(0<i?20>i?pf(LV,i):(e=tg(i,10),t=ug(i,10),0<e&&!(0<t)?pf(NV,e):[q.a(0<e?pf(MV,e):null),0<e&&0<t?"-":null,q.a(0<t?pf(LV,t):null)].join("")):0<r?"th":null)].join("")}var SV=new Q(null,4,5,R,[new Q(null,9,5,R,"I II III IIII V VI VII VIII VIIII".split(" "),null),new Q(null,9,5,R,"X XX XXX XXXX L LX LXX LXXX LXXXX".split(" "),null),new Q(null,9,5,R,"C CC CCC CCCC D DC DCC DCCC DCCCC".split(" "),null),new Q(null,3,5,R,["M","MM","MMM"],null)],null),TV=new Q(null,4,5,R,[new Q(null,9,5,R,"I II III IV V VI VII VIII IX".split(" "),null),new Q(null,9,5,R,"X XX XXX XL L LX LXX LXXX XC".split(" "),null),new Q(null,9,5,R,"C CC CCC CD D DC DCC DCCC CM".split(" "),null),new Q(null,3,5,R,["M","MM","MMM"],null)],null);function UV(e,t){var r=J(t=vV(t),0,null);if(t=J(t,1,null),"number"==typeof r&&0<r&&4e3>r){var i=HV(10,r);r=I;for(var o=F(i)-1;;){if(Pf(i)){jU.g(G([fh(q,r)]));break}var l=C(i);r=A.b(0,l)?r:Cf.b(r,pf(pf(e,o),l-1)),--o,i=D(i)}}else JV(10,new n(null,5,[Hx,0,UC," ",us,",",vD,3,mt,!0],null),pV(new Q(null,1,5,R,[r],null)));return t}var VV=new n(null,5,[8,"Backspace",9,"Tab",10,"Newline",13,"Return",32,"Space"],null);function WV(n,e){e=J(n=vV(e),0,null),n=J(n,1,null);var t=mU(e);e=127&t,t&=128;var r=x.b(VV,e);return 0<t&&jU.g(G(["Meta-"])),jU.g(G([p(r)?r:32>e?["Control-",q.a(rg(e+64))].join(""):A.b(e,127)?"Control-?":rg(e)])),n}function XV(n,e){var t=vV(e);if(e=J(t,0,null),t=J(t,1,null),n=sH.a(n),p(A.b?A.b("o",n):A.call(null,"o",n)))nV(!0,"\\o~3, '0o",G([mU(e)]));else if(p(A.b?A.b("u",n):A.call(null,"u",n)))nV(!0,"\\u~4, '0x",G([mU(e)]));else{if(!p(A.b?A.b(null,n):A.call(null,null,n)))throw Error(["No matching clause: ",q.a(n)].join(""));ce(Dc,p(A.b?A.b("\b",e):A.call(null,"\b",e))?"\\backspace":p(A.b?A.b(" ",e):A.call(null," ",e))?"\\space":p(A.b?A.b("\t",e):A.call(null,"\t",e))?"\\tab":p(A.b?A.b("\n",e):A.call(null,"\n",e))?"\\newline":p(A.b?A.b("\f",e):A.call(null,"\f",e))?"\\formfeed":p(A.b?A.b("\r",e):A.call(null,"\r",e))?"\\return":p(A.b?A.b('"',e):A.call(null,'"',e))?'\\"':p(A.b?A.b("\\",e):A.call(null,"\\",e))?"\\\\":["\\",q.a(e)].join(""))}return t}function YV(n,e){return n=J(e=vV(e),0,null),e=J(e,1,null),jU.g(G([n])),e}function ZV(n){return n=C(n),A.b(yx,n)||A.b(LG,n)}function $V(n,e,t){return zf(nU((function(n,e){if(ZV(e))return new Q(null,2,5,R,[null,e],null);var r=J(e=BV(ns.a(n),e),0,null);e=J(e,1,null);var i=pU(r);return r=J(i,0,null),i=J(i,1,null),r=K.c(r,qo,t),new Q(null,2,5,R,[null,fh(iG.a(n),new Q(null,3,5,R,[r,e,i],null))],null)}),e,n))}function aW(n){var e=(n=q.a(n).toLowerCase()).indexOf("e"),t=n.indexOf(".");e=J(n=new Q(null,2,5,R,0>e?0>t?[n,q.a(n.length-1)]:[[n.substring(0,t),n.substring(t+1)].join(""),q.a(t-1)]:0>t?[n.substring(0,e),n.substring(e+1)]:[[n.substring(0,1),n.substring(2,e)].join(""),n.substring(e+1)],null),0,null),n=J(n,1,null);n:if(t=F(e),0<t&&A.b(pf(e,F(e)-1),"0"))for(--t;;){if(0>t){e="";break n}if(!A.b(pf(e,t),"0")){e=e.substring(0,t+1);break n}--t}n:{var r=F(t=e);if(0<r&&A.b(pf(t,0),"0"))for(var i=0;;){if(A.b(i,r)||!A.b(pf(t,i),"0")){t=t.substring(i);break n}i+=1}}return e=F(e)-F(t),n=0<F(n)&&A.b(pf(n,0),"+")?n.substring(1):n,Pf(t)?new Q(null,2,5,R,["0",0],null):new Q(null,2,5,R,[t,parseInt(n,10)-e],null)}function bW(n,e,t,r){if(p(p(t)?t:r)){var i=F(n);r=p(r)?2>r?2:r:0,p(t)?t=e+t+1:0<=e?t=(t=e+1)>--r?t:r:t=r+e;var o=A.b(t,0)?new Q(null,4,5,R,[["0",q.a(n)].join(""),e+1,1,i+1],null):new Q(null,4,5,R,[n,e,t,i],null);if(t=J(o,0,null),i=J(o,1,null),r=J(o,2,null),o=J(o,3,null),p(r)){if(0>r)return new Q(null,3,5,R,["0",0,!1],null);if(o>r){if(e=pf(t,r),n=t.substring(0,r),mU(e)>=mU("5")){n:for(e=F(n)-1,t=0|e;;){if(0>t){e=gh(q,"1",ai(e+1,"0"));break n}if(!A.b("9",n.charAt(t))){e=hh(q,n.substring(0,t),rg(mU(n.charAt(t))+1),ai(e-t,"0"));break n}--t}return n=F(e)>n.length,new Q(null,3,5,R,[n?Bg(e,0,F(e)-1):e,i,n],null)}return new Q(null,3,5,R,[n,i,!1],null)}}}return new Q(null,3,5,R,[n,e,!1],null)}function cW(n,e,t){var r=new Q(null,2,5,R,0>e?[[q.a(fh(q,ai(-e-1,"0"))),q.a(n)].join(""),-1]:[n,e],null);n=J(r,0,null);var i=J(r,1,null);return t=(r=F(n))<(t=p(t)?i+t+1:i+1)?[q.a(n),q.a(fh(q,ai(t-r,"0")))].join(""):n,0>e?e=[".",q.a(t)].join(""):(e+=1,e=[t.substring(0,e),".",t.substring(e)].join("")),e}function dW(n,e){return 0>e?[".",q.a(n)].join(""):[n.substring(0,e),".",n.substring(e)].join("")}function eW(n,e){var t=eG.a(n),r=dG.a(n),i=J(e=vV(e),0,null);e=J(e,1,null);var o=new Q(null,2,5,R,0>i?["-",-i]:["+",i],null),l=J(o,0,null);o=J(o,1,null);var u=J(o=aW(o),0,null),s=J(o,1,null)+$F.a(n);i=p(o=IH.a(n))?o:0>i,o=Tc(r)&&F(u)-1<=s;var a=bW(u,s,r,p(t)?t-(p(i)?1:0):null);return u=J(a,0,null),s=J(a,1,null),u=cW(u,p(a=J(a,2,null))?s+1:s,r),r=p(p(t)?p(r)?1<=r&&A.b(u.charAt(0),"0")&&A.b(u.charAt(1),".")&&u.length>t-(p(i)?1:0):r:t)?u.substring(1):u,s=A.b(C(r),"."),p(t)?(u=r.length,u=p(i)?u+1:u,o=o&&!(u>=t),p((u=(s=s&&!(u>=t))||o?u+1:u)>t&&SI.a(n))?jU.g(G([fh(q,ai(t,SI.a(n)))])):jU.g(G([[q.a(fh(q,ai(t-u,UC.a(n)))),q.a(p(i)?l:null),s?"0":null,r,o?"0":null].join("")]))):jU.g(G([[q.a(p(i)?l:null),s?"0":null,r,o?"0":null].join("")])),e}function fW(n,e){var t=J(e=vV(e),0,null);e=J(e,1,null);var r,i=aW(0>t?-t:t);for(J(i,0,null),J(i,1,null);;){var o=J(i,0,null),l=J(i,1,null),u=eG.a(n),s=dG.a(n),a=bG.a(n),c=$F.a(n),d=(r=void 0,p(r=Ko.a(n))?r:"E");i=function(){var e=IH.a(n);return p(e)?e:0>t}();var h=0>=c,f=l-(c-1),g=q.a(Math.abs(f)),w=(d=[q.a(d),0>f?"-":"+",q.a(p(a)?fh(q,ai(a-g.length,"0")):null),g].join("")).length;if(f=F(o),o=[q.a(fh(q,ai(-c,"0"))),q.a(o),q.a(p(s)?fh(q,ai(s-(f-1)-(0>c?-c:0),"0")):null)].join(""),f=p(u)?u-w:null,f=J(o=bW(o,0,A.b(c,0)?s-1:0<c?s:0>c?s-1:null,p(f)?f-(p(i)?1:0):null),0,null),J(o,1,null),g=J(o,2,null),o=dW(f,c),s=A.b(c,F(f))&&null==s,Tc(g)){if(p(u)){l=o.length+w,l=p(i)?l+1:l;var v=(h=h&&!A.b(l,u))?l+1:l;l=s&&v<u,p(function(){var e=v>u;return e||(e=p(e=a)?w-2>a:e),p(e)?SI.a(n):e}())?jU.g(G([fh(q,ai(u,SI.a(n)))])):jU.g(G([[q.a(fh(q,ai(u-v-(l?1:0),UC.a(n)))),p(i)?0>t?"-":"+":null,h?"0":null,o,l?"0":null,d].join("")]))}else jU.g(G([[p(i)?0>t?"-":"+":null,h?"0":null,o,s?"0":null,d].join("")]));break}i=new Q(null,2,5,R,[f,l+1],null)}return e}function gW(e,t,r){var i=vV(t),o=J(i,0,null);J(i,1,null);var l=J(i=aW(0>o?-o:o),0,null);i=J(i,1,null);var u=eG.a(e),s=dG.a(e),a=bG.a(e);return i=A.b(o,0)?0:i+1,o=p(a)?a+2:4,u=p(u)?u-o:null,p(s)?l=s:l=(l=F(l))>(s=7>i?i:7)?l:s,0<=(i=l-i)&&i<=l?(e=eW(new n(null,6,[eG,u,dG,i,$F,0,SI,SI.a(e),UC,UC.a(e),IH,IH.a(e)],null),t),jU.g(G([fh(q,ai(o," "))])),e):fW(e,t)}function hW(n,e){var t=J(e=vV(e),0,null);e=J(e,1,null);var r=aW(Math.abs(t)),i=J(r,0,null),o=J(r,1,null),l=dG.a(n),u=hG.a(n);r=eG.a(n);var s,a=p(s=IH.a(n))?s:0>t,c=bW(i,o,l,null);return i=J(c,0,null),o=J(c,1,null),l=cW(i,p(c=J(c,2,null))?o+1:o,l),u=[q.a(fh(q,ai(u-l.indexOf("."),"0"))),l].join(""),l=u.length+(p(a)?1:0),jU.g(G([[p(function(){var e=mt.a(n);return p(e)?a:e}())?0>t?"-":"+":null,q.a(fh(q,ai(r-l,UC.a(n)))),p(!!Tc(mt.a(n))&&a)?0>t?"-":"+":null,u].join("")])),e}function iW(n,e){var t=ZH.a(n);e=J(t=p(t)?new Q(null,2,5,R,[t,e],null):vV(e),0,null),t=J(t,1,null);var r=hw.a(n);return p(e=0>e||e>=F(r)?C(ks.a(n)):pf(r,e))?$V(e,t,qo.a(n)):t}function jW(n,e){var t=vV(e);e=J(t,0,null),t=J(t,1,null);var r=hw.a(n);return e=p(e)?zf(r):C(r),p(e)?$V(e,t,qo.a(n)):t}function kW(n,e){var t=vV(e),r=J(t,0,null);t=J(t,1,null);var i=hw.a(n);return i=p(r)?C(i):null,p(r)?p(i)?$V(i,e,qo.a(n)):e:t}function lW(n,e){var t=Px.a(n),r=C(hw.a(n));e=J(r=Pf(r)?wV(e):new Q(null,2,5,R,[r,e],null),0,null),r=J(r,1,null);var i=J(r=vV(r),0,null);r=J(r,1,null);var o=0;i=pV(i);for(var l=-1;;){if(Tc(t)&&A.b(pr.a(i),l)&&1<o)throw Error("%{ construct not consuming any arguments: Infinite loop!");if(p((l=Pf(ts.a(i))&&(Tc(mt.a(kp.a(n)))||0<o))||(p(t)?o>=t:t)))return r;if(l=$V(e,i,qo.a(n)),A.b(yx,C(l)))return r;o+=1;var u=pr.a(i);i=l,l=u}}function mW(n,e){var t=Px.a(n),r=C(hw.a(n));e=J(r=Pf(r)?wV(e):new Q(null,2,5,R,[r,e],null),0,null),r=J(r,1,null);var i=J(r=vV(r),0,null);r=J(r,1,null);for(var o=0;;){var l=Pf(i)&&(Tc(mt.a(kp.a(n)))||0<o);if(p(l||(p(t)?o>=t:t)))return r;if(l=$V(e,pV(C(i)),pV(D(i))),A.b(LG,C(l)))return r;o+=1,i=D(i)}}function nW(n,e){var t=Px.a(n),r=C(hw.a(n)),i=Pf(r)?wV(e):new Q(null,2,5,R,[r,e],null);e=J(i,0,null),r=0,i=J(i,1,null);for(var o=-1;;){if(Tc(t)&&A.b(pr.a(i),o)&&1<r)throw Error("%@{ construct not consuming any arguments: Infinite loop!");if(p((o=Pf(ts.a(i))&&(Tc(mt.a(kp.a(n)))||0<r))||(p(t)?r>=t:t)))return i;if(o=$V(e,i,qo.a(n)),A.b(yx,C(o)))return zf(o);r+=1;var l=pr.a(i);i=o,o=l}}function oW(n,e){var t=Px.a(n),r=C(hw.a(n)),i=Pf(r)?wV(e):new Q(null,2,5,R,[r,e],null);for(e=J(i,0,null),r=0,i=J(i,1,null);;){var o=Pf(ts.a(i))&&(Tc(mt.a(kp.a(n)))||0<r);if(p(o||(p(t)?r>=t:t)))return i;if(i=J(o=p(o=ts.a(i))?new Q(null,2,5,R,[C(o),new uV(wA.a(i),D(o),pr.a(i)+1,null,null,null)],null):new Q(null,2,5,R,[null,i],null),0,null),o=J(o,1,null),i=$V(e,pV(i),o),A.b(LG,C(i)))return o;i=o,r+=1}}function pW(n,e){if(p(mt.a(kp.a(n)))){var t=hw.a(n),r=F(t),i=1<r?xn.a(ns.a(C(C(t)))):p(mt.a(n))?"(":null,o=pf(t,1<r?1:0);if(t=2<r?xn.a(ns.a(C(pf(t,2)))):p(mt.a(n))?")":null,e=J(r=vV(e),0,null),r=J(r,1,null),p(kV()))ce(Dc,"#");else{var l=dV,u=eV;dV+=1,eV=0;try{VU(i,t),$V(o,pV(e),qo.a(n)),WU()}finally{eV=u,dV=l}}n=r}else n=qW(n,e);return n}function rW(n,e,t){for(var r=I;;){if(Pf(n))return new Q(null,2,5,R,[r,e],null);var i=C(n);n:{var o=new zc,l=Dc;Dc=new Ae(o);try{var u=new Q(null,2,5,R,[$V(i,e,t),q.a(o)],null);break n}finally{Dc=l}u=void 0}if(e=J(u,0,null),i=J(u,1,null),A.b(yx,C(e)))return new Q(null,2,5,R,[r,zf(e)],null);n=D(n),r=Cf.b(r,i)}}function qW(n,e){var r,i=p(r=ks.a(n))?rW(r,e,qo.a(n)):null,o=J(i,0,null);o=J(o,0,null);var l=p(i=J(i,1,null))?i:e,u=J(i=function(){var e=HJ.a(n);return p(e)?BV(e,l):null}(),0,null),s=p(i=J(i,1,null))?i:l;i=function(){var n=C(pE.a(u));return p(n)?n:0}();var a=function(){var n=C(vH.a(u));return p(n)?n:sU(Dc,bw)}(),c=hw.a(n),d=J(s=rW(c,s,qo.a(n)),0,null);s=J(s,1,null);var h=function(){var e=F(d)-1+(p(mt.a(n))?1:0)+(p(IH.a(n))?1:0);return 1>e?1:e}();c=gd.b(pg,Wh.b(F,d));var f=Hx.a(n),g=tt.a(n),w=lq.a(n),v=c+h*g,m=(f=v<=f?f:f+w*(1+tg(v-f-1,w)))-c;c=function(){var n=tg(m,h);return g>n?g:n}(),w=m-c*h,c=fh(q,ai(c,UC.a(n))),p(p(o)?sU(LA.a(t(t(Dc))),kr)+i+f>a:o)&&jU.g(G([o])),i=w;for(var y=d,b=function(){var e=mt.a(n);return p(e)?e:A.b(F(y),1)&&Tc(IH.a(n))}();B(y);)jU.g(G([[q.a(Tc(b)?C(y):null),q.a(p(function(){var e=b;return p(e)||(e=D(y))?e:IH.a(n)}())?c:null),q.a(0<i?UC.a(n):null)].join("")])),--i,y=o=p(b)?y:D(y),b=!1;return s}function sW(n){return void 0!==Ac&&void 0!==cU&&void 0!==R4||((R4=function(n,e){this.ya=n,this.$g=e,this.h=1074135040,this.I=0}).prototype.O=function(n,e){return new R4(this.ya,e)},R4.prototype.N=function(){return this.$g},R4.prototype.qc=function(){return de(this.ya)},R4.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n)))return ce(this.ya,e.toLowerCase());if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return ce(this.ya,rg(e).toLowerCase());throw Error(["No matching clause: ",q.a(n)].join(""))},R4.Pa=function(){return new Q(null,2,5,R,[tG,xT],null)},R4.Ia=!0,R4.Da="cljs.pprint/t_cljs$pprint13823",R4.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint13823")}),new R4(n,S)}function tW(n){return void 0!==Ac&&void 0!==cU&&void 0!==X4||((X4=function(n,e){this.ya=n,this.ah=e,this.h=1074135040,this.I=0}).prototype.O=function(n,e){return new X4(this.ya,e)},X4.prototype.N=function(){return this.ah},X4.prototype.qc=function(){return de(this.ya)},X4.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n)))return ce(this.ya,e.toUpperCase());if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return ce(this.ya,rg(e).toUpperCase());throw Error(["No matching clause: ",q.a(n)].join(""))},X4.Pa=function(){return new Q(null,2,5,R,[tG,wT],null)},X4.Ia=!0,X4.Da="cljs.pprint/t_cljs$pprint13848",X4.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint13848")}),new X4(n,S)}function uW(n,e){var t=C(n);return fh(q,C(oU((function(n){if(Pf(n))return new Q(null,2,5,R,[null,null],null);var e=/\W\w/g.exec(n);return e=p(e)?e.index+1:e,p(e)?new Q(null,2,5,R,[[n.substring(0,e),pf(n,e).toUpperCase()].join(""),n.substring(e+1)],null):new Q(null,2,5,R,[n,null],null)}),p(p(e)?p(t)?wc(t):t:e)?[t.toUpperCase(),n.substring(1)].join(""):n)))}function vW(n){var e=Oh(!0);return void 0!==Ac&&void 0!==cU&&void 0!==Y4||((Y4=function(n,e,t){this.ya=n,this.Od=e,this.bh=t,this.h=1074135040,this.I=0}).prototype.O=function(n,e){return new Y4(this.ya,this.Od,e)},Y4.prototype.N=function(){return this.bh},Y4.prototype.qc=function(){return de(this.ya)},Y4.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n)))return ce(this.ya,uW(e.toLowerCase(),t(this.Od))),0<e.length?Ph(this.Od,ec(pf(e,F(e)-1))):null;if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return e=rg(e),n=p(t(this.Od))?e.toUpperCase():e,ce(this.ya,n),Ph(this.Od,ec(e));throw Error(["No matching clause: ",q.a(n)].join(""))},Y4.Pa=function(){return new Q(null,3,5,R,[tG,ZA,vT],null)},Y4.Ia=!0,Y4.Da="cljs.pprint/t_cljs$pprint13893",Y4.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint13893")}),new Y4(n,e,S)}function wW(n){var e=Oh(!1);return void 0!==Ac&&void 0!==cU&&void 0!==$4||(($4=function(n,e,t){this.ya=n,this.wd=e,this.dh=t,this.h=1074135040,this.I=0}).prototype.O=function(n,e){return new $4(this.ya,this.wd,e)},$4.prototype.N=function(){return this.dh},$4.prototype.qc=function(){return de(this.ya)},$4.prototype.Pc=function(n,e){if(n=Yc(e),p(A.b?A.b(String,n):A.call(null,String,n)))return e=e.toLowerCase(),Tc(t(this.wd))?(n=p(n=/\S/g.exec(e))?n.index:n,p(n)?(ce(this.ya,[e.substring(0,n),pf(e,n).toUpperCase(),e.substring(n+1).toLowerCase()].join("")),Ph(this.wd,!0)):ce(this.ya,e)):ce(this.ya,e.toLowerCase());if(p(A.b?A.b(Number,n):A.call(null,Number,n)))return e=rg(e),p(!!Tc(t(this.wd))&&wc(e))?(Ph(this.wd,!0),ce(this.ya,e.toUpperCase())):ce(this.ya,e.toLowerCase());throw Error(["No matching clause: ",q.a(n)].join(""))},$4.Pa=function(){return new Q(null,3,5,R,[tG,EG,CT],null)},$4.Ia=!0,$4.Da="cljs.pprint/t_cljs$pprint13925",$4.Ja=function(n){return ce(n,"cljs.pprint/t_cljs$pprint13925")}),new $4(n,e,S)}function xW(n,e){return mV(p(mt.a(n))?wq:eE,hG.a(n)),e}function yW(n,e){return lV(n=p(mt.a(n))?p(IH.a(n))?go:SD:p(IH.a(n))?cI:bF),e}var zW=Xj("ASDBOXRPCFEG$%&|~\nT*?()[;]{}<>^W_I".split(""),[new n(null,5,[Qo,"A",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),lq,new Q(null,2,5,R,[1,Number],null),tt,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return FV(ql,n,e)}}],null),new n(null,5,[Qo,"S",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),lq,new Q(null,2,5,R,[1,Number],null),tt,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return FV(ol,n,e)}}],null),new n(null,5,[Qo,"D",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null),us,new Q(null,2,5,R,[",",String],null),vD,new Q(null,2,5,R,[3,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return JV(10,n,e)}}],null),new n(null,5,[Qo,"B",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null),us,new Q(null,2,5,R,[",",String],null),vD,new Q(null,2,5,R,[3,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return JV(2,n,e)}}],null),new n(null,5,[Qo,"O",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null),us,new Q(null,2,5,R,[",",String],null),vD,new Q(null,2,5,R,[3,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return JV(8,n,e)}}],null),new n(null,5,[Qo,"X",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null),us,new Q(null,2,5,R,[",",String],null),vD,new Q(null,2,5,R,[3,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){return JV(16,n,e)}}],null),new n(null,5,[Qo,"R",ns,new n(null,5,[LA,new Q(null,2,5,R,[null,Number],null),Hx,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null),us,new Q(null,2,5,R,[",",String],null),vD,new Q(null,2,5,R,[3,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(e){return p(C(LA.a(e)))?function(n,e){return JV(LA.a(n),n,e)}:p(p(t=IH.a(e))?mt.a(e):t)?function(n,e){return UV(SV,e)}:p(IH.a(e))?function(n,e){return UV(TV,e)}:p(mt.a(e))?function(e,t){if(t=J(e=vV(t),0,null),e=J(e,1,null),A.b(0,t))jU.g(G(["zeroth"]));else{var r=HV(1e3,0>t?-t:t);if(F(r)<=F(OV)){var i=Wh.b(PV,Zh(1,r));i=QV(i,1),r=RV(Bf(r)),jU.g(G([[0>t?"minus ":null,Pf(i)||Pf(r)?Pf(i)?r:[i,"th"].join(""):[i,", ",r].join("")].join("")]))}else JV(10,new n(null,5,[Hx,0,UC," ",us,",",vD,3,mt,!0],null),pV(new Q(null,1,5,R,[t],null))),t=11<(r=ug(t,100))||19>r,r=ug(r,10),jU.g(G([1===r&&t?"st":2===r&&t?"nd":3===r&&t?"rd":"th"]))}return e}:function(e,t){if(e=J(t=vV(t),0,null),t=J(t,1,null),A.b(0,e))jU.g(G(["zero"]));else{var r=HV(1e3,0>e?-e:e);F(r)<=F(OV)?(r=QV(r=Wh.b(PV,r),0),jU.g(G([[0>e?"minus ":null,r].join("")]))):JV(10,new n(null,5,[Hx,0,UC," ",us,",",vD,3,mt,!0],null),pV(new Q(null,1,5,R,[e],null)))}return t};var t}],null),new n(null,5,[Qo,"P",ns,S,fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return function(n,e){e=p(mt.a(n))?yV(e,-1):e,n=p(IH.a(n))?new Q(null,2,5,R,["y","ies"],null):new Q(null,2,5,R,["","s"],null);var t=vV(e);return e=J(t,0,null),t=J(t,1,null),jU.g(G([A.b(e,1)?C(n):zf(n)])),t}}],null),new n(null,5,[Qo,"C",ns,new n(null,1,[sH,new Q(null,2,5,R,[null,String],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(n){return p(mt.a(n))?WV:p(IH.a(n))?XV:YV}],null),new n(null,5,[Qo,"F",ns,new n(null,5,[eG,new Q(null,2,5,R,[null,Number],null),dG,new Q(null,2,5,R,[null,Number],null),$F,new Q(null,2,5,R,[0,Number],null),SI,new Q(null,2,5,R,[null,String],null),UC,new Q(null,2,5,R,[" ",String],null)],null),fv,new Bk(null,new n(null,1,[IH,null],null),null),Pw,S,PI,function(){return eW}],null),new n(null,5,[Qo,"E",ns,new n(null,7,[eG,new Q(null,2,5,R,[null,Number],null),dG,new Q(null,2,5,R,[null,Number],null),bG,new Q(null,2,5,R,[null,Number],null),$F,new Q(null,2,5,R,[1,Number],null),SI,new Q(null,2,5,R,[null,String],null),UC,new Q(null,2,5,R,[" ",String],null),Ko,new Q(null,2,5,R,[null,String],null)],null),fv,new Bk(null,new n(null,1,[IH,null],null),null),Pw,S,PI,function(){return fW}],null),new n(null,5,[Qo,"G",ns,new n(null,7,[eG,new Q(null,2,5,R,[null,Number],null),dG,new Q(null,2,5,R,[null,Number],null),bG,new Q(null,2,5,R,[null,Number],null),$F,new Q(null,2,5,R,[1,Number],null),SI,new Q(null,2,5,R,[null,String],null),UC,new Q(null,2,5,R,[" ",String],null),Ko,new Q(null,2,5,R,[null,String],null)],null),fv,new Bk(null,new n(null,1,[IH,null],null),null),Pw,S,PI,function(){return gW}],null),new n(null,5,[Qo,"$",ns,new n(null,4,[dG,new Q(null,2,5,R,[2,Number],null),hG,new Q(null,2,5,R,[1,Number],null),eG,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return hW}],null),new n(null,5,[Qo,"%",ns,new n(null,1,[gw,new Q(null,2,5,R,[1,Number],null)],null),fv,Dk,Pw,S,PI,function(){return function(n,e){n=gw.a(n);for(var t=0;t<n;)lU(),t+=1;return e}}],null),new n(null,5,[Qo,"&",ns,new n(null,1,[gw,new Q(null,2,5,R,[1,Number],null)],null),fv,new Bk(null,new n(null,1,[Jr,null],null),null),Pw,S,PI,function(){return function(n,e){0<(n=gw.a(n))&&((null!=Dc?32768&Dc.h||h===Dc.nf||!Dc.h&&Xc(Ld,Dc):Xc(Ld,Dc))&&A.b(0,sU(LA.a(t(t(Dc))),kr))||lU()),--n;for(var r=0;r<n;)lU(),r+=1;return e}}],null),new n(null,5,[Qo,"|",ns,new n(null,1,[gw,new Q(null,2,5,R,[1,Number],null)],null),fv,Dk,Pw,S,PI,function(){return function(n,e){n=gw.a(n);for(var t=0;t<n;)jU.g(G(["\f"])),t+=1;return e}}],null),new n(null,5,[Qo,"~",ns,new n(null,1,[hG,new Q(null,2,5,R,[1,Number],null)],null),fv,Dk,Pw,S,PI,function(){return function(n,e){return n=hG.a(n),jU.g(G([fh(q,ai(n,"~"))])),e}}],null),new n(null,5,[Qo,"\n",ns,S,fv,new Bk(null,new n(null,2,[mt,null,IH,null],null),null),Pw,S,PI,function(){return function(n,e){return p(IH.a(n))&&lU(),e}}],null),new n(null,5,[Qo,"T",ns,new n(null,2,[iI,new Q(null,2,5,R,[1,Number],null),lq,new Q(null,2,5,R,[1,Number],null)],null),fv,new Bk(null,new n(null,2,[IH,null,Jr,null],null),null),Pw,S,PI,function(n){return p(IH.a(n))?function(n,e){var r=iI.a(n);n=lq.a(n);var i=r+sU(LA.a(t(t(Dc))),kr);return i=0<n?ug(i,n):0,r+=A.b(0,i)?0:n-i,jU.g(G([fh(q,ai(r," "))])),e}:function(n,e){var r=iI.a(n);n=lq.a(n);var i=sU(LA.a(t(t(Dc))),kr);return r=i<r?r-i:A.b(n,0)?0:n-ug(i-r,n),jU.g(G([fh(q,ai(r," "))])),e}}],null),new n(null,5,[Qo,"*",ns,new n(null,1,[hG,new Q(null,2,5,R,[1,Number],null)],null),fv,new Bk(null,new n(null,2,[mt,null,IH,null],null),null),Pw,S,PI,function(){return function(n,e){var t=hG.a(n);return p(IH.a(n))?xV(e,t):yV(e,p(mt.a(n))?-t:t)}}],null),new n(null,5,[Qo,"?",ns,S,fv,new Bk(null,new n(null,1,[IH,null],null),null),Pw,S,PI,function(n){return p(IH.a(n))?function(n,e){var t=wV(e);return $V(e=J(t,0,null),t=J(t,1,null),qo.a(n))}:function(n,e){var t=wV(e);e=J(t,0,null);var r=vV(t=J(t,1,null));return t=J(r,0,null),r=J(r,1,null),$V(e,t=pV(t),qo.a(n)),r}}],null),new n(null,5,[Qo,"(",ns,S,fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,new n(null,3,[QB,")",FG,null,ks,null],null),PI,function(n){var e,t=p(p(e=IH.a(n))?mt.a(n):e)?tW:p(mt.a(n))?vW:p(IH.a(n))?wW:sW;return function(n,e){n:{var r=C(hw.a(n)),i=Dc;Dc=t.a?t.a(Dc):t.call(null,Dc);try{var o=$V(r,e,qo.a(n));break n}finally{Dc=i}o=void 0}return o}}],null),new n(null,5,[Qo,")",ns,S,fv,Dk,Pw,S,PI,function(){return null}],null),new n(null,5,[Qo,"[",ns,new n(null,1,[ZH,new Q(null,2,5,R,[null,Number],null)],null),fv,new Bk(null,new n(null,2,[mt,null,IH,null],null),null),Pw,new n(null,3,[QB,"]",FG,!0,ks,VF],null),PI,function(n){return p(mt.a(n))?jW:p(IH.a(n))?kW:iW}],null),new n(null,5,[Qo,";",ns,new n(null,2,[pE,new Q(null,2,5,R,[null,Number],null),vH,new Q(null,2,5,R,[null,Number],null)],null),fv,new Bk(null,new n(null,1,[mt,null],null),null),Pw,new n(null,1,[xD,!0],null),PI,function(){return null}],null),new n(null,5,[Qo,"]",ns,S,fv,Dk,Pw,S,PI,function(){return null}],null),new n(null,5,[Qo,"{",ns,new n(null,1,[Px,new Q(null,2,5,R,[null,Number],null)],null),fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,new n(null,2,[QB,"}",FG,!1],null),PI,function(n){var e=IH.a(n);return e=p(e)?mt.a(n):e,p(e)?oW:p(mt.a(n))?mW:p(IH.a(n))?nW:lW}],null),new n(null,5,[Qo,"}",ns,S,fv,new Bk(null,new n(null,1,[mt,null],null),null),Pw,S,PI,function(){return null}],null),new n(null,5,[Qo,"<",ns,new n(null,4,[Hx,new Q(null,2,5,R,[0,Number],null),lq,new Q(null,2,5,R,[1,Number],null),tt,new Q(null,2,5,R,[0,Number],null),UC,new Q(null,2,5,R,[" ",String],null)],null),fv,new Bk(null,new n(null,4,[mt,null,IH,null,Qu,null,Jr,null],null),null),Pw,new n(null,3,[QB,">",FG,!0,ks,YA],null),PI,function(){return pW}],null),new n(null,5,[Qo,">",ns,S,fv,new Bk(null,new n(null,1,[mt,null],null),null),Pw,S,PI,function(){return null}],null),new n(null,5,[Qo,"^",ns,new n(null,3,[HI,new Q(null,2,5,R,[null,Number],null),II,new Q(null,2,5,R,[null,Number],null),FI,new Q(null,2,5,R,[null,Number],null)],null),fv,new Bk(null,new n(null,1,[mt,null],null),null),Pw,S,PI,function(){return function(n,e){var t=HI.a(n),r=II.a(n),i=FI.a(n),o=p(mt.a(n))?LG:yx;return p(p(t)?p(r)?i:r:t)?t<=r&&r<=i?new Q(null,2,5,R,[o,e],null):e:p(p(t)?r:t)?A.b(t,r)?new Q(null,2,5,R,[o,e],null):e:p(t)?A.b(t,0)?new Q(null,2,5,R,[o,e],null):e:(p(mt.a(n))?Pf(ts.a(qo.a(n))):Pf(ts.a(e)))?new Q(null,2,5,R,[o,e],null):e}}],null),new n(null,5,[Qo,"W",ns,S,fv,new Bk(null,new n(null,4,[mt,null,IH,null,Qu,null,Jr,null],null),null),Pw,S,PI,function(n){if(p(p(t=IH.a(n))?t:mt.a(n))){var e=Xg.b(p(IH.a(n))?new Q(null,4,5,R,[cn,null,Ez,null],null):I,p(mt.a(n))?new Q(null,2,5,R,[Jr,!0],null):I);return function(n,t){return n=J(t=vV(t),0,null),t=J(t,1,null),p(gh(hV,n,e))?new Q(null,2,5,R,[yx,t],null):t}}var t;return function(n,e){return n=J(e=vV(e),0,null),e=J(e,1,null),p(gV(n))?new Q(null,2,5,R,[yx,e],null):e}}],null),new n(null,5,[Qo,"_",ns,S,fv,new Bk(null,new n(null,3,[mt,null,IH,null,Qu,null],null),null),Pw,S,PI,function(){return yW}],null),new n(null,5,[Qo,"I",ns,new n(null,1,[hG,new Q(null,2,5,R,[0,Number],null)],null),fv,new Bk(null,new n(null,1,[mt,null],null),null),Pw,S,PI,function(){return xW}],null)]),AW=/^([vV]|#|('.)|([+-]?\d+)|(?=,))/,BW=new Bk(null,new n(null,2,[gD,null,Ew,null],null),null);function CW(n){var e=J(n,0,null),t=J(n,1,null),r=J(n,2,null),i=(n=new RegExp(AW.source,"g")).exec(e);return p(i)?(r=C(i),e=e.substring(n.lastIndex),n=t+n.lastIndex,A.b(",",pf(e,0))?new Q(null,2,5,R,[new Q(null,2,5,R,[r,t],null),new Q(null,3,5,R,[e.substring(1),n+1,!0],null)],null):new Q(null,2,5,R,[new Q(null,2,5,R,[r,t],null),new Q(null,3,5,R,[e,n,!1],null)],null)):p(r)?tV("Badly formed parameters in format directive",t):new Q(null,2,5,R,[null,new Q(null,2,5,R,[e,t],null)],null)}function DW(e){var t=J(e,0,null);return e=J(e,1,null),new Q(null,2,5,R,[A.b(t.length,0)?null:A.b(t.length,1)&&N(new Bk(null,new n(null,2,["V",null,"v",null],null),null),pf(t,0))?Ew:A.b(t.length,1)&&A.b("#",pf(t,0))?gD:A.b(t.length,2)&&A.b("'",pf(t,0))?pf(t,1):parseInt(t,10),e],null)}var EW=new n(null,2,[":",mt,"@",IH],null);function FW(n,e){return oU((function(n){var e=J(n,0,null),t=J(n,1,null);if(n=J(n,2,null),Pf(e))return new Q(null,2,5,R,[null,new Q(null,3,5,R,[e,t,n],null)],null);var r=x.b(EW,C(e));return p(r)?N(n,r)?tV(['Flag "',q.a(C(e)),'" appears more than once in a directive'].join(""),t):new Q(null,2,5,R,[!0,new Q(null,3,5,R,[e.substring(1),t+1,K.c(n,r,new Q(null,2,5,R,[!0,t],null))],null)],null):new Q(null,2,5,R,[null,new Q(null,3,5,R,[e,t,n],null)],null)}),new Q(null,3,5,R,[n,e,S],null))}function GW(n,e){var t,r=fv.a(n);p(!!Tc(IH.a(r))&&IH.a(e))&&tV(['"@" is an illegal flag for format directive "',q.a(Qo.a(n)),'"'].join(""),pf(IH.a(e),1)),p(!!Tc(mt.a(r))&&mt.a(e))&&tV(['":" is an illegal flag for format directive "',q.a(Qo.a(n)),'"'].join(""),pf(mt.a(e),1)),p(!!Tc(Qu.a(r))&&(p(t=IH.a(e))?mt.a(e):t))&&tV(['Cannot combine "@" and ":" flags for format directive "',q.a(Qo.a(n)),'"'].join(""),function(){var n=pf(mt.a(e),1),t=pf(IH.a(e),1);return n<t?n:t}())}function HW(n,e,t,r){return GW(n,t),F(e)>F(ns.a(n))&&tV(nV(null,'Too many parameters for directive "~C": ~D~:* ~[were~;was~:;were~] specified but only ~D~:* ~[are~;is~:;are~] allowed',G([Qo.a(n),F(e),F(ns.a(n))])),zf(C(e))),Vk(Wh.c((function(e,t){var r=C(e);return null==r||N(BW,r)||A.b(zf(zf(t)),Yc(r))?null:tV(["Parameter ",Lg(C(t)),' has bad type in directive "',q.a(Qo.a(n)),'": ',q.a(Yc(r))].join(""),zf(e))}),e,ns.a(n))),wk.g(G([ji.b(S,Eg(function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var i=re(t),o=F(i),l=Qg(o);n:for(var u=0;;){if(!(u<o)){i=!0;break n}var s=qd(i,u),a=J(s,0,null);s=J(s,1,null),s=J(s,0,null),l.add(new Q(null,2,5,R,[a,new Q(null,2,5,R,[s,r],null)],null)),u+=1}return Sg(Ug(l),i?n(se(t)):null)}return l=J(i=C(t),0,null),i=J(i,1,null),i=J(i,0,null),vf(new Q(null,2,5,R,[l,new Q(null,2,5,R,[i,r],null)],null),n(Re(t)))}return null}}),null,null)}(ns.a(n)))),gd.c((function(n,e){return gh(K,n,e)}),S,fi.b((function(n){return C(pf(n,1))}),Ik(mj(ns.a(n)),e))),t]))}function IW(n,e){n=J(e=oU(CW,new Q(null,3,5,R,[n,e,!1],null)),0,null);var t=J(e,1,null);e=J(t,0,null),t=J(t,1,null),J(e=FW(e,t),0,null),e=J(e,1,null);var r=J(e,0,null),i=J(e,1,null);e=J(e,2,null),t=C(r);var o,l=x.b(zW,t.toUpperCase()),u=p(l)?HW(l,Wh.b(DW,n),e,i):null;return Tc(t)&&tV("Format string ended in the middle of a directive",i),Tc(l)&&tV(['Directive "',q.a(t),'" is undefined'].join(""),i),new Q(null,2,5,R,[new zV((o=PI.a(l),o.b?o.b(u,i):o.call(null,u,i)),l,u,i,null,null,null),function(){var n=r.substring(1),e=i+1;if(A.b("\n",Qo.a(l))&&Tc(mt.a(u)))n:{var t=new Q(null,2,5,R,[" ","\t"],null);t=Qf(t)?Fk(t):Ek([t]);for(var o=0;;){var s;if((s=A.b(o,F(n)))||(s=pf(n,o),s=Tc(s=t.a?t.a(s):t.call(null,s))),s){t=o;break n}o+=1}}else t=0;return new Q(null,2,5,R,[n.substring(t),e+t],null)}()],null)}function JW(e,t){return new zV((function(n,t){return jU.g(G([e])),t}),null,new n(null,1,[xn,e],null),t,null,null,null)}function KW(n,e){var t=LW(Pw.a(yo.a(n)),qE.a(n),e);return e=J(t,0,null),t=J(t,1,null),new Q(null,2,5,R,[new zV(iG.a(n),yo.a(n),wk.g(G([ns.a(n),qU(e,qE.a(n))])),qE.a(n),null,null,null),t],null)}function MW(n,e,t){return oU((function(t){if(Pf(t))return tV("No closing bracket found.",e);var r=C(t);if(t=D(t),p(QB.a(Pw.a(yo.a(r)))))r=KW(r,t);else if(A.b(QB.a(n),Qo.a(yo.a(r))))r=new Q(null,2,5,R,[null,new Q(null,4,5,R,[Kq,ns.a(r),null,t],null)],null);else{var i=xD.a(Pw.a(yo.a(r)));i=p(i)?mt.a(ns.a(r)):i,r=p(i)?new Q(null,2,5,R,[null,new Q(null,4,5,R,[ks,null,ns.a(r),t],null)],null):p(xD.a(Pw.a(yo.a(r))))?new Q(null,2,5,R,[null,new Q(null,4,5,R,[xD,null,null,t],null)],null):new Q(null,2,5,R,[r,t],null)}return r}),t)}function LW(e,t,r){return zf(oU((function(r){var i=J(r,0,null),o=J(r,1,null);r=J(r,2,null);var l=MW(e,t,r);r=J(l,0,null);var u=J(l,1,null);l=J(u,0,null);var s=J(u,1,null),a=J(u,2,null);return u=J(u,3,null),A.b(l,Kq)?new Q(null,2,5,R,[null,new Q(null,2,5,R,[xk.g(Xg,G([i,Gf([p(o)?ks:hw,new Q(null,1,5,R,[r],null),kp,s])])),u],null)],null):A.b(l,ks)?p(ks.a(i))?tV('Two else clauses ("~:;") inside bracket construction.',t):Tc(ks.a(e))?tV('An else clause ("~:;") is in a bracket type that doesn\'t support it.',t):A.b(YA,ks.a(e))&&B(hw.a(i))?tV('The else clause ("~:;") is only allowed in the first position for this directive.',t):A.b(YA,ks.a(e))?new Q(null,2,5,R,[!0,new Q(null,3,5,R,[xk.g(Xg,G([i,new n(null,2,[ks,new Q(null,1,5,R,[r],null),HJ,a],null)])),!1,u],null)],null):new Q(null,2,5,R,[!0,new Q(null,3,5,R,[xk.g(Xg,G([i,new n(null,1,[hw,new Q(null,1,5,R,[r],null)],null)])),!0,u],null)],null):A.b(l,xD)?p(o)?tV('A plain clause (with "~;") follows an else clause ("~:;") inside bracket construction.',t):Tc(FG.a(e))?tV('A separator ("~;") is in a bracket type that doesn\'t support it.',t):new Q(null,2,5,R,[!0,new Q(null,3,5,R,[xk.g(Xg,G([i,new n(null,1,[hw,new Q(null,1,5,R,[r],null)],null)])),!1,u],null)],null):null}),new Q(null,3,5,R,[new n(null,1,[hw,I],null),!1,r],null)))}function NW(n){return C(oU((function(n){var e=C(n);n=D(n);var t=Pw.a(yo.a(e));return p(QB.a(t))?KW(e,n):new Q(null,2,5,R,[e,n],null)}),n))}function oV(n){var e=sV;sV=n;try{return NW(C(oU((function(n){var e=J(n,0,null);if(n=J(n,1,null),Pf(e))return new Q(null,2,5,R,[null,e],null);var t=e.indexOf("~");return 0>t?new Q(null,2,5,R,[JW(e,n),new Q(null,2,5,R,["",n+e.length],null)],null):0===t?IW(e.substring(1),n+1):new Q(null,2,5,R,[JW(e.substring(0,t),n),new Q(null,2,5,R,[e.substring(t),t+n],null)],null)}),new Q(null,2,5,R,[n,0],null))))}finally{sV=e}}var qV=function n(e){for(;;){if(Pf(e))return!1;var t=Jr.a(fv.a(yo.a(C(e))));if(p(t)||(t=p(t=Eh(n,C(hw.a(ns.a(C(e))))))?t:Eh(n,C(ks.a(ns.a(C(e)))))),p(t))return!0;e=D(e)}};function rV(n,e){return nU((function(n,e){if(ZV(e))return new Q(null,2,5,R,[null,e],null);var t=J(e=BV(ns.a(n),e),0,null);e=J(e,1,null);var r=pU(t);return t=J(r,0,null),r=J(r,1,null),t=K.c(t,qo,e),new Q(null,2,5,R,[null,fh(iG.a(n),new Q(null,3,5,R,[t,e,r],null))],null)}),e,n),null}var OW=function(n){var e=Oh(S);return function(){function r(n){var e=null;if(0<arguments.length){e=0;for(var t=Array(arguments.length-0);e<t.length;)t[e]=arguments[e+0],++e;e=new Qe(t,0,null)}return i.call(this,e)}function i(r){var i=x.c(t(e),r,Yf);return i===Yf?(i=fh(n,r),Rh.A(e,K,r,i),i):i}return r.F=0,r.G=function(n){return i(n=B(n))},r.g=i,r}()}(oV),PW=new n(null,6,[Hm,"'",Gm,"#'",Xq,"@",Zu,"~",Un,"@",Tz,"~"],null);function QW(n){var e=C(n);return p(p(e=PW.a?PW.a(e):PW.call(null,e))?A.b(2,F(n)):e)?(ce(Dc,e),gV(zf(n)),!0):null}function RW(n){if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{VU("[","]");for(var r=0,i=B(n);;){if(Tc(Hc)||r<Hc){if(i&&(gV(C(i)),D(i))){ce(Dc," "),lV(bF),n=r+1;var o=D(i);r=n,i=o;continue}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=e}}return null}function SW(n){var e,t=Uf(n)?null:(e=new Ne((function(){return ul}),YF,Xj([Jn,By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[!0,Hy,Cu,"cljs/core.cljs",15,1,10307,10307,O(new Q(null,1,5,R,[Kp],null)),"Returns [lifted-ns lifted-map] or nil if m can't be lifted.",p(ul)?ul.ld:null]))).a?e.a(n):e.call(null,n),r=J(t,0,null),i=p(t=J(t,1,null))?t:n,o=p(r)?["#:",q.a(r),"{"].join(""):"{";if(p(kV()))ce(Dc,"#");else{r=dV,t=eV,dV+=1,eV=0;try{VU(o,"}"),o=0;for(var l=B(i);;){if(Tc(Hc)||o<Hc){if(l){if(p(kV()))ce(Dc,"#");else{i=dV;var u=eV;dV+=1,eV=0;try{VU(null,null),gV(C(C(l))),ce(Dc," "),lV(bF),eV=0,gV(Af(C(l))),WU()}finally{eV=u,dV=i}}if(D(l)){ce(Dc,", "),lV(bF),i=o+1;var s=D(l);o=i,l=s;continue}}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=r}}return null}function TW(n){return ce(Dc,ol.g(G([n])))}!function(){var n=OW("~<[~;~@{~w~^, ~:_~}~;]~:>");(function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}e.F=0,e.G=function(n){return t(n=B(n))},e.g=t})()}();var UW=function(){var n=OW("~<#{~;~@{~w~^ ~:_~}~;}~:>");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}(),VW=new n(null,2,["core$future_call","Future","core$promise","Promise"],null);function WW(n){var e=Xk(/^[^$]+\$[^$]+/,n);return e=p(e)?VW.a?VW.a(e):VW.call(null,e):null,p(e)?e:n}var XW=function(){var n=OW("~<<-(~;~@{~w~^ ~_~}~;)-<~:>");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}();function YW(n){return n instanceof bj?TH:(null!=n?32768&n.h||h===n.nf||!n.h&&Xc(Ld,n):Xc(Ld,n))?Lx:n instanceof w?xu:$f(n)?JI:M(n)?Tv:Vf(n)?Uu:Rf(n)?yA:null==n?null:em}var ZW,a5=Oh(S),b5=Oh(S),c5=Oh(S),d5=Oh(S),g5=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));function eX(n){return Vf(n)?new Q(null,2,5,R,["[","]"],null):new Q(null,2,5,R,["(",")"],null)}function fX(n){if(Tf(n)){var e=eX(n),t=J(e,0,null),r=J(e,1,null),i=B(n),o=C(i),l=D(i);if(p(kV()))ce(Dc,"#");else{var u=dV,s=eV,a=dV+1;dV=a,eV=0;try{VU(t,r),(S=OW("~w~:i"),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return n=pV(n),rV(S,n)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}())(o);for(var c=l;B(c);){!function(){var n,e=OW(" ");return n=e,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()();var d=C(c);if(Tf(d)){var h=eX(d),f=J(h,0,null),g=J(h,1,null);if(p(kV()))ce(Dc,"#");else{var w=dV,v=eV,m=dV+1;dV=m,eV=0;try{if(VU(f,g),A.b(F(d),3)&&zf(d)instanceof z){var y=d,b=J(y,0,null),$=J(y,1,null),_=J(y,2,null);!function(){var n,e=OW("~w ~w ");return n=e,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(b,$),Tf(_)?function(){var n,e=Vf(_)?"~<[~;~@{~w~^ ~:_~}~;]~:>":"~<(~;~@{~w~^ ~:_~}~;)~:>",t="string"==typeof e?OW(e):e;return n=t,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(_):gV(_)}else fh(function(){var n,e=OW("~w ~:i~@{~w~^ ~:_~}");return n=e,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}(),d);WU()}finally{eV=v,dV=w}}D(c)&&function(){var n,e=OW("~_");return n=e,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()()}else gV(d),D(c)&&function(){var n,e=OW("~:_");return n=e,function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()();c=D(c)}WU()}finally{eV=s,dV=u}}}else gV(n);var S}ZW=new dm(Me.b(ca,"simple-dispatch"),YW,g5,a5,b5,c5,d5),$l(ZW,JI,(function(n){if(Tc(QW(n)))if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{VU("(",")");for(var r=0,i=B(n);;){if(Tc(Hc)||r<Hc){if(i&&(gV(C(i)),D(i))){ce(Dc," "),lV(bF),n=r+1;var o=D(i);r=n,i=o;continue}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=e}}return null})),$l(ZW,Uu,RW),$l(ZW,Tv,SW),$l(ZW,yA,UW),$l(ZW,null,(function(){return ce(Dc,ol.g(G([null])))})),$l(ZW,em,TW),YU=ZW;var gX=function(){var n=OW("~:<~w~^ ~@_~w~^ ~_~@{~w~^ ~_~}~:>");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}();function hX(n,e){var t;B(n)&&(p(e)?(t=OW(" ~_"),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return n=pV(n),rV(t,n)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}())():function(){var n=OW(" ~@_");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(),function(){var n=OW("~{~w~^ ~_~}");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(n))}function iX(n){var e;B(n)&&(e=OW(" ~_~{~w~^ ~_~}"),function(){function n(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(n){return n=pV(n),rV(e,n)}return n.F=0,n.G=function(n){return t(n=B(n))},n.g=t,n}())(n)}function jX(n){if(D(n)){var e=B(n);n=C(e);var t=D(e);e=C(t);var r="string"==typeof C(t=D(t))?new Q(null,2,5,R,[C(t),D(t)],null):new Q(null,2,5,R,[null,t],null);t=J(r,0,null);var i=M(C(r=J(r,1,null)))?new Q(null,2,5,R,[C(r),D(r)],null):new Q(null,2,5,R,[null,r],null);if(r=J(i,0,null),i=J(i,1,null),p(kV()))ce(Dc,"#");else{var o=dV,l=eV;dV+=1,eV=0;try{VU("(",")"),(u=OW("~w ~1I~@_~w"),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return n=pV(n),rV(u,n)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}())(n,e),p(t)&&function(){var n=OW(" ~_~w");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(t),p(r)&&function(){var n=OW(" ~_~w");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(r),Vf(C(i))?hX(i,p(t)?t:r):iX(i),WU()}finally{eV=l,dV=o}}return null}var u;return kX(n)}function lX(n){if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{VU("[","]");for(var r=0;;){if(Tc(Hc)||r<Hc){if(B(n)){if(p(kV()))ce(Dc,"#");else{var i=dV,o=eV;dV+=1,eV=0;try{VU(null,null),gV(C(n)),D(n)&&(ce(Dc," "),lV(cI),gV(zf(n))),WU()}finally{eV=o,dV=i}}if(D(Re(n))){ce(Dc," "),lV(bF),i=r+1;var l=D(Re(n));r=i,n=l;continue}}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=e}}}function mX(n){var e,t=C(n);if(p(kV()))ce(Dc,"#");else{var r=dV,i=eV;dV+=1,eV=0;try{VU("(",")"),D(n)&&Vf(zf(n))?((e=OW("~w ~1I~@_"),function(){function n(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(n){return n=pV(n),rV(e,n)}return n.F=0,n.G=function(n){return t(n=B(n))},n.g=t,n}())(t),lX(zf(n)),function(){var n=OW(" ~_~{~w~^ ~_~}");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(D(Re(n)))):kX(n),WU()}finally{eV=i,dV=r}}return null}var nX=function(){var n=OW("~:<~1I~w~^ ~@_~w~@{ ~_~w~}~:>");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}(),oX=S;function kX(n){if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{VU("(",")"),mV(eE,1);for(var r=0,i=B(n);;){if(Tc(Hc)||r<Hc){if(i&&(gV(C(i)),D(i))){ce(Dc," "),lV(bF),n=r+1;var o=D(i);r=n,i=o;continue}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=e}}return null}var pX=function(n){return ji.b(S,ei(lg,G([function n(e){return new Mg(null,(function(){for(;;){var t=B(e);if(t){if(Wf(t)){var r=re(t),i=F(r),o=Qg(i);n:for(var l=0;;){if(!(l<i)){r=!0;break n}var u=qd(r,l);u=new Q(null,2,5,R,[u,new Q(null,2,5,R,[Me.a(Lg(C(u))),zf(u)],null)],null),o.add(u),l+=1}return Sg(Ug(o),r?n(se(t)):null)}return o=C(t),vf(new Q(null,2,5,R,[o,new Q(null,2,5,R,[Me.a(Lg(C(o))),zf(o)],null)],null),n(Re(t)))}return null}}),null,null)}(n)])))}(function(n){return ji.b(S,Wh.b((function(n){var e=J(n,0,null),t=J(n,1,null),r=Ig(e);return Tc(r=p(r)?r:mm(e))?new Q(null,2,5,R,[Me.b("clojure.core",Lg(e)),t],null):n}),n))}(Xj([Fm,Cm,sp,wm,bJ,Fr,oy,OE,Bw,PE,kv,Kz,ix,Km,TB,Hz,vF,BD,yH,ym,aA,oH,Qt,ou,$w,pA,wE,ZI,jw,ss],[gX,function(n){var e,t=zf(n),r=C(Re(Re(n)));if(!Vf(t))return kX(n);n=oX,oX=A.b(1,F(t))?Gf([C(t),"%"]):ji.b(S,Wh.c((function(n,e){return new Q(null,2,5,R,[n,["%",q.a(e)].join("")],null)}),t,Rk(1,F(t)+1)));try{return(e=OW("~<#(~;~@{~w~^ ~_~}~;)~:>"),function(){function n(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(n){return n=pV(n),rV(e,n)}return n.F=0,n.G=function(n){return t(n=B(n))},n.g=t,n}())(r)}finally{oX=n}},mX,nX,function(n){if(3<F(n)){if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{VU("(",")"),mV(eE,1),fh((u=OW("~w ~@_~w ~@_~w ~_"),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return n=pV(n),rV(u,n)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}()),n);for(var r=0,i=B(Yh(3,n));;){if(Tc(Hc)||r<Hc){if(i){if(p(kV()))ce(Dc,"#");else{n=dV;var o=eV;dV+=1,eV=0;try{VU(null,null),gV(C(i)),D(i)&&(ce(Dc," "),lV(cI),gV(zf(i))),WU()}finally{eV=o,dV=n}}if(D(Re(i))){ce(Dc," "),lV(bF),n=r+1;var l=D(Re(i));r=n,i=l;continue}}}else ce(Dc,"...");break}WU()}finally{eV=t,dV=e}}return null}var u;return kX(n)},gX,jX,jX,mX,gX,mX,nX,nX,gX,nX,mX,mX,gX,mX,function(n){if(D(n)){var e=B(n);n=C(e);var t=D(e);e=C(t);var r="string"==typeof C(t=D(t))?new Q(null,2,5,R,[C(t),D(t)],null):new Q(null,2,5,R,[null,t],null);t=J(r,0,null),r=J(r,1,null);var i=J(r=M(C(r))?new Q(null,2,5,R,[C(r),D(r)],null):new Q(null,2,5,R,[null,r],null),0,null),o=J(r,1,null);if(p(kV()))ce(Dc,"#");else{r=dV;var l=eV;dV+=1,eV=0;try{for(VU("(",")"),(s=OW("~w ~1I~@_~w"),function(){function n(n){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Qe(r,0,null)}return e.call(this,t)}function e(n){return n=pV(n),rV(s,n)}return n.F=0,n.G=function(n){return e(n=B(n))},n.g=e,n}())(n,e),p(p(t)?t:p(i)?i:B(o))&&function(){var n=OW("~@:_");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(),p(t)&&nV(!0,'"~a"~:[~;~:@_~]',G([t,p(i)?i:B(o)])),p(i)&&function(){var n=OW("~w~:[~;~:@_~]");return function(){function e(n){var e=null;if(0<arguments.length){e=0;for(var r=Array(arguments.length-0);e<r.length;)r[e]=arguments[e+0],++e;e=new Qe(r,0,null)}return t.call(this,e)}function t(e){return e=pV(e),rV(n,e)}return e.F=0,e.G=function(n){return t(n=B(n))},e.g=t,e}()}()(i,B(o)),n=o;;){fX(C(n));var u=D(n);if(!u)break;e=u,lV(bF),n=e}WU()}finally{eV=l,dV=r}}return null}var s;return gV(n)},mX,function(n){if(p(kV()))ce(Dc,"#");else{var e=dV,t=eV;dV+=1,eV=0;try{if(VU("(",")"),mV(eE,1),gV(C(n)),D(n)){ce(Dc," "),lV(bF);for(var r=0,i=D(n);;){if(Tc(Hc)||r<Hc){if(i){if(p(kV()))ce(Dc,"#");else{n=dV;var o=eV;dV+=1,eV=0;try{VU(null,null),gV(C(i)),D(i)&&(ce(Dc," "),lV(cI),gV(zf(i))),WU()}finally{eV=o,dV=n}}if(D(Re(i))){ce(Dc," "),lV(bF),n=r+1;var l=D(Re(i));r=n,i=l;continue}}}else ce(Dc,"...");break}}WU()}finally{eV=t,dV=e}}return null},mX,jX,jX,gX,gX,mX,mX,gX]))),qX,h5=Oh(S),i5=Oh(S),j5=Oh(S),k5=Oh(S),l5=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));qX=new dm(Me.b(ca,"code-dispatch"),YW,l5,h5,i5,j5,k5),$l(qX,JI,(function(n){if(Tc(QW(n))){var e=pX.call(null,C(n));return p(e)?e.a?e.a(n):e.call(null,n):kX(n)}return null})),$l(qX,xu,(function(n){var e=n.a?n.a(oX):n.call(null,oX);return p(e)?jU.g(G([e])):p(aV)?jU.g(G([Lg(n)])):kU.call(null,n)})),$l(qX,Uu,RW),$l(qX,Tv,SW),$l(qX,yA,UW),$l(qX,TH,XW),$l(qX,Lx,(function(n){var e=["#<",q.a(WW(Yc(n).name)),"@",q.a(hb(n)),": "].join("");if(p(kV()))ce(Dc,"#");else{var r=dV,i=eV;dV+=1,eV=0;try{VU(e,">"),mV(eE,-(e.length-2)),lV(bF),gV((null!=n?1&n.I||h===n.Uh||!n.I&&Xc(ge,n):Xc(ge,n))&&!he(n)?Jz:t(n)),WU()}finally{eV=i,dV=r}}return null})),$l(qX,null,kU),$l(qX,em,TW),YU=ZW;var wX=null;function xX(){var e=wX;return p(e)||(e=new n(null,5,[Sx,new n(null,4,[jF,0,IE,0,fB,0,IA,0],null),qt,Se,uD,Se,zt,ol,RE,EC],null),e=A.b(az,EC)?K.g(e,RE,EC,G([zt,iV])):e),e}function yX(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return t=arguments[0],r=arguments[1],e=2<e.length?new Qe(e.slice(2),0,null):null,wX=ih(oi,xX(),t,r,e)}function zX(n){var e=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;n=x.b(e,OD);var t=x.b(e,en);return e=x.b(e,ux),[q.a(Eg(Wh.b((function(n){return yw.a(Lf(n))}),qt.a(xX()))))," (",q.a(n),":",q.a(t),p(e)?[":",q.a(e)].join(""):null,")"].join("")}function AX(n){return p(Sx.a(xX()))?yX(new Q(null,2,5,R,[Sx,n],null),Mh($e,0)):null}var BX=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(ea,"report"),(function(n){return new Q(null,2,5,R,[RE.a(xX()),U.a(n)],null)}),i,n,e,t,r)}();function CX(n){var e,t=p(e=zt.a(xX()))?e:ol;return sl(G(["expected:",function(){var e=Cy.a(n);return t.a?t.a(e):t.call(null,e)}()])),sl(G(["  actual:",function(){var e=MA.a(n);return t.a?t.a(e):t.call(null,e)}()]))}function DX(a){if(a=String(a),!/^\s*$/.test(a)&&/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/(?:"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(n){}throw Error("Invalid JSON string: "+a)}function EX(n){var e=[];return FX(new GX,n,e),e.join("")}function GX(){this.re=void 0}function FX(n,e,t){if(null==e)t.push("null");else{if("object"==typeof e){if("array"==db(e)){var r=e;e=r.length,t.push("[");for(var i="",o=0;o<e;o++)t.push(i),i=r[o],FX(n,n.re?n.re.call(r,String(o),i):i,t),i=",";return void t.push("]")}if(!(e instanceof String||e instanceof Number||e instanceof Boolean)){for(r in t.push("{"),o="",e)Object.prototype.hasOwnProperty.call(e,r)&&("function"!=typeof(i=e[r])&&(t.push(o),HX(r,t),t.push(":"),FX(n,n.re?n.re.call(e,r,i):i,t),o=","));return void t.push("}")}e=e.valueOf()}switch(typeof e){case"string":HX(e,t);break;case"number":t.push(isFinite(e)&&!isNaN(e)?String(e):"null");break;case"boolean":t.push(String(e));break;case"function":t.push("null");break;default:throw Error("Unknown type: "+typeof e)}}}BX.v(null,em,(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,IE],null),(function(){return AX(IE)})),BX.v(null,new Q(null,2,5,R,[EC,fB],null),(function(n){AX(fB),sl(G(["\nFAIL in",zX(n)])),B(uD.a(xX()))&&sl(G([fh(q,di(" ",Eg(uD.a(xX()))))]));var e=sr.a(n);return p(e)&&sl(G([e])),CX(n)})),BX.v(null,new Q(null,2,5,R,[EC,IA],null),(function(n){AX(IA),sl(G(["\nERROR in",zX(n)])),B(uD.a(xX()))&&sl(G([fh(q,di(" ",Eg(uD.a(xX()))))]));var e=sr.a(n);return p(e)&&sl(G([e])),CX(n)})),BX.v(null,new Q(null,2,5,R,[EC,Kr],null),(function(n){return sl(G(["\nRan",jF.a(n),"tests containing",IE.a(n)+fB.a(n)+IA.a(n),"assertions."])),sl(G([fB.a(n),"failures,",IA.a(n),"errors."]))})),BX.v(null,new Q(null,2,5,R,[EC,zs],null),(function(n){return sl(G(["\nTesting",Lg(By.a(n))]))})),BX.v(null,new Q(null,2,5,R,[EC,Fw],null),(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,co],null),(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,tJ],null),(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,Jx],null),(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,lx],null),(function(){return null})),BX.v(null,new Q(null,2,5,R,[EC,Xz],null),(function(){return null})),aK&&kK("9"),!dK||kK("528"),cK&&kK("1.9b")||aK&&kK("8")||$J&&kK("9.5")||dK&&kK("528"),cK&&!kK("8")||aK&&kK("9");var IX={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},JX=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function HX(n,e){e.push('"',n.replace(JX,(function(n){var e=IX[n];return e||(e="\\u"+(65536|n.charCodeAt(0)).toString(16).substr(1),IX[n]=e),e})),'"')}var KX=new Q(null,3,5,R,[2,91,0],null);function LX(n){return"string"==typeof n?A.b(n,"")?null:n:null}function MX(n){return"number"==typeof n?sg(n):"string"==typeof n?(n=parseInt(n,10),p(isNaN(n))?null:n):null}function NX(n,e,t){return og(Lk(),mg((function(e,t){var r=J(t,0,null);return t=J(t,1,null),n.c?n.c(e,r,t):n.call(null,e,r,t)}),lg),e,t)}function OX(n,e){return gd.c((function(e,t){return p(e=n.a?n.a(t):n.call(null,t))?bf(e):null}),null,e)}function PX(e){var t=J(e=UL(q.a(e),/-/,2),0,null);e=J(e,1,null);if("string"!=typeof t)throw new TypeError("re-seq must match against a string.");return t=p(t=Yk(/\d+/,t))?ki.b(MX,t):null,new n(null,2,[Ln,t,gH,p(e)?e.toLowerCase():null],null)}function QX(e){var t=J(KX,0,null),r=J(KX,1,null),i=J(KX,2,null),o=Vf(e)?e:Ln.a(PX(e));e=J(o,0,null);var l=J(o,1,null);if(o=J(o,2,null),e=J(o=ki.b((function(n){return p(n)?n:0}),new Q(null,3,5,R,[e,l,o],null)),0,null),l=J(o,1,null),o=J(o,2,null),!(t>e||A.b(t,e)&&(r>l||A.b(r,l)&&i>=o)))throw im("Insufficient `com.taoensso/encore` version, you may have a dependency conflict: see http://goo.gl/qBbLvC for solutions.",new n(null,2,[FE,SL(".",new Q(null,3,5,R,[e,l,o],null)),rq,SL(".",new Q(null,3,5,R,[t,r,i],null))],null))}A.b("default","nodejs");var RX=function n(e){switch(arguments.length){case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 2:return n.b(arguments[0],arguments[1]);default:for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],arguments[2],new Qe(t.slice(3),0,null))}};RX.c=function(n,e,t){return N(n,e)?n:K.c(n,e,t)},RX.g=function(n,e,t,r){return NX(RX,RX.c(n,e,t),r)},RX.G=function(n){var e=C(n),t=D(n);n=C(t);var r=D(t);return t=C(r),r=D(r),this.g(e,n,t,r)},RX.b=function(n,e){return kg((function(n,e,t){return N(n,e)?n:K.c(n,e,t)}),null==n?S:n,e)},RX.F=3;var SX=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};SX.b=function(n,e){e=0>e?0:e;var t=F(n);return e>=t?I:Wi(n,e,t)},SX.c=function(n,e,t){e=0>e?0:e;var r=sg(F(n));return e>=(t=t>r?r:t)?I:Wi(n,e,t)},SX.F=3;var TX=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function UX(n){var e=new Uh(S),r={};return function(){function i(n){var e=null;if(0<arguments.length){e=0;for(var t=Array(arguments.length-0);e<t.length;)t[e]=arguments[e+0],++e;e=new Qe(t,0,null)}return o.call(this,e)}function o(i){var o=C(i);return p(P.b?P.b(o,wr):P.call(null,o,wr))?(o=C(i=D(i)),p(P.b?P.b(o,hA):P.call(null,o,hA))?xe(e,S):e.Cc(null,Hf.b(e.zb(null),i)),null):p(P.b?P.b(o,dI):P.call(null,o,dI))?(i=D(i),o=fh(n,i),e.Cc(null,K.c(e.zb(null),i,o)),o):(o=x.c(t(e),i,r))===r?(o=fh(n,i),e.Cc(null,K.c(e.zb(null),i,o)),o):o}return i.F=0,i.G=function(n){return o(n=B(n))},i.g=o,i}()}function VX(n,e){this.n=n,this.We=e}function WX(n,e){this.n=n,this.$e=e}function XX(n,e,t){this.Ue=n,this.Uf=e,this.cf=t}function YX(n){if(M(n))return kg((function(n,e,t){var r=J(t,0,null);return t=J(t,1,null),K.c(n,e,new VX(r,t))}),S,n);if(Vf(n)){var e=new Uh(-1);return gd.c((function(n,t){var r=J(t,0,null),i=J(t,1,null);return t=J(t,2,null),K.c(n,p(t)?t:e.Cc(null,e.zb(null)+1),new VX(r,i))}),S,n)}throw im("No matching `encore/cond!` clause",S)}function ZX(e){function r(n,e){var r=(new Date).getTime();for(Tc(e)&&625e-7>=Math.random()&&(Ph(i,null),Rh.b(o,(function(n){return le(kg((function(n,e,t){return Pf(t=kg((function(n,e,t){var i=x.b(l,e);return p(i)?r>=t.$e+i.We?Hf.b(n,e):n:Hf.b(n,e)}),t,t))?ne(n,e):me(n,e,t)}),je(p(n)?n:S),n))})));;){var u=t(o),s=x.b(u,n),a=null==s?null:kg(function(n,e,t,r,i,o){return function(n,e,r){var i=x.b(o,e);return p(i)?r.n<i.n||0>=(r=r.$e+i.We-t)?n:null==n?new XX(Gf([e,r]),e,r):r>n.cf?new XX(K.c(n.Ue,e,r),e,r):new XX(K.c(n.Ue,e,r),n.Uf,n.cf):n}}(0,0,r,0,0,l),null,s);return p(p(e)?e:a)?p(e=a)?new Q(null,3,5,R,[(n=e).Uf,n.cf,n.Ue],null):null:(p(e=t(i))||(s=kg(function(n,e,t,r,i){return function(n,e,r){return K.c(n,e,function(){var n=x.b(t,e);if(p(n)){var o=n.$e;return i>=o+r.We?new WX(1,i):new WX(n.n+1,o)}return new WX(1,i)}())}}(0,0,s,0,r),s,l),Ph(o,K.c(u,n,s))),null)}}if(Pf(e))return new Q(null,2,5,R,[null,Hh(null)],null);var i=Oh(null),o=Oh(null),l=YX(e);return new Q(null,2,5,R,[o,function(){function e(e,t){if(p(P.b?P.b(e,nu):P.call(null,e,nu)))return p(P.b?P.b(t,JD):P.call(null,t,JD))?Ph(o,null):Rh.c(o,Hf,t),null;if(p(P.b?P.b(e,MG):P.call(null,e,MG)))return r(t,!0);throw im("Unrecognized rate limiter command",new n(null,2,[uF,e,Lq,t],null))}function t(n){return r(n,!1)}function i(){return r(null,!1)}var l;return(l=function(n,r){switch(arguments.length){case 0:return i.call(this);case 1:return t.call(this,n);case 2:return e.call(this,n,r)}throw Error("Invalid arity: "+arguments.length)}).o=i,l.a=t,l.b=e,l}()],null)}TX.b=function(n,e){var t=F(n);return 0>e?Wi(n,0>(e+=t)?0:e,t):e>=t?I:Wi(n,e,t)},TX.c=function(n,e,t){if(0>=t)return I;var r=sg(F(n));return 0>e?Wi(n,e=0>(e+=r)?0:e,(t=e+t)>r?r:t):e>=(r=(t=e+t)>r?r:t)?I:Wi(n,e,r)},TX.F=3;var $X=function(){function n(n){return new zc(n)}function e(){return new zc}var t;return(t=function(t){switch(arguments.length){case 0:return e.call(this);case 1:return n.call(this,t)}throw Error("Invalid arity: "+arguments.length)}).o=e,t.a=n,t}(),aY=function(){function n(n,e){return n=n instanceof zc?n:$X.a(q.a(n)),e=q.a(e),n.append(e)}function e(n){return n instanceof zc?n:$X.a(q.a(n))}function t(){return $X.o()}var r;return(r=function(r,i){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,r);case 2:return n.call(this,r,i)}throw Error("Invalid arity: "+arguments.length)}).o=t,r.a=e,r.b=n,r}();function bY(n,e){if(p(p(" ")?kh.b(" ",""):" ")){var t=ci(),r=mg(aY,q);return p(n)?ng(Ih.b(n,t),r,e):ng(t,r,e)}return p(n)?ng(n,mg(aY,q),e):q.a(gd.b(aY,e))}var cY=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};cY.b=function(n,e){return n.substring(e)},cY.c=function(n,e,t){return e>=t?"":n.substring(e,t)},cY.F=3;var dY=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function eY(n){return void 0===n||null==n?"nil":n}dY.b=function(n,e){return LX(n.substr(e))},dY.c=function(n,e,t){return LX(n.substr(e,t))},dY.F=3;var fY=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(0<t.length?new Qe(t.slice(0),0,null):null)};fY.g=function(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var e=x.b(n,Oy),t=x.b(n,Dx),r=x.b(n,ky),i=x.b(n,XD),o=x.b(n,Uq),l=x.b(n,ZE),u=x.b(n,Pn),s=x.b(n,HE),a=x.b(n,Zs);return mj(n),Math.round((p(a)?31536e6*a:0)+(p(i)?2551392e3*i:0)+(p(t)?6048e5*t:0)+(p(u)?864e5*u:0)+(p(s)?36e5*s:0)+(p(l)?6e4*l:0)+(p(o)?1e3*o:0)+(p(r)?r:0)+(p(e)?e:0))},fY.F=0,fY.G=function(n){return this.g(B(n))},Ih.b((function(n){return tg(sg(n),1e3)}),fY);var gY=function(){function e(e){if(e instanceof RegExp)return function(n){return Xk(e,n)};if("string"==typeof e){if(kh.b(-1,e.indexOf("*"))){var t=Zk(RL(RL(["^",e,"$"].join(""),".","\\."),"*","(.*)"));return function(n){return Xk(t,n)}}return function(n){return A.b(n,e)}}throw im("Unexpected ns-pattern type",new n(null,2,[uF,e,U,Yc(e)],null))}return function(){function n(n,t){var r,i,o,l=B(n)?(r=ki.b(e,n),i=B(r),o=C(i),D(i)?function(n){return OX((function(e){return e.a?e.a(n):e.call(null,n)}),r)}:function(n){return o.a?o.a(n):o.call(null,n)}):null,u=B(t)?function(){var n=ki.b(e,t),r=B(n),i=C(r);return D(r)?function(e){return Tc(OX((function(n){return n.a?n.a(e):n.call(null,e)}),n))}:function(n){return Tc(i.a?i.a(n):i.call(null,n))}}():null;return p(p(l)?u:l)?function(n){return n=q.a(n),p(l.a?l.a(n):l.call(null,n))&&!!p(u.a?u.a(n):u.call(null,n))||null}:p(l)?function(n){return!!p(l(q.a(n)))||null}:p(u)?function(n){return!!p(u(q.a(n)))||null}:function(){return!0}}function t(n){if(M(n))return r.b(ty.a(n),Lz.a(n));if(Vf(n)||Rf(n))return r.b(n,null);if(A.b(n,"*"))return function(){return!0};var t=e(n);return function(n){return!!p(t(q.a(n)))||null}}var r=null;return(r=function(e,r){switch(arguments.length){case 1:return t.call(this,e);case 2:return n.call(this,e,r)}throw Error("Invalid arity: "+arguments.length)}).a=t,r.b=n,r}()}();function hY(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return iY(0<e.length?new Qe(e.slice(0),0,null):null)}function iY(e){return J(e,0,null),new n(null,6,[Ju,!0,tB,!1,GI,null,eC,null,vr,dx,qI,"undefined"!=typeof console?function(n){var e,t=function(n){var e=function(){var e=n instanceof z?n.da:null;switch(e){case"trace":return console.trace;case"debug":return console.debug;case"info":return console.info;case"warn":return console.warn;case"error":case"fatal":return console.error;case"report":return console.info;default:throw Error(["No matching clause: ",q.a(e)].join(""))}}();return p(e)?e:console.log}(cn.a(n));if(p(t)){if(p(p(e=bA.a(n))?e:mi.b(n,new Q(null,2,5,R,[xw,bA],null)))){var r=function(){var e=K.g(n,fx,"",G([eB,null])),t=vr.a(n);return t.a?t.a(e):t.call(null,e)}(),i=function(){var e=QH.a(n),t=eB.a(n);return p(t)?vf(r,vf(t,e)):vf(r,e)}();return t.apply(console,fd(i))}return t.call(console,Bl(Qx.a(n)))}return null}:function(){return null}],null)}Ih.b(lh,SX),Ih.b(lh,TX),Ih.b(LX,cY),Ih.b(LX,dY),Vf(KX)?QX(new Q(null,3,5,R,[2,87,0],null)):QX(2.87);var jY=function n(e){switch(arguments.length){case 1:return n.a(arguments[0]);case 2:return n.b(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};jY.a=function(n){return jY.b(null,n)},jY.b=function(n,e){var t=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n,r=x.b(t,xB);x.b(t,UH);var i=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;e=x.b(i,cn),t=x.b(i,eB);var o=x.b(i,fx),l=x.b(i,uq),u=x.b(i,Pv);return x.b(i,et),x.b(i,pI),i=x.b(i,iF),[Lg(e).toUpperCase()," [",q.a(p(l)?l:p(u)?u:"?"),":",q.a(p(i)?i:"?"),"] - ",q.a(Bl(o)),p(r)?null:p(t)?["\n",q.a(kY?kY(t):lY.call(null,t,n))].join(""):null].join("")},jY.F=2;var mY=new n(null,6,[cn,AG,tz,I,tp,I,Eu,I,vr,jY,HG,new n(null,1,[zI,hY.a?hY.a(S):hY.call(null,S)],null)],null);function nY(n){for(var e=[],t=arguments.length,r=0;r<t;)e.push(arguments[r]),r+=1;return mY=gh(arguments[0],mY,1<e.length?new Qe(e.slice(1),0,null):null)}function oY(n){return nY((function(){return n}))}var pY=Fk(new Q(null,7,5,R,[mu,AG,sD,VH,IA,$B,rz],null)),qY=Ik(new Q(null,7,5,R,[mu,AG,sD,VH,IA,$B,rz],null),D(Rk(0,Number.MAX_VALUE)));function rY(e){var t=pY.a?pY.a(e):pY.call(null,e);if(p(t))return t;throw im("Invalid Timbre logging level",new n(null,1,[uF,e],null))}function sY(n,e){return t=rY(n),(qY.a?qY.a(t):qY.call(null,t))>=function(){var n=rY(e);return qY.a?qY.a(n):qY.call(null,n)}();var t}var tY=UX(gY),uY=UX((function(n,e,t){return(n=tY(n,e)).a?n.a(t):n.call(null,t)}));function vY(n,e,t){return t=p(t)?t:mY,sY(n,x.c(t,cn,rz))&&ag(uY(x.b(t,tz),x.b(t,tp),e))&&!0}function wY(n){return bY(Wh.a((function(n){return Uf(n=eY(n))?ol.g(G([n])):n})),n)}var xY=UX((function(n,e){return J(n=ZX(e),0,null),J(n,1,null)}));function yY(n){return 1<F(n)?Wi(n,1,F(n)):I}function zY(n){var e=P.b?P.b(mq,mq):P.call(null,mq,mq),t=P.b?P.b(fG,cG):P.call(null,fG,cG),r=J(n,0,null);if(p(p(e)?r instanceof Error:e)){e=r,r=null;var i=yY(n);return n=p(t)?J(i,0,null):null,t=p(t)?yY(i):i,new Q(null,4,5,R,[e,r,n,t],null)}return r=p(!!M(r)&&Mc.a(Lf(r)))?r:null,e=p(i=SB.a(r))?i:p(e)?null:mq,i=p(r=Hf.b(r,SB))?yY(n):n,n=p(t)?J(i,0,null):null,t=p(t)?yY(i):i,new Q(null,4,5,R,[e,r,n,t],null)}function AY(e,r,i,o,l){var u,s=mY;if(vY(e,r,s)){var a=new Date,c=J(o=zY(o=t(o)),0,null),d=J(o,1,null),f=J(o,2,null);if(o=J(o,3,null),a=Cf.b(p(null)?null:S,Xj([BC,Yx,QH,Pv,xs,uq,cn,eB,fI,iF,dn,xw,jt],[a,s,o,null,(u=new Bk(null,new n(null,2,[$B,null,IA,null],null),null),u.a?u.a(e):u.call(null,e)),r,e,c,null,i,new xl((function(){return c})),d,f])),p(a=gd.c((function(n,e){return null==(n=e.a?e.a(n):e.call(null,n))?bf(null):n}),a,Eu.a(s)))){o=null!=a&&(64&a.h||h===a.D)?fh(qk,a):a;var g=x.b(o,QH);a=K.c(a,uo,new xl((function(){return g})));var w=RX.g(a,fx,new xl((function(){if(A.b(null,fG))return"";if(A.b(fG,fG))return wY(g);if(A.b(cG,fG)){if("string"!=typeof f)throw im("Timbre format-style logging call without a format pattern (string)",new n(null,2,[cn,e,Ht,[q.a(p(r)?r:p(null)?null:"?"),":",q.a(p(i)?i:"?")].join("")],null));return gh(WQ,p(f)?f:"",ki.b(eY,g))}throw Error(["No matching clause: ",q.a(fG)].join(""))})),G([Lv,new xl((function(){return Je(new Q(null,3,5,R,[l,f,x.c(d,AI,g)],null))}))])),v=UX(x.c(s,vr,jY));kg((function(t,i,o){if(p((p(c=Ju.a(o))&&(c=GI.a(o),c=sY(e,p(c)?c:mu)),c))&&p(uY(tz.a(o),tp.a(o),r))){var l=eC.a(o);if(function(){var n=Pf(l);if(n)return n;n=xY(i,l);var e=Bl(Lv.a(w));return Tc(n=n.a?n.a(e):n.call(null,e))}()){var u=null!=o&&(64&o.h||h===o.D)?fh(qk,o):o;t=x.b(u,qI),x.b(u,tB);var s=function(){var n=vr.a(o),e=(e=null==n)?e:P.b?P.b(n,dx):P.call(null,n,dx);return p(e)?v:n}(),a=Cf.b(w,new n(null,4,[Fz,i,Cw,o,vr,s,Qx,new xl((function(){return s.a?s.a(w):s.call(null,w)}))],null));return u=function(){var n=Py.a(o);return p(n)?n.a?n.a(a):n.call(null,a):a}(),p(u)?t.a?t.a(u):t.call(null,u):null}}var c;return null}),null,HG.a(s))}}return null}function lY(n){switch(arguments.length){case 1:case 2:return kY(arguments[0]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}}function kY(n){return q.a(n)}function BY(n,e,t){var r=BY[db(null)];if(null!=r)r.A?r.A(null,n,e,t):r.call(null,null,n,e,t);else{if(null==(r=BY._))throw Zc("Measurements.record!",null);r.A?r.A(null,n,e,t):r.call(null,null,n,e,t)}}function CY(n){if(null!=n&&null!=n.yf)n.yf(n);else{var e=CY[db(null==n?null:n)];if(null!=e)e.a?e.a(n):e.call(null,n);else{if(null==(e=CY._))throw Zc("Node.close",n);e.a?e.a(n):e.call(null,n)}}}function DY(n,e){if(null!=n&&null!=n.zf)n.zf(n,e);else{var t=DY[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=DY._))throw Zc("Node.message",n);t.b?t.b(n,e):t.call(null,n,e)}}}function EY(n,e){if(null==n||null==n.Fg){var t=EY[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=EY._))throw Zc("Node.add-source",n);t.b?t.b(n,e):t.call(null,n,e)}}}function FY(n,e){if(null!=n&&null!=n.Af)n.Af(n,e);else{var t=FY[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=FY._))throw Zc("Node.remove-source",n);t.b?t.b(n,e):t.call(null,n,e)}}}function GY(n,e,t){if(t=ow.a(t),p(p(n=JT.b(n,t))?kh.b(e,lz.a(n)):n))throw im(["The original source of peer ",q.a(t)," doesnt match the current source"].join(""),S)}function HY(n,e,t){return gd.c((function(e,t){var r=J(e,0,null);e=J(e,1,null),AY(AG,Pa,33,new xl((function(){return new Q(null,2,5,R,["about to remove source from domain",ET(t)],null)})),-1707658676);var i=HT(t,r,n);return p(i)?(r=J(i,0,null),i=J(i,1,null),AY(AG,Pa,36,new xl((function(){return new Q(null,2,5,R,["removed source from domain",ET(t)],null)})),-1765538511),new Q(null,2,5,R,[r,ji.b(e,i)],null)):new Q(null,2,5,R,[r,e],null)}),new Q(null,2,5,R,[e,I],null),fi.b(Uc,Cf.b(ki.b((function(n){return J(n,0,null),n=J(n,1,null),tq.a(n)}),Hf.b(t,"global")),mi.b(t,new Q(null,2,5,R,["global",tq],null)))))}function IY(n,e,t,r,i){try{if(A.b(Nz,U.a(i)))return HY(t,e,n);var o=mi.b(n,new Q(null,2,5,R,[tq.b(i,"global"),tq],null));return p(o)?(AY(AG,Pa,59,new xl((function(){return new Q(null,4,5,R,["Handling message with domain",o,"message: \n",q.a(t)],null)})),-150357184),GY(e,r,i),HT(o,e,t)):new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(tq.a(i),r,is.a(i),ow.a(i),mL("global.errors.failure",["Unable to find domain for message ",q.a(t)].join("")))],null)],null)}finally{p(n=U.a(i))&&p(null)&&BY(HC,["inv/",Lg(n)].join(""),0)}}var JY={};function KY(n){n=bL(n);var e=U.a(n);return p(e)?K.c(n,U,Kg.a(e)):n}function LY(e,r,i,o){e=KY(e);var l=mi.b(t(r),new Q(null,2,5,R,[o,lz],null));if(p(l)){A.b(cJ,U.a(e))||DY(i,new n(null,3,[Hv,Fs,lz,l,Xv,e],null));var u=(new Date).getTime();return Rh.b(r,(function(n){return ni(n,new Q(null,2,5,R,[o,Nn],null),u)}))}return AY(VH,na,31,new xl((function(){return new Q(null,2,5,R,["Cannot process message for not-registered key",o],null)})),-1344154771)}function MY(n,e){YK(lD.a(n));try{FY(e,n)}catch(n){if(!(n instanceof Error))throw n;var t=n;AY(IA,na,39,new xl((function(){return new Q(null,3,5,R,[t,"Unable to remove client for",Pi],null)})),-1803855914)}}function NY(n,e,t){AY(sD,na,43,new xl((function(){return new Q(null,2,5,R,["removing client for",t],null)})),38438999);var r=J(n=Th(n,t),0,null);J(n,1,null),p(n=mi.b(r,new Q(null,2,5,R,[t,lz],null)))&&MY(n,e)}function OY(e,t,r,i){Rh.A(e,K,r,new n(null,2,[lz,i,Nn,(new Date).getTime()],null)),EY(t,i)}function PY(n,e,t){return ji.b(S,function(){function r(n){return J(n,0,null),n=J(n,1,null),Nn.a(n)<e}return n.b?n.b(r,t):n.call(null,r,t)}())}function QY(n,e,t){AY(AG,na,61,new xl((function(){return new Q(null,2,5,R,["running client scavenger. collecting everything older than",t],null)})),695701546);for(var r=J(n=Sh(n,Kh(PY,gi,t)),0,null),i=(J(n,1,null),B(PY(fi,t,r))),o=null,l=0,u=0;;)if(u<l){var s=o.W(null,u),a=J(s,0,null),c=J(s,1,null),d=lz.a(c);AY(sD,na,66,new xl(function(n,e,t,r,i,o,l){return function(){return new Q(null,2,5,R,["scavenging client for",l],null)}}(0,0,0,0,0,0,a)),-1066526687),MY(d,e),u+=1}else{if(!(d=B(i)))break;if(Wf(s=d))i=re(s),u=se(s),o=i,l=F(i),i=u;else{var h=C(s);a=J(h,0,null),c=J(h,1,null);var f=lz.a(c);AY(sD,na,66,new xl(function(n,e,t,r,i,o,l){return function(){return new Q(null,2,5,R,["scavenging client for",l],null)}}(0,0,0,0,0,0,a)),697620603),MY(f,e),i=D(s),o=null,l=0}u=0}}var RY={},m5;function TY(e,t,r,i){var o=OK(1);return uK((function(){var n,t=function(){function n(n){var t=n[1];if(7===t)return n[2]=n[2],n[1]=3,yz;if(1===t)return n[2]=null,n[1]=2,yz;if(4===t)return t=n[7],t=n[2],n[7]=t,n[1]=p(t)?5:6,yz;if(13===t)return n[2]=null,n[1]=14,yz;if(6===t)return n[2]=null,n[1]=7,yz;if(3===t)return LK(n,n[2]);if(12===t)return t=n[7],t=Hl(t),t=e.b?e.b(i,t):e.call(null,i,t),n[2]=t,n[1]=14,yz;if(2===t)return KK(n,r);if(11===t){if(n[4]=Re(n[4]),t=n[2],n[5]=t,!(t instanceof Error))throw t;return n[1]=10,n[5]=null,yz}if(9===t)return n[8]=n[2],n[2]=null,n[1]=2,yz;if(5===t)return n[2]=null,n[1]=8,yz;if(14===t)return t=n[2],n[4]=Re(n[4]),n[2]=t,n[1]=9,yz;if(10===t){t=n[7];var o=n[2];return t=AY(IA,oa,15,new xl((function(){return new Q(null,2,5,R,[o,"error while invoking the client callback"],null)})),377597321),n[2]=t,n[1]=9,yz}return 8===t?(n[4]=vf(11,n[4]),n[1]=p(e)?12:13,yz):null}return function(){function e(e){for(;;){n:try{for(;;){var t=n(e);if(!P(t,yz)){var r=t;break n}}}catch(n){if(r=n,e[2]=r,!B(e[4]))throw r;e[1]=C(e[4]),r=yz}if(!P(r,yz))return r}}function t(){var n=[null,null,null,null,null,null,null,null,null];return n[0]=r,n[1]=1,n}var r=null;return(r=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)}).o=t,r.a=e,r}()}();return JK(((n=t())[6]=o,n))})),new n(null,3,[U,Fs,lD,r,Rs,tn.b(t,"127.0.0.1")],null)}function UY(n,e){return p(p(n)?e:n)&&(n=t(n),NY(kE.a(n),Yp.a(n),e),AY(sD,oa,27,new xl((function(){return new Q(null,1,5,R,["local client disconnected"],null)})),1501190767)),Promise.resolve(!0)}function VY(n,e,r){if(p(p(n)?e:n)){AY(AG,oa,33,new xl((function(){return new Q(null,3,5,R,["Processing incoming message",r,"from local client"],null)})),1854402887);var i=Ll(r);return n=t(n),LY(i,kE.a(n),Yp.a(n),e)}return null}function WY(n,e){var r=t(n),i=OK(new YJ(WJ(100),100)),o=(void 0!==SK&&void 0!==JY&&void 0!==RY&&void 0!==m5||((m5=function(n,e,t,r,i){this.Qe=n,this.Wd=e,this.qd=t,this.ch=r,this.fh=i,this.h=393216,this.I=0}).prototype.O=function(n,e){return new m5(this.Qe,this.Wd,this.qd,this.ch,e)},m5.prototype.N=function(){return this.fh},m5.prototype.disconnect=function(){return UY(this.Qe,this.ch)},m5.prototype.send=function(n){return VY(this.Qe,this.ch,n)},m5.Pa=function(){return new Q(null,5,5,R,[zp,Kt,hu,Jt,eK],null)},m5.Ia=!0,m5.Da="gateway.cljs.local-client/t_gateway$cljs$local_client14811",m5.Ja=function(n){return ce(n,"gateway.cljs.local-client/t_gateway$cljs$local_client14811")}),new m5(n,e,r,i,S));AY(sD,oa,46,new xl((function(){return new Q(null,1,5,R,["local client connected"],null)})),113159820);var l=TY(e,r,i,o);return OY(kE.a(r),Yp.a(r),i,l),Promise.resolve(o)}var n5=function(){function n(n,e,t){var r=XY[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=XY._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("IPromise.-then",n)}function e(n,e){var t=XY[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=XY._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("IPromise.-then",n)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),XY=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};XY.b=function(n,e){return null!=n&&null!=n.If?n.If(n,e):n5(n,e)},XY.c=function(n,e,t){return null!=n&&null!=n.Jf?n.Jf(n,e,t):n5(n,e,t)},XY.F=3;var o5=function(){function n(n,e,t){var r=YY[db(null==n?null:n)];if(null!=r)return r.c?r.c(n,e,t):r.call(null,n,e,t);if(null!=(r=YY._))return r.c?r.c(n,e,t):r.call(null,n,e,t);throw Zc("IPromise.-thenErr",n)}function e(n,e){var t=YY[db(null==n?null:n)];if(null!=t)return t.b?t.b(n,e):t.call(null,n,e);if(null!=(t=YY._))return t.b?t.b(n,e):t.call(null,n,e);throw Zc("IPromise.-thenErr",n)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),YY=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function ZY(n){if(null!=n&&null!=n.Xe)n=n.Xe(n);else{var e=ZY[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=ZY._))throw Zc("IPromiseFactory.-promise",n);n=e.a?e.a(n):e.call(null,n)}}return n}function $Y(n){if(null!=n&&null!=n.Ff)n.Ff(n);else{var e=$Y[db(null==n?null:n)];if(null!=e)e.a?e.a(n):e.call(null,n);else{if(null==(e=$Y._))throw Zc("ICancellable.-cancel!",n);e.a?e.a(n):e.call(null,n)}}}function aZ(n,e){if(null!=n&&null!=n.Hf)n=n.Hf(n,e);else{var t=aZ[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=aZ._))throw Zc("ICompletable.-resolve!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function bZ(n,e){if(null!=n&&null!=n.Gf)n=n.Gf(n,e);else{var t=bZ[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=bZ._))throw Zc("ICompletable.-reject!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function cZ(n,e,t){if(null!=n&&null!=n.Mf)n=n.Mf(n,e,t);else{var r=cZ[db(null==n?null:n)];if(null!=r)n=r.c?r.c(n,e,t):r.call(null,n,e,t);else{if(null==(r=cZ._))throw Zc("IScheduler.-schedule!",n);n=r.c?r.c(n,e,t):r.call(null,n,e,t)}}return n}YY.b=function(n,e){return null!=n&&null!=n.Kf?n.Kf(n,e):o5(n,e)},YY.c=function(n,e,t){return null!=n&&null!=n.Lf?n.Lf(n,e,t):o5(n,e,t)},YY.F=3;var eZ=new xl((function(){return dZ.o?dZ.o():dZ.call(null)}));function fZ(n){return cZ(eZ instanceof xl?t(eZ):eZ,1e3,n)}function gZ(n,e){cZ(eZ instanceof xl?t(eZ):eZ,n,e)}function hZ(n){this.state=n,this.I=1,this.h=0}function iZ(){}function dZ(){return new iZ}hZ.prototype.Bd=function(){return t(Vb(this.state,"done"))},hZ.prototype.Ff=function(){if(p(Vb(this.state,"cancelled")))return null;var n=Vb(this.state,"cancel-fn");return this.state.cancelled=!0,n.o?n.o():n.call(null)},iZ.prototype.Mf=function(n,e,t){var r=new Uh(!1),i=setTimeout((function(){try{return t.o?t.o():t.call(null)}finally{xe(r,!0)}}),e);return new hZ({done:r,cancelled:!1,"cancel-fn":function(){return clearTimeout(i)}})};var jZ=Promise;function kZ(){var n={},e=new jZ((function(e,t){return n.resolve=e,n.reject=t}));return e.Zh=h,e.Hf=function(e,t){return n.resolve(t)},e.Gf=function(e,t){return n.reject(t)},e}function lZ(n){var e=kZ();try{var t=function(n){return aZ(e,n)},r=function(n){return bZ(e,n)};n.b?n.b(t,r):n.call(null,t,r)}catch(n){bZ(e,n)}return e}function mZ(n,e){return XY(n,e)}function nZ(n,e){return YY(n,e)}function oZ(){return this}function pZ(n,e){return qZ(n,e)}function qZ(e,t){var r=new n(null,2,[U,lC,sr,"Authentication timed out"],null),i=kZ();return gZ(t,(function(){return A.b(r,Ix)?bZ(i,new oZ("Operation timed out.")):aZ(i,r)})),jZ.race(fd(Wh.b(ZY,new Q(null,2,5,R,[e,i],null))))}function rZ(n,e){if(null!=n&&null!=n.wf)n=n.wf(n,e);else{var t=rZ[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=rZ._))throw Zc("Authenticator.authenticate",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function sZ(n){if(null!=n&&null!=n.xf)n.xf(n);else{var e=sZ[db(null==n?null:n)];if(null!=e)e.a?e.a(n):e.call(null,n);else{if(null==(e=sZ._))throw Zc("Authenticator.stop",n);e.a?e.a(n):e.call(null,n)}}}function tZ(e){var t=null!=(e=YB.a(e))&&(64&e.h||h===e.D)?fh(qk,e):e;return e=x.b(t,Gs),t=x.b(t,Ro),p(p(e)?t:e)?jZ.resolve(new n(null,3,[U,qz,dt,e,Gs,e],null)):jZ.reject(im("Missing login/secret",new n(null,2,[U,lC,sr,"Missing login/secret"],null)))}function uZ(n){return A.b(Ts.a(n),"gateway-token")?$p.a(n):null}!function(n){n.prototype.Xe=function(){return this},n.prototype.If=function(n,e){return this.then((function(n){return e.a?e.a(n):e.call(null,n)}))},n.prototype.Jf=function(n,e){return this.then((function(n){return e.a?e.a(n):e.call(null,n)}))},n.prototype.Kf=function(n,e){return this.catch((function(n){return e.a?e.a(n):e.call(null,n)}))},n.prototype.Lf=function(n,e){return this.catch((function(n){return e.a?e.a(n):e.call(null,n)}))}}(Promise),YY._=function(){function n(n,e,t){return YY(ZY(n),e,t)}function e(n,e){return YY(ZY(n),e)}var t;return(t=function(t,r,i){switch(arguments.length){case 2:return e.call(this,t,r);case 3:return n.call(this,t,r,i)}throw Error("Invalid arity: "+arguments.length)}).b=e,t.c=n,t}(),Error.prototype.Xe=function(){return jZ.reject(this)},ZY._=function(n){return jZ.resolve(n)},Promise.prototype.ma=h,Promise.prototype.S=function(n,e){return ce(e,"#<Promise[~]>")},ub(oZ,Error),Z(KI,BI,Wc),Z(dq,Wx,Wx),Z(RC,O(wt,ir,new Q(null,1,5,R,[KI],null),iA,new Q(null,2,5,R,[GF,dq],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[KI],null),new Q(null,2,5,R,[GF,dq],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,YB)}],null),function(n){return M(n)&&N(n,YB)},new Q(null,2,5,R,[is,su],null),new Q(null,1,5,R,[KI],null),null,new Q(null,1,5,R,[YB],null),new Q(null,2,5,R,[GF,dq],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,YB))],null),null]))),Z(fE,Qp,Hg);var vZ,p5=Oh(S),q5=Oh(S),r5=Oh(S),s5=Oh(S),t5=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));vZ=new dm(Me.b(ka,"response-type"),U,t5,p5,q5,r5,s5),Z(ey,Bo,Vc),vZ.v(null,lC,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[fE,ey],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,sr)}],null),function(n){return M(n)&&N(n,U)&&N(n,sr)},I,new Q(null,2,5,R,[fE,ey],null),null,new Q(null,2,5,R,[U,sr],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,sr))],null),null]))})),Z(br,Bo,Vc),Z(Xs,Bo,Vc),Z(gB,Bo,Vc),vZ.v(null,qz,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[fE,br,Xs],null),new Q(null,1,5,R,[gB],null),null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,Gs)},function(n){return N(n,dt)}],null),function(n){return M(n)&&N(n,U)&&N(n,Gs)&&N(n,dt)},new Q(null,1,5,R,[Gu],null),new Q(null,3,5,R,[fE,br,Xs],null),null,new Q(null,3,5,R,[U,Gs,dt],null),new Q(null,1,5,R,[gB],null),new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Gs)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,dt))],null),null]))})),vZ.v(null,fF,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[fE,KI],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,YB)}],null),function(n){return M(n)&&N(n,U)&&N(n,YB)},I,new Q(null,2,5,R,[fE,KI],null),null,new Q(null,2,5,R,[U,YB],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,YB))],null),null]))})),Z(wH,O(io,$o,U),VS($o,new Ne((function(){return vZ}),$o,Xj([By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[ms,vC,"gateway/auth/spec.cljc",24,1,14,14,Se,null,p(vZ)?vZ.ld:null]))));var BZ=new n(null,6,["application",new n(null,1,[ax,!0],null),"instance",new n(null,1,[ax,!1],null),"region",new n(null,1,[ax,!1],null),"environment",new n(null,1,[ax,!1],null),"machine",new n(null,1,[ax,!1],null),"user",new n(null,1,[ax,!1],null)],null);function CZ(n){return kg((function(n,e,t){return K.c(n,N(BZ,e)?Kg.a(e):e,t)}),S,n)}function DZ(n){var e=Eh((function(e){var t=J(e,0,null);return J(e,1,null),p(e=ax.a(t))?null==x.b(n,Kg.a(t)):e}),BZ);if(p(e)){var t=J(e,0,null);return J(e,1,null),t}return null}function EZ(n){var e=DZ(n);if(p(e))throw im(["Identity ",q.a(n)," is missing a required key: ",q.a(e)].join(""),S)}function Z4(n,e){var t=p(n)?-1!=n.indexOf("127.0.0.1"):n;return p(t)?p(t=e)?t:n:p(t=n)?t:e}function FZ(n){for(var e=[],t=0,r=0;r<n.length;r++){var i=n.charCodeAt(r);255<i&&(e[t++]=255&i,i>>=8),e[t++]=i}return e}pc(),ZJ()||oc("iPod"),oc("iPad"),!oc("Android")||qc()||pc()||oc("Opera")||oc("Silk"),qc();var GZ=oc("Safari")&&!(qc()||oc("Coast")||oc("Opera")||oc("Edge")||oc("Edg/")||oc("OPR")||pc()||oc("Silk")||oc("Android"))&&!(ZJ()||oc("iPad")||oc("iPod")),HZ={},IZ=null,JZ=cK||dK&&!GZ||$J,KZ=JZ||"function"==typeof cb.btoa,LZ=JZ||!GZ&&!aK&&"function"==typeof cb.atob,UZ;function MZ(n,e){void 0===e&&(e=0),NZ(),e=HZ[e];for(var t=[],r=0;r<n.length;r+=3){var i=n[r],o=r+1<n.length,l=o?n[r+1]:0,u=r+2<n.length,s=u?n[r+2]:0,a=i>>2;i=(3&i)<<4|l>>4,l=(15&l)<<2|s>>6,s&=63,u||(s=64,o||(l=64)),t.push(e[a],e[i],e[l]||"",e[s]||"")}return t.join("")}function OZ(n){return KZ?cb.btoa(n):MZ(FZ(n),void 0)}function PZ(n){if(LZ)return cb.atob(n);var e="";return QZ(n,(function(n){e+=String.fromCharCode(n)})),e}function QZ(n,e){function t(e){for(;r<n.length;){var t=n.charAt(r++),i=IZ[t];if(null!=i)return i;if(!ec(t))throw Error("Unknown base64 encoding at char: "+t)}return e}NZ();for(var r=0;;){var i=t(-1),o=t(0),l=t(64),u=t(64);if(64===u&&-1===i)break;e(i<<2|o>>4),64!=l&&(e(o<<4&240|l>>2),64!=u&&e(l<<6&192|u))}}function NZ(){if(!IZ){IZ={};for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],t=0;5>t;t++){var r=n.concat(e[t].split(""));HZ[t]=r;for(var i=0;i<r.length;i++){var o=r[i];void 0===IZ[o]&&(IZ[o]=i)}}}}function RZ(){this.bb=-1}function SZ(n,e){this.bb=TZ,this.zc=cb.Uint8Array?new Uint8Array(this.bb):Array(this.bb),this.Lc=this.rd=0,this.aa=[],this.me=n,this.ge=e,this.af=cb.Int32Array?new Int32Array(64):Array(64),void 0===UZ&&(UZ=cb.Int32Array?new Int32Array(VZ):VZ),this.reset()}ub(SZ,RZ);var TZ=64,WZ=Kb(128,Rb(TZ-1));SZ.prototype.reset=function(){this.Lc=this.rd=0,this.aa=cb.Int32Array?new Int32Array(this.ge):Lb(this.ge)},SZ.prototype.Tc=function(){for(var n=this.zc,e=this.af,t=0,r=0;r<n.length;)e[t++]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r=4*t;for(n=16;64>n;n++){r=0|e[n-15],t=0|e[n-2];var i=(0|e[n-16])+((r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3)|0,o=(0|e[n-7])+((t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)|0;e[n]=i+o|0}t=0|this.aa[0],r=0|this.aa[1];var l=0|this.aa[2],u=0|this.aa[3],s=0|this.aa[4],a=0|this.aa[5],c=0|this.aa[6];for(i=0|this.aa[7],n=0;64>n;n++){var d=((t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10))+(t&r^t&l^r&l)|0;o=(i=i+((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))|0)+((o=(o=s&a^~s&c)+(0|UZ[n])|0)+(0|e[n])|0)|0,i=c,c=a,a=s,s=u+o|0,u=l,l=r,r=t,t=o+d|0}this.aa[0]=this.aa[0]+t|0,this.aa[1]=this.aa[1]+r|0,this.aa[2]=this.aa[2]+l|0,this.aa[3]=this.aa[3]+u|0,this.aa[4]=this.aa[4]+s|0,this.aa[5]=this.aa[5]+a|0,this.aa[6]=this.aa[6]+c|0,this.aa[7]=this.aa[7]+i|0},SZ.prototype.update=function(n,e){void 0===e&&(e=n.length);var t=0,r=this.rd;if("string"==typeof n)for(;t<e;)this.zc[r++]=n.charCodeAt(t++),r==this.bb&&(this.Tc(),r=0);else{if(!eb(n))throw Error("message must be string or array");for(;t<e;){var i=n[t++];if(!("number"==typeof i&&0<=i&&255>=i&&i==(0|i)))throw Error("message must be a byte array");this.zc[r++]=i,r==this.bb&&(this.Tc(),r=0)}}this.rd=r,this.Lc+=e},SZ.prototype.digest=function(){var n=[],e=8*this.Lc;56>this.rd?this.update(WZ,56-this.rd):this.update(WZ,this.bb-(this.rd-56));for(var t=63;56<=t;t--)this.zc[t]=255&e,e/=256;for(this.Tc(),t=e=0;t<this.me;t++)for(var r=24;0<=r;r-=8)n[e++]=this.aa[t]>>r&255;return n};var VZ=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function XZ(){SZ.call(this,8,YZ)}ub(XZ,SZ);var YZ=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function ZZ(n,e){this.bb=128,this.zc=cb.Uint8Array?new Uint8Array(this.bb):Array(this.bb),this.Lc=this.fd=0,this.aa=[],this.me=n,this.af=[],this.ge=$Z(e),this.le=!1,this.reset()}ub(ZZ,RZ);var a_=Kb([128],Rb(127));function $Z(n){for(var e=[],t=0;t<n.length;t+=2)e.push(new xb(n[t+1],n[t]));return e}g=ZZ.prototype,g.reset=function(){this.Lc=this.fd=0,this.aa=Lb(this.ge),this.le=!1},g.update=function(n,e){if(e=void 0!==e?e:n.length,this.le)throw Error("this hasher needs to be reset");var t=this.fd;if("string"==typeof n)for(var r=0;r<e;r++){var i=n.charCodeAt(r);if(255<i)throw Error("Characters must be in range [0,255]");this.zc[t++]=i,t==this.bb&&(this.Tc(),t=0)}else{if(!eb(n))throw Error("message must be string or array");for(r=0;r<e;r++){if("number"!=typeof(i=n[r])||0>i||255<i||i!=(0|i))throw Error("message must be a byte array");this.zc[t++]=i,t==this.bb&&(this.Tc(),t=0)}}this.fd=t,this.Lc+=e},g.digest=function(){if(this.le)throw Error("this hasher needs to be reset");var n=8*this.Lc;112>this.fd?this.update(a_,112-this.fd):this.update(a_,this.bb-this.fd+112);for(var e=127;112<=e;e--)this.zc[e]=255&n,n/=256;this.Tc(),n=0;var t=Array(8*this.me);for(e=0;e<this.me;e++){var r=this.aa[e],i=r.ea;r=r.ja;for(var o=24;0<=o;o-=8)t[n++]=i>>o&255;for(o=24;0<=o;o-=8)t[n++]=r>>o&255}return this.le=!0,t},g.Tc=function(){for(var n=this.zc,e=this.af,t=0;16>t;t++){var r=8*t;e[t]=new xb(n[r+4]<<24|n[r+5]<<16|n[r+6]<<8|n[r+7],n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3])}for(t=16;80>t;t++){n=(r=e[t-15]).ja,r=r.ea;var i=e[t-2],o=i.ja;i=i.ea,e[t]=this.Rf(e[t-16],e[t-7],new xb(n>>>1^r<<31^n>>>8^r<<24^n>>>7^r<<25,r>>>1^n<<31^r>>>8^n<<24^r>>>7),new xb(o>>>19^i<<13^i>>>29^o<<3^o>>>6^i<<26,i>>>19^o<<13^o>>>29^i<<3^i>>>6))}n=this.aa[0],r=this.aa[1],o=this.aa[2],i=this.aa[3];var l=this.aa[4],u=this.aa[5],s=this.aa[6],a=this.aa[7];for(t=0;80>t;t++){var c=n.ja,d=n.ea;c=new xb(c>>>28^d<<4^d>>>2^c<<30^d>>>7^c<<25,d>>>28^c<<4^c>>>2^d<<30^c>>>7^d<<25).add(new xb(n.ja&r.ja|r.ja&o.ja|n.ja&o.ja,n.ea&r.ea|r.ea&o.ea|n.ea&o.ea)),d=l.ja;var h=l.ea,f=l.ja,p=l.ea;d=this.Rf(a,new xb(d>>>14^h<<18^d>>>18^h<<14^h>>>9^d<<23,h>>>14^d<<18^h>>>18^d<<14^d>>>9^h<<23),new xb(f&u.ja|~f&s.ja,p&u.ea|~p&s.ea),b_[t],e[t]),a=s,s=u,u=l,l=i.add(d),i=o,o=r,r=n,n=d.add(c)}this.aa[0]=this.aa[0].add(n),this.aa[1]=this.aa[1].add(r),this.aa[2]=this.aa[2].add(o),this.aa[3]=this.aa[3].add(i),this.aa[4]=this.aa[4].add(l),this.aa[5]=this.aa[5].add(u),this.aa[6]=this.aa[6].add(s),this.aa[7]=this.aa[7].add(a)},g.Rf=function(n,e,t){for(var r=(2147483648^n.ja)+(2147483648^e.ja),i=n.ea+e.ea,o=arguments.length-1;2<=o;--o)r+=2147483648^arguments[o].ja,i+=arguments[o].ea;return 1&arguments.length&&(r+=2147483648),i+=arguments.length>>1,new xb(r,i+=Math.floor(r/4294967296))};var b_=$Z([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c_(){ZZ.call(this,6,d_)}ub(c_,ZZ);var d_=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428];function e_(){ZZ.call(this,8,f_)}ub(e_,ZZ);var f_=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209];function g_(n,e,t){for(this.bb=-1,this.Rb=n,this.bb=t||n.bb||16,this.Bf=Array(this.bb),this.Te=Array(this.bb),(n=e).length>this.bb&&(this.Rb.update(n),n=this.Rb.digest(),this.Rb.reset()),t=0;t<this.bb;t++)e=t<n.length?n[t]:0,this.Bf[t]=92^e,this.Te[t]=54^e;this.Rb.update(this.Te)}ub(g_,RZ),g_.prototype.reset=function(){this.Rb.reset(),this.Rb.update(this.Te)},g_.prototype.update=function(n,e){this.Rb.update(n,e)},g_.prototype.digest=function(){var n=this.Rb.digest();return this.Rb.reset(),this.Rb.update(this.Bf),this.Rb.update(n),this.Rb.digest()},g_.prototype.getHmac=function(n){return this.reset(),this.update(n),this.digest()};var h_=new n(null,4,"HS256 sha256 HS384 sha384 HS512 sha512 RS256 RSA-SHA256".split(" "),null),i_=new n(null,4,"HS256 hmac HS384 hmac HS512 hmac RS256 sign".split(" "),null);function j_(n){return RL(RL(RL(n,"+","-"),"/","_"),"=","")}function k_(n,e){return new g_(function(){switch(n){case"sha256":return new XZ;case"sha384":return new c_;case"sha512":return new e_;default:throw Error([q.a(n)," hashing not supported"].join(""))}}(),e)}function l_(n,e,t,r){switch(r){case"hmac":return j_(MZ(k_(t,FZ(e)).getHmac(n)));default:throw Error("algorithm not supported")}}function m_(n,e,t,r,i){switch(i){case"hmac":return A.b(e,l_(n,t,r,i));default:throw Error("algorithm not supported")}}function n_(e,t){t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;var r,i=x.b(t,rt),o=x.b(t,yu),l=x.b(t,MD),u=x.c(t,WD,(new Date).getTime()),s=x.c(t,iH,0);if(p(function(){if(p(o)){var n=yu.a(e);return Qf(o)?n=Tc(Eh(n=Ek([n]),o)):n=kh.b(n,o),n}return o}()))throw im(["Issuer does not match ",q.a(o)].join(""),new n(null,2,[U,Sw,TD,yu],null));if(p(function(){if(p(l)){var n=MD.a(e);if(Qf(n))n=Tc(Eh(Ek([l]),n));else n=kh.b(l,n);return n}return l}()))throw im(["Audience does not match ",q.a(l)].join(""),new n(null,2,[U,Sw,TD,MD],null));if(p(p(r=bD.a(e))?bD.a(e)<=u-s:r))throw im(["Token is expired ",q.a(bD.a(e))].join(""),new n(null,2,[U,Sw,TD,bD],null));if(p(function(){var n=IB.a(e);return p(n)?IB.a(e)>u+s:n}()))throw im(["Token is not yet valid ",q.a(IB.a(e))].join(""),new n(null,2,[U,Sw,TD,IB],null));if(p(function(){var n=px.a(e);return p(n)?"number"==typeof i&&u-px.a(e)>i:n}()))throw im(["Token is older than max-age ",q.a(i)].join(""),new n(null,2,[U,Sw,TD,rt],null));return e}var o_=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};tb("gateway.common.jwt.unsign",o_),o_.b=function(n,e){return o_.c(n,e,S)},o_.c=function(n,e,t){t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;var r=x.c(t,At,!1),i=UL(n,".",0);n=x.b(i,0);var o=x.b(i,1);if(i=x.b(i,2),p(Eh(Qc,new Q(null,3,5,R,[n,o,i],null))))throw Error("invalid token");var l=DX(PZ(n)).alg,u=kg((function(n,e,t){return K.c(n,Kg.a(e),t)}),S,Ll(DX(PZ(o)))),s=x.b(h_,l);if(l=x.b(i_,l),p(r))return u;if(Tc(p(s)?l:s))throw Error("algorithm not supported");if(Tc(m_([q.a(n),".",q.a(o)].join(""),i,e,s,l)))throw Error("signature verification failed");return n_(u,t)},o_.F=3;var p_=function n(e){for(var t=[],r=arguments.length,i=0;i<r;)t.push(arguments[i]),i+=1;return n.g(arguments[0],arguments[1],2<t.length?new Qe(t.slice(2),0,null):null)};tb("gateway.common.jwt.sign",p_),p_.g=function(e,t,r){var i=J(r,0,null);r=J(r,1,null);var o=p(i)?i:"HS256",l=p(r)?r:S;if(i=x.b(h_,o),r=x.b(i_,o),!M(e))throw Error("payload should be in JSON format");if(!M(l))throw Error("extra-headers should be a map");if(!p(p(i)?r:i))throw Error("algorithm not supported");return t=l_([o=j_(OZ(EX(Hl(gh(Cf,l,new n(null,2,[nC,o,Cr,"JWT"],null)))))),".",e=j_(OZ(EX(Hl(e))))].join(""),t,i,r),[o,".",e,".",q.a(t)].join("")},p_.F=2,p_.G=function(n){var e=C(n),t=D(n);return n=C(t),t=D(t),this.g(e,n,t)};var q_=6e5;function r_(e,t,r){var i=TK()+q_;return t=new n(null,3,[U,hI,hD,t,hI,r],null),i=p(i)?K.c(t,bD,i):t,p_(i,pn.a(e))}function s_(e,t){var r=TK();return e=pi(pi(o_.c(t,e,p(r)?new n(null,1,[WD,r],null):null),U,Kg),hD,CZ),A.b(U.a(e),hI)?pi(e,hI,(function(n){return pi(hO(n),U,Kg)})):e}function t_(n,e){if(null!=n&&null!=n.Re)n=n.Re(n,e);else{var t=t_[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=t_._))throw Zc("AuthImpl.auth",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function u_(e,t){switch(e=s_(e,t),(t=U.a(e))instanceof z?t.da:null){case"gw-request":return p(t=hI.a(e))?jZ.resolve(new n(null,3,[U,qz,hI,t,hD,hD.a(e)],null)):jZ.reject(new n(null,2,[U,lC,sr,"Token is missing the gateway request information"],null));case"authentication":return p(t=dt.a(e))?jZ.resolve(new n(null,2,[U,qz,dt,t],null)):jZ.reject(new n(null,2,[U,lC,sr,"Token is missing the impersonation information"],null));default:return jZ.reject(new n(null,2,[U,lC,sr,["Invalid gateway token type: ",q.a(U.a(e))].join("")],null))}}function v_(e,t,r){var i=uZ(YB.a(r));return p(i)?u_(pn.a(r),i):p(e)?pZ(lZ((function(n,t){return QK(e,new Q(null,3,5,R,[n,t,r],null))})),t):jZ.reject(im("No authenticator configured",new n(null,2,[U,lC,sr,"No authenticator configured"],null)))}function w_(n,e){this.we=n,this.timeout=e}function I_(n,e){var t=OK(new YJ(WJ(2e4),2e4));AY(sD,ja,85,new xl((function(){return new Q(null,2,5,R,["starting authenticator",e],null)})),1826837962);var r=OK(1);return uK((function(){var n,i=function(){function n(n){var r=n[1];if(1===r)return n[2]=null,n[1]=2,yz;if(2===r)return KK(n,t);if(3===r)return LK(n,n[2]);if(4===r)return r=n[7],r=n[2],n[7]=r,n[1]=p(r)?5:6,yz;if(5===r){var i=J(r=n[7],0,null),o=J(r,1,null),l=pi(r=J(r,2,null),YB,hO),u=YB.a(l);return r=AY(AG,ja,92,new xl((function(){return new Q(null,2,5,R,["processing authentication",p(Ro.a(u))?K.c(u,Ro,"XXX"):K.c(u,$p,"XXX")],null)})),781137680),l=nZ(l=mZ(l=t_(e,l),(function(n){return i.a?i.a(n):i.call(null,n)})),(function(n){return o.a?o.a(n):o.call(null,n)})),n[8]=l,n[9]=r,n[2]=null,n[1]=2,yz}return 6===r?(n[2]=null,n[1]=7,yz):7===r?(n[2]=n[2],n[1]=3,yz):null}return function(){function e(e){for(;;){n:try{for(;;){var t=n(e);if(!P(t,yz)){var r=t;break n}}}catch(n){if(r=n,e[2]=r,!B(e[4]))throw r;e[1]=C(e[4]),r=yz}if(!P(r,yz))return r}}function t(){var n=[null,null,null,null,null,null,null,null,null,null];return n[0]=r,n[1]=1,n}var r=null;return(r=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)}).o=t,r.a=e,r}()}();return JK(((n=i())[6]=r,n))})),new w_(t,yE.b(n,5e3))}function J_(n){this.ve=n}function K_(n,e,t){this.ca=n,this.n=e,this.se=0,this.ne=t,this.h=2,this.I=0}function L_(n,e){return new K_(WJ(n),n,e)}w_.prototype.xf=function(){return p(this.we)?YK(this.we):null},w_.prototype.wf=function(n,e){return v_(this.we,this.timeout,e)},J_.prototype.Re=function(e,t){var r,i=this;return nZ(mZ((r=Hl(t),i.ve.a?i.ve.a(r):i.ve.call(null,r)),(function(n){var e=pi(hO(Ll(n)),U,Kg);return AY(AG,ma,15,new xl((function(){return new Q(null,2,5,R,["auth response",e],null)})),460971887),e})),(function(e){throw AY(AG,ma,18,new xl((function(){return new Q(null,2,5,R,["auth failure",e],null)})),1008486204),im(e,new n(null,2,[U,lC,sr,e],null))}))},K_.prototype.Dd=function(){return!1},K_.prototype.ae=function(n,e){return this.ca.length!==this.n?this.ca.unshift(e):(this.se+=1,p(this.ne)&&(this.ne.b?this.ne.b(e,this.se):this.ne.call(null,e,this.se))),this},K_.prototype.X=function(){return this.ca.length};var M_=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Oa,"process-response"),(function(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var e=x.b(n,Fy);return x.b(n,Xv),U.a(e)}),i,n,e,t,r)}();function N_(n){this.ch=n}function O_(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,lz),l=x.b(i,Xv),u=x.b(i,Hv);x.b(i,Fy),mi.b(e,new Q(null,2,5,R,[Mx,$y],null));try{return A.b(l,new n(null,1,[Ev,1],null))?AY(sD,Oa,65,new xl((function(){return new Q(null,1,5,R,[function(){var n=new zc,t=Fc,r=Ec;Fc=!0,Ec=function(e){return n.append(e)};try{iV.a(e)}finally{Ec=r,Fc=t}return q.a(n)}()],null)})),843983722):A.b(u,Zv)?null:IY(t,e,r,o,l)}catch(n){if(n instanceof Error){var s=n;return AY(IA,Oa,70,new xl((function(){return new Q(null,3,5,R,[s,"Error handling message",r],null)})),-2130846531),new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(null,o,is.a(l),ow.a(l),jL(s,"global.errors.failure"))],null)],null)}throw n}}function P_(n,e){var t=ow.a(e);return p(t)?p(n=JT.b(n,t))?pD.a(n):null:p(n=pD.a(e))?K.c(n,dt,dt.a(e)):null}function Q_(e,r,i){var o=new Uh(null);try{if(AY(mu,Oa,89,new xl((function(){return new Q(null,2,5,R,["domain handler processing message",i],null)})),1671393030),p(!1)){var l=Xv.a(i),u=U.a(l);switch(Vh(o,P_(e,l)),u instanceof z?u.da:null){case"gateway.common.commands/source-removed":break;case"hello":p(!1)&&AY(sD,Oa,null,new xl((function(){return new Q(null,2,5,R,[OA,new n(null,2,[pD,t(o),OA,UK(l,new Q(null,2,5,R,[YB,"secret"],null))],null)],null)})),1370516204);break;default:p(!1)&&AY(sD,Oa,null,new xl((function(){return new Q(null,2,5,R,[OA,new n(null,2,[pD,t(o),OA,l],null)],null)})),-468633239)}}var s=O_(e,r,i),a=J(s,0,null),c=J(s,1,null),d=p(a)?a:e,h=B(c);r=null;for(var f=u=0;;)if(f<u){var g=r.W(null,f);M_.a(g),p(!1)&&p(!1)&&AY(sD,Oa,null,new xl(function(e,r,i,o,l,u,s,a,c,d){return function(){return new Q(null,2,5,R,[OA,new n(null,2,[pD,t(d),OA,Xv.a(l)],null)],null)}}(0,0,0,0,g,0,0,0,0,o)),337746494),f+=1}else{var w=B(h);if(!w)break;var v=w;if(Wf(v)){var m=re(v),y=se(v);v=m;var b=F(m);h=y,r=v,u=b}else{var $=C(v);M_.a($),p(!1)&&p(!1)&&AY(sD,Oa,null,new xl(function(e,r,i,o,l,u,s,a,c,d,h,f){return function(){return new Q(null,2,5,R,[OA,new n(null,2,[pD,t(f),OA,Xv.a(l)],null)],null)}}(0,0,0,0,$,0,0,0,0,0,0,o)),422427538),h=D(v),r=null,u=0}f=0}return d}catch(n){if(n instanceof Error){var _=n;return AY(IA,Oa,107,new xl((function(){return new Q(null,3,5,R,[_,"error handling message",i],null)})),-220733563),e}throw n}}function R_(e){return ji.b(S,Wh.b((function(e){var t=ET(e);return new Q(null,2,5,R,[$v.a(t),new n(null,2,[tq,e,sD,t],null)],null)}),e))}function S_(n){var e=S,t=Ds.b(e,2e4);AY(sD,Oa,120,new xl((function(){return new Q(null,2,5,R,["node buffer size:",t],null)})),-208696662);var r=OK(L_(t,(function(n,e){return AY(VH,Oa,125,new xl((function(){return new Q(null,4,5,R,["the message",n,"is dropped. total dropped so far",e],null)})),-1405000850)}))),i=R_(n);AY(AG,Oa,128,new xl((function(){return new Q(null,1,5,R,[q.a(i)],null)})),-477682962),Bt.a(e);var o=cL(),l=OK(1);return uK((function(){var n,e=function(){function n(n){var e=n[1];if(1===e){e=function(n,e){return FT(e,n)};var t=K.c(nL(o),pz,i);t=K.c(t,er,r);var l=nj(i);return l=Wh.b(tq,l),e=gd.c(e,t,l),n[7]=e,n[2]=null,n[1]=2,yz}return 2===e?KK(n,r):3===e?LK(n,n[2]):4===e?(t=n[8],e=n[2],n[8]=e,n[1]=p(null==e)?5:6,yz):5===e?(t=n[8],e=n[7],t=function(n,e){return GT(e,n)},l=nj(i),l=Wh.b(tq,l),e=gd.c(t,e,l),n[2]=e,n[1]=7,yz):6===e?(t=n[8],e=Q_(e=n[7],i,t),n[7]=e,n[2]=null,n[1]=2,yz):7===e?(n[2]=n[2],n[1]=3,yz):null}return function(){function e(e){for(;;){n:try{for(;;){var t=n(e);if(!P(t,yz)){var r=t;break n}}}catch(n){if(r=n,e[2]=r,!B(e[4]))throw r;e[1]=C(e[4]),r=yz}if(!P(r,yz))return r}}function t(){var n=[null,null,null,null,null,null,null,null,null];return n[0]=r,n[1]=1,n}var r=null;return(r=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)}).o=t,r.a=e,r}()}();return JK(((n=e())[6]=l,n))})),new N_(r)}M_.v(null,Zv,(function(){return null})),M_.v(null,Yp,(function(){return null})),M_.v(null,WI,(function(){return null})),M_.v(null,Fs,(function(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var e=x.b(n,Fy),t=x.b(n,Xv);return AY(AG,Oa,38,new xl((function(){return new Q(null,3,5,R,["Sending message",t,"to local peer"],null)})),-1251927606),QK(lD.a(e),t)})),M_.v(null,em,(function(n){return AY(IA,Oa,42,new xl((function(){return new Q(null,2,5,R,["Unable to process response",n],null)})),-521125095)})),N_.prototype.yf=function(){return PJ(this.ch)},N_.prototype.zf=function(n,e){return QK(this.ch,e)},N_.prototype.Fg=function(){return null},N_.prototype.Af=function(e,t){return QK(this.ch,new n(null,3,[Hv,Fs,lz,t,Xv,new n(null,1,[U,Nz],null)],null))};var T_=iL("agm.peer-removed","Peer has been removed"),U_=iL("agm.method-removed","Method has been removed"),V_=iL("agm.errors.subscription.invalid_subscription","Trying to drop a subscription that wasnt established. Did you mean to return an error instead?");function W_(e,t,r,i,o){return uL(e,new n(null,6,[tq,"agm",U,jD,ow,t,ov,o,Tu,r,Zw,i],null))}function X_(e,t,r,i){return uL(e,new n(null,5,[tq,"agm",U,TA,ow,t,Tu,r,Zw,i],null))}function Y_(e,t,r,i){return uL(e,new n(null,5,[tq,"agm",U,Ru,is,t,ow,r,Ru,i],null))}function Z_(e,t,r,i,o,l){return uL(e,t=new n(null,8,[tq,"agm",U,ut,fA,t,ow,r,MI,i,zz,o,uE,$v.a(l),kJ,sr.a(l)],null))}function $_(e,t,r){return new n(null,6,[tq,"agm",U,Uw,fA,e,ow,t,uE,$v.a(r),kJ,sr.a(r)],null)}function a0(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,Tu);var i=x.b(r,MI),o=x.b(r,kq);r=x.b(r,Xr),kh.b(qJ.a(n),qJ.a(e))&&Tc(VT.c(ip,n,e))&&kL("agm.errors.invocation.failure","Unable to invoke methods across different users"),p(mi.b(n,new Q(null,4,5,R,[ip,Zw,t,i],null)))||kL("agm.errors.invocation.failure",["Unable to find method with id ",q.a(i)," on server id ",q.a(t)," registered with this peer"].join("")),B(o)&&B(r)&&kL("agm.errors.invocation.failure","Cant use positional and by-name arguments at the same time")}function b0(n,e){return"string"==typeof n?A.b(n,e):null!=e&&Wk(n,e)}function c0(n,e){return gd.c((function(n,t){return!!p(b0(t,e))&&bf(!0)}),!1,n)}function d0(n,e){return gd.c((function(n,t){return p(b0(t,e))?bf(!0):n}),!1,Lz.a(n))}function e0(n,e){return!p(n=ty.a(n))||gd.c((function(n,t){return p(b0(t,e))?bf(!0):n}),!1,n)}function f0(n,e){return M(e)?kg((function(e,t,r){return p(d0(n,t))?K.c(e,t,"<REMOVED>"):p(e0(n,t))?K.c(e,t,r):K.c(e,t,"<REMOVED>")}),S,e):e}function g0(e,t){var r=gd.c((function(n,e){var r=b0(yw.a(e),t);return r=p(r)?Cp.b(e,!0):r,p(r)?bf(e):n}),null,Zw.a(e));if(null!=r)return r;switch((e=lH.a(e))instanceof z?e.da:null){case"whitelist":return new n(null,1,[kq,new n(null,1,[Lz,I],null)],null);case"blacklist":return null;default:return new n(null,1,[kq,new n(null,1,[Lz,I],null)],null)}}var h0=new n(null,1,[TF,null],null);function i0(){return null!=TF.a(h0)&&mi.b(h0,new Q(null,2,5,R,[mo,QG],null))}function j0(n,e){return f0(kq.a(n),e)}function k0(n,e,t){p(n=TF.a(n))&&(n.c?n.c("interop",e,t):n.call(null,"interop",e,t))}function l0(n){if(null!=TF.a(h0)){var e=t(n);e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(e,Ts);var r=yw.a(e);e=mi.b(h0,new Q(null,2,5,R,[mo,ND],null));var i=WA.a(e);if(p(i)){if(p(i.a?i.a(r):i.call(null,r))){var o=fp.a(e);k0(h0,"invoke",K.c(pi(t(n),rI,(function(n){return p(o)?o.b?o.b(r,n):o.call(null,r,n):n})),Ts,r))}}else{var l=g0(nr.a(e),r);p(l)&&k0(h0,"invoke",K.c(pi(t(n),rI,(function(n){return j0(l,n)})),Ts,r))}}}function m0(n){if(null!=TF.a(h0)){var e=t(n);e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(e,Ts),e=yw.a(e);var r=mi.b(h0,new Q(null,2,5,R,[mo,ND],null)),i=WA.a(r);p(i)?p(i.a?i.a(e):i.call(null,e))&&k0(h0,"yield",K.c(t(n),Ts,e)):p(g0(nr.a(r),e))&&k0(h0,"yield",K.c(t(n),Ts,e))}}function n0(n){if(null!=TF.a(h0)){var e=t(n);e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(e,Ts);var r=yw.a(e);e=mi.b(h0,new Q(null,2,5,R,[mo,ND],null));var i=WA.a(e);if(p(i)){if(p(i.a?i.a(r):i.call(null,r))){var o=fp.a(e);k0(h0,"subscribe",K.c(pi(t(n),rI,(function(n){return p(o)?o.b?o.b(r,n):o.call(null,r,n):n})),Ts,r))}}else{var l=g0(nr.a(e),r);p(l)&&k0(h0,"subscribe",K.c(pi(t(n),rI,(function(n){return j0(l,n)})),Ts,r))}}}function o0(n){if(null!=TF.a(h0)){var e=t(n);e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(e,Ts),e=yw.a(e);var r=mi.b(h0,new Q(null,2,5,R,[mo,ND],null)),i=WA.a(r);p(i)?p(i.a?i.a(e):i.call(null,e))&&k0(h0,"unsubscribe",K.c(t(n),Ts,e)):p(g0(nr.a(r),e))&&k0(h0,"unsubscribe",K.c(t(n),Ts,e))}}function p0(n){if(null!=TF.a(h0)){var e=t(n);e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(e,Ts);var r=yw.a(e);e=mi.b(h0,new Q(null,2,5,R,[mo,ND],null));var i=WA.a(e);if(p(i)){if(p(i.a?i.a(r):i.call(null,r))){var o=fp.a(e);k0(h0,"event",K.c(pi(t(n),yn,(function(n){return p(o)?o.b?o.b(r,n):o.call(null,r,n):n})),Ts,r))}}else{var l=g0(nr.a(e),r);p(l)&&k0(h0,"event",K.c(pi(t(n),yn,(function(n){return j0(l,n)})),Ts,r))}}}function q0(e,t){return new n(null,3,[U,WI,Fp,t,Yp,e],null)}function r0(n,e,t,r){return oi.A(n,new Q(null,4,5,R,[ip,AD,e,t],null),Mh(Cf,Dk),r)}function s0(n,e,t,r){return null==e?n:XK(n,new Q(null,4,5,R,[ip,AD,e,t],null),r)}function t0(n,e,t,r,i){var o=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(o,vo);var l=x.b(o,sJ);return o=x.b(o,MI),n=TT(n,t,l=s0(UK(JT.b(n,t),new Q(null,3,5,R,[ip,$n,e],null)),l,r,e)),MT(l)?new Q(null,2,5,R,[n,Z_(lz.a(l),e,t,o,r,i)],null):new Q(null,2,5,R,[n,null],null)}function u0(n,e,t){var r=mi.b(e,new Q(null,2,5,R,[ip,qy],null)),i=qJ.a(e);return e=gd.c((function(n,e){var r=J(e,0,null),o=J(e,1,null);return e=J(n,0,null),n=J(n,1,null),r=J(o=t0(e,r,o,i,t),0,null),o=J(o,1,null),new Q(null,2,5,R,[p(r)?r:e,$f(o)||Vf(o)?gd.c(Mh(Cf,I),n,o):null!=o?Mh(Cf,I)(n,o):n],null)}),new Q(null,2,5,R,[n,I],null),r),n=J(e,0,null),e=J(e,1,null),new Q(null,2,5,R,[n,e],null)}function v0(e,t,r){if(p(i0())){var i=qJ.a(t);r=B(r);for(var o=null,l=0,u=0;;)if(u<l){var s=o.W(null,u),a=C(s),c=zf(s),d=mi.b(t,new Q(null,4,5,R,[ip,Zw,i,MI.a(c)],null));o0(new xl(function(r,i,o,l,u,s,a){return function(){return new n(null,4,[fA,u,Dz,pD.a(e),vo,pD.a(t),Ts,a],null)}}(0,0,0,0,a,0,d))),u+=1}else{if(!(c=B(r)))break;if(Wf(a=c))r=re(a),u=se(a),o=r,l=F(r),r=u;else{s=C(a),d=C(s);var h=zf(s);o0(new xl(function(r,i,o,l,u,s,a){return function(){return new n(null,4,[fA,u,Dz,pD.a(e),vo,pD.a(t),Ts,a],null)}}(0,0,0,0,d,0,mi.b(t,new Q(null,4,5,R,[ip,Zw,i,MI.a(h)],null))))),r=D(a),o=null,l=0}u=0}}}function w0(n,e,t){return kg((function(n,r,i){return A.b(e,vo.a(i))&&(Pf(t)||N(t,MI.a(i)))?pi(n,Hr,(function(n){return K.c(n,r,i)})):pi(n,fD,(function(n){return K.c(n,r,i)}))}),S,n)}function x0(n,e,t,r,i){var o=qJ.a(t);o=null!=(r=w0(mi.b(e,new Q(null,2,5,R,[ip,qy],null)),o,r))&&(64&r.h||h===r.D)?fh(qk,r):r,r=x.b(o,Hr);var l=x.b(o,fD);return o=kg((function(n,t,r){return C(t0(n,t,r,qJ.a(e),i))}),n,r),B(r)?(v0(e,t,r),new Q(null,2,5,R,[UT(o,qJ.a(e),(function(n){return B(l)?ni(n,new Q(null,2,5,R,[ip,qy],null),l):qi(n,ip,Hf,qy)})),zL(lz.a(e))?ki.b((function(n){return uL(lz.a(e),$_(n=Dd(n),qJ.a(e),i))}),r):null],null)):new Q(null,2,5,R,[n,null],null)}function y0(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,ow),l=x.b(i,Tu),u=x.b(i,fA),s=x.b(i,MI),a=x.b(i,kq),c=x.b(i,Xr),d=x.b(i,fI);i=x.b(i,fv);var f=JT.b(t,l);if(p(f)){var g=ni(f,new Q(null,3,5,R,[ip,$n,u],null),new n(null,2,[Dz,o,MI,s],null));f=lz.a(g);var w=mi.b(e,new Q(null,4,5,R,[ip,Zw,l,s],null));return n0(new xl((function(){return new n(null,5,[fA,u,Dz,pD.a(e),vo,pD.a(g),Ts,w,rI,c],null)}))),new Q(null,2,5,R,[TT(t,l,g),zL(f)?new Q(null,1,5,R,[uL(f,Xj([kq,U,zz,fA,ow,fI,tq,fv,Xr,MI],[a,mH,o,u,l,d,"agm",i,c,s]))],null):new Q(null,1,5,R,[wL(q0(dL(Mx.a(t)),o),new n(null,2,[U,Yp,Yp,Yp.a(f)],null),r)],null)],null)}throw im(["Unable to find server with id ",q.a(l)].join(""),S)}function z0(e,t,r){var i=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,o=x.b(i,is),l=x.b(i,ow),u=x.b(i,Tu);return i=x.b(i,MI),a0(o=ni(LT(e,l,ip),new Q(null,3,5,R,[ip,qy,r],null),new n(null,3,[vo,u,MI,i,is,o],null)),u=LT(e,u,ip),t),y0(o,TT(e,l,o),K.c(t,fA,r))}function A0(n,e,t,r,i,o,l){if(p(e)){var u=new Q(null,3,5,R,[ip,qy,r],null),s=mi.b(e,u);s=is.a(s);var a=lz.a(e);return new Q(null,2,5,R,[TT(n,t,UK(e,u)),zL(a)?p(l)?new Q(null,1,5,R,[xL.la("agm",a,s,t,i,o)],null):new Q(null,1,5,R,[uL(a,$_(r,t,i))],null):null],null)}return new Q(null,2,5,R,[n,null],null)}function B0(e,t,r,i,o){var l=JT.b(e,t),u=mi.b(l,new Q(null,4,5,R,[ip,qy,r,is],null));return e=TT(e,t,ni(l,new Q(null,4,5,R,[ip,qy,r,sJ],null),i)),i=lz.a(l),MT(l)?new Q(null,2,5,R,[e,new Q(null,1,5,R,[uL(i,new n(null,5,[tq,"agm",U,Gz,is,u,ow,t,fA,r],null))],null)],null):new Q(null,2,5,R,[e,new Q(null,1,5,R,[wL(q0(dL(Mx.a(e)),ow.a(o)),new n(null,2,[U,Yp,Yp,Yp.a(i)],null),o)],null)],null)}function C0(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,fA),o=x.b(r,ow);null==(r=x.b(r,Is))&&kL("agm.errors.subscription.invalid_subscription","Invalid or missing stream id");var l=mi.b(e,new Q(null,3,5,R,[ip,$n,i],null));return p(l)?(l=Dz.a(l),B0(TT(n,o,r0(ni(e,new Q(null,4,5,R,[ip,$n,i,sJ],null),r),r,l,i)),l,i,r,t)):AY(AG,Fa,247,new xl((function(){return new Q(null,3,5,R,["Subscription accept response",t,"for missing interest"],null)})),1825397101)}function D0(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,r=x.b(t,fA),i=x.b(t,ow);return t=x.b(t,GH),p(i=JT.c(n,i,ip))?C0(n,i,e):(AY(VH,Fa,257,new xl((function(){return new Q(null,3,5,R,["Subscription accept response",e,"from missing peer"],null)})),-944687329),A0(n,JT.b(n,t),t,r,iL("agm.errors.subscription.failure","Received a response from a missing server"),null,!0))}Z(Oz,RG,RG),Z(Cq,JA,JA),Z(YH,O(CJ,O(hq,BI)),rT(O(hq,BI),eT(qC,Wc,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,BI)],null),null),null)),Z(UB,O(CJ,Hq),rT(Hq,M,null)),Z(xz,O(CJ,Hq),rT(Hq,M,null)),Z(hr,O(CJ,Hq),rT(Hq,M,null)),Z(KC,O(xv,Wp,O(wt,ir,new Q(null,2,5,R,[Cq,Oz],null),iA,new Q(null,4,5,R,[YH,UB,xz,hr],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,2,5,R,[Cq,Oz],null),iA,new Q(null,4,5,R,[YH,UB,xz,hr],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Cq,Oz],null),new Q(null,4,5,R,[YH,UB,xz,hr],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Tu)},function(n){return N(n,MI)}],null),function(n){return M(n)&&N(n,Tu)&&N(n,MI)},new Q(null,4,5,R,[kq,Xr,fv,fI],null),new Q(null,2,5,R,[Cq,Oz],null),null,new Q(null,2,5,R,[Tu,MI],null),new Q(null,4,5,R,[YH,UB,xz,hr],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Tu)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI))],null),null]))],null),null)),Z(JG,Bo,Vc),Z(Bq,O(xv,Wp,O(wt,ir,new Q(null,3,5,R,[JG,QD,dC],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,3,5,R,[JG,QD,dC],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[JG,QD,dC],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,fA)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[JG,QD,dC],null),null,new Q(null,3,5,R,[fA,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)),Z(AF,JA,JA),Z(St,O(wt,ir,new Q(null,4,5,R,[JG,JA,Oz,AF],null),iA,new Q(null,4,5,R,[YH,UB,xz,hr],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,4,5,R,[JG,JA,Oz,AF],null),new Q(null,4,5,R,[YH,UB,xz,hr],null),null,new Q(null,5,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,ow)},function(n){return N(n,MI)},function(n){return N(n,zz)}],null),function(n){return M(n)&&N(n,fA)&&N(n,ow)&&N(n,MI)&&N(n,zz)},new Q(null,4,5,R,[kq,Xr,fv,fI],null),new Q(null,4,5,R,[JG,JA,Oz,AF],null),null,new Q(null,4,5,R,[fA,ow,MI,zz],null),new Q(null,4,5,R,[YH,UB,xz,hr],null),new Q(null,5,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,zz))],null),null]))),Z(Wo,O(wt,ir,new Q(null,6,5,R,[JG,JA,Oz,AF,QD,dC],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,6,5,R,[JG,JA,Oz,AF,QD,dC],null),null,null,new Q(null,7,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,ow)},function(n){return N(n,MI)},function(n){return N(n,zz)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,fA)&&N(n,ow)&&N(n,MI)&&N(n,zz)&&N(n,uE)&&N(n,kJ)},I,new Q(null,6,5,R,[JG,JA,Oz,AF,QD,dC],null),null,new Q(null,6,5,R,[fA,ow,MI,zz,uE,kJ],null),I,new Q(null,7,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,zz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))),Z(hn,Bo,Vc),Z(Yu,O(wt,ir,new Q(null,3,5,R,[JG,JA,hn],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[JG,JA,hn],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,ow)},function(n){return N(n,Is)}],null),function(n){return M(n)&&N(n,fA)&&N(n,ow)&&N(n,Is)},I,new Q(null,3,5,R,[JG,JA,hn],null),null,new Q(null,3,5,R,[fA,ow,Is],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Is))],null),null]))),Z(wJ,O(wt,ir,new Q(null,4,5,R,[JA,JG,QD,dC],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,4,5,R,[JA,JG,QD,dC],null),null,null,new Q(null,5,5,R,[function(n){return M(n)},function(n){return N(n,ow)},function(n){return N(n,fA)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,ow)&&N(n,fA)&&N(n,uE)&&N(n,kJ)},I,new Q(null,4,5,R,[JA,JG,QD,dC],null),null,new Q(null,4,5,R,[ow,fA,uE,kJ],null),I,new Q(null,5,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))),Z(pG,gq,Sc),Z(Vm,jH,Zf),Z(IF,Hq,M),Z(HD,O(wt,ir,new Q(null,4,5,R,[JA,pG,Vm,IF],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,4,5,R,[JA,pG,Vm,IF],null),null,null,new Q(null,5,5,R,[function(n){return M(n)},function(n){return N(n,ow)},function(n){return N(n,cE)},function(n){return N(n,Jq)},function(n){return N(n,yn)}],null),function(n){return M(n)&&N(n,ow)&&N(n,cE)&&N(n,Jq)&&N(n,yn)},I,new Q(null,4,5,R,[JA,pG,Vm,IF],null),null,new Q(null,4,5,R,[ow,cE,Jq,yn],null),I,new Q(null,5,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,cE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Jq)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn))],null),null]))),Z(Bs,O(xv,HD,O(wt,ir,new Q(null,1,5,R,[JG],null))),cT(new Q(null,2,5,R,[HD,O(wt,ir,new Q(null,1,5,R,[JG],null))],null),new Q(null,2,5,R,[HD,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[JG],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,fA)}],null),function(n){return M(n)&&N(n,fA)},I,new Q(null,1,5,R,[JG],null),null,new Q(null,1,5,R,[fA],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA))],null),null]))],null),null)),Z(ar,O(xv,HD,O(wt,ir,new Q(null,1,5,R,[hn],null))),cT(new Q(null,2,5,R,[HD,O(wt,ir,new Q(null,1,5,R,[hn],null))],null),new Q(null,2,5,R,[HD,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[hn],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Is)}],null),function(n){return M(n)&&N(n,Is)},I,new Q(null,1,5,R,[hn],null),null,new Q(null,1,5,R,[Is],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Is))],null),null]))],null),null)),Z(jq,O(xv,Wp,O(wt,ir,new Q(null,2,5,R,[Cq,Oz],null),iA,new Q(null,3,5,R,[YH,UB,hr],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,2,5,R,[Cq,Oz],null),iA,new Q(null,3,5,R,[YH,UB,hr],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Cq,Oz],null),new Q(null,3,5,R,[YH,UB,hr],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Tu)},function(n){return N(n,MI)}],null),function(n){return M(n)&&N(n,Tu)&&N(n,MI)},new Q(null,3,5,R,[kq,Xr,fI],null),new Q(null,2,5,R,[Cq,Oz],null),null,new Q(null,2,5,R,[Tu,MI],null),new Q(null,3,5,R,[YH,UB,hr],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Tu)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI))],null),null]))],null),null)),Z(Dy,Bo,Vc),Z(vw,O(wt,ir,new Q(null,4,5,R,[Dy,AF,JA,Oz],null),iA,new Q(null,3,5,R,[YH,UB,hr],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,4,5,R,[Dy,AF,JA,Oz],null),new Q(null,3,5,R,[YH,UB,hr],null),null,new Q(null,5,5,R,[function(n){return M(n)},function(n){return N(n,qu)},function(n){return N(n,zz)},function(n){return N(n,ow)},function(n){return N(n,MI)}],null),function(n){return M(n)&&N(n,qu)&&N(n,zz)&&N(n,ow)&&N(n,MI)},new Q(null,3,5,R,[kq,Xr,fI],null),new Q(null,4,5,R,[Dy,AF,JA,Oz],null),null,new Q(null,4,5,R,[qu,zz,ow,MI],null),new Q(null,3,5,R,[YH,UB,hr],null),new Q(null,5,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qu)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,zz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,MI))],null),null]))),Z(ev,Hq,M),Z(uz,O(wt,ir,new Q(null,3,5,R,[Dy,JA,ev],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Dy,JA,ev],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,qu)},function(n){return N(n,ow)},function(n){return N(n,Ru)}],null),function(n){return M(n)&&N(n,qu)&&N(n,ow)&&N(n,Ru)},I,new Q(null,3,5,R,[Dy,JA,ev],null),null,new Q(null,3,5,R,[qu,ow,Ru],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,qu)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ow)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Ru))],null),null])));var E0,u5=Oh(S),v5=Oh(S),w5=Oh(S),x5=Oh(S),y5=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));function K0(e,t,r,i){var o=ow.a(r),l=x.b(r,p(i)?is:fA),u=LT(e,o,ip),s=mi.b(u,new Q(null,3,5,R,[ip,$n,l],null));if(p(s)){var a=Dz.a(s),c=x.b(s,sJ);s=JT.b(e,a);var d=lz.a(s);return p(p(c)?c:i)?(t=J(u=new Q(null,2,5,R,[TT(e,o,s0(UK(u,new Q(null,3,5,R,[ip,$n,l],null)),c,a,l)),I],null),0,null),u=J(u,1,null),i=J(l=A0(t,s,a,l,lL(r),fI.a(r),i),0,null),l=J(l,1,null),i=J(l=new Q(null,2,5,R,[p(i)?i:t,$f(l)||Vf(l)?gd.c(Mh(Cf,I),u,l):null!=l?Mh(Cf,I)(u,l):u],null),0,null),l=J(l,1,null),e=J(r=p(p(s)?!zL(d):s)?new Q(null,2,5,R,[null,wL(q0(dL(Mx.a(e)),o),new n(null,2,[U,Yp,Yp,Yp.a(d)],null),r)],null):null,0,null),r=J(r,1,null),new Q(null,2,5,R,[p(e)?e:i,$f(r)||Vf(r)?gd.c(Mh(Cf,I),l,r):null!=r?Mh(Cf,I)(l,r):l],null)):new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.la("agm",t,l,o,V_,null)],null)],null)}return new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.la("agm",t,l,o,iL("agm.errors.subscription.invalid_subscription","Trying to drop a non-existing subscription"),null)],null)],null)}function L0(e,t,r,i,o){var l=JT.b(e,r);if(p(l)){var u=mi.b(l,new Q(null,3,5,R,[ip,$n,i],null));if(p(u)){o0(new xl((function(){return new n(null,4,[fA,i,Dz,pD.a(t),vo,pD.a(l),Ts,mi.b(l,new Q(null,4,5,R,[ip,Zw,r,MI.a(u)],null))],null)})));var s=qJ.a(t),a=lz.a(l);return e=TT(e,r,s0(UK(l,new Q(null,3,5,R,[ip,$n,i],null)),sJ.a(u),s,i)),new Q(null,2,5,R,[e,new Q(null,1,5,R,[zL(a)?Z_(a,i,r,MI.a(u),s,lL(o)):wL(q0(dL(Mx.a(e)),s),new n(null,2,[U,Yp,Yp,Yp.a(a)],null),o)],null)],null)}}return null}function M0(n,e,t,r){var i=LT(n,t,ip),o=new Q(null,3,5,R,[ip,qy,r],null),l=mi.b(i,o);return l=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l,p(l=x.b(l,vo))?p(e=L0(n=TT(n,t,UK(i,o)),i,l,r,e))?e:new Q(null,2,5,R,[n,I],null):kL("agm.errors.subscription.invalid_subscription",["Unable to find subscription with id ",q.a(r)," on subscriber id ",q.a(t)].join(""))}function N0(e,t,r,i,o,l,u){if(p(i0())){var s=qJ.a(r),a=mi.b(r,new Q(null,2,5,R,[ip,$n],null)),c=mi.b(r,new Q(null,3,5,R,[ip,Zw,s],null));e=B(e);for(var d=null,h=0,f=0;;)if(f<h){var g=d.W(null,f),w=x.b(a,g),v=x.b(c,MI.a(w));p0(new xl(function(e,s,a,c,d,h,f){return function(){return new n(null,8,[fA,f,Dz,pD.a(t),vo,pD.a(r),Ts,h,UI,i,$H,o,Jq,l,yn,u],null)}}(0,0,0,0,0,v,g))),f+=1}else{if(!(v=B(e)))break;if(Wf(w=v))e=re(w),f=se(w),d=e,h=F(e),e=f;else{g=C(w);var m=x.b(a,g);p0(new xl(function(e,s,a,c,d,h,f){return function(){return new n(null,8,[fA,f,Dz,pD.a(t),vo,pD.a(r),Ts,h,UI,i,$H,o,Jq,l,yn,u],null)}}(0,0,0,0,0,x.b(c,MI.a(m)),g))),e=D(w),d=null,h=0}f=0}}}function O0(e,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,ow),l=x.b(i,Is),u=x.b(i,cE),s=x.b(i,Jq),a=x.b(i,yn),c=JT.c(e,o,ip);i=mi.b(c,new Q(null,3,5,R,[ip,AD,l],null));var d=new Uh(Dk);return new Q(null,2,5,R,[e,Vk(fi.b(Uc,ei((function(i){var l=J(i,0,null);i=J(i,1,null);var h=JT.b(e,l),f=lz.a(h);return zL(f)?(N0(i,h,c,!1,u,s,a),Wh.b((function(e){return uL(f,new n(null,8,[tq,"agm",U,OA,ow,l,fA,e,UI,!1,cE,u,Jq,s,yn,a],null))}),i)):(i=Yp.a(f),N(t(d),i)?null:(d.Cc(null,Cf.b(d.zb(null),i)),new Q(null,1,5,R,[wL(q0(dL(Mx.a(e)),o),new n(null,2,[U,Yp,Yp,i],null),r)],null)))}),G([i]))))],null)}function P0(n){n=bL(n);var e=lS(os.a(n));return p(e)?K.c(n,Bu,e):n}function Q0(n,e,t){return!p(n=Bu.a(n))||mS(n,e,t)}function R0(n,e,t){var r=JT.b(n,t),i=new Q(null,3,5,R,[ip,Zw,e],null),o=ji.b(Dk,Wh.b(C,mi.b(r,i)));return B(o)?S0(n,e,r,i,o):new Q(null,2,5,R,[UT(n,t,(function(n){return aL(UK(n,i),ip)})),null],null)}function S0(n,e,t,r,i){var o=JT.b(n,e);return i=gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var i=Cf.b(r,e);return p(mi.b(t,i))?new Q(null,2,5,R,[UK(t,i),Cf.b(n,e)],null):new Q(null,2,5,R,[t,n],null)}),new Q(null,2,5,R,[t,Dk],null),i),t=J(i,0,null),i=J(i,1,null),n=TT(n,qJ.a(t),aL(t,ip)),Tc(B(i))?new Q(null,2,5,R,[n,null],null):(o=J(n=x0(n,t,o,i,U_),0,null),n=J(n,1,null),e=J(t=new Q(null,2,5,R,[o,MT(t)?X_(lz.a(t),qJ.a(t),e,Ni(i)):null],null),0,null),t=J(t,1,null),new Q(null,2,5,R,[p(e)?e:o,$f(t)||Vf(t)?gd.c(Mh(Cf,I),n,t):null!=t?Mh(Cf,I)(n,t):n],null))}function T0(n,e){e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;var t=x.b(e,ow),r=x.b(e,Zw),i=new Q(null,3,5,R,[ip,Zw,t],null);e=aL(gd.c((function(n,e){var t=Cf.b(i,e);return p(mi.b(n,t))?UK(n,t):kL("agm.errors.unregistration.failure",["Unable to unregister missing method ",q.a(e)].join(""))}),KT(n,t),r),ip);var o=TT(n,t,e);return e=og(gi.a((function(n){return A.b(t,qJ.a(n))})),mg((function(n,e){var o=J(n,0,null);n=J(n,1,null);var l=S0(o,t,e,i,r);return e=J(l,0,null),l=J(l,1,null),new Q(null,2,5,R,[p(e)?e:o,$f(l)||Vf(l)?gd.c(Mh(Cf,I),n,l):null!=l?Mh(Cf,I)(n,l):n],null)}),lg),new Q(null,2,5,R,[o,I],null),XT(n,ip,e,!1)),n=J(e,0,null),e=J(e,1,null),new Q(null,2,5,R,[n,e],null)}function U0(n,e,t,r){var i=qJ.a(e),o=pD.a(e),l=qJ.a(r),u=pD.a(r),s=mi.b(r,new Q(null,3,5,R,[ip,Zw,i],null));return s=og(fi.a((function(n){return Q0(n,o,u)})),mg((function(n,e){var t=J(n,0,null);return n=J(n,1,null),new Q(null,2,5,R,[K.c(t,qJ.a(e),e),Cf.b(n,Hf.b(e,Bu))],null)}),lg),new Q(null,2,5,R,[s,I],null),t),t=J(s,0,null),B(s=J(s,1,null))?new Q(null,2,5,R,[TT(n,l,ni(r,new Q(null,3,5,R,[ip,Zw,i],null),t)),MT(r)?W_(lz.a(r),l,i,s,U.a(lz.a(e))):null],null):new Q(null,2,5,R,[n,null],null)}function V0(n,e){e=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;var t=x.b(e,ow);e=x.b(e,Zw);var r=Wh.b(P0,e),i=gd.c((function(n,e){return ni(n,new Q(null,4,5,R,[ip,Zw,t,qJ.a(e)],null),e)}),KT(n,t),r);return e=TT(n,t,i),gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var o=U0(t,i,r,e);return e=J(o,0,null),o=J(o,1,null),new Q(null,2,5,R,[p(e)?e:t,$f(o)||Vf(o)?gd.c(Mh(Cf,I),n,o):null!=o?Mh(Cf,I)(n,o):n],null)}),new Q(null,2,5,R,[e,I],null),XT(n,ip,i,!1))}function W0(n,e,t){var r=pD.a(n),i=pD.a(t);return og(fi.a((function(n){return Q0(n,r,i)})),mg((function(e,t){return Cf.b(e,K.c(Hf.b(t,Bu),Tu,qJ.a(n)))}),lg),I,e)}function X0(e,t,r){var i=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,o=x.b(i,is),l=x.b(i,ow),u=x.b(i,Tu),s=x.b(i,qu),a=x.b(i,MI),c=x.b(i,kq),d=x.b(i,Xr);i=x.b(i,fI);var f=ni(r,new Q(null,3,5,R,[ip,Xw,s],null),new n(null,3,[Qr,l,MI,a,is,o],null)),p=!MT(f);return r=R,o=TT(e,u,f),p?l=new Q(null,1,5,R,[wL(q0(dL(Mx.a(e)),l),new n(null,2,[U,Yp,Yp,mi.b(f,new Q(null,2,5,R,[lz,Yp],null))],null),t)],null):l=new Q(null,1,5,e=R,[l=uL(t=lz.a(f),Xj([kq,qu,U,zz,ow,fI,tq,Xr,MI],[c,s,ND,l,u,i,"agm",d,a]))],null),new Q(null,2,5,r,[o,l],null)}function Y0(e,t,r,i,o){var l=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,u=x.b(l,is),s=x.b(l,ow),a=x.b(l,Tu),c=x.b(l,MI),d=ni(o,new Q(null,3,5,R,[ip,jA,u],null),new n(null,3,[Yr,a,MI,c,qu,r],null));return l0(new xl((function(){return new n(null,5,[is,u,Qr,pD.a(d),vo,pD.a(i),Ts,mi.b(i,new Q(null,4,5,R,[ip,Zw,a,c],null)),rI,Xr.a(t)],null)}))),X0(TT(e,s,d),K.c(t,qu,r),A.b(s,a)?d:i)}function Z0(n,e,t,r){var i=qJ.a(r);r=null!=(r=Ol((function(n){return A.b(Yr.a(Ed(n)),i)}),mi.b(t,new Q(null,2,5,R,[ip,jA],null))))&&(64&r.h||h===r.D)?fh(qk,r):r;var o=x.b(r,!0),l=x.b(r,!1);return B(o)?new Q(null,2,5,R,[UT(n,qJ.a(t),(function(n){return B(l)?ni(n,new Q(null,2,5,R,[ip,jA],null),ji.b(S,l)):qi(n,ip,Hf,jA)})),MT(t)?ki.b((function(n){return xL.K("agm",e,Dd(n),qJ.a(t),iL("agm.errors.invocation.failure","Peer has left while waiting for result"))}),o):null],null):new Q(null,2,5,R,[n,null],null)}function $0(e,t,r,i,o){var l,u=is.a(r),s=Qr.a(r),a=MI.a(r),c=null==(l=JT.b(e,s))?null:UK(l,new Q(null,3,5,R,[ip,jA,u],null));if(p(c)){var d=TT(e,s,c),h=JT.b(d,t),f=mi.b(h,new Q(null,4,5,R,[ip,Zw,t,a],null)),g=qz.a(o),w=lC.a(o);return MT(c)?p(g)?(m0(new xl((function(){return new n(null,6,[is,is.a(r),Qr,pD.a(c),vo,pD.a(h),Ts,f,qz,!0,Ru,Ru.a(g)],null)}))),new Q(null,2,5,R,[d,new Q(null,1,5,R,[Y_(lz.a(c),u,s,Ru.a(g))],null)],null)):(m0(new xl((function(){return new n(null,6,[is,is.a(r),Qr,pD.a(c),vo,pD.a(h),Ts,f,qz,!1,Ru,yk(w,new Q(null,2,5,R,[kJ,uE],null))],null)}))),new Q(null,2,5,R,[d,new Q(null,1,5,R,[xL.la("agm",lz.a(c),u,s,lL(w),fI.a(w))],null)],null)):new Q(null,2,5,R,[d,new Q(null,1,5,R,[wL(q0(dL(Mx.a(d)),t),new n(null,2,[U,Yp,Yp,mi.b(c,new Q(null,2,5,R,[lz,Yp],null))],null),i)],null)],null)}return null}function a1(n,e,t,r,i){var o=JT.b(n,t),l=mi.b(o,new Q(null,3,5,R,[ip,Xw,e],null));return p(l)?(n=J(e=new Q(null,2,5,R,[TT(n,t,UK(o,new Q(null,3,5,R,[ip,Xw,e],null))),I],null),0,null),e=J(e,1,null),t=J(r=$0(n,t,l,r,i),0,null),r=J(r,1,null),new Q(null,2,5,R,[p(t)?t:n,$f(r)||Vf(r)?gd.c(Mh(Cf,I),e,r):null!=r?Mh(Cf,I)(e,r):e],null)):null}function b1(e,t,r,i,o,l){return t=new n(null,6,[tq,"global",U,Bv,is,t,ow,r,Tn,i,ko,o],null),uL(e,l=p(l)?K.c(t,eI,l):t)}function c1(e,t,r){var i=LT(e,r,ip);return gd.c((function(e,i){var o=J(e,0,null);J(e,1,null);var l=J(e,0,null);e=J(e,1,null),o=JT.b(o,r);var u=pD.a(i),s=qJ.a(i),a=Dl(G([Wh.a(Qi),mi.b(i,new Q(null,3,5,R,[ip,Zw,s],null))])),c=qJ.a(o),d=MT(o),h=MT(i);return u=d?Cf.b(I,AL.la("agm",t,c,s,u,new n(null,1,[Fs,h],null))):I,s=h?Cf.b(u,AL.la("agm",lz.a(i),s,c,pD.a(o),new n(null,1,[Fs,d],null))):u,i=J(o=U0(l,i,a,o),0,null),o=J(o,1,null),i=J(o=new Q(null,2,5,R,[i,p(o)?Cf.b(s,o):s],null),0,null),o=J(o,1,null),new Q(null,2,5,R,[p(i)?i:l,$f(o)||Vf(o)?gd.c(Mh(Cf,I),e,o):null!=o?Mh(Cf,I)(e,o):e],null)}),new Q(null,2,5,R,[e,I],null),XT(e,ip,i,!1))}function d1(n,e,t,r){return r=lS(r),c1(oL(n,t,ip,r),e,t)}function e1(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);if(x.b(r,pD),r=x.b(r,os),p(qL(n,o,ip)))return new Q(null,2,5,R,[n,new Q(null,1,5,R,[yL.A("agm",e,i,o)],null)],null);var l=d1(n,e,o,r);r=J(l,0,null),l=J(l,1,null);var u,s=JT.b(r,o);return new Q(null,2,5,R,[r,Cf.g(l,yL.A("agm",e,i,o),G([vL(q0(dL(Mx.a(n)),o),(u=K.c(t,U,ds),p(eI.a(s))?K.c(u,eI,eI.a(s)):u))]))],null)}function f1(n,e,t,r){var i=JT.b(n,t),o=lz.a(i),l=function(){var r,l,u,s,a=new Q(null,2,5,R,[n,null],null),c=(r=J(a,0,null),l=J(a,1,null),u=Z0(r,o,i,e),s=J(u,0,null),u=J(u,1,null),new Q(null,2,5,R,[p(s)?s:r,$f(u)||Vf(u)?gd.c(Mh(Cf,I),l,u):null!=u?Mh(Cf,I)(l,u):l],null)),d=function(){var n=J(c,0,null),t=J(c,1,null),r=x0(n,i,e,null,T_),o=J(r,0,null);return r=J(r,1,null),new Q(null,2,5,R,[p(o)?o:n,$f(r)||Vf(r)?gd.c(Mh(Cf,I),t,r):null!=r?Mh(Cf,I)(t,r):t],null)}(),h=J(d,0,null);d=J(d,1,null);var f=R0(h,qJ.a(e),t),g=J(f,0,null);return f=J(f,1,null),new Q(null,2,5,R,[p(g)?g:h,$f(f)||Vf(f)?gd.c(Mh(Cf,I),d,f):null!=f?Mh(Cf,I)(d,f):d],null)}(),u=J(l,0,null);return l=J(l,1,null),new Q(null,2,5,R,[u,zL(o)?Cf.b(l,BL.K("agm",o,t,qJ.a(e),r)):l],null)}function g1(n,e,t){var r=qJ.a(e),i=og(Wh.a(qJ),mg((function(n,r){var i=J(n,0,null);n=J(n,1,null);var o=f1(i,e,r,t);return r=J(o,0,null),o=J(o,1,null),new Q(null,2,5,R,[p(r)?r:i,$f(o)||Vf(o)?gd.c(Mh(Cf,I),n,o):null!=o?Mh(Cf,I)(n,o):n],null)}),lg),u0(n,e,t),XT(n,ip,e,!1));return n=J(i,0,null),i=J(i,1,null),new Q(null,2,5,R,[pL(n,r,ip),i],null)}function h1(n,e){return AY(AG,Aa,195,new xl((function(){return new Q(null,1,5,R,["removing source from agm domain"],null)})),1481016309),e=Ch(QT(n,e,ip)),n=og(Wh.a(qJ),mg((function(n,e){return pL(n,e,ip)}),lg),n,e),n=gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var r=g1(t,e,T_);return e=J(r,0,null),r=J(r,1,null),new Q(null,2,5,R,[p(e)?e:t,$f(r)||Vf(r)?gd.c(Mh(Cf,I),n,r):null!=r?Mh(Cf,I)(n,r):n],null)}),new Q(null,2,5,R,[n,null],null),e),AY(AG,Aa,206,new xl((function(){return new Q(null,1,5,R,["removed source from agm domain"],null)})),-1463453410),n}function i1(e,t,r){r=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;var i=x.b(r,ow);r=x.b(r,is);var o=LT(e,i,ip);return o=Ni(ii(Wh.b((function(n){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n;var t=x.b(n,qJ),r=JT.b(e,i);return W0(n,t=nj(mi.b(n,new Q(null,3,5,R,[ip,Zw,t],null))),r)}),fi.b(MT,XT(e,ip,o,!1))))),new Q(null,2,5,R,[e,new Q(null,1,5,R,[uL(t,new n(null,4,[Zw,o,is,r,U,Zw,ow,i],null))],null)],null)}E0=new dm(Me.b(Fa,"drop-interest-rq"),U,y5,u5,v5,w5,x5),E0.v(null,IA,(function(){return YI})),E0.v(null,OB,(function(){return wJ})),Z(Cx,O(io,nJ,U),VS(nJ,new Ne((function(){return E0}),nJ,Xj([By,yw,OD,ho,ux,en,fz,AE,Dv,jF],[vt,xx,"gateway/domains/agm/subscriptions.cljc",27,1,283,283,Se,null,p(E0)?E0.ld:null])))),Z(at,O(hq,LD),eT(LD,LD,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,LD)],null),null)),Z(vG,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[at],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[at],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[at],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Zw)}],null),function(n){return M(n)&&N(n,Zw)},I,new Q(null,1,5,R,[at],null),null,new Q(null,1,5,R,[Zw],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zw))],null),null]))],null),null)),Z(iE,O(hq,RG),eT(RG,RG,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,RG)],null),null)),Z(Bn,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[iE],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[iE],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[iE],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Zw)}],null),function(n){return M(n)&&N(n,Zw)},I,new Q(null,1,5,R,[iE],null),null,new Q(null,1,5,R,[Zw],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zw))],null),null]))],null),null)),Z(Pz,Bo,Vc),Z(zv,Bo,Vc),Z(sC,jH,Zf),Z(Wn,O(wt,ir,new Q(null,1,5,R,[sC],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[sC],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Fs)}],null),function(n){return M(n)&&N(n,Fs)},I,new Q(null,1,5,R,[sC],null),null,new Q(null,1,5,R,[Fs],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Fs))],null),null]))),yT.v(null,SE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[nv,Wx,Wn],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[nv,Wx,Wn],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,dB)},function(n){return N(n,pD)},function(n){return N(n,Mc)}],null),function(n){return M(n)&&N(n,dB)&&N(n,pD)&&N(n,Mc)},I,new Q(null,3,5,R,[nv,Wx,Wn],null),null,new Q(null,3,5,R,[dB,pD,Mc],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,dB)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Mc))],null),null]))],null),null)})),Z(RF,JA,JA),yT.v(null,mE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[RF,Pz,zv],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[RF,Pz,zv],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,EJ)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,EJ)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[RF,Pz,zv],null),null,new Q(null,3,5,R,[EJ,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,EJ)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)})),yT.v(null,TA,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,1,5,R,[iE],null),iA,new Q(null,2,5,R,[Pz,zv],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[iE],null),new Q(null,2,5,R,[Pz,zv],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Zw)}],null),function(n){return M(n)&&N(n,Zw)},new Q(null,2,5,R,[uE,kJ],null),new Q(null,1,5,R,[iE],null),null,new Q(null,1,5,R,[Zw],null),new Q(null,2,5,R,[Pz,zv],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zw))],null),null]))],null),null)})),Z(GG,new Bk(null,new n(null,4,[Zv,"null",WI,"null",Yp,"null",Fs,"null"],null),null),new Bk(null,new n(null,4,[Zv,null,WI,null,Yp,null,Fs,null],null),null)),yT.v(null,jD,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[Cq,GG,qB],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Cq,GG,qB],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Tu)},function(n){return N(n,ov)},function(n){return N(n,Zw)}],null),function(n){return M(n)&&N(n,Tu)&&N(n,ov)&&N(n,Zw)},I,new Q(null,3,5,R,[Cq,GG,qB],null),null,new Q(null,3,5,R,[Tu,ov,Zw],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Tu)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ov)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zw))],null),null]))],null),null)})),yT.v(null,mH,(function(){return cT(new Q(null,2,5,R,[rs,St],null),new Q(null,2,5,R,[rs,St],null),null)})),yT.v(null,ut,(function(){return cT(new Q(null,2,5,R,[rs,Wo],null),new Q(null,2,5,R,[rs,Wo],null),null)})),yT.v(null,Nu,(function(){return cT(new Q(null,2,5,R,[kG,KC],null),new Q(null,2,5,R,[kG,KC],null),null)})),yT.v(null,Gr,(function(){return cT(new Q(null,2,5,R,[kG,Yu],null),new Q(null,2,5,R,[kG,Yu],null),null)})),yT.v(null,Gz,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,1,5,R,[JG],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[JG],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,fA)}],null),function(n){return M(n)&&N(n,fA)},I,new Q(null,1,5,R,[JG],null),null,new Q(null,1,5,R,[fA],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA))],null),null]))],null),null)})),yT.v(null,OB,(function(){return cT(new Q(null,2,5,R,[kG,wJ],null),new Q(null,2,5,R,[kG,wJ],null),null)})),yT.v(null,Uw,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[JG,Pz,zv],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[JG,Pz,zv],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,fA)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[JG,Pz,zv],null),null,new Q(null,3,5,R,[fA,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)})),yT.v(null,fw,(function(){return cT(new Q(null,2,5,R,[kG,vG],null),new Q(null,2,5,R,[kG,vG],null),null)})),yT.v(null,nt,(function(){return cT(new Q(null,2,5,R,[kG,Bn],null),new Q(null,2,5,R,[kG,Bn],null),null)})),yT.v(null,ox,(function(){return cT(new Q(null,2,5,R,[kG,Bs],null),new Q(null,2,5,R,[kG,Bs],null),null)})),yT.v(null,wG,(function(){return cT(new Q(null,2,5,R,[kG,ar],null),new Q(null,2,5,R,[kG,ar],null),null)})),Z(Xx,jH,Zf),yT.v(null,OA,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,5,5,R,[JG,Xx,pG,Vm,IF],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,5,5,R,[JG,Xx,pG,Vm,IF],null),null,null,new Q(null,6,5,R,[function(n){return M(n)},function(n){return N(n,fA)},function(n){return N(n,UI)},function(n){return N(n,cE)},function(n){return N(n,Jq)},function(n){return N(n,yn)}],null),function(n){return M(n)&&N(n,fA)&&N(n,UI)&&N(n,cE)&&N(n,Jq)&&N(n,yn)},I,new Q(null,5,5,R,[JG,Xx,pG,Vm,IF],null),null,new Q(null,5,5,R,[fA,UI,cE,Jq,yn],null),I,new Q(null,6,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,fA)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,UI)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,cE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Jq)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn))],null),null]))],null),null)})),yT.v(null,mw,(function(){return cT(new Q(null,2,5,R,[kG,jq],null),new Q(null,2,5,R,[kG,jq],null),null)})),yT.v(null,ND,(function(){return cT(new Q(null,2,5,R,[kG,vw],null),new Q(null,2,5,R,[kG,vw],null),null)})),yT.v(null,Ox,(function(){return cT(new Q(null,2,5,R,[kG,uz],null),new Q(null,2,5,R,[kG,uz],null),null)})),yT.v(null,Ru,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,1,5,R,[ev],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[ev],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Ru)}],null),function(n){return M(n)&&N(n,Ru)},I,new Q(null,1,5,R,[ev],null),null,new Q(null,1,5,R,[Ru],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Ru))],null),null]))],null),null)})),Z(Mv,Bo,Vc),Z(vx,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Wx],null),iA,new Q(null,1,5,R,[Mv],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Wx],null),iA,new Q(null,1,5,R,[Mv],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Wx],null),new Q(null,1,5,R,[Mv],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,pD)}],null),function(n){return M(n)&&N(n,pD)},new Q(null,1,5,R,[os],null),new Q(null,1,5,R,[Wx],null),null,new Q(null,1,5,R,[pD],null),new Q(null,1,5,R,[Mv],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD))],null),null]))],null),null));var j1=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Aa,"handle-request"),(function(n,e,t){return U.a(t)}),i,n,e,t,r)}();function k1(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,r=x.b(t,lz);t=x.b(t,Xv);try{return j1.c(n,r,t)}catch(o){var i=o;return p(km(i))||AY(IA,Aa,317,new xl((function(){return new Q(null,3,5,R,[i,"Error handling request",e],null)})),-39438057),zL(r)?new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("agm",r,is.a(t),ow.a(t),jL(i,"agm.errors.failure"))],null)],null):null}}function l1(){}j1.v(null,xH,(function(n,e,t){if(zL(e))n=e1(n,e,t);else{var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,ow),x.b(r,pD),r=x.b(r,os),n=p(qL(n,t,ip))?null:d1(n,e,t,r)}return n})),j1.v(null,LF,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=g1(n,KT(n,r=x.b(r,ow)),lL(t)),l=J(o,0,null);o=J(o,1,null),n=new Q(null,2,5,R,[l,Cf.g(o,yL.A("agm",e,i,r),G([vL(q0(dL(Mx.a(n)),r),K.c(t,U,bu))]))],null)}else e=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,e=x.b(e,ow),n=p(e=JT.b(n,e))?g1(n,e,lL(t)):null;return n})),j1.v(null,fw,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);r=x.b(r,Zw);var l=V0(n,t);n=J(l,0,null),l=J(l,1,null),e=new Q(null,2,5,R,[n,Cf.g(l,W_(e,o,o,r,Fs),G([yL.A("agm",e,i,o),vL(q0(dL(Mx.a(n)),o),t)]))],null)}else e=V0(n,t);return e})),j1.v(null,nt,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);r=x.b(r,Zw);var l=T0(n,t),u=J(l,0,null);l=J(l,1,null),n=new Q(null,2,5,R,[u,Cf.g(l,X_(e,o,o,r),G([yL.A("agm",e,i,o),vL(q0(dL(Mx.a(n)),o),t)]))],null)}else n=T0(n,t);return n})),j1.v(null,mw,(function(n,e,t){if(zL(e)){e=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,x.b(e,is);var r=x.b(e,ow);e=LT(n,e=x.b(e,Tu),ip),r=LT(n,r,ip);var i=eL(Mx.a(n)),o=J(i,0,null);i=J(i,1,null),a0(r,e,t),n=Y0(K.c(n,Mx,o),t,i,e,r)}else o=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,x.b(o,is),e=x.b(o,ow),r=x.b(o,Tu),o=x.b(o,qu),n=MT(r=JT.c(n,r,ip))?Y0(n,t,o,r,LT(n,e,ip)):null;return n})),j1.v(null,Ox,(function(e,t,r){zL(t);var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;return t=x.b(i,qu),LT(e,i=x.b(i,ow),ip),a1(e,t,i,r,new n(null,1,[qz,r],null))})),j1.v(null,Nu,(function(n,e,t){if(zL(e)){var r=eL(Mx.a(n));e=J(r,0,null),r=J(r,1,null),n=z0(K.c(n,Mx,e),t,r)}else r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,e=x.b(r,fA),r=x.b(r,Tu),n=p(JT.b(n,r))?z0(n,t,e):null;return n})),j1.v(null,hH,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);n=J(t=M0(n,t,o,r=x.b(r,fA)),0,null),t=J(t,1,null),n=new Q(null,2,5,R,[n,Cf.b(t,yL.A("agm",e,i,o))],null)}else i=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,x.b(i,is),n=M0(n,t,e=x.b(i,ow),i=x.b(i,fA));return n})),j1.v(null,OB,(function(n,e,t){return K0(n,e,t,!1)})),j1.v(null,Gr,(function(n,e,t){return zL(e)?(e=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,x.b(e,fA),n=C0(n,e=LT(n,e=x.b(e,ow),ip),t)):n=D0(n,t),n})),j1.v(null,wG,(function(n,e,t){return O0(n,t)})),j1.v(null,ox,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,ow);t=x.b(i,fA);var l=x.b(i,cE),u=x.b(i,Jq);i=x.b(i,yn);var s=JT.c(e,o,ip),a=mi.b(s,new Q(null,4,5,R,[ip,$n,t,Dz],null)),c=JT.b(e,a),d=lz.a(c);if(p(d)){var f=a=R;MT(c)?(N0(new Q(null,1,5,R,[t],null),c,s,!0,l,u,i),r=qJ.a(c),r=uL(d,new n(null,8,[tq,"agm",U,OA,ow,r,fA,t,UI,!0,cE,l,Jq,u,yn,i],null))):r=wL(q0(dL(Mx.a(e)),o),new n(null,2,[U,Yp,Yp,Yp.a(d)],null),r),e=new Q(null,2,5,a,[e,new Q(null,1,5,f,[r],null)],null)}else e=null;return e})),j1.v(null,IA,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is);return KT(e,i=x.b(i,ow)),p(o=a1(e,o,i,r,new n(null,1,[lC,r],null)))?o:K0(e,t,r,!0)})),j1.v(null,Nz,(function(n,e){return h1(n,e)})),j1.v(null,$z,(function(n,e,t){return i1(n,e,t)})),j1.v(null,em,(function(n,e,t){return AY(IA,Aa,300,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),-855943582),new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("agm",e,is.b(t,-1),ow.a(t),mL("agm.errors.unhandled_message",["Unhandled message ",q.a(t)].join("")))],null)],null)})),l1.prototype.Yc=function(){return new n(null,3,[$v,"agm",Rn,"",Ln,1],null)},l1.prototype.Zc=function(n,e){return e},l1.prototype.Wc=function(n,e){return e},l1.prototype.Xc=function(n,e,t){return k1(e,t)};var m1=iL("activity.peer-removed","Peer has been removed"),n1=iL("activity.destroyed","Activity destroyed");function o1(e,t,r,i){return uL(e,t=new n(null,6,[tq,"activity",U,BG,ow,t,bz,r,uE,$v.a(i),kJ,sr.a(i)],null))}function p1(e,t){return new n(null,4,[tq,"activity",U,Dp,ow,e,$E,t],null)}function q1(e,t,r,i){return uL(e,new n(null,5,[tq,"activity",U,qr,is,t,ow,r,Zr,i],null))}var r1=function n(e){return ji.b(S,Wh.b((function(e){var t=J(e,0,null);return e=J(e,1,null),new Q(null,2,5,R,[t,pi(pi(e,fI,yn),YC,n)],null)}),e))};function s1(e,t){return e=JT.b(e,t),new n(null,3,[ow,t,yw,Vu.a(e),U,KH.a(e)],null)}function t1(n,e,t,r,i){var o=YC.a(r),l=Vu.a(t),u=KH.a(t);return n=Xj([fs,ln,U,ow,tE,WB,tq,Dt,Zr,oA],[ki.b(Jh(s1,n),zG.a(r)),ln.a(r),Tx,qJ.a(t),U.a(r),i,"activity",ap.a(r),qJ.a(r),s1(n,oA.a(r))]),l=p(l)?K.c(n,Vu,l):n,u=p(u)?K.c(l,KH,u):l,uL(e,o=p(o)?K.c(u,YC,r1(o)):u)}var u1=function n(e){switch(arguments.length){case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};u1.A=function(n,e,t,r){return uL(e,u1.c(n,t,r))},u1.c=function(n,e,t){var r=YC.a(t);return n=Xj([fs,ln,U,ow,tE,tq,Dt,Zr,oA],[ki.b(Jh(s1,n),aU(fs.a(t),zG.a(t))),ln.a(t),bI,e,U.a(t),"activity",ap.a(t),qJ.a(t),s1(n,oA.a(t))]),p(r)?K.c(n,YC,r1(r)):n},u1.F=4;var v1=Jh(yL,"activity"),w1=Jh(xL,"activity");function x1(n,e,t){return gd.c((function(n,e){return e=new Q(null,2,5,R,[ZF,e],null),ni(n,e,Cf.b(mi.c(n,e,I),t))}),n,e)}function y1(n,e,t){return p((r=B(e))?t:r)?gd.c((function(n,e){e=new Q(null,2,5,R,[ZF,e],null);var r=ZK(t,mi.c(n,e,null));return B(r)?ni(n,e,r):UK(n,e)}),n,e):n;var r}function z1(n,e){return p(e)?mi.b(n,new Q(null,2,5,R,[vs,e],null)):null}function A1(n,e,t){return p(e)?ni(n,new Q(null,2,5,R,[vs,e],null),t):n}function B1(n,e){return mi.b(n,new Q(null,2,5,R,[Vr,e],null))}function C1(n,e,t){return gd.c((function(n,t){return ni(n,new Q(null,3,5,R,[Vr,e,yw.a(t)],null),t)}),n,t)}function D1(n,e,t){return gd.c((function(n,t){return UK(n,new Q(null,3,5,R,[Vr,e,t],null))}),n,t)}function E1(n,e){return aU(mi.b(n,new Q(null,2,5,R,[EF,e],null)),mi.b(n,new Q(null,2,5,R,[EF,yC],null)))}function F1(n,e,t){return oi.A(n,new Q(null,2,5,R,[EF,t],null),Mh(Cf,Dk),e)}function G1(n,e,t){return oi.A(n,new Q(null,2,5,R,[EF,t],null),Of,e)}function H1(n,e){return p(e)?p(n=z1(n,e))?n:kL("activity.errors.invalid_activity",["Unable to find activity with id ",q.a(e)].join("")):null}function I1(n,e){return ni(n,new Q(null,2,5,R,[ao,qJ.a(e)],null),e)}function J1(n,e){return p(e)?mi.b(n,new Q(null,2,5,R,[ao,e],null)):null}function K1(n,e,t){return p(p(e)?t:e)?N(x.b(e,tD),t)?n:ni(n,new Q(null,2,5,R,[ao,qJ.a(e)],null),qi(e,tD,Mh(Cf,Dk),t)):n}function L1(n,e,t){var r=qi(e,tD,Of,t);return t=A.b(t,oA.a(r))?Hf.b(r,oA):r,new Q(null,2,5,R,[ni(n,new Q(null,2,5,R,[ao,qJ.a(e)],null),t),t],null)}var M1=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Ma,"apply-command"),(function(n,e){return C(e)}),i,n,e,t,r)}();function N1(n,e,t){var r=Ol(KH,t);return x1(TT(n,qJ.a(e),oi.c(e,new Q(null,2,5,R,[by,ZF],null),Mh((function(n){return kg((function(n,e,t){return K.c(n,e,C(t))}),n,r)}),S))),mj(r),qJ.a(e))}function O1(e,t,r){return ki.b((function(e){var i=lz.a(e);e=qJ.a(e);var o=qJ.a(t);return uL(i,new n(null,5,[tq,"activity",U,FH,ow,e,mA,o,ZF,r],null))}),XT(e,by,t,!1))}function P1(e,t,r,i){var o=qJ.a(t);return li(Uc,Wh.b((function(e){if(p(p(i)?i:kh.b(o,qJ.a(e)))){var t=lz.a(e);e=qJ.a(e);var l=Ni(r);t=uL(t,new n(null,5,[tq,"activity",U,wI,ow,e,mA,o,ex,l],null))}else t=null;return t}),XT(e,by,t,!1)))}M1.v(null,Hr,(function(n,e){return J(e,0,null),B(e=J(e,1,null))?gh(Hf,n,e):n})),M1.v(null,Qv,(function(n,e){return J(e,0,null),null!=(e=J(e,1,null))?kg(K,n,e):n})),M1.v(null,BA,(function(n,e){return J(e,0,null),null!=(e=J(e,1,null))?kg((function(n,e,t){return pi(n,e,(function(n){return Vf(t)||$f(t)||Vf(n)||$f(n)?t:Sf(t)&&Sf(n)?wk.g(G([n,t])):t}))}),n,e):n})),M1.v(null,vq,(function(n,e){return J(e,0,null),p(e=J(e,1,null))?e:n})),M1.v(null,em,(function(n,e){var t=J(e,0,null),r=J(e,1,null);return AY(VH,Ma,101,new xl((function(){return new Q(null,4,5,R,["ignoring unknown context delta command",t,"with payload",r],null)})),31928e4),n}));var Q1=function n(e){switch(arguments.length){case 2:return n.b(arguments[0],arguments[1]);case 3:return n.c(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function R1(n,e){e=KH.a(e),p(mi.b(n,new Q(null,3,5,R,[by,ZF,e],null)))&&kL("activity.errors.factory_already_registered",["Factory for type ",q.a(e)," is already registered by this peer"].join(""))}function S1(n,e){return $K((function(n){return A.b(qJ.a(n),e)}),nj(n))}function T1(n,e){var t=mi.b(n,new Q(null,2,5,R,[by,ZF],null));return e=gd.c((function(n,e){var r=J(n,0,null);return n=J(n,1,null),p(e=S1(t,e))?new Q(null,2,5,R,[UK(r,new Q(null,3,5,R,[by,ZF,KH.a(e)],null)),Cf.b(n,e)],null):new Q(null,2,5,R,[r,n],null)}),new Q(null,2,5,R,[n,Dk],null),e),n=J(e,0,null),e=J(e,1,null),new Q(null,2,5,R,[aL(n,by),e],null)}function U1(e,t,r,i,o,l,u,s){return l=p(l)?K.c(S,Tr,new n(null,4,[qJ,qJ.a(l),U,U.a(l),Dt,qJ.a(u),WF,yn.a(u)],null)):S,s=p(s)?K.c(l,Vu,s):l,l=lz.a(e),e=qJ.a(e),u=qJ.a(t),t=wk.g(G([PH.a(t),r])),uL(l,wk.g(G([new n(null,7,[tq,"activity",U,Lr,is,o,ow,e,gx,u,PG,i,PH,t],null),s])))}function V1(n,e,t){var r=JT.b(n,ow.a(t));return p(r)?new Q(null,2,5,R,[n,new Q(null,1,5,R,[w1(lz.a(r),is.a(t),qJ.a(r),e)],null)],null):new Q(null,2,5,R,[n,null],null)}function W1(n,e,t){return n=JT.b(n,p(e)?e:C(mi.b(n,new Q(null,2,5,R,[ZF,t],null)))),p(e=mi.b(n,new Q(null,3,5,R,[by,ZF,t],null)))?new Q(null,2,5,R,[n,e],null):kL("activity.errors.missing_factory",["Unable to find factory owner for type ",q.a(t)].join(""))}function X1(e,t,r,i,o,l,u){var s=W1(e,null,U.a(r)),a=J(s,0,null);s=J(s,1,null);var c=KT(e,t),d=eL(Mx.a(e));return t=J(d,0,null),d=J(d,1,null),l=new n(null,4,[U,Tr,qJ,d,KH,U.a(r),Tr,new n(null,2,[qJ,qJ.a(i),yy,l],null)],null),r=p(yw.a(r))?K.c(l,Vu,yw.a(r)):l,l=r_(e,l=pD.a(c),r),e=rL(K.c(e,Mx,t),d,r),new n(null,3,[Sz,e,eu,new Q(null,1,5,R,[U1(a,s,u,l,d,i,o,null)],null),WG,d],null)}function Y1(n){return nj(mi.b(n,new Q(null,1,5,R,[ao],null)))}function Z1(n,e,t){var r,i=null==(r=null==t?null:pD.a(t))?null:dt.a(r),o=function(){var n=null==t?null:eI.a(t);return null==n?null:po.a(n)}();n=nj(ao.a(n));var l=gd.c((function(n,t){return A.b(e,yw.a(t))&&A.b(i,null==(r=null==t?null:pD.a(t))?null:dt.a(r))?bf(t):null;var r}),null,n);return p(l)?l:gd.c((function(n,t){return A.b(e,yw.a(t))?p(o)?n=o:n=null==(n=null==t?null:eI.a(t))?null:po.a(n):n=!1,p(n)?bf(t):null}),null,n)}function $1(n,e){if(p(n=mi.b(n,new Q(null,2,5,R,[ao,e],null))))return n;throw im(["Unable to find context with id ",q.a(e)].join(""),S)}function a2(n,e,t){return p(p(e)?t:e)?N(x.b(e,tD),t)?n:ni(n,new Q(null,2,5,R,[ao,qJ.a(e)],null),qi(e,tD,Mh(Cf,Dk),t)):n}Q1.b=function(n,e){return li(Uc,Wh.b(Kh(Q1,n,e),fi.b(Kh(VT,by,e),Wh.b(Jh(JT,n),Fk(ii(nj(x.b(n,ZF))))))))},Q1.c=function(e,t,r){var i=nj(mi.b(r,new Q(null,2,5,R,[by,ZF],null)));return p(i)?(e=lz.a(t),t=qJ.a(t),r=qJ.a(r),i=Ni(i),e=uL(e,new n(null,5,[tq,"activity",U,FH,ow,t,mA,r,ZF,i],null))):e=null,e},Q1.F=3;var e5=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(sa,"apply-delta-cmd"),(function(n,e){return C(e)}),i,n,e,t,r)}();e5.v(null,Hr,(function(n,e){return J(e,0,null),B(e=J(e,1,null))?gh(Hf,n,e):n})),e5.v(null,Qv,(function(n,e){return J(e,0,null),null!=(e=J(e,1,null))?kg(K,n,e):n})),e5.v(null,BA,(function(n,e){return J(e,0,null),null!=(e=J(e,1,null))?kg((function(n,e,t){return pi(n,e,(function(n){return Vf(t)&&Vf(n)?t:Sf(t)&&Sf(n)?wk.g(G([n,t])):t}))}),n,e):n})),e5.v(null,vq,(function(n,e){return J(e,0,null),p(e=J(e,1,null))?e:n}));var b2=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(sa,"apply-command"),(function(n,e){return Kg.a(U.a(e))}),i,n,e,t,r)}(),f5=function n(e,t,r){var i,o=C(t=B(t)),l=D(t);return null==o?r:l?K.c(e,o,(i=null!=(i=x.b(e,o))&&M(i)?i:S,n.c?n.c(i,l,r):n.call(null,i,l,r))):K.c(e,o,r)};function c2(n,e,t,r){var i,o=qJ.a(e);return ni(ni(n,new Q(null,3,5,R,[ao,o,yn],null),gd.c(e5,p(i=yn.a(e))?i:S,t)),new Q(null,3,5,R,[ao,o,Ln],null),r)}function d2(e,t,r,i,o,l,u){var s=new n(null,2,[HA,0,Zt,(new Date).getTime()],null),a=pD.a(e);return e=eI.a(e),t=Xj([Ys,pD,yw,gz,qJ,Zz,tD,Ln,yn],[l,a,t,o,u,i,Dk,s,r]),p(e)?K.c(t,eI,e):t}function f2(n,e,t,r,i,o,l){this.id=n,this.type=e,this.ac=t,this.Nb=r,this.Mb=i,this.j=o,this.B=l,this.h=2230716170,this.I=139264}function g2(n,e,t,r){return new f2(n,e,t,r,null,null,null)}function h2(n,e,t){var r=fL(Mx.a(n)),i=J(r,0,null);t=d2(t,r=J(r,1,null),Wq.a(e),Tr,gz.a(e),Ys.a(e),r);var o=Qq.b(i,1),l=["a-",q.a($y.a(i)),"-",q.a(o)].join("");return i=J(o=new Q(null,2,5,R,[K.c(i,Qq,o+1),l],null),0,null),o=J(o,1,null),e=K.c(g2(o,tE.a(e),r,ow.a(e)),gn,e),new Q(null,3,5,R,[K.c(n,Mx,i),e,t],null)}function i2(n,e,t){return ji.c(I,Ih.b(fi.a((function(n){return A.b(e,mi.b(n,new Q(null,2,5,R,[pD,dt],null)))})),Wh.a((function(n){return uL(lz.a(n),p1(n=qJ.a(n),t))}))),NT(n,by))}function j2(e,t,r){return ji.c(I,Ih.b(fi.a((function(n){return A.b(t,mi.b(n,new Q(null,2,5,R,[pD,dt],null)))})),Wh.a((function(e){var t=lz.a(e);return e=qJ.a(e),uL(t,new n(null,4,[tq,"activity",U,pF,ow,e,$E,r],null))}))),NT(e,by))}function k2(n,e){B(n=Fk(nj(B1(n,mi.b(e,new Q(null,2,5,R,[pD,dt],null))))))?e=new Q(null,1,5,R,[uL(lz.a(e),p1(e=qJ.a(e),n))],null):e=null;return e}function l2(n,e,t){return p(n=x.b(B1(n,mi.b(e,new Q(null,2,5,R,[pD,dt],null))),t))?n:kL("activity.errors.missing_type",["Unable to find activity type ",q.a(t)].join(""))}function m2(e,t){var r=PH.a(e);return wk.g(G([r,x.b(t,new n(null,1,[U,U.a(e)],null)),x.b(t,new n(null,2,[U,U.a(e),yw,yw.a(e)],null))]))}function n2(n,e,t,r,i){return n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n,e=X1(x.b(n,Sz),t,e,x.b(n,Tr),r,!0,m2(e,i)),VK(WK(K.c(n,Sz,Sz.a(e)),new Q(null,1,5,R,[eu],null),eu.a(e)),new Q(null,2,5,R,[Tr,aC],null),G([WG.a(e)]))}function o2(n,e,t,r,i){n=null!=n&&(64&n.h||h===n.D)?fh(qk,n):n,x.b(n,Sz);var o=x.b(n,Tr);return gd.c((function(n,e){try{var l=X1(Sz.a(n),t,e,Tr.a(n),r,!1,m2(e,i)),u=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l,s=x.b(u,Sz),a=x.b(u,eu),c=x.b(u,WG);return VK(WK(K.c(n,Sz,s),new Q(null,1,5,R,[eu],null),a),new Q(null,2,5,R,[Tr,aC],null),G([c]))}catch(t){var d=t;return AY(VH,ya,157,new xl((function(){return new Q(null,5,5,R,[d,"Unable to create helper type",e,"for activity",qJ.a(o)],null)})),2059607643),n}}),n,e)}function p2(e,t,r,i){var o=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,l=x.b(o,is),u=LT(e,o=x.b(o,ow),by),s=l2(e,u,tE.a(r));i=ji.b(S,Wh.b((function(n){return new Q(null,2,5,R,[yk(n,new Q(null,2,5,R,[U,yw],null)),PH.a(n)],null)}),i));var a,c=rx.a(r);return p(p(c)?!Pf(i):c)&&kL("activity.errors.activity_is_child","Cannot specify types override and custom configuration at the same time"),r=J(e=h2(e,r,u),0,null),u=J(e,1,null),e=J(e,2,null),o=null!=(t=o2(n2(new n(null,3,[Sz,r,eu,new Q(null,1,5,R,[q1(t,l,o,qJ.a(u))],null),Tr,u],null),p(a=uH.a(c))?a:uH.a(s),o,e,i),function(){var n=aG.a(c);return p(n)?n:aG.a(s)}(),o,e,i))&&(64&t.h||h===t.D)?fh(qk,t):t,l=x.b(o,Sz),t=x.b(o,eu),o=x.b(o,Tr),l=A1(I1(l,e),qJ.a(o),o),new Q(null,2,5,R,[l,t],null)}function q2(n,e,t){var r=qJ.a(t);return!!(N(zG.a(n),r)||N(fs.a(n),r)||A.b(oA.a(n),r))||VT.la(pD.a(e),gz.a(n),mi.b(e,new Q(null,2,5,R,[eI,po],null)),pD.a(t),null,mi.b(t,new Q(null,2,5,R,[eI,po],null)))}function r2(n,e,t){var r=oA.a(e),i=zG.a(e);return ki.b((function(r){return t1(n,lz.a(r),r,e,t)}),fi.b(Uc,Wh.b((function(e){return JT.b(n,e)}),Cf.b(i,r))))}function s2(n,e){return bU(Ek([e]),x.c(n,fs,Dk),G([x.b(n,zG)]))}function t2(n,e,t,r){return fi.b(Kh(q2,t,r),Wh.b(Jh(JT,n),gi.b(Jh(A,e),aU(E1(n,U.a(t)),p(!0)?s2(t,qJ.a(r)):null))))}function u2(n,e){var t=U.a(e),r=JT.b(n,oA.a(e));return ki.b((function(t){return u1.A(n,lz.a(t),qJ.a(t),e)}),fi.b((function(n){return q2(e,r,n)}),Wh.b(Jh(JT,n),E1(n,t))))}function v2(e,t,r,i){return p(Io.a(t))?(r=JT.b(e,r),ki.b((function(e){var r=lz.a(e);e=qJ.a(e);var o=qJ.a(t);return uL(r,e=new n(null,6,[tq,"activity",U,Hw,ow,e,Zr,o,uE,$v.a(i),kJ,sr.a(i)],null))}),t2(e,null,t,r))):null}function w2(e,t,r){if(p(Io.a(t))){var i=qJ.a(r);return ki.b((function(e){var i=lz.a(e),o=qJ.a(e),l=qJ.a(t),u=Vu.a(r);return e=KH.a(r),o=new n(null,5,[tq,"activity",U,kF,ow,o,Zr,l,mA,qJ.a(r)],null),u=p(u)?K.c(o,Vu,u):o,uL(i,e=p(e)?K.c(u,KH,e):u)}),t2(e,i,t,r))}return null}function x2(e,t,r,i){var o=qJ.a(t);return ki.b((function(e){var i=lz.a(e),o=qJ.a(e),l=qJ.a(r);return e=Vu.a(t),o=new n(null,6,[tq,"activity",U,aD,ow,o,Zr,l,sv,qJ.a(t),Ky,KH.a(t)],null),uL(i,e=p(e)?K.c(o,Zx,e):o)}),t2(e,o,r,i))}function y2(e,t,r,i){var o=JT.b(e,oA.a(r));return ki.b((function(e){var o=lz.a(e);e=qJ.a(e);var l=qJ.a(r);return uL(o,e=new n(null,7,[tq,"activity",U,mn,ow,e,Zr,l,lu,t,uE,$v.a(i),kJ,sr.a(i)],null))}),t2(e,t,r,o))}function z2(e,t,r){var i=qJ.a(r),o=ap.a(t);if(o=J1(e,o),t=qi(t,zG,Mh(Cf,Dk),i),p(Io.a(t))){var l=oA.a(t);l=JT.b(e,l),r=Cf.b(x2(e,r,t,l),t1(e,lz.a(r),r,t,yn.a(o)))}else r=null;return new n(null,3,[Sz,K1(e,o,i),Tr,t,eu,r],null)}function A2(n){return aL(UK(UK(n,new Q(null,2,5,R,[by,eJ],null)),new Q(null,2,5,R,[by,oA],null)),by)}function B2(n,e,t){return gd.c((function(n,e){var r=J(n,0,null);n=J(n,1,null);var i=JT.b(r,e);return p(i)?new Q(null,2,5,R,[TT(r,e,A2(i)),Cf.b(n,o1(lz.a(i),e,null,t))],null):new Q(null,2,5,R,[r,n],null)}),new Q(null,2,5,R,[n,I],null),e)}function C2(n,e){return gd.c((function(n,e){return C(sL(n,e))}),n,aC.a(e))}function D2(n,e,t){var r=gn.a(e),i=oA.a(e);qJ.a(e);var o=R;n=C2(n,e);var l=qJ.a(e);n=UK(n,new Q(null,2,5,R,[vs,l],null)),l=ap.a(e),n=UK(n,new Q(null,2,5,R,[ao,l],null)),o=J(n=new Q(null,2,5,o,[n,null],null),0,null),n=J(n,1,null);var u=B2(o,bU(Ek([i]),fs.a(e),G([zG.a(e)])),t);return l=J(u,0,null),u=J(u,1,null),o=J(n=new Q(null,2,5,R,[p(l)?l:o,$f(u)||Vf(u)?gd.c(Mh(Cf,I),n,u):null!=u?Mh(Cf,I)(n,u):n],null),0,null),n=J(n,1,null),e=J(i=new Q(null,2,5,R,[o,v2(o,e,i,t)],null),0,null),i=J(i,1,null),e=J(i=new Q(null,2,5,R,[p(e)?e:o,$f(i)||Vf(i)?gd.c(Mh(Cf,I),n,i):null!=i?Mh(Cf,I)(n,i):n],null),0,null),i=J(i,1,null),o=p(r)?JT.b(e,ow.a(r)):r,p(o)?new Q(null,2,5,R,[e,Cf.b(i,w1(lz.a(o),is.a(r),ow.a(r),t))],null):new Q(null,2,5,R,[e,i],null)}function E2(n,e){return p(yy.a(e))?n=D2(n,e=z1(n,qJ.a(e)),iL("activity.errors.owner_creation","Activity owner cannot be created")):n=new Q(null,2,5,R,[n,null],null),n}function F2(n,e){var t=p(fs.a(n))?qi(n,fs,Of,e):n;return p(zG.a(n))?qi(t,zG,Of,e):t}function G2(e,t,r,i){AY(AG,ya,563,new xl((function(){return new Q(null,5,5,R,["a participant",qJ.a(r),"of activity",qJ.a(t),"has left"],null)})),-209386152);var o=qJ.a(r),l=F2(t,o),u=qJ.a(l);return i=y2(e,o,l,i),new n(null,3,[Sz,C(L1(A1(TT(e,o,A2(r)),u,l),J1(e,ap.a(l)),o)),Tr,l,eu,i],null)}function H2(n,e,t,r,i){var o=qJ.a(t);return AY(AG,ya,583,new xl((function(){return new Q(null,5,5,R,["the owner",o,"of activity",qJ.a(e),"has left"],null)})),1899025864),p(i)?D2(TT(n,o,A2(t)),e,r):(t=null!=(n=G2(n,e,t,r))&&(64&n.h||h===n.D)?fh(qk,n):n,n=x.b(t,Sz),t=x.b(t,eu),new Q(null,2,5,R,[n,t],null))}function I2(n,e,t,r,i,o){return n=B(i)?gd.c((function(n,e){return o.c?o.c(n,r,e):o.call(null,n,r,e)}),n,gi.b(Qc,i)):o.c?o.c(n,r,yC):o.call(null,n,r,yC),new Q(null,2,5,R,[n,new Q(null,1,5,R,[v1(e,t,r)],null)],null)}function J2(n,e,t){t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;var r=x.b(t,is),i=x.b(t,ow),o=x.b(t,lp);return t=LT(n,i,by),n=J(e=I2(n,e,r,i,o,F1),0,null),e=J(e,1,null),r=fi.b(Io,nj(x.b(n,vs))),new Q(null,2,5,R,[n,ji.b(e,ki.b(Lh(u1,n,lz.a(t),qJ.a(t)),B(o)?fi.b((function(n){return N(o,U.a(n))}),r):r))],null)}function K2(e,t,r,i,o){return uL(t,new n(null,5,[tq,e,U,du,is,r,ow,i,Dt,o],null))}function L2(e,t,r,i,o){return uL(t,new n(null,6,[tq,e,U,KE,ow,r,Dt,i,uE,$v.a(o),kJ,sr.a(o)],null))}function M2(n){return[q.a(n),".errors.not_authorized"].join("")}function N2(n){return mL([q.a(n),".destroyed"].join(""),"Context destroyed explicitly")}function O2(n){return mL([q.a(n),".peer-left"].join(""),"Context destroyed because its owner/last peer left")}function P2(n){return[q.a(n),".errors.failure"].join("")}function Q2(n,e){return n=Ln.a(n),e=Ln.a(e),HA.a(n)>HA.a(e)||A.b(HA.a(n),HA.a(e))&&Zt.a(n)>=Zt.a(e)}function R2(n,e){var t=Zz.a(n);if(A.b(t,Tr))n=N(tD.a(n),qJ.a(e));else{var r=(t=A.b(Zz.a(n),Mw))&&A.b(oA.a(n),qJ.a(e));n=r||!t&&mS(Ys.a(n),pD.a(n),pD.a(e))}return n}function S2(n,e,t){A.b(Zz.a(e),Tr)&&kL(M2(n),"Activity contexts cannot be explicitly destroyed");var r=Zz.a(e);if(A.b(r,Tr))e=N(tD.a(e),qJ.a(t));else{var i=(r=A.b(Zz.a(e),Mw))&&A.b(oA.a(e),qJ.a(t));e=i||!r&&mS(Ys.a(e),pD.a(e),pD.a(t))}p(e)||kL(M2(n),"Not authorized to update context")}function T2(n,e){return mS(gz.a(n),pD.a(n),pD.a(e))}function U2(n,e){return!!MT(n)&&(!!kh.b(Zz.a(e),Tr)&&T2(e,n))}function V2(n,e,t){p(T2(e,t))||kL(M2(n),"Not authorized to read context")}function W2(n){return p(mi.b(n,new Q(null,2,5,R,[eI,pu],null)))?"global":"context"}function X2(e,t,r,i,o){var l=qJ.a(t);return e=c2(e,t,i,o),new Q(null,2,5,R,[e,ki.b((function(e){var t=W2(e),o=lz.a(e);return e=qJ.a(e),uL(o,new n(null,6,[tq,t,U,PB,ow,e,CE,r,Dt,l,oo,i],null))}),fi.b(MT,Wh.b(Jh(JT,e),gi.b(Jh(A,r),tD.a(t)))))],null)}function Y2(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;x.b(t,is);var r,i=x.b(t,ow),o=x.b(t,yw);t=x.b(t,oo);try{var l=KT(n,i),u=Z1(n,o,l);return p(u)?p(p(r=R2(u,l))?Q2(e,u):r)?X2(n,u,i,bL(t),Ln.a(e)):new Q(null,2,5,R,[n,null],null):(AY(VH,pa,155,new xl((function(){return new Q(null,2,5,R,["unable to find remote context",o],null)})),1931868431),new Q(null,2,5,R,[n,null],null))}catch(r){var s=r;return AY(IA,pa,159,new xl((function(){return new Q(null,2,5,R,[s,"error performing remote context update"],null)})),222751919),new Q(null,2,5,R,[n,null],null)}}function $2(e,t,r,i){if(zL(r)){var o=null!=i&&(64&i.h||h===i.D)?fh(qk,i):i,l=x.b(o,is),u=x.b(o,ow),s=x.b(o,Dt);o=x.b(o,oo);try{var a=KT(t,u),c=$1(t,s),d=Ln.b(c,new n(null,1,[HA,0],null)),f=K.c(pi(d,HA,$e),Zt,(new Date).getTime());p(R2(c,a))||kL(e,"Not authorized to update context");var g=X2(t,c,u,bL(o),f),w=J(g,0,null),v=J(g,1,null),m=new Q(null,2,5,R,[w,new Q(null,2,5,R,[yL.A(e,r,l,u),vL(q0(dL(Mx.a(t)),u),K.g(i,U,pJ,G([Ln,f,yw,yw.a(c)])))],null)],null),y=J(m,0,null),b=J(m,1,null),$=new Q(null,2,5,R,[p(y)?y:w,$f(b)||Vf(b)?gd.c(Mh(Cf,I),v,b):null!=b?Mh(Cf,I)(v,b):v],null)}catch(n){$=new Q(null,2,5,R,[t,new Q(null,1,5,R,[xL.K(e,r,l,u,jL(n,P2(e)))],null)],null)}}else $=Y2(t,i);return $}function a3(n){if(n instanceof z)return n;switch(n){case"ownership":return Mw;case"ref-counted":return Go;case"retained":return aI;default:return null}}function b3(n,e,t,r){r=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;var i=x.b(r,yw),o=x.b(r,yn),l=x.b(r,Zz),u=x.b(r,gz),s=x.b(r,Ys),a=x.b(r,ow),c=fL(Mx.a(n));return r=J(c,0,null),c=J(c,1,null),e=K.g(d2(e,i,o,l,u,s,c),tD,Ek([a]),G([an,t])),e=A.b(l,Mw)?K.c(e,oA,a):e,t=R,n=K.c(n,Mx,r),n=ni(n,new Q(null,2,5,R,[ao,qJ.a(e)],null),e),new Q(null,2,5,t,[n,e],null)}function c3(e,t,r,i,o,l){t=a2(t,o,l);var u=R,s=R,a=qJ.a(o);return o=yn.a(o),new Q(null,2,5,u,[t,new Q(null,1,5,s,[uL(r,new n(null,6,[tq,e,U,ly,is,i,ow,l,Dt,a,yn,o],null))],null)],null)}function d3(n,e,t){t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,x.b(t,is);var r=x.b(t,ow),i=x.b(t,yw);try{var o=KT(e,r),l=Z1(e,i,o);return p(l)?(V2(n,l,o),new Q(null,2,5,R,[a2(e,l,r),null],null)):(AY(VH,pa,254,new xl((function(){return new Q(null,2,5,R,["unable to find remote context",i],null)})),303241329),new Q(null,2,5,R,[e,null],null))}catch(n){return new Q(null,2,5,R,[e,null],null)}}function e3(n,e,t,r){if(zL(t)){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow);i=x.b(i,Dt);try{var u=KT(e,l),s=$1(e,i),a=Jh(c3,n);V2(n,s,u);var c=new Q(null,2,5,R,[e,null],null),d=J(c,0,null),f=J(c,1,null),g=a(d,t,o,s,l),w=J(g,0,null),v=J(g,1,null),m=new Q(null,2,5,R,[p(w)?w:d,$f(v)||Vf(v)?gd.c(Mh(Cf,I),f,v):null!=v?Mh(Cf,I)(f,v):f],null),y=J(m,0,null),b=J(m,1,null),$=new Q(null,2,5,R,[null,vL(q0(dL(Mx.a(e)),l),K.g(r,U,Qw,G([yw,yw.a(s)])))],null),_=J($,0,null),S=J($,1,null),C=new Q(null,2,5,R,[p(_)?_:y,$f(S)||Vf(S)?gd.c(Mh(Cf,I),b,S):null!=S?Mh(Cf,I)(b,S):b],null)}catch(r){C=new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(n,t,o,l,jL(r,P2(n)))],null)],null)}}else C=d3(n,e,r);return C}function f3(e,t,r){var i=yw.a(t),o=qJ.a(t),l=qJ.a(r);return ji.c(I,Ih.c(fi.a(MT),fi.a(Jh(T2,t)),Wh.a((function(e){var t=W2(e),r=lz.a(e);return e=qJ.a(e),uL(r,new n(null,6,[tq,t,U,on,ow,e,Vp,l,Dt,o,yw,i],null))}))),XT(e,ct,r,!0))}function g3(n,e,t){var r=qJ.a(n);return ji.c(I,Ih.c(fi.a(MT),fi.a(Jh(T2,n)),Wh.a((function(n){return L2(W2(n),lz.a(n),qJ.a(n),r,t)}))),e)}function h3(e,t){var r=lS(gz.a(t)),i=lS(Ys.a(t)),o=a3(Zz.a(t));return p(o)||kL([q.a(e),".errors.bad_lifetime"].join(""),["Bad lifetime value ",q.a(o)].join("")),wk.g(G([t,new n(null,3,[gz,r,Ys,i,Zz,o],null)]))}function i3(n,e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow);i=x.b(i,yw);try{var u=KT(e,l),s=Z1(e,i,u);if(p(s))return V2(n,s,l),c3(n,e,t,o,s,l);var a=b3(e,u,!0,h3(n,r)),c=J(a,0,null),d=J(a,1,null);return new Q(null,2,5,R,[c,Cf.g(f3(c,d,u),K2(n,t,o,l,qJ.a(d)),G([vL(q0(dL(Mx.a(e)),l),K.g(r,U,Pu,G([Ln,Ln.a(d)])))]))],null)}catch(r){var f=r;return AY(IA,pa,383,new xl((function(){return new Q(null,2,5,R,[f,"error"],null)})),-3677801),new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(n,t,o,l,jL(f,P2(n)))],null)],null)}}function j3(e,t,r,i){if(zL(r))var o=i3(e,t,r,i);else{var l=null!=i&&(64&i.h||h===i.D)?fh(qk,i):i;x.b(l,is),r=x.b(l,ow),l=x.b(l,yw);try{var u=KT(t,r),s=Z1(t,l,u);if(p(s))V2(e,s,r),o=Q2(i,s)?X2(t,s,r,new n(null,1,[vq,yn.a(i)],null),Ln.a(i)):new Q(null,2,5,R,[t,null],null);else{var a=b3(t,u,!1,h3(e,i)),c=J(a,0,null),d=J(a,1,null);o=new Q(null,2,5,R,[c,f3(c,d,u)],null)}}catch(n){o=new Q(null,2,5,R,[t,null],null)}}return o}function k3(n,e,t,r){var i=qJ.a(t),o=tD.a(t);return new Q(null,2,5,R,[UK(e,new Q(null,2,5,R,[ao,i],null)),gd.c(Cf,ki.b((function(e){return L2(n,lz.a(e),qJ.a(e),i,r)}),fi.b(MT,Wh.b(Jh(JT,e),o))),g3(t,Dl(G([gi.b((function(n){return x.b(o,qJ.a(n))}),NT(e,ct))])),r))],null)}function l3(n,e,t){t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;var r=x.b(t,ow),i=x.b(t,yw);try{var o=KT(e,r),l=Z1(e,i,o);return p(l)?(S2(n,l,o),k3(n,e,l,N2(n))):(AY(VH,pa,437,new xl((function(){return new Q(null,2,5,R,["unable to find remote context",i],null)})),1815829467),new Q(null,2,5,R,[e,null],null))}catch(n){return new Q(null,2,5,R,[e,null],null)}}function m3(n,e,t,r){if(zL(t)){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow);i=x.b(i,Dt);try{var u=KT(e,l),s=$1(e,i);S2(n,s,u);var a=k3(n,e,s,N2(n)),c=J(a,0,null),d=J(a,1,null),f=new Q(null,2,5,R,[null,new Q(null,2,5,R,[yL.A(n,t,o,l),vL(q0(dL(Mx.a(e)),l),K.g(r,U,Tt,G([yw,yw.a(s)])))],null)],null),g=J(f,0,null),w=J(f,1,null),v=new Q(null,2,5,R,[p(g)?g:c,$f(w)||Vf(w)?gd.c(Mh(Cf,I),d,w):null!=w?Mh(Cf,I)(d,w):d],null)}catch(r){v=new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(n,t,o,l,jL(r,P2(n)))],null)],null)}}else v=l3(n,e,r);return v}b2.v(null,yA,(function(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;return e=x.b(t,jK),t=x.b(t,JO),n=p(n)?n:S,t=ec(null==t?"":String(t))?null:UL(t,/\./,0),f5(n,t,e)})),b2.v(null,iK,(function(e,t){return t=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,null==(t=ec(null==(t=x.b(t,JO))?"":String(t))?null:UL(t,/\./,0))?S:UK.g(e,t,G([new n(null,1,[FO,!0],null)]))})),e5.v(null,hK,(function(n,e){return J(e,0,null),e=J(e,1,null),gd.c((function(n,e){return b2.b(n,bL(e))}),n,e)})),e5.v(null,em,(function(n,e){var t=J(e,0,null),r=J(e,1,null);return AY(VH,sa,154,new xl((function(){return new Q(null,4,5,R,["ignoring unknown context delta command",t,"with payload",r],null)})),1689008759),n})),g=f2.prototype,g.ia=function(n,e){return this.M(null,e,null)},g.M=function(n,e,t){switch(e instanceof z?e.da:null){case"id":return this.id;case"type":return this.type;case"context-id":return this.ac;case"initiator":return this.Nb;default:return x.c(this.j,e,t)}},g.Aa=function(n,e,t){return gd.c((function(n,t){var r=J(t,0,null);return t=J(t,1,null),e.c?e.c(n,r,t):e.call(null,n,r,t)}),t,this)},g.S=function(n,e,t){return $k(e,(function(n){return $k(e,hl,""," ","",t,n)}),"#gateway.domains.activity.activity.Activity{",", ","}",t,Xg.b(new Q(null,4,5,R,[new Q(null,2,5,R,[qJ,this.id],null),new Q(null,2,5,R,[U,this.type],null),new Q(null,2,5,R,[ap,this.ac],null),new Q(null,2,5,R,[ln,this.Nb],null)],null),this.j))},g.ua=function(){return new gj(this,4,new Q(null,4,5,R,[qJ,U,ap,ln],null),p(this.j)?ze(this.j):mh())},g.N=function(){return this.Mb},g.X=function(){return 4+F(this.j)},g.Z=function(){var n=this.B;return null!=n?n:this.B=n=246370226^Ye(this)},g.Y=function(n,e){return null!=e&&this.constructor===e.constructor&&A.b(this.id,e.id)&&A.b(this.type,e.type)&&A.b(this.ac,e.ac)&&A.b(this.Nb,e.Nb)&&A.b(this.j,e.j)},g.Ka=function(e,t){return N(new Bk(null,new n(null,4,[ln,null,U,null,qJ,null,ap,null],null),null),t)?Hf.b(Pd(ji.b(S,this),this.Mb),t):new f2(this.id,this.type,this.ac,this.Nb,this.Mb,lh(Hf.b(this.j,t)),null)},g.fa=function(n,e,t){return p(P.b?P.b(qJ,e):P.call(null,qJ,e))?new f2(t,this.type,this.ac,this.Nb,this.Mb,this.j,null):p(P.b?P.b(U,e):P.call(null,U,e))?new f2(this.id,t,this.ac,this.Nb,this.Mb,this.j,null):p(P.b?P.b(ap,e):P.call(null,ap,e))?new f2(this.id,this.type,t,this.Nb,this.Mb,this.j,null):p(P.b?P.b(ln,e):P.call(null,ln,e))?new f2(this.id,this.type,this.ac,t,this.Mb,this.j,null):new f2(this.id,this.type,this.ac,this.Nb,this.Mb,K.c(this.j,e,t),null)},g.$=function(){return B(Xg.b(new Q(null,4,5,R,[new Gi(qJ,this.id),new Gi(U,this.type),new Gi(ap,this.ac),new Gi(ln,this.Nb)],null),this.j))},g.O=function(n,e){return new f2(this.id,this.type,this.ac,this.Nb,e,this.j,this.B)},g.ga=function(n,e){return Vf(e)?this.fa(null,qd(e,0),qd(e,1)):gd.c(od,this,e)},Z(zB,Bo,Vc),Z(ps,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Wx],null),iA,new Q(null,1,5,R,[zB],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Wx],null),iA,new Q(null,1,5,R,[zB],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Wx],null),new Q(null,1,5,R,[zB],null),null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,pD)}],null),function(n){return M(n)&&N(n,pD)},new Q(null,1,5,R,[os],null),new Q(null,1,5,R,[Wx],null),null,new Q(null,1,5,R,[pD],null),new Q(null,1,5,R,[zB],null),new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD))],null),null]))],null),null)),Z(rJ,Bp,Bp),Z(DI,O(hq,Bo),eT(Uy,Vc,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,Bo)],null),null)),Z(cC,Hq,M),Z(ro,Hq,M),Z(mC,Hq,M),Z(jo,new Bk(null,new n(null,2,[iK,"null",yA,"null"],null),null),new Bk(null,new n(null,2,[iK,null,yA,null],null),null)),Z(tT,Bo,Vc),Z(uT,BI,Wc),Z(GO,O(wt,ir,new Q(null,2,5,R,[jo,tT],null),iA,new Q(null,1,5,R,[uT],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[jo,tT],null),new Q(null,1,5,R,[uT],null),null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,JO)}],null),function(n){return M(n)&&N(n,U)&&N(n,JO)},new Q(null,1,5,R,[jK],null),new Q(null,2,5,R,[jo,tT],null),null,new Q(null,2,5,R,[U,JO],null),new Q(null,1,5,R,[uT],null),new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,JO))],null),null]))),Z(HO,O(hq,GO,Os,XF,uC,I),eT(GO,GO,new n(null,6,[uC,I,Zn,XF,NC,function(n){return Vf(n)},Os,Vf,sy,!0,NH,O(hq,GO,uC,I,Os,XF)],null),null)),Z(wx,O(wt,iA,new Q(null,5,5,R,[DI,cC,ro,mC,HO],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,5,5,R,[DI,cC,ro,mC,HO],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,5,5,R,[Hr,Qv,BA,vq,hK],null),I,null,I,new Q(null,5,5,R,[DI,cC,ro,mC,HO],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(cr,O(xv,Wp,O(wt,ir,new Q(null,2,5,R,[rJ,wx],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,2,5,R,[rJ,wx],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[rJ,wx],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,oo)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,oo)},I,new Q(null,2,5,R,[rJ,wx],null),null,new Q(null,2,5,R,[Dt,oo],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,oo))],null),null]))],null),null)),Z(Cz,O(W,new Q(null,1,5,R,[V],null),O(Fq,bn,O(Xp,V))),(function(n){return QS(bn,Kg.a(n))})),Z(Pr,O(CJ,Bo),rT(Bo,Vc,null)),Z(gE,O(CJ,Bo),rT(Bo,Vc,null)),Z(JB,O(xv,Wp,O(wt,ir,new Q(null,3,5,R,[Xy,LI,Cz],null),iA,new Q(null,3,5,R,[ZC,Pr,gE],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,3,5,R,[Xy,LI,Cz],null),iA,new Q(null,3,5,R,[ZC,Pr,gE],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Xy,LI,Cz],null),new Q(null,3,5,R,[ZC,Pr,gE],null),null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,yw)},function(n){return N(n,yn)},function(n){return N(n,Zz)}],null),function(n){return M(n)&&N(n,yw)&&N(n,yn)&&N(n,Zz)},new Q(null,3,5,R,[Ln,gz,Ys],null),new Q(null,3,5,R,[Xy,LI,Cz],null),null,new Q(null,3,5,R,[yw,yn,Zz],null),new Q(null,3,5,R,[ZC,Pr,gE],null),new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zz))],null),null]))],null),null)),Z(rJ,Bp,Bp),Z(IC,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[rJ],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[rJ],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(fu,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[rJ],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[rJ],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(Sp,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[rJ],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[rJ],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[rJ],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(rF,Bo,Vc),Z(ww,Bo,Vc),Z(bE,JA,JA),yT.v(null,PB,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[bE,yt,wx],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[bE,yt,wx],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,CE)},function(n){return N(n,Dt)},function(n){return N(n,oo)}],null),function(n){return M(n)&&N(n,CE)&&N(n,Dt)&&N(n,oo)},I,new Q(null,3,5,R,[bE,yt,wx],null),null,new Q(null,3,5,R,[CE,Dt,oo],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,CE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,oo))],null),null]))],null),null)})),yT.v(null,pJ,(function(){return cT(new Q(null,2,5,R,[kG,cr],null),new Q(null,2,5,R,[kG,cr],null),null)})),yT.v(null,du,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,1,5,R,[yt],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[yt],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[yt],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)})),Z(qH,JA,JA),Z(yt,Bp,Bp),yT.v(null,on,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[qH,yt,Xy],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[qH,yt,Xy],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Vp)},function(n){return N(n,Dt)},function(n){return N(n,yw)}],null),function(n){return M(n)&&N(n,Vp)&&N(n,Dt)&&N(n,yw)},I,new Q(null,3,5,R,[qH,yt,Xy],null),null,new Q(null,3,5,R,[Vp,Dt,yw],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Vp)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw))],null),null]))],null),null)})),yT.v(null,ly,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,2,5,R,[yt,LI],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[yt,LI],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,yn)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,yn)},I,new Q(null,2,5,R,[yt,LI],null),null,new Q(null,2,5,R,[Dt,yn],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn))],null),null]))],null),null)})),yT.v(null,KE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[yt,rF,ww],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[yt,rF,ww],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[yt,rF,ww],null),null,new Q(null,3,5,R,[Dt,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)})),yT.v(null,Pu,(function(){return cT(new Q(null,2,5,R,[kG,JB],null),new Q(null,2,5,R,[kG,JB],null),null)})),yT.v(null,Tt,(function(){return cT(new Q(null,2,5,R,[kG,Sp],null),new Q(null,2,5,R,[kG,Sp],null),null)})),yT.v(null,Qw,(function(){return cT(new Q(null,2,5,R,[kG,IC],null),new Q(null,2,5,R,[kG,IC],null),null)})),yT.v(null,bx,(function(){return cT(new Q(null,2,5,R,[kG,fu],null),new Q(null,2,5,R,[kG,fu],null),null)}));var n3=function n(e){switch(arguments.length){case 3:return n.c(arguments[0],arguments[1],arguments[2]);case 4:return n.A(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",q.a(arguments.length)].join(""))}};function o3(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;x.b(r,is);var i=x.b(r,ow),o=x.b(r,yw);try{var l=KT(e,i),u=Z1(e,o,l);return p(u)?n3.A(n,e,i,u):(AY(VH,pa,508,new xl((function(){return new Q(null,2,5,R,["unable to find remote context",o],null)})),1349283870),new Q(null,2,5,R,[e,null],null))}catch(n){var s=n;return AY(VH,pa,512,new xl((function(){return new Q(null,3,5,R,[s,"unable to process remote unsubscribe",t],null)})),82328913),new Q(null,2,5,R,[e,null],null)}}function p3(n,e,t,r){if(zL(t)){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow);i=x.b(i,Dt);try{KT(e,l);var u=$1(e,i),s=n3.A(n,e,l,u),a=J(s,0,null),c=J(s,1,null),d=new Q(null,2,5,R,[null,new Q(null,2,5,R,[yL.A(n,t,o,l),vL(q0(dL(Mx.a(e)),l),K.g(r,U,bx,G([yw,yw.a(u)])))],null)],null),f=J(d,0,null),g=J(d,1,null),w=new Q(null,2,5,R,[p(f)?f:a,$f(g)||Vf(g)?gd.c(Mh(Cf,I),c,g):null!=g?Mh(Cf,I)(c,g):c],null)}catch(r){w=new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K(n,t,o,l,jL(r,P2(n)))],null)],null)}}else w=o3(n,e,r);return w}function q3(e,t,r){var i=lz.a(r),o=qJ.a(r);return Wh.b((function(t){var r=oA.a(t),l=qJ.a(t);return t=yw.a(t),uL(i,new n(null,6,[tq,e,U,on,ow,o,Vp,r,Dt,l,yw,t],null))}),fi.b(Jh(U2,r),Y1(t)))}function r3(n,e){return p(n=JT.b(n,ow.a(Xv.a(e))))?Tc(pu.a(eI.a(n))):null}n3.c=function(n,e,t){var r=qJ.a(t),i=Jh(n3,n);return gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var o=i(t,r,e);return e=J(o,0,null),o=J(o,1,null),new Q(null,2,5,R,[p(e)?e:t,$f(o)||Vf(o)?gd.c(Mh(Cf,I),n,o):null!=o?Mh(Cf,I)(n,o):n],null)}),new Q(null,2,5,R,[e,I],null),Y1(e))},n3.A=function(n,e,t,r){if(N(tD.a(r),t)){var i=qi(r,tD,Of,t);t=A.b(t,oA.a(i))?Hf.b(i,oA):i,e=J(r=new Q(null,2,5,R,[ni(e,new Q(null,2,5,R,[ao,qJ.a(r)],null),t),t],null),0,null),r=J(r,1,null);n:switch(t=Zz.a(r),t instanceof z?t.da:null){case"ownership":t=null==oA.a(r);break n;case"ref-counted":t=Pf(tD.a(r));break n;default:t=!1}return p(t)?k3(n,e,r,O2(n)):new Q(null,2,5,R,[e,null],null)}return new Q(null,2,5,R,[e,null],null)},n3.F=4;var s3=Jh($2,"activity");function t3(n,e){var t=sL(n,is.a(e));n=J(t,0,null);var r=J(t,1,null);if(!p(r))return null;switch((t=U.a(r))instanceof z?t.da:null){case"activity":return p(e=Tr.a(r))?E2(n,e):null;case"create-peer":return V1(n,lL(e),gn.a(r));default:return AY(IA,za,35,new xl((function(){return new Q(null,2,5,R,["Unable to handle error for an unknown incoming request type",U.a(r)],null)})),223675566)}}var u3=Kh(ZT,"activity",by);function v3(n,e,t,r){var i,o,l,u,s=new Q(null,2,5,R,[n,null],null),a=function(){var n=J(s,0,null),r=J(s,1,null),i=mi.b(e,new Q(null,2,5,R,[by,eJ],null)),o=z1(n,i);if(p(o)){i=oA.a(o);var l=qJ.a(e),u=N(Us.a(o),l);o=u?qi(o,Us,Mh(Of,Dk),l):o,A.b(i,l)?l=H2(n,o,e,t,!u):(l=null!=(i=G2(n,o,e,t))&&(64&i.h||h===i.D)?fh(qk,i):i,i=x.b(l,Sz),l=x.b(l,eu),l=new Q(null,2,5,R,[i,l],null))}else l=null;return i=J(l,0,null),l=J(l,1,null),new Q(null,2,5,R,[p(i)?i:n,$f(l)||Vf(l)?gd.c(Mh(Cf,I),r,l):null!=l?Mh(Cf,I)(r,l):r],null)}(),c=(i=J(a,0,null),o=J(a,1,null),l=nj(mi.b(e,new Q(null,2,5,R,[by,ZF],null))),u=p(l)?new Q(null,2,5,R,[y1(i,Wh.b(KH,l),qJ.a(e)),P1(i,e,Wh.b(qJ,l),!1)],null):null,l=J(u,0,null),u=J(u,1,null),new Q(null,2,5,R,[p(l)?l:i,$f(u)||Vf(u)?gd.c(Mh(Cf,I),o,u):null!=u?Mh(Cf,I)(o,u):o],null));n=J(c,0,null),c=J(c,1,null);var d=u3(n,e,t,r);return r=J(d,0,null),d=J(d,1,null),new Q(null,2,5,R,[p(r)?r:n,$f(d)||Vf(d)?gd.c(Mh(Cf,I),c,d):null!=d?Mh(Cf,I)(c,d):c],null)}function w3(n,e){return e=QT(n,e,by),n=og(Wh.a(qJ),mg((function(n,e){return pL(n,e,by)}),lg),n,e),gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var r=v3(t,e,m1,!0);return e=J(r,0,null),r=J(r,1,null),new Q(null,2,5,R,[p(e)?e:t,$f(r)||Vf(r)?gd.c(Mh(Cf,I),n,r):null!=r?Mh(Cf,I)(n,r):n],null)}),new Q(null,2,5,R,[n,null],null),e)}var x3=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(za,"handle-request"),(function(n,e,t){return U.a(t)}),i,n,e,t,r)}();function y3(n){return pi(pi(n,uH,bL),aG,Jh(ki,bL))}function z3(n){return ki.b((function(n){return y3(yk(bL(n),new Q(null,4,5,R,[yw,uH,aG,Rz],null)))}),n)}function A3(){}function B3(n,e,t){return p(t=SC.a(t))?F(mi.b(n,new Q(null,2,5,R,[Av,p(e)?e:Qy],null)))>=t:null}function C3(n,e){return kg((function(n,t,r){return K.c(n,t,A.b("?",r)?e:r)}),S,n)}function D3(e,t,r){function i(n,e){return xL.K("global",t,l,u,iL(n,e))}var o=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,l=x.b(o,is),u=x.b(o,ow);o=x.b(o,zo);var s=pD.a(JT.b(e,u));if(p(s)){var a=tL(e,o);return p(a)?HT(a,e,new n(null,3,[Hv,Fs,lz,t,Xv,K.c(K.c(r,pD,s),U,xH)],null)):new Q(null,2,5,R,[e,new Q(null,1,5,R,[i("global.errors.invalid_domain",["Unable to join missing domain ",q.a(o)].join(""))],null)],null)}return new Q(null,2,5,R,[e,new Q(null,1,5,R,[i("global.errors.invalid_peer",["Unable to find peer with id ",q.a(u)].join(""))],null)],null)}function E3(n,e,t){return D3(n,e,t)}function G3(e,t,r,i,o){var l=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,u=x.b(l,is),s=x.b(l,Wv),a=x.b(l,hI),c=x.b(l,dt),d=x.b(l,Gu),f=x.b(l,eI);l=dJ.a(i);var g=J(e=sL(e,qJ.a(a)),0,null);J(e,1,null);var w,v,m,y=function(){var e=wk.g(G([new n(null,1,[cy,Z4(Rs.a(t),tn.a(o))],null),CZ(s),yk(r,new Q(null,2,5,R,[dt,Gs],null))]));if(p(hD.a(r))){var i=hD.a(r);e=p(i=dt.a(i))?K.c(e,dt,i):e}return e}(),b=p(jp.a(y))?new Q(null,2,5,R,[y,g],null):(w=Mx.a(g),v=Qq.b(w,1),m=["i-",q.a($y.a(w)),"-",q.a(v)].join(""),w=J(v=new Q(null,2,5,R,[K.c(w,Qq,v+1),m],null),0,null),v=J(v,1,null),new Q(null,2,5,R,[K.c(y,jp,v),K.c(g,Mx,w)],null));e=J(b,0,null),b=J(b,1,null),f=K.c(f,pu,!0);try{p(mi.b(b,new Q(null,2,5,R,[vu,e],null)))&&kL("global.errors.already_seen","Hello already received once"),EZ(e),p(B3(b,c,l))&&kL("global.errors.limits_exceeded","Maximum number of peers per user have been reached");var $=gL(Mx.a(b)),_=J($,0,null),S=J($,1,null),C=C3(e,S),A=RT(K.c(b,Mx,_),t,S,C,a,f),E=J(A,0,null),D=J(A,1,null),T=b1(t,u,qJ.a(D),Wh.b(sD,nj(pz.a(E))),C,wk.g(G([function(){var e=sD.a(i);return p(e)?new n(null,1,[sD,e],null):null}(),p(d)?new n(null,1,[Gu,d],null):null])));p(null)&&BY(dF,"global/peer-count",F(Dn.a(E)));var k=new Q(null,2,5,R,[E,new Q(null,1,5,R,[T],null)],null),O=J(k,0,null),M=J(k,1,null),j=E3(O,t,new n(null,6,[is,u,ow,qJ.a(D),pD,C,eI,f,zo,"context",tq,"global"],null)),N=J(j,0,null),P=J(j,1,null);return new Q(null,2,5,R,[p(N)?N:O,$f(P)||Vf(P)?gd.c(Mh(Cf,I),M,P):null!=P?Mh(Cf,I)(M,P):M],null)}catch(w){return a=w,zL(t)?new Q(null,2,5,R,[b,new Q(null,1,5,R,[xL.K("global",t,u,null,jL(a,"global.errors.failure"))],null)],null):null}}function H3(e,t,r){AY(AG,Ia,229,new xl((function(){return new Q(null,1,5,R,["removing source from global domain"],null)})),1035225972);var i=mi.b(e,new Q(null,2,5,R,[Mx,$y],null));e=gd.c((function(e,o){var l=J(e,0,null);e=J(e,1,null);var u=new Q(null,2,5,R,[ST(l,o),null],null),s=J(u,0,null);return u=J(u,1,null),l=J(e=new Q(null,2,5,R,[p(s)?s:l,$f(u)||Vf(u)?gd.c(Mh(Cf,I),e,u):null!=u?Mh(Cf,I)(e,u):e],null),0,null),e=J(e,1,null),o=J(s=new Q(null,2,5,R,[null,zL(t)?vL(new n(null,3,[U,WI,Fp,qJ.a(o),Yp,i],null),r):null],null),0,null),s=J(s,1,null),new Q(null,2,5,R,[p(o)?o:l,$f(s)||Vf(s)?gd.c(Mh(Cf,I),e,s):null!=s?Mh(Cf,I)(e,s):e],null)}),new Q(null,2,5,R,[e,null],null),PT(e,t));var o=J(e,0,null);return J(e,1,null),AY(AG,Ia,242,new xl((function(){return new Q(null,1,5,R,["removed source from global domain"],null)})),321153352),p(null)&&BY(dF,"global/peer-count",F(Dn.a(o))),e}function I3(e,t,r,i,o){r=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;var l=x.b(r,is),u=x.b(r,pD);r=hO(r=x.b(r,YB));var s=Kg.a(mI.b(r,em.a(i)));return p(i=mi.b(i,new Q(null,2,5,R,[rw,s],null)))?(mZ(nZ(mZ(rZ(i,new n(null,4,[is,l,Wv,u,YB,r,pn,pn.a(e)],null)),(function(n){return pi(n,U,(function(n){switch(n instanceof z?n.da:null){case"success":return AC;case"continue":return DE;default:return n}}))})),(function(n){return K.c(km(n),U,QE)})),(function(e){return QK(o,new n(null,3,[Hv,Fs,lz,t,Xv,K.g(e,is,l,G([Wv,u]))],null))})),new Q(null,2,5,R,[e,null],null)):new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K("global",t,l,null,mL("global.errors.authentication.failure",["Requested authentication provider ",q.a(s)," is not available"].join("")))],null)],null)}x3.v(null,xH,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow);if(r=x.b(r,os),p(qL(n,i,by)))e=new Q(null,2,5,R,[n,new Q(null,1,5,R,[v1(e,t,i)],null)],null);else{r=lS(r),r=oL(n,i,by,r),n=JT.b(r,i);n:{var o=dH.a(n);if(p(o)){var l=Vu.a(o),u=KH.a(o);switch(l=p(l)?K.c(n,Vu,l):n,u=p(u)?K.c(l,KH,u):l,l=(l=U.a(o))instanceof z?l.da:null){case"activity":var s=z1(r,l=mi.b(o,new Q(null,2,5,R,[Tr,qJ],null)));if(p(s)){var a=qJ.a(u),c=mi.b(o,new Q(null,2,5,R,[Tr,yy],null)),d=J1(r,ap.a(s));s=VK(s,new Q(null,1,5,R,[fs],null),G([a])),c=p(c)?K.c(s,oA,qJ.a(u)):s,r=K1(TT(A1(r,l,c=XK(c,new Q(null,1,5,R,[aC],null),qJ.a(o))),a,ni(ni(u,new Q(null,2,5,R,[by,eJ],null),l),new Q(null,2,5,R,[by,zE],null),zE.a(o))),d,a)}break n;case"create-peer":r=TT(r,qJ.a(u),u);break n;default:throw Error(["No matching clause: ",q.a(l)].join(""))}}}e=Cf.b(ji.b(ji.b(YT("activity",by,r,e,n),k2(r,n)),Q1.b(r,n)),v1(e,t,i)),e=new Q(null,2,5,R,[r,e],null)}return e})),x3.v(null,LF,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is);return n=J(t=v3(n,LT(n,r=x.b(r,ow),by),lL(t),!1),0,null),t=J(t,1,null),e=J(i=new Q(null,2,5,R,[null,v1(e,i,r)],null),0,null),i=J(i,1,null),new Q(null,2,5,R,[p(e)?e:n,$f(i)||Vf(i)?gd.c(Mh(Cf,I),t,i):null!=i?Mh(Cf,I)(t,i):t],null)})),x3.v(null,zl,(function(e,t,r){r=ow.a(r),r=JT.b(e,r);var i=mi.b(r,new Q(null,2,5,R,[by,eJ],null));if(p(i)){var o=qJ.a(r),l=z1(e,i);if(p(l)){var u=A.b(oA.a(l),o);t=u?l:qi(l,zG,Mh(Cf,Dk),o),t=XK(t,new Q(null,1,5,R,[fs],null),o),u?(o=ap.a(t),o=yn.a(J1(e,o)),u=qJ.a(r),l=mi.b(r,new Q(null,2,5,R,[by,zE],null)),t=Hf.b(K.g(t,oA,u,G([Io,!0])),gn),e=new n(null,3,[Sz,A1(TT(e,u,ni(r,new Q(null,2,5,R,[by,eJ],null),qJ.a(t))),qJ.a(t),t),Tr,t,eu,p(l)?ji.b(new Q(null,1,5,R,[t1(e,lz.a(r),r,t,o)],null),w2(e,t,r)):ji.b(r2(e,t,o),u2(e,t))],null)):e=z2(e,t,r),t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(t,Sz),r=x.b(t,Tr),t=x.b(t,eu),e=new Q(null,2,5,R,[A1(e,i,r),t],null)}else e=new Q(null,2,5,R,[TT(e,o,A2(r)),new Q(null,1,5,R,[o1(t,o,null,n1)],null)],null)}else p(l=mi.b(r,new Q(null,2,5,R,[dH,gn],null)))?(i=ow.a(l),u=JT.b(e,i),o=t=R,u=lz.a(u),l=is.a(l),r=qJ.a(r),e=new Q(null,2,5,t,[e,new Q(null,1,5,o,[uL(u,new n(null,5,[tq,"activity",U,Aw,is,l,ow,i,gC,r],null))],null)],null)):e=kL("activity.errors.invalid_peer",["Unable to find originating request for a ready message from peer ",q.a(qJ.a(r))].join(""));return e})),x3.v(null,Ov,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow);r=z3(r=x.b(r,$E));var o=LT(n,i,by),l=mi.b(o,new Q(null,2,5,R,[pD,dt],null));return p(l)?new Q(null,2,5,R,[C1(n,l,r),Cf.b(i2(n,l,r),v1(e,t,i))],null):new Q(null,2,5,R,[n,new Q(null,1,5,R,[w1(e,t,i,mL("activity.errors.registration.failure",["Registering peer is missing an user in its identity",q.a(pD.a(o))].join("")))],null)],null)})),x3.v(null,qD,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow),o=x.b(r,$E),l=LT(n,i,by);return p(r=mi.b(l,new Q(null,2,5,R,[pD,dt],null)))?(o=Fk(o),o=Fk(fi.b(o,mj(B1(n,r)))),n=new Q(null,2,5,R,[D1(n,r,o),Cf.b(j2(n,r,o),v1(e,t,i))],null)):n=new Q(null,2,5,R,[n,new Q(null,1,5,R,[w1(e,t,i,mL("activity.errors.registration.failure",["Removing peer is missing an user in its identity",q.a(pD.a(l))].join("")))],null)],null),n})),x3.v(null,cv,(function(n,e,t){var r=Hf.b(t,PH);return p2(n,e,r=p(rx.a(t))?pi(r,rx,Ih.b(y3,bL)):r,Wh.b(bL,PH.a(t)))})),x3.v(null,RI,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow),l=x.b(r,Zr);r=LT(n,o,by),l=H1(n,l);var u=qJ.a(r);return N(zG.a(l),u)||N(fs.a(l),u)||A.b(oA.a(l),u)?r=!0:(u=JT.b(n,oA.a(l)),r=VT.la(pD.a(u),Ys.a(l),!1,pD.a(r),null,!1)),p(r)?(n=J(t=D2(n,l,lL(t)),0,null),t=J(t,1,null),e=J(i=new Q(null,2,5,R,[null,v1(e,i,o)],null),0,null),i=J(i,1,null),e=new Q(null,2,5,R,[p(e)?e:n,$f(i)||Vf(i)?gd.c(Mh(Cf,I),t,i):null!=i?Mh(Cf,I)(t,i):t],null)):e=new Q(null,2,5,R,[n,w1(e,i,o,iL("activity.errors.not_authorized","Not authorized to destroy activity"))],null),e})),x3.v(null,Nu,(function(n,e,t){return J2(n,e,t)})),x3.v(null,hH,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow);return r=x.b(r,lp),LT(n,i,by),I2(n,e,t,i,r,G1)})),x3.v(null,Yz,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;r=x.b(i,is);var o=x.b(i,ow),l=x.b(i,LB),u=x.b(i,Zr),s=x.b(i,KH),a=x.b(i,Vu);return LT(e,o,by),i=H1(e,u),l=wk.g(G([LT(e,l,by),ji.b(S,fi.b(zf,new n(null,2,[Vu,a,KH,s],null)))])),a=by.a(l),s=eJ.a(a),a=oA.a(a),s=z1(e,p(s)?s:a),A.b(qJ.a(s),u)?t=new Q(null,2,5,R,[e,new Q(null,1,5,R,[v1(t,r,o)],null)],null):p(s)?t=kL("activity.errors.activity_is_child",["Peer is already in activity ",q.a(qJ.a(s))].join("")):(u=qJ.a(i),s=qJ.a(l),a=null!=(e=z2(e,i,l))&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(a,Sz),i=x.b(a,Tr),a=x.b(a,eu),l=null!=(e=new n(null,3,[Sz,TT(A1(e,u,i),s,ni(l,new Q(null,2,5,R,[by,eJ],null),u)),Tr,i,eu,a],null))&&(64&e.h||h===e.D)?fh(qk,e):e,e=x.b(l,Sz),l=x.b(l,eu),t=new Q(null,2,5,R,[e,Cf.b(l,v1(t,r,o))],null)),t})),x3.v(null,Du,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=LT(n,r=x.b(r,ow),by),l=mi.b(o,new Q(null,2,5,R,[by,eJ],null));l=z1(n,l);var u=oA.a(l);return p(l)||kL("activity.errors.not_a_member","Not a member of an activity"),t=lL(t),A.b(u,r)?t=H2(n,l,o,t,!0):(t=null!=(n=G2(n,l,o,t))&&(64&n.h||h===n.D)?fh(qk,n):n,n=x.b(t,Sz),t=x.b(t,eu),t=new Q(null,2,5,R,[n,t],null)),n=J(t,0,null),t=J(t,1,null),e=J(i=new Q(null,2,5,R,[null,v1(e,i,r)],null),0,null),i=J(i,1,null),new Q(null,2,5,R,[p(e)?e:n,$f(i)||Vf(i)?gd.c(Mh(Cf,I),t,i):null!=i?Mh(Cf,I)(t,i):t],null)})),x3.v(null,Hs,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow),o=x.b(r,ZF);r=LT(n,i,by);for(var l=B(o=Wh.b(hO,o)),u=null,s=0,a=0;;)if(a<s){R1(r,u.W(null,a)),a+=1}else{if(!(l=B(l)))break;Wf(u=l)?(l=re(u),a=se(u),u=l,s=F(l),l=a):(R1(r,l=C(u)),l=D(u),u=null,s=0),a=0}return n=N1(n,r,o),new Q(null,2,5,R,[n,Cf.b(O1(n,r,o),v1(e,t,i))],null)})),x3.v(null,Iv,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,is);var i=x.b(r,ow),o=x.b(r,ex),l=T1(r=LT(n,i,by),o);return o=J(l,0,null),l=J(l,1,null),n=y1(TT(n,i,o),Wh.b(KH,l),i),e=Cf.b(P1(n,r,ki.b(qJ,l),!0),v1(e,t,i)),new Q(null,2,5,R,[n,e],null)})),x3.v(null,BB,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow),u=x.b(i,mA),s=x.b(i,KH),a=x.b(i,Vu);i=x.b(i,Zr),LT(e,l,by),i=p(i)?H1(e,i):null,a=p(a)?a:s;var c=PH.a(r),d=W1(e,u,s);u=J(d,0,null),d=J(d,1,null);var f=KT(e,l),g=eL(Mx.a(e)),w=J(g,0,null);return g=J(g,1,null),r=yk(r,new Q(null,2,5,R,[is,ow],null)),s=new n(null,4,[U,BB,qJ,g,KH,s,gn,r],null),s=p(a)?K.c(s,Vu,a):s,r=r_(e,r=pD.a(f),s),s=rL(K.c(e,Mx,w),g,s),e=new n(null,3,[Sz,s,eu,new Q(null,1,5,R,[U1(u,d,c,r,g,i,J1(e,ap.a(i)),a)],null),WG,g],null),new Q(null,2,5,R,[Sz.a(e),Cf.b(eu.a(e),v1(t,o,l))],null)})),x3.v(null,cp,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;e=x.b(r,is);var i=x.b(r,ow);r=x.b(r,sG),LT(n,i,by);var o=KT(n,r);return new Q(null,2,5,R,[n,new Q(null,2,5,R,[o1(lz.a(o),r,i,lL(t)),v1(e,i)],null)],null)})),x3.v(null,IA,(function(n,e,t){return t3(n,t)})),x3.v(null,zE,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;r=x.b(i,is);var o=KT(e,i=x.b(i,ow)),l=mi.b(o,new Q(null,2,5,R,[by,eJ],null)),u=z1(e,l),s=eL(Mx.a(e)),a=J(s,0,null),c=J(s,1,null);return s=new n(null,5,[U,Tr,qJ,c,KH,KH.a(o),Tr,new n(null,2,[qJ,qJ.a(u),yy,A.b(qJ.a(o),oA.a(u))],null),zE,!0],null),s=p(Vu.a(o))?K.c(s,Vu,Vu.a(o)):s,c=rL(K.c(e,Mx,a),c,s),a=R,l=p(l)?A1(c,l,qi(u,Us,Mh(Cf,Dk),i)):c,u=R,e=r_(e,o=pD.a(o),s),new Q(null,2,5,a,[l,new Q(null,1,5,u,[uL(t,new n(null,5,[tq,"activity",U,$p,is,r,ow,i,$p,e],null))],null)],null)})),x3.v(null,pJ,(function(n,e,t){return s3(n,e,t)})),x3.v(null,Nz,(function(n,e){return w3(n,e)})),x3.v(null,em,(function(n,e,t){return AY(IA,za,246,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),271523315),new Q(null,2,5,R,[n,new Q(null,1,5,R,[w1(e,is.b(t,-1),ow.a(t),mL("activity.errors.unhandled_message",["Unhandled message ",q.a(t)].join("")))],null)],null)})),A3.prototype.Yc=function(){return new n(null,3,[$v,"activity",Rn,"",Ln,2],null)},A3.prototype.Zc=function(n,e){return e},A3.prototype.Wc=function(n,e){return e},A3.prototype.Xc=function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;n=x.b(r,lz),r=x.b(r,Xv),U.a(r);try{return x3.c(e,n,r)}catch(o){var i=o;return p(km(i))||AY(IA,za,270,new xl((function(){return new Q(null,3,5,R,[i,"Error handling request",t],null)})),2018153646),zL(n)?new Q(null,2,5,R,[e,new Q(null,1,5,R,[w1(n,is.a(r),ow.a(r),jL(i,"activity.errors.failure"))],null)],null):null}},Z(iB,O(W,new Q(null,1,5,R,[V],null),O(Fq,KI,O(fC,V))),(function(n){return QS(KI,hO(n))})),Z(ez,O(wt,ir,new Q(null,3,5,R,[GF,Wx,iB],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[GF,Wx,iB],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,is)},function(n){return N(n,pD)},function(n){return N(n,YB)}],null),function(n){return M(n)&&N(n,is)&&N(n,pD)&&N(n,YB)},I,new Q(null,3,5,R,[GF,Wx,iB],null),null,new Q(null,3,5,R,[is,pD,YB],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,pD)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,YB))],null),null]))),Z(Ut,GA,GA),Z(ju,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Ut],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Ut],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Ut],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,zo)}],null),function(n){return M(n)&&N(n,zo)},I,new Q(null,1,5,R,[Ut],null),null,new Q(null,1,5,R,[zo],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,zo))],null),null]))],null),null)),Z(Zp,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Ut],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Ut],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Ut],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,zo)}],null),function(n){return M(n)&&N(n,zo)},I,new Q(null,1,5,R,[Ut],null),null,new Q(null,1,5,R,[zo],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,zo))],null),null]))],null),null)),Z(rp,O(W,new Q(null,1,5,R,[V],null),O(Fq,bn,O(Xp,V))),(function(n){return QS(bn,Kg.a(n))})),Z(Iy,O(CJ,Bo),rT(Bo,Vc,null)),Z(Jo,O(CJ,Bo),rT(Bo,Vc,null)),Z(CF,O(xv,Wp,O(wt,ir,new Q(null,5,5,R,[Xy,LI,rp,Iy,Jo],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,5,5,R,[Xy,LI,rp,Iy,Jo],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,5,5,R,[Xy,LI,rp,Iy,Jo],null),null,null,new Q(null,6,5,R,[function(n){return M(n)},function(n){return N(n,yw)},function(n){return N(n,yn)},function(n){return N(n,Zz)},function(n){return N(n,gz)},function(n){return N(n,Ys)}],null),function(n){return M(n)&&N(n,yw)&&N(n,yn)&&N(n,Zz)&&N(n,gz)&&N(n,Ys)},I,new Q(null,5,5,R,[Xy,LI,rp,Iy,Jo],null),null,new Q(null,5,5,R,[yw,yn,Zz,gz,Ys],null),I,new Q(null,6,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Zz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,gz)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Ys))],null),null]))],null),null)),Z(Xo,Bp,Bp),Z(DF,O(hq,Bo),eT(Uy,Vc,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,Bo)],null),null)),Z(tx,Hq,M),Z(JE,Hq,M),Z(ys,Hq,M),Z(UF,O(wt,iA,new Q(null,4,5,R,[DF,tx,JE,ys],null)),US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[null,new Q(null,4,5,R,[DF,tx,JE,ys],null),null,new Q(null,1,5,R,[function(n){return M(n)}],null),function(n){return M(n)},new Q(null,4,5,R,[Hr,Qv,BA,vq],null),I,null,I,new Q(null,4,5,R,[DF,tx,JE,ys],null),new Q(null,1,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V))],null),null]))),Z(or,O(xv,Wp,O(wt,ir,new Q(null,2,5,R,[Xo,UF],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,2,5,R,[Xo,UF],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Xo,UF],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,oo)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,oo)},I,new Q(null,2,5,R,[Xo,UF],null),null,new Q(null,2,5,R,[Dt,oo],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,oo))],null),null]))],null),null)),Z(iu,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Xo],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[Xo],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(oJ,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Xo],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[Xo],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(qs,O(xv,Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))),cT(new Q(null,2,5,R,[Wp,O(wt,ir,new Q(null,1,5,R,[Xo],null))],null),new Q(null,2,5,R,[Wp,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[Xo],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[Xo],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)),Z(sB,Bo,Vc),Z(qq,Bo,Vc),yT.v(null,BH,(function(){return cT(new Q(null,2,5,R,[kG,ez],null),new Q(null,2,5,R,[kG,ez],null),null)})),yT.v(null,ds,(function(){return cT(new Q(null,2,5,R,[kG,ju],null),new Q(null,2,5,R,[kG,ju],null),null)})),yT.v(null,bu,(function(){return cT(new Q(null,2,5,R,[kG,Zp],null),new Q(null,2,5,R,[kG,Zp],null),null)})),Z(kz,Wx,Wx),yT.v(null,AC,(function(){return US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,5,5,R,[oE,GF,kz,Xs,br],null),new Q(null,1,5,R,[gB],null),null,new Q(null,6,5,R,[function(n){return M(n)},function(n){return N(n,U)},function(n){return N(n,is)},function(n){return N(n,Wv)},function(n){return N(n,dt)},function(n){return N(n,Gs)}],null),function(n){return M(n)&&N(n,U)&&N(n,is)&&N(n,Wv)&&N(n,dt)&&N(n,Gs)},new Q(null,1,5,R,[Gu],null),new Q(null,5,5,R,[oE,GF,kz,Xs,br],null),null,new Q(null,5,5,R,[U,is,Wv,dt,Gs],null),new Q(null,1,5,R,[gB],null),new Q(null,6,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,U)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,is)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Wv)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Gs))],null),null]))})),Z(Vw,O(hq,ay),eT(ay,ay,new n(null,4,[Zn,null,NC,function(n){return Qf(n)},sy,!0,NH,O(hq,ay)],null),null)),Z(uv,Wx,Wx),yT.v(null,Bv,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,2,5,R,[Vw,uv],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[Vw,uv],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Tn)},function(n){return N(n,ko)}],null),function(n){return M(n)&&N(n,Tn)&&N(n,ko)},I,new Q(null,2,5,R,[Vw,uv],null),null,new Q(null,2,5,R,[Tn,ko],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Tn)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,ko))],null),null]))],null),null)})),yT.v(null,du,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,1,5,R,[kC],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,1,5,R,[kC],null),null,null,new Q(null,2,5,R,[function(n){return M(n)},function(n){return N(n,Dt)}],null),function(n){return M(n)&&N(n,Dt)},I,new Q(null,1,5,R,[kC],null),null,new Q(null,1,5,R,[Dt],null),I,new Q(null,2,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt))],null),null]))],null),null)})),Z($m,JA,JA),Z(kC,Bp,Bp),yT.v(null,on,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[$m,kC,Xy],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[$m,kC,Xy],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Vp)},function(n){return N(n,Dt)},function(n){return N(n,yw)}],null),function(n){return M(n)&&N(n,Vp)&&N(n,Dt)&&N(n,yw)},I,new Q(null,3,5,R,[$m,kC,Xy],null),null,new Q(null,3,5,R,[Vp,Dt,yw],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Vp)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yw))],null),null]))],null),null)})),yT.v(null,ly,(function(){return cT(new Q(null,2,5,R,[tv,O(wt,ir,new Q(null,2,5,R,[kC,LI],null))],null),new Q(null,2,5,R,[tv,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,2,5,R,[kC,LI],null),null,null,new Q(null,3,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,yn)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,yn)},I,new Q(null,2,5,R,[kC,LI],null),null,new Q(null,2,5,R,[Dt,yn],null),I,new Q(null,3,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,yn))],null),null]))],null),null)})),Z(Up,JA,JA),yT.v(null,PB,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[Up,kC,UF],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[Up,kC,UF],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,CE)},function(n){return N(n,Dt)},function(n){return N(n,oo)}],null),function(n){return M(n)&&N(n,CE)&&N(n,Dt)&&N(n,oo)},I,new Q(null,3,5,R,[Up,kC,UF],null),null,new Q(null,3,5,R,[CE,Dt,oo],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,CE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,oo))],null),null]))],null),null)})),yT.v(null,KE,(function(){return cT(new Q(null,2,5,R,[rs,O(wt,ir,new Q(null,3,5,R,[kC,sB,qq],null))],null),new Q(null,2,5,R,[rs,US(Xj([ir,iA,TE,Wt,ot,hx,CG,Lu,QI,JF,GE,jJ],[new Q(null,3,5,R,[kC,sB,qq],null),null,null,new Q(null,4,5,R,[function(n){return M(n)},function(n){return N(n,Dt)},function(n){return N(n,uE)},function(n){return N(n,kJ)}],null),function(n){return M(n)&&N(n,Dt)&&N(n,uE)&&N(n,kJ)},I,new Q(null,3,5,R,[kC,sB,qq],null),null,new Q(null,3,5,R,[Dt,uE,kJ],null),I,new Q(null,4,5,R,[O(W,new Q(null,1,5,R,[V],null),O(Hq,V)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,Dt)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,uE)),O(W,new Q(null,1,5,R,[V],null),O(jG,V,kJ))],null),null]))],null),null)}));var J3=Jh($2,"global"),K3=Jh(j3,"global"),L3=Jh(m3,"global"),M3=Jh(e3,"global"),N3=Jh(p3,"global"),O3=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Ia,"handle-request"),(function(n,e,t){return U.a(t)}),i,n,e,t,r)}();function P3(n,e,t,r,i){var o=null!=i&&(64&i.h||h===i.D)?fh(qk,i):i,l=x.b(o,lz);o=x.b(o,Xv);try{return O3.la(r,l,o,n,e,t)}catch(n){if(n instanceof Error){var u=n;return p(km(u))||AY(IA,Ia,432,new xl((function(){return new Q(null,3,5,R,[u,"Error processing message",i],null)})),1026914181),new Q(null,2,5,R,[r,new Q(null,1,5,R,[xL.K("global",l,is.b(o,-1),ow.a(o),jL(u,"global.errors.failure"))],null)],null)}throw n}}function Q3(e){this.Pe=new n(null,1,[tn,"127.0.0.1"],null),this.Zf=e,this.configuration=null}function R3(n,e){return kg((function(n,t,r){return!Tc(b0(r,x.b(e,t)))||bf(!1)}),!0,n)}function S3(n,e,t){var r=gd.c((function(n,r){return p(R3(TF.a(r),e))?p(c0(mi.b(r,new Q(null,2,5,R,[Ym,Lz],null)),t))?bf(!1):p(n)?n:c0(mi.b(r,new Q(null,2,5,R,[Ym,ty],null)),t):n}),null,CH.a(n));if(null!=r)return r;switch((n=lH.a(n))instanceof z?n.da:null){case"whitelist":return!0;case"blacklist":return!1;default:return!0}}function T3(n){if(null!=n&&null!=n.Cg)n=n.Cg(n);else{var e=T3[db(null==n?null:n)];if(null!=e)n=e.a?e.a(n):e.call(null,n);else{if(null==(e=T3._))throw Zc("Repository.start!",n);n=e.a?e.a(n):e.call(null,n)}}return n}function U3(n){if(null!=n&&null!=n.Dg)n.Dg(n);else{var e=U3[db(null==n?null:n)];if(null!=e)e.a?e.a(n):e.call(null,n);else{if(null==(e=U3._))throw Zc("Repository.stop!",n);e.a?e.a(n):e.call(null,n)}}}function V3(n,e){if(null!=n&&null!=n.Ag)n=n.Ag(n,e);else{var t=V3[db(null==n?null:n)];if(null!=t)n=t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=V3._))throw Zc("Repository.add!",n);n=t.b?t.b(n,e):t.call(null,n,e)}}return n}function W3(n,e){if(null!=n&&null!=n.Bg)n.Bg(n,e);else{var t=W3[db(null==n?null:n)];if(null!=t)t.b?t.b(n,e):t.call(null,n,e);else{if(null==(t=W3._))throw Zc("Repository.publish!",n);t.b?t.b(n,e):t.call(null,n,e)}}}function X3(n,e){if(null!=n&&null!=n.Eg)n=n.Eg(n,e,null);else{var t=X3[db(null==n?null:n)];if(null!=t)n=t.c?t.c(n,e,null):t.call(null,n,e,null);else{if(null==(t=X3._))throw Zc("RepositoryFactory.repository",n);n=t.c?t.c(n,e,null):t.call(null,n,e,null)}}return n}O3.v(null,BH,(function(n,e,t,r){return I3(n,e,t,r,er.a(n))})),O3.v(null,ds,(function(e,t,r){if(zL(t))t=D3(e,t,r);else{var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,ow),l=x.b(i,zo);i=x.b(i,eI),p(l=tL(e,l))?(o=J(e=RT(e,t,o,pD.a(r),null,i),0,null),J(e,1,null),t=HT(l,o,new n(null,3,[Hv,Zv,lz,t,Xv,K.c(r,U,xH)],null))):t=null}return t})),O3.v(null,bu,(function(e,t,r){if(zL(t)){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(i,is),l=x.b(i,ow);if(i=x.b(i,zo),p(JT.b(e,l))){var u=tL(e,i);e=p(u)?HT(u,e,new n(null,3,[Hv,Fs,lz,t,Xv,K.c(r,U,LF)],null)):new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K("global",t,o,l,mL("global.errors.invalid_domain",["Unable to leave missing domain ",q.a(i)].join("")))],null)],null)}else e=new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K("global",t,o,l,mL("global.errors.invalid_peer",["Unable to find peer with id ",q.a(l)].join("")))],null)],null)}else l=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,o=x.b(l,ow),l=x.b(l,zo),p(JT.b(e,o))?e=p(o=tL(e,l))?HT(o,e,new n(null,3,[Hv,Fs,lz,t,Xv,K.c(r,U,LF)],null)):null:e=null;return e})),O3.v(null,AC,(function(n,e,t,r,i,o){return G3(n,e,t,i,o)})),O3.v(null,QE,(function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;return t=x.b(r,sr),r=x.b(r,is),new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("global",e,r,null,iL("global.errors.authentication.failure",t))],null)],null)})),O3.v(null,DE,(function(e,t,r){var i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;return r=x.b(i,is),i=x.b(i,YB),new Q(null,2,5,R,[e,new Q(null,1,5,R,[uL(t,new n(null,4,[tq,"global",U,PC,is,r,YB,i],null))],null)],null)})),O3.v(null,Pu,(function(n,e,t){return K3(n,e,t)})),O3.v(null,pJ,(function(n,e,t){return J3(n,e,t)})),O3.v(null,Qw,(function(n,e,t){return M3(n,e,t)})),O3.v(null,bx,(function(n,e,t){return N3(n,e,t)})),O3.v(null,Tt,(function(n,e,t){return L3(n,e,t)})),O3.v(null,cJ,(function(n){return new Q(null,1,5,R,[n],null)})),O3.v(null,Nz,(function(n,e,t){return H3(n,e,t)})),O3.v(null,to,(function(e,t,r,i,o){i=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,r=x.b(i,is);var l=KT(e,i=x.b(i,ow)),u=R,s=R;n:{var a=q_;o=1e3*mi.c(o,new Q(null,2,5,R,[YB,ew],null),0),q_=0<o?o:q_;try{var c=pD.a(l),d=TK()+q_,f=new n(null,2,[U,YB,dt,dt.a(c)],null),g=p(d)?K.c(f,bD,d):f,w=p_(g,pn.a(e));break n}finally{q_=a}w=void 0}return new Q(null,2,5,u,[e,new Q(null,1,5,s,[uL(t,new n(null,5,[tq,"global",U,$p,is,r,ow,i,$p,w],null))],null)],null)})),O3.v(null,em,(function(n,e,t){return AY(IA,Ia,416,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),-1372641111),new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("global",e,is.b(t,-1),ow.a(t),mL("global.errors.unhandled_message",["Unhandled message ",q.a(t)].join("")))],null)],null)})),Q3.prototype.Yc=function(){return new n(null,3,[$v,"global",Rn,"",Ln,1],null)},Q3.prototype.Zc=function(n,e){return e},Q3.prototype.Wc=function(n,e){return e},Q3.prototype.Xc=function(n,e,t){return P3(this.Zf,this.configuration,this.Pe,e,t)};var Y3=new Bk(null,new n(null,3,[lJ,null,Zq,null,jp,null],null),null);function Z3(n){var e=Eh((function(e){return!N(n,e)&&e}),Y3);p(e)&&kL("metrics.errors.bad_identity",["Repository is missing required ",q.a(e)," property"].join(""))}function $3(e,t,r){var i=cy.a(r);return p(i)?t=i:t=p(t=Z4(Rs.a(t),tn.a(e)))?t:"127.0.0.1",new n(null,6,[cy,t,Sn,Sn.a(e),No,(new Date).getTime(),Vz,Vz.a(e),Zq,Zq.a(r),lJ,Mr.a(r)],null)}function a4(n,e){var t=qJ.a(e);if(B(e=mi.b(e,new Q(null,2,5,R,[nE,vz],null)))){AY(sD,Na,72,new xl((function(){return new Q(null,2,5,R,["stopping metrics publishing for peer",t],null)})),-295205215),e=B(e);for(var r=null,i=0,o=0;;)if(o<i){U3(r.W(null,o)),o+=1}else{if(!(e=B(e)))break;Wf(r=e)?(e=re(r),o=se(r),r=e,i=F(e),e=o):(U3(e=C(r)),e=D(r),r=null,i=0),o=0}}return pL(n,t,nE)}function b4(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is);return n=a4(n,KT(n,r=x.b(r,ow)),lL(t)),new Q(null,2,5,R,[n,new Q(null,1,5,R,[yL.A("metrics",e,i,r)],null)],null)}function c4(n){return kg((function(n,e,t){return K.c(n,e,d4.a?d4.a(t):d4.call(null,t))}),S,n)}function d4(n){return kg((function(n,e,t){return e=Kg.a(e),K.c(n,e,A.b(e,Mt)?c4(t):t)}),S,n)}function e4(n,e,t){var r=mi.b(t,new Q(null,2,5,R,[nE,vz],null));if(p(r))return new Q(null,2,5,R,[n,r],null);r=qJ.a(t);var i=mi.b(t,new Q(null,2,5,R,[nE,jB],null));return e=Vk(Wh.b((function(n){return T3(X3(n,i))}),e)),new Q(null,2,5,R,[ni(n,new Q(null,4,5,R,[Dn,r,nE,vz],null),e),e],null)}function f4(n,e,t,r){var i=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;e=x.b(i,ow),i=x.b(i,Ym);var o=KT(n,e),l=mi.b(o,new Q(null,2,5,R,[nE,jB],null)),u=fi.b((function(n){return S3(r,l,yw.a(n))}),Wh.b(d4,i));return B(u)?(AY(AG,Na,130,new xl((function(){return new Q(null,4,5,R,["publisher",l,"adding metrics",Wh.b(yw,u)],null)})),72937979),n=J(t=e4(n,t,o),0,null),B(t=J(t,1,null))?new Q(null,2,5,R,[ni(n,new Q(null,4,5,R,[Dn,e,nE,vz],null),Vk(Wh.b((function(n){return V3(n,u)}),t))),null],null):null):null}function g4(n,e,t){var r=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e;e=x.b(r,ow),r=x.b(r,nA),e=KT(n,e);var i=mi.b(e,new Q(null,2,5,R,[nE,jB],null));if(!B(n=fi.b((function(n){return S3(t,i,yw.a(n))}),Wh.b(bL,r))))return null;if(!p(e=mi.b(e,new Q(null,2,5,R,[nE,vz],null))))return null;e=B(e),r=null;for(var o=0,l=0;;)if(l<o){var u=r.W(null,l);W3(u,n),l+=1}else{if(!(e=B(e)))return null;Wf(r=e)?(e=re(r),o=se(r),r=e,u=F(e),e=o,o=u):(W3(u=C(r),n),e=D(r),r=null,o=0),l=0}}function h4(n,e){return AY(AG,Na,154,new xl((function(){return new Q(null,2,5,R,["removing source",e],null)})),405066030),n=gd.c((function(n,e){return a4(n,e)}),n,QT(n,e,nE)),new Q(null,2,5,R,[n,null],null)}var i4=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Na,"handle-request"),function(){function n(n,e,t,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return U.a(t)}return n.F=3,n.G=function(n){C(n),C(n=D(n));var e=C(n=D(n));return Re(n),U.a(e)},n.g=function(n,e,t){return U.a(t)},n}(),i,n,e,t,r)}();function j4(n){this.Pe=n,this.filters=this.Ah=null}function k4(){var n=l4;return AY(AG,Na,228,new xl((function(){return new Q(null,2,5,R,["initializing metrics domain with filters",null],null)})),895504579),new j4(n)}function m4(n,e){return AY(AG,Ga,53,new xl((function(){return new Q(null,2,5,R,["removing source",e],null)})),1712681111),n=gd.c((function(n,e){return pL(n,Fp.a(e),Gq)}),n,QT(n,e,Gq)),new Q(null,2,5,R,[n,null],null)}function n4(e){return ei((function(e){var t=J(e,0,null);return e=J(e,1,null),Wh.c((function(e,t){return new n(null,2,[WI,e,gJ,t],null)}),new $h(null,-1,t,null),e)}),G([Wh.b((function(n){return new Q(null,2,5,R,[n,mi.b(n,new Q(null,2,5,R,[Gq,qy],null))],null)}),e)]))}function o4(n,e,t){J(t,0,null);var r=null!=(t=J(t,1,null))&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,Zo);return n=p(r=x.b(r,mF))?Wk(r,n):A.b(i,n),p(n)?e=Tc(n=MH.a(t))||Tc(e)||A.b(n,e):e=n,e}function p4(n,e){var t=pD.a(e);return kg((function(n,e,r){return!!A.b(x.b(t,e),r)||bf(!1)}),!0,n)}function q4(e,r,i){var o=yn.a(r);if(p(o)){var l=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,u=x.b(l,Zo),s=x.b(l,zH),a=x.b(l,ow);l=x.b(l,wC);var c=Kh(o4,u,s);u=Jh(p4,CZ(l));var d=pD.a(i),f=new Uh(Dk);return i=gd.c((function(i,l){l=null!=l&&(64&l.h||h===l.D)?fh(qk,l):l;var u=x.b(l,WI),s=x.b(l,gJ);return l=lz.a(u),u=qJ.a(u),zL(l)?(s=C(s),l=uL(l,new n(null,6,[tq,"bus",U,OA,ow,u,fA,s,EB,d,yn,o],null))):A.b(a,u)?l=null:(l=Yp.a(l),N(t(f),l)?l=null:(f.Cc(null,Cf.b(f.zb(null),l)),l=wL(q0(dL(Mx.a(e)),a),new n(null,2,[U,Yp,Yp,l],null),r))),p(l)?Cf.b(i,l):i}),I,fi.b((function(n){return c(gJ.a(n))}),n4(fi.b(u,XT(e,Gq,i,!0))))),new Q(null,2,5,R,[e,i],null)}return null}function r4(e,t,r,i){var o=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,l=x.b(o,Zo),u=x.b(o,zH),s=x.b(o,is);o=x.b(o,ow);var a=lz.a(i),c=new Q(null,3,5,R,[Gq,qy,r],null);return u=new n(null,2,[Zo,l,MH,u],null),l=-1!=l.indexOf(">")||-1!=l.indexOf("*")?K.c(u,mF,Zk(RL(RL(RL(l,".","\\."),"*","[a-zA-Z_0-9]+"),">",".*"))):u,i=ni(i,c,l),new Q(null,2,5,R,[TT(e,o,i),zL(a)?new Q(null,2,5,R,[uL(a,new n(null,5,[tq,"bus",U,Gz,is,s,ow,o,fA,r],null)),vL(q0(dL(Mx.a(e)),o),K.c(t,fA,r))],null):null],null)}function s4(n,e,t){var r=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,i=x.b(r,is),o=x.b(r,ow),l=x.b(r,fA);return r=lz.a(t),t=oi.A(t,new Q(null,2,5,R,[Gq,qy],null),Hf,l),new Q(null,2,5,R,[TT(n,o,t),zL(r)?new Q(null,2,5,R,[yL.A("bus",r,i,o),vL(q0(dL(Mx.a(n)),o),e)],null):null],null)}i4.v(null,xH,function(){function n(n,t,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return e.call(this,n,t,r,o)}function e(n,e,t,r){r=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r;var i=x.b(r,uI),o=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(o,is),r=x.b(o,ow);var l=x.b(o,pD);return o=x.b(o,eI),i=wk.g(G([$3(i,e,l),bL(o),bL(l)])),p(qL(n,r,nE))||(Z3(i),n=ni(oL(n,r,nE,null),new Q(null,4,5,R,[Dn,r,nE,jB],null),i)),e=new Q(null,2,5,R,[n,new Q(null,1,5,R,[yL.A("metrics",e,t,r)],null)],null)}return n.F=3,n.G=function(n){return e(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},n.g=e,n}()),i4.v(null,LF,function(){function n(n,e,t,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return b4(n,e,t)}return n.F=3,n.G=function(n){var e=C(n),t=C(n=D(n)),r=C(n=D(n));return Re(n),b4(e,t,r)},n.g=function(n,e,t){return b4(n,e,t)},n}()),i4.v(null,Nz,function(){function n(n,e,t,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return h4(n,e)}return n.F=3,n.G=function(n){var e=C(n),t=C(n=D(n));return C(n=D(n)),Re(n),h4(e,t)},n.g=function(n,e){return h4(n,e)},n}()),i4.v(null,rE,function(){function n(n,t,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return e.call(this,n,t,r,o)}function e(n,e,t,r){return r=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,f4(n,t,x.b(r,kn),r=x.b(r,nr))}return n.F=3,n.G=function(n){var t=C(n);C(n=D(n));return e(t,0,C(n=D(n)),n=Re(n))},n.g=e,n}()),i4.v(null,wG,function(){function n(n,t,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return e.call(this,n,t,r,o)}function e(n,e,t,r){return e=null!=r&&(64&r.h||h===r.D)?fh(qk,r):r,g4(n,t,e=x.b(e,nr))}return n.F=3,n.G=function(n){return e(C(n),C(n=D(n)),C(n=D(n)),n=Re(n))},n.g=e,n}()),i4.v(null,em,function(){function n(n,t,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Qe(l,0,null)}return e.call(this,n,t,r,o)}function e(n,e,t){return AY(IA,Na,185,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),-1669920594),new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("metrics",e,is.b(t,-1),ow.a(t),mL("metrics.errors.unhandled_message",["Unhandled message ",q.a(t)].join("")))],null)],null)}return n.F=3,n.G=function(n){var t=C(n),r=C(n=D(n)),i=C(n=D(n));return n=Re(n),e(t,r,i)},n.g=e,n}()),j4.prototype.Yc=function(){return new n(null,3,[$v,"metrics",Rn,"",Ln,1],null)},j4.prototype.Zc=function(n,e){return e},j4.prototype.Wc=function(n,e){return gd.c((function(n,e){return a4(n,e)}),e,NT(e,nE))},j4.prototype.Xc=function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;n=x.b(r,lz),r=x.b(r,Xv);try{return i4.Xa(e,n,r,uI,this.Pe,kn,this.Ah,nr,this.filters)}catch(o){var i=o;return p(km(i))||AY(IA,Na,218,new xl((function(){return new Q(null,3,5,R,[i,"Error processing message",t],null)})),971732128),new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K("metrics",n,is.a(r),ow.a(r),jL(i,"metrics.errors.failure"))],null)],null)}};var t4=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Ga,"handle-request"),(function(n,e,t){return U.a(t)}),i,n,e,t,r)}();function u4(){}t4.v(null,xH,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);if(x.b(r,pD),r=x.b(r,os),p(qL(n,o,Gq)))n=new Q(null,2,5,R,[n,new Q(null,1,5,R,[yL.A("bus",e,i,o)],null)],null);else{r=oL(n,o,Gq,lS(r));var l=JT.b(r,o),u=R,s=R;e=yL.A("bus",e,i,o),n=q0(dL(Mx.a(n)),o),t=K.c(t,U,ds),n=new Q(null,2,5,u,[r,new Q(null,2,5,s,[e,vL(n,t=p(eI.a(l))?K.c(t,eI,eI.a(l)):t)],null)],null)}}else r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,t=x.b(r,ow),r=x.b(r,os),n=p(qL(n,t,Gq))?null:new Q(null,2,5,R,[oL(n,t,Gq,lS(r)),null],null);return n})),t4.v(null,LF,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=pL(n,r=x.b(r,ow),Gq);n=new Q(null,2,5,R,[o,new Q(null,2,5,R,[yL.A("bus",e,i,r),vL(q0(dL(Mx.a(n)),r),K.c(t,U,bu))],null)],null)}else e=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,e=x.b(e,ow),n=p(t=JT.b(n,e))?new Q(null,2,5,R,[pL(n,e,Gq),null],null):null;return n})),t4.v(null,wG,(function(n,e,t){return zL(e)?n=p(e=KT(n,e=ow.a(t)))?q4(n,t,e):null:(e=ow.a(t),n=p(e=JT.b(n,e))?q4(n,t,e):null),n})),t4.v(null,Nu,(function(n,e,t){if(zL(e)){var r=eL(Mx.a(n));e=J(r,0,null),r=J(r,1,null);var i=ow.a(t);i=LT(n,i,Gq),n=r4(K.c(n,Mx,e),t,r,i)}else r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,e=x.b(r,fA),r=x.b(r,ow),n=p(r=JT.c(n,r,Gq))?r4(n,t,e,r):null;return n})),t4.v(null,hH,(function(n,e,t){return zL(e)?n=s4(n,t,e=LT(n,ow.a(t),Gq)):n=p(e=JT.b(n,ow.a(t)))?s4(n,t,e):null,n})),t4.v(null,Nz,(function(n,e){return m4(n,e)})),t4.v(null,em,(function(n,e,t){return AY(IA,Ga,306,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),1841638886),new Q(null,2,5,R,[n,new Q(null,1,5,R,[xL.K("bus",e,is.b(t,-1),ow.a(t),mL("bus.errors.unhandled_message",["Unhandled message ",q.a(t)].join("")))],null)],null)})),u4.prototype.Yc=function(){return new n(null,3,[$v,"bus",Rn,"",Ln,1],null)},u4.prototype.Zc=function(n,e){return e},u4.prototype.Wc=function(n,e){return e},u4.prototype.Xc=function(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;n=x.b(r,lz),r=x.b(r,Xv);try{return t4.c(e,n,r)}catch(o){var i=o;return p(km(i))||AY(IA,Ga,342,new xl((function(){return new Q(null,3,5,R,[i,"Error processing message",t],null)})),-2096053543),new Q(null,2,5,R,[e,new Q(null,1,5,R,[xL.K("bus",n,is.a(r),ow.a(r),jL(i,"bus.errors.failure"))],null)],null)}},O2("context");var v4=iL("context.peer-removed","Peer has been removed"),w4=Jh(yL,"context"),x4=Jh(xL,"context"),y4=Jh($2,"context"),z4=Jh(j3,"context"),A4=Jh(m3,"context"),B4=Jh(e3,"context"),C4=Jh(p3,"context"),D4=Jh((function(n,e,t,r,i){var o=Jh(n3,n);return n=J(e=ZT(n,ct,e,t,r,i),0,null),e=J(e,1,null),e=fi.b(Jh(r3,n),e),n=J(e=new Q(null,2,5,R,[n,e],null),0,null),e=J(e,1,null),t=J(o=o(n,t),0,null),o=J(o,1,null),new Q(null,2,5,R,[p(t)?t:n,$f(o)||Vf(o)?gd.c(Mh(Cf,I),e,o):null!=o?Mh(Cf,I)(e,o):e],null)}),"context");function E4(n,e,t,r){var i,o=LT(n,t,ct),l=(i=fi.b(Jh(r3,n),YT("context",ct,n,e,o)),p(r)?gi.b((function(n){return A.b(t,dB.a(Xv.a(n)))}),i):i);return Ni(Xg.b(l,Tc(r)?q3(W2(o),n,o):Se))}function F4(n,e,t,r,i){var o,l=lS(r);return o=oL(n,t,ct,l),r=p(i)?UT(o,t,(function(n){return UK(n,new Q(null,2,5,R,[eI,pu],null))})):o,new Q(null,2,5,R,[r,E4(r,e,t,i)],null)}function G4(n,e,t){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is),o=x.b(r,ow);x.b(r,pD),r=x.b(r,os);var l,u=mi.b(t,new Q(null,2,5,R,[eI,pu],null)),s=null==(l=null==(l=JT.b(n,o))?null:eI.a(l))?null:pu.a(l),a=qL(n,o,ct);if(p(p(a)?Tc(s):a))return new Q(null,2,5,R,[n,new Q(null,1,5,R,[w4(e,i,o)],null)],null);s=J(r=F4(n,e,o,r,p(a)?s:a),0,null);var c=J(r,1,null),d=JT.b(s,o);return new Q(null,2,5,R,[s,function(){var r,l=Cf.b(c,vL(q0(dL(Mx.a(n)),o),(r=K.c(t,U,ds),p(eI.a(d))?K.c(r,eI,eI.a(d)):r)));return Tc(u)?Cf.b(l,w4(e,i,o)):l}()],null)}function H4(e,t){AY(AG,Ha,124,new xl((function(){return new Q(null,1,5,R,["removing source from the context domain"],null)})),649478531),t=Ch(QT(e,t,ct)),e=og(Wh.a(qJ),mg((function(n,e){return pL(n,e,ct)}),lg),e,t);var r=new n(null,6,[is,null,tq,"global",U,bu,zo,"context",uE,v4.uri,kJ,v4.message],null);return e=gd.c((function(n,e){var t=J(n,0,null);n=J(n,1,null);var i=D4(t,e,v4,!0),o=J(i,0,null);return i=J(i,1,null),t=J(n=new Q(null,2,5,R,[p(o)?o:t,$f(i)||Vf(i)?gd.c(Mh(Cf,I),n,i):null!=i?Mh(Cf,I)(n,i):n],null),0,null),n=J(n,1,null),e=J(o=new Q(null,2,5,R,[t,vL(q0(dL(Mx.a(t)),qJ.a(e)),K.c(r,ow,qJ.a(e)))],null),0,null),o=J(o,1,null),new Q(null,2,5,R,[p(e)?e:t,$f(o)||Vf(o)?gd.c(Mh(Cf,I),n,o):null!=o?Mh(Cf,I)(n,o):n],null)}),new Q(null,2,5,R,[e,null],null),t),AY(AG,Ha,144,new xl((function(){return new Q(null,1,5,R,["removed source from context domain"],null)})),-323325377),e}var I4=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(Ha,"handle-request"),(function(n,e,t){return U.a(t)}),i,n,e,t,r)}();function J4(n,e){var t=null!=e&&(64&e.h||h===e.D)?fh(qk,e):e,r=x.b(t,lz);t=x.b(t,Xv);try{return I4.c(n,r,t)}catch(o){var i=o;return p(km(i))||AY(IA,Ha,226,new xl((function(){return new Q(null,3,5,R,[i,"Error handling request",e],null)})),1720562813),zL(r)?new Q(null,2,5,R,[n,new Q(null,1,5,R,[x4(r,is.a(t),ow.a(t),jL(i,"context.errors.failure"))],null)],null):null}}function K4(){}I4.v(null,xH,(function(n,e,t){if(zL(e))n=G4(n,e,t);else{var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t;t=x.b(r,ow),x.b(r,pD),r=x.b(r,os);var i=JT.b(n,t);n=p(!!Tc(i=null==(i=null==i?null:eI.a(i))?null:pu.a(i))&&qL(n,t,ct))?null:F4(n,e,t,r,i)}return n})),I4.v(null,LF,(function(n,e,t){if(zL(e)){var r=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,i=x.b(r,is);r=x.b(r,ow);var o=D4(n,KT(n,r),lL(t),!1),l=J(o,0,null);o=J(o,1,null),n=new Q(null,2,5,R,[l,Cf.g(o,w4(e,i,r),G([vL(q0(dL(Mx.a(n)),r),K.c(t,U,bu))]))],null)}else e=null!=t&&(64&t.h||h===t.D)?fh(qk,t):t,e=x.b(e,ow),n=p(e=JT.b(n,e))?D4(n,e,lL(t),!1):null;return n})),I4.v(null,Pu,(function(n,e,t){return z4(n,e,t)})),I4.v(null,pJ,(function(n,e,t){return y4(n,e,t)})),I4.v(null,Qw,(function(n,e,t){return B4(n,e,t)})),I4.v(null,bx,(function(n,e,t){return C4(n,e,t)})),I4.v(null,Tt,(function(n,e,t){return A4(n,e,t)})),I4.v(null,Nz,(function(n,e){return H4(n,e)})),I4.v(null,em,(function(n,e,t){return AY(IA,Ha,209,new xl((function(){return new Q(null,2,5,R,["Unhandled message",t],null)})),1383824357),new Q(null,2,5,R,[n,new Q(null,1,5,R,[x4(e,is.b(t,-1),ow.a(t),mL([q.a("context"),".errors.unhandled_message"].join(""),["Unhandled message ",q.a(t)].join("")))],null)],null)})),K4.prototype.Yc=function(){return new n(null,3,[$v,"context",Rn,"",Ln,2],null)},K4.prototype.Zc=function(n,e){return e},K4.prototype.Wc=function(n,e){return e},K4.prototype.Xc=function(n,e,t){return J4(e,t)};var L4=function(){var n=Oh(S),e=Oh(S),t=Oh(S),r=Oh(S),i=x.c(S,ku,Ql.o?Ql.o():Ql.call(null));return new dm(Me.b(la,"authenticate"),(function(n){return mi.b(n,new Q(null,2,5,R,[YB,Ts],null))}),i,n,e,t,r)}();function M4(n,e){this.Gh=n,this.Ih=e}function N4(n,e){return new M4(n,e)}function O4(){var n=S;return AY(sD,la,57,new xl((function(){return new Q(null,2,5,R,["creating basic authenticator with configuration",n],null)})),617112893),I_(n,N4(cL(),1e3*Rq.b(n,6e4)))}L4.v(null,"secret",(function(e,t,r){return mZ(tZ(e),(function(e){var i=p_(new n(null,2,[dt,dt.a(e),bD,TK()+r],null),t);return K.c(e,Gu,i)}))})),L4.v(null,"access-token",(function(e,t){try{var r=mi.b(e,new Q(null,2,5,R,[YB,$p],null)),i=dt.a(o_.c(r,t,new n(null,1,[WD,TK()],null)));return jZ.resolve(new n(null,4,[U,qz,Gs,i,dt,i,Gu,r],null))}catch(e){var o=e;return AY(AG,la,37,new xl((function(){return new Q(null,2,5,R,[o,"Error processing access token authentication request"],null)})),-2143320436),jZ.reject(im(lm(o),new n(null,2,[U,lC,sr,["Invalid or expired token: ",q.a(lm(o))].join("")],null)))}})),L4.v(null,em,(function(e){e=mi.b(e,new Q(null,2,5,R,[YB,Ts],null));var t=["Unknown authentication method ",q.a(e)].join("");return AY(AG,la,44,new xl((function(){return new Q(null,1,5,R,[t],null)})),-1961658750),jZ.reject(im(t,new n(null,2,[U,lC,sr,t],null)))})),M4.prototype.Re=function(n,e){return L4.c(e,this.Gh,this.Ih)};var P4={},Q4={},z5;!function(n){nY((function(e){return K.c(e,cn,n)}))}(sD);var l4=new n(null,1,[No,(new Date).getTime()],null);function S4(e){return new n(null,6,[Ju,!0,tB,!1,GI,null,eC,null,vr,dx,qI,function(n){return n={time:BC.a(n),level:Lg(cn.a(n)),namespace:uq.a(n),file:Pv.a(n),line:iF.a(n),stacktrace:eB.a(n),message:Bl(fx.a(n)),output:Bl(Qx.a(n))},e.a?e.a(n):e.call(null,n)}],null)}function T4(e){return p(e=mi.b(e,new Q(null,2,5,R,[YB,my],null)))?(AY(sD,ha,65,new xl((function(){return new Q(null,1,5,R,["will be using custom JS authenticator"],null)})),1345826046),new n(null,2,[em,ED,rw,new n(null,1,[ED,I_(S,new J_(e))],null)],null)):new n(null,2,[em,ED,rw,new n(null,1,[ED,O4()],null)],null)}tb("gateway_web.core.configure_logging",(function(e){e=Ml(e,G([Nl,!0]));var t=new n(null,2,[cn,sD,HG,new n(null,1,[VI,hY.a?hY.a(S):hY.call(null,S)],null)],null);return t=p(cn.a(e))?K.c(t,cn,Kg.a(cn.a(e))):t,t=p(ty.a(e))?K.c(t,Kw,ty.a(e)):t,t=p(Lz.a(e))?K.c(t,un,Lz.a(e)):t,oY(e=p(Cw.a(e))?ni(t,new Q(null,2,5,R,[HG,VI],null),S4(Cw.a(e))):t)}));var U4=function n(e,r,i,o,l){return p(p(u=t(e))?0<l:u)?(QY(i,o,(new Date).getTime()-1e3*l),Rh.b(r,(function(){return fZ((function(){return n.K?n.K(e,r,i,o,l):n.call(null,e,r,i,o,l)}))}))):null;var u};function V4(n){var e=Yx.a(t(n));AY(sD,ha,82,new xl((function(){return new Q(null,2,5,R,["starting gateway with configuration",e],null)})),-1715714573),Rh.b(n,(function(n){var t=T4(e),r=new Q(null,6,5,R,[new l1,new A3,new Q3(t),new u4,new K4,k4()],null);r=S_(r);var i=Oh(S),o=Oh(null),l=Oh(!0),u=mi.c(e,new Q(null,2,5,R,[kE,FD],null),60);return 0<u&&(AY(sD,ha,97,new xl((function(){return new Q(null,3,5,R,["clients inactive for",u,"will be scavenged"],null)})),811655706),U4(l,o,i,r,u)),K.g(n,JH,l,G([iq,t,Yp,r,kE,i,QA,o]))}))}function W4(e){AY(sD,ha,115,new xl((function(){return new Q(null,1,5,R,["stopping gateway"],null)})),661929129),Rh.b(e,(function(e){Rh.b(JH.a(e),Hh(!1));var r=QA.a(e);if(null!=(r=null==r?null:t(r))&&$Y(r),null!=(r=Yp.a(e))&&CY(r),null!=(r=iq.a(e)))n:{r=B(nj(rw.a(r)));for(var i=null,o=0,l=0;;)if(l<o){var u=i.W(null,l);sZ(u),l+=1}else{if(!(r=B(r)))break n;Wf(i=r)?(r=re(i),o=se(i),i=r,u=F(r),r=o,o=u):(sZ(u=C(i)),r=D(i),i=null,o=0),l=0}}return new n(null,1,[Yx,Yx.a(e)],null)}))}tb("gateway_web.core.create",(function(e){var t=Oh(new n(null,1,[Yx,hO(Ll(e))],null));return void 0!==P4&&void 0!==Q4&&void 0!==z5||((z5=function(n,e,t){this.rg=n,this.qd=e,this.gh=t,this.h=393216,this.I=0}).prototype.O=function(n,e){return new z5(this.rg,this.qd,e)},z5.prototype.N=function(){return this.gh},z5.prototype.start=function(){var n=this,e=this;return new Promise((function(t){return V4(n.qd),t.a?t.a(e):t.call(null,e)}))},z5.prototype.stop=function(){var n=this,e=this;return new Promise((function(t){return W4(n.qd),t.a?t.a(e):t.call(null,e)}))},z5.prototype.connect=function(n){return WY(this.qd,n)},z5.Pa=function(){return new Q(null,3,5,R,[op,hu,HK],null)},z5.Ia=!0,z5.Da="gateway-web.core/t_gateway_web$core15330",z5.Ja=function(n){return ce(n,"gateway-web.core/t_gateway_web$core15330")}),new z5(e,t,S)}))}).call(commonjsGlobal);const Glue42CoreMessageTypes={connectionRequest:{name:"connectionRequest"},connectionAccepted:{name:"connectionAccepted"},platformPing:{name:"platformPing"},platformReady:{name:"platformReady"},platformUnload:{name:"platformUnload"},clientUnload:{name:"clientUnload"}},GlueWebPlatformControlName$1$1="T42.Web.Platform.Control",GlueWebPlatformStreamName$1$1="T42.Web.Platform.Stream",GlueClientControlName$1$1="T42.Web.Client.Control",GlueWebPlatformWorkspacesStreamName="T42.Web.Platform.WSP.Stream",GlueWorkspaceFrameClientControlName="T42.Workspaces.Control",GlueWebIntentsPrefix="Tick42.FDC3.Intents.",ChannelContextPrefix="___channel___",dbName="glue42core",dbVersion=1;class Gateway{constructor(){this.configureLogging=window.gateway_web.core.configure_logging,this.create=window.gateway_web.core.create}start(n){return __awaiter$3(this,void 0,void 0,(function*(){(null==n?void 0:n.logging)&&this.configureLogging({level:n.logging.level,appender:n.logging.appender}),this._gatewayWebInstance=this.create({}),yield this._gatewayWebInstance.start()}))}connectClient(n,e){return __awaiter$3(this,void 0,void 0,(function*(){const t=yield this._gatewayWebInstance.connect(((e,t)=>n.postMessage(t)));n.onmessage=n=>{var r;const i=null===(r=n.data)||void 0===r?void 0:r.glue42core;if(i&&i.type===Glue42CoreMessageTypes.clientUnload.name)return e&&e(i.data.clientId),void t.disconnect();t.send(n.data)}}))}}var ok$1$1=function(n){return{ok:!0,result:n}},isOk$1$1=function(n){return!0===n.ok},err$1$1=function(n){return{ok:!1,error:n}},isErr$1$1=function(n){return!1===n.ok},asPromise$1$1=function(n){return!0===n.ok?Promise.resolve(n.result):Promise.reject(n.error)},withDefault$1$1=function(n,e){return!0===e.ok?e.result:n},withException$1$1=function(n){if(!0===n.ok)return n.result;throw n.error},successes$1$1=function(n){return n.reduce((function(n,e){return!0===e.ok?n.concat(e.result):n}),[])},map$1$1=function(n,e){return!0===e.ok?ok$1$1(n(e.result)):e},map2$1$1=function(n,e,t){return!1===e.ok?e:!1===t.ok?t:ok$1$1(n(e.result,t.result))},mapError$1$1=function(n,e){return!0===e.ok?e:err$1$1(n(e.error))},andThen$1$1=function(n,e){return!0===e.ok?n(e.result):e},result$1$1=Object.freeze({ok:ok$1$1,isOk:isOk$1$1,err:err$1$1,isErr:isErr$1$1,asPromise:asPromise$1$1,withDefault:withDefault$1$1,withException:withException$1$1,successes:successes$1$1,map:map$1$1,map2:map2$1$1,mapError:mapError$1$1,andThen:andThen$1$1}),__assign$2$1=function(){return(__assign$2$1=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __rest$2(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function isEqual$1$1(n,e){if(n===e)return!0;if(null===n&&null===e)return!0;if(typeof n!=typeof e)return!1;if("object"==typeof n){if(Array.isArray(n)){if(!Array.isArray(e))return!1;if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!isEqual$1$1(n[t],e[t]))return!1;return!0}var r=Object.keys(n);if(r.length!==Object.keys(e).length)return!1;for(t=0;t<r.length;t++){if(!e.hasOwnProperty(r[t]))return!1;if(!isEqual$1$1(n[r[t]],e[r[t]]))return!1}return!0}}var isJsonArray$1$1=function(n){return Array.isArray(n)},isJsonObject$1$1=function(n){return"object"==typeof n&&null!==n&&!isJsonArray$1$1(n)},typeString$1$1=function(n){switch(typeof n){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return n instanceof Array?"an array":null===n?"null":"an object";default:return JSON.stringify(n)}},expectedGot$1$1=function(n,e){return"expected "+n+", got "+typeString$1$1(e)},printPath$1$1=function(n){return n.map((function(n){return"string"==typeof n?"."+n:"["+n+"]"})).join("")},prependAt$1$1=function(n,e){var t=e.at,r=__rest$2(e,["at"]);return __assign$2$1({at:n+(t||"")},r)},Decoder$1$1=function(){function n(e){var t=this;this.decode=e,this.run=function(n){return mapError$1$1((function(e){return{kind:"DecoderError",input:n,at:"input"+(e.at||""),message:e.message||""}}),t.decode(n))},this.runPromise=function(n){return asPromise$1$1(t.run(n))},this.runWithException=function(n){return withException$1$1(t.run(n))},this.map=function(e){return new n((function(n){return map$1$1(e,t.decode(n))}))},this.andThen=function(e){return new n((function(n){return andThen$1$1((function(t){return e(t).decode(n)}),t.decode(n))}))},this.where=function(e,r){return t.andThen((function(t){return e(t)?n.succeed(t):n.fail(r)}))}}return n.string=function(){return new n((function(n){return"string"==typeof n?ok$1$1(n):err$1$1({message:expectedGot$1$1("a string",n)})}))},n.number=function(){return new n((function(n){return"number"==typeof n?ok$1$1(n):err$1$1({message:expectedGot$1$1("a number",n)})}))},n.boolean=function(){return new n((function(n){return"boolean"==typeof n?ok$1$1(n):err$1$1({message:expectedGot$1$1("a boolean",n)})}))},n.constant=function(e){return new n((function(n){return isEqual$1$1(n,e)?ok$1$1(e):err$1$1({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})}))},n.object=function(e){return new n((function(n){if(isJsonObject$1$1(n)&&e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r].decode(n[r]);if(!0!==i.ok)return void 0===n[r]?err$1$1({message:"the key '"+r+"' is required but was not present"}):err$1$1(prependAt$1$1("."+r,i.error));void 0!==i.result&&(t[r]=i.result)}return ok$1$1(t)}return isJsonObject$1$1(n)?ok$1$1(n):err$1$1({message:expectedGot$1$1("an object",n)})}))},n.array=function(e){return new n((function(n){if(isJsonArray$1$1(n)&&e){return n.reduce((function(n,t,r){return map2$1$1((function(n,e){return n.concat([e])}),n,function(n,t){return mapError$1$1((function(n){return prependAt$1$1("["+t+"]",n)}),e.decode(n))}(t,r))}),ok$1$1([]))}return isJsonArray$1$1(n)?ok$1$1(n):err$1$1({message:expectedGot$1$1("an array",n)})}))},n.tuple=function(e){return new n((function(n){if(isJsonArray$1$1(n)){if(n.length!==e.length)return err$1$1({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n[r]);if(!i.ok)return err$1$1(prependAt$1$1("["+r+"]",i.error));t[r]=i.result}return ok$1$1(t)}return err$1$1({message:expectedGot$1$1("a tuple of length "+e.length,n)})}))},n.union=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n.oneOf.apply(n,[e,t].concat(r))},n.intersection=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new n((function(n){return[e,t].concat(r).reduce((function(e,t){return map2$1$1(Object.assign,e,t.decode(n))}),ok$1$1({}))}))},n.anyJson=function(){return new n((function(n){return ok$1$1(n)}))},n.unknownJson=function(){return new n((function(n){return ok$1$1(n)}))},n.dict=function(e){return new n((function(n){if(isJsonObject$1$1(n)){var t={};for(var r in n)if(n.hasOwnProperty(r)){var i=e.decode(n[r]);if(!0!==i.ok)return err$1$1(prependAt$1$1("."+r,i.error));t[r]=i.result}return ok$1$1(t)}return err$1$1({message:expectedGot$1$1("an object",n)})}))},n.optional=function(e){return new n((function(n){return null==n?ok$1$1(void 0):e.decode(n)}))},n.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new n((function(n){for(var t=[],r=0;r<e.length;r++){var i=e[r].decode(n);if(!0===i.ok)return i;t[r]=i.error}var o=t.map((function(n){return"at error"+(n.at||"")+": "+n.message})).join('", "');return err$1$1({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},n.withDefault=function(e,t){return new n((function(n){return ok$1$1(withDefault$1$1(e,t.decode(n)))}))},n.valueAt=function(e,t){return new n((function(n){for(var r=n,i=0;i<e.length;i++){if(void 0===r)return err$1$1({at:printPath$1$1(e.slice(0,i+1)),message:"path does not exist"});if("string"==typeof e[i]&&!isJsonObject$1$1(r))return err$1$1({at:printPath$1$1(e.slice(0,i+1)),message:expectedGot$1$1("an object",r)});if("number"==typeof e[i]&&!isJsonArray$1$1(r))return err$1$1({at:printPath$1$1(e.slice(0,i+1)),message:expectedGot$1$1("an array",r)});r=r[e[i]]}return mapError$1$1((function(n){return void 0===r?{at:printPath$1$1(e),message:"path does not exist"}:prependAt$1$1(printPath$1$1(e),n)}),t.decode(r))}))},n.succeed=function(e){return new n((function(n){return ok$1$1(e)}))},n.fail=function(e){return new n((function(n){return err$1$1({message:e})}))},n.lazy=function(e){return new n((function(n){return e().decode(n)}))},n}(),string$1$1=Decoder$1$1.string,number$1$1=Decoder$1$1.number,boolean$1$1=Decoder$1$1.boolean,anyJson$1$1=Decoder$1$1.anyJson,constant$1$1=Decoder$1$1.constant,object$1$1=Decoder$1$1.object,array$1$1=Decoder$1$1.array,optional$1$1=Decoder$1$1.optional,oneOf$1$1=Decoder$1$1.oneOf,intersection=Decoder$1$1.intersection,fail=Decoder$1$1.fail,lazy$1$1=Decoder$1$1.lazy;const nonNegativeNumberDecoder$1$1=number$1$1().where((n=>n>=0),"Expected a non-negative number"),nonEmptyStringDecoder$1$1=string$1$1().where((n=>n.length>0),"Expected a non-empty string"),windowRelativeDirectionDecoder$1$1=oneOf$1$1(constant$1$1("top"),constant$1$1("left"),constant$1$1("right"),constant$1$1("bottom")),logLevelDecoder=oneOf$1$1(constant$1$1("trace"),constant$1$1("debug"),constant$1$1("info"),constant$1$1("warn"),constant$1$1("error")),channelMetaDecoder=anyJson$1$1().where((n=>"string"==typeof n.color&&n.color.length>0),"Expected color to be a non-empty string"),layoutTypeDecoder$1$1=oneOf$1$1(constant$1$1("Global"),constant$1$1("Activity"),constant$1$1("ApplicationDefault"),constant$1$1("Swimlane"),constant$1$1("Workspace")),componentTypeDecoder$1$1=oneOf$1$1(constant$1$1("application"),constant$1$1("activity")),functionCheck=(n,e)=>{const t=typeof n;return"function"===t?anyJson$1$1():fail(`The provided argument as ${e} should be of type function, provided: ${typeof t}`)},layoutSummaryDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,type:layoutTypeDecoder$1$1,context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1())}),windowLayoutComponentDecoder$1$1=object$1$1({type:constant$1$1("window"),componentType:componentTypeDecoder$1$1,state:object$1$1({name:anyJson$1$1(),context:anyJson$1$1(),url:nonEmptyStringDecoder$1$1,bounds:anyJson$1$1(),id:nonEmptyStringDecoder$1$1,parentId:optional$1$1(nonEmptyStringDecoder$1$1),main:boolean$1$1()})}),libDomainDecoder$1$1=oneOf$1$1(constant$1$1("windows"),constant$1$1("appManager"),constant$1$1("layouts"),constant$1$1("workspaces"),constant$1$1("intents")),windowLayoutItemDecoder$1$1=object$1$1({type:constant$1$1("window"),config:object$1$1({appName:nonEmptyStringDecoder$1$1,url:optional$1$1(nonEmptyStringDecoder$1$1)})}),groupLayoutItemDecoder$1$1=object$1$1({type:constant$1$1("group"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(windowLayoutItemDecoder$1$1))}),columnLayoutItemDecoder$1$1=object$1$1({type:constant$1$1("column"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(groupLayoutItemDecoder$1$1,windowLayoutItemDecoder$1$1,lazy$1$1((()=>columnLayoutItemDecoder$1$1)),lazy$1$1((()=>rowLayoutItemDecoder$1$1))))}),rowLayoutItemDecoder$1$1=object$1$1({type:constant$1$1("row"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(columnLayoutItemDecoder$1$1,groupLayoutItemDecoder$1$1,windowLayoutItemDecoder$1$1,lazy$1$1((()=>rowLayoutItemDecoder$1$1))))}),workspaceLayoutComponentDecoder$1$1=object$1$1({type:constant$1$1("Workspace"),state:object$1$1({config:anyJson$1$1(),context:anyJson$1$1(),children:array$1$1(oneOf$1$1(rowLayoutItemDecoder$1$1,columnLayoutItemDecoder$1$1,groupLayoutItemDecoder$1$1,windowLayoutItemDecoder$1$1))})}),glueLayoutDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,type:layoutTypeDecoder$1$1,components:array$1$1(oneOf$1$1(windowLayoutComponentDecoder$1$1,workspaceLayoutComponentDecoder$1$1)),context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1())}),applicationDetailsDecoder$1$1=object$1$1({url:nonEmptyStringDecoder$1$1,top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1)}),intentDefinitionDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,displayName:optional$1$1(string$1$1()),contexts:optional$1$1(array$1$1(string$1$1())),customConfig:optional$1$1(object$1$1())}),glueCoreAppDefinitionDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,title:optional$1$1(nonEmptyStringDecoder$1$1),version:optional$1$1(nonEmptyStringDecoder$1$1),customProperties:optional$1$1(anyJson$1$1()),icon:optional$1$1(nonEmptyStringDecoder$1$1),caption:optional$1$1(nonEmptyStringDecoder$1$1),details:applicationDetailsDecoder$1$1,intents:optional$1$1(array$1$1(intentDefinitionDecoder$1$1))}),fdc3AppDefinitionDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,title:optional$1$1(nonEmptyStringDecoder$1$1),version:optional$1$1(nonEmptyStringDecoder$1$1),appId:nonEmptyStringDecoder$1$1,manifest:nonEmptyStringDecoder$1$1,manifestType:nonEmptyStringDecoder$1$1,tooltip:optional$1$1(nonEmptyStringDecoder$1$1),description:optional$1$1(nonEmptyStringDecoder$1$1),contactEmail:optional$1$1(nonEmptyStringDecoder$1$1),supportEmail:optional$1$1(nonEmptyStringDecoder$1$1),publisher:optional$1$1(nonEmptyStringDecoder$1$1),images:optional$1$1(array$1$1(object$1$1({url:optional$1$1(nonEmptyStringDecoder$1$1)}))),icons:optional$1$1(array$1$1(object$1$1({icon:optional$1$1(nonEmptyStringDecoder$1$1)}))),customConfig:anyJson$1$1(),intents:optional$1$1(array$1$1(intentDefinitionDecoder$1$1))}),remoteStoreDecoder=object$1$1({url:nonEmptyStringDecoder$1$1,pollingInterval:optional$1$1(nonNegativeNumberDecoder$1$1),requestTimeout:optional$1$1(nonNegativeNumberDecoder$1$1)}),supplierDecoder=object$1$1({fetch:anyJson$1$1().andThen((n=>functionCheck(n,"supplier fetch"))),timeout:optional$1$1(nonNegativeNumberDecoder$1$1),pollingInterval:optional$1$1(nonNegativeNumberDecoder$1$1),save:optional$1$1(anyJson$1$1().andThen((n=>functionCheck(n,"supplier save")))),delete:optional$1$1(anyJson$1$1().andThen((n=>functionCheck(n,"supplier delete"))))}),channelDefinitionDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,meta:channelMetaDecoder,data:optional$1$1(anyJson$1$1())}),pluginDefinitionDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,start:anyJson$1$1(),config:anyJson$1$1()}),allApplicationDefinitionsDecoder=oneOf$1$1(glueCoreAppDefinitionDecoder,fdc3AppDefinitionDecoder),appsCollectionDecoder=array$1$1(allApplicationDefinitionsDecoder),applicationsConfigDecoder=object$1$1({local:optional$1$1(array$1$1(allApplicationDefinitionsDecoder))}),layoutsConfigDecoder=object$1$1({mode:oneOf$1$1(constant$1$1("idb"),constant$1$1("session")),local:optional$1$1(array$1$1(glueLayoutDecoder$1$1))}),channelsConfigDecoder=object$1$1({definitions:array$1$1(channelDefinitionDecoder)}),pluginsConfigDecoder=object$1$1({definitions:array$1$1(pluginDefinitionDecoder)}),gatewayConfigDecoder=object$1$1({logging:optional$1$1(object$1$1({level:optional$1$1(logLevelDecoder),appender:optional$1$1(anyJson$1$1().andThen((n=>functionCheck(n,"gateway log appender"))))}))}),glueConfigDecoder=anyJson$1$1(),workspacesConfigDecoder=object$1$1({src:nonEmptyStringDecoder$1$1}),windowsConfigDecoder=object$1$1({windowResponseTimeoutMs:optional$1$1(nonNegativeNumberDecoder$1$1),defaultWindowOpenBounds:optional$1$1(object$1$1({top:number$1$1(),left:number$1$1(),width:nonNegativeNumberDecoder$1$1,height:nonNegativeNumberDecoder$1$1}))}),platformConfigDecoder=object$1$1({windows:optional$1$1(windowsConfigDecoder),applications:optional$1$1(applicationsConfigDecoder),layouts:optional$1$1(layoutsConfigDecoder),channels:optional$1$1(channelsConfigDecoder),plugins:optional$1$1(pluginsConfigDecoder),gateway:optional$1$1(gatewayConfigDecoder),glue:optional$1$1(glueConfigDecoder),workspaces:optional$1$1(workspacesConfigDecoder),glueFactory:optional$1$1(anyJson$1$1().andThen((n=>functionCheck(n,"glueFactory"))))}),windowOpenSettingsDecoder$1$1=object$1$1({top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1),context:optional$1$1(anyJson$1$1()),relativeTo:optional$1$1(nonEmptyStringDecoder$1$1),relativeDirection:optional$1$1(windowRelativeDirectionDecoder$1$1)});class PlatformLogger{setLogger(n){this._logger=n}get(n){if(this._logger)return this._logger.subLogger(n)}}var logger=new PlatformLogger,seed$1$1=1;function getNextValue$1$1(){return(seed$1$1=(9301*seed$1$1+49297)%233280)/233280}function setSeed$2$1(n){seed$1$1=n}var randomFromSeed$1$1={nextValue:getNextValue$1$1,seed:setSeed$2$1},ORIGINAL$1$1="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$1$1,previousSeed$1$1,shuffled$1$1;function reset$1$1(){shuffled$1$1=!1}function setCharacters$1$1(n){if(n){if(n!==alphabet$1$1){if(n.length!==ORIGINAL$1$1.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1$1.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1$1.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet$1$1=n,reset$1$1()}}else alphabet$1$1!==ORIGINAL$1$1&&(alphabet$1$1=ORIGINAL$1$1,reset$1$1())}function characters$1$1(n){return setCharacters$1$1(n),alphabet$1$1}function setSeed$3$1(n){randomFromSeed$1$1.seed(n),previousSeed$1$1!==n&&(reset$1$1(),previousSeed$1$1=n)}function shuffle$1$1(){alphabet$1$1||setCharacters$1$1(ORIGINAL$1$1);for(var n,e=alphabet$1$1.split(""),t=[],r=randomFromSeed$1$1.nextValue();e.length>0;)r=randomFromSeed$1$1.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled$1$1(){return shuffled$1$1||(shuffled$1$1=shuffle$1$1())}function lookup$1$1(n){return getShuffled$1$1()[n]}function get(){return alphabet$1$1||ORIGINAL$1$1}var alphabet_1$1$1={get:get,characters:characters$1$1,seed:setSeed$3$1,lookup:lookup$1$1,shuffled:getShuffled$1$1},crypto$1$1="object"==typeof window&&(window.crypto||window.msCrypto),randomByte$1$1;randomByte$1$1=crypto$1$1&&crypto$1$1.getRandomValues?function(n){return crypto$1$1.getRandomValues(new Uint8Array(n))}:function(n){for(var e=[],t=0;t<n;t++)e.push(Math.floor(256*Math.random()));return e};var randomByteBrowser$1$1=randomByte$1$1,format_browser=function(n,e,t){for(var r=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*r*t/e.length),o="";;)for(var l=n(i),u=i;u--;)if((o+=e[l[u]&r]||"").length===+t)return o};function generate(n){for(var e,t=0,r="";!e;)r+=format_browser(randomByteBrowser$1$1,alphabet_1$1$1.get(),1),e=n<Math.pow(16,t+1),t++;return r}var generate_1=generate,REDUCE_TIME$1=1567752802062,version$2$1=7,counter$1,previousSeconds$1;function build$1(n){var e="",t=Math.floor(.001*(Date.now()-REDUCE_TIME$1));return t===previousSeconds$1?counter$1++:(counter$1=0,previousSeconds$1=t),e+=generate_1(version$2$1),e+=generate_1(n),counter$1>0&&(e+=generate_1(counter$1)),e+=generate_1(t)}var build_1$1=build$1;function isShortId$1$1(n){return!(!n||"string"!=typeof n||n.length<6)&&!new RegExp("[^"+alphabet_1$1$1.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(n)}var isValid$1$1=isShortId$1$1,lib$2$1=createCommonjsModule$1$1((function(n){var e=0;function t(){return build_1$1(e)}n.exports=t,n.exports.generate=t,n.exports.seed=function(e){return alphabet_1$1$1.seed(e),n.exports},n.exports.worker=function(t){return e=t,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1$1$1.characters(n),alphabet_1$1$1.shuffled()},n.exports.isValid=isValid$1$1})),shortid$1$1=lib$2$1;class PlatformController{constructor(n,e,t,r,i,o,l,u,s){this.glueController=n,this.windowsController=e,this.applicationsController=t,this.layoutsController=r,this.workspacesController=i,this.intentsController=o,this.channelsController=l,this.portsBridge=u,this.stateController=s,this.controllers={windows:this.windowsController,appManager:this.applicationsController,layouts:this.layoutsController,workspaces:this.workspacesController,intents:this.intentsController,channels:this.channelsController}}get logger(){return logger.get("main.web.platform")}start(n){var e;return __awaiter$3(this,void 0,void 0,(function*(){yield this.portsBridge.start(n.gateway),this.portsBridge.onClientUnloaded(this.handleClientUnloaded.bind(this)),yield this.glueController.start(n),yield Promise.all([this.glueController.createPlatformSystemMethod(this.handleControlMessage.bind(this)),this.glueController.createPlatformSystemStream()]),this.stateController.start(),yield Promise.all(Object.values(this.controllers).map((e=>e.start(n)))),yield this.glueController.initClientGlue(null==n?void 0:n.glue,null==n?void 0:n.glueFactory),null===(e=n.plugins)||void 0===e||e.definitions.forEach(this.startPlugin.bind(this))}))}getClientGlue(){return this.glueController.clientGlue}startPlugin(n){var e;try{n.start(this.glueController.clientGlue,n.config)}catch(t){null===(e=this.logger)||void 0===e||e.warn(`Plugin: ${n.name} threw while initiating: ${JSON.stringify(t.message)}`)}}handleControlMessage(n,e,t,r){var i,o;const l=libDomainDecoder$1$1.run(n.domain);if(!l.ok){const n=JSON.stringify(l.error);return null===(i=this.logger)||void 0===i||i.trace("rejecting execution of a command, because of a domain validation error: "+n),r("Cannot execute this platform control, because of domain validation error: "+n)}const u=l.result;n.commandId=shortid$1$1.generate(),null===(o=this.logger)||void 0===o||o.trace(`[${n.commandId}] received a command for a valid domain: ${u} from window ${e.windowId} and interop id ${e.instance}, forwarding to the appropriate controller`),this.controllers[u].handleControl(n).then((e=>{var r;t(e),null===(r=this.logger)||void 0===r||r.trace(`[${n.commandId}] this command was executed successfully, sending the result to the caller.`)})).catch((e=>{var t;const i=JSON.stringify(e.message);null===(t=this.logger)||void 0===t||t.trace(`[${n.commandId}] this command's execution was rejected, reason: ${i}`),r(`The platform rejected operation ${n.operation} for domain: ${u} with reason: ${i}`)}))}handleClientUnloaded(n){var e;null===(e=this.logger)||void 0===e||e.trace(`detected unloading of client: ${n.windowId}, notifying all controllers`),Object.values(this.controllers).forEach(((e,t)=>{var r,i;try{null===(r=e.handleClientUnloaded)||void 0===r||r.call(e,n.windowId,n.win)}catch(e){const r=Object.keys(this.controllers)[t];null===(i=this.logger)||void 0===i||i.error(`${r} controller threw when handling unloaded client ${n.windowId} with error message: ${JSON.stringify(e.message)}`)}}))}}const defaultPlatformConfig={windows:{windowResponseTimeoutMs:1e4,defaultWindowOpenBounds:{top:0,left:0,width:600,height:600}},applications:{local:[]},layouts:{mode:"idb",local:[]},channels:{definitions:[]},plugins:{definitions:[]},gateway:{logging:{level:"info"}},glue:{}},defaultTargetString="*";var isMergeableObject=function(n){return isNonNullObject(n)&&!isSpecial(n)};function isNonNullObject(n){return!!n&&"object"==typeof n}function isSpecial(n){var e=Object.prototype.toString.call(n);return"[object RegExp]"===e||"[object Date]"===e||isReactElement(n)}var canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(n){return n.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(n){return Array.isArray(n)?[]:{}}function cloneUnlessOtherwiseSpecified(n,e){return!1!==e.clone&&e.isMergeableObject(n)?deepmerge(emptyTarget(n),n,e):n}function defaultArrayMerge(n,e,t){return n.concat(e).map((function(n){return cloneUnlessOtherwiseSpecified(n,t)}))}function getMergeFunction(n,e){if(!e.customMerge)return deepmerge;var t=e.customMerge(n);return"function"==typeof t?t:deepmerge}function getEnumerableOwnPropertySymbols(n){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n).filter((function(e){return n.propertyIsEnumerable(e)})):[]}function getKeys(n){return Object.keys(n).concat(getEnumerableOwnPropertySymbols(n))}function propertyIsOnObject(n,e){try{return e in n}catch(n){return!1}}function propertyIsUnsafe(n,e){return propertyIsOnObject(n,e)&&!(Object.hasOwnProperty.call(n,e)&&Object.propertyIsEnumerable.call(n,e))}function mergeObject(n,e,t){var r={};return t.isMergeableObject(n)&&getKeys(n).forEach((function(e){r[e]=cloneUnlessOtherwiseSpecified(n[e],t)})),getKeys(e).forEach((function(i){propertyIsUnsafe(n,i)||(propertyIsOnObject(n,i)&&t.isMergeableObject(e[i])?r[i]=getMergeFunction(i,t)(n[i],e[i],t):r[i]=cloneUnlessOtherwiseSpecified(e[i],t))})),r}function deepmerge(n,e,t){(t=t||{}).arrayMerge=t.arrayMerge||defaultArrayMerge,t.isMergeableObject=t.isMergeableObject||isMergeableObject,t.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var r=Array.isArray(e);return r===Array.isArray(n)?r?t.arrayMerge(n,e,t):mergeObject(n,e,t):cloneUnlessOtherwiseSpecified(e,t)}deepmerge.all=function(n,e){if(!Array.isArray(n))throw new Error("first argument should be an array");return n.reduce((function(n,t){return deepmerge(n,t,e)}),{})};var deepmerge_1=deepmerge,cjs=deepmerge_1,version$3$1="1.0.0";class Platform{constructor(n,e){this.controller=n,this.checkSingleton(),this.processConfig(e)}ready(){return __awaiter$3(this,void 0,void 0,(function*(){yield this.controller.start(this.platformConfig)}))}getClientGlue(){return this.controller.getClientGlue()}exposeAPI(){return{version:this.version}}get version(){return version$3$1}checkSingleton(){const n=window.glue42core;if(n){if(n.platformStarted)throw new Error("The Glue42 Core Platform has already been started for this application.");n.platformStarted=!0}else window.glue42core={platformStarted:!0}}processConfig(n={}){const e=platformConfigDecoder.runWithException(n);this.validatePlugins(e),this.platformConfig=cjs(defaultPlatformConfig,e)}validatePlugins(n){var e;if(null===(e=n.plugins)||void 0===e?void 0:e.definitions){const e=n.plugins.definitions.reduce(((n,e)=>{const t=typeof e.start,r=e.name;return"function"!==t&&n.push({name:r,startType:t}),n}),[]);if(e.length){const n=e.map((n=>`The start function for plugin ${n.name} was expected to be of type function, but was provided: ${n.startType}`)).join("\n");throw new Error(n)}}}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics$1$1=function(n,e){return(extendStatics$1$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)};function __extends$1$1(n,e){function t(){this.constructor=n}extendStatics$1$1(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign$3$1=function(){return(__assign$3$1=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function __awaiter$2$1(n,e,t,r){return new(t||(t=Promise))((function(i,o){function l(n){try{s(r.next(n))}catch(n){o(n)}}function u(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new t((function(e){e(n.value)})).then(l,u)}s((r=r.apply(n,e||[])).next())}))}function __generator$1$1(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function __spreadArrays$1$1(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),i=0;for(e=0;e<t;e++)for(var o=arguments[e],l=0,u=o.length;l<u;l++,i++)r[i]=o[l];return r}var MetricTypes$1$1={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue$1$1(n){return n.type===MetricTypes$1$1.TIMESTAMP?"timestamp":n.type===MetricTypes$1$1.NUMBER?"number":n.type===MetricTypes$1$1.STRING?"string":n.type===MetricTypes$1$1.OBJECT?"object":"unknown"}function getTypeByValue$1$1(n){return n.constructor===Date?"timestamp":"number"==typeof n?"number":"string"==typeof n?"string":"object"==typeof n?"object":"string"}function serializeMetric$1$1(n){var e={},t=getMetricTypeByValue$1$1(n);if("object"===t){var r=Object.keys(n.value).reduce((function(e,t){var r=getTypeByValue$1$1(n.value[t]);if("object"===r){var i=defineNestedComposite$1$1(n.value[t]);e[t]={type:"object",description:"",context:{},composite:i}}else e[t]={type:r,description:"",context:{}};return e}),{});e.composite=r}return e.name=normalizeMetricName$1$1(n.path.join("/")+"/"+n.name),e.type=t,e.description=n.description,e.context={},e}function defineNestedComposite$1$1(n){return Object.keys(n).reduce((function(e,t){var r=getTypeByValue$1$1(n[t]);return e[t]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite$1$1(n[t])}:{type:r,description:"",context:{}},e}),{})}function normalizeMetricName$1$1(n){return void 0!==n&&n.length>0&&"/"!==n[0]?"/"+n:n}function getMetricValueByType$1$1(n){return"timestamp"===getMetricTypeByValue$1$1(n)?Date.now():publishNestedComposite$1$1(n.value)}function publishNestedComposite$1$1(n){return"object"!=typeof n?n:Object.keys(n).reduce((function(e,t){var r=n[t];return"object"==typeof r&&r.constructor!==Date?e[t]=publishNestedComposite$1$1(r):r.constructor===Date?e[t]=new Date(r).getTime():r.constructor===Boolean?e[t]=r.toString():e[t]=r,e}),{})}function flatten$1$1(n){return n.reduce((function(n,e){return n.concat(Array.isArray(e)?flatten$1$1(e):e)}),[])}function getHighestState$1$1(n){return n.sort((function(n,e){return n.state?e.state?e.state-n.state:-1:1}))[0]}function aggregateDescription$1$1(n){var e="";return n.forEach((function(n,t,r){var i=n.path.join(".");t===r.length-1?e+=i+"."+n.name+": "+n.description:e+=i+"."+n.name+": "+n.description+","})),e.length>100?e.slice(0,100)+"...":e}function composeMsgForRootStateMetric$1$1(n){var e=flatten$1$1(n.root.getAggregateState()),t=getHighestState$1$1(e);return{description:aggregateDescription$1$1(e),value:t.state}}function gw3$1$1(n,e){var t,r,i=this;if(!n||"object"!=typeof n)throw new Error("Connection is required parameter");var o=function(n){l(n.root)},l=function(n){u(n),n.metrics.forEach((function(n){s(n)})),n.subSystems.forEach((function(n){l(n)}))},u=function(n){return __awaiter$2$1(i,void 0,void 0,(function(){var e,i;return __generator$1$1(this,(function(o){switch(o.label){case 0:return void 0===n.parent?[2]:[4,t];case 1:return o.sent(),e={name:normalizeMetricName$1$1(n.path.join("/")+"/"+n.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[e]},r.send(i),[2]}}))}))},s=function(n){return __awaiter$2$1(i,void 0,void 0,(function(){var e,i,o;return __generator$1$1(this,(function(l){switch(l.label){case 0:return e=c(n),[4,t];case 1:return l.sent(),i=serializeMetric$1$1(e),o={type:"define",metrics:[i]},r.send(o),void 0!==e.value&&a(e),[2]}}))}))},a=function(n){if(d()){var e=getMetricValueByType$1$1(n),t={type:"publish",values:[{name:normalizeMetricName$1$1(n.path.join("/")+"/"+n.name),value:e,timestamp:Date.now()}]};return r.sendFireAndForget(t)}return Promise.resolve()},c=function(n){var e=__assign$3$1({},n);return"object"==typeof n.value&&null!==n.value&&(e.value=__assign$3$1({},n.value)),e},d=function(){var n;try{return(null!==(n=e.canUpdateMetric)&&void 0!==n?n:function(){return!0})()}catch(n){return!0}};return{init:function(i){var l;t=new Promise((function(n){l=n})),(r=n.domain("metrics")).onJoined((function(n){!n&&l&&(l(),l=void 0);var e={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(e),n&&o(i)})),r.join({system:e.system,service:e.service,instance:e.instance})},createSystem:u,updateSystem:function(e,o){return __awaiter$2$1(i,void 0,void 0,(function(){var i,l,u;return __generator$1$1(this,(function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),i={type:"publish",values:[{name:normalizeMetricName$1$1(e.path.join("/")+"/"+e.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric$1$1(e),u={type:"publish",peer_id:n.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(u),[2]}}))}))},createMetric:s,updateMetric:function(n){return __awaiter$2$1(i,void 0,void 0,(function(){var e;return __generator$1$1(this,(function(r){switch(r.label){case 0:return e=c(n),[4,t];case 1:return r.sent(),a(e),[2]}}))}))}}}var Helpers$1$1={validate:function(n,e,t){if(null===n||"object"!=typeof n)throw new Error("Missing definition");if(null===e||"object"!=typeof e)throw new Error("Missing parent");if(null===t||"object"!=typeof t)throw new Error("Missing transport")}},BaseMetric$1$1=function(){function n(n,e,t,r,i){this.definition=n,this.system=e,this.transport=t,this.value=r,this.type=i,this.path=[],Helpers$1$1.validate(n,e,t),this.path=e.path.slice(0),this.path.push(e.name),this.name=n.name,this.description=n.description,t.createMetric(this)}return Object.defineProperty(n.prototype,"repo",{get:function(){var n;return null===(n=this.system)||void 0===n?void 0:n.repo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),n.prototype.update=function(n){return this.value=n,this.transport.updateMetric(this)},n}(),NumberMetric$1$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1$1.NUMBER)||this}return __extends$1$1(e,n),e.prototype.incrementBy=function(n){this.update(this.value+n)},e.prototype.increment=function(){this.incrementBy(1)},e.prototype.decrement=function(){this.incrementBy(-1)},e.prototype.decrementBy=function(n){this.incrementBy(-1*n)},e}(BaseMetric$1$1),ObjectMetric$1$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1$1.OBJECT)||this}return __extends$1$1(e,n),e.prototype.update=function(n){return this.mergeValues(n),this.transport.updateMetric(this)},e.prototype.mergeValues=function(n){var e=this;return Object.keys(this.value).forEach((function(t){void 0!==n[t]&&(e.value[t]=n[t])}))},e}(BaseMetric$1$1),StringMetric$1$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1$1.STRING)||this}return __extends$1$1(e,n),e}(BaseMetric$1$1),TimestampMetric$1$1=function(n){function e(e,t,r,i){return n.call(this,e,t,r,i,MetricTypes$1$1.TIMESTAMP)||this}return __extends$1$1(e,n),e.prototype.now=function(){this.update(new Date)},e}(BaseMetric$1$1);function system$1$1(n,e,t,r,i){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");var o,l,u=t,s=n,a=i||"",c=e,d=r,h=function n(e){if(!e||!e.parent)return[];var t=n(e.parent);return t.push(e.name),t}(r),f={},p=(l="/",((o=h)&&o.length>0?o.join(l):"")+n),g=e.root,w=[],v=[];function m(n,e,t,r){var i={name:""};i="string"==typeof n?{name:n}:n;var o=v.filter((function(n){return n.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==e)throw new Error("A metric named "+i.name+" is already defined with different type.");return void 0!==t&&l.update(t).catch((function(){})),l}var u=r(i);return v.push(u),u}var y={get name(){return s},get description(){return a},get repo(){return c},get parent(){return d},path:h,id:p,root:g,get subSystems(){return w},get metrics(){return v},subSystem:function(n,e){if(!n||0===n.length)throw new Error("name is required");var t=w.filter((function(e){return e.name===n}));if(t.length>0)return t[0];var r=system$1$1(n,c,u,y,e);return w.push(r),r},getState:function(){return f},setState:function(n,e){f={state:n,description:e},u.updateSystem(y,f)},stringMetric:function(n,e){return m(n,MetricTypes$1$1.STRING,e,(function(n){return new StringMetric$1$1(n,y,u,e)}))},timestampMetric:function(n,e){return m(n,MetricTypes$1$1.TIMESTAMP,e,(function(n){return new TimestampMetric$1$1(n,y,u,e)}))},objectMetric:function(n,e){return m(n,MetricTypes$1$1.OBJECT,e,(function(n){return new ObjectMetric$1$1(n,y,u,e)}))},numberMetric:function(n,e){return m(n,MetricTypes$1$1.NUMBER,e,(function(n){return new NumberMetric$1$1(n,y,u,e)}))},getAggregateState:function(){var n=[];return Object.keys(f).length>0&&n.push({name:s,path:h,state:f.state,description:f.description}),w.forEach((function(e){var t=e.getAggregateState();t.length>0&&n.push.apply(n,t)})),n}};return u.createSystem(y),y}var Repository$1$1=function(){function n(n,e){e.init(this),this.root=system$1$1("",this,e),this.addSystemMetrics(this.root,n.clickStream||void 0===n.clickStream)}return n.prototype.addSystemMetrics=function(n,e){if("undefined"!=typeof navigator&&n.stringMetric("UserAgent",navigator.userAgent),e&&"undefined"!=typeof document){var t=n.subSystem("ClickStream"),r=function(n){if(n.target){var e=n.target;t.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:n.target?e.className:"",id:e.id,type:"<"+e.tagName.toLowerCase()+">",href:e.href||""}})}};t.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}n.stringMetric("StartTime",(new Date).toString());var i=n.stringMetric("StartURL",""),o=n.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},n}(),NullProtocol$1$1=function(){function n(){}return n.prototype.init=function(n){},n.prototype.createSystem=function(n){return Promise.resolve()},n.prototype.updateSystem=function(n,e){return Promise.resolve()},n.prototype.createMetric=function(n){return Promise.resolve()},n.prototype.updateMetric=function(n){return Promise.resolve()},n}(),PerfTracker$1$1=function(){function n(n,e,t){this.api=n,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=e?e:this.initialPublishTimeout,this.publishInterval=null!=t?t:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return n.prototype.scheduleCollection=function(){var n=this;setTimeout((function(){n.collect(),setInterval((function(){n.collect()}),n.publishInterval)}),this.initialPublishTimeout)},n.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(n){}},n.prototype.collectMemory=function(){var n=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:n.totalJSHeapSize,usedJSHeapSize:n.usedJSHeapSize}))},n.prototype.collectEntries=function(){var n=window.performance.getEntries();n.length<=this.lastCount||(this.lastCount=n.length,this.system.stringMetric("entries",JSON.stringify(n)))},n}(),metrics$1$1=function(n){var e;e=n.connection&&"object"==typeof n.connection?gw3$1$1(n.connection,n):new NullProtocol$1$1;var t=new Repository$1$1(n,e).root;n.disableAutoAppSystem||(t=t.subSystem("App"));var r=addFAVSupport$1$1(t);return initPerf$1$1(r,n.pagePerformanceMetrics),r},perf$1$1;function initPerf$1$1(n,e){var t,r;if("undefined"!=typeof window){var i=null===(r=null===(t=null===window||void 0===window?void 0:window.glue42gd)||void 0===t?void 0:t.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(e=i),(null==e?void 0:e.enabled)&&(perf$1$1=new PerfTracker$1$1(n,e.initialPublishTimeout,e.publishInterval))}}function addFAVSupport$1$1(n){var e,t=n.subSystem("reporting"),r={name:"features"};return n.featureMetric=function(n,i,o){if(void 0===n||""===n)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");e?e.update({name:n,action:i,payload:o}):e=t.objectMetric(r,{name:n,action:i,payload:o})},n}function createRegistry$2$1(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$2$1.default=createRegistry$2$1;var lib$3$1=createRegistry$2$1,InProcTransport$1$1=function(){function n(n,e){var t=this;this.registry=lib$3$1(),this.gw=n.facade,this.gw.connect((function(n,e){t.messageHandler(e)})).then((function(n){t.client=n}))}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.client?(this.client.send(n),Promise.resolve(void 0)):Promise.reject("not connected")},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"in-memory"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),SharedWorkerTransport$1$1=function(){function n(n,e){var t=this;this.logger=e,this.registry=lib$3$1(),this.worker=new SharedWorker(n),this.worker.port.onmessage=function(n){t.messageHandler(n.data)}}return Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return this.worker.port.postMessage(n),Promise.resolve()},n.prototype.send=function(n){return Promise.reject("not supported")},n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.onConnectedChanged=function(n){n(!0)},n.prototype.close=function(){return Promise.resolve()},n.prototype.open=function(){return Promise.resolve()},n.prototype.name=function(){return"shared-worker"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.messageHandler=function(n){this.registry.execute("onMessage",n)},n}(),Utils$1$1=function(){function n(){}return n.getGDMajorVersion=function(){if("undefined"!=typeof window&&window.glueDesktop&&window.glueDesktop.version){var n=Number(window.glueDesktop.version.substr(0,1));return isNaN(n)?void 0:n}},n.isNode=function(){if(void 0!==n._isNode)return n._isNode;if("undefined"!=typeof window)return n._isNode=!1,!1;try{n._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(e){n._isNode=!1}return n._isNode},n}(),PromiseWrapper$1$1=function(){function n(){var n=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(e,t){n.resolve=function(t){n.resolved=!0,e(t)},n.reject=function(e){n.rejected=!0,t(e)}}))}return n.delay=function(n){return new Promise((function(e){return setTimeout(e,n)}))},Object.defineProperty(n.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),n}(),timers$1$1={};function getAllTimers$1$1(){return timers$1$1}function timer$1$1(n){var e=timers$1$1[n];if(e)return e;var t=[];function r(){return(new Date).getTime()}var i,o,l=r();function u(n,e){var i=null!=e?e:r(),o=0;t.length>0&&(o=i-t[t.length-1].time),t.push({name:n,time:i,diff:o})}u("start",l);var s={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return u("end",i=r()),o=i-l},mark:u,marks:t};return timers$1$1[n]=s,s}var WebSocketConstructor$1$1=Utils$1$1.isNode()?require("ws"):window.WebSocket,WS$1$1=function(){function n(n,e){if(this.startupTimer=timer$1$1("connection"),this._running=!0,this._registry=lib$3$1(),this.wsRequests=[],this.settings=n,this.logger=e,!this.settings.ws)throw new Error("ws is missing")}return n.prototype.onMessage=function(n){return this._registry.add("onMessage",n)},n.prototype.send=function(n,e){var t=this;return new Promise((function(e,r){t.waitForSocketConnection((function(){var i;try{null===(i=t.ws)||void 0===i||i.send(n),e()}catch(n){r(n)}}),r)}))},n.prototype.open=function(){var n=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(e,t){n.waitForSocketConnection(e,t)}))},n.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},n.prototype.onConnectedChanged=function(n){return this._registry.add("onConnectedChanged",n)},n.prototype.name=function(){return"ws "+this.settings.ws},n.prototype.reconnect=function(){var n;null===(n=this.ws)||void 0===n||n.close();var e=new PromiseWrapper$1$1;return this.waitForSocketConnection((function(){e.resolve()})),e.promise},n.prototype.waitForSocketConnection=function(n,e){var t;e=null!=e?e:function(){},this._running?1!==(null===(t=this.ws)||void 0===t?void 0:t.readyState)?(this.wsRequests.push({callback:n,failed:e}),this.wsRequests.length>1||this.openSocket()):n():e("wait for socket on "+this.settings.ws+" failed - socket closed by user")},n.prototype.openSocket=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t=this;return __generator$1$1(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===n&&(n=this.settings.reconnectInterval),void 0!==e){if(0===e)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+e+" more times (every "+n+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===e?void 0:e-1;t.openSocket(n,r)}),n),[3,4];case 4:return[2]}}))}))},n.prototype.initiateSocket=function(){var n=this,e=new PromiseWrapper$1$1;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new WebSocketConstructor$1$1(this.settings.ws||""),this.ws.onerror=function(t){var r="";try{r=JSON.stringify(t)}catch(n){var i=new WeakSet;r=JSON.stringify(t,(function(n,e){if("object"==typeof e&&null!==e){if(i.has(e))return;i.add(e)}return e}))}e.reject("error"),n.notifyStatusChanged(!1,r)},this.ws.onclose=function(t){n.logger.info("ws closed "+t),e.reject("closed"),n.notifyStatusChanged(!1)},this.ws.onopen=function(){var t;n.startupTimer.mark("ws-opened"),n.logger.info("ws opened "+(null===(t=n.settings.identity)||void 0===t?void 0:t.application)),e.resolve(),n.notifyStatusChanged(!0)},this.ws.onmessage=function(e){n._registry.execute("onMessage",e.data)},e.promise},n.prototype.notifyForSocketState=function(n){this.wsRequests.forEach((function(e){n?e.failed&&e.failed(n):e.callback()})),this.wsRequests=[]},n.prototype.notifyStatusChanged=function(n,e){this._registry.execute("onConnectedChanged",n,e)},n}();function createCommonjsModule$2$1(n,e){return n(e={exports:{}},e.exports),e.exports}var seed$2$1=1;function getNextValue$2$1(){return(seed$2$1=(9301*seed$2$1+49297)%233280)/233280}function setSeed$4$1(n){seed$2$1=n}var randomFromSeed$2$1={nextValue:getNextValue$2$1,seed:setSeed$4$1},ORIGINAL$2$1="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$2$1,previousSeed$2$1,shuffled$2$1;function reset$2$1(){shuffled$2$1=!1}function setCharacters$2$1(n){if(n){if(n!==alphabet$2$1){if(n.length!==ORIGINAL$2$1.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2$1.length+" unique characters. You submitted "+n.length+" characters: "+n);var e=n.split("").filter((function(n,e,t){return e!==t.lastIndexOf(n)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2$1.length+" unique characters. These characters were not unique: "+e.join(", "));alphabet$2$1=n,reset$2$1()}}else alphabet$2$1!==ORIGINAL$2$1&&(alphabet$2$1=ORIGINAL$2$1,reset$2$1())}function characters$2$1(n){return setCharacters$2$1(n),alphabet$2$1}function setSeed$1$1$1(n){randomFromSeed$2$1.seed(n),previousSeed$2$1!==n&&(reset$2$1(),previousSeed$2$1=n)}function shuffle$2$1(){alphabet$2$1||setCharacters$2$1(ORIGINAL$2$1);for(var n,e=alphabet$2$1.split(""),t=[],r=randomFromSeed$2$1.nextValue();e.length>0;)r=randomFromSeed$2$1.nextValue(),n=Math.floor(r*e.length),t.push(e.splice(n,1)[0]);return t.join("")}function getShuffled$2$1(){return shuffled$2$1||(shuffled$2$1=shuffle$2$1())}function lookup$2$1(n){return getShuffled$2$1()[n]}var alphabet_1$2$1={characters:characters$2$1,seed:setSeed$1$1$1,lookup:lookup$2$1,shuffled:getShuffled$2$1},crypto$2$1="object"==typeof window&&(window.crypto||window.msCrypto);function randomByte$2$1(){if(!crypto$2$1||!crypto$2$1.getRandomValues)return 48&Math.floor(256*Math.random());var n=new Uint8Array(1);return crypto$2$1.getRandomValues(n),48&n[0]}var randomByteBrowser$2$1=randomByte$2$1;function encode$1$1(n,e){for(var t,r=0,i="";!t;)i+=n(e>>4*r&15|randomByteBrowser$2$1()),t=e<Math.pow(16,r+1),r++;return i}var encode_1$1$1=encode$1$1;function decode$1$1(n){var e=alphabet_1$2$1.shuffled();return{version:15&e.indexOf(n.substr(0,1)),worker:15&e.indexOf(n.substr(1,1))}}var decode_1$1$1=decode$1$1;function isShortId$2$1(n){if(!n||"string"!=typeof n||n.length<6)return!1;for(var e=alphabet_1$2$1.characters(),t=n.length,r=0;r<t;r++)if(-1===e.indexOf(n[r]))return!1;return!0}var isValid$2$1=isShortId$2$1,lib$1$2$1=createCommonjsModule$2$1((function(n){var e,t,r=0;function i(){var n="",i=Math.floor(.001*(Date.now()-1459707606518));return i===t?e++:(e=0,t=i),n+=encode_1$1$1(alphabet_1$2$1.lookup,6),n+=encode_1$1$1(alphabet_1$2$1.lookup,r),e>0&&(n+=encode_1$1$1(alphabet_1$2$1.lookup,e)),n+=encode_1$1$1(alphabet_1$2$1.lookup,i)}n.exports=i,n.exports.generate=i,n.exports.seed=function(e){return alphabet_1$2$1.seed(e),n.exports},n.exports.worker=function(e){return r=e,n.exports},n.exports.characters=function(n){return void 0!==n&&alphabet_1$2$1.characters(n),alphabet_1$2$1.shuffled()},n.exports.decode=decode_1$1$1,n.exports.isValid=isValid$2$1})),lib_1$1$1=lib$1$2$1.generate,lib_2$1$1=lib$1$2$1.seed,lib_3$1$1=lib$1$2$1.worker,lib_4$1$1=lib$1$2$1.characters,lib_5$1$1=lib$1$2$1.decode,lib_6$1$1=lib$1$2$1.isValid,shortid$2$1=lib$1$2$1;function domainSession$1$1(n,e,t,r,i){null==n&&(n="global"),r=r||["success"],i=i||["error"];var o,l=!1,u=!1,s=!1,a=lib$3$1();e.disconnected((function(){s=!1,t.debug("connection is down"),l=!1,u=!0,a.execute("onLeft",{disconnected:!0})})),e.loggedIn((function(){s=!0,u&&(t.debug("connection is now up - trying to reconnect..."),d(o))})),e.on("success",(function(n){return f(n)})),e.on("error",(function(n){return h(n)})),e.on("result",(function(n){return f(n)})),r&&r.forEach((function(n){e.on(n,(function(n){return f(n)}))})),i&&i.forEach((function(n){e.on(n,(function(n){return h(n)}))}));var c={};function d(e){return o=e,new Promise((function(r,i){if(l)r();else{var o;if("global"===n)o=s?Promise.resolve({}):Promise.reject("not connected to gateway");else t.debug("joining domain "+n),o=g({type:"join",destination:n,domain:"global",options:e});o.then((function(){!function(){t.debug("did join "+n),l=!0;var e=u;u=!1,a.execute("onJoined",e)}(),r()})).catch((function(e){t.debug("error joining "+n+" domain: "+JSON.stringify(e)),i(e)}))}}))}function h(e){if(n===e.domain){var t=e.request_id;if(t){var r=c[t];r&&r.error(e)}}}function f(e){if(e.domain===n){var t=e.request_id;if(t){var r=c[t];r&&r.success(e)}}}function p(){return shortid$2$1()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||n,o.skipPeerId||(r.peer_id=e.peerId);var l=r.request_id;return new Promise((function(n,u){c[l]={success:function(e){delete c[l],e._tag=i,n(e)},error:function(n){t.warn("GW error - "+JSON.stringify(n)+" for request "+JSON.stringify(r)),delete c[l],n._tag=i,u(n)}},e.send(r,o).catch((function(n){c[l].error({err:n})}))}))}return{join:d,leave:function(){return"global"===n?Promise.resolve():(t.debug("stopping session "+n+"..."),u=!1,g({type:"leave",destination:n,domain:"global"}).then((function(){l=!1,a.execute("onLeft")})))},onJoined:function(n){return l&&n(!1),a.add("onJoined",n)},onLeft:function(n){return l||n(),a.add("onLeft",n)},send:g,sendFireAndForget:function(t){return t.request_id=t.request_id?t.request_id:p(),t.domain=t.domain||n,t.peer_id=e.peerId,e.send(t)},on:function(r,i){e.on(r,(function(e){if(e.domain===n)try{i(e)}catch(n){t.error("Callback  failed: "+n+" \n "+n.stack+" \n msg was: "+JSON.stringify(e),n)}}))},loggedIn:function(n){return e.loggedIn(n)},connected:function(n){return e.connected(n)},disconnected:function(n){return e.disconnected(n)},get peerId(){return e.peerId},get domain(){return n}}}var GW3ProtocolImpl$1$1=function(){function n(n,e,t){var r=this;this.connection=n,this.settings=e,this.logger=t,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib$3$1(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],n.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.processStringMessage=function(n){var e=this,t=JSON.parse(n,(function(n,t){if("string"!=typeof t)return t;if(t.length<e.dateMinLen)return t;if(t[0]!==e.datePrefixFirstChar)return t;if(t.substring(0,e.datePrefixLen)!==e.datePrefix)return t;try{var r=parseInt(t.substring(e.datePrefixLen,t.length),10);return isNaN(r)?t:new Date(r)}catch(n){return t}}));return{msg:t,msgType:t.type}},n.prototype.createStringMessage=function(n){var e=Date.prototype.toJSON;try{var t=this.datePrefix;return Date.prototype.toJSON=function(){return t+this.getTime()},JSON.stringify(n)}finally{Date.prototype.toJSON=e}},n.prototype.processObjectMessage=function(n){if(!n.type)throw new Error("Object should have type property");return{msg:n,msgType:n.type}},n.prototype.createObjectMessage=function(n){return n},n.prototype.login=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t,r,i,o,l,u,s,a,c,d;return __generator$1$1(this,(function(h){switch(h.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=n,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,t={},this.connection.gatewayToken=n.gatewayToken,!n.gatewayToken)return[3,5];if(!e)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return a=h.sent(),n.gatewayToken=a,[3,4];case 3:return r=h.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null==r?void 0:r.message)||r)),[3,4];case 4:return t.method="gateway-token",t.token=n.gatewayToken,this.connection.gatewayToken=n.gatewayToken,[3,10];case 5:return"sspi"!==n.flowName?[3,9]:(t.provider="win",t.method="access-token",n.flowCallback&&n.sessionId?(i=t,[4,n.flowCallback(n.sessionId,null)]):[3,7]);case 6:return i.token=h.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(n.token)t.method="access-token",t.token=n.token;else{if(!n.username)throw new Error("invalid auth message"+JSON.stringify(n));t.method="secret",t.login=n.username,t.secret=n.password}h.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:t},n.sessionId&&(o.request_id=n.sessionId),this.globalDomain=domainSession$1$1("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),h.label=11;case 11:h.trys.push([11,19,20,21]),u=void 0,h.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(s=h.sent()).type?[3,16]:(a=Buffer.from(s.authentication.token,"base64"),n.flowCallback&&n.sessionId?(c=o.authentication,[4,n.flowCallback(n.sessionId,a)]):[3,15]);case 14:c.token=h.sent().data.toString("base64"),h.label=15;case 15:return o.request_id=n.sessionId,[3,12];case 16:if("welcome"===s.type)return u=s,[3,18];throw"error"===s.type?new Error("Authentication failed: "+s.reason):new Error("Unexpected message type during authentication: "+s.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+u.peer_id),this.connection.peerId=u.peer_id,this.connection.resolvedIdentity=u.resolved_identity,this.connection.availableDomains=u.available_domains,u.options&&(this.connection.token=u.options.access_token,this.connection.info=u.options.info),this.setLoggedIn(!0),[2,u.resolved_identity];case 19:throw d=h.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return n&&n.flowCallback&&n.sessionId&&n.flowCallback(n.sessionId,null),[7];case 21:return[2]}}))}))},n.prototype.logout=function(){return __awaiter$2$1(this,void 0,void 0,(function(){var n;return __generator$1$1(this,(function(e){switch(e.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),n=this.sessions.map((function(n){n.leave()})),[4,Promise.all(n)];case 1:return e.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this._isLoggedIn&&n(),this.registry.add("onLoggedIn",n)},n.prototype.domain=function(n,e,t,r){var i=this.sessions.filter((function(e){return e.domain===n}))[0];return i||(i=domainSession$1$1(n,this.connection,e,t,r),this.sessions.push(i)),i},n.prototype.handleDisconnected=function(){var n=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(n.handleDisconnected.bind(n),n.settings.reconnectInterval||1e3)}))}},n.prototype.setLoggedIn=function(n){this._isLoggedIn=n,this._isLoggedIn&&this.registry.execute("onLoggedIn")},n.prototype.ping=function(){var n=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){n.ping()}),3e4))},n.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(n){return n.token})):Promise.reject(new Error("no global domain session"))},n.prototype.getNewGWToken=function(){if(void 0!==typeof window){var n=window.glue42gd;if(n)return n.getGWToken()}return Promise.reject(new Error("not running in GD"))},n}(),MessageReplayerImpl$1$1=function(){function n(n){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var e=0,t=n;e<t.length;e++){var r=t[e];this.specs[r.name]=r,this.specsNames.push(r.name)}}return n.prototype.init=function(n){var e=this;this.connection=n;for(var t=0,r=this.specsNames;t<r.length;t++)for(var i=r[t],o=function(t){var r=l.subsRefCount[t];if(r||(r=0),r+=1,l.subsRefCount[t]=r,r>1)return"continue";var i=n.on(t,(function(n){return e.processMessage(t,n)}));l.subs[t]=i},l=this,u=0,s=this.specs[i].types;u<s.length;u++){o(s[u])}},n.prototype.processMessage=function(n,e){if(!this.isDone&&e)for(var t=0,r=this.specsNames;t<r.length;t++){var i=r[t];if(-1!==this.specs[i].types.indexOf(n)){var o=this.messages[i]||[];this.messages[i]=o,o.push(e)}}},n.prototype.drain=function(n,e){var t;e&&(this.messages[n]||[]).forEach(e),delete this.messages[n];for(var r=0,i=this.specs[n].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(t=this.connection)||void 0===t||t.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[n],this.specs.length||(this.isDone=!0)},n}(),PromisePlus$2$1=function(n,e,t){return new Promise((function(r,i){var o=setTimeout((function(){i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((function(n){clearTimeout(o),r(n)})).catch((function(n){clearTimeout(o),i(n)}))}))},WebPlatformTransport$1$1=function(){function n(n,e,t){this.settings=n,this.logger=e,this.identity=t,this.parentReady=!1,this.iAmConnected=!1,this.rejected=!1,this.children=[],this.parentPingTimeout=3e3,this.connectionRequestTimeout=5e3,this.defaultTargetString="*",this.registry=lib$3$1(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:this.handleParentReady.bind(this)},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformUnload:{name:"platformUnload",handle:this.handlePlatformUnload.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)}},this.setUpMessageListener(),this.setUpUnload(),this.settings.port||(this.parent=window.opener||window.top,this.parentType=window.opener?"opener":-1!==window.name.indexOf("#wsp")?"workspace":"top")}return Object.defineProperty(n.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!0,configurable:!0}),n.prototype.sendObject=function(n){return __awaiter$2$1(this,void 0,void 0,(function(){return __generator$1$1(this,(function(e){if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(n),[2]}))}))},Object.defineProperty(n.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.onMessage=function(n){return this.registry.add("onMessage",n)},n.prototype.send=function(){return Promise.reject("not supported")},n.prototype.onConnectedChanged=function(n){return this.registry.add("onConnectedChanged",n)},n.prototype.open=function(){return __awaiter$2$1(this,void 0,void 0,(function(){return __generator$1$1(this,(function(n){switch(n.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return n.sent(),this.notifyStatusChanged(!0),[2]}}))}))},n.prototype.close=function(){return Promise.resolve()},n.prototype.name=function(){return"web-platform"},n.prototype.reconnect=function(){return Promise.resolve()},n.prototype.connect=function(){return __awaiter$2$1(this,void 0,void 0,(function(){var n=this;return __generator$1$1(this,(function(e){switch(e.label){case 0:if(this.parentReady)return this.logger.debug("cancelling connection attempt, because this client's parent has already given a ready signal"),[2];if(this.settings.port)return this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.publicWindowId=this.settings.windowId,this.identity&&(this.identity.windowId=this.publicWindowId),this.port.onmessage=function(e){return n.registry.execute("onMessage",e.data)},this.logger.debug("internal web platform connection completed"),[2];if(!this.parentType||!this.parent)throw new Error("Cannot initiate a connection, because there is no opener, no top and no port.");return this.logger.debug("opening a "+("opener"===this.parentType?"child":"grandchild")+" client web platform connection"),[4,this.waitParent(this.parent,this.parentType)];case 1:return e.sent(),[4,this.initiateRemoteConnection(this.parent,this.parentType)];case 2:return e.sent(),this.logger.debug("the "+("opener"===this.parentType?"child":"grandchild")+" client is connected"),[2]}}))}))},n.prototype.initiateRemoteConnection=function(n,e){var t=this;return PromisePlus$2$1((function(r,i){t.connectionResolve=r,t.connectionReject=i,t.myClientId=shortid$2$1();var o="workspace"===t.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window.name,l={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"top"===e||"workspace"===e?"grandChild":"child",bridgeInstanceId:o}};t.logger.debug("sending connection request to "+e),n.postMessage(l,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the opener/top window timed out")},n.prototype.waitParent=function(n,e){var t=this;return PromisePlus$2$1((function(r){t.parentPingResolve=r;var i={glue42core:{type:"opener"===e?t.messages.platformPing.name:t.messages.parentPing.name}};t.logger.debug("checking for "+e+" window availability"),n.postMessage(i,t.defaultTargetString)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client")},n.prototype.setUpMessageListener=function(){var n=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(e){var t,r=null===(t=e.data)||void 0===t?void 0:t.glue42core;if(r&&!n.rejected)if(n.checkMessageTypeValid(r.type)){var i=r.type;n.logger.debug("received valid glue42core message of type: "+i),n.messages[i].handle(e)}else n.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: "+r.type)}))},n.prototype.setUpUnload=function(){var n=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var e,t,r={glue42core:{type:n.messages.clientUnload.name,data:{clientId:n.myClientId,ownWindowId:null===(e=n.identity)||void 0===e?void 0:e.windowId}}};n.parent&&n.parent.postMessage(r,n.defaultTargetString),null===(t=n.port)||void 0===t||t.postMessage(r)}))},n.prototype.handleParentReady=function(){if(this.logger.debug("handling the ready signal from the parent, by resoling the pending promise."),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handlePlatformReady=function(){if(this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve)return this.parentPingResolve(),void delete this.parentPingResolve;this.logger.debug("silently handling the ready signal from the top parent, because there is no defined promise")},n.prototype.handleConnectionAccepted=function(n){var e,t=null===(e=n.data)||void 0===e?void 0:e.glue42core;return this.myClientId===t.clientId?this.handleAcceptanceOfMyRequest(t):this.handleAcceptanceOfGrandChildRequest(t,n)},n.prototype.handleAcceptanceOfMyRequest=function(n){var e=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),n.port){if(this.publicWindowId="opener"===this.parentType?window.name:"top"===this.parentType?n.parentWindowId:window.name.substring(0,window.name.indexOf("#wsp")),this.identity&&"top"!==this.parentType&&(this.identity.windowId=this.publicWindowId),this.identity&&n.appName&&(this.identity.application=n.appName,this.identity.applicationName=n.appName),this.port=n.port,this.port.onmessage=function(n){return e.registry.execute("onMessage",n.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},n.prototype.handleAcceptanceOfGrandChildRequest=function(n,e){this.logger.debug("handling a connection accepted signal targeted at a grandchild: "+n.clientId);var t=this.children.find((function(e){return e.grandChildId===n.clientId}));t?(t.connected=!0,this.logger.debug("the grandchild connection for "+n.clientId+" is set up, forwarding the success message and the gateway port"),n.parentWindowId=this.publicWindowId,t.source.postMessage(e.data,t.origin,[n.port])):this.logger.error("cannot handle connection accepted for grandchild: "+n.clientId+", because there is no grandchild with this id")},n.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},n.prototype.handleConnectionRequest=function(n){var e=n.source,t=n.data.glue42core;return t.clientType&&"grandChild"===t.clientType?t.clientId?"opener"===this.parentType&&this.parent?(this.logger.debug("handling a connection request for a grandchild: "+t.clientId),this.children.push({grandChildId:t.clientId,source:e,connected:!1,origin:n.origin}),this.logger.debug("grandchild: "+t.clientId+" is prepared, forwarding connection request to the platform"),void this.parent.postMessage(n.data,this.defaultTargetString)):this.rejectConnectionRequest(e,n.origin,"Cannot forward the connection request, because no direct connection to the platform was found"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source did not provide a valid id"):this.rejectConnectionRequest(e,n.origin,"rejecting a connection request, because the source was not opened by a glue API call")},n.prototype.handleParentPing=function(n){if(this.parentReady)if(this.iAmConnected){var e={glue42core:{type:this.messages.parentReady.name}},t=n.source;this.logger.debug("responding to a parent ping with a ready message"),t.postMessage(e,n.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},n.prototype.handlePlatformUnload=function(n){this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.children.length&&(this.logger.debug("forwarding the platform unload to all known children and starting platform discovery polling"),this.children.forEach((function(e){return e.source.postMessage(n.data,e.origin)}))),this.notifyStatusChanged(!1,"Gateway unloaded")},n.prototype.handleClientUnload=function(n){var e=n.data.glue42core;e.clientId?this.children.find((function(n){return n.grandChildId===e.clientId}))?(this.logger.debug("handling grandchild unload for id: "+e.clientId),this.children=this.children.filter((function(n){return n.grandChildId!==e.clientId}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},n.prototype.handlePlatformPing=function(){this.logger.error("cannot handle platform ping, because this is not a platform calls handling component")},n.prototype.notifyStatusChanged=function(n,e){this.iAmConnected=n,this.registry.execute("onConnectedChanged",n,e)},n.prototype.checkMessageTypeValid=function(n){return"string"==typeof n&&!!this.messages[n]},n.prototype.rejectConnectionRequest=function(n,e,t){this.rejected=!0,this.logger.error(t);var r={glue42core:{type:this.messages.connectionRejected.name}};n.postMessage(r,e)},n}(),Connection$1$1=function(){function n(n,e){if(this.settings=n,this.logger=e,this.messageHandlers={},this.ids=1,this.registry=lib$3$1(),this._connected=!1,this.isTrace=!1,(n=n||{}).reconnectAttempts=n.reconnectAttempts||10,n.reconnectInterval=n.reconnectInterval||1e3,n.inproc)this.transport=new InProcTransport$1$1(n.inproc,e.subLogger("inMemory"));else if(n.sharedWorker)this.transport=new SharedWorkerTransport$1$1(n.sharedWorker,e.subLogger("shared-worker"));else if(n.webPlatform)this.transport=new WebPlatformTransport$1$1(n.webPlatform,e.subLogger("web-platform"),n.identity);else{if(void 0===n.ws)throw new Error("No connection information specified");this.transport=new WS$1$1(n,e.subLogger("ws"))}this.isTrace=e.canPublish("trace"),e.debug("starting with "+this.transport.name()+" transport"),this.protocol=new GW3ProtocolImpl$1$1(this,n,e.subLogger("protocol")),this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this.transport.onMessage(this.handleTransportMessage.bind(this)),n.replaySpecs&&n.replaySpecs.length&&(this.replayer=new MessageReplayerImpl$1$1(n.replaySpecs),this.replayer.init(this))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;return null===(n=this.protocol)||void 0===n?void 0:n.protocolVersion},enumerable:!0,configurable:!0}),n.prototype.send=function(n,e){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var t=this.protocol.createObjectMessage(n);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(t)),this.transport.sendObject(t,e)}var r=this.protocol.createStringMessage(n);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,e)},n.prototype.on=function(n,e){n=n.toLowerCase(),void 0===this.messageHandlers[n]&&(this.messageHandlers[n]={});var t=this.ids++;return this.messageHandlers[n][t]=e,{type:n,id:t}},n.prototype.off=function(n){delete this.messageHandlers[n.type.toLowerCase()][n.id]},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),n.prototype.connected=function(n){var e=this;return this.protocol.loggedIn((function(){n(e.settings.ws||e.settings.sharedWorker||"")}))},n.prototype.disconnected=function(n){return this.registry.add("disconnected",n)},n.prototype.login=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t;return __generator$1$1(this,(function(r){switch(r.label){case 0:return[4,this.transport.open()];case 1:return r.sent(),timer$1$1("connection").mark("transport-opened"),t=this.protocol.login(n,e),timer$1$1("connection").mark("protocol-logged-in"),[2,t]}}))}))},n.prototype.logout=function(){return __awaiter$2$1(this,void 0,void 0,(function(){return __generator$1$1(this,(function(n){switch(n.label){case 0:return[4,this.protocol.logout()];case 1:return n.sent(),[4,this.transport.close()];case 2:return n.sent(),[2]}}))}))},n.prototype.loggedIn=function(n){return this.protocol.loggedIn(n)},n.prototype.domain=function(n,e,t){return this.protocol.domain(n,this.logger.subLogger("domain="+n),e,t)},n.prototype.authToken=function(){return this.protocol.authToken()},n.prototype.reconnect=function(){return this.transport.reconnect()},n.prototype.distributeMessage=function(n,e){var t=this,r=this.messageHandlers[e.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(e){var i=r[e];if(void 0!==i)try{i(n)}catch(n){try{t.logger.error("Message handler failed with "+n.stack,n)}catch(e){console.log("Message handler failed",n)}}}))},n.prototype.handleConnectionChanged=function(n){this._connected!==n&&(this._connected=n,n?this.registry.execute("connected"):this.registry.execute("disconnected"))},n.prototype.handleTransportMessage=function(n){var e;e="string"==typeof n?this.protocol.processStringMessage(n):this.protocol.processObjectMessage(n),this.isTrace&&this.logger.trace("<< "+JSON.stringify(e)),this.distributeMessage(e.msg,e.msgType)},n}(),order$1$1=["trace","debug","info","warn","error","off"],Logger$1$1=function(){function n(n,e,t){this.name=n,this.parent=e,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=n,this.path=e?e.path+"."+n:n,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!t,t&&(this.logFn=t,this.customLogFn=!0)}return n.prototype.subLogger=function(e){var t=this.subLoggers.filter((function(n){return n.name===e}))[0];if(void 0!==t)return t;Object.keys(this).forEach((function(n){if(n===e)throw new Error("This sub logger name is not allowed.")}));var r=new n(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},n.prototype.publishLevel=function(n){var e;return n&&(this._publishLevel=n),this._publishLevel||(null===(e=this.parent)||void 0===e?void 0:e.publishLevel())},n.prototype.consoleLevel=function(n){var e;return n&&(this._consoleLevel=n),this._consoleLevel||(null===(e=this.parent)||void 0===e?void 0:e.consoleLevel())},n.prototype.log=function(n,e,t){this.publishMessage(e||"info",n,t)},n.prototype.trace=function(n){this.log(n,"trace")},n.prototype.debug=function(n){this.log(n,"debug")},n.prototype.info=function(n){this.log(n,"info")},n.prototype.warn=function(n){this.log(n,"warn")},n.prototype.error=function(n,e){this.log(n,"error")},n.prototype.canPublish=function(n,e){return order$1$1.indexOf(n)>=order$1$1.indexOf(e||this.consoleLevel()||"trace")},n.prototype.publishMessage=function(e,t,r){var i=this.loggerFullName;if("error"===e&&!r){var o=new Error;o.stack&&(t=t+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(e,this.publishLevel())){var l=n.Interop;if(l)try{l.methods({name:n.InteropMethodName}).length>0&&l.invoke(n.InteropMethodName,{msg:""+t,logger:i,level:e})}catch(n){}}if(this.canPublish(e)){var u="";if(this.includeTimeAndLevel){var s=new Date;u="["+(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+":"+s.getMilliseconds())+"] ["+e+"] "}var a=""+u+i+": "+t;switch(e){case"trace":this.logFn.debug(a);break;case"debug":this.logFn.debug?this.logFn.debug(a):this.logFn.log(a);break;case"info":this.logFn.info(a);break;case"warn":this.logFn.warn(a);break;case"error":this.logFn.error(a,r)}}},n.InteropMethodName="T42.AppLogger.Log",n}(),GW_MESSAGE_CREATE_CONTEXT$1$1="create-context",GW_MESSAGE_ACTIVITY_CREATED$1$1="created",GW_MESSAGE_ACTIVITY_DESTROYED$1$1="destroyed",GW_MESSAGE_CONTEXT_CREATED$1$1="context-created",GW_MESSAGE_CONTEXT_ADDED$1$1="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT$1$1="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1$1="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT$1$1="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED$1$1="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT$1$1="update-context",GW_MESSAGE_CONTEXT_UPDATED$1$1="context-updated",GW_MESSAGE_JOINED_ACTIVITY$1$1="joined",ContextMessageReplaySpec$1$1={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT$1$1,GW_MESSAGE_ACTIVITY_CREATED$1$1,GW_MESSAGE_ACTIVITY_DESTROYED$1$1,GW_MESSAGE_CONTEXT_CREATED$1$1,GW_MESSAGE_CONTEXT_ADDED$1$1,GW_MESSAGE_SUBSCRIBE_CONTEXT$1$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1,GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1$1,GW_MESSAGE_DESTROY_CONTEXT$1$1,GW_MESSAGE_CONTEXT_DESTROYED$1$1,GW_MESSAGE_UPDATE_CONTEXT$1$1,GW_MESSAGE_CONTEXT_UPDATED$1$1,GW_MESSAGE_JOINED_ACTIVITY$1$1]}},version$4$1="5.3.0";function prepareConfig$1$1(n,e,t){var r,i,o,l,u,s;if(Utils$1$1.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(n){}}function c(){if(n.application)return n.application;if(t)return t.applicationName;var e=shortid$2$1();return Utils$1$1.isNode()?s?s.applicationConfig.name:"NodeJS"+e:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" ("+e+")":e}var d=function(){var r,i,o,l,u,a,d,h,f,p,g=n.gateway,w=null!==(r=null==g?void 0:g.protocolVersion)&&void 0!==r?r:3,v=null==g?void 0:g.reconnectInterval,m=null==g?void 0:g.reconnectAttempts,y=null==g?void 0:g.ws,b=null==g?void 0:g.sharedWorker,$=null==g?void 0:g.inproc,_=null!==(i=null==g?void 0:g.webPlatform)&&void 0!==i?i:void 0;t&&(y=t.gwURL),Utils$1$1.isNode()&&s&&s.gwURL&&(y=s.gwURL),y||b||$||(y="ws://localhost:8385");var S=c(),I=S;void 0!==t?(d=t.windowId,h=t.pid,t.env&&(f=t.env.env,p=t.env.region),I=null!==(o=t.application)&&void 0!==o?o:"glue-app",a=t.appInstanceId):Utils$1$1.isNode()&&(h=process.pid,s&&(f=s.env,p=s.region,a=s.instanceId));var C=null!==(u=null===(l=n.gateway)||void 0===l?void 0:l.replaySpecs)&&void 0!==u?u:[];return C.push(ContextMessageReplaySpec$1$1),{identity:{application:I,applicationName:S,windowId:d,instance:a,process:h,region:p,environment:f,api:e.version||version$4$1},reconnectInterval:v,ws:y,sharedWorker:b,webPlatform:_,inproc:$,protocolVersion:w,reconnectAttempts:m,replaySpecs:C}}(),h=c();if("undefined"!=typeof window){var f=window,p=f.htmlContainer?f.htmlContainer.containerName+"."+f.htmlContainer.application:null===(r=null==f?void 0:f.glue42gd)||void 0===r?void 0:r.application;p&&(h=p)}return{bus:null!==(i=n.bus)&&void 0!==i&&i,application:h,auth:function(){var e,t,r;return"string"==typeof n.auth?{token:n.auth}:n.auth?n.auth:Utils$1$1.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(e=n.gateway)||void 0===e?void 0:e.webPlatform)||(null===(t=n.gateway)||void 0===t?void 0:t.inproc)||(null===(r=n.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var e,r,i,o=n.logger,l="warn";return o||(o=l),t&&(i=t.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(e=null!=i?i:o.console)&&void 0!==e?e:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:d,metrics:null===(o=n.metrics)||void 0===o||o,contexts:null===(l=n.contexts)||void 0===l||l,version:e.version||version$4$1,libs:null!==(u=e.libs)&&void 0!==u?u:[],customLogger:n.customLogger}}var GW3ContextData$1$1=function(){function n(n,e,t,r){this.updateCallbacks={},this.contextId=n,this.name=e,this.isAnnounced=t,this.activityId=r,this.context={}}return n.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},n.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},n}();function applyContextDelta$1$1(n,e,t){try{if((null==t?void 0:t.canPublish("trace"))&&(null==t||t.trace("applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n))),!e)return n;if(e.reset)return n=__assign$3$1({},e.reset);if(n=deepClone$1$1(n,void 0),e.commands){for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath$1$1(n,o.path):"set"===o.type&&setValueToPath$1$1(n,o.value,o.path)}return n}var l=e.added,u=e.updated,s=e.removed;return l&&Object.keys(l).forEach((function(e){n[e]=l[e]})),u&&Object.keys(u).forEach((function(e){mergeObjectsProperties$1$1(e,n,u)})),s&&s.forEach((function(e){delete n[e]})),n}catch(r){return null==t||t.error("error applying context delta "+JSON.stringify(e)+" on context "+JSON.stringify(n),r),n}}function deepClone$1$1(n,e){if(e=e||new WeakMap,Object(n)!==n)return n;if(n instanceof Set)return new Set(n);if(e.has(n))return e.get(n);var t=n instanceof Date?new Date(n):n instanceof RegExp?new RegExp(n.source,n.flags):n.constructor?new n.constructor:Object.create(null);return e.set(n,t),n instanceof Map&&Array.from(n,(function(n){var r=n[0],i=n[1];return t.set(r,deepClone$1$1(i,e))})),Object.assign.apply(Object,__spreadArrays$1$1([t],Object.keys(n).map((function(t){var r;return(r={})[t]=deepClone$1$1(n[t],e),r}))))}var mergeObjectsProperties$1$1=function(n,e,t){var r=t[n];if(void 0===r)return e;var i=e[n];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(e[n]=r,e):(e[n]=Object.assign({},i,r),e):(e[n]=r,e)};function deepEqual$1$1(n,e){if(n===e)return!0;if(!(n instanceof Object&&e instanceof Object))return!1;if(n.constructor!==e.constructor)return!1;for(var t in n)if(n.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(n[t]!==e[t]){if("object"!=typeof n[t])return!1;if(!deepEqual$1$1(n[t],e[t]))return!1}}for(var t in e)if(e.hasOwnProperty(t)&&!n.hasOwnProperty(t))return!1;return!0}function setValueToPath$1$1(n,e,t){var r,i=t.split(".");for(r=0;r<i.length-1;r++)n[i[r]]||(n[i[r]]={}),"object"!=typeof n[i[r]]&&(n[i[r]]={}),n=n[i[r]];n[i[r]]=e}function deletePath$1$1(n,e){var t,r=e.split(".");for(t=0;t<r.length-1;t++){if(!n[r[t]])return;n=n[r[t]]}delete n[r[t]]}var GW3Bridge$1$1=function(){function n(n){var e,t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._connection=n.connection,this._logger=n.logger,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED$1$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1,GW_MESSAGE_CONTEXT_DESTROYED$1$1,GW_MESSAGE_CONTEXT_UPDATED$1$1]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec$1$1.name,(function(n){var e=n.type;e&&(e===GW_MESSAGE_CONTEXT_CREATED$1$1||e===GW_MESSAGE_CONTEXT_ADDED$1$1||e===GW_MESSAGE_ACTIVITY_CREATED$1$1?t.handleContextCreatedMessage(n):e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1||e===GW_MESSAGE_CONTEXT_UPDATED$1$1||e===GW_MESSAGE_JOINED_ACTIVITY$1$1?t.handleContextUpdatedMessage(n):e!==GW_MESSAGE_CONTEXT_DESTROYED$1$1&&e!==GW_MESSAGE_ACTIVITY_DESTROYED$1$1||t.handleContextDestroyedMessage(n))}))}return Object.defineProperty(n.prototype,"protocolVersion",{get:function(){var n;if(!this._protocolVersion){var e=this._connection.availableDomains.find((function(n){return"context"===n.uri}));this._protocolVersion=null!==(n=null==e?void 0:e.version)&&void 0!==n?n:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){for(var n=0,e=this._gw3Subscriptions;n<e.length;n++){var t=e[n];this._connection.off(t)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},n.prototype.createContext=function(n,e){var t=this;return this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT$1$1,domain:"global",name:n,data:e,lifetime:"retained"}).then((function(r){t._contextNameToId[n]=r.context_id,t._contextIdToName[r.context_id]=n;var i=t._contextNameToData[n]||new GW3ContextData$1$1(r.context_id,n,!0,void 0);return i.isAnnounced=!0,i.name=n,i.contextId=r.context_id,i.context=e,t._contextNameToData[n]=i,r.context_id}))},n.prototype.all=function(){var n=this;return Object.keys(this._contextNameToData).filter((function(e){return n._contextNameToData[e].isAnnounced}))},n.prototype.update=function(n,e){var t;return __awaiter$2$1(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator$1$1(this,(function(u){switch(u.label){case 0:return(r=this._contextNameToData[n])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(n,e)];case 1:i=u.sent(),u.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,e):this.calculateContextDeltaV1(i,e),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(t=o.commands)||void 0===t?void 0:t.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1$1,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(n){l.handleUpdated(r,o,{updaterId:n.peer_id})}))]:[2,Promise.resolve()]}}))}))},n.prototype.set=function(n,e){var t=this,r=this._contextNameToData[n];return r&&r.isAnnounced?this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1$1,domain:"global",context_id:r.contextId,delta:{reset:e}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{reset:e,added:{},removed:[],updated:{}},{updaterId:n.peer_id})})):this.createContext(n,e)},n.prototype.setPath=function(n,e,t){return this.setPathSupported?this.setPaths(n,[{path:e,value:t}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},n.prototype.setPaths=function(n,e){var t=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[n];if(!r||!r.isAnnounced){for(var i={},o=0,l=e;o<l.length;o++){setValueToPath$1$1(i,(c=l[o]).value,c.path)}return this.createContext(n,i)}for(var u=[],s=0,a=e;s<a.length;s++){var c;null===(c=a[s]).value?u.push({type:"remove",path:c.path}):u.push({type:"set",path:c.path,value:c.value})}return this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1$1,domain:"global",context_id:r.contextId,delta:{commands:u}},{},{skipPeerId:!1}).then((function(n){t.handleUpdated(r,{added:{},removed:[],updated:{},commands:u},{updaterId:n.peer_id})}))},n.prototype.get=function(n){var e,t=this,r=this._contextNameToData[n];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&!r.hasCallbacks())return new Promise((function(e,r){return __awaiter$2$1(t,void 0,void 0,(function(){var t=this;return __generator$1$1(this,(function(r){return this.subscribe(n,(function(n,r,i,o){t.unsubscribe(o),e(n)})),[2]}))}))}));var i=null!==(e=null==r?void 0:r.context)&&void 0!==e?e:{};return Promise.resolve(i)},n.prototype.subscribe=function(n,e){var t=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var r=this._contextNameToData[n];if(!r||!r.isAnnounced)return r=r||new GW3ContextData$1$1(void 0,n,!1,void 0),this._contextNameToData[n]=r,r.updateCallbacks[t]=e,Promise.resolve(t);var i,o=r.hasCallbacks();return r.updateCallbacks[t]=e,o||r.joinedActivity||r.context&&r.sentExplicitSubscription?(e(i=deepClone$1$1(r.context),i,[],t),Promise.resolve(t)):this.sendSubscribe(r).then((function(){return t}))},n.prototype.unsubscribe=function(n){for(var e=0,t=Object.keys(this._contextNameToData);e<t.length;e++){var r=t[e],i=(this._contextNameToId[r],this._contextNameToData[r]);if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[n],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},n.prototype.destroy=function(n){var e=this._contextNameToData[n];return e?this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT$1$1,domain:"global",context_id:e.contextId}).then((function(n){})):Promise.reject("context with "+n+" does not exist")},n.prototype.handleUpdated=function(n,e,t){var r=n.context;n.context=applyContextDelta$1$1(n.context,e,this._logger),this._contextNameToData[n.name]!==n||deepEqual$1$1(r,n.context)||this.invokeUpdateCallbacks(n,e,t)},n.prototype.subscribeToContextCreatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_ADDED$1$1,GW_MESSAGE_CONTEXT_CREATED$1$1,GW_MESSAGE_ACTIVITY_CREATED$1$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextCreatedMessage=function(n){var e=n.type;e===GW_MESSAGE_ACTIVITY_CREATED$1$1?(this._contextNameToId[n.activity_id]=n.context_id,this._contextIdToName[n.context_id]=n.activity_id):e===GW_MESSAGE_CONTEXT_ADDED$1$1&&(this._contextNameToId[n.name]=n.context_id,this._contextIdToName[n.context_id]=n.name);var t=this._contextIdToName[n.context_id];if(!t)throw new Error("Received created event for context with unknown name: "+n.context_id);if(!this._contextNameToId[t])throw new Error("Received created event for context with unknown id: "+n.context_id);var r=this._contextNameToData[t];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=n.context_id,r.activityId=n.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[t]=r=new GW3ContextData$1$1(n.context_id,t,!0,n.activity_id)},n.prototype.subscribeToContextUpdatedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_UPDATED$1$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1,GW_MESSAGE_JOINED_ACTIVITY$1$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextUpdatedMessage=function(n){var e=n.type,t=n.context_id,r=this._contextNameToData[this._contextIdToName[t]],i=!r||!r.isAnnounced;if(e===GW_MESSAGE_JOINED_ACTIVITY$1$1)r?(r.contextId=t,r.isAnnounced=!0,r.activityId=n.activity_id):(r=new GW3ContextData$1$1(t,n.activity_id,!0,n.activity_id),this._contextNameToData[n.activity_id]=r,this._contextIdToName[t]=n.activity_id,this._contextNameToId[n.activity_id]=t),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1?((r=r||new GW3ContextData$1$1(t,n.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[n.name]=r,this._contextIdToName[t]=n.name,this._contextNameToId[n.name]=t):this._logger.error("Received 'update' for unknown context: "+t));var o=r.context;if(e===GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1)r.context=n.data||{};else if(e===GW_MESSAGE_JOINED_ACTIVITY$1$1)r.context=n.context_snapshot||{};else{if(e!==GW_MESSAGE_CONTEXT_UPDATED$1$1)throw new Error("Unrecognized context update message "+e);r.context=applyContextDelta$1$1(r.context,n.delta,this._logger)}!i&&deepEqual$1$1(r.context,o)&&e!==GW_MESSAGE_SUBSCRIBED_CONTEXT$1$1||this.invokeUpdateCallbacks(r,n.delta,{updaterId:n.updater_id})},n.prototype.invokeUpdateCallbacks=function(n,e,t){if((e=e||{added:{},updated:{},reset:{},removed:[]}).commands){e.added=e.updated=e.reset={},e.removed=[];for(var r=0,i=e.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&e.removed.push(o.path),setValueToPath$1$1(e.updated,null,o.path)):"set"===o.type&&setValueToPath$1$1(e.updated,o.value,o.path)}}for(var l in n.updateCallbacks)if(n.updateCallbacks.hasOwnProperty(l))try{(0,n.updateCallbacks[l])(deepClone$1$1(n.context),Object.assign({},e.added||{},e.updated||{},e.reset||{}),e.removed,parseInt(l,10),t)}catch(n){this._logger.debug("callback error: "+JSON.stringify(n))}},n.prototype.subscribeToContextDestroyedMessages=function(){for(var n=0,e=[GW_MESSAGE_CONTEXT_DESTROYED$1$1,GW_MESSAGE_ACTIVITY_DESTROYED$1$1];n<e.length;n++){var t=e[n],r=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},n.prototype.handleContextDestroyedMessage=function(n){var e,t;if(n.type===GW_MESSAGE_ACTIVITY_DESTROYED$1$1){if(t=n.activity_id,!(e=this._contextNameToId[t]))return void this._logger.error("Received 'destroyed' for unknown activity: "+n.activity_id)}else if(e=n.context_id,!(t=this._contextIdToName[e]))return void this._logger.error("Received 'destroyed' for unknown context: "+n.context_id);delete this._contextIdToName[e],delete this._contextNameToId[t];var r=this._contextNameToData[t];delete this._contextNameToData[t],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+e)},n.prototype.sendSubscribe=function(n){return n.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT$1$1,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.sendUnsubscribe=function(n){return n.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1$1,domain:"global",context_id:n.contextId}).then((function(n){}))},n.prototype.calculateContextDeltaV1=function(n,e){var t={added:{},updated:{},removed:[],reset:void 0};if(n)for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];-1===Object.keys(e).indexOf(o)||null===e[o]||deepEqual$1$1(n[o],e[o])||(t.updated[o]=e[o])}for(var l=0,u=Object.keys(e);l<u.length;l++){o=u[l];n&&-1!==Object.keys(n).indexOf(o)?null===e[o]&&t.removed.push(o):null!==e[o]&&(t.added[o]=e[o])}return t},n.prototype.calculateContextDeltaV2=function(n,e){for(var t,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(e);o<l.length;o++){var u=l[o];if(null!==e[u])deepEqual$1$1(n?n[u]:null,e[u])||null===(t=i.commands)||void 0===t||t.push({type:"set",path:u,value:e[u]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:u})}return i},n}(),ContextsModule$1$1=function(){function n(n){this._bridge=new GW3Bridge$1$1(n)}return n.prototype.all=function(){return this._bridge.all()},n.prototype.update=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.update(n,e)},n.prototype.set=function(n,e){return this.checkName(n),this.checkData(e),this._bridge.set(n,e)},n.prototype.setPath=function(n,e,t){return this.checkName(n),this.checkPath(e),""===e?(this.checkData(t),this.set(n,t)):this._bridge.setPath(n,e,t)},n.prototype.setPaths=function(n,e){if(this.checkName(n),!Array.isArray(e))throw new Error("Please provide the paths as an array of PathValues!");for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(n,e)},n.prototype.subscribe=function(n,e){var t=this;if(this.checkName(n),"function"!=typeof e)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(n,(function(n,r,i,o,l){return e(n,r,i,(function(){return t._bridge.unsubscribe(o)}),l)})).then((function(n){return function(){t._bridge.unsubscribe(n)}}))},n.prototype.get=function(n){return this.checkName(n),this._bridge.get(n)},n.prototype.ready=function(){return Promise.resolve(this)},n.prototype.destroy=function(n){return this.checkName(n),this._bridge.destroy(n)},Object.defineProperty(n.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),n.prototype.checkName=function(n){if("string"!=typeof n||""===n)throw new Error("Please provide the name as a non-empty string!")},n.prototype.checkPath=function(n){if("string"!=typeof n)throw new Error("Please provide the path as a dot delimited string!")},n.prototype.checkData=function(n){if("object"!=typeof n)throw new Error("Please provide the data as an object!")},n}(),InvokeStatus$1$1;function promisify$1$1(n,e,t){return"function"!=typeof e&&"function"!=typeof t?n:("function"!=typeof e?e=function(){}:"function"!=typeof t&&(t=function(){}),n.then(e,t))}function rejectAfter$1$1(n,e,t){var r;return void 0===n&&(n=0),e.finally((function(){r&&clearTimeout(r)})),new Promise((function(e,i){r=setTimeout((function(){return i(t)}),n)}))}!function(n){n[n.Success=0]="Success",n[n.Error=1]="Error"}(InvokeStatus$1$1||(InvokeStatus$1$1={}));var Client$1$1=function(){function n(n,e,t,r){this.protocol=n,this.repo=e,this.instance=t,this.configuration=r}return n.prototype.subscribe=function(n,e,t,r,i){var o=this,l=function(n,t,r,l){var u;e.methodResponseTimeout=null!==(u=e.methodResponseTimeout)&&void 0!==u?u:e.waitTimeoutMs,o.protocol.client.subscribe(t,e,n,r,l,i)};return promisify$1$1(new Promise((function(t,r){var i,u=function(n){t(n)},s=function(n){r(n)};if(n)if((i="string"==typeof n?{name:n}:n).name){void 0===e&&(e={});var a=e.target;if(void 0===a&&(a="best"),"string"!=typeof a||"all"===a||"best"===a){void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=e.method_response_timeout,void 0===e.methodResponseTimeout&&(e.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=e.wait_for_method_timeout,void 0===e.waitTimeoutMs&&(e.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,d=o.getServerMethodsByFilterAndTarget(i,a);if(d.length>0)l(d,d[0].methods[0],u,s);else{var h=function(){if(a&&e.waitTimeoutMs)if(c+=500,(d=o.getServerMethodsByFilterAndTarget(i,a)).length>0){var t=d[0].methods[0];l(d,t,u,s)}else if(c>=e.waitTimeoutMs){l(d,"string"==typeof n?{name:n}:n,u,s)}else setTimeout(h,500)};setTimeout(h,500)}}else r(new Error('"'+a+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")})),t,r)},n.prototype.servers=function(n){var e=void 0===n?void 0:__assign$3$1({},n);return this.getServers(e).map((function(n){return n.server.instance}))},n.prototype.methods=function(n){return n="string"==typeof n?{name:n}:__assign$3$1({},n),this.getMethods(n)},n.prototype.methodsForInstance=function(n){return this.getMethodsForInstance(n)},n.prototype.methodAdded=function(n){return this.repo.onMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.repo.onMethodRemoved(n)},n.prototype.serverAdded=function(n){return this.repo.onServerAdded(n)},n.prototype.serverRemoved=function(n){return this.repo.onServerRemoved((function(e,t){n(e,t)}))},n.prototype.serverMethodAdded=function(n){return this.repo.onServerMethodAdded((function(e,t){n({server:e,method:t})}))},n.prototype.serverMethodRemoved=function(n){return this.repo.onServerMethodRemoved((function(e,t){n({server:e,method:t})}))},n.prototype.invoke=function(n,e,t,r,i,o){return __awaiter$2$1(this,void 0,void 0,(function(){var l=this;return __generator$1$1(this,(function(u){return[2,promisify$1$1(function(){return __awaiter$2$1(l,void 0,void 0,(function(){var i,o,l,u,s,a,c,d,h,f,p=this;return __generator$1$1(this,(function(g){switch(g.label){case 0:if(!(i="string"==typeof n?{name:n}:__assign$3$1({},n)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(e||(e={}),t||(t="best"),"string"==typeof t&&"all"!==t&&"best"!==t&&"skipMine"!==t)return[2,Promise.reject(new Error('"'+t+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!=typeof e)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,t)).length)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,t,r)];case 2:return o=g.sent(),[3,4];case 3:return g.sent(),l=__assign$3$1(__assign$3$1({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[]}),u={method:l,called_with:e,message:"Can not find a method matching "+JSON.stringify(n)+" with server filter "+JSON.stringify(t),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(u)];case 4:return s=r.methodResponseTimeoutMs,a=r,c=o.map((function(n){var t=shortid$2$1(),r=n.methods[0],i=n.server,o=p.protocol.client.invoke(t,r,e,i,a);return Promise.race([o,rejectAfter$1$1(s,o,{invocationId:t,message:"Invocation timeout ("+s+" ms) reached for method name: "+(null==r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(a),status:InvokeStatus$1$1.Error})])})),[4,Promise.all(c)];case 5:return d=g.sent(),h=this.getInvocationResultObj(d,i,e),d.every((function(n){return n.status===InvokeStatus$1$1.Error}))?[2,Promise.reject(h)]:[2,h]}}))}))}(),i,o)]}))}))},n.prototype.getInvocationResultObj=function(n,e,t){var r=n.filter((function(n){return n.status===InvokeStatus$1$1.Success})).reduce((function(n,r){return n=__spreadArrays$1$1(n,[{executed_by:r.instance,returned:r.result,called_with:t,method:e,message:r.message,status:r.status}])}),[]),i=n.filter((function(n){return n.status===InvokeStatus$1$1.Error})).reduce((function(n,r){return n=__spreadArrays$1$1(n,[{executed_by:r.instance,called_with:t,name:e.name,message:r.message}])}),[]),o=n[0];return{method:e,called_with:t,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},n.prototype.tryToAwaitForMethods=function(n,e,t){var r=this;return new Promise((function(i,o){if(0!==t.waitTimeoutMs)var l=0,u=setInterval((function(){l+=500;var s=r.getServerMethodsByFilterAndTarget(n,e);if(s.length>0)clearInterval(u),i(s);else if(l>=(t.waitTimeoutMs||1e4))return clearInterval(u),void o()}),500);else o()}))},n.prototype.filterByTarget=function(n,e){var t=this;if("string"!=typeof n){return(Array.isArray(n)?n:[n]).reduce((function(n,r){var i=e.filter((function(n){return t.instanceMatch(r,n.server.instance)}));return n.concat(i)}),[])}if("all"===n)return __spreadArrays$1$1(e);if("best"===n){var r=e.find((function(n){return n.server.instance.isLocal}));if(r)return[r];if(void 0!==e[0])return[e[0]]}else if("skipMine"===n)return e.filter((function(n){return n.server.instance.peerId!==t.instance.peerId}));return[]},n.prototype.instanceMatch=function(n,e){return this.containsProps(n,e)},n.prototype.methodMatch=function(n,e){return this.containsProps(n,e)},n.prototype.containsProps=function(n,e){return Object.keys(n).filter((function(e){return void 0!==n[e]&&"function"!=typeof n[e]&&"object_types"!==e&&"display_name"!==e&&"id"!==e&&"gatewayId"!==e&&"identifier"!==e&&"_"!==e[0]})).reduce((function(t,r){var i=n[r],o=e[r];if("objectTypes"===r){(i.length>o.length||!1===function(n,e){var t=n.reduce((function(n,e){return n[e]=!1,n}),{});e.forEach((function(n){void 0!==t[n]&&(t[n]=!0)}));return Object.keys(t).reduce((function(n,e){return t[e]||(n=!1),n}),!0)}(i,o))&&(t=!1)}else String(i).toLowerCase()!==String(o).toLowerCase()&&(t=!1);return t}),!0)},n.prototype.getMethods=function(n){var e=this;return void 0===n?this.repo.getMethods():this.repo.getMethods().filter((function(t){return e.methodMatch(n,t)}))},n.prototype.getMethodsForInstance=function(n){var e=this,t=this.repo.getServers().filter((function(t){return e.instanceMatch(n,t.instance)}));if(0===t.length)return[];var r={};return 1===t.length?r=t[0].methods:t.forEach((function(n){Object.keys(n.methods).forEach((function(e){var t=n.methods[e];r[t.identifier]=t}))})),Object.keys(r).map((function(n){return r[n]}))},n.prototype.getServers=function(n){var e=this,t=this.repo.getServers();return void 0===n?t.map((function(n){return{server:n,methods:[]}})):t.reduce((function(t,r){var i=e.repo.getServerMethodsById(r.id).filter((function(t){return e.methodMatch(n,t)}));return i.length>0&&t.push({server:r,methods:i}),t}),[])},n.prototype.getServerMethodsByFilterAndTarget=function(n,e){var t=this.getServers(n);return this.filterByTarget(e,t)},n}(),ServerSubscription$1$1=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.subscription=t}return Object.defineProperty(n.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),n.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},n.prototype.push=function(n){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,n)},n}(),Request$1$1=function(){function n(n,e,t){this.protocol=n,this.repoMethod=e,this.requestContext=t,this.arguments=t.arguments,this.instance=t.instance}return n.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},n.prototype.acceptOnBranch=function(n){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,n)},n.prototype.reject=function(n){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,n)},n}(),ServerStreaming$2$1=function(){function n(n,e){var t=this;this.protocol=n,this.server=e,n.server.onSubRequest((function(n,e){return t.handleSubRequest(n,e)})),n.server.onSubAdded((function(n,e){return t.handleSubAdded(n,e)})),n.server.onSubRemoved((function(n,e){return t.handleSubRemoved(n,e)}))}return n.prototype.handleSubRequest=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRequestHandler){var t=new Request$1$1(this.protocol,e,n);e.streamCallbacks.subscriptionRequestHandler(t)}},n.prototype.handleSubAdded=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionAddedHandler){var t=new ServerSubscription$1$1(this.protocol,e,n);e.streamCallbacks.subscriptionAddedHandler(t)}},n.prototype.handleSubRemoved=function(n,e){if(e&&e.streamCallbacks&&"function"==typeof e.streamCallbacks.subscriptionRemovedHandler){var t=new ServerSubscription$1$1(this.protocol,e,n);e.streamCallbacks.subscriptionRemovedHandler(t)}},n}(),ServerBranch$1$1=function(){function n(n,e,t){this.key=n,this.protocol=e,this.repoMethod=t}return n.prototype.subscriptions=function(){var n=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(e){return new ServerSubscription$1$1(n.protocol,n.repoMethod,e)}))},n.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},n.prototype.push=function(n){this.protocol.server.pushData(this.repoMethod,n,[this.key])},n}(),ServerStream$1$1=function(){function n(n,e,t){this._protocol=n,this._repoMethod=e,this._server=t,this.name=this._repoMethod.definition.name}return n.prototype.branches=function(n){var e=this,t=this._protocol.server.getBranchList(this._repoMethod);return n?t.indexOf(n)>-1?new ServerBranch$1$1(n,this._protocol,this._repoMethod):void 0:t.map((function(n){return new ServerBranch$1$1(n,e._protocol,e._repoMethod)}))},n.prototype.branch=function(n){return this.branches(n)},n.prototype.subscriptions=function(){var n=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(e){return new ServerSubscription$1$1(n._protocol,n._repoMethod,e)}))},Object.defineProperty(n.prototype,"definition",{get:function(){var n=this._repoMethod.definition;return{accepts:n.accepts,description:n.description,displayName:n.displayName,name:n.name,objectTypes:n.objectTypes,returns:n.returns,supportsStreaming:n.supportsStreaming}},enumerable:!0,configurable:!0}),n.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},n.prototype.push=function(n,e){if("string"!=typeof e&&!Array.isArray(e)&&void 0!==e)throw new Error("invalid branches should be string or string array");if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,n,e)},n.prototype.updateRepoMethod=function(n){this._repoMethod=n},n}(),Server$1$1=function(){function n(n,e){this.protocol=n,this.serverRepository=e,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming$2$1(n,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return n.prototype.createStream=function(n,e,t,r,i){var o=this;return promisify$1$1(new Promise((function(t,r){if(n){var l;if(!(l="string"==typeof n?{name:""+n}:__assign$3$1({},n)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: "+JSON.stringify(l));if(o.serverRepository.getList().some((function(n){return n.definition.name===l.name})))return r('A stream with the name "'+l.name+'" already exists! Please, provide a unique name for the stream.');l.supportsStreaming=!0,e||(e={}),"function"!=typeof e.subscriptionRequestHandler&&(e.subscriptionRequestHandler=function(n){n.accept()});var u=o.serverRepository.add({definition:l,streamCallbacks:e,protocolState:{}});o.protocol.server.createStream(u).then((function(){var n;i?(n=i,i.updateRepoMethod(u)):n=new ServerStream$1$1(o.protocol,u,o),u.stream=n,t(n)})).catch((function(n){u.repoId&&o.serverRepository.remove(u.repoId),r(n)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")})),t,r)},n.prototype.register=function(n,e){var t=this;if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var r=function(n,r){return __awaiter$2$1(t,void 0,void 0,(function(){var t,i,o;return __generator$1$1(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(t=e(n.args,n.instance))&&"function"==typeof t.then?[4,t]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,t),l.label=3;case 3:return[3,5];case 4:return(o=l.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=e,this.registerCore(n,r)},n.prototype.registerAsync=function(n,e){if(!n)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof e)return Promise.reject("The second parameter must be a callback function. Method: "+("string"==typeof n?n:n.name));var t=function(n,t){try{var r=!1,i=function(n){r||t(void 0,n),r=!0},o=function(n){r||(n||(n=""),t(n,n)),r=!0},l=e(n.args,n.instance,i,o);l&&"function"==typeof l.then&&l.then(i).catch(o)}catch(n){t(n,void 0)}};return t.userCallbackAsync=e,this.registerCore(n,t)},n.prototype.unregister=function(n,e){return void 0===e&&(e=!1),__awaiter$2$1(this,void 0,void 0,(function(){var t,r;return __generator$1$1(this,(function(i){switch(i.label){case 0:return void 0===n?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof n?[3,2]:[4,this.unregisterWithPredicate(n,e)];case 1:return i.sent(),[2];case 2:return void 0===(t="string"==typeof n?{name:n}:n).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(n){return n.definition.name===t.name&&(n.definition.supportsStreaming||!1)===e})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+t.name+'" does not exist or is not registered by your application!')];case 3:return i.sent(),[2]}}))}))},n.prototype.unregisterWithPredicate=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t;return __generator$1$1(this,(function(r){switch(r.label){case 0:return(t=this.serverRepository.getList().filter((function(e){return n(e.definition)})).filter((function(n){return(n.definition.supportsStreaming||!1)===e})))&&0!==t.length?[4,this.removeMethodsOrStreams(t)]:[2,Promise.reject("Could not find a "+(e?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},n.prototype.removeMethodsOrStreams=function(n){var e=this,t=[];return n.forEach((function(n){var r=e.protocol.server.unregister(n).then((function(){n.repoId&&e.serverRepository.remove(n.repoId)}));t.push(r),e.addAsCurrentlyUnregistering(n.definition.name,r)})),Promise.all(t)},n.prototype.addAsCurrentlyUnregistering=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t,r=this;return __generator$1$1(this,(function(i){return t=new Promise((function(n){return setTimeout(n,5e3)})),this.currentlyUnregistering[n]=Promise.race([e,t]).then((function(){delete r.currentlyUnregistering[n]})),[2]}))}))},n.prototype.registerCore=function(n,e){return __awaiter$2$1(this,void 0,void 0,(function(){var t,r,i,o=this;return __generator$1$1(this,(function(l){switch(l.label){case 0:return(t="string"==typeof n?{name:""+n}:__assign$3$1({},n)).name?(r=this.currentlyUnregistering[t.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: "+JSON.stringify(n))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(n){return n.definition.name===t.name}))?[2,Promise.reject('A method with the name "'+t.name+'" already exists! Please, provide a unique name for the method.')]:t.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want "+t.name+" to be a stream, please use the glue.interop.createStream() method.")]:(i=this.serverRepository.add({definition:t,theFunction:e,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(n){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),n}))])}}))}))},n.prototype.onMethodInvoked=function(n,e,t){var r=this;n&&n.theFunction&&n.theFunction(t,(function(t,i){if(null!=t)if(t.message&&"string"==typeof t.message)t=t.message;else if("string"!=typeof t)try{t=JSON.stringify(t)}catch(n){t="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(t)}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(n,e,t,i)}))},n}(),InstanceWrapper$1$1=function(){function n(n,e){var t=this;this.wrapped={getMethods:getMethods$1$1,getStreams:getStreams$1$1},n&&this.refreshWrappedObject(n),e&&(e.loggedIn((function(){t.refresh(e)})),this.refresh(e))}return n.prototype.unwrap=function(){return this.wrapped},n.prototype.refresh=function(n){if(n){var e=null==n?void 0:n.resolvedIdentity,t=Object.assign({},null!=e?e:{},{peerId:null==n?void 0:n.peerId});this.refreshWrappedObject(t)}},n.prototype.refreshWrappedObject=function(n){var e,t,r;this.wrapped.user=n.user,this.wrapped.instance=n.instance,this.wrapped.application=null!==(e=n.application)&&void 0!==e?e:shortid$2$1(),this.wrapped.applicationName=n.applicationName,this.wrapped.pid=null!==(r=null!==(t=n.pid)&&void 0!==t?t:n.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=n.machine,this.wrapped.environment=n.environment,this.wrapped.region=n.region,this.wrapped.windowId=n.windowId,this.wrapped.isLocal=!0,this.wrapped.api=n.api,this.wrapped.service=n.service,this.wrapped.peerId=n.peerId},n}();function getMethods$1$1(){var n;return null===(n=InstanceWrapper$1$1.API)||void 0===n?void 0:n.methodsForInstance(this)}function getStreams$1$1(){var n;return null===(n=InstanceWrapper$1$1.API)||void 0===n?void 0:n.methodsForInstance(this).filter((function(n){return n.supportsStreaming}))}var ClientRepository$1$1=function(){function n(n){this.logger=n,this.servers={},this.methodsCount={},this.callbacks=lib$3$1()}return n.prototype.addServer=function(n,e){this.logger.debug("adding server "+e);var t=this.servers[e];if(t)return t.id;var r=new InstanceWrapper$1$1(n),i={id:e,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[e]=i,this.callbacks.execute("onServerAdded",i.instance),e},n.prototype.removeServerById=function(n,e){var t=this,r=this.servers[n];r?(this.logger.debug("removing server "+n),Object.keys(r.methods).forEach((function(e){t.removeServerMethod(n,e)})),delete this.servers[n],this.callbacks.execute("onServerRemoved",r.instance,e)):this.logger.warn("not aware of server "+n+", my state "+JSON.stringify(Object.keys(this.servers)))},n.prototype.addServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");if(!t.methods[e.id]){var r=this.createMethodIdentifier(e),i=this,o={identifier:r,gatewayId:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types||[],accepts:e.input_signature,returns:e.result_signature,supportsStreaming:void 0!==e.flags&&e.flags.streaming,getServers:function(){return i.getServersByMethod(r)}};return o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,t.methods[e.id]=o,this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",o)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",t.instance,o),o}},n.prototype.removeServerMethod=function(n,e){var t=this.servers[n];if(!t)throw new Error("server does not exists");var r=t.methods[e];delete t.methods[e],this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",t.instance,r)},n.prototype.getMethods=function(){var n=this,e={};return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];Object.keys(r.methods).forEach((function(n){var t=r.methods[n];e[t.identifier]=t}))})),Object.keys(e).map((function(n){return e[n]}))},n.prototype.getServers=function(){var n=this,e=[];return Object.keys(this.servers).forEach((function(t){var r=n.servers[t];e.push(r)})),e},n.prototype.getServerMethodsById=function(n){var e=this.servers[n];return Object.keys(e.methods).map((function(n){return e.methods[n]}))},n.prototype.onServerAdded=function(n){var e=this.callbacks.add("onServerAdded",n),t=this.getServers().map((function(n){return n.instance}));return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onMethodAdded=function(n){var e=this.callbacks.add("onMethodAdded",n),t=this.getMethods();return this.returnUnsubWithDelayedReplay(e,t,n)},n.prototype.onServerMethodAdded=function(n){var e=this.callbacks.add("onServerMethodAdded",n),t=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(e){var r=e.methods;Object.keys(r).forEach((function(i){t||n(e.instance,r[i])}))}))}),0),function(){t=!0,e()}},n.prototype.onMethodRemoved=function(n){return this.callbacks.add("onMethodRemoved",n)},n.prototype.onServerRemoved=function(n){return this.callbacks.add("onServerRemoved",n)},n.prototype.onServerMethodRemoved=function(n){return this.callbacks.add("onServerMethodRemoved",n)},n.prototype.getServerById=function(n){return this.servers[n]},n.prototype.reset=function(){var n=this;Object.keys(this.servers).forEach((function(e){n.removeServerById(e,"reset")})),this.servers={},this.methodsCount={}},n.prototype.createMethodIdentifier=function(n){var e=void 0!==n.input_signature?n.input_signature:"",t=void 0!==n.result_signature?n.result_signature:"";return(n.name+e+t).toLowerCase()},n.prototype.getServersByMethod=function(n){var e=this,t=[];return Object.keys(this.servers).forEach((function(r){var i=e.servers[r];Object.keys(i.methods).forEach((function(e){i.methods[e].identifier===n&&t.push(i.instance)}))})),t},n.prototype.returnUnsubWithDelayedReplay=function(n,e,t){var r=!1;return setTimeout((function(){e.forEach((function(n){r||t(n)}))}),0),function(){r=!0,n()}},n}(),ServerRepository$1$1=function(){function n(){this.nextId=0,this.methods=[]}return n.prototype.add=function(n){return n.repoId=String(this.nextId),this.nextId+=1,this.methods.push(n),n},n.prototype.remove=function(n){if("string"!=typeof n)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(e){return e.repoId!==n}))},n.prototype.getById=function(n){if("string"==typeof n)return this.methods.find((function(e){return e.repoId===n}))},n.prototype.getList=function(){return this.methods.map((function(n){return n}))},n.prototype.length=function(){return this.methods.length},n.prototype.reset=function(){this.methods=[]},n}(),SUBSCRIPTION_REQUEST$1$1="onSubscriptionRequest",SUBSCRIPTION_ADDED$1$1="onSubscriptionAdded",SUBSCRIPTION_REMOVED$1$1="onSubscriptionRemoved",ServerStreaming$1$1$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.serverRepository=t,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib$3$1(),this.nextStreamId=0,n.on("add-interest",(function(n){r.handleAddInterest(n)})),n.on("remove-interest",(function(n){r.handleRemoveInterest(n)}))}return n.prototype.acceptRequestOnBranch=function(n,e,t){if("string"!=typeof t&&(t=""),"object"!=typeof e.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(e.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(e,t),i=n.msg.subscription_id,o={id:i,arguments:n.arguments,instance:n.instance,branchKey:t,streamId:r,subscribeMsg:n.msg};e.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED$1$1,o,e)},n.prototype.rejectRequest=function(n,e,t){"string"!=typeof t&&(t=""),this.sendSubscriptionFailed("Subscription rejected by user. "+t,n.msg.subscription_id)},n.prototype.pushData=function(n,e,t){var r=this;if("object"==typeof n&&Array.isArray(n.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof t?t=[t]:(!Array.isArray(t)||t.length<=0)&&(t=[]),n.protocolState.branchKeyToStreamIdMap.filter((function(n){return!t||0===t.length||t.indexOf(n.key)>=0})).map((function(n){return n.streamId})).forEach((function(n){var t={type:"publish",stream_id:n,data:e};r.session.sendFireAndForget(t)}))}},n.prototype.pushDataToSingle=function(n,e,t){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:e.id,data:t};this.session.sendFireAndForget(r)},n.prototype.closeSingleSubscription=function(n,e){n.protocolState.subscriptionsMap&&delete n.protocolState.subscriptionsMap[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(t);e.instance;this.callbacks.execute(SUBSCRIPTION_REMOVED$1$1,e,n)},n.prototype.closeMultipleSubscriptions=function(n,e){var t=this;if("object"==typeof n&&"object"==typeof n.protocolState.subscriptionsMap&&n.protocolState.subscriptionsMap){var r=n.protocolState.subscriptionsMap,i=Object.keys(r).map((function(n){return r[n]}));"string"==typeof e&&(i=i.filter((function(n){return n.branchKey===e}))),i.forEach((function(n){delete r[n.id];var e={type:"drop-subscription",subscription_id:n.id,reason:"Server dropping all subscriptions on stream_id: "+n.streamId};t.session.sendFireAndForget(e)}))}},n.prototype.getSubscriptionList=function(n,e){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var t=n.protocolState.subscriptionsMap,r=Object.keys(t).map((function(n){return t[n]}));return"string"!=typeof e?r:r.filter((function(n){return n.branchKey===e}))},n.prototype.getBranchList=function(n){if("object"!=typeof n)return[];if(!n.protocolState.subscriptionsMap)return[];var e=n.protocolState.subscriptionsMap,t=Object.keys(e).map((function(n){return e[n]})),r=[];return t.forEach((function(n){var e="";"object"==typeof n&&"string"==typeof n.branchKey&&(e=n.branchKey),-1===r.indexOf(e)&&r.push(e)})),r},n.prototype.onSubAdded=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED$1$1,n)},n.prototype.onSubRequest=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST$1$1,n)},n.prototype.onSubRemoved=function(n){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED$1$1,n)},n.prototype.handleRemoveInterest=function(n){var e=this.serverRepository.getById(n.method_id);if("string"==typeof n.subscription_id&&"object"==typeof e&&e.protocolState.subscriptionsMap&&"object"==typeof e.protocolState.subscriptionsMap[n.subscription_id]){var t=e.protocolState.subscriptionsMap[n.subscription_id];delete e.protocolState.subscriptionsMap[n.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED$1$1,t,e)}},n.prototype.onSubscriptionLifetimeEvent=function(n,e){this.callbacks.add(n,e)},n.prototype.getNextStreamId=function(){return this.nextStreamId+++""},n.prototype.handleAddInterest=function(n){var e=this.repository.getServerById(n.caller_id).instance,t={msg:n,arguments:n.arguments_kv||{},instance:e},r=this.serverRepository.getById(n.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[n.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+n.subscription_id+" already exists.",n.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST$1$1,t,r);else{var i="No method with id "+n.method_id+" on this server.";this.sendSubscriptionFailed(i,n.subscription_id)}},n.prototype.sendSubscriptionFailed=function(n,e){var t={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:n,request_id:e};this.session.sendFireAndForget(t)},n.prototype.getStreamId=function(n,e){if("string"!=typeof e&&(e=""),!n.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+n.definition.name+" method without protocol state");var t=n.protocolState.branchKeyToStreamIdMap.filter((function(n){return n.key===e}))[0],r=t?t.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),n.protocolState.branchKeyToStreamIdMap.push({key:e,streamId:r})),r},n}(),ServerProtocol$1$1=function(){function n(n,e,t,r){var i=this;this.session=n,this.clientRepository=e,this.serverRepository=t,this.logger=r,this.callbacks=lib$3$1(),this.streaming=new ServerStreaming$1$1$1(n,e,t),this.session.on("invoke",(function(n){return i.handleInvokeMessage(n)}))}return n.prototype.createStream=function(n){return n.protocolState.subscriptionsMap={},n.protocolState.branchKeyToStreamIdMap=[],this.register(n,!0)},n.prototype.register=function(n,e){var t=this,r=n.definition,i={streaming:e||!1},o={type:"register",methods:[{id:n.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:i,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(o,{methodId:n.repoId}).then((function(){t.logger.debug("registered method "+n.definition.name+" with id "+n.repoId)})).catch((function(e){throw t.logger.warn("failed to register method "+n.definition.name+" with id "+n.repoId+" - "+JSON.stringify(e)),e}))},n.prototype.onInvoked=function(n){this.callbacks.add("onInvoked",n)},n.prototype.methodInvocationResult=function(n,e,t,r){var i;i=t||""===t?{type:"error",request_id:e,reason_uri:"agm.errors.client_error",reason:t,context:r,peer_id:void 0}:{type:"yield",invocation_id:e,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},n.prototype.unregister=function(n){return __awaiter$2$1(this,void 0,void 0,(function(){var e;return __generator$1$1(this,(function(t){switch(t.label){case 0:return e={type:"unregister",methods:[n.repoId]},[4,this.session.send(e)];case 1:return t.sent(),[2]}}))}))},n.prototype.getBranchList=function(n){return this.streaming.getBranchList(n)},n.prototype.getSubscriptionList=function(n,e){return this.streaming.getSubscriptionList(n,e)},n.prototype.closeAllSubscriptions=function(n,e){this.streaming.closeMultipleSubscriptions(n,e)},n.prototype.pushData=function(n,e,t){this.streaming.pushData(n,e,t)},n.prototype.pushDataToSingle=function(n,e,t){this.streaming.pushDataToSingle(n,e,t)},n.prototype.closeSingleSubscription=function(n,e){this.streaming.closeSingleSubscription(n,e)},n.prototype.acceptRequestOnBranch=function(n,e,t){this.streaming.acceptRequestOnBranch(n,e,t)},n.prototype.rejectRequest=function(n,e,t){this.streaming.rejectRequest(n,e,t)},n.prototype.onSubRequest=function(n){this.streaming.onSubRequest(n)},n.prototype.onSubAdded=function(n){this.streaming.onSubAdded(n)},n.prototype.onSubRemoved=function(n){this.streaming.onSubRemoved(n)},n.prototype.handleInvokeMessage=function(n){var e=n.invocation_id,t=n.caller_id,r=n.method_id,i=n.arguments_kv,o=this.serverRepository.getList().filter((function(n){return n.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(t).instance};this.callbacks.execute("onInvoked",o,e,l)}},n}(),UserSubscription$1$1=function(){function n(n,e){this.repository=n,this.subscriptionData=e}return Object.defineProperty(n.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"servers",{get:function(){var n=this;return this.subscriptionData.trackedServers.filter((function(n){return n.subscriptionId})).map((function(e){return n.repository.getServerById(e.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),n.prototype.onData=function(n){if("function"!=typeof n)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(n),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(e){n(e)}))},n.prototype.onClosed=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(n)},n.prototype.onFailed=function(n){},n.prototype.onConnected=function(n){if("function"!=typeof n)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(n)},n.prototype.close=function(){this.subscriptionData.close()},n.prototype.setNewSubscription=function(n){this.subscriptionData=n},n}(),STATUS_AWAITING_ACCEPT$1$1="awaitingAccept",STATUS_SUBSCRIBED$1$1="subscribed",ERR_MSG_SUB_FAILED$1$1="Subscription failed.",ERR_MSG_SUB_REJECTED$1$1="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT$1$1="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT$1$1="ClientInitiated",ClientStreaming$1$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(n){var e=n._tag,t=e.subLocalKey,i=r.subscriptionsList[t];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(n){return n.serverId!==e.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT$1$1){var o="string"==typeof n.reason&&""!==n.reason?' Publisher said "'+n.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED$1$1+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED$1$1&&r.callOnClosedHandlers(i);delete r.subscriptionsList[t]}},this.handleSubscribed=function(n){var e=n._tag.subLocalKey,t=r.subscriptionsList[e];if("object"==typeof t){var i=n._tag.serverId,o=t.trackedServers.filter((function(n){return n.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=n.subscription_id,r.subscriptionIdToLocalKeyMap[n.subscription_id]=e;var l=t.status===STATUS_AWAITING_ACCEPT$1$1;if(t.status=STATUS_SUBSCRIBED$1$1,l){var u=!1,s=t.subscription;s?(s.setNewSubscription(t),t.success(s),u=!0):(s=new UserSubscription$1$1(r.repository,t),t.subscription=s,t.success(s));for(var a=0,c=t.handlers.onConnected;a<c.length;a++){var d=c[a];try{d(s.serverInstance,u)}catch(n){}}}}}},this.handleEventData=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.filter((function(e){return e.subscriptionId===n.subscription_id}));if(1===i.length){var o=n.oob,l=i[0].serverId,u=function(){return{data:n.data,server:r.repository.getServerById(l).instance,requestArguments:t.params.arguments,message:void 0,private:o}},s=t.handlers.onData,a=t.queued.data;s.length>0?s.forEach((function(n){"function"==typeof n&&n(u())})):a.push(u())}}}},this.handleSubscriptionCancelled=function(n){var e=r.subscriptionIdToLocalKeyMap[n.subscription_id];if(void 0!==e){var t=r.subscriptionsList[e];if("object"==typeof t){var i=t.trackedServers.length-1;t.trackedServers=t.trackedServers.filter((function(e){return e.subscriptionId!==n.subscription_id||(t.queued.closers.push(e.serverId),!1)})),t.trackedServers.length===i&&(t.trackedServers.length<=0&&(clearTimeout(t.timeoutId),r.callOnClosedHandlers(t),delete r.subscriptionsList[e]),delete r.subscriptionIdToLocalKeyMap[n.subscription_id])}}},n.on("subscribed",this.handleSubscribed),n.on("event",this.handleEventData),n.on("subscription-cancelled",this.handleSubscriptionCancelled)}return n.prototype.subscribe=function(n,e,t,r,i,o){var l=this;if(0!==t.length){var u=this.getNextSubscriptionLocalKey(),s=this.registerSubscription(u,n,e,r,i,e.methodResponseTimeout||1e4,o);"object"==typeof s?t.forEach((function(t){var r=t.server.id,i=t.methods.find((function(e){return e.name===n.name}));if(i){s.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:e.arguments};l.session.send(o,{serverId:r,subLocalKey:u}).then((function(n){return l.handleSubscribed(n)})).catch((function(n){return l.handleErrorSubscribing(n)}))}else l.logger.error("can not find method "+n.name+" for target "+t.server.id)})):i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$1$1+" Unable to register the user callbacks."})}else i({method:n,called_with:e.arguments,message:ERR_MSG_SUB_FAILED$1$1+" No available servers matched the target params."})},n.prototype.drainSubscriptions=function(){var n=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},n},n.prototype.getNextSubscriptionLocalKey=function(){var n=this.nextSubLocalKey;return this.nextSubLocalKey+=1,n},n.prototype.registerSubscription=function(n,e,t,r,i,o,l){var u=this,s={localKey:n,status:STATUS_AWAITING_ACCEPT$1$1,method:e,params:t,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return u.closeSubscription(n)},subscription:null==l?void 0:l.subscription};return l||(t.onData&&s.handlers.onData.push(t.onData),t.onClosed&&s.handlers.onClosed.push(t.onClosed),t.onConnected&&s.handlers.onConnected.push(t.onConnected)),this.subscriptionsList[n]=s,s.timeoutId=setTimeout((function(){if(void 0!==u.subscriptionsList[n]){var r=u.subscriptionsList[n];r.status===STATUS_AWAITING_ACCEPT$1$1?(i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED$1$1+" Subscription attempt timed out after "+o+" ms."}),delete u.subscriptionsList[n]):r.status===STATUS_SUBSCRIBED$1$1&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(n){return void 0!==n.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(u.callOnClosedHandlers(r),delete u.subscriptionsList[n]))}}),o),s},n.prototype.callOnClosedHandlers=function(n,e){var t,r=n.queued.closers.length,i=r>0?n.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(t=this.repository.getServerById(i).instance),n.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:e||ON_CLOSE_MSG_SERVER_INIT$1$1,requestArguments:n.params.arguments||{},server:t,stream:n.method})}))},n.prototype.closeSubscription=function(n){var e=this,t=this.subscriptionsList[n];"object"==typeof t&&(t.trackedServers.forEach((function(n){void 0!==n.subscriptionId&&(t.queued.closers.push(n.serverId),e.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT$1$1}),delete e.subscriptionIdToLocalKeyMap[n.subscriptionId])})),t.trackedServers=[],this.callOnClosedHandlers(t,ON_CLOSE_MSG_CLIENT_INIT$1$1),delete this.subscriptionsList[n])},n}(),ClientProtocol$1$1=function(){function n(n,e,t){var r=this;this.session=n,this.repository=e,this.logger=t,n.on("peer-added",(function(n){return r.handlePeerAdded(n)})),n.on("peer-removed",(function(n){return r.handlePeerRemoved(n)})),n.on("methods-added",(function(n){return r.handleMethodsAddedMessage(n)})),n.on("methods-removed",(function(n){return r.handleMethodsRemovedMessage(n)})),this.streaming=new ClientStreaming$1$1(n,e,t)}return n.prototype.subscribe=function(n,e,t,r,i,o){this.streaming.subscribe(n,e,t,r,i,o)},n.prototype.invoke=function(n,e,t,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:e.gatewayId,arguments_kv:t};return this.session.send(l,{invocationId:n,serverId:o}).then((function(n){return i.handleResultMessage(n)})).catch((function(n){return i.handleInvocationError(n)}))},n.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},n.prototype.handlePeerAdded=function(n){var e=n.new_peer_id,t=n.identity,r=!n.meta||n.meta.local,i=Number(t.process),o={machine:t.machine,pid:isNaN(i)?t.process:i,instance:t.instance,application:t.application,applicationName:t.applicationName,environment:t.environment,region:t.region,user:t.user,windowId:t.windowId,peerId:e,api:t.api,isLocal:r};this.repository.addServer(o,e)},n.prototype.handlePeerRemoved=function(n){var e=n.removed_id,t=n.reason;this.repository.removeServerById(e,t)},n.prototype.handleMethodsAddedMessage=function(n){var e=this,t=n.server_id;n.methods.forEach((function(n){e.repository.addServerMethod(t,n)}))},n.prototype.handleMethodsRemovedMessage=function(n){var e=this,t=n.server_id,r=n.methods,i=this.repository.getServerById(t);Object.keys(i.methods).forEach((function(n){var o=i.methods[n];r.indexOf(o.gatewayId)>-1&&e.repository.removeServerMethod(t,n)}))},n.prototype.handleResultMessage=function(n){var e=n._tag.invocationId,t=n.result,r=n._tag.serverId;return{invocationId:e,result:t,instance:this.repository.getServerById(r).instance,status:InvokeStatus$1$1.Success,message:""}},n.prototype.handleInvocationError=function(n){if(this.logger.debug("handle invocation error "+JSON.stringify(n)),"_tag"in n){var e=n._tag.invocationId,t=n._tag.serverId,r=this.repository.getServerById(t),i=n.reason;return{invocationId:e,result:n.context,instance:r.instance,status:InvokeStatus$1$1.Error,message:i}}return{invocationId:"",message:n.message,status:InvokeStatus$1$1.Error,error:n}},n}();function gW3ProtocolFactory$1$1(n,e,t,r,i,o){var l,u=i.logger.subLogger("gw3-protocol"),s=new Promise((function(n){l=n})),a=e.domain("agm",["subscribed"]),c=new ServerProtocol$1$1(a,t,r,u.subLogger("server")),d=new ClientProtocol$1$1(a,t,u.subLogger("client"));return a.onJoined((function(i){t.addServer(n,e.peerId),i?function(){u.info("reconnected - will replay registered methods and subscriptions");for(var n=0,e=d.drainSubscriptions();n<e.length;n++){var t=e[n],i=t.method,l=Object.assign({},t.params);u.info("trying to re-subscribe to method "+i.name),o.client.subscribe(i,l,void 0,void 0,t)}var s=r.getList();r.reset();for(var a=0,c=s;a<c.length;a++){var h=c[a],f=h.definition;u.info("re-publishing method "+f.name),h.stream?o.server.createStream(f,h.streamCallbacks,void 0,void 0,h.stream):h.theFunction&&h.theFunction.userCallback?o.register(f,h.theFunction.userCallback):h.theFunction&&h.theFunction.userCallbackAsync&&o.registerAsync(f,h.theFunction.userCallbackAsync)}}():l&&(l({client:d,server:c}),l=void 0)})),a.onLeft((function(){t.reset()})),a.join(),s}var Interop$1$1=function(){function n(n){var e=this;if(void 0===n)throw new Error("configuration is required");if(void 0===n.connection)throw new Error("configuration.connections is required");var t,r=n.connection;if("number"!=typeof n.methodResponseTimeout&&(n.methodResponseTimeout=3e4),"number"!=typeof n.waitTimeoutMs&&(n.waitTimeoutMs=3e4),InstanceWrapper$1$1.API=this,this.instance=new InstanceWrapper$1$1(void 0,r).unwrap(),this.clientRepository=new ClientRepository$1$1(n.logger.subLogger("cRep")),this.serverRepository=new ServerRepository$1$1,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");t=gW3ProtocolFactory$1$1(this.instance,r,this.clientRepository,this.serverRepository,n,this),this.readyPromise=t.then((function(t){return e.protocol=t,e.client=new Client$1$1(e.protocol,e.clientRepository,e.instance,n),e.server=new Server$1$1(e.protocol,e.serverRepository),e}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.serverRemoved=function(n){return this.client.serverRemoved(n)},n.prototype.serverAdded=function(n){return this.client.serverAdded(n)},n.prototype.serverMethodRemoved=function(n){return this.client.serverMethodRemoved(n)},n.prototype.serverMethodAdded=function(n){return this.client.serverMethodAdded(n)},n.prototype.methodRemoved=function(n){return this.client.methodRemoved(n)},n.prototype.methodAdded=function(n){return this.client.methodAdded(n)},n.prototype.methodsForInstance=function(n){return this.client.methodsForInstance(n)},n.prototype.methods=function(n){return this.client.methods(n)},n.prototype.servers=function(n){return this.client.servers(n)},n.prototype.subscribe=function(n,e,t,r){return this.client.subscribe(n,e,t,r)},n.prototype.createStream=function(n,e,t,r){return this.server.createStream(n,e,t,r)},n.prototype.unregister=function(n){return this.server.unregister(n)},n.prototype.registerAsync=function(n,e){return this.server.registerAsync(n,e)},n.prototype.register=function(n,e){return this.server.register(n,e)},n.prototype.invoke=function(n,e,t,r,i,o){return this.client.invoke(n,e,t,r,i,o)},n}(),successMessages$1$1=["subscribed","success"],MessageBus$1$1=function(){function n(n,e){var t=this;this.publish=function(n,e,r){var i=r||{},o=i.routingKey,l=i.target,u=t.removeEmptyValues({type:"publish",topic:n,data:e,peer_id:t.peerId,routing_key:o,target_identity:l});t.session.send(u)},this.subscribe=function(n,e,r){return new Promise((function(i,o){var l=r||{},u=l.routingKey,s=l.target,a=t.removeEmptyValues({type:"subscribe",topic:n,peer_id:t.peerId,routing_key:u,source:s});t.session.send(a).then((function(r){var o=r.subscription_id;t.subscriptions.push({subscription_id:o,topic:n,callback:e,source:s}),i({unsubscribe:function(){return t.session.send({type:"unsubscribe",subscription_id:o,peer_id:t.peerId}),t.subscriptions=t.subscriptions.filter((function(n){return n.subscription_id!==o})),Promise.resolve()}})})).catch((function(n){return o(n)}))}))},this.watchOnEvent=function(){t.session.on("event",(function(n){var e=n.data,r=n.subscription_id,i=n["publisher-identity"],o=t.subscriptions.find((function(n){return n.subscription_id===r}));o&&(o.source?t.keysMatch(o.source,i)&&o.callback(e,o.topic,i):o.callback(e,o.topic,i))}))},this.connection=n,this.logger=e,this.peerId=n.peerId,this.subscriptions=[],this.session=n.domain("bus",successMessages$1$1),this.readyPromise=this.session.join(),this.readyPromise.then((function(){t.watchOnEvent()}))}return n.prototype.ready=function(){return this.readyPromise},n.prototype.removeEmptyValues=function(n){var e={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&null!==n[t]&&(e[t]=n[t])})),e},n.prototype.keysMatch=function(n,e){var t=Object.keys(n),r=!0;return t.forEach((function(t){n[t]!==e[t]&&(r=!1)})),r},n}(),GlueCore$1$1=function(n,e){var t,r=Utils$1$1.getGDMajorVersion(),i=Promise.resolve();if(r){if(r<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");r>=3&&(t=window.glue42gd,i=window.gdPreloadPromise||i)}var o,l,u,s,a,c,d,h=timer$1$1("glue"),f=prepareConfig$1$1(n=n||{},e=e||{},t),p={};function g(n,e,t){(d=u.canPublish("trace"))&&u.trace("registering "+n+" module");var r=function(){e.initTime=t.stop(),e.initEndTime=t.endTime,e.marks=t.marks,d&&u.trace(n+" is ready - "+(t.endTime-t.startTime))};e.initStartTime=t.startTime,e.ready?e.ready().then((function(){r()})):r(),Array.isArray(n)||(n=[n]),n.forEach((function(n){p[n]=e,GlueCore$1$1[n]=e}))}function w(){var n=timer$1$1("interop"),e={connection:o,logger:u.subLogger("interop")};return l=new Interop$1$1(e),Logger$1$1.Interop=l,g(["interop","agm"],l,n),Promise.resolve()}function v(){var n=f.activities&&3===o.protocolVersion;if(f.contexts||n){var e=timer$1$1("contexts");return g("contexts",a=new ContextsModule$1$1({connection:o,logger:u.subLogger("contexts")}),e),a}var t=o.replayer;t&&t.drain(ContextMessageReplaySpec$1$1.name)}function m(){return __awaiter$2$1(this,void 0,void 0,(function(){var n;return __generator$1$1(this,(function(e){return f.bus?(n=timer$1$1("bus"),g("bus",c=new MessageBus$1$1(o,u.subLogger("bus")),n),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function y(n){try{return n.forEach((function(n){!function(n,e){var t=timer$1$1(n),r=e(p);r&&g(n,r,t)}(n.name,n.create)})),Promise.resolve()}catch(n){return Promise.reject(n)}}return i.then((function(){var n,e=timer$1$1("logger");return(u=new Logger$1$1(""+(null===(n=f.connection.identity)||void 0===n?void 0:n.application),void 0,f.customLogger)).consoleLevel(f.logger.console),u.publishLevel(f.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,e),Promise.resolve(void 0)})).then((function(){var n=timer$1$1("connection");o=new Connection$1$1(f.connection,u.subLogger("connection"));var e=Promise.resolve(f.auth);return f.connection&&!f.auth&&(e=t?t.getGWToken().then((function(n){return{gatewayToken:n}})):Promise.reject("You need to provide auth information")),e.then((function(e){var t;if(n.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));return t=e,o.login(t)})).then((function(){return g("connection",o,n),f})).catch((function(n){throw o&&o.logout(),n}))})).then((function(){return Promise.all([(l=timer$1$1("metrics"),a=f.metrics,c=null==t?void 0:t.getMetricsPublishingEnabled,d=f.connection.identity,h=c||function(){return!0},p=null!==(n="boolean"!=typeof a&&a.disableAutoAppSystem)&&void 0!==n&&n,g("metrics",s=metrics$1$1({connection:a?o:void 0,logger:u.subLogger("metrics"),canUpdateMetric:h,system:"Glue42",service:null!==(e=null==d?void 0:d.service)&&void 0!==e?e:"metrics-service",instance:null!==(i=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==i?i:shortid$2$1(),disableAutoAppSystem:p,pagePerformanceMetrics:"boolean"!=typeof a?null==a?void 0:a.pagePerformanceMetrics:void 0}),l),Promise.resolve()),w(),v(),m()]);var n,e,r,i,l,a,c,d,h,p})).then((function(){return l.readyPromise})).then((function(){return y(f.libs||[])})).then((function(){var n=Object.keys(p).map((function(n){var e=p[n];return e.ready?e.ready():Promise.resolve()}));return Promise.all(n)})).then((function(){var r={coreVersion:version$4$1,version:f.version};h.stop();var i={feedback:function(n){l&&l.invoke("T42.ACS.Feedback",n,"best")},info:r,logger:u,interop:l,agm:l,connection:o,metrics:s,contexts:a,bus:c,version:f.version,userConfig:n,done:function(){return null==u||u.info("done called by user..."),o.logout()}};if(i.performance={get glueVer(){return f.version},get glueConfig(){return JSON.stringify(n)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var n=getAllTimers$1$1();return Object.keys(n).map((function(e){var t=n[e];return{name:e,duration:t.endTime-t.startTime,marks:t.marks}}))}},Object.keys(p).forEach((function(n){var e=p[n];i[n]=e})),i.config={},Object.keys(f).forEach((function(n){i.config[n]=f[n]})),e&&e.extOptions&&Object.keys(e.extOptions).forEach((function(n){i.config[n]=null==e?void 0:e.extOptions[n]})),(null==e?void 0:e.enrichGlue)&&e.enrichGlue(i),t&&t.updatePerfData&&t.updatePerfData(i.performance),i.agm){var d=function(n,e,t){return function(){i.logger.warn("glue.js - 'glue.agm."+e+"' method is deprecated, use 'glue.interop."+t+"' instead."),n.apply(i.agm,arguments)}},g=i.agm;g.method_added=d(i.agm.methodAdded,"method_added","methodAdded"),g.method_removed=d(i.agm.methodRemoved,"method_removed","methodRemoved"),g.server_added=d(i.agm.serverAdded,"server_added","serverAdded"),g.server_method_aded=d(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),g.server_method_removed=d(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(n){return Promise.reject({err:n,libs:p})}))};"undefined"!=typeof window&&(window.GlueCore=GlueCore$1$1),GlueCore$1$1.version=version$4$1,GlueCore$1$1.default=GlueCore$1$1;const PromiseWrap$1$1=(n,e,t)=>new Promise(((r,i)=>{let o=!0;const l=setTimeout((()=>{if(!o)return;o=!1;i(t||"Promise timeout hit: "+e)}),e);n().then((n=>{o&&(o=!1,clearTimeout(l),r(n))})).catch((n=>{o&&(o=!1,clearTimeout(l),i(n))}))})),PromisePlus$3=(n,e,t)=>new Promise(((r,i)=>{const o=setTimeout((()=>{i(t||"Promise timeout hit: "+e)}),e);new Promise(n).then((n=>{clearTimeout(o),r(n)})).catch((n=>{clearTimeout(o),i(n)}))})),getRelativeBounds=(n,e,t)=>{if("bottom"===t)return{left:e.left,top:e.top+e.height+0,width:e.width,height:n.height};if("top"===t)return{left:e.left,top:e.top-n.height-0,width:e.width,height:n.height};if("right"===t)return{left:e.left+e.width+0,top:e.top,width:n.width,height:e.height};if("left"===t)return{left:e.left-n.width-0,top:e.top,width:n.width,height:e.height};throw new Error("invalid relativeDirection")},objEqual=(n,e)=>JSON.stringify(n)===JSON.stringify(e),waitFor$1=(n,e)=>{let t=n;return()=>{t--,0===t&&e()}};class GlueController{constructor(n,e){this.portsBridge=n,this.sessionStorage=e}get clientGlue(){return this._clientGlue}get platformWindowId(){return this._platformClientWindowId.slice()}start(n){return __awaiter$3(this,void 0,void 0,(function*(){this._systemGlue=yield this.initSystemGlue(n.glue),logger.setLogger(this._systemGlue.logger)}))}initClientGlue(n,e){return __awaiter$3(this,void 0,void 0,(function*(){const t=yield this.portsBridge.createInternalClient(),r=this.sessionStorage.getWindowDataByName("Platform");this._platformClientWindowId=r?r.windowId:shortid$1$1.generate(),r||this.sessionStorage.saveWindowData({name:"Platform",windowId:this.platformWindowId});const i={application:"Platform",gateway:{webPlatform:{port:t,windowId:this.platformWindowId}}},o=Object.assign({},n,i);return this._clientGlue=e?yield e(o):yield glueWebFactory$1(o),this._clientGlue}))}createPlatformSystemMethod(n){return __awaiter$3(this,void 0,void 0,(function*(){yield this.createMethodAsync(GlueWebPlatformControlName$1$1,n)}))}createPlatformSystemStream(){return __awaiter$3(this,void 0,void 0,(function*(){this._systemStream=yield this.createStream(GlueWebPlatformStreamName$1$1)}))}createWorkspacesStream(){return __awaiter$3(this,void 0,void 0,(function*(){this._workspacesStream=yield this.createStream(GlueWebPlatformWorkspacesStreamName)}))}createWorkspacesEventsReceiver(n){return __awaiter$3(this,void 0,void 0,(function*(){yield this._systemGlue.interop.register("T42.Workspaces.Events",(e=>n(e)))}))}pushSystemMessage(n,e,t){if(!this._systemStream)throw new Error(`Cannot push data to domain: ${n}, because the system stream is not created`);this._systemStream.push({domain:n,operation:e,data:t})}pushWorkspacesMessage(n){if(!this._workspacesStream)throw new Error("Cannot push data to domain: workspaces, because the workspaces stream is not created");this._workspacesStream.push({data:n})}callFrame(n,e,t){return __awaiter$3(this,void 0,void 0,(function*(){const r={operation:n.name,operationArguments:e},i=`Internal Platform->Frame Communication Error. Attempted calling workspace frame: ${t} for operation ${n.name} `;if(n.dataDecoder){const e=n.dataDecoder.run(r.operationArguments);if(!e.ok)throw new Error(`${i} OutBound validation failed: ${JSON.stringify(e.error)}`)}const o=yield this.transmitMessage(GlueWorkspaceFrameClientControlName,r,i,{windowId:t},{methodResponseTimeoutMs:3e4,waitTimeoutMs:3e4});if(n.resultDecoder){const e=n.resultDecoder.run(o);if(!e.ok)throw new Error(`${i} Result validation failed: ${JSON.stringify(e.error)}`)}return o}))}callWindow(n,e,t){return __awaiter$3(this,void 0,void 0,(function*(){const r=n.name,i={domain:"windows",operation:r,data:e},o=`Internal Platform->Window Communication Error. Attempted calling client window: ${t} for operation ${r}. `;if(n.dataDecoder){const e=n.dataDecoder.run(i.data);if(!e.ok)throw new Error(`${o} OutBound validation failed: ${JSON.stringify(e.error)}`)}const l=yield this.transmitMessage(GlueClientControlName$1$1,i,o,{windowId:t},{methodResponseTimeoutMs:3e4,waitTimeoutMs:3e4});if(n.resultDecoder){const e=n.resultDecoder.run(l);if(!e.ok)throw new Error(`${o} Result validation failed: ${JSON.stringify(e.error)}`)}return l}))}setInstanceStartContext(n,e){return __awaiter$3(this,void 0,void 0,(function*(){const t="___instance___"+n;yield this._systemGlue.contexts.set(t,e)}))}setWindowStartContext(n,e){return PromisePlus$3(((t,r)=>{let i;const o=waitFor$1(3,(()=>{t(),i()})),l="___window___"+n;this._clientGlue.contexts.subscribe(l,o).then((n=>{i=n,o()})),this._systemGlue.contexts.set(l,e).then(o).catch(r)}),1e4,"Timed out waiting to set the window context for: "+n)}getServers(){return this._clientGlue.interop.servers()}subscribeForServerAdded(n){return this._clientGlue.interop.serverAdded(n)}subscribeForMethodAdded(n){return this._clientGlue.interop.methodAdded(n)}invokeMethod(n,e,t,r,i,o){return this._clientGlue.interop.invoke(n,e,t,r,i,o)}initSystemGlue(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){const r=yield this.portsBridge.createInternalClient(),i=null!==(t=null===(e=null==n?void 0:n.systemLogger)||void 0===e?void 0:e.level)&&void 0!==t?t:"trace";return yield GlueCore$1$1({application:"Platform",gateway:{webPlatform:{port:r}},logger:i})}))}setContext(n,e){return this._systemGlue.contexts.set(n,e)}createMethodAsync(n,e){return __awaiter$3(this,void 0,void 0,(function*(){yield this._systemGlue.interop.registerAsync(n,e)}))}createStream(n){return __awaiter$3(this,void 0,void 0,(function*(){return this._systemGlue.interop.createStream(n)}))}transmitMessage(n,e,t,r,i){return __awaiter$3(this,void 0,void 0,(function*(){let o;try{if(o=yield this._systemGlue.interop.invoke(n,e,r,i),!o)throw new Error(t+" Received unsupported result from the client - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error(t+" Received unsupported result from the client - empty values collection")}catch(n){if(n&&n.all_errors&&n.all_errors.length){const e=n.all_errors[0].message;throw new Error(`${t} -> Inner message: ${e}`)}throw new Error(`${t} -> Inner message: ${n.message}`)}return o.all_return_values[0].returned}))}}function createRegistry$3$1(n){if(n&&n.errorHandling&&"function"!=typeof n.errorHandling&&"log"!==n.errorHandling&&"silent"!==n.errorHandling&&"throw"!==n.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof n.errorHandling+" was passed");var e=n&&"function"==typeof n.errorHandling&&n.errorHandling,t={};function r(t,r){var i=t instanceof Error?t:new Error(t);if(e)e(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(n)switch(n.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(n,e,i){var o=t[n];return o||(o=[],t[n]=o),o.push(e),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=t[n])||void 0===o?void 0:o.includes(e))try{Array.isArray(i)?e.apply(void 0,i):e.apply(void 0,[i])}catch(e){r(e,n)}}))}),0),function(){var r=t[n];r&&(0===(r=r.reduce((function(n,t,r){return t===e&&n.length===r||n.push(t),n}),[])).length?delete t[n]:t[n]=r)}},execute:function(n){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t[n];if(!o||0===o.length)return[];var l=[];return o.forEach((function(t){try{var i=t.apply(void 0,e);l.push(i)}catch(e){l.push(void 0),r(e,n)}})),l},clear:function(){t={}},clearKey:function(n){t[n]&&delete t[n]}}}createRegistry$3$1.default=createRegistry$3$1;var lib$4$1=createRegistry$3$1;class PortsBridge{constructor(n,e,t){this.gateway=n,this.sessionStorage=e,this.ioc=t,this.registry=lib$4$1(),this.clients={},this.unLoadStarted=!1}start(n){return __awaiter$3(this,void 0,void 0,(function*(){yield this.gateway.start(n),this.setUpGenericMessageHandler(),this.setUpBeforeUnload()}))}createInternalClient(){return __awaiter$3(this,void 0,void 0,(function*(){const n=this.ioc.createMessageChannel();return yield this.gateway.connectClient(n.port1),n.port2}))}onClientUnloaded(n){return this.registry.add("client-unloaded",n)}setUpBeforeUnload(){window.addEventListener("beforeunload",(()=>{this.unLoadStarted=!0;const n={glue42core:{type:Glue42CoreMessageTypes.platformUnload.name}};for(const e in this.clients)this.clients[e].postMessage(n,defaultTargetString)}))}setUpGenericMessageHandler(){window.addEventListener("message",(n=>{var e;const t=null===(e=n.data)||void 0===e?void 0:e.glue42core;if(t&&!this.unLoadStarted){if(t.type===Glue42CoreMessageTypes.clientUnload.name){const e={windowId:t.data.ownWindowId,win:n.source};return this.registry.execute("client-unloaded",e)}return t.type===Glue42CoreMessageTypes.connectionRequest.name?this.handleRemoteConnectionRequest(n.source,n.origin,t.clientId,t.clientType,t.bridgeInstanceId):t.type===Glue42CoreMessageTypes.platformPing.name?this.handlePlatformPing(n.source,n.origin):void 0}}))}handleRemoteConnectionRequest(n,e,t,r,i){return __awaiter$3(this,void 0,void 0,(function*(){const o=this.ioc.createMessageChannel();yield this.gateway.connectClient(o.port1,this.removeClient.bind(this));const l=this.sessionStorage.getBridgeInstanceData(i),u=null==l?void 0:l.appName,s={glue42core:{type:Glue42CoreMessageTypes.connectionAccepted.name,port:o.port2,appName:u,clientId:t,clientType:r}};"child"===r&&(this.clients[t]=n),n.postMessage(s,e,[o.port2])}))}handlePlatformPing(n,e){const t={glue42core:{type:Glue42CoreMessageTypes.platformReady.name}};n.postMessage(t,e)}removeClient(n){n&&this.clients[n]&&delete this.clients[n]}}const windowOperationDecoder=oneOf$1$1(constant$1$1("openWindow"),constant$1$1("windowHello"),constant$1$1("getUrl"),constant$1$1("getTitle"),constant$1$1("setTitle"),constant$1$1("moveResize"),constant$1$1("focus"),constant$1$1("close"),constant$1$1("getBounds"),constant$1$1("registerWorkspaceWindow"),constant$1$1("unregisterWorkspaceWindow")),openWindowConfigDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,url:nonEmptyStringDecoder$1$1,options:optional$1$1(windowOpenSettingsDecoder$1$1)}),openWindowSuccessDecoder=object$1$1({windowId:nonEmptyStringDecoder$1$1,name:nonEmptyStringDecoder$1$1}),simpleWindowDecoder$1$1=object$1$1({windowId:nonEmptyStringDecoder$1$1}),windowBoundsResultDecoder$1$1=object$1$1({windowId:nonEmptyStringDecoder$1$1,bounds:object$1$1({top:number$1$1(),left:number$1$1(),width:nonNegativeNumberDecoder$1$1,height:nonNegativeNumberDecoder$1$1})}),windowUrlResultDecoder$1$1=object$1$1({windowId:nonEmptyStringDecoder$1$1,url:nonEmptyStringDecoder$1$1}),windowMoveResizeConfigDecoder$1$1=object$1$1({windowId:nonEmptyStringDecoder$1$1,top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1),relative:optional$1$1(boolean$1$1())}),windowTitleConfigDecoder$1$1=object$1$1({windowId:nonEmptyStringDecoder$1$1,title:string$1$1()}),workspacesOperationDecoder=oneOf$1$1(constant$1$1("isWindowInWorkspace"),constant$1$1("createWorkspace"),constant$1$1("getAllFramesSummaries"),constant$1$1("getFrameSummary"),constant$1$1("getAllWorkspacesSummaries"),constant$1$1("getWorkspaceSnapshot"),constant$1$1("getAllLayoutsSummaries"),constant$1$1("openWorkspace"),constant$1$1("deleteLayout"),constant$1$1("saveLayout"),constant$1$1("importLayout"),constant$1$1("exportAllLayouts"),constant$1$1("restoreItem"),constant$1$1("maximizeItem"),constant$1$1("focusItem"),constant$1$1("closeItem"),constant$1$1("resizeItem"),constant$1$1("moveFrame"),constant$1$1("getFrameSnapshot"),constant$1$1("forceLoadWindow"),constant$1$1("ejectWindow"),constant$1$1("setItemTitle"),constant$1$1("moveWindowTo"),constant$1$1("addWindow"),constant$1$1("addContainer"),constant$1$1("bundleWorkspace"),constant$1$1("changeFrameState"),constant$1$1("getFrameState"),constant$1$1("frameHello")),frameHelloDecoder=object$1$1({windowId:optional$1$1(nonEmptyStringDecoder$1$1)}),workspaceWindowDataDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,windowId:nonEmptyStringDecoder$1$1,frameId:nonEmptyStringDecoder$1$1,appName:optional$1$1(nonEmptyStringDecoder$1$1),context:optional$1$1(anyJson$1$1()),title:optional$1$1(nonEmptyStringDecoder$1$1)}),isWindowInSwimlaneResultDecoder=object$1$1({inWorkspace:boolean$1$1()}),allParentDecoder=oneOf$1$1(constant$1$1("workspace"),constant$1$1("row"),constant$1$1("column"),constant$1$1("group")),subParentDecoder=oneOf$1$1(constant$1$1("row"),constant$1$1("column"),constant$1$1("group")),frameStateDecoder=oneOf$1$1(constant$1$1("maximized"),constant$1$1("minimized"),constant$1$1("normal")),workspaceBuilderCreateConfigDecoder=object$1$1({saveLayout:optional$1$1(boolean$1$1())}),deleteLayoutConfigDecoder=object$1$1({name:nonEmptyStringDecoder$1$1}),swimlaneWindowDefinitionDecoder=object$1$1({type:optional$1$1(constant$1$1("window")),appName:optional$1$1(nonEmptyStringDecoder$1$1),windowId:optional$1$1(nonEmptyStringDecoder$1$1),context:optional$1$1(anyJson$1$1())}),strictSwimlaneWindowDefinitionDecoder=object$1$1({type:constant$1$1("window"),appName:optional$1$1(nonEmptyStringDecoder$1$1),windowId:optional$1$1(nonEmptyStringDecoder$1$1),context:optional$1$1(anyJson$1$1())}),parentDefinitionDecoder=object$1$1({type:optional$1$1(subParentDecoder),children:optional$1$1(lazy$1$1((()=>array$1$1(oneOf$1$1(swimlaneWindowDefinitionDecoder,parentDefinitionDecoder)))))}),strictParentDefinitionDecoder=object$1$1({type:subParentDecoder,children:optional$1$1(lazy$1$1((()=>array$1$1(oneOf$1$1(strictSwimlaneWindowDefinitionDecoder,strictParentDefinitionDecoder)))))}),stateDecoder=oneOf$1$1(string$1$1().where((n=>"maximized"===n.toLowerCase()),"Expected a case insensitive variation of 'maximized'"),string$1$1().where((n=>"normal"===n.toLowerCase()),"Expected a case insensitive variation of 'normal'")),newFrameConfigDecoder=object$1$1({bounds:optional$1$1(object$1$1({left:optional$1$1(number$1$1()),top:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1)}))}),restoreTypeDecoder=oneOf$1$1(constant$1$1("direct"),constant$1$1("delayed"),constant$1$1("lazy")),restoreWorkspaceConfigDecoder=object$1$1({app:optional$1$1(nonEmptyStringDecoder$1$1),context:optional$1$1(anyJson$1$1()),restoreType:optional$1$1(restoreTypeDecoder),title:optional$1$1(nonEmptyStringDecoder$1$1),reuseWorkspaceId:optional$1$1(nonEmptyStringDecoder$1$1),frameId:optional$1$1(nonEmptyStringDecoder$1$1),lockdown:optional$1$1(boolean$1$1()),activateFrame:optional$1$1(boolean$1$1()),newFrame:optional$1$1(oneOf$1$1(newFrameConfigDecoder,boolean$1$1())),noTabHeader:optional$1$1(boolean$1$1()),inMemoryLayout:optional$1$1(boolean$1$1())}),openWorkspaceConfigDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,restoreOptions:optional$1$1(restoreWorkspaceConfigDecoder)}),workspaceDefinitionDecoder=object$1$1({children:optional$1$1(array$1$1(oneOf$1$1(swimlaneWindowDefinitionDecoder,parentDefinitionDecoder))),context:optional$1$1(anyJson$1$1()),config:optional$1$1(object$1$1({title:optional$1$1(nonEmptyStringDecoder$1$1),position:optional$1$1(nonNegativeNumberDecoder$1$1),isFocused:optional$1$1(boolean$1$1()),noTabHeader:optional$1$1(boolean$1$1())})),frame:optional$1$1(object$1$1({reuseFrameId:optional$1$1(nonEmptyStringDecoder$1$1),newFrame:optional$1$1(oneOf$1$1(boolean$1$1(),newFrameConfigDecoder))}))}),builderConfigDecoder=object$1$1({type:allParentDecoder,definition:optional$1$1(oneOf$1$1(workspaceDefinitionDecoder,parentDefinitionDecoder))}),workspaceCreateConfigDecoder=intersection(workspaceDefinitionDecoder,object$1$1({saveConfig:optional$1$1(object$1$1({saveLayout:optional$1$1(boolean$1$1())}))})),getFrameSummaryConfigDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1}),frameSummaryDecoder=object$1$1({id:nonEmptyStringDecoder$1$1}),workspaceSummaryDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,frameId:nonEmptyStringDecoder$1$1,positionIndex:number$1$1(),title:nonEmptyStringDecoder$1$1,focused:boolean$1$1(),layoutName:optional$1$1(nonEmptyStringDecoder$1$1)}),containerSummaryDecoder=object$1$1({type:subParentDecoder,id:nonEmptyStringDecoder$1$1,frameId:nonEmptyStringDecoder$1$1,workspaceId:nonEmptyStringDecoder$1$1,positionIndex:number$1$1()}),eventTypeDecoder=oneOf$1$1(constant$1$1("frame"),constant$1$1("workspace"),constant$1$1("container"),constant$1$1("window")),streamRequestArgumentsDecoder=object$1$1({type:eventTypeDecoder,branch:nonEmptyStringDecoder$1$1}),workspaceEventActionDecoder=oneOf$1$1(constant$1$1("opened"),constant$1$1("closing"),constant$1$1("closed"),constant$1$1("focus"),constant$1$1("added"),constant$1$1("loaded"),constant$1$1("removed"),constant$1$1("childrenUpdate"),constant$1$1("containerChange"),constant$1$1("maximized"),constant$1$1("minimized"),constant$1$1("normal"),constant$1$1("selected")),workspaceConfigResultDecoder=object$1$1({frameId:nonEmptyStringDecoder$1$1,title:nonEmptyStringDecoder$1$1,positionIndex:nonNegativeNumberDecoder$1$1,name:nonEmptyStringDecoder$1$1,layoutName:optional$1$1(nonEmptyStringDecoder$1$1)}),baseChildSnapshotConfigDecoder=object$1$1({frameId:nonEmptyStringDecoder$1$1,workspaceId:nonEmptyStringDecoder$1$1,positionIndex:number$1$1()}),parentSnapshotConfigDecoder=anyJson$1$1(),swimlaneWindowSnapshotConfigDecoder=intersection(baseChildSnapshotConfigDecoder,object$1$1({windowId:optional$1$1(nonEmptyStringDecoder$1$1),isMaximized:optional$1$1(boolean$1$1()),isFocused:boolean$1$1(),title:optional$1$1(string$1$1()),appName:optional$1$1(nonEmptyStringDecoder$1$1)})),childSnapshotResultDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,config:oneOf$1$1(parentSnapshotConfigDecoder,swimlaneWindowSnapshotConfigDecoder),children:optional$1$1(lazy$1$1((()=>array$1$1(childSnapshotResultDecoder)))),type:oneOf$1$1(constant$1$1("window"),constant$1$1("row"),constant$1$1("column"),constant$1$1("group"))}),workspaceSnapshotResultDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,config:workspaceConfigResultDecoder,children:array$1$1(childSnapshotResultDecoder),frameSummary:frameSummaryDecoder}),customWorkspaceChildSnapshotDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,config:oneOf$1$1(parentSnapshotConfigDecoder,swimlaneWindowSnapshotConfigDecoder),children:optional$1$1(lazy$1$1((()=>array$1$1(customWorkspaceChildSnapshotDecoder)))),type:oneOf$1$1(constant$1$1("window"),constant$1$1("row"),constant$1$1("column"),constant$1$1("group"))}),windowLayoutItemDecoder$2=object$1$1({type:constant$1$1("window"),config:object$1$1({appName:nonEmptyStringDecoder$1$1,url:optional$1$1(nonEmptyStringDecoder$1$1)})}),groupLayoutItemDecoder$2=object$1$1({type:constant$1$1("group"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(windowLayoutItemDecoder$2))}),columnLayoutItemDecoder$2=object$1$1({type:constant$1$1("column"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(groupLayoutItemDecoder$2,windowLayoutItemDecoder$2,lazy$1$1((()=>columnLayoutItemDecoder$2)),lazy$1$1((()=>rowLayoutItemDecoder$2))))}),rowLayoutItemDecoder$2=object$1$1({type:constant$1$1("row"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(columnLayoutItemDecoder$2,groupLayoutItemDecoder$2,windowLayoutItemDecoder$2,lazy$1$1((()=>rowLayoutItemDecoder$2))))}),workspaceLayoutDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,type:constant$1$1("Workspace"),metadata:optional$1$1(anyJson$1$1()),components:array$1$1(object$1$1({type:constant$1$1("Workspace"),state:object$1$1({config:anyJson$1$1(),context:anyJson$1$1(),children:array$1$1(oneOf$1$1(rowLayoutItemDecoder$2,columnLayoutItemDecoder$2,groupLayoutItemDecoder$2,windowLayoutItemDecoder$2))})}))}),workspacesLayoutImportConfigDecoder=object$1$1({layout:workspaceLayoutDecoder,mode:oneOf$1$1(constant$1$1("replace"),constant$1$1("merge"))}),exportedLayoutsResultDecoder=object$1$1({layouts:array$1$1(workspaceLayoutDecoder)}),frameSummaryResultDecoder=object$1$1({id:nonEmptyStringDecoder$1$1}),frameSummariesResultDecoder=object$1$1({summaries:array$1$1(frameSummaryResultDecoder)}),workspaceSummaryResultDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,config:workspaceConfigResultDecoder}),workspaceSummariesResultDecoder=object$1$1({summaries:array$1$1(workspaceSummaryResultDecoder)}),frameSnapshotResultDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,config:anyJson$1$1(),workspaces:array$1$1(workspaceSnapshotResultDecoder)}),layoutSummaryDecoder$2=object$1$1({name:nonEmptyStringDecoder$1$1}),layoutSummariesDecoder=object$1$1({summaries:array$1$1(layoutSummaryDecoder$2)}),simpleWindowOperationSuccessResultDecoder=object$1$1({windowId:nonEmptyStringDecoder$1$1}),voidResultDecoder=anyJson$1$1(),frameStateResultDecoder=object$1$1({state:frameStateDecoder}),resizeConfigDecoder=object$1$1({width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1),relative:optional$1$1(boolean$1$1())}),moveConfigDecoder=object$1$1({top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),relative:optional$1$1(boolean$1$1())}),simpleItemConfigDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1}),frameStateConfigDecoder=object$1$1({frameId:nonEmptyStringDecoder$1$1,requestedState:frameStateDecoder}),setItemTitleConfigDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1,title:nonEmptyStringDecoder$1$1}),moveWindowConfigDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1,containerId:nonEmptyStringDecoder$1$1}),resizeItemConfigDecoder=intersection(simpleItemConfigDecoder,resizeConfigDecoder),moveFrameConfigDecoder=intersection(simpleItemConfigDecoder,moveConfigDecoder),simpleParentDecoder=object$1$1({id:nonEmptyStringDecoder$1$1,type:subParentDecoder}),addWindowConfigDecoder=object$1$1({definition:swimlaneWindowDefinitionDecoder,parentId:nonEmptyStringDecoder$1$1,parentType:allParentDecoder}),addContainerConfigDecoder=object$1$1({definition:strictParentDefinitionDecoder,parentId:nonEmptyStringDecoder$1$1,parentType:allParentDecoder}),addItemResultDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1,windowId:optional$1$1(nonEmptyStringDecoder$1$1)}),pingResultDecoder=object$1$1({live:boolean$1$1()}),bundleConfigDecoder=object$1$1({type:oneOf$1$1(constant$1$1("row"),constant$1$1("column")),workspaceId:nonEmptyStringDecoder$1$1}),containerSummaryResultDecoder=object$1$1({itemId:nonEmptyStringDecoder$1$1,config:parentSnapshotConfigDecoder}),frameStreamDataDecoder=object$1$1({frameSummary:frameSummaryDecoder}),workspaceStreamDataDecoder=object$1$1({workspaceSummary:workspaceSummaryResultDecoder,frameSummary:frameSummaryDecoder}),containerStreamDataDecoder=object$1$1({containerSummary:containerSummaryResultDecoder}),windowStreamDataDecoder=object$1$1({windowSummary:object$1$1({itemId:nonEmptyStringDecoder$1$1,parentId:nonEmptyStringDecoder$1$1,config:swimlaneWindowSnapshotConfigDecoder})}),workspaceLayoutSaveConfigDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,workspaceId:nonEmptyStringDecoder$1$1,saveContext:optional$1$1(boolean$1$1())});class WindowsController$1$1{constructor(n,e,t,r){this.glueController=n,this.sessionController=e,this.stateController=t,this.ioc=r,this.started=!1,this.operations={openWindow:{name:"openWindow",execute:this.openWindow.bind(this),dataDecoder:openWindowConfigDecoder$1$1},windowHello:{name:"windowHello",execute:this.handleWindowHello.bind(this)},getBounds:{name:"getBounds",dataDecoder:simpleWindowDecoder$1$1,resultDecoder:windowBoundsResultDecoder$1$1,execute:this.handleGetBounds.bind(this)},getUrl:{name:"getUrl",dataDecoder:simpleWindowDecoder$1$1,resultDecoder:windowUrlResultDecoder$1$1,execute:this.handleGetUrl.bind(this)},moveResize:{name:"moveResize",dataDecoder:windowMoveResizeConfigDecoder$1$1,execute:this.handleMoveResize.bind(this)},focus:{name:"focus",dataDecoder:simpleWindowDecoder$1$1,execute:this.handleFocus.bind(this)},close:{name:"close",dataDecoder:simpleWindowDecoder$1$1,execute:this.handleClose.bind(this)},getTitle:{name:"getTitle",dataDecoder:simpleWindowDecoder$1$1,resultDecoder:windowTitleConfigDecoder$1$1,execute:this.handleGetTitle.bind(this)},setTitle:{name:"setTitle",dataDecoder:windowTitleConfigDecoder$1$1,execute:this.handleSetTitle.bind(this)},registerWorkspaceWindow:{name:"registerWorkspaceWindow",dataDecoder:workspaceWindowDataDecoder,execute:this.registerWorkspaceWindow.bind(this)},unregisterWorkspaceWindow:{name:"unregisterWorkspaceWindow",dataDecoder:simpleWindowDecoder$1$1,execute:this.handleWorkspaceClientRemoval.bind(this)}}}get logger(){return logger.get("windows.controller")}get moveResizeOperation(){return this.operations.moveResize}get setTitleOperation(){return this.operations.setTitle}start(n){return __awaiter$3(this,void 0,void 0,(function*(){this.clientResponseTimeoutMs=n.windows.windowResponseTimeoutMs,this.defaultBounds=n.windows.defaultWindowOpenBounds,this.started=!0,this.stateController.onWindowDisappeared(this.cleanUpWindow.bind(this))}))}handleControl(n){var e,t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){this.started;const o=n.data,l=n.commandId,u=windowOperationDecoder.run(n.operation);if(!u.ok)throw new Error("This window request cannot be completed, because the operation name did not pass validation: "+JSON.stringify(u.error));const s=u.result,a=null===(e=this.operations[s].dataDecoder)||void 0===e?void 0:e.run(o);if(a&&!a.ok)throw new Error(`Windows request for ${s} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(a.error)}`);null===(t=this.logger)||void 0===t||t.debug(`[${l}] ${s} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[s].execute(o,l),d=null===(r=this.operations[s].resultDecoder)||void 0===r?void 0:r.run(c);if(d&&!d.ok)throw new Error(`Windows request for ${s} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${s} command was executed successfully`),c}))}getWindowTitle(n,e){return __awaiter$3(this,void 0,void 0,(function*(){return(yield this.handleGetTitle({windowId:n},e)).title}))}getWindowBounds(n,e){return __awaiter$3(this,void 0,void 0,(function*(){return(yield this.handleGetBounds({windowId:n},e)).bounds}))}processNewWindow(n,e,t){var r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`processing a new window with id: ${n.windowId} and name: ${n.name}`),this.sessionController.saveWindowData(n),t&&this.stateController.add(t,n.windowId),e&&(null===(i=this.logger)||void 0===i||i.trace("setting the context for window "+n.windowId),yield this.glueController.setWindowStartContext(n.windowId,e)),this.emitStreamData("windowAdded",n)}))}handleWorkspaceClientRemoval(n){return __awaiter$3(this,void 0,void 0,(function*(){return this.cleanUpWindow(n.windowId)}))}handleClientUnloaded(n,e){var t,r,i;if(null===(t=this.logger)||void 0===t||t.trace("handling unloading of "+n),n){if(e.closed)return null===(r=this.logger)||void 0===r||r.trace(n+" detected as closed, processing window cleanup"),this.cleanUpWindow(n);null===(i=this.logger)||void 0===i||i.trace(n+" detected as not closed, adding to state controller"),this.stateController.add(e,n)}}cleanUpWindow(n){this.stateController.remove(n);this.sessionController.fullWindowClean(n)&&this.emitStreamData("windowRemoved",{windowId:n})}registerWorkspaceWindow(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling workspace window registration with id: ${n.windowId} and name: ${n.name}`),this.sessionController.saveWindowData({windowId:n.windowId,name:n.name}),this.sessionController.saveWorkspaceClient({windowId:n.windowId,frameId:n.frameId,initialTitle:n.title}),n.context&&(yield this.glueController.setWindowStartContext(n.windowId,n.context)),this.emitStreamData("windowAdded",{windowId:n.windowId,name:n.name}),null===(r=this.logger)||void 0===r||r.trace(`[${e}] workspace window registered successfully with id ${n.windowId} and name ${n.name}`)}))}emitStreamData(n,e){var t;null===(t=this.logger)||void 0===t||t.trace(`sending notification of event: ${n} with data: ${JSON.stringify(e)}`),this.glueController.pushSystemMessage("windows",n,e)}openWindow(n,e){var t,r,i,o,l,u;return __awaiter$3(this,void 0,void 0,(function*(){if(this.sessionController.getWindowDataByName(n.name))throw new Error(`Cannot open a window with name: ${n.name}, because a window with that name already exists.`);null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling open command with a valid name: ${n.name}, url: ${n.url} and options: ${JSON.stringify(n.options)}`);const s={name:n.name,windowId:null!==(i=null===(r=n.options)||void 0===r?void 0:r.windowId)&&void 0!==i?i:shortid$1$1.generate()},a=yield this.getStartingBounds(n,e),c=`left=${a.left},top=${a.top},width=${a.width},height=${a.height}`;null===(o=this.logger)||void 0===o||o.trace(`[${e}] calling native window open with bounds: ${c}`);const d=window.open(n.url,s.windowId,c);if(!d)throw new Error(`Cannot open window with url: ${n.url} and name: ${n.name}. The most likely reason is that the user has not approved popups or has a blocker.`);return yield this.processNewWindow(s,null===(l=n.options)||void 0===l?void 0:l.context,d),null===(u=this.logger)||void 0===u||u.trace(`[${e}] the new window is opened, saved in session, state and announced, responding to the caller`),s}))}handleWindowHello(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){if(null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a hello message from a real windowId: ${n.windowId}`),n.windowId){this.stateController.remove(n.windowId);const t=this.sessionController.getWorkspaceClientById(n.windowId);if(t&&t.initialTitle){const r=n.windowId,i=t.initialTitle;PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.setTitle,{windowId:r,title:i},r)),this.clientResponseTimeoutMs).catch((n=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.trace(`[${e}] error while setting the workspace window title: ${n.message}`)}))}}const i=!(!n.windowId||!this.sessionController.getFrameData(n.windowId)),o=this.sessionController.getAllWindowsData().map((n=>({windowId:n.windowId,name:n.name})));return null===(r=this.logger)||void 0===r||r.trace(`[${e}] a full list of all current windows has been compiled, sending it to the caller`),{windows:o,isWorkspaceFrame:i}}))}handleGetUrl(n,e){var t;if(!this.sessionController.getWindowDataById(n.windowId))throw new Error(`Cannot get the url of window: ${n.windowId}, because it is does not exist for the platform`);null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a get url request for window ${n.windowId}`);const r=`Cannot get the url of window: ${n.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.getUrl,n,n.windowId)),this.clientResponseTimeoutMs,r)}handleGetTitle(n,e){var t;if(!this.sessionController.getWindowDataById(n.windowId))throw new Error(`Cannot get the title of window: ${n.windowId}, because it is does not exist for the platform`);null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a get title request for window ${n.windowId}`);const r=`Cannot get the title of window: ${n.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.getTitle,n,n.windowId)),this.clientResponseTimeoutMs,r)}handleSetTitle(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){if(!this.sessionController.getWindowDataById(n.windowId))throw new Error(`Cannot set the title of window: ${n.windowId}, because it is does not exist for the platform`);this.sessionController.getWorkspaceClientById(n.windowId)&&(yield this.ioc.workspacesController.setItemTitle({itemId:n.windowId,title:n.title},e)),null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a set title request for window ${n.windowId} and title: ${n.title}`);const r=`Cannot set the title of window: ${n.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;yield PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.setTitle,n,n.windowId)),this.clientResponseTimeoutMs,r)}))}handleMoveResize(n,e){var t;if(this.sessionController.getWorkspaceClientById(n.windowId))throw new Error(`Cannot move resize window id ${n.windowId}, because it is in a workspace. Consider using the workspaces API to get more control`);const r=this.sessionController.getWindowDataById(n.windowId);if(!r)throw new Error(`Cannot move resize window: ${n.windowId}, because it is does not exist for the platform`);if("Platform"===r.name)throw new Error("Move-resizing the main application is not allowed");null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a move resize request for window ${n.windowId} and data: ${JSON.stringify(n)}`);const i=`Cannot move resize window: ${n.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.moveResize,n,n.windowId)),this.clientResponseTimeoutMs,i)}handleGetBounds(n,e){var t;if(this.sessionController.getWorkspaceClientById(n.windowId))throw new Error(`Cannot get bounds of window id ${n.windowId}, because it is in a workspace. Consider using the workspaces API to get more info`);if(!this.sessionController.getWindowDataById(n.windowId))throw new Error(`Cannot get the bounds of window: ${n.windowId}, because it is does not exist for the platform`);null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a get bounds request for window ${n.windowId}`);const r=`Cannot get the bounds of window: ${n.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap$1$1((()=>this.glueController.callWindow(this.operations.getBounds,n,n.windowId)),this.clientResponseTimeoutMs,r)}handleFocus(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){if(this.sessionController.getWorkspaceClientById(n.windowId))throw new Error(`Cannot focus window id ${n.windowId}, because it is in a workspace. Consider using the workspaces API to get more control`);const r=this.sessionController.getWindowDataById(n.windowId);if(!r)throw new Error(`Cannot focus window: ${n.windowId}, because it is not known by the platform`);if("Platform"===r.name)throw new Error("Focusing the main application is not allowed");null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling a focus request for window ${n.windowId}`),window.open(void 0,r.windowId)}))}handleClose(n,e){var t,r,i,o;return __awaiter$3(this,void 0,void 0,(function*(){if(this.sessionController.getWorkspaceClientById(n.windowId))return null===(t=this.logger)||void 0===t||t.trace(`[${e}] this window is detected as a workspace window, closing via the workspaces controller`),void(yield this.ioc.workspacesController.closeItem({itemId:n.windowId},e));const l=this.sessionController.getWindowDataById(n.windowId);if(!l)throw new Error(`Cannot close window: ${n.windowId}, because it is not known by the platform`);if("Platform"===l.name)throw new Error("Closing the main application is not allowed");null===(r=this.logger)||void 0===r||r.trace(`[${e}] handling a close request for window ${n.windowId}`),null===(i=window.open(void 0,l.windowId))||void 0===i||i.close(),this.cleanUpWindow(l.windowId),null===(o=this.logger)||void 0===o||o.trace(`[${e}] window ${n.windowId} has been closed, removed from session, state and announced`)}))}getStartingBounds(n,e){var t,r,i,o,l,u,s,a,c,d;return __awaiter$3(this,void 0,void 0,(function*(){const h={top:null!==(r=null===(t=n.options)||void 0===t?void 0:t.top)&&void 0!==r?r:this.defaultBounds.top,left:null!==(o=null===(i=n.options)||void 0===i?void 0:i.left)&&void 0!==o?o:this.defaultBounds.left,height:null!==(u=null===(l=n.options)||void 0===l?void 0:l.height)&&void 0!==u?u:this.defaultBounds.height,width:null!==(a=null===(s=n.options)||void 0===s?void 0:s.width)&&void 0!==a?a:this.defaultBounds.width};if(!(null===(c=n.options)||void 0===c?void 0:c.relativeTo))return h;const f=n.options.relativeTo,p=this.sessionController.getWindowDataById(f);if(!p)return h;try{const t=(yield this.handleGetBounds({windowId:p.windowId},e)).bounds,r=null!==(d=n.options.relativeDirection)&&void 0!==d?d:"right";return getRelativeBounds(h,t,r)}catch(n){return h}}))}}class SessionStorageController{constructor(){this.windowsNamespace="g42_core_windows",this.instancesNamespace="g42_core_instances",this.bridgeInstancesNamespace="g42_core_bridge",this.nonGlueNamespace="g42_core_nonglue",this.workspaceWindowsNamespace="g42_core_workspace_clients",this.workspaceFramesNamespace="g42_core_workspace_frames",this.layoutNamespace="g42_core_layouts",this.appDefsNamespace="g42_core_app_definitions",this.sessionStorage=window.sessionStorage,[this.bridgeInstancesNamespace,this.windowsNamespace,this.instancesNamespace,this.nonGlueNamespace,this.workspaceWindowsNamespace,this.workspaceFramesNamespace,this.layoutNamespace,this.appDefsNamespace].forEach((n=>{this.sessionStorage.getItem(n)||this.sessionStorage.setItem(n,JSON.stringify([]))}))}get logger(){return logger.get("session.storage")}getAllApps(){return JSON.parse(this.sessionStorage.getItem(this.appDefsNamespace))}overwriteApps(n){this.sessionStorage.setItem(this.appDefsNamespace,JSON.stringify(n))}removeApp(n){const e=this.getAllApps(),t=e.find((e=>e.name===n));return t&&this.sessionStorage.setItem(this.appDefsNamespace,JSON.stringify(e.filter((e=>e.name!==n)))),t}getLayoutSnapshot(){return{layouts:JSON.parse(this.sessionStorage.getItem(this.layoutNamespace))}}saveLayoutSnapshot(n){this.sessionStorage.setItem(this.layoutNamespace,JSON.stringify(n.layouts))}saveFrameData(n){const e=JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace));e.some((e=>e.windowId===n.windowId))||(e.push(n),this.sessionStorage.setItem(this.workspaceFramesNamespace,JSON.stringify(e)))}getAllFrames(){return JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace))}getFrameData(n){return JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace)).find((e=>e.windowId===n))}setFrameActive(n){const e=JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace)),t=e.find((e=>e.windowId===n));t&&!t.active&&(t.active=!0,this.sessionStorage.setItem(this.workspaceFramesNamespace,JSON.stringify(e)))}removeFrameData(n){return!!n&&this.doRemove(n,this.workspaceFramesNamespace)}saveWorkspaceClient(n){const e=JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace));e.some((e=>e.windowId===n.windowId))||(e.push(n),this.sessionStorage.setItem(this.workspaceWindowsNamespace,JSON.stringify(e)))}getWorkspaceClientById(n){return JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace)).find((e=>e.windowId===n))}pickWorkspaceClients(n){return JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace)).filter(n)}removeWorkspaceClient(n){return!!n&&this.doRemove(n,this.workspaceWindowsNamespace)}getAllNonGlue(){return JSON.parse(this.sessionStorage.getItem(this.nonGlueNamespace))}saveNonGlue(n){var e,t;const r=JSON.parse(this.sessionStorage.getItem(this.nonGlueNamespace));return r.some((e=>e.windowId===n.windowId))?(null===(e=this.logger)||void 0===e||e.trace(`did not save this data: ${JSON.stringify(n)}, because an entry with this id already exists`),!1):(null===(t=this.logger)||void 0===t||t.trace("saving non glue window with id: "+n.windowId),r.push(n),this.sessionStorage.setItem(this.nonGlueNamespace,JSON.stringify(r)),!0)}removeNonGlue(n){var e;return!(!n||!n.windowId)&&(null===(e=this.logger)||void 0===e||e.trace("removing non glue window with id: "+n.windowId),this.doRemove(n.windowId,this.nonGlueNamespace))}saveBridgeInstanceData(n){var e,t;const r=JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace));r.some((e=>e.windowId===n.windowId))?null===(e=this.logger)||void 0===e||e.trace(`did not save this data: ${JSON.stringify(n)}, because an entry with this id already exists`):(null===(t=this.logger)||void 0===t||t.trace(`saving new instance with id: ${n.windowId} and app name: ${n.appName}`),r.push(n),this.sessionStorage.setItem(this.bridgeInstancesNamespace,JSON.stringify(r)))}getBridgeInstanceData(n){return JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace)).find((e=>e.windowId===n))}removeBridgeInstanceData(n){const e=JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace));this.sessionStorage.setItem(this.bridgeInstancesNamespace,JSON.stringify(e.filter((e=>e.windowId!==n))))}saveInstanceData(n){var e,t;const r=JSON.parse(this.sessionStorage.getItem(this.instancesNamespace));r.some((e=>e.id===n.id))?null===(e=this.logger)||void 0===e||e.trace(`did not save this data: ${JSON.stringify(n)}, because an entry with this id already exists`):(null===(t=this.logger)||void 0===t||t.trace(`saving new instance with id: ${n.id} and app name: ${n.applicationName}`),r.push(n),this.sessionStorage.setItem(this.instancesNamespace,JSON.stringify(r)))}removeInstance(n){var e;null===(e=this.logger)||void 0===e||e.trace("removing instance with id: "+n);const t=this.getAllInstancesData();this.sessionStorage.setItem(this.instancesNamespace,JSON.stringify(t.filter((e=>e.id!==n)))),this.removeBridgeInstanceData(n)}getInstanceData(n){return this.getAllInstancesData().find((e=>e.id===n))}getAllInstancesData(){return JSON.parse(this.sessionStorage.getItem(this.instancesNamespace))}saveWindowData(n){var e,t;const r=JSON.parse(this.sessionStorage.getItem(this.windowsNamespace));r.some((e=>e.name===n.name))?null===(e=this.logger)||void 0===e||e.trace(`did not save this data: ${JSON.stringify(n)}, because an entry with this name already exists`):(null===(t=this.logger)||void 0===t||t.trace(`saving window with id: ${n.windowId} and name: ${window.name}`),r.push(n),this.sessionStorage.setItem(this.windowsNamespace,JSON.stringify(r)))}getAllWindowsData(){return JSON.parse(this.sessionStorage.getItem(this.windowsNamespace))}getWindowDataById(n){return this.getAllWindowsData().find((e=>e.windowId===n))}getWindowDataByName(n){return this.getAllWindowsData().find((e=>e.name===n))}removeWindowData(n){var e;return!!n&&(null===(e=this.logger)||void 0===e||e.trace("removing window with id: "+n),this.doRemove(n,this.windowsNamespace))}fullWindowClean(n){const e=this.removeWindowData(n),t=this.removeNonGlue({windowId:n}),r=this.removeWorkspaceClient(n);return e||t||r}doRemove(n,e){const t=JSON.parse(this.sessionStorage.getItem(e)).reduce(((e,t)=>(t.windowId===n?e.removed=!0:e.newData.push(t),e)),{removed:!1,newData:[]});return this.sessionStorage.setItem(e,JSON.stringify(t.newData)),t.removed}}class StateController{constructor(n){this.sessionStorage=n,this.registry=lib$4$1(),this.checkIntervalMs=500,this.childrenToCheck=[],this.checkerCancelled=!1}get logger(){return logger.get("state.controller")}start(){this.sessionStorage.getAllNonGlue().forEach((n=>{var e;null===(e=this.logger)||void 0===e||e.trace(`detected non glue window with id ${n.windowId} from previous session, attempting reference refresh`);const t=window.open(void 0,n.windowId);t&&this.childrenToCheck.push({window:t,windowId:n.windowId})})),this.checkWindows()}add(n,e){var t;null===(t=this.logger)||void 0===t||t.trace(`adding window id: ${e} to non glue state checking`);this.sessionStorage.saveNonGlue({windowId:e})&&this.childrenToCheck.push({window:n,windowId:e})}remove(n){var e;null===(e=this.logger)||void 0===e||e.trace(`removing window id: ${n} from non glue state checking`),this.sessionStorage.removeNonGlue({windowId:n}),this.childrenToCheck=this.childrenToCheck.filter((e=>e.windowId!==n))}cancel(){this.currentTimeout&&clearTimeout(this.currentTimeout),this.checkerCancelled=!0}onWindowDisappeared(n){return this.registry.add("window-disappear",n)}checkWindows(){this.checkerCancelled||(this.childrenToCheck.forEach((n=>{var e;if(!n.window||n.window.closed)return null===(e=this.logger)||void 0===e||e.trace(`non glue window ${n.windowId} has disappeared, removing from collections and announcing.`),this.remove(n.windowId),void this.registry.execute("window-disappear",n.windowId)})),this.currentTimeout=setTimeout(this.checkWindows.bind(this),this.checkIntervalMs))}}const appManagerOperationTypesDecoder$1$1=oneOf$1$1(constant$1$1("appHello"),constant$1$1("applicationStart"),constant$1$1("instanceStop"),constant$1$1("registerWorkspaceApp"),constant$1$1("unregisterWorkspaceApp"),constant$1$1("export"),constant$1$1("import"),constant$1$1("remove")),basicInstanceDataDecoder$1$1=object$1$1({id:nonEmptyStringDecoder$1$1}),instanceDataDecoder$1$1=object$1$1({id:nonEmptyStringDecoder$1$1,applicationName:nonEmptyStringDecoder$1$1}),applicationDataDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,createOptions:applicationDetailsDecoder$1$1,instances:array$1$1(instanceDataDecoder$1$1),userProperties:optional$1$1(anyJson$1$1()),title:optional$1$1(nonEmptyStringDecoder$1$1),version:optional$1$1(nonEmptyStringDecoder$1$1),icon:optional$1$1(nonEmptyStringDecoder$1$1),caption:optional$1$1(nonEmptyStringDecoder$1$1)}),baseApplicationDataDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,createOptions:applicationDetailsDecoder$1$1,userProperties:optional$1$1(anyJson$1$1()),title:optional$1$1(nonEmptyStringDecoder$1$1),version:optional$1$1(nonEmptyStringDecoder$1$1),icon:optional$1$1(nonEmptyStringDecoder$1$1),caption:optional$1$1(nonEmptyStringDecoder$1$1)}),appHelloSuccessDecoder$1$1=object$1$1({apps:array$1$1(applicationDataDecoder$1$1)}),appHelloDecoder=object$1$1({windowId:optional$1$1(nonEmptyStringDecoder$1$1)}),applicationStartConfigDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,context:optional$1$1(anyJson$1$1()),top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$1$1),height:optional$1$1(nonNegativeNumberDecoder$1$1),relativeTo:optional$1$1(nonEmptyStringDecoder$1$1),relativeDirection:optional$1$1(oneOf$1$1(constant$1$1("top"),constant$1$1("left"),constant$1$1("right"),constant$1$1("bottom"))),waitForAGMReady:optional$1$1(boolean$1$1())}),appsImportOperationDecoder=object$1$1({definitions:array$1$1(allApplicationDefinitionsDecoder),mode:oneOf$1$1(constant$1$1("replace"),constant$1$1("merge"))}),appRemoveConfigDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1}),appsExportOperationDecoder$1$1=object$1$1({definitions:array$1$1(glueCoreAppDefinitionDecoder)});class ApplicationsController{constructor(n,e,t,r){this.glueController=n,this.sessionStorage=e,this.stateController=t,this.ioc=r,this.applicationStartTimeoutMs=15e3,this.started=!1,this.locks={},this.operations={appHello:{name:"appHello",dataDecoder:appHelloDecoder,resultDecoder:appHelloSuccessDecoder$1$1,execute:this.handleAppHello.bind(this)},applicationStart:{name:"applicationStart",dataDecoder:applicationStartConfigDecoder$1$1,resultDecoder:instanceDataDecoder$1$1,execute:this.handleApplicationStart.bind(this)},instanceStop:{name:"instanceStop",dataDecoder:basicInstanceDataDecoder$1$1,execute:this.handleInstanceStop.bind(this)},registerWorkspaceApp:{name:"registerWorkspaceApp",dataDecoder:workspaceWindowDataDecoder,execute:this.registerWorkspaceApp.bind(this)},unregisterWorkspaceApp:{name:"unregisterWorkspaceApp",dataDecoder:simpleWindowDecoder$1$1,execute:this.unregisterWorkspaceApp.bind(this)},import:{name:"import",dataDecoder:appsImportOperationDecoder,execute:this.handleImport.bind(this)},remove:{name:"remove",dataDecoder:appRemoveConfigDecoder$1$1,execute:this.handleRemove.bind(this)},export:{name:"export",resultDecoder:appsExportOperationDecoder$1$1,execute:this.handleExport.bind(this)}}}get logger(){return logger.get("applications.controller")}start(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){this.config=n.applications,this.defaultBounds=n.windows.defaultWindowOpenBounds,null===(e=this.logger)||void 0===e||e.trace("initializing applications"),yield this.setupApps(this.config),this.started=!0,this.stateController.onWindowDisappeared(this.processInstanceClosed.bind(this)),null===(t=this.logger)||void 0===t||t.trace("initialization is completed")}))}setupApps(n){return __awaiter$3(this,void 0,void 0,(function*(){if(n.local&&n.local.length){const e=n.local.map((n=>this.parseDefinition(n))),t=this.sessionStorage.getAllApps();this.mergeImport(t,e)}}))}handleControl(n){var e,t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){this.started;const o=n.data,l=n.commandId,u=appManagerOperationTypesDecoder$1$1.run(n.operation);if(!u.ok)throw new Error("This appManager request cannot be completed, because the operation name did not pass validation: "+JSON.stringify(u.error));const s=u.result,a=null===(e=this.operations[s].dataDecoder)||void 0===e?void 0:e.run(o);if(a&&!a.ok)throw new Error(`AppManager request for ${s} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(a.error)}`);null===(t=this.logger)||void 0===t||t.debug(`[${l}] ${s} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[s].execute(o,l),d=null===(r=this.operations[s].resultDecoder)||void 0===r?void 0:r.run(c);if(d&&!d.ok)throw new Error(`AppManager request for ${s} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${s} command was executed successfully`),c}))}handleClientUnloaded(n,e){var t,r,i;if(null===(t=this.logger)||void 0===t||t.trace("handling unloading of "+n),n)return e.closed?(null===(r=this.logger)||void 0===r||r.trace(n+" detected as closed, processing instance closed"),this.processInstanceClosed(n)):void(null===(i=this.logger)||void 0===i||i.trace(n+" detected as closed, skipping instance closed procedure"))}unregisterWorkspaceApp(n){this.processInstanceClosed(n.windowId),this.ioc.windowsController.cleanUpWindow(n.windowId)}handleApplicationStart(n,e){var t,r,i,o,l,u,s;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling application start command for application: ${n.name}`);const a=this.sessionStorage.getAllApps().find((e=>e.name===n.name));if(!a)throw new Error(`Cannot start an instance of application: ${n.name}, because it is not found.`);const c={id:shortid$1$1.generate(),applicationName:n.name},d=yield this.getStartingBounds(a.createOptions,n,e),h=`left=${d.left},top=${d.top},width=${d.width},height=${d.height}`;null===(r=this.logger)||void 0===r||r.trace(`[${e}] open arguments are valid, opening to bounds: ${h}`);const f=window.open(a.createOptions.url,c.id,h);if(!f)throw new Error(`Cannot an instance with url: ${a.createOptions.url} for application: ${n.name}. The most likely reason is that the user has not approved popups or has a blocker.`);if(this.sessionStorage.saveBridgeInstanceData({windowId:c.id,appName:c.applicationName}),null===(i=this.logger)||void 0===i||i.trace(`[${e}] the new window has been opened successfully with id: ${c.id}, checking for AGM ready and notifying windows`),n.waitForAGMReady&&(null===(o=this.logger)||void 0===o||o.trace(`[${e}] wait for AGM is set, configuring the lock`),this.setLock(c.id)),yield this.notifyWindows(c,n.context,f),this.locks[c.id])try{yield PromiseWrap$1$1((()=>{var n;return null===(n=this.locks[c.id])||void 0===n?void 0:n.keyOne}),this.applicationStartTimeoutMs)}catch(e){throw new Error(`Application start for ${n.name} timed out waiting for client to initialize Glue`)}null===(l=this.logger)||void 0===l||l.trace(`[${e}] the windows controller has been successfully notified`);const p={data:c,monitorState:n.waitForAGMReady?void 0:{child:f},context:n.context};return yield this.processNewInstance(p),null===(u=this.logger)||void 0===u||u.trace(`[${e}] the new instance with id ${c.id} has been saved, announced and context set, lifting key two and responding to caller`),null===(s=this.locks[c.id])||void 0===s||s.openKeyTwo(),c}))}processInstanceClosed(n){if(!n)return;const e=this.sessionStorage.getInstanceData(n);e&&(this.sessionStorage.removeInstance(e.id),this.emitStreamData("instanceStopped",e))}notifyWindows(n,e,t){return __awaiter$3(this,void 0,void 0,(function*(){const r={windowId:n.id,name:`${n.applicationName}_${n.id}`};yield this.ioc.windowsController.processNewWindow(r,e,t)}))}handleAppHello(n,e){var t,r,i,o,l;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling hello message for id: ${n.windowId}`),n.windowId&&this.locks[n.windowId]&&(null===(r=this.logger)||void 0===r||r.trace(`[${e}] found an app lock, unlocking key one and waiting for the second one`),this.locks[n.windowId].openKeyOne(),yield this.locks[n.windowId].keyTwo,delete this.locks[n.windowId],null===(i=this.logger)||void 0===i||i.trace(`[${e}] the lock is lifted, proceeding`));const u=this.sessionStorage.getAllInstancesData(),s=this.sessionStorage.getAllApps().map((n=>{const e=u.filter((e=>e.applicationName===n.name));return Object.assign({},n,{instances:e})}));if(n.windowId){null===(o=this.logger)||void 0===o||o.trace(`[${e}] there is a valid windowId, removing ${n.windowId} from the state controller`),this.stateController.remove(n.windowId);const t=s.find((e=>e.instances.some((e=>e.id===n.windowId))));if(t&&t.title){const r=n.windowId,i=t.title;PromiseWrap$1$1((()=>this.glueController.callWindow(this.ioc.windowsController.setTitleOperation,{windowId:r,title:i},r)),2e4).catch((n=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.trace(`[${e}] error while setting the application instance title: ${n.message}`)}))}}const a={apps:s};return null===(l=this.logger)||void 0===l||l.trace(`[${e}] compiled a list of all active applications and instances and returning it to the caller`),a}))}handleInstanceStop(n,e){var t,r,i,o;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling stop command for instance: ${n.id}`);if(this.sessionStorage.getWorkspaceClientById(n.id))return null===(r=this.logger)||void 0===r||r.trace(`[${e}] this instance is detected as a workspace window, closing via the workspaces controller`),void(yield this.ioc.workspacesController.closeItem({itemId:n.id},e));if(!this.sessionStorage.getInstanceData(n.id))throw new Error(`Cannot close instance: ${n.id}, because it is not known by the platform`);const l=this.sessionStorage.getWindowDataById(n.id);if(!l)throw new Error(`Cannot close instance: ${n.id}, because it's window is not known by the platform`);if("Platform"===l.name)throw new Error("Closing the main application is not allowed");null===(i=window.open(void 0,l.windowId))||void 0===i||i.close(),this.processInstanceClosed(n.id),this.ioc.windowsController.cleanUpWindow(n.id),null===(o=this.logger)||void 0===o||o.trace(`[${e}] instance ${n.id} has been closed, removed from store, announced stopped and notified windows, responding to caller`)}))}handleImport(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling import command`);const o=n.definitions.map((n=>this.parseDefinition(n))),l=this.sessionStorage.getAllApps();if("replace"===n.mode)return this.replaceImport(l,o),void(null===(r=this.logger)||void 0===r||r.trace(`[${e}] replace import command completed`));this.mergeImport(l,o),null===(i=this.logger)||void 0===i||i.trace(`[${e}] merge import command completed`)}))}handleRemove(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling remove command for ${n.name}`);const i=this.sessionStorage.removeApp(n.name);i&&(null===(r=this.logger)||void 0===r||r.trace(`definition ${i.name} removed successfully`),this.emitStreamData("applicationRemoved",i))}))}handleExport(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling export command`);return{definitions:this.sessionStorage.getAllApps().map((n=>this.reverseParseDefinition(n)))}}))}mergeImport(n,e){var t,r;for(const i of e){const e=n.findIndex((n=>n.name===i.name));e>-1&&!objEqual(i,n[e])?(null===(t=this.logger)||void 0===t||t.trace("change detected at definition "+i.name),this.emitStreamData("applicationChanged",i),n[e]=i):e<0&&(null===(r=this.logger)||void 0===r||r.trace(`new definition: ${i.name} detected, adding and announcing`),this.emitStreamData("applicationAdded",i),n.push(i))}this.sessionStorage.overwriteApps(n)}replaceImport(n,e){var t,r;for(const i of e){const e=n.findIndex((n=>n.name===i.name));e<0?(null===(t=this.logger)||void 0===t||t.trace(`new definition: ${i.name} detected, adding and announcing`),this.emitStreamData("applicationAdded",i)):(objEqual(i,n[e])||(null===(r=this.logger)||void 0===r||r.trace("change detected at definition "+i.name),this.emitStreamData("applicationChanged",i)),n.splice(e,1))}n.forEach((n=>{var e;null===(e=this.logger)||void 0===e||e.trace(`definition ${n.name} missing, removing and announcing`),this.emitStreamData("applicationRemoved",n)})),this.sessionStorage.overwriteApps(e)}setLock(n){const e={},t=new Promise((n=>{e.openKeyOne=n})),r=new Promise((n=>{e.openKeyTwo=n}));e.keyOne=t,e.keyTwo=r,this.locks[n]=e}registerWorkspaceApp(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){if(!n.appName)throw new Error(`Cannot register application with config: ${JSON.stringify(n)}, because no app name was found`);if(!this.sessionStorage.getAllApps().some((e=>e.name===n.appName)))throw new Error(`Cannot register application with config: ${JSON.stringify(n)}, because no app with this name name was found`);this.sessionStorage.saveBridgeInstanceData({windowId:n.windowId,appName:n.appName}),null===(t=this.logger)||void 0===t||t.trace(`[${e}] processing valid workspace application registration with id ${n.windowId}, app name ${n.appName} and frame ${n.frameId}`),n.context&&(yield this.glueController.setInstanceStartContext(n.windowId,n.context));const i={id:n.windowId,applicationName:n.appName};this.sessionStorage.saveInstanceData(i),this.emitStreamData("instanceStarted",i),null===(r=this.logger)||void 0===r||r.trace(`[${e}] instance registration is completed and announced, calling windows registration`),yield this.ioc.windowsController.registerWorkspaceWindow(n,e)}))}processNewInstance(n){return __awaiter$3(this,void 0,void 0,(function*(){n.context&&(yield this.glueController.setInstanceStartContext(n.data.id,n.context)),this.sessionStorage.saveInstanceData(n.data),n.monitorState&&this.stateController.add(n.monitorState.child,n.data.id),this.emitStreamData("instanceStarted",n.data)}))}emitStreamData(n,e){var t;null===(t=this.logger)||void 0===t||t.trace(`sending notification of event: ${n} with data: ${JSON.stringify(e)}`),this.glueController.pushSystemMessage("appManager",n,e)}reverseParseDefinition(n){const e=n.userProperties.details,t=__rest$1(n.userProperties,["details"]);return{name:n.name,title:n.title,version:n.version,icon:n.icon,caption:n.caption,details:e,customProperties:t}}parseDefinition(n){var e;const t=["name","title","version","customProperties","icon","caption"],r=Object.fromEntries(Object.entries(n).filter((([n])=>!t.includes(n))));let i={url:""};if(n.manifest){const t=JSON.parse(n.manifest),r=(null===(e=t.details)||void 0===e?void 0:e.url)||t.url;if(!r||"string"!=typeof r)throw new Error(`The FDC3 definition: ${n.name} is not valid, because there is not url defined in the manifest`);i.url=r}else i=n.details;const o={createOptions:i,name:n.name,title:n.title,version:n.version,icon:n.icon,caption:n.caption,userProperties:Object.assign(Object.assign({},r),n.customProperties)};return o.userProperties.details||(o.userProperties.details=i),o}getStartingBounds(n,e,t){var r;return __awaiter$3(this,void 0,void 0,(function*(){const i=Object.assign({},this.defaultBounds,{top:n.top,left:n.left,width:n.width,height:n.height},{top:e.top,left:e.left,width:e.width,height:e.height});if(!e.relativeTo)return i;try{const n=yield this.ioc.windowsController.getWindowBounds(e.relativeTo,t),o=null!==(r=e.relativeDirection)&&void 0!==r?r:"right";return getRelativeBounds(i,n,o)}catch(n){return i}}))}}const layoutTypeDecoder$2=oneOf$1$1(constant$1$1("Global"),constant$1$1("Workspace")),layoutDecoder=object$1$1({name:nonEmptyStringDecoder$1$1,type:layoutTypeDecoder$2,context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1()),components:array$1$1(oneOf$1$1(workspaceLayoutComponentDecoder$1$1,windowLayoutComponentDecoder$1$1))}),layoutsOperationTypesDecoder$1$1=oneOf$1$1(constant$1$1("get"),constant$1$1("getAll"),constant$1$1("export"),constant$1$1("import"),constant$1$1("remove")),simpleLayoutConfigDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,type:layoutTypeDecoder$2}),getAllLayoutsConfigDecoder$1$1=object$1$1({type:layoutTypeDecoder$2}),allLayoutsFullConfigDecoder$1$1=object$1$1({layouts:array$1$1(layoutDecoder)}),importModeDecoder$1$1=oneOf$1$1(constant$1$1("replace"),constant$1$1("merge")),layoutsImportConfigDecoder$1$1=object$1$1({layouts:array$1$1(layoutDecoder),mode:importModeDecoder$1$1}),allLayoutsSummariesResultDecoder$1$1=object$1$1({summaries:array$1$1(layoutSummaryDecoder$1$1)}),simpleLayoutResult$1$1=object$1$1({layout:layoutDecoder}),optionalSimpleLayoutResult$1$1=object$1$1({layout:optional$1$1(layoutDecoder)});class LayoutsController$1$1{constructor(n,e,t){this.glueController=n,this.idbStore=e,this.sessionStore=t,this.started=!1,this.operations={get:{name:"get",dataDecoder:simpleLayoutConfigDecoder$1$1,resultDecoder:optionalSimpleLayoutResult$1$1,execute:this.handleGetLayout.bind(this)},getAll:{name:"getAll",dataDecoder:getAllLayoutsConfigDecoder$1$1,resultDecoder:allLayoutsSummariesResultDecoder$1$1,execute:this.handleGetAll.bind(this)},export:{name:"export",dataDecoder:getAllLayoutsConfigDecoder$1$1,resultDecoder:allLayoutsFullConfigDecoder$1$1,execute:this.handleExport.bind(this)},import:{name:"import",dataDecoder:layoutsImportConfigDecoder$1$1,execute:this.handleImport.bind(this)},remove:{name:"remove",dataDecoder:simpleLayoutConfigDecoder$1$1,execute:this.handleRemove.bind(this)}}}get logger(){return logger.get("layouts.controller")}start(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){this.config=n.layouts,null===(e=this.logger)||void 0===e||e.trace("initializing with mode: "+this.config.mode),this.config.local&&this.config.local.length&&(yield this.mergeImport(this.config.local)),this.started=!0,null===(t=this.logger)||void 0===t||t.trace("initialization is completed")}))}handleControl(n){var e,t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){this.started;const o=n.data,l=n.commandId,u=layoutsOperationTypesDecoder$1$1.run(n.operation);if(!u.ok)throw new Error("This layouts request cannot be completed, because the operation name did not pass validation: "+JSON.stringify(u.error));const s=u.result,a=null===(e=this.operations[s].dataDecoder)||void 0===e?void 0:e.run(o);if(a&&!a.ok)throw new Error(`Layouts request for ${s} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(a.error)}`);null===(t=this.logger)||void 0===t||t.debug(`[${l}] ${s} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[s].execute(o,l),d=null===(r=this.operations[s].resultDecoder)||void 0===r?void 0:r.run(c);if(d&&!d.ok)throw new Error(`Layouts request for ${s} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${s} command was executed successfully`),c}))}handleGetAll(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling get all layout summaries request for type: ${n.type}`);const i=(yield this.getAll(n.type)).map((n=>({name:n.name,type:n.type,context:n.context,metadata:n.metadata})));return null===(r=this.logger)||void 0===r||r.trace(`[${e}] all summaries have been compiled, responding to caller`),{summaries:i}}))}handleExport(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling get all layout full request for type: ${n.type}`);const i=yield this.getAll(n.type);return null===(r=this.logger)||void 0===r||r.trace(`[${e}] full layouts collection have been compiled, responding to caller`),{layouts:i}}))}handleImport(n,e){var t,r,i,o;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling mass import request for layout names: ${n.layouts.map((n=>n.name)).join(", ")}`),"merge"===n.mode?(null===(r=this.logger)||void 0===r||r.trace(`[${e}] importing the layouts in merge mode`),yield this.mergeImport(n.layouts)):(null===(i=this.logger)||void 0===i||i.trace(`[${e}] importing the layouts in replace mode`),yield this.replaceImport(n.layouts)),null===(o=this.logger)||void 0===o||o.trace(`[${e}] mass import completed, responding to caller`)}))}handleRemove(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling remove request for ${JSON.stringify(n)}`);const i=yield(yield this.getAll(n.type)).find((e=>e.name===n.name&&e.type===n.type));i&&(yield this.delete(n.name,n.type),this.emitStreamData("layoutRemoved",i));const o=i?"has been removed":"has not been removed, because it does not exist";null===(r=this.logger)||void 0===r||r.trace(`[${e}] ${n.name} of type ${n.type} ${o}`)}))}handleGetLayout(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling get layout request for name: ${n.name} and type: ${n.type}`);const i=(yield this.getAll(n.type)).find((e=>e.name===n.name));return null===(r=this.logger)||void 0===r||r.trace(`[${e}] request completed, responding to the caller`),{layout:i}}))}emitStreamData(n,e){var t;null===(t=this.logger)||void 0===t||t.trace(`sending notification of event: ${n} with data: ${JSON.stringify(e)}`),this.glueController.pushSystemMessage("layouts",n,e)}mergeImport(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){const r=yield this.getAll("Workspace"),i=[];for(const o of n){const n=r.findIndex((n=>n.name===o.name));n>-1&&!objEqual(o,r[n])?(null===(e=this.logger)||void 0===e||e.trace("change detected at layout "+o.name),i.push({operation:"layoutChanged",layout:o}),r[n]=o):n<0&&(null===(t=this.logger)||void 0===t||t.trace(`new layout: ${o.name} detected, adding and announcing`),i.push({operation:"layoutAdded",layout:o}),r.push(o))}yield this.cleanSave(r),i.forEach((n=>this.emitStreamData(n.operation,n.layout)))}))}replaceImport(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){const r=yield this.getAll("Workspace"),i=[];for(const o of n){const n=r.findIndex((n=>n.name===o.name));n<0?(null===(e=this.logger)||void 0===e||e.trace(`new layout: ${o.name} detected, adding and announcing`),i.push({operation:"layoutAdded",layout:o})):(objEqual(o,r[n])||(null===(t=this.logger)||void 0===t||t.trace("change detected at layout "+o.name),i.push({operation:"layoutChanged",layout:o})),r.splice(n,1))}r.forEach((n=>{var e;null===(e=this.logger)||void 0===e||e.trace(`layout ${n.name} missing, removing and announcing`),i.push({operation:"layoutRemoved",layout:n})})),yield this.cleanSave(n),i.forEach((n=>this.emitStreamData(n.operation,n.layout)))}))}getAll(n){return __awaiter$3(this,void 0,void 0,(function*(){let e;return e="idb"===this.config.mode?yield this.idbStore.getAll(n):this.sessionStore.getLayoutSnapshot().layouts,e}))}cleanSave(n){return __awaiter$3(this,void 0,void 0,(function*(){if("idb"!==this.config.mode)this.sessionStore.saveLayoutSnapshot({layouts:n});else{yield this.idbStore.clear("Workspace");for(const e of n)yield this.idbStore.store(e,e.type)}}))}delete(n,e){return __awaiter$3(this,void 0,void 0,(function*(){if("idb"===this.config.mode)return void(yield this.idbStore.delete(n,e));const t=this.sessionStore.getLayoutSnapshot().layouts,r=t.findIndex((e=>e.name===n&&e.type));r>-1&&t.splice(r,1),this.sessionStore.saveLayoutSnapshot({layouts:t})}))}}const instanceOfAny=(n,e)=>e.some((e=>n instanceof e));let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(n){const e=new Promise(((e,t)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{e(wrap(n.result)),r()},o=()=>{t(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)}));return e.then((e=>{e instanceof IDBCursor&&cursorRequestMap.set(e,n)})).catch((()=>{})),reverseTransformCache.set(e,n),e}function cacheDonePromiseForTransaction(n){if(transactionDoneMap.has(n))return;const e=new Promise(((e,t)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{t(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)}));transactionDoneMap.set(n,e)}let idbProxyTraps={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return transactionDoneMap.get(n);if("objectStoreNames"===e)return n.objectStoreNames||transactionStoreNamesMap.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wrap(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function replaceTraps(n){idbProxyTraps=n(idbProxyTraps)}function wrapFunction(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(n)?function(...e){return n.apply(unwrap(this),e),wrap(cursorRequestMap.get(this))}:function(...e){return wrap(n.apply(unwrap(this),e))}:function(e,...t){const r=n.call(unwrap(this),e,...t);return transactionStoreNamesMap.set(r,e.sort?e.sort():[e]),wrap(r)}}function transformCachableValue(n){return"function"==typeof n?wrapFunction(n):(n instanceof IDBTransaction&&cacheDonePromiseForTransaction(n),instanceOfAny(n,getIdbProxyableTypes())?new Proxy(n,idbProxyTraps):n)}function wrap(n){if(n instanceof IDBRequest)return promisifyRequest(n);if(transformCache.has(n))return transformCache.get(n);const e=transformCachableValue(n);return e!==n&&(transformCache.set(n,e),reverseTransformCache.set(e,n)),e}const unwrap=n=>reverseTransformCache.get(n);function openDB(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(n,e),u=wrap(l);return r&&l.addEventListener("upgradeneeded",(n=>{r(wrap(l.result),n.oldVersion,n.newVersion,wrap(l.transaction))})),t&&l.addEventListener("blocked",(()=>t())),u.then((n=>{o&&n.addEventListener("close",(()=>o())),i&&n.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),u}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(cachedMethods.get(e))return cachedMethods.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=writeMethods.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!readMethods.includes(t))return;const o=async function(n,...e){const o=this.transaction(n,i?"readwrite":"readonly");let l=o.store;r&&(l=l.index(e.shift()));const u=await l[t](...e);return i&&await o.done,u};return cachedMethods.set(e,o),o}replaceTraps((n=>({...n,get:(e,t,r)=>getMethod(e,t)||n.get(e,t,r),has:(e,t)=>!!getMethod(e,t)||n.has(e,t)})));class IdbStore{constructor(){if(!("indexedDB"in window))throw new Error("Cannot initialize the local storage, because IndexedDb is not supported")}get database(){return this._database?Promise.resolve(this._database):new Promise((n=>{openDB(dbName,dbVersion,{upgrade:this.setUpDb.bind(this)}).then((e=>{this._database=e,n(this._database)}))}))}getAll(n){return __awaiter$3(this,void 0,void 0,(function*(){switch(n){case"Workspace":return(yield this.database).getAll("workspaceLayouts");case"Global":return(yield this.database).getAll("globalLayouts");default:throw new Error("The provided layout type is not recognized: "+n)}}))}delete(n,e){return __awaiter$3(this,void 0,void 0,(function*(){switch(e){case"Workspace":return(yield this.database).delete("workspaceLayouts",n);case"Global":return(yield this.database).delete("globalLayouts",n);default:throw new Error("The provided layout type is not recognized: "+e)}}))}clear(n){return __awaiter$3(this,void 0,void 0,(function*(){switch(n){case"Workspace":return(yield this.database).clear("workspaceLayouts");case"Global":return(yield this.database).clear("globalLayouts");default:throw new Error("The provided layout type is not recognized: "+n)}}))}get(n,e){return __awaiter$3(this,void 0,void 0,(function*(){switch(e){case"Workspace":return(yield this.database).get("workspaceLayouts",n);case"Global":return(yield this.database).get("globalLayouts",n);default:throw new Error("The provided layout type is not recognized: "+e)}}))}store(n,e){return __awaiter$3(this,void 0,void 0,(function*(){switch(layoutDecoder.runWithException(n),layoutTypeDecoder$2.runWithException(e),e){case"Workspace":return(yield this.database).put("workspaceLayouts",n,n.name);case"Global":return(yield this.database).put("globalLayouts",n,n.name);default:throw new Error("The provided layout type is not recognized: "+e)}}))}setUpDb(n){n.objectStoreNames.contains("workspaceLayouts")||n.createObjectStore("workspaceLayouts"),n.objectStoreNames.contains("globalLayouts")||n.createObjectStore("globalLayouts")}}class WorkspacesController{constructor(n,e,t,r){this.framesController=n,this.glueController=e,this.stateController=t,this.ioc=r,this.started=!1,this.operations={frameHello:{name:"frameHello",dataDecoder:frameHelloDecoder,execute:this.handleFrameHello.bind(this)},isWindowInWorkspace:{name:"isWindowInWorkspace",dataDecoder:simpleItemConfigDecoder,resultDecoder:isWindowInSwimlaneResultDecoder,execute:this.isWindowInWorkspace.bind(this)},createWorkspace:{name:"createWorkspace",dataDecoder:workspaceCreateConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.createWorkspace.bind(this)},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:frameSummariesResultDecoder,execute:this.getAllFramesSummaries.bind(this)},getFrameSummary:{name:"getFrameSummary",dataDecoder:getFrameSummaryConfigDecoder,resultDecoder:frameSummaryDecoder,execute:this.getFrameSummary.bind(this)},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:workspaceSummariesResultDecoder,execute:this.getAllWorkspacesSummaries.bind(this)},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",dataDecoder:simpleItemConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.getWorkspaceSnapshot.bind(this)},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:layoutSummariesDecoder,execute:this.getAllLayoutsSummaries.bind(this)},openWorkspace:{name:"openWorkspace",dataDecoder:openWorkspaceConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.openWorkspace.bind(this)},deleteLayout:{name:"deleteLayout",dataDecoder:deleteLayoutConfigDecoder,resultDecoder:voidResultDecoder,execute:this.deleteLayout.bind(this)},saveLayout:{name:"saveLayout",dataDecoder:workspaceLayoutSaveConfigDecoder,resultDecoder:workspaceLayoutDecoder,execute:this.saveLayout.bind(this)},importLayout:{name:"importLayout",dataDecoder:workspacesLayoutImportConfigDecoder,resultDecoder:voidResultDecoder,execute:this.importLayout.bind(this)},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:exportedLayoutsResultDecoder,execute:this.exportAllLayouts.bind(this)},restoreItem:{name:"restoreItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.restoreItem.bind(this)},maximizeItem:{name:"maximizeItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.maximizeItem.bind(this)},focusItem:{name:"focusItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.focusItem.bind(this)},closeItem:{name:"closeItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.closeItem.bind(this)},resizeItem:{name:"resizeItem",dataDecoder:resizeItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.resizeItem.bind(this)},changeFrameState:{name:"changeFrameState",dataDecoder:frameStateConfigDecoder,resultDecoder:voidResultDecoder,execute:this.changeFrameState.bind(this)},getFrameState:{name:"getFrameState",dataDecoder:simpleItemConfigDecoder,resultDecoder:frameStateResultDecoder,execute:this.getFrameState.bind(this)},moveFrame:{name:"moveFrame",dataDecoder:moveFrameConfigDecoder,resultDecoder:voidResultDecoder,execute:this.moveFrame.bind(this)},getFrameSnapshot:{name:"getFrameSnapshot",dataDecoder:simpleItemConfigDecoder,resultDecoder:frameSnapshotResultDecoder,execute:this.getFrameSnapshot.bind(this)},forceLoadWindow:{name:"forceLoadWindow",dataDecoder:simpleItemConfigDecoder,resultDecoder:simpleWindowOperationSuccessResultDecoder,execute:this.forceLoadWindow.bind(this)},ejectWindow:{name:"ejectWindow",dataDecoder:simpleItemConfigDecoder,resultDecoder:simpleWindowOperationSuccessResultDecoder,execute:this.ejectWindow.bind(this)},setItemTitle:{name:"setItemTitle",dataDecoder:setItemTitleConfigDecoder,resultDecoder:voidResultDecoder,execute:this.setItemTitle.bind(this)},moveWindowTo:{name:"moveWindowTo",dataDecoder:moveWindowConfigDecoder,resultDecoder:voidResultDecoder,execute:this.moveWindowTo.bind(this)},addWindow:{name:"addWindow",dataDecoder:addWindowConfigDecoder,resultDecoder:addItemResultDecoder,execute:this.addWindow.bind(this)},addContainer:{name:"addContainer",dataDecoder:addContainerConfigDecoder,resultDecoder:addItemResultDecoder,execute:this.addContainer.bind(this)},bundleWorkspace:{name:"bundleWorkspace",dataDecoder:bundleConfigDecoder,resultDecoder:voidResultDecoder,execute:this.bundleWorkspace.bind(this)}}}start(n){return __awaiter$3(this,void 0,void 0,(function*(){n.workspaces?(this.settings=n.workspaces,yield Promise.all([this.glueController.createWorkspacesStream(),this.glueController.createWorkspacesEventsReceiver(this.handleWorkspaceEvent.bind(this))]),yield this.framesController.start(n.workspaces,n.windows.defaultWindowOpenBounds,this.operations.getFrameSummary),this.stateController.onWindowDisappeared((n=>this.framesController.handleFrameDisappeared(n))),this.started=!0):this.started=!1}))}get logger(){return logger.get("workspaces.controller")}handleControl(n){var e,t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this workspaces control message, because the controller has not been started");const o=n.data,l=n.commandId,u=workspacesOperationDecoder.run(n.operation);if(!u.ok)throw new Error("This workspace request cannot be completed, because the operation name did not pass validation: "+JSON.stringify(u.error));const s=u.result,a=null===(e=this.operations[s].dataDecoder)||void 0===e?void 0:e.run(o);if(a&&!a.ok)throw new Error(`Workspace request for ${s} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(a.error)}`);null===(t=this.logger)||void 0===t||t.debug(`[${l}] ${s} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[s].execute(o,l),d=null===(r=this.operations[s].resultDecoder)||void 0===r?void 0:r.run(c);if(d&&!d.ok)throw new Error(`Workspace request for ${s} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${s} command was executed successfully`),c}))}handleClientUnloaded(n,e){var t,r;null===(t=this.logger)||void 0===t||t.trace("handling unloading of "+n),e.closed&&(null===(r=this.logger)||void 0===r||r.trace(n+" detected as closed, checking if frame and processing close"),this.framesController.handleFrameDisappeared(n))}handleWorkspaceEvent(n){this.glueController.pushWorkspacesMessage(n)}closeItem(n,e){var t,r,i,o,l,u;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling closeItem request with config ${JSON.stringify(n)}`);const s=this.framesController.getAll().find((e=>e.windowId===n.itemId));if(s)return null===(r=this.logger)||void 0===r||r.trace(`[${e}] this is targeted at a frame, closing the frame`),null===(i=window.open(void 0,s.windowId))||void 0===i||i.close(),void(null===(o=this.logger)||void 0===o||o.trace(`[${e}] the frame window is closed`));const a=yield this.framesController.getFrameInstance(n);null===(l=this.logger)||void 0===l||l.trace(`[${e}] targeting frame ${a.windowId}`),yield this.glueController.callFrame(this.operations.closeItem,n,a.windowId),null===(u=this.logger)||void 0===u||u.trace(`[${e}] frame ${a.windowId} gave a success signal, responding to caller`)}))}setItemTitle(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling setItemTitle request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.setItemTitle,n,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`)}))}handleFrameHello(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling handleFrameHello command with config: ${JSON.stringify(n)}`),n.windowId&&this.framesController.processNewHello(n.windowId)}))}isWindowInWorkspace(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling isWindowInWorkspace command with config: ${JSON.stringify(n)}`);const o=this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${e}] sending isWindowInWorkspace to all known frames: ${o.join(", ")}`);const l=(yield Promise.all(o.map((e=>this.glueController.callFrame(this.operations.isWindowInWorkspace,n,e.windowId))))).some((n=>n.inWorkspace));return null===(i=this.logger)||void 0===i||i.trace(`[${e}] all frames responded, returning ${l} to the caller`),{inWorkspace:l}}))}createWorkspace(n,e){var t,r,i,o,l;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling createWorkspace command`);const u={frameId:null===(r=n.frame)||void 0===r?void 0:r.reuseFrameId,newFrame:null===(i=n.frame)||void 0===i?void 0:i.newFrame},s=yield this.framesController.getFrameInstance(u);null===(o=this.logger)||void 0===o||o.trace(`[${e}] calling frame: ${s.windowId}, based on selection config: ${JSON.stringify(u)}`);const a=yield this.glueController.callFrame(this.operations.createWorkspace,n,s.windowId);return null===(l=this.logger)||void 0===l||l.trace(`[${e}] frame ${s.windowId} responded with a valid snapshot, returning to caller`),a}))}getAllFramesSummaries(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getAllFramesSummaries request`);const n=yield this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${e}] sending getFrameSummary to all known frames: ${n.join(", ")}`);const o=(yield Promise.all(n.map((n=>this.glueController.callFrame(this.operations.getFrameSummary,{itemId:n.windowId},n.windowId))))).filter((n=>"none"!==n.id));return null===(i=this.logger)||void 0===i||i.trace(`[${e}] all frames responded, returning to caller`),{summaries:o}}))}getFrameSummary(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getFrameSummary request for config: ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] forwarding getFrameSummary to frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getFrameSummary,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} responded with a valid summary, returning to caller`),l}))}getAllWorkspacesSummaries(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getAllWorkspacesSummaries request`);const n=this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${e}] sending getAllWorkspacesSummaries to all known frames: ${n.join(", ")}`);const o=(yield Promise.all(n.map((n=>this.glueController.callFrame(this.operations.getAllWorkspacesSummaries,{},n.windowId))))).reduce(((n,e)=>(n.push(...e.summaries),n)),[]);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] all frames responded, results were aggregated, returning to caller`),{summaries:o}}))}getWorkspaceSnapshot(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getWorkspaceSnapshot for config: ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getWorkspaceSnapshot,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} responded with a valid snapshot, retuning to caller`),l}))}getAllLayoutsSummaries(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getAllLayoutsSummaries command`);const n=(yield this.ioc.layoutsController.handleGetAll({type:"Workspace"},e)).summaries.map((n=>({name:n.name})));return null===(r=this.logger)||void 0===r||r.trace(`[${e}] all layouts retrieved and mapped, returning to caller`),{summaries:n}}))}openWorkspace(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling openWorkspace command for name: ${n.name}`);const o=yield this.framesController.getFrameInstance({frameId:null===(r=n.restoreOptions)||void 0===r?void 0:r.frameId,newFrame:null===(i=n.restoreOptions)||void 0===i?void 0:i.newFrame});return yield this.glueController.callFrame(this.operations.openWorkspace,n,o.windowId)}))}deleteLayout(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling deleteLayout request for name: ${n.name}`),yield this.ioc.layoutsController.handleRemove({name:n.name,type:"Workspace"},e),null===(r=this.logger)||void 0===r||r.trace(`[${e}] layouts reported this layout as deleted, responding to caller`)}))}saveLayout(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling saveLayout request for workspace ${n.workspaceId} and name ${n.name}`);const o=yield this.framesController.getFrameInstance({itemId:n.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${e}] forwarding request to frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.saveLayout,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} responded with a valid layout, returning to caller`),l}))}importLayout(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling importLayout command for layout ${n.layout.name}`),yield this.ioc.layoutsController.handleImport({layouts:[n.layout],mode:n.mode},e),null===(r=this.logger)||void 0===r||r.trace(`[${e}] the layouts controller successfully imported the layout, responding to caller`)}))}exportAllLayouts(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling exportAllLayouts request`);return yield this.ioc.layoutsController.handleExport({type:"Workspace"},e)}))}restoreItem(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling restoreItem request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.restoreItem,n,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`)}))}maximizeItem(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling maximizeItem request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.maximizeItem,n,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`)}))}focusItem(n,e){var t,r,i,o;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling focusItem request with config ${JSON.stringify(n)}`);const l=this.framesController.getAll().find((e=>e.windowId===n.itemId));if(l)return null===(r=this.logger)||void 0===r||r.trace(`[${e}] this is targeted at a frame, focusing the frame`),void window.open(void 0,l.windowId);const u=yield this.framesController.getFrameInstance(n);null===(i=this.logger)||void 0===i||i.trace(`[${e}] targeting frame ${u.windowId}`),yield this.glueController.callFrame(this.operations.focusItem,n,u.windowId),null===(o=this.logger)||void 0===o||o.trace(`[${e}] frame ${u.windowId} gave a success signal, responding to caller`)}))}resizeItem(n,e){var t,r,i,o,l;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling resizeItem request with config ${JSON.stringify(n)}`);const u=this.framesController.getAll().find((e=>e.windowId===n.itemId));if(u){null===(r=this.logger)||void 0===r||r.trace(`[${e}] detected targeted item is frame, building window resize config`);const t={windowId:n.itemId,width:n.width,height:n.height,relative:n.relative};return yield this.glueController.callWindow(this.ioc.windowsController.moveResizeOperation,t,u.windowId),void(null===(i=this.logger)||void 0===i||i.trace(`[${e}] window resize responded with success, returning to caller`))}const s=yield this.framesController.getFrameInstance(n);null===(o=this.logger)||void 0===o||o.trace(`[${e}] targeted item is not a frame, it is located in frame ${s.windowId}`),yield this.glueController.callFrame(this.operations.resizeItem,n,s.windowId),null===(l=this.logger)||void 0===l||l.trace(`[${e}] frame ${s.windowId} gave a success signal, responding to caller`)}))}getFrameSnapshot(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getFrameSnapshot request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getFrameSnapshot,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}forceLoadWindow(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling forceLoadWindow request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.forceLoadWindow,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}ejectWindow(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling ejectWindow request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.ejectWindow,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}moveWindowTo(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling moveWindowTo request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance(n);null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.moveWindowTo,n,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`)}))}addWindow(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling addWindow request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance({itemId:n.parentId});null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.addWindow,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal: ${JSON.stringify(l)}, responding to caller`),l}))}addContainer(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling addContainer request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance({itemId:n.parentId});null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.addContainer,n,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal: ${JSON.stringify(l)}, responding to caller`),l}))}bundleWorkspace(n,e){var t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling bundleWorkspace request with config ${JSON.stringify(n)}`);const o=yield this.framesController.getFrameInstance({itemId:n.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${e}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.bundleWorkspace,n,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${e}] frame ${o.windowId} gave a success signal, responding to caller`)}))}changeFrameState(n,e){return __awaiter$3(this,void 0,void 0,(function*(){throw new Error("Frame states are not supported in Glue42 Core")}))}getFrameState(n,e){return __awaiter$3(this,void 0,void 0,(function*(){throw new Error("Frame states are not supported in Glue42 Core")}))}moveFrame(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling moveFrame command with config: ${JSON.stringify(n)}`);const i=yield this.framesController.getFrameInstance({frameId:n.itemId}),o={windowId:n.itemId,top:n.top,left:n.left,relative:n.relative};yield this.glueController.callWindow(this.ioc.windowsController.moveResizeOperation,o,i.windowId),null===(r=this.logger)||void 0===r||r.trace(`[${e}] frame with id ${i.windowId} was successfully moved, responding to caller`)}))}}const intentsOperationTypesDecoder$1$1=oneOf$1$1(constant$1$1("findIntent"),constant$1$1("getIntents"),constant$1$1("raiseIntent")),intentHandlerDecoder$1$1=object$1$1({applicationName:nonEmptyStringDecoder$1$1,applicationTitle:string$1$1(),applicationDescription:optional$1$1(string$1$1()),applicationIcon:optional$1$1(string$1$1()),type:oneOf$1$1(constant$1$1("app"),constant$1$1("instance")),displayName:optional$1$1(string$1$1()),contextTypes:optional$1$1(array$1$1(nonEmptyStringDecoder$1$1)),instanceId:optional$1$1(string$1$1()),instanceTitle:optional$1$1(string$1$1())}),intentDecoder$1$1=object$1$1({name:nonEmptyStringDecoder$1$1,handlers:array$1$1(intentHandlerDecoder$1$1)}),intentTargetDecoder$1$1=oneOf$1$1(constant$1$1("startNew"),constant$1$1("reuse"),object$1$1({app:optional$1$1(nonEmptyStringDecoder$1$1),instance:optional$1$1(nonEmptyStringDecoder$1$1)})),intentContextDecoder$1$1=object$1$1({type:optional$1$1(nonEmptyStringDecoder$1$1),data:optional$1$1(object$1$1())}),intentsDecoder$1$1=array$1$1(intentDecoder$1$1),wrappedIntentsDecoder$1$1=object$1$1({intents:intentsDecoder$1$1}),wrappedIntentFilterDecoder$1$1=object$1$1({filter:optional$1$1(object$1$1({name:optional$1$1(nonEmptyStringDecoder$1$1),contextType:optional$1$1(nonEmptyStringDecoder$1$1)}))}),intentRequestDecoder$1$1=object$1$1({intent:nonEmptyStringDecoder$1$1,target:optional$1$1(intentTargetDecoder$1$1),context:optional$1$1(intentContextDecoder$1$1),options:optional$1$1(windowOpenSettingsDecoder$1$1)}),intentResultDecoder$1$1=object$1$1({request:intentRequestDecoder$1$1,handler:intentHandlerDecoder$1$1,result:anyJson$1$1()});class IntentsController$1$1{constructor(n,e,t){this.glueController=n,this.sessionStorage=e,this.ioc=t,this.operations={getIntents:{name:"getIntents",resultDecoder:wrappedIntentsDecoder$1$1,execute:this.getWrappedIntents.bind(this)},findIntent:{name:"findIntent",dataDecoder:wrappedIntentFilterDecoder$1$1,resultDecoder:wrappedIntentsDecoder$1$1,execute:this.findIntent.bind(this)},raiseIntent:{name:"raiseIntent",dataDecoder:intentRequestDecoder$1$1,resultDecoder:intentResultDecoder$1$1,execute:this.raiseIntent.bind(this)}},this.started=!1}get logger(){return logger.get("intents.controller")}start(){return __awaiter$3(this,void 0,void 0,(function*(){this.started=!0}))}handleControl(n){var e,t,r,i;return __awaiter$3(this,void 0,void 0,(function*(){this.started;const o=n.data,l=n.commandId,u=intentsOperationTypesDecoder$1$1.run(n.operation);if(!u.ok)throw new Error("This intents request cannot be completed, because the operation name did not pass validation: "+JSON.stringify(u.error));const s=u.result,a=null===(e=this.operations[s].dataDecoder)||void 0===e?void 0:e.run(o);if(a&&!a.ok)throw new Error(`Intents request for ${s} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(a.error)}`);null===(t=this.logger)||void 0===t||t.debug(`[${l}] ${s} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[s].execute(o,l),d=null===(r=this.operations[s].resultDecoder)||void 0===r?void 0:r.run(c);if(d&&!d.ok)throw new Error(`Intents request for ${s} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${s} command was executed successfully`),c}))}extractAppIntents(n){const e={},t=n.filter((n=>n.intents.length>0));for(const n of t)for(const t of n.intents){e[t.name]||(e[t.name]=[]);const r={applicationName:n.name,applicationTitle:n.title,applicationDescription:n.caption,displayName:t.displayName,contextTypes:t.contexts,applicationIcon:n.icon,type:"app"};e[t.name].push(r)}return e}getInstanceIntents(n,e){var t;return __awaiter$3(this,void 0,void 0,(function*(){const r={};for(const i of this.glueController.getServers()){const o=((null===(t=i.getMethods)||void 0===t?void 0:t.call(i))||[]).filter((n=>n.name.startsWith(GlueWebIntentsPrefix)));yield Promise.all(o.map((t=>__awaiter$3(this,void 0,void 0,(function*(){var o;const l=t.name.replace(GlueWebIntentsPrefix,"");let u;if(r[l]||(r[l]=[]),t.description)try{u=JSON.parse(t.description)}catch(n){null===(o=this.logger)||void 0===o||o.trace(`[${e}] Parsing method ${t.name}'s description failed!`)}const s=n.find((n=>n.name===i.application));let a,c;s&&s.intents&&(a=s.intents.find((n=>n.name===l))),i.windowId&&(c=yield this.ioc.windowsController.getWindowTitle(i.windowId,e));const d={instanceId:i.windowId||i.instance,applicationName:i.application||"",applicationIcon:(null==u?void 0:u.icon)||(null==s?void 0:s.icon),applicationTitle:(null==s?void 0:s.title)||"",applicationDescription:(null==u?void 0:u.description)||(null==s?void 0:s.caption),displayName:(null==u?void 0:u.displayName)||(null==a?void 0:a.displayName),contextTypes:(null==u?void 0:u.contextTypes)||(null==a?void 0:a.contexts),instanceTitle:c,type:"instance"};r[l].push(d)})))))}return r}))}mergeIntentStores(n,e){const t={};for(const r of new Set([...Object.keys(n),...Object.keys(e)]))t[r]=[...n[r]||[],...e[r]||[]];return t}wrapIntents(n){return{intents:n}}getIntents(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){const r=this.sessionStorage.getAllApps().map((n=>({name:n.name,title:n.title||"",icon:n.icon,caption:n.caption,intents:n.userProperties.intents||[]}))),i=this.extractAppIntents(r);null===(e=this.logger)||void 0===e||e.trace(`[${n}] got app intents`);const o=yield this.getInstanceIntents(r,n);null===(t=this.logger)||void 0===t||t.trace(`[${n}] got instance intents`);const l=this.mergeIntentStores(i,o);return Object.keys(l).map((n=>({name:n,handlers:l[n]})))}))}getWrappedIntents(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.trace(`[${n}] handling getIntents command`);const r=yield this.getIntents(n);return null===(t=this.logger)||void 0===t||t.trace(`[${n}] getIntents command completed`),this.wrapIntents(r)}))}findIntent(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling findIntent command`);const i=n.filter;let o=yield this.getIntents(e);if(!i)return this.wrapIntents(o);if("string"==typeof i)return this.wrapIntents(o.filter((n=>n.name===i)));if(i.contextType){const n=i.contextType.toLowerCase();o=o.filter((e=>e.handlers.some((e=>{var t;return null===(t=e.contextTypes)||void 0===t?void 0:t.some((e=>e.toLowerCase()===n))}))))}return i.name&&(o=o.filter((n=>n.name===i.name))),null===(r=this.logger)||void 0===r||r.trace(`[${e}] findIntent command completed`),this.wrapIntents(o)}))}getIntent(n,e){return __awaiter$3(this,void 0,void 0,(function*(){return(yield this.getIntents(e)).find((e=>e.name===n))}))}startApp(n,e){return __awaiter$3(this,void 0,void 0,(function*(){return(yield this.ioc.applicationsController.handleApplicationStart(n,e)).id}))}waitForServer(n){return __awaiter$3(this,void 0,void 0,(function*(){let e;return PromisePlus$3((t=>{e=this.glueController.subscribeForServerAdded((e=>{e.windowId!==n&&e.instance!==n||t(e)}))}),3e4,"Can not find interop server for instance "+n).finally((()=>e()))}))}waitForMethod(n,e){return __awaiter$3(this,void 0,void 0,(function*(){let t;return PromisePlus$3((e=>{t=this.glueController.subscribeForMethodAdded((t=>{t.name===n&&e(t)}))}),1e4,`Can not find interop method ${n} for instance ${e}`).finally((()=>t()))}))}instanceIdToInteropInstance(n){var e;return null===(e=this.glueController.getServers().find((e=>e.windowId===n||e.instance===n)))||void 0===e?void 0:e.instance}raiseIntentToInstance(n,e,t){var r;return __awaiter$3(this,void 0,void 0,(function*(){const i=`${GlueWebIntentsPrefix}${e}`;let o=this.glueController.getServers().find((e=>e.windowId===n||e.instance===n));o||(o=yield this.waitForServer(n));(null===(r=o.getMethods)||void 0===r?void 0:r.call(o).find((n=>n.name===i)))||(yield this.waitForMethod(i,n));return(yield this.glueController.invokeMethod(i,t,{instance:this.instanceIdToInteropInstance(n)})).returned}))}raiseIntent(n,e){var t,r;return __awaiter$3(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling raiseIntent command`);const i=n.intent,o=yield this.getIntent(i,e);if(!o)throw new Error(`Intent ${i} not found!`);const l=!o.handlers.some((n=>"app"===n.type)),u=n.target||(l?"reuse":"startNew");let s;const a=o.handlers.find((n=>"app"===n.type));if("startNew"===u)s=a;else if("reuse"===u){s=o.handlers.find((n=>"instance"===n.type))||a}else if(u.instance)s=o.handlers.find((n=>"instance"===n.type&&n.instanceId===u.instance));else{if(!u.app)throw new Error("Invalid intent target: "+JSON.stringify(u));s=o.handlers.find((n=>"app"===n.type&&n.applicationName===u.app))}if(!s)throw new Error(`Can not raise intent for request ${JSON.stringify(n)} - can not find intent handler!`);if(s.instanceId,"app"===s.type&&(s.instanceId=yield this.startApp(Object.assign({name:s.applicationName},n.options),e)),!s.instanceId)throw new Error(`Can not raise intent for request ${JSON.stringify(n)} - handler is missing instanceId!`);const c=yield this.raiseIntentToInstance(s.instanceId,i,n.context);return null===(r=this.logger)||void 0===r||r.trace(`[${e}] raiseIntent command completed`),{request:n,handler:s,result:c}}))}}class ChannelsController$1$1{constructor(n){this.glueController=n}get logger(){return logger.get("channels.controller")}start(n){var e,t;return __awaiter$3(this,void 0,void 0,(function*(){const r=n.channels.definitions;null===(e=this.logger)||void 0===e||e.trace("initializing channels"),yield this.setupChannels(r),null===(t=this.logger)||void 0===t||t.trace("initialization is completed")}))}handleControl(){return __awaiter$3(this,void 0,void 0,(function*(){}))}setupChannels(n){return __awaiter$3(this,void 0,void 0,(function*(){yield Promise.all(n.map((n=>this.addChannel(n))))}))}addChannel(n){return __awaiter$3(this,void 0,void 0,(function*(){const e={name:n.name,meta:n.meta,data:n.data||{}},t=this.createContextName(e.name);yield this.glueController.setContext(t,e)}))}createContextName(n){return`${ChannelContextPrefix}${n}`}}class FramesController{constructor(n,e,t){this.sessionController=n,this.glueController=e,this.ioc=t,this.locks={},this.defaultFrameHelloTimeoutMs=15e3}start(n,e,t){return __awaiter$3(this,void 0,void 0,(function*(){this.config=n,this.defaultBounds=e,this.frameSummaryOperation=t}))}openFrame(n){var e,t,r,i,o;return __awaiter$3(this,void 0,void 0,(function*(){const l="object"==typeof n&&null!==(e=n.bounds)&&void 0!==e?e:{},u=null!==(t=l.top)&&void 0!==t?t:this.defaultBounds.top,s=null!==(r=l.left)&&void 0!==r?r:this.defaultBounds.left,a=null!==(i=l.width)&&void 0!==i?i:this.defaultBounds.width,c=null!==(o=l.height)&&void 0!==o?o:this.defaultBounds.height,d={windowId:shortid$1$1.generate(),active:!1},h=`left=${s},top=${u},width=${a},height=${c}`,f=this.config.src+"?emptyFrame=true";if(!window.open(f,d.windowId,h))throw new Error("Cannot open a new workspace frame, because the user has not allowed popups or uses a blocker");this.sessionController.saveFrameData(d);try{return yield this.waitHello(d.windowId),{windowId:d.windowId}}catch(n){throw delete this.locks[d.windowId],new Error("Cannot open a new frame, because the workspace frame app did not send a hello in time")}}))}closeFrame(n){var e;return __awaiter$3(this,void 0,void 0,(function*(){if(!this.sessionController.getFrameData(n))throw new Error(`Cannot close a frame with id: ${n}, because it is not known by the platform`);this.handleFrameDisappeared(n),null===(e=window.open(void 0,n))||void 0===e||e.close()}))}processNewHello(n){var e;this.sessionController.getFrameData(n)&&(this.sessionController.setFrameActive(n),null===(e=this.locks[n])||void 0===e||e.lift())}handleFrameDisappeared(n){if(!this.sessionController.getFrameData(n))return;this.sessionController.removeFrameData(n);this.sessionController.pickWorkspaceClients((e=>e.frameId===n)).forEach((n=>this.ioc.applicationsController.unregisterWorkspaceApp({windowId:n.windowId})))}getAll(){return this.sessionController.getAllFrames().filter((n=>n.active)).map((n=>({windowId:n.windowId})))}getFrameInstance(n){return __awaiter$3(this,void 0,void 0,(function*(){if(n){if(["frameId","itemId","newFrame"].reduce(((e,t)=>(n[t]&&e.push(t),e)),[]).length>1)throw new Error("Cannot retrieve the frame, because of over-specification: the provided selection object must have either 1 or none of the possible properties: "+JSON.stringify(n))}const e=this.getAll();if(null==n?void 0:n.frameId){const t=e.find((e=>e.windowId===n.frameId));if(!t)throw new Error(`Cannot retrieve a frame with Id: ${n.frameId}, because it is not known by the platform`);return t}return(null==n?void 0:n.itemId)?this.getFrameByItemId(n.itemId,e):(null==n?void 0:n.newFrame)?this.openFrame(n.newFrame):e.length?this.getLastOpenedFrame():this.openFrame()}))}waitHello(n){return __awaiter$3(this,void 0,void 0,(function*(){return PromisePlus$3((e=>{this.locks[n]={lift:e}}),this.defaultFrameHelloTimeoutMs,"Frame hello timed out")}))}getLastOpenedFrame(){const n=this.sessionController.getAllFrames().filter((n=>n.active));return n[n.length-1]}getFrameByItemId(n,e){return __awaiter$3(this,void 0,void 0,(function*(){if(!e.length)throw new Error(`Cannot get frame by item id for: ${n}, because not frames were found`);for(const t of e){if("none"!==(yield this.glueController.callFrame(this.frameSummaryOperation,{itemId:n},t.windowId)).id)return t}throw new Error("Cannot find frame for item: "+n)}))}}class IoC$1$1{constructor(n){this.config=n}get gateway(){return this._gatewayInstance||(this._gatewayInstance=new Gateway),this._gatewayInstance}get platform(){return this._platformInstance||(this._platformInstance=new Platform(this.controller,this.config)),this._platformInstance}get controller(){return this._mainController||(this._mainController=new PlatformController(this.glueController,this.windowsController,this.applicationsController,this.layoutsController,this.workspacesController,this.intentsController,this.channelsController,this.portsBridge,this.stateController)),this._mainController}get glueController(){return this._glueController||(this._glueController=new GlueController(this.portsBridge,this.sessionController)),this._glueController}get sessionController(){return this._sessionController||(this._sessionController=new SessionStorageController),this._sessionController}get stateController(){return this._stateChecker||(this._stateChecker=new StateController(this.sessionController)),this._stateChecker}get windowsController(){return this._windowsController||(this._windowsController=new WindowsController$1$1(this.glueController,this.sessionController,this.stateController,this)),this._windowsController}get applicationsController(){return this._applicationsController||(this._applicationsController=new ApplicationsController(this.glueController,this.sessionController,this.stateController,this)),this._applicationsController}get layoutsController(){return this._layoutsController||(this._layoutsController=new LayoutsController$1$1(this.glueController,this.idbStore,this.sessionController)),this._layoutsController}get workspacesController(){return this._workspacesController||(this._workspacesController=new WorkspacesController(this.framesController,this.glueController,this.stateController,this)),this._workspacesController}get intentsController(){return this._intentsController||(this._intentsController=new IntentsController$1$1(this.glueController,this.sessionController,this)),this._intentsController}get channelsController(){return this._channelsController||(this._channelsController=new ChannelsController$1$1(this.glueController)),this._channelsController}get framesController(){return this._framesController||(this._framesController=new FramesController(this.sessionController,this.glueController,this)),this._framesController}get idbStore(){return this._idbStore||(this._idbStore=new IdbStore),this._idbStore}get portsBridge(){return this._portsBridge||(this._portsBridge=new PortsBridge(this.gateway,this.sessionController,this)),this._portsBridge}createMessageChannel(){return new MessageChannel}}const glueWebPlatformFactory=n=>__awaiter$3(void 0,void 0,void 0,(function*(){if(window.glue42gd){return{glue:(null==n?void 0:n.glueFactory)?yield null==n?void 0:n.glueFactory(null==n?void 0:n.glue):yield glueWebFactory$1(null==n?void 0:n.glue)}}const e=new IoC$1$1(n);yield e.platform.ready();return{glue:yield e.platform.getClientGlue(),platform:null==e?void 0:e.platform.exposeAPI()}}));"undefined"!=typeof window&&(window.GlueWebPlatform=glueWebPlatformFactory);const validateGlue=n=>{const e=["contexts","intents","channels","agm","appManager"];for(const t of e)if(void 0===n[t])throw new Error(`Failed to initialize @glue42/fdc3. @glue42/fdc3 depends on the Glue42 ${t.replace(/^./,t[0].toUpperCase())} API being available. Ignore this error if you do not plan on using FDC3.`)},resolveGlue=n=>(validateGlue(n),window.glue=n,n),setupGlue42Core=()=>{const n=window.webPlatformConfig,e=void 0!==n;window.fdc3GluePromise=e?glueWebPlatformFactory(n).then((({glue:n})=>resolveGlue(n))):glueWebFactory().then((n=>resolveGlue(n)))},setupGlue42Enterprise=()=>{window.fdc3GluePromise=waitFor((()=>void 0!==window.glue42gd),300).then((()=>{if(window.glue42gd.fdc3InitsGlue){return(window.Glue||whatToExpose$1)({channels:!0,appManager:"full"})}return waitFor((()=>{var n,e;const t=null===(e=null===(n=window.glue42gd.originalGlue)||void 0===n?void 0:n.instances)||void 0===e?void 0:e.length;return void 0!==t&&t>0}),300,(()=>window.glue42gd.originalGlue.instances[0]))})).then((n=>resolveGlue(n)))},setupGlue=()=>{isGlue42Core?setupGlue42Core():setupGlue42Enterprise()},fdc3Factory=()=>{setupGlue();const n=createDesktopAgent();return Object.assign(Object.assign({},n),{version:version$4})};let globalFdc3=window.fdc3;void 0===globalFdc3?(globalFdc3=fdc3Factory(),window.fdc3=globalFdc3):console.warn("Defaulting to using the auto-injected fdc3.");var globalFdc3$1=globalFdc3;return globalFdc3$1}));
//# sourceMappingURL=fdc3-glue42.js.map
