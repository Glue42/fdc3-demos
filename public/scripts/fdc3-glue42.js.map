{"version":3,"file":"fdc3-glue42.js","sources":["../node_modules/@finos/fdc3/dist/fdc3.esm.js","../src/utils.ts","../src/channels/channel.ts","../src/channels/channels.ts","../src/agent.ts","../node_modules/@glue42/desktop/dist/desktop.es.js","../../web/dist/web.es.js","../src/main.ts","../src/index.ts"],"sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2019 FINOS FDC3 contributors - see NOTICE file\r\n */\nvar OpenError;\n\n(function (OpenError) {\n  OpenError[\"AppNotFound\"] = \"AppNotFound\";\n  OpenError[\"ErrorOnLaunch\"] = \"ErrorOnLaunch\";\n  OpenError[\"AppTimeout\"] = \"AppTimeout\";\n  OpenError[\"ResolverUnavailable\"] = \"ResolverUnavailable\";\n})(OpenError || (OpenError = {}));\n\nvar ResolveError;\n\n(function (ResolveError) {\n  ResolveError[\"NoAppsFound\"] = \"NoAppsFound\";\n  ResolveError[\"ResolverUnavailable\"] = \"ResolverUnavailable\";\n  ResolveError[\"ResolverTimeout\"] = \"ResolverTimeout\";\n})(ResolveError || (ResolveError = {}));\n\nvar ChannelError;\n\n(function (ChannelError) {\n  ChannelError[\"NoChannelFound\"] = \"NoChannelFound\";\n  ChannelError[\"AccessDenied\"] = \"AccessDenied\";\n  ChannelError[\"CreationFailed\"] = \"CreationFailed\";\n})(ChannelError || (ChannelError = {}));\n\nvar open = function open(name, context) {\n  return window.fdc3.open(name, context);\n};\nvar findIntent = function findIntent(intent, context) {\n  return window.fdc3.findIntent(intent, context);\n};\nvar findIntentsByContext = function findIntentsByContext(context) {\n  return window.fdc3.findIntentsByContext(context);\n};\nvar broadcast = function broadcast(context) {\n  window.fdc3.broadcast(context);\n};\nvar raiseIntent = function raiseIntent(intent, context, target) {\n  return window.fdc3.raiseIntent(intent, context, target);\n};\nvar addIntentListener = function addIntentListener(intent, handler) {\n  return window.fdc3.addIntentListener(intent, handler);\n};\nvar addContextListener = function addContextListener(a, b) {\n  if (typeof a !== 'function') {\n    return window.fdc3.addContextListener(a, b);\n  } else {\n    return window.fdc3.addContextListener(a);\n  }\n};\nvar getSystemChannels = function getSystemChannels() {\n  return window.fdc3.getSystemChannels();\n};\nvar joinChannel = function joinChannel(channelId) {\n  return window.fdc3.joinChannel(channelId);\n};\nvar getOrCreateChannel = function getOrCreateChannel(channelId) {\n  return window.fdc3.getOrCreateChannel(channelId);\n};\nvar getCurrentChannel = function getCurrentChannel() {\n  return window.fdc3.getCurrentChannel();\n};\n\nvar ContextTypes;\n\n(function (ContextTypes) {\n  ContextTypes[\"Contact\"] = \"fdc3.contact\";\n  ContextTypes[\"ContactList\"] = \"fdc3.contactList\";\n  ContextTypes[\"Country\"] = \"fdc3.country\";\n  ContextTypes[\"Instrument\"] = \"fdc3.instrument\";\n  ContextTypes[\"Organization\"] = \"fdc3.organization\";\n  ContextTypes[\"Portfolio\"] = \"fdc3.portfolio\";\n  ContextTypes[\"Position\"] = \"fdc3.position\";\n})(ContextTypes || (ContextTypes = {}));\n\n// To parse this data:\n//\n//   import { Convert, Context, Contact, ContactList, Instrument, InstrumentList, Country, Organization, Portfolio, Position } from \"./file\";\n//\n//   const context = Convert.toContext(json);\n//   const contact = Convert.toContact(json);\n//   const contactList = Convert.toContactList(json);\n//   const instrument = Convert.toInstrument(json);\n//   const instrumentList = Convert.toInstrumentList(json);\n//   const country = Convert.toCountry(json);\n//   const organization = Convert.toOrganization(json);\n//   const portfolio = Convert.toPortfolio(json);\n//   const position = Convert.toPosition(json);\n//\n// These functions will throw an error if the JSON doesn't\n// match the expected interface, even if the JSON is valid.\n// Converts JSON strings to/from your types\n// and asserts the results of JSON.parse at runtime\nvar Convert = /*#__PURE__*/function () {\n  function Convert() {}\n\n  Convert.toContext = function toContext(json) {\n    return cast(JSON.parse(json), r('Context'));\n  };\n\n  Convert.contextToJson = function contextToJson(value) {\n    return JSON.stringify(uncast(value, r('Context')), null, 2);\n  };\n\n  Convert.toContact = function toContact(json) {\n    return cast(JSON.parse(json), r('Contact'));\n  };\n\n  Convert.contactToJson = function contactToJson(value) {\n    return JSON.stringify(uncast(value, r('Contact')), null, 2);\n  };\n\n  Convert.toContactList = function toContactList(json) {\n    return cast(JSON.parse(json), r('ContactList'));\n  };\n\n  Convert.contactListToJson = function contactListToJson(value) {\n    return JSON.stringify(uncast(value, r('ContactList')), null, 2);\n  };\n\n  Convert.toInstrument = function toInstrument(json) {\n    return cast(JSON.parse(json), r('Instrument'));\n  };\n\n  Convert.instrumentToJson = function instrumentToJson(value) {\n    return JSON.stringify(uncast(value, r('Instrument')), null, 2);\n  };\n\n  Convert.toInstrumentList = function toInstrumentList(json) {\n    return cast(JSON.parse(json), r('InstrumentList'));\n  };\n\n  Convert.instrumentListToJson = function instrumentListToJson(value) {\n    return JSON.stringify(uncast(value, r('InstrumentList')), null, 2);\n  };\n\n  Convert.toCountry = function toCountry(json) {\n    return cast(JSON.parse(json), r('Country'));\n  };\n\n  Convert.countryToJson = function countryToJson(value) {\n    return JSON.stringify(uncast(value, r('Country')), null, 2);\n  };\n\n  Convert.toOrganization = function toOrganization(json) {\n    return cast(JSON.parse(json), r('Organization'));\n  };\n\n  Convert.organizationToJson = function organizationToJson(value) {\n    return JSON.stringify(uncast(value, r('Organization')), null, 2);\n  };\n\n  Convert.toPortfolio = function toPortfolio(json) {\n    return cast(JSON.parse(json), r('Portfolio'));\n  };\n\n  Convert.portfolioToJson = function portfolioToJson(value) {\n    return JSON.stringify(uncast(value, r('Portfolio')), null, 2);\n  };\n\n  Convert.toPosition = function toPosition(json) {\n    return cast(JSON.parse(json), r('Position'));\n  };\n\n  Convert.positionToJson = function positionToJson(value) {\n    return JSON.stringify(uncast(value, r('Position')), null, 2);\n  };\n\n  return Convert;\n}();\n\nfunction invalidValue(typ, val, key) {\n  if (key === void 0) {\n    key = '';\n  }\n\n  if (key) {\n    throw Error(\"Invalid value for key \\\"\" + key + \"\\\". Expected type \" + JSON.stringify(typ) + \" but got \" + JSON.stringify(val));\n  }\n\n  throw Error(\"Invalid value \" + JSON.stringify(val) + \" for type \" + JSON.stringify(typ));\n}\n\nfunction jsonToJSProps(typ) {\n  if (typ.jsonToJS === undefined) {\n    var map = {};\n    typ.props.forEach(function (p) {\n      return map[p.json] = {\n        key: p.js,\n        typ: p.typ\n      };\n    });\n    typ.jsonToJS = map;\n  }\n\n  return typ.jsonToJS;\n}\n\nfunction jsToJSONProps(typ) {\n  if (typ.jsToJSON === undefined) {\n    var map = {};\n    typ.props.forEach(function (p) {\n      return map[p.js] = {\n        key: p.json,\n        typ: p.typ\n      };\n    });\n    typ.jsToJSON = map;\n  }\n\n  return typ.jsToJSON;\n}\n\nfunction transform(val, typ, getProps, key) {\n  if (key === void 0) {\n    key = '';\n  }\n\n  function transformPrimitive(typ, val) {\n    if (typeof typ === typeof val) return val;\n    return invalidValue(typ, val, key);\n  }\n\n  function transformUnion(typs, val) {\n    // val must validate against one typ in typs\n    var l = typs.length;\n\n    for (var i = 0; i < l; i++) {\n      var _typ = typs[i];\n\n      try {\n        return transform(val, _typ, getProps);\n      } catch (_) {}\n    }\n\n    return invalidValue(typs, val);\n  }\n\n  function transformEnum(cases, val) {\n    if (cases.indexOf(val) !== -1) return val;\n    return invalidValue(cases, val);\n  }\n\n  function transformArray(typ, val) {\n    // val must be an array with no invalid elements\n    if (!Array.isArray(val)) return invalidValue('array', val);\n    return val.map(function (el) {\n      return transform(el, typ, getProps);\n    });\n  }\n\n  function transformDate(val) {\n    if (val === null) {\n      return null;\n    }\n\n    var d = new Date(val);\n\n    if (isNaN(d.valueOf())) {\n      return invalidValue('Date', val);\n    }\n\n    return d;\n  }\n\n  function transformObject(props, additional, val) {\n    if (val === null || typeof val !== 'object' || Array.isArray(val)) {\n      return invalidValue('object', val);\n    }\n\n    var result = {};\n    Object.getOwnPropertyNames(props).forEach(function (key) {\n      var prop = props[key];\n      var v = Object.prototype.hasOwnProperty.call(val, key) ? val[key] : undefined;\n      result[prop.key] = transform(v, prop.typ, getProps, prop.key);\n    });\n    Object.getOwnPropertyNames(val).forEach(function (key) {\n      if (!Object.prototype.hasOwnProperty.call(props, key)) {\n        result[key] = transform(val[key], additional, getProps, key);\n      }\n    });\n    return result;\n  }\n\n  if (typ === 'any') return val;\n\n  if (typ === null) {\n    if (val === null) return val;\n    return invalidValue(typ, val);\n  }\n\n  if (typ === false) return invalidValue(typ, val);\n\n  while (typeof typ === 'object' && typ.ref !== undefined) {\n    typ = typeMap[typ.ref];\n  }\n\n  if (Array.isArray(typ)) return transformEnum(typ, val);\n\n  if (typeof typ === 'object') {\n    return typ.hasOwnProperty('unionMembers') ? transformUnion(typ.unionMembers, val) : typ.hasOwnProperty('arrayItems') ? transformArray(typ.arrayItems, val) : typ.hasOwnProperty('props') ? transformObject(getProps(typ), typ.additional, val) : invalidValue(typ, val);\n  } // Numbers can be parsed by Date but shouldn't be.\n\n\n  if (typ === Date && typeof val !== 'number') return transformDate(val);\n  return transformPrimitive(typ, val);\n}\n\nfunction cast(val, typ) {\n  return transform(val, typ, jsonToJSProps);\n}\n\nfunction uncast(val, typ) {\n  return transform(val, typ, jsToJSONProps);\n}\n\nfunction a(typ) {\n  return {\n    arrayItems: typ\n  };\n}\n\nfunction u() {\n  for (var _len = arguments.length, typs = new Array(_len), _key = 0; _key < _len; _key++) {\n    typs[_key] = arguments[_key];\n  }\n\n  return {\n    unionMembers: typs\n  };\n}\n\nfunction o(props, additional) {\n  return {\n    props: props,\n    additional: additional\n  };\n}\n\nfunction m(additional) {\n  return {\n    props: [],\n    additional: additional\n  };\n}\n\nfunction r(name) {\n  return {\n    ref: name\n  };\n}\n\nvar typeMap = {\n  Context: /*#__PURE__*/o([{\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/u(undefined, /*#__PURE__*/m(''))\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }], 'any'),\n  ContactList: /*#__PURE__*/o([{\n    json: 'contacts',\n    js: 'contacts',\n    typ: /*#__PURE__*/a( /*#__PURE__*/r('Contact'))\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/u(undefined, /*#__PURE__*/m(''))\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  Contact: /*#__PURE__*/o([{\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/r('ContactID')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  ContactID: /*#__PURE__*/o([{\n    json: 'email',\n    js: 'email',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'FDS_ID',\n    js: 'FDS_ID',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], ''),\n  InstrumentList: /*#__PURE__*/o([{\n    json: 'instruments',\n    js: 'instruments',\n    typ: /*#__PURE__*/a( /*#__PURE__*/r('Instrument'))\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/u(undefined, /*#__PURE__*/m(''))\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  Instrument: /*#__PURE__*/o([{\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/r('InstrumentID')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  InstrumentID: /*#__PURE__*/o([{\n    json: 'BBG',\n    js: 'BBG',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'CUSIP',\n    js: 'CUSIP',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'FDS_ID',\n    js: 'FDS_ID',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'FIGI',\n    js: 'FIGI',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'ISIN',\n    js: 'ISIN',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'PERMID',\n    js: 'PERMID',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'RIC',\n    js: 'RIC',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'SEDOL',\n    js: 'SEDOL',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'ticker',\n    js: 'ticker',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], ''),\n  Country: /*#__PURE__*/o([{\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/r('CountryID')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  CountryID: /*#__PURE__*/o([{\n    json: 'ISOALPHA2',\n    js: 'ISOALPHA2',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'ISOALPHA3',\n    js: 'ISOALPHA3',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], ''),\n  Organization: /*#__PURE__*/o([{\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/r('OrganizationID')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  OrganizationID: /*#__PURE__*/o([{\n    json: 'FDS_ID',\n    js: 'FDS_ID',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'LEI',\n    js: 'LEI',\n    typ: /*#__PURE__*/u(undefined, '')\n  }, {\n    json: 'PERMID',\n    js: 'PERMID',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], ''),\n  Portfolio: /*#__PURE__*/o([{\n    json: 'positions',\n    js: 'positions',\n    typ: /*#__PURE__*/a( /*#__PURE__*/r('Position'))\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/u(undefined, /*#__PURE__*/m(''))\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any'),\n  Position: /*#__PURE__*/o([{\n    json: 'holding',\n    js: 'holding',\n    typ: 3.14\n  }, {\n    json: 'instrument',\n    js: 'instrument',\n    typ: /*#__PURE__*/r('Instrument')\n  }, {\n    json: 'type',\n    js: 'type',\n    typ: ''\n  }, {\n    json: 'id',\n    js: 'id',\n    typ: /*#__PURE__*/u(undefined, /*#__PURE__*/m(''))\n  }, {\n    json: 'name',\n    js: 'name',\n    typ: /*#__PURE__*/u(undefined, '')\n  }], 'any')\n};\n\nvar Intents;\n\n(function (Intents) {\n  Intents[\"StartCall\"] = \"StartCall\";\n  Intents[\"StartChart\"] = \"StartChart\";\n  Intents[\"ViewChart\"] = \"ViewChart\";\n  Intents[\"ViewContact\"] = \"ViewContact\";\n  Intents[\"ViewQuote\"] = \"ViewQuote\";\n  Intents[\"ViewNews\"] = \"ViewNews\";\n  Intents[\"ViewInstrument\"] = \"ViewInstrument\";\n  Intents[\"ViewAnalysis\"] = \"ViewAnalysis\";\n})(Intents || (Intents = {}));\n\nexport { ChannelError, ContextTypes, Convert, Intents, OpenError, ResolveError, addContextListener, addIntentListener, broadcast, findIntent, findIntentsByContext, getCurrentChannel, getOrCreateChannel, getSystemChannels, joinChannel, open, raiseIntent };\n//# sourceMappingURL=fdc3.esm.js.map\n","import { Listener } from \"@finos/fdc3\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"./types/windowtype\";\n\n/**\n * Changes to subscribe to comply with the FDC3 specification:\n * 1. Skip updates from myself\n * 2. Ignore initial replay\n */\nexport const newSubscribe = (id: string, callback: (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => void): Promise<() => void> => {\n    let didReplay = false;\n\n    return (window as WindowType).glue.contexts.subscribe(id, (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => {\n        if (!didReplay) {\n            didReplay = true;\n            return;\n        }\n\n        const updateFromMe = extraData.updaterId === (window as WindowType).glue.interop.instance.instance;\n\n        if (!updateFromMe) {\n            callback(data, delta, removed, unsubscribe, extraData);\n        }\n    });\n};\n\n/**\n * Returns a list of all channel contexts. We are not using `glue.channels.list()` so that @glue42/fdc3 can be used with older versions of the Glue42 JS SDK.\n */\nexport const getChannelsList = async (): Promise<Array<Glue42.ChannelContext>> => {\n    const channelNames = await (window as WindowType).glue.channels.all();\n    const channelContents: Array<Glue42.Channels.ChannelContext> = await Promise.all(channelNames.map((name: string) => (window as WindowType).glue.channels.get(name)));\n\n    return channelContents;\n};\n\nexport const isEmptyObject = (obj: object): boolean => {\n    return Object.keys(obj).length === 0 && obj.constructor === Object;\n};\n\nexport const isGlue42Core = !navigator.userAgent.toLowerCase().includes(\" electron/\");\n\nexport const AsyncListener = (actualUnsub:\n    (() => void)\n    | Promise<() => void>\n): Listener => {\n    return {\n        unsubscribe(): void {\n            if (!actualUnsub) {\n                console.error(\"Failed to unsubscribe!\");\n                return;\n            }\n\n            if (typeof actualUnsub === \"function\") {\n                actualUnsub();\n            } else {\n                (actualUnsub as Promise<() => void>).then((unsubFunc: () => void) => unsubFunc());\n            }\n        }\n    };\n};\n\nexport const waitFor = <T>(predicate: () => boolean, retryMs: number, resolution?: () => T): Promise<T> => {\n    return new Promise((resolve) => {\n        const resolvePromise: () => void = () => {\n            if (typeof resolution !== \"undefined\") {\n                resolve(resolution());\n            } else {\n                resolve();\n            }\n        };\n\n        if (predicate()) {\n            resolvePromise();\n        } else {\n            let interval: any;\n\n            const callback = (): void => {\n                if (predicate()) {\n                    clearInterval(interval);\n\n                    resolvePromise();\n                }\n            };\n\n            interval = setInterval(callback, retryMs);\n        }\n    });\n};\n","import {\n    Channel,\n    Context,\n    ContextHandler,\n    DisplayMetadata,\n    Listener\n} from \"@finos/fdc3\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"../types/windowtype\";\nimport { newSubscribe } from \"../utils\";\n\nexport class SystemChannel implements Channel {\n    id: string;\n    readonly type: string = \"system\";\n    displayMetadata: DisplayMetadata;\n\n    constructor(glChannel: Glue42.Channels.ChannelContext) {\n        this.id = glChannel.name;\n        this.displayMetadata = glChannel.meta;\n    }\n\n    broadcast(context: Context): Promise<void> {\n        return (window as WindowType).glue.channels.publish(context, this.id);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<Context | null> {\n        const channel = await (window as WindowType).glue.channels.get(this.id);\n\n        const { data } = channel;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: ContextHandler): Listener;\n    addContextListener(contextType: string, handler: ContextHandler): Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = (window as WindowType).glue.channels.subscribeFor(this.id, subHandler);\n\n        return {\n            unsubscribe(): void {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n\n    join(): Promise<void> {\n        return (window as WindowType).glue.channels.join(this.id);\n    }\n\n    leave(): Promise<void> {\n        return (window as WindowType).glue.channels.leave();\n    }\n}\n\nexport class AppChannel implements Channel {\n    readonly type: string = \"app\";\n\n    constructor(public id: string) {\n    }\n\n    broadcast(context: Context): Promise<void> {\n        return (window as WindowType).glue.contexts.update(this.id, context);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<Context | null> {\n        const context = await (window as WindowType).glue.contexts.get(this.id);\n\n        const { data } = context;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: ContextHandler): Listener;\n    addContextListener(contextType: string, handler: ContextHandler): Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = newSubscribe(this.id, subHandler);\n\n        return {\n            unsubscribe: (): void => {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n}\n","import { Glue42 } from \"@glue42/desktop\";\nimport { SystemChannel, AppChannel } from \"./channel\";\nimport { WindowType } from \"../types/windowtype\";\nimport {\n    getChannelsList,\n    isGlue42Core,\n    newSubscribe,\n    isEmptyObject,\n    AsyncListener\n} from \"../utils\";\nimport { Channel, ChannelError, Context, Listener } from \"@finos/fdc3\";\nimport { ChannelsAPI } from \"../types/channelsAPI\";\n\ninterface PendingSubscription {\n    contextType: string;\n    handler: (context: Context) => void;\n    setActualUnsub: (actualUnsub: () => void) => void;\n}\n\nconst createChannelsAgent = (): ChannelsAPI => {\n    let currentChannel: Channel | null;\n    let pendingSubscription: PendingSubscription | null;\n\n    const channels: { [name: string]: Channel } = {};\n\n    let systemChannels: string[] = [];\n\n    const initDone = (window as WindowType).fdc3GluePromise.then(() => {\n        const current = (window as WindowType).glue.channels.current();\n\n        // In Glue42 Core the channel selector widget needs to use the FDC3 Channels API instead of the Glue42 Channels API to navigate between the channels.\n        if (!isGlue42Core) {\n            if (typeof current !== \"undefined\") {\n                handleSwitchChannelUI(current);\n            }\n\n            (window as WindowType).glue.channels.changed((channelId: string) => {\n                handleSwitchChannelUI(channelId);\n            });\n        }\n\n        const setChannelsPromise = getChannelsList().then((channelContents) => {\n            channelContents.map((channelContext) => {\n                channels[channelContext.name] = mapToFDC3SystemChannel(channelContext);\n            });\n\n        });\n\n        const setSystemChannelsPromise = (window as WindowType).glue.channels.all().then((channels) => {\n            systemChannels = channels;\n        });\n\n        return Promise.all([setChannelsPromise, setSystemChannelsPromise]);\n    });\n\n    const doesAppChannelExist = async (name: string): Promise<boolean> => {\n        const exists = (await (window as WindowType).glue.contexts.all())\n            .some((ctxName) => ctxName === name);\n\n        return exists;\n    };\n\n    const createNewAppChannel = async (channelId: string): Promise<void> => {\n        await (window as WindowType).glue.contexts.set(channelId, null);\n    };\n\n    const isSystem = (channel: Channel | null): boolean => {\n        if (!channel) {\n            return false;\n        }\n        return systemChannels.some((n) => n === channel.id);\n    };\n\n    const mapToFDC3SystemChannel = (glueChannel: Glue42.Channels.ChannelContext): Channel => {\n        return new SystemChannel(glueChannel);\n    };\n\n    const mapToFDC3AppChannel = (channelName: string): Channel => {\n        return new AppChannel(channelName);\n    };\n\n    const handleSwitchChannelUI = async (channelId: string): Promise<void> => {\n        await initDone;\n\n        if (typeof channelId !== \"undefined\") {\n            setCurrentChannel(channels[channelId]);\n        }\n    };\n\n    const createPendingListener = (contextType: string, handler: (context: Context) => void): Listener => {\n        let unsubscribe = (): void => { pendingSubscription = null; };\n\n        const setActualUnsub = (actualUnsub: () => void): void => { unsubscribe = actualUnsub; };\n\n        // Used inside of setCurrentChannel.\n        pendingSubscription = { contextType, handler, setActualUnsub };\n\n        return {\n            unsubscribe\n        };\n    };\n\n    const getSystemChannels = async (): Promise<Channel[]> => {\n        await initDone;\n\n        const systemChannelImpls = systemChannels.map((id) => channels[id]);\n\n        return systemChannelImpls;\n    };\n\n    const getOrCreateAppChannel = async (channelId: string): Promise<Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            await createNewAppChannel(channelId);\n        }\n\n        return mapToFDC3AppChannel(channelId);\n    };\n\n    const getOrCreateChannel = async (channelId: string): Promise<Channel> => {\n        const systemChannels = await getSystemChannels();\n        const channel = systemChannels.find((systemChannel) => systemChannel.id === channelId);\n\n        if (typeof channel === \"undefined\") {\n            return getOrCreateAppChannel(channelId);\n        } else {\n            return channel;\n        }\n    };\n\n    const tryLeaveSystem = async (): Promise<void> => {\n        if (isSystem(currentChannel)) {\n            await (currentChannel as SystemChannel).leave();\n        }\n    };\n\n    const tryGetAppChannel = async (channelId: string): Promise<Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            throw new Error(ChannelError.NoChannelFound);\n        }\n\n        const appChannel = mapToFDC3AppChannel(channelId);\n        channels[channelId] = appChannel;\n\n        return appChannel;\n    };\n\n    const joinChannel = async (channelId: string): Promise<void> => {\n        await initDone;\n\n        const channel: Channel = channels[channelId]\n            || await tryGetAppChannel(channelId);\n\n        if (!channel) {\n            throw new Error(ChannelError.NoChannelFound);\n        }\n\n        if (isSystem(channel)) {\n            (channel as SystemChannel).join();\n        } else {\n            await tryLeaveSystem();\n        }\n\n        setCurrentChannel(channel);\n    };\n\n    const getCurrentChannel = async (): Promise<Channel> => {\n        await initDone;\n\n        return currentChannel as Channel;\n    };\n\n    const leaveCurrentChannel = async (): Promise<void> => {\n        await initDone;\n\n        await tryLeaveSystem();\n\n        currentChannel = null;\n    };\n\n    const broadcast = async (context: Context): Promise<void> => {\n        await initDone;\n\n        if (!currentChannel) {\n            console.error(\"You need to join a channel in order to broadcast.\");\n            return;\n        }\n\n        const { id, type } = currentChannel;\n        (type === \"system\")\n            ? (window as WindowType).glue.channels.publish(context)\n            : (window as WindowType).glue.contexts.update(id, context);\n    };\n\n    function addContextListener(handler: (context: Context) => void): Listener;\n    function addContextListener(contextType: string, handler: (context: Context) => void): Listener;\n    function addContextListener(contextTypeInput: any, handlerInput?: any): Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        if (!currentChannel) {\n            console.warn(\"You need to join a channel in order to start receiving broadcasted contexts!\");\n            const listener = createPendingListener(contextType, handler);\n\n            // Handle context passed to `fdc3.open()`.\n            (window as WindowType).fdc3GluePromise\n                .then(() => {\n                    return (window as WindowType).glue.windows.my().getContext();\n                })\n                .then((startupContext) => {\n                    if (!isEmptyObject(startupContext)) {\n                        handler(startupContext);\n                    }\n                });\n\n            return listener;\n        }\n\n        const { id, type } = currentChannel;\n\n        const subscribe = (subHandler: (data: any) => void): (() => void) | Promise<() => void> => type === \"system\"\n            ? (window as WindowType).glue.channels.subscribe(subHandler)\n            : newSubscribe(id, subHandler);\n\n        const onNewData = (data: any): void => {\n            if (contextType) {\n                if (data.type === contextType) {\n                    handler(data);\n                }\n                return;\n            }\n            handler(data);\n        };\n\n        const unsubFunc = subscribe(onNewData);\n\n        return AsyncListener(unsubFunc);\n    }\n\n    const setCurrentChannel = (newChannel: Channel): void => {\n        currentChannel = newChannel;\n\n        if (pendingSubscription) {\n            const { contextType, handler, setActualUnsub } = pendingSubscription;\n\n            const listener = addContextListener(contextType, handler);\n\n            setActualUnsub(listener.unsubscribe);\n\n            pendingSubscription = null;\n        }\n    };\n\n    return {\n        getSystemChannels,\n        getOrCreateChannel,\n        joinChannel,\n        getCurrentChannel,\n        leaveCurrentChannel,\n        broadcast,\n        addContextListener,\n    };\n};\n\nexport default createChannelsAgent;\n","import {\n    AppIntent,\n    Context,\n    DesktopAgent,\n    IntentResolution,\n    Listener,\n    OpenError,\n    ResolveError\n} from \"@finos/fdc3\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport createChannelsAgent from \"./channels/channels\";\nimport { WindowType } from \"./types/windowtype\";\n\nconst convertGlue42IntentToFDC3AppIntent = (glueIntent: Glue42.Intents.Intent): AppIntent => {\n    const { name, handlers } = glueIntent;\n    const appIntents = handlers.filter((handler) => handler.type === \"app\");\n    const dynamicInstanceIntents = handlers.filter((handler) => handler.type === \"instance\" && !appIntents.some((appIntent) => appIntent.applicationName === handler.applicationName));\n    // Ignore instance handlers that aren't dynamic.\n    const handlersToUse = [...appIntents, ...dynamicInstanceIntents];\n\n    const appIntent: AppIntent = {\n        // Issue with the FDC3 specification: there are multiple displayNames.\n        intent: { name, displayName: handlers[0].displayName || \"\" },\n        apps: handlersToUse.map((handler) => {\n            const appName = handler.applicationName;\n            const app = (window as WindowType).glue.appManager.application(appName);\n\n            return {\n                name: appName,\n                title: handler.applicationTitle || handler.instanceTitle || appName,\n                tooltip: app?.userProperties.tooltip || `${appName} (${handler.type})`,\n                description: handler.applicationDescription,\n                icons: handler.applicationIcon ? [handler.applicationIcon, ...(app?.userProperties.icons || [])] : app?.userProperties.icons,\n                images: app?.userProperties.images\n            };\n        })\n    };\n\n    return appIntent;\n};\n\nconst createIntentsAgent = (): Partial<DesktopAgent> => {\n    const open = async (name: string, context?: Context): Promise<void> => {\n        const app = (window as WindowType).glue.appManager.application(name);\n        if (typeof app === \"undefined\") {\n            throw new Error(OpenError.AppNotFound);\n        }\n\n        try {\n            await app.start(context);\n        } catch (error) {\n            // `start()` is expected to reject as the started application needs to pass in application name to `GlueWeb()`\n        }\n    };\n\n    const findIntent = async (intent: string, context?: Context): Promise<AppIntent> => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n\n        const glueIntents = await (window as WindowType).glue.intents.find({ name: intent, contextType: context?.type });\n\n        if (typeof glueIntents !== \"undefined\" && glueIntents.length === 0) {\n            throw new Error(ResolveError.NoAppsFound);\n        }\n\n        // We will receive only one intent as they are grouped by name.\n        return convertGlue42IntentToFDC3AppIntent(glueIntents[0]);\n    };\n\n    const findIntentsByContext = async (context: Context): Promise<AppIntent[]> => {\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n\n        const glueIntents = await (window as WindowType).glue.intents.find({ contextType: context.type });\n\n        if (typeof glueIntents !== \"undefined\" && glueIntents.length === 0) {\n            throw new Error(ResolveError.NoAppsFound);\n        }\n\n        return glueIntents.map((glueIntent) => convertGlue42IntentToFDC3AppIntent(glueIntent));\n    };\n\n    const raiseIntent = async (intent: string, context: Context, target?: string): Promise<IntentResolution> => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n        if (typeof target !== \"undefined\" && typeof target !== \"string\") {\n            throw new Error(\"Please provide the target as a string!\");\n        }\n\n        // target not provided => reuse (@glue42/web takes care of starting a new instance if there isn't a running one)\n        // target provided; no running instance => target app\n        // target provided; there is a running instance => target instance\n        let glueTarget: \"startNew\" | \"reuse\" | { app?: string; instance?: string } = \"reuse\";\n        if (typeof target !== \"undefined\") {\n            const app = (window as WindowType).glue.appManager.application(target);\n            if (typeof app === \"undefined\") {\n                throw new Error(OpenError.AppNotFound);\n            }\n            const appInstances = app.instances;\n            if (appInstances.length === 0) {\n                glueTarget = { app: target };\n            } else {\n                // Issue with the FDC3 specification: there is no instance targeting.\n                glueTarget = { instance: appInstances[0].id };\n            }\n        }\n\n        const glueIntentResult = await (window as WindowType).glue.intents.raise({ intent, context, target: glueTarget });\n\n        return {\n            source: glueIntentResult.handler.applicationName,\n            version: \"1.0.0\",\n            data: glueIntentResult.result\n        };\n    };\n\n    const addIntentListener = (intent: string, handler: (context: Context) => void): Listener => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof handler !== \"function\") {\n            throw new Error(\"Please provide the handler as a function!\");\n        }\n        const unsub = {\n            unsubscribe: (): void => console.error(\"Failed to unsubscribe!\")\n        };\n\n        (window as WindowType).fdc3GluePromise.then(() => {\n            unsub.unsubscribe = (window as WindowType).glue.intents.addIntentListener(intent, handler as (context: object) => void).unsubscribe;\n        });\n\n        return unsub;\n    };\n\n    return {\n        open: async (...props): Promise<void> => {\n            await (window as WindowType).fdc3GluePromise;\n            return open(...props);\n        },\n        findIntent: async (...props): Promise<AppIntent> => {\n            await (window as WindowType).fdc3GluePromise;\n            return findIntent(...props);\n        },\n        findIntentsByContext: async (...props): Promise<AppIntent[]> => {\n            await (window as WindowType).fdc3GluePromise;\n            return findIntentsByContext(...props);\n        },\n        raiseIntent: async (...props): Promise<IntentResolution> => {\n            await (window as WindowType).fdc3GluePromise;\n            return raiseIntent(...props);\n        },\n        addIntentListener\n    };\n};\n\nconst createDesktopAgent = (): DesktopAgent => {\n    const intentsAgent = createIntentsAgent();\n    const channelsAgent = createChannelsAgent();\n\n    return {\n        ...intentsAgent,\n        ...channelsAgent\n    } as DesktopAgent;\n};\n\nexport default createDesktopAgent;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    var _this = this;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metric, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (system.parent === undefined) {\r\n                        return [2];\r\n                    }\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    metric = {\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        type: \"object\",\r\n                        composite: {\r\n                            Description: {\r\n                                type: \"string\",\r\n                                description: \"\",\r\n                            },\r\n                            Value: {\r\n                                type: \"number\",\r\n                                description: \"\",\r\n                            },\r\n                        },\r\n                        description: \"System state\",\r\n                        context: {},\r\n                    };\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [metric],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateSystem = function (system, state) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var shadowedUpdateMetric, stateObj, rootMetric;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    shadowedUpdateMetric = {\r\n                        type: \"publish\",\r\n                        values: [{\r\n                                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                                value: {\r\n                                    Description: state.description,\r\n                                    Value: state.state,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(shadowedUpdateMetric);\r\n                    stateObj = composeMsgForRootStateMetric(system);\r\n                    rootMetric = {\r\n                        type: \"publish\",\r\n                        peer_id: connection.peerId,\r\n                        values: [{\r\n                                name: \"/State\",\r\n                                value: {\r\n                                    Description: stateObj.description,\r\n                                    Value: stateObj.value,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(rootMetric);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var createMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone, m, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    m = serializeMetric(metricClone);\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [m],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    if (typeof metricClone.value !== \"undefined\") {\r\n                        updateMetricCore(metricClone);\r\n                    }\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    updateMetricCore(metricClone);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            return session.sendFireAndForget(publishMetricsMsg);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign$1({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign$1({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends$1(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends$1(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends$1(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends$1(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing\r\n                    .update(value)\r\n                    .catch(function () { });\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar PerfTracker = (function () {\r\n    function PerfTracker(api, initialPublishTimeout, publishInterval) {\r\n        this.api = api;\r\n        this.lastCount = 0;\r\n        this.initialPublishTimeout = 10 * 1000;\r\n        this.publishInterval = 60 * 1000;\r\n        this.initialPublishTimeout = initialPublishTimeout !== null && initialPublishTimeout !== void 0 ? initialPublishTimeout : this.initialPublishTimeout;\r\n        this.publishInterval = publishInterval !== null && publishInterval !== void 0 ? publishInterval : this.publishInterval;\r\n        this.scheduleCollection();\r\n        this.system = this.api.subSystem(\"performance\", \"Performance data published by the web application\");\r\n    }\r\n    PerfTracker.prototype.scheduleCollection = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.collect();\r\n            setInterval(function () {\r\n                _this.collect();\r\n            }, _this.publishInterval);\r\n        }, this.initialPublishTimeout);\r\n    };\r\n    PerfTracker.prototype.collect = function () {\r\n        try {\r\n            this.collectMemory();\r\n            this.collectEntries();\r\n        }\r\n        catch (_a) {\r\n        }\r\n    };\r\n    PerfTracker.prototype.collectMemory = function () {\r\n        var memory = window.performance.memory;\r\n        this.system.stringMetric(\"memory\", JSON.stringify({\r\n            totalJSHeapSize: memory.totalJSHeapSize,\r\n            usedJSHeapSize: memory.usedJSHeapSize\r\n        }));\r\n    };\r\n    PerfTracker.prototype.collectEntries = function () {\r\n        var allEntries = window.performance.getEntries();\r\n        if (allEntries.length <= this.lastCount) {\r\n            return;\r\n        }\r\n        this.lastCount = allEntries.length;\r\n        this.system.stringMetric(\"entries\", JSON.stringify(allEntries));\r\n    };\r\n    return PerfTracker;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    var rootSystem = repo.root;\r\n    if (!options.disableAutoAppSystem) {\r\n        rootSystem = rootSystem.subSystem(\"App\");\r\n    }\r\n    var api = addFAVSupport(rootSystem);\r\n    initPerf(api, options.pagePerformanceMetrics);\r\n    return api;\r\n});\r\nvar perf;\r\nfunction initPerf(api, config) {\r\n    var _a, _b;\r\n    if (typeof window === \"undefined\") {\r\n        return;\r\n    }\r\n    var perfConfig = (_b = (_a = window === null || window === void 0 ? void 0 : window.glue42gd) === null || _a === void 0 ? void 0 : _a.metrics) === null || _b === void 0 ? void 0 : _b.pagePerformanceMetrics;\r\n    if (perfConfig) {\r\n        config = perfConfig;\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.enabled) {\r\n        perf = new PerfTracker(api, config.initialPublishTimeout, config.publishInterval);\r\n    }\r\n}\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            if (allForKey.length === 0) {\r\n                delete callbacks[key];\r\n            }\r\n            else {\r\n                callbacks[key] = allForKey;\r\n            }\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib = createRegistry;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar timers = {};\r\nfunction getAllTimers() {\r\n    return timers;\r\n}\r\nfunction timer (timerName) {\r\n    var existing = timers[timerName];\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    var marks = [];\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    mark(\"start\", startTime);\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        mark(\"end\", endTime);\r\n        period = endTime - startTime;\r\n        return period;\r\n    }\r\n    function mark(name, time) {\r\n        var currentTime = time !== null && time !== void 0 ? time : now();\r\n        var diff = 0;\r\n        if (marks.length > 0) {\r\n            diff = currentTime - marks[marks.length - 1].time;\r\n        }\r\n        marks.push({ name: name, time: currentTime, diff: diff });\r\n    }\r\n    var timerObj = {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop,\r\n        mark: mark,\r\n        marks: marks\r\n    };\r\n    timers[timerName] = timerObj;\r\n    return timerObj;\r\n}\n\nvar WebSocketConstructor = Utils.isNode() ? require(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this.startupTimer = timer(\"connection\");\r\n        this._running = true;\r\n        this._registry = lib();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.startupTimer.mark(\"opening-socket\");\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.startupTimer.mark(\"socket-initiated\");\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.startupTimer.mark(\"ws-opened\");\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1 = {\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte() {\n    if (!crypto || !crypto.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser = randomByte;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid = isShortId;\n\nvar lib$1 = createCommonjsModule(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1.lookup, version);\n    str = str + encode_1(alphabet_1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid;\n});\nvar lib_1 = lib$1.generate;\nvar lib_2 = lib$1.seed;\nvar lib_3 = lib$1.worker;\nvar lib_4 = lib$1.characters;\nvar lib_5 = lib$1.decode;\nvar lib_6 = lib$1.isValid;\n\nvar shortid = lib$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        return connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected, 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        timer(\"connection\").mark(\"transport-opened\");\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        timer(\"connection\").mark(\"protocol-logged-in\");\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        try {\r\n                            _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                        }\r\n                        catch (loggerError) {\r\n                            console.log(\"Message handler failed\", error);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            var interop = Logger.Interop;\r\n            if (interop) {\r\n                try {\r\n                    if (interop.methods({ name: Logger.InteropMethodName }).length > 0) {\r\n                        interop.invoke(Logger.InteropMethodName, {\r\n                            msg: \"\" + message,\r\n                            logger: loggerName,\r\n                            level: level\r\n                        });\r\n                    }\r\n                }\r\n                catch (_a) {\r\n                }\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version = \"5.2.6\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d, _e;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_f) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"warn\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        var gdConsoleLevel;\r\n        if (glue42gd) {\r\n            gdConsoleLevel = glue42gd.consoleLogLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    var application = getApplication();\r\n    if (typeof window !== \"undefined\") {\r\n        var windowAsAny = window;\r\n        var containerApplication = windowAsAny.htmlContainer ?\r\n            windowAsAny.htmlContainer.containerName + \".\" + windowAsAny.htmlContainer.application : (_a = windowAsAny === null || windowAsAny === void 0 ? void 0 : windowAsAny.glue42gd) === null || _a === void 0 ? void 0 : _a.application;\r\n        if (containerApplication) {\r\n            application = containerApplication;\r\n        }\r\n    }\r\n    return {\r\n        bus: (_b = configuration.bus) !== null && _b !== void 0 ? _b : false,\r\n        application: application,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_c = configuration.metrics) !== null && _c !== void 0 ? _c : true,\r\n        contexts: (_d = configuration.contexts) !== null && _d !== void 0 ? _d : true,\r\n        version: ext.version || version,\r\n        libs: (_e = ext.libs) !== null && _e !== void 0 ? _e : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta, logger) {\r\n    try {\r\n        if (logger === null || logger === void 0 ? void 0 : logger.canPublish(\"trace\")) {\r\n            logger === null || logger === void 0 ? void 0 : logger.trace(\"applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context));\r\n        }\r\n        if (!delta) {\r\n            return context;\r\n        }\r\n        if (delta.reset) {\r\n            context = __assign$1({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        if (delta.commands) {\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    deletePath(context, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(context, command.value, command.path);\r\n                }\r\n            }\r\n            return context;\r\n        }\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n        return context;\r\n    }\r\n    catch (e) {\r\n        logger === null || logger === void 0 ? void 0 : logger.error(\"error applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context), e);\r\n        return context;\r\n    }\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    if (obj instanceof Map) {\r\n        Array.from(obj, function (_a) {\r\n            var key = _a[0], val = _a[1];\r\n            return result.set(key, deepClone(val, hash));\r\n        });\r\n    }\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction setValueToPath(obj, value, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        if (typeof obj[pathArr[i]] !== \"object\") {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    obj[pathArr[i]] = value;\r\n}\r\nfunction deletePath(obj, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            return;\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    delete obj[pathArr[i]];\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._protocolVersion = undefined;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(GW3Bridge.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._protocolVersion) {\r\n                var contextsDomainInfo = this._connection.availableDomains.find(function (d) { return d.uri === \"context\"; });\r\n                this._protocolVersion = (_a = contextsDomainInfo === null || contextsDomainInfo === void 0 ? void 0 : contextsDomainInfo.version) !== null && _a !== void 0 ? _a : 1;\r\n            }\r\n            return this._protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(GW3Bridge.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this.protocolVersion >= 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            _this._contextIdToName[createContextMsg.context_id] = name;\r\n            var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n            contextData.isAnnounced = true;\r\n            contextData.name = name;\r\n            contextData.contextId = createContextMsg.context_id;\r\n            contextData.context = data;\r\n            _this._contextNameToData[name] = contextData;\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name)];\r\n                    case 1:\r\n                        currentContext = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.protocolVersion === 2 ?\r\n                            this.calculateContextDeltaV2(currentContext, delta) :\r\n                            this.calculateContextDeltaV1(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length\r\n                            && !((_a = calculatedDelta.commands) === null || _a === void 0 ? void 0 : _a.length)) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.setPath = function (name, path, value) {\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPath operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        return this.setPaths(name, [{ path: path, value: value }]);\r\n    };\r\n    GW3Bridge.prototype.setPaths = function (name, pathValues) {\r\n        var _this = this;\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            var obj = {};\r\n            for (var _i = 0, pathValues_1 = pathValues; _i < pathValues_1.length; _i++) {\r\n                var pathValue = pathValues_1[_i];\r\n                setValueToPath(obj, pathValue.value, pathValue.path);\r\n            }\r\n            return this.createContext(name, obj);\r\n        }\r\n        var commands = [];\r\n        for (var _a = 0, pathValues_2 = pathValues; _a < pathValues_2.length; _a++) {\r\n            var pathValue = pathValues_2[_a];\r\n            if (pathValue.value === null) {\r\n                commands.push({ type: \"remove\", path: pathValue.path });\r\n            }\r\n            else {\r\n                commands.push({ type: \"set\", path: pathValue.path, value: pathValue.value });\r\n            }\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { commands: commands }\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { added: {}, removed: [], updated: {}, commands: commands }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var _a;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return Promise.resolve({});\r\n        }\r\n        if (contextData && !contextData.hasCallbacks()) {\r\n            return new Promise(function (resolve, _) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator$1(this, function (_a) {\r\n                    this.subscribe(name, function (data, _d, _r, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        var context = (_a = contextData === null || contextData === void 0 ? void 0 : contextData.context) !== null && _a !== void 0 ? _a : {};\r\n        return Promise.resolve(context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context && contextData.sentExplicitSubscription) {\r\n                    var clone = deepClone(contextData.context);\r\n                    callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                var clone = deepClone(contextData.context);\r\n                callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            var clone = deepClone(contextData.context);\r\n            callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.destroy = function (name) {\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData) {\r\n            return Promise.reject(\"context with \" + name + \" does not exist\");\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_DESTROY_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta, this._logger);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        else ;\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta, this._logger);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        if (delta.commands) {\r\n            delta.added = delta.updated = delta.reset = {};\r\n            delta.removed = [];\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    if (command.path.indexOf(\".\") === -1) {\r\n                        delta.removed.push(command.path);\r\n                    }\r\n                    setValueToPath(delta.updated, null, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(delta.updated, command.value, command.path);\r\n                }\r\n            }\r\n        }\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(contextData.context), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV1 = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV2 = function (from, to) {\r\n        var _a, _b;\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined, commands: [] };\r\n        for (var _i = 0, _c = Object.keys(to); _i < _c.length; _i++) {\r\n            var x = _c[_i];\r\n            if (to[x] !== null) {\r\n                var fromX = from ? from[x] : null;\r\n                if (!deepEqual(fromX, to[x])) {\r\n                    (_a = delta.commands) === null || _a === void 0 ? void 0 : _a.push({ type: \"set\", path: x, value: to[x] });\r\n                }\r\n            }\r\n            else {\r\n                (_b = delta.commands) === null || _b === void 0 ? void 0 : _b.push({ type: \"remove\", path: x });\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.update(name, data);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.setPath = function (name, path, data) {\r\n        this.checkName(name);\r\n        this.checkPath(path);\r\n        var isTopLevelPath = path === \"\";\r\n        if (isTopLevelPath) {\r\n            this.checkData(data);\r\n            return this.set(name, data);\r\n        }\r\n        return this._bridge.setPath(name, path, data);\r\n    };\r\n    ContextsModule.prototype.setPaths = function (name, paths) {\r\n        this.checkName(name);\r\n        if (!Array.isArray(paths)) {\r\n            throw new Error(\"Please provide the paths as an array of PathValues!\");\r\n        }\r\n        for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\r\n            var _a = paths_1[_i], path = _a.path, value = _a.value;\r\n            this.checkPath(path);\r\n            var isTopLevelPath = path === \"\";\r\n            if (isTopLevelPath) {\r\n                this.checkData(value);\r\n            }\r\n        }\r\n        return this._bridge.setPaths(name, paths);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.destroy = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.destroy(name);\r\n    };\r\n    Object.defineProperty(ContextsModule.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this._bridge.setPathSupported;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" || name === \"\") {\r\n            throw new Error(\"Please provide the name as a non-empty string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkPath = function (path) {\r\n        if (typeof path !== \"string\") {\r\n            throw new Error(\"Please provide the path as a dot delimited string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkData = function (data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Please provide the data as an object!\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, promise, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    var timeout;\r\n    promise.finally(function () {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n    });\r\n    return new Promise(function (resolve, reject) {\r\n        timeout = setTimeout(function () { return reject(error); }, ms);\r\n    });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign$1({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign$1({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator$1(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign$1({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign$1(__assign$1({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid();\r\n                                    var method = serversMethodPair.methods[0];\r\n                                    var server = serversMethodPair.server;\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, method, argumentObj, server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, invokePromise, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached for method name: \" + (method === null || method === void 0 ? void 0 : method.name) + \", target instance: \" + JSON.stringify(server.instance) + \", options: \" + JSON.stringify(additionalOptionsCopy),\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign$1({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign$1({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer(\"glue\");\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            inner.marks = t.marks;\r\n            if (_allowTrace) {\r\n                _logger.trace(name + \" is ready - \" + (t.endTime - t.startTime));\r\n            }\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer(\"connection\");\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                authPromise = glue42gd.getGWToken()\r\n                    .then(function (token) {\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            initTimer.mark(\"auth-promise-resolved\");\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer(\"logger\");\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        if (_logger.canPublish(\"debug\")) {\r\n            _logger.debug(\"initializing glue...\");\r\n        }\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c, _d;\r\n        var initTimer = timer(\"metrics\");\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var disableAutoAppSystem = (_a = (typeof config !== \"boolean\" && config.disableAutoAppSystem)) !== null && _a !== void 0 ? _a : false;\r\n        _metrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_b = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _b !== void 0 ? _b : \"metrics-service\",\r\n            instance: (_d = (_c = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _c !== void 0 ? _c : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _d !== void 0 ? _d : shortid(),\r\n            disableAutoAppSystem: disableAutoAppSystem,\r\n            pagePerformanceMetrics: typeof config !== \"boolean\" ? config === null || config === void 0 ? void 0 : config.pagePerformanceMetrics : undefined\r\n        });\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer(\"interop\");\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer(\"contexts\");\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator$1(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer(\"bus\");\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer(name);\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var all = getAllTimers();\r\n                return Object.keys(all).map(function (key) {\r\n                    var t = all[key];\r\n                    return {\r\n                        name: key,\r\n                        duration: t.endTime - t.startTime,\r\n                        marks: t.marks\r\n                    };\r\n                });\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        if (glue.agm) {\r\n            var deprecatedDecorator = function (fn, wrong, proper) {\r\n                return function () {\r\n                    glue.logger.warn(\"glue.js - 'glue.agm.\" + wrong + \"' method is deprecated, use 'glue.interop.\" + proper + \"' instead.\");\r\n                    fn.apply(glue.agm, arguments);\r\n                };\r\n            };\r\n            var agmAny = glue.agm;\r\n            agmAny.method_added = deprecatedDecorator(glue.agm.methodAdded, \"method_added\", \"methodAdded\");\r\n            agmAny.method_removed = deprecatedDecorator(glue.agm.methodRemoved, \"method_removed\", \"methodRemoved\");\r\n            agmAny.server_added = deprecatedDecorator(glue.agm.serverAdded, \"server_added\", \"serverAdded\");\r\n            agmAny.server_method_aded = deprecatedDecorator(glue.agm.serverMethodAdded, \"server_method_aded\", \"serverMethodAdded\");\r\n            agmAny.server_method_removed = deprecatedDecorator(glue.agm.serverMethodRemoved, \"server_method_removed\", \"serverMethodRemoved\");\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version;\r\nGlueCore.default = GlueCore;\n\nvar ActivityEntity = (function () {\r\n    function ActivityEntity(id) {\r\n        this._id = id;\r\n    }\r\n    Object.defineProperty(ActivityEntity.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityEntity.prototype._update = function (other) {\r\n        if (other._id !== this._id) {\r\n            throw Error(\"Can not update from entity with different id.\");\r\n        }\r\n        this._updateCore(other);\r\n    };\r\n    ActivityEntity.prototype._updateCore = function (other) {\r\n        return;\r\n    };\r\n    ActivityEntity.prototype._beforeDelete = function (other) {\r\n        return;\r\n    };\r\n    return ActivityEntity;\r\n}());\n\nfunction isString(arg) {\r\n    return typeof arg === \"string\";\r\n}\r\nfunction isObject(arg) {\r\n    return typeof arg === \"object\" && arg !== null;\r\n}\r\nfunction isArray(arg) {\r\n    if (Array.isArray) {\r\n        return Array.isArray(arg);\r\n    }\r\n    return toString.call(arg) === \"[object Array]\";\r\n}\r\nfunction isUndefined(arg) {\r\n    return typeof arg === \"undefined\";\r\n}\r\nfunction isUndefinedOrNull(arg) {\r\n    return !arg || typeof arg === \"undefined\";\r\n}\r\nfunction isFunction(arg) {\r\n    return !!(arg && arg.constructor && arg.call && arg.apply);\r\n}\r\nfunction some(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction ifNotUndefined(what, doWithIt) {\r\n    if (typeof what !== \"undefined\") {\r\n        doWithIt(what);\r\n    }\r\n}\r\nfunction promisify$1(promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { return; };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { return; };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\n\nvar ActivityType = (function (_super) {\r\n    __extends(ActivityType, _super);\r\n    function ActivityType(name, ownerWindow, helperWindows, description) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._description = description;\r\n        _this._ownerWindow = ownerWindow;\r\n        _this._helperWindows = helperWindows || [];\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ActivityType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"description\", {\r\n        get: function () {\r\n            return this._description;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"helperWindows\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._helperWindows.map(function (hw) { return _this.covertToWindowDef(hw); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"ownerWindow\", {\r\n        get: function () {\r\n            return this.covertToWindowDef(this._ownerWindow);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityType.prototype.initiate = function (context, callback, configuration) {\r\n        return this._manager.initiate(this._name, context, callback, configuration);\r\n    };\r\n    ActivityType.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._description, function (x) { return _this._description = x; });\r\n        ifNotUndefined(other._ownerWindow, function (x) { return _this._ownerWindow = x; });\r\n        ifNotUndefined(other._helperWindows, function (x) { return _this._helperWindows = x; });\r\n    };\r\n    ActivityType.prototype.covertToWindowDef = function (windowType) {\r\n        var _a, _b, _c, _d;\r\n        return {\r\n            type: (_b = (_a = windowType) === null || _a === void 0 ? void 0 : _a.id) === null || _b === void 0 ? void 0 : _b.type,\r\n            name: (_d = (_c = windowType) === null || _c === void 0 ? void 0 : _c.id) === null || _d === void 0 ? void 0 : _d.name\r\n        };\r\n    };\r\n    return ActivityType;\r\n}(ActivityEntity));\n\nvar WindowType = (function (_super) {\r\n    __extends(WindowType, _super);\r\n    function WindowType(name, appByWindowTypeGetter) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._appByWindowTypeGetter = appByWindowTypeGetter;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(WindowType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"config\", {\r\n        get: function () {\r\n            return this._appByWindowTypeGetter(this._name);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ type: this._name });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowType.prototype.create = function (activity, configuration) {\r\n        var definition = Object.assign({ type: this.name, name: this.name, isIndependent: false }, configuration);\r\n        return this._manager.createWindow(activity, definition);\r\n    };\r\n    return WindowType;\r\n}(ActivityEntity));\n\nvar EntityEvent = (function () {\r\n    function EntityEvent(entitiy, context) {\r\n        this.entity = entitiy;\r\n        this.context = context;\r\n    }\r\n    return EntityEvent;\r\n}());\r\nvar EntityEventContext = (function () {\r\n    function EntityEventContext(eventType) {\r\n        this.type = eventType;\r\n    }\r\n    return EntityEventContext;\r\n}());\r\nvar ActivityStatusChangeEventContext = (function (_super) {\r\n    __extends(ActivityStatusChangeEventContext, _super);\r\n    function ActivityStatusChangeEventContext(newStatus, oldStatus) {\r\n        var _this = _super.call(this, EntityEventType.StatusChange) || this;\r\n        _this.newStatus = newStatus;\r\n        _this.oldStatus = oldStatus;\r\n        return _this;\r\n    }\r\n    return ActivityStatusChangeEventContext;\r\n}(EntityEventContext));\r\nvar ActivityContextChangedEventContext = (function (_super) {\r\n    __extends(ActivityContextChangedEventContext, _super);\r\n    function ActivityContextChangedEventContext(context, updated, removed) {\r\n        var _this = _super.call(this, EntityEventType.ActivityContextChange) || this;\r\n        _this.context = typeof context === \"string\" ? JSON.parse(context) : context;\r\n        _this.updated = updated;\r\n        _this.removed = removed;\r\n        return _this;\r\n    }\r\n    return ActivityContextChangedEventContext;\r\n}(EntityEventContext));\r\nvar EntityEventType = (function () {\r\n    function EntityEventType() {\r\n    }\r\n    EntityEventType.Added = \"added\";\r\n    EntityEventType.Removed = \"removed\";\r\n    EntityEventType.Updated = \"updated\";\r\n    EntityEventType.Closed = \"closed\";\r\n    EntityEventType.StatusChange = \"statusChange\";\r\n    EntityEventType.ActivityContextChange = \"activityContextUpdate\";\r\n    EntityEventType.ActivityWindowEvent = \"activityWindowEvent\";\r\n    EntityEventType.ActivityWindowJoinedActivity = \"joined\";\r\n    EntityEventType.ActivityWindowLeftActivity = \"left\";\r\n    return EntityEventType;\r\n}());\r\nvar ActivityState = (function () {\r\n    function ActivityState() {\r\n    }\r\n    ActivityState.Created = \"created\";\r\n    ActivityState.Started = \"started\";\r\n    ActivityState.Destroyed = \"destroyed\";\r\n    return ActivityState;\r\n}());\n\nvar ActivityAGM = (function () {\r\n    function ActivityAGM(activity) {\r\n        this._activity = activity;\r\n    }\r\n    ActivityAGM.prototype.register = function (definition, handler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.register(definition, handler);\r\n    };\r\n    ActivityAGM.prototype.servers = function () {\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        return this._activity.windows.map(function (w) {\r\n            return w.instance;\r\n        });\r\n    };\r\n    ActivityAGM.prototype.methods = function () {\r\n        var _this = this;\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        var windows = this._activity.windows;\r\n        var methodNames = [];\r\n        var methods = [];\r\n        windows.forEach(function (window) {\r\n            var windowMethods = _this.methodsForWindow(window);\r\n            windowMethods.forEach(function (currentWindowMethod) {\r\n                if (methodNames.indexOf(currentWindowMethod.name) === -1) {\r\n                    methodNames.push(currentWindowMethod.name);\r\n                    methods.push(currentWindowMethod);\r\n                }\r\n            });\r\n        });\r\n        return methods;\r\n    };\r\n    ActivityAGM.prototype.methodsForWindow = function (window) {\r\n        this._ensureHasAgm();\r\n        if (!window.instance) {\r\n            return [];\r\n        }\r\n        return ActivityAGM.AGM.methodsForInstance(window.instance);\r\n    };\r\n    ActivityAGM.prototype.invoke = function (methodName, arg, target, options, success, error) {\r\n        this._ensureHasAgm();\r\n        var activityServers = this.servers();\r\n        var serversToInvokeAgainst = [];\r\n        if (isUndefinedOrNull(target)) {\r\n            target = \"activity.all\";\r\n        }\r\n        if (isString(target)) {\r\n            if (target === \"activity.all\") {\r\n                serversToInvokeAgainst = activityServers;\r\n            }\r\n            else if (target === \"activity.best\") {\r\n                var potentialTargets = activityServers.filter(function (server) {\r\n                    var methods = ActivityAGM.AGM.methodsForInstance(server);\r\n                    return methods.filter(function (m) {\r\n                        return m.name === methodName;\r\n                    }).length > 0;\r\n                });\r\n                if (potentialTargets.length > 0) {\r\n                    serversToInvokeAgainst = [potentialTargets[0]];\r\n                }\r\n            }\r\n            else if (target === \"all\" || target === \"best\") {\r\n                return promisify$1(ActivityAGM.AGM.invoke(methodName, arg, target, options), success, error);\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid invoke target \" + target);\r\n            }\r\n        }\r\n        else if (isArray(target)) {\r\n            if (target.length >= 0) {\r\n                var firstElem = target[0];\r\n                if (this._isInstance(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (instance) { return instance; });\r\n                }\r\n                else if (this._isActivityWindow(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (win) { return win.instance; });\r\n                }\r\n                else {\r\n                    throw new Error(\"Unknown target object\");\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isInstance(target)) {\r\n                serversToInvokeAgainst = [target];\r\n            }\r\n            else if (this._isActivityWindow(target)) {\r\n                serversToInvokeAgainst = [target.instance];\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown target object\");\r\n            }\r\n        }\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    ActivityAGM.prototype.unregister = function (definition) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.unregister(definition);\r\n    };\r\n    ActivityAGM.prototype.createStream = function (methodDefinition, subscriptionAddedHandler, subscriptionRemovedHandler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.createStream(methodDefinition, {\r\n            subscriptionAddedHandler: subscriptionAddedHandler,\r\n            subscriptionRemovedHandler: subscriptionRemovedHandler,\r\n            subscriptionRequestHandler: undefined\r\n        });\r\n    };\r\n    ActivityAGM.prototype.subscribe = function (methodDefinition, parameters, target) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.subscribe(methodDefinition, parameters);\r\n    };\r\n    ActivityAGM.prototype._ensureHasAgm = function () {\r\n        if (isUndefinedOrNull(ActivityAGM.AGM)) {\r\n            throw new Error(\"Agm should be configured to be used in activity\");\r\n        }\r\n    };\r\n    ActivityAGM.prototype._isInstance = function (obj) {\r\n        return obj.application !== undefined;\r\n    };\r\n    ActivityAGM.prototype._isActivityWindow = function (obj) {\r\n        return obj.instance !== undefined;\r\n    };\r\n    return ActivityAGM;\r\n}());\n\nvar AttachedActivityDescriptor = (function () {\r\n    function AttachedActivityDescriptor(manager, ownerActivityId, state) {\r\n        this._manager = manager;\r\n        this._ownerActivityId = ownerActivityId;\r\n        this._state = state;\r\n    }\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"ownerId\", {\r\n        get: function () {\r\n            return this._state.ownerId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"windowIds\", {\r\n        get: function () {\r\n            return this._state.windowIds;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"frameColor\", {\r\n        get: function () {\r\n            return this._state.frameColor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"context\", {\r\n        get: function () {\r\n            return this._state.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"tag\", {\r\n        get: function () {\r\n            return this._state.tag;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AttachedActivityDescriptor.prototype.detach = function (descriptor) {\r\n        var _this = this;\r\n        descriptor = descriptor || {};\r\n        var merged = {};\r\n        Object.keys(this._state).forEach(function (prop) {\r\n            merged[prop] = _this._state[prop];\r\n        });\r\n        merged.context = descriptor.context || merged.context;\r\n        merged.frameColor = descriptor.frameColor || merged.frameColor;\r\n        return this._manager.detachActivities(this._ownerActivityId, merged);\r\n    };\r\n    return AttachedActivityDescriptor;\r\n}());\n\nvar nextTick = function (cb) {\r\n    setTimeout(cb, 0);\r\n};\r\nfunction nodeify(promise, callback) {\r\n    if (!isFunction(callback)) {\r\n        return promise;\r\n    }\r\n    promise.then(function (resp) {\r\n        nextTick(function () {\r\n            callback(null, resp);\r\n        });\r\n    }, function (err) {\r\n        nextTick(function () {\r\n            callback(err, null);\r\n        });\r\n    });\r\n}\n\nvar Activity = (function (_super) {\r\n    __extends(Activity, _super);\r\n    function Activity(id, actType, status, context, ownerId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._id = id;\r\n        _this._actType = actType;\r\n        _this._status = status;\r\n        _this._context = context;\r\n        _this._ownerId = ownerId;\r\n        _this._agm = new ActivityAGM(_this);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Activity.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getActivityType(this._actType);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"context\", {\r\n        get: function () {\r\n            return this._context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"status\", {\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"owner\", {\r\n        get: function () {\r\n            if (!this._ownerId) {\r\n                return null;\r\n            }\r\n            return this._manager.getWindows({ id: this._ownerId })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ activityId: this._id });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.addWindow = function (window, callback) {\r\n        return this._manager.addWindowToActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.createWindow = function (windowType, callback) {\r\n        return this._manager.createWindow(this, windowType, callback);\r\n    };\r\n    Activity.prototype.createStackedWindows = function (windowTypes, timeout, callback) {\r\n        return this._manager.createStackedWindows(this, windowTypes, timeout, callback);\r\n    };\r\n    Activity.prototype.leave = function (window, callback) {\r\n        return this._manager.leaveWindowFromActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.getWindowsByType = function (windowType) {\r\n        var filter = { activityId: this._id, type: windowType };\r\n        return this._manager.getWindows(filter);\r\n    };\r\n    Activity.prototype.setContext = function (context, callback) {\r\n        return this._manager.setActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.updateContext = function (context, callback) {\r\n        return this._manager.updateActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.onStatusChange = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeActivityEvents(function (a, ns, os) {\r\n            if (a.id === _this.id) {\r\n                handler(a, ns, os);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onWindowEvent = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeWindowEvents(function (a, w, e) {\r\n            if (a.id === _this.id) {\r\n                handler(a, w, e);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onContextChanged = function (handler) {\r\n        var _this = this;\r\n        this._manager.subscribeActivityContextChanged(function (act, context, updated, removed) {\r\n            if (act.id === _this.id) {\r\n                handler(context, updated, removed, act);\r\n            }\r\n        });\r\n        try {\r\n            handler(this.context, this.context, [], this);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n    };\r\n    Activity.prototype.stop = function () {\r\n        this._manager.stopActivity(this);\r\n    };\r\n    Activity.prototype.clone = function (options) {\r\n        return this._manager.clone(this, options);\r\n    };\r\n    Activity.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._manager.attachActivities(activityId, this.id, tag);\r\n    };\r\n    Activity.prototype.onActivityAttached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesAttached(function (newActId, oldActId, descriptor) {\r\n            if (newActId !== _this._id) {\r\n                return;\r\n            }\r\n            callback(descriptor);\r\n        });\r\n    };\r\n    Activity.prototype.onDetached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesDetached(function (newAct, originalActivity, state) {\r\n            if (originalActivity.id !== _this._id) {\r\n                return;\r\n            }\r\n            callback(newAct, state);\r\n        });\r\n    };\r\n    Activity.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._actType, function (x) { return _this._actType = x; });\r\n        ifNotUndefined(other._context, function (x) { return _this._context = x; });\r\n        ifNotUndefined(other._ownerId, function (x) { return _this._ownerId = x; });\r\n        if (other._status && (!this._status || (this._status.state !== other._status.state))) {\r\n            this._status = other._status;\r\n        }\r\n    };\r\n    Activity.prototype._updateDescriptors = function (allStates) {\r\n        var _this = this;\r\n        this._attached = allStates.map(function (s) {\r\n            return new AttachedActivityDescriptor(_this._manager, _this._id, s);\r\n        });\r\n    };\r\n    Object.defineProperty(Activity.prototype, \"attached\", {\r\n        get: function () {\r\n            return this._attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.setFrameColor = function (color, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var callbacksToWait = _this.windows.length;\r\n            if (callbacksToWait === 0) {\r\n                resolve(_this);\r\n            }\r\n            _this.windows.forEach(function (w) {\r\n                w.underlyingWindow.setFrameColor(color, function () {\r\n                    callbacksToWait--;\r\n                    if (callbacksToWait <= 0) {\r\n                        resolve(_this);\r\n                    }\r\n                });\r\n            });\r\n            setTimeout(function () {\r\n                if (callbacksToWait > 0) {\r\n                    reject(_this.id + \" - timed out waiting for setFrameColor with\" + color);\r\n                }\r\n            }, 5000);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Activity.prototype.getFrameColor = function () {\r\n        if (!this.windows || this.windows.length === 0) {\r\n            return \"\";\r\n        }\r\n        return this.windows[0].underlyingWindow.frameColor;\r\n    };\r\n    return Activity;\r\n}(ActivityEntity));\n\nvar LogLevel = (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.Trace = \"trace\";\r\n    LogLevel.Debug = \"debug\";\r\n    LogLevel.Info = \"info\";\r\n    LogLevel.Warn = \"warn\";\r\n    LogLevel.Error = \"error\";\r\n    return LogLevel;\r\n}());\r\nvar Logger$1 = (function () {\r\n    function Logger(name) {\r\n        this._name = name;\r\n        if (!isUndefinedOrNull(Logger.GlueLogger)) {\r\n            this._glueLogger = Logger.GlueLogger.subLogger(name);\r\n        }\r\n    }\r\n    Logger.GetNamed = function (name) {\r\n        return new Logger(name);\r\n    };\r\n    Logger.Get = function (owner) {\r\n        return new Logger(Logger.GetTypeName(owner));\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.trace(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Trace));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.debug(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Debug));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.info(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.warn(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info ||\r\n                Logger.Level === LogLevel.Warn) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.error = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.error(message);\r\n        }\r\n        else {\r\n            console.error(this._getMessage(message, LogLevel.Error));\r\n            console.trace();\r\n        }\r\n    };\r\n    Logger.prototype._getMessage = function (message, level) {\r\n        return \"[\" + level + \"] \" + this._name + \" - \" + message;\r\n    };\r\n    Logger.GetTypeName = function (object) {\r\n        var funcNameRegex = /function (.{1,})\\(/;\r\n        var results = (funcNameRegex).exec(object.constructor.toString());\r\n        return (results && results.length > 1) ? results[1] : \"\";\r\n    };\r\n    Logger.Level = LogLevel.Info;\r\n    return Logger;\r\n}());\n\nvar ActivityWindow = (function (_super) {\r\n    __extends(ActivityWindow, _super);\r\n    function ActivityWindow(id, name, type, activityId, instance, isIndependent, windowGetter, hcWindowId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._logger = Logger$1.Get(\"window\");\r\n        _this._type = type;\r\n        _this._activityId = activityId;\r\n        _this._name = name;\r\n        _this._instance = instance;\r\n        _this._isIndependent = isIndependent;\r\n        _this._windowGetter = windowGetter;\r\n        _this._hcWindowId = hcWindowId;\r\n        return _this;\r\n    }\r\n    ActivityWindow.prototype.getBounds = function () {\r\n        return this._manager.getWindowBounds(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isIndependent\", {\r\n        get: function () {\r\n            return this._isIndependent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getWindowType(this._type);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"activity\", {\r\n        get: function () {\r\n            if (isUndefined(this._activityId)) {\r\n                return undefined;\r\n            }\r\n            return this._manager.getActivityById(this._activityId);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isOwner\", {\r\n        get: function () {\r\n            var act = this.activity;\r\n            if (isUndefined(act)) {\r\n                return false;\r\n            }\r\n            return act.owner.id === this.id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.setVisible = function (isVisible, callback) {\r\n        return this._manager.setWindowVisibility(this.id, isVisible);\r\n    };\r\n    ActivityWindow.prototype.activate = function (focus) {\r\n        return this._manager.activateWindow(this.id, focus);\r\n    };\r\n    ActivityWindow.prototype.setBounds = function (bounds, callback) {\r\n        return this._manager.setWindowBounds(this.id, bounds, callback);\r\n    };\r\n    ActivityWindow.prototype.close = function () {\r\n        return this._manager.closeWindow(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"instance\", {\r\n        get: function () {\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"underlyingWindow\", {\r\n        get: function () {\r\n            var window = this._windowGetter();\r\n            if (!window) {\r\n                return {\r\n                    id: this._hcWindowId\r\n                };\r\n            }\r\n            return window;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.onActivityJoined = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowJoinedActivity, callback);\r\n    };\r\n    ActivityWindow.prototype.onActivityRemoved = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowLeftActivity, callback);\r\n    };\r\n    ActivityWindow.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        ifNotUndefined(other._activityId, function (x) { return _this._activityId = x; });\r\n        ifNotUndefined(other._isIndependent, function (x) { return _this._isIndependent = x; });\r\n        ifNotUndefined(other._hcWindowId, function (x) { return _this._hcWindowId = x; });\r\n        ifNotUndefined(other._type, function (x) { return _this._type = x; });\r\n        ifNotUndefined(other._name, function (x) { return _this._name = x; });\r\n        if (!isUndefinedOrNull(other._instance)) {\r\n            this._instance = other._instance;\r\n        }\r\n    };\r\n    ActivityWindow.prototype._subscribeForActivityWindowEvent = function (eventName, callback) {\r\n        var _this = this;\r\n        this._manager.subscribeWindowEvents(function (activity, window, event) {\r\n            if (window.id !== _this.id) {\r\n                return;\r\n            }\r\n            if (event === eventName) {\r\n                callback(activity);\r\n            }\r\n        });\r\n    };\r\n    ActivityWindow.prototype._beforeDelete = function (other) {\r\n        this._hcWindowId = other._hcWindowId;\r\n    };\r\n    return ActivityWindow;\r\n}(ActivityEntity));\n\nvar ActivityStatus = (function () {\r\n    function ActivityStatus(state, message, time) {\r\n        this.state = state;\r\n        this.message = message;\r\n        this.time = time;\r\n    }\r\n    ActivityStatus.prototype.getState = function () {\r\n        return this.state;\r\n    };\r\n    ActivityStatus.prototype.getMessage = function () {\r\n        return this.message;\r\n    };\r\n    ActivityStatus.prototype.getTime = function () {\r\n        return this.time;\r\n    };\r\n    return ActivityStatus;\r\n}());\n\nvar gwMmessageError = \"error\";\r\nvar gwMessageAddActivityTypes = \"add-types\";\r\nvar gwMmessageActivityTypesAdded = \"types-added\";\r\nvar gwMessageRemoveActivityTypes = \"remove-types\";\r\nvar gwMessageActivityTypesRemoved = \"types-removed\";\r\nvar gwMessageActivityCreated = \"created\";\r\nvar gwMessageActivityDestroyed = \"destroyed\";\r\nvar gwMessageActivityInitiated = \"initiated\";\r\nvar gwMmessageJoinActivity = \"join-activity\";\r\nvar gwMessageJoinedActivity = \"joined\";\r\nvar gwMessageActivityJoined = \"activity-joined\";\r\nvar gwMessageLeaveActivity = \"leave-activity\";\r\nvar gwMessageActivityLeft = \"left\";\r\nvar gwNmessageMergeActivities = \"merge\";\r\nvar gwMessageSplitActivities = \"split\";\r\nvar gwMessageOwnerChanged = \"owner-changed\";\r\nvar gwMessageAddPeerFactories = \"add-peer-factories\";\r\nvar gwMessagePeerFactoriesAdded = \"peer-factories-added\";\r\nvar gwMessageRemovePeerFactories = \"remove-peer-factories\";\r\nvar gwMessagePeerFactoriesRemoved = \"peer-factories-removed\";\r\nvar gwMessageCreateActivity = \"create\";\r\nvar gwMessageCreatePeer = \"create-peer\";\r\nvar gwMessagePeerRequested = \"peer-requested\";\r\nvar gwMessageReady = \"ready\";\r\nvar gwMessagePeerCreated = \"peer-created\";\r\nvar gwMessageDestroyActivity = \"destroy\";\r\nvar gwMessageDisposePeer = \"dispose-peer\";\r\nvar gwMessageDestroyPeer = \"destroy-peer\";\r\nvar GW3Bridge$1 = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        this._activityChangeCallbacks = [];\r\n        this._activityTypeStatusChangeCallbacks = [];\r\n        this._activityWindowChangeCallbacks = [];\r\n        this._windowTypeStatusChangeCallbacks = [];\r\n        this._peerIdAndFactoryIdToPeerType = {};\r\n        this._peerFactoriesRegisteredByUs = {};\r\n        this._gw3Subscriptions = [];\r\n        this._contextSubscriptions = {};\r\n        this._activityTypesInitiatedFromMe = {};\r\n        this._config = config;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._contexts = config.contexts;\r\n        this._windows = config.windows;\r\n        this._sessionJoinedPromise = new Promise(function (resolve) {\r\n            _this._sessionJoinedPromiseResolve = resolve;\r\n        });\r\n        this._activityJoinedPromise = new Promise(function (resolve) {\r\n            _this._activityJoinedPromiseResolve = resolve;\r\n        });\r\n        if (!this._config.activityId) {\r\n            this._activityJoinedPromiseResolve({});\r\n        }\r\n        this._gw3Session = this._connection.domain(\"activity\", [\"joined\", \"initiated\", \"peer-created\", \"token\"]);\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd_1 = window.glue42gd;\r\n            if (glue42gd_1 && typeof glue42gd_1.addRefreshHandler === \"function\") {\r\n                glue42gd_1.addRefreshHandler(function (success, error) {\r\n                    _this._gw3Session\r\n                        .send({\r\n                        type: \"reload\"\r\n                    })\r\n                        .then(function (msg) {\r\n                        if (!msg.token) {\r\n                            error(\"Expected gateway token for refreshing.\");\r\n                            return;\r\n                        }\r\n                        try {\r\n                            glue42gd_1.setGWToken(msg.token);\r\n                        }\r\n                        catch (e) {\r\n                            error(e.message || e);\r\n                            return;\r\n                        }\r\n                        success();\r\n                    }, error);\r\n                });\r\n            }\r\n        }\r\n    }\r\n    GW3Bridge.activityTypeGwMessageEntityToActivityType = function (entity, description) {\r\n        var nameToWindowType = function (windowName) {\r\n            return new WindowType(windowName, undefined);\r\n        };\r\n        return new ActivityType(entity.name, entity.owner_type && nameToWindowType(entity.owner_type), entity.helper_types && entity.helper_types.map(nameToWindowType), description);\r\n    };\r\n    GW3Bridge.peerFactoryGwMessageEntityToWindowType = function (entity) {\r\n        return new WindowType(entity.peer_type, function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.activityGwMessageToActivity = function (msg, status) {\r\n        var ownerId = msg.owner !== undefined ? msg.owner.peer_id : msg.owner_id;\r\n        return new Activity(msg.activity_id, msg.activity_type, status, msg.context_snapshot, ownerId);\r\n    };\r\n    GW3Bridge.activityToActivityStatusChangeEvent = function (act) {\r\n        return new EntityEvent(act, new ActivityStatusChangeEventContext(act.status, undefined));\r\n    };\r\n    Object.defineProperty(GW3Bridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"GW3\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.init = function () {\r\n        var _this = this;\r\n        this.forwardActivityTypeMessagesToStatusEventHandlers();\r\n        this.subscribe(gwMessageActivityCreated, this.handleActivityCreatedMessage);\r\n        this.subscribe(gwMessageActivityDestroyed, this.handleActivityDestroyedMessage);\r\n        this.forwardActivityMessagesToStatusEventHandlers();\r\n        this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers();\r\n        this.forwardPeerFactoryMessagesToStatusEventHandlers();\r\n        this.forwardPeerFactoryMessagesToPeerFactoryRequests();\r\n        this.subscribe(gwMessagePeerFactoriesAdded, this.handlePeerFactoriesAdded);\r\n        this.subscribe(gwMessagePeerFactoriesRemoved, this.handlePeerFactoriesRemoved);\r\n        this.forwardActivityWindowMessagesToEventHandlers();\r\n        this.subscribe(gwMessageDisposePeer, function () {\r\n            if (_this._config.disposeRequestHandling === \"dispose\") {\r\n                _this.dispose();\r\n                return;\r\n            }\r\n            if (_this._config.disposeRequestHandling === \"exit\") {\r\n                if (_this._windows && typeof _this._windows.my() !== \"undefined\") {\r\n                    _this._windows.my().close();\r\n                    return;\r\n                }\r\n                if (typeof window !== \"undefined\" && typeof window.close === \"function\") {\r\n                    window.close();\r\n                    return;\r\n                }\r\n                if (typeof process !== \"undefined\" && typeof process.exit === \"function\") {\r\n                    process.exit();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        this._gw3Session.onJoined(function () {\r\n            if (_this._config.mode === \"trackMyOnly\" ||\r\n                _this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                _this._sessionJoinedPromiseResolve(_this);\r\n            }\r\n            else {\r\n                _this._gw3Session\r\n                    .send({\r\n                    type: \"subscribe\",\r\n                    activity_types: (_this._config.mode === \"trackAll\" ? [] :\r\n                        _this._config.mode === \"trackTypes\" ? _this._config.typesToTrack : [])\r\n                })\r\n                    .then(function () {\r\n                    _this._sessionJoinedPromiseResolve(_this);\r\n                });\r\n            }\r\n        });\r\n        this._gw3Session.join();\r\n    };\r\n    GW3Bridge.prototype.dispose = function () {\r\n        var _this = this;\r\n        this._gw3Subscriptions.forEach(function (sub) { return sub && _this._connection.off(sub); });\r\n        this._gw3Subscriptions.length = 0;\r\n    };\r\n    GW3Bridge.prototype.ready = function () {\r\n        return Promise.all([this._sessionJoinedPromise, this._activityJoinedPromise]);\r\n    };\r\n    GW3Bridge.prototype.initReady = function () {\r\n        return this._sessionJoinedPromise;\r\n    };\r\n    GW3Bridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, config, description) {\r\n        var _this = this;\r\n        var entity = {};\r\n        entity.name = activityTypeName;\r\n        var toActivityPeerConfig = function (windowDefinition) { return ({ type: windowDefinition.type, name: windowDefinition.name, configuration: windowDefinition }); };\r\n        entity.owner_type = toActivityPeerConfig(ownerWindow);\r\n        entity.helper_types = helperWindows.map(toActivityPeerConfig);\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageAddActivityTypes,\r\n            types: [entity]\r\n        })\r\n            .then(function () {\r\n            var activityType = GW3Bridge.activityTypeGwMessageEntityToActivityType(entity, description);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Added)), gwMessageAddActivityTypes);\r\n            return activityType;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageRemoveActivityTypes,\r\n            types: [activityTypeName]\r\n        })\r\n            .then(function () {\r\n            var activityType = new ActivityType(activityTypeName, undefined, undefined, undefined);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Removed)), gwMessageAddActivityTypes);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerWindowFactory = function (windowType, factory, parameters) {\r\n        var _this = this;\r\n        if (this._peerFactoriesRegisteredByUs[windowType]) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" already registered.\"));\r\n        }\r\n        this._peerFactoriesRegisteredByUs[windowType] = factory;\r\n        var entity = {\r\n            id: windowType,\r\n            peer_type: windowType,\r\n            configuration: parameters\r\n        };\r\n        return this._gw3Session.send({\r\n            type: gwMessageAddPeerFactories,\r\n            factories: [entity]\r\n        })\r\n            .then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(entity), new EntityEventContext(EntityEventType.Added)), gwMessageAddPeerFactories);\r\n        })\r\n            .catch(function () {\r\n            delete _this._peerFactoriesRegisteredByUs[windowType];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterWindowFactory = function (windowType) {\r\n        var _this = this;\r\n        var factory = this._peerFactoriesRegisteredByUs[windowType];\r\n        if (!factory) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" not registered.\"));\r\n        }\r\n        delete this._peerFactoriesRegisteredByUs[windowType];\r\n        return this._gw3Session.send({\r\n            type: gwMessageRemovePeerFactories,\r\n            factory_ids: [windowType]\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(new WindowType(windowType, undefined), new EntityEventContext(EntityEventType.Removed)), gwMessageAddPeerFactories);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        var initiateMsg = {\r\n            type: gwMessageCreateActivity,\r\n            activity_type: activityType,\r\n            initial_context: context,\r\n        };\r\n        if (this.isOverrideTypeDefinition(configuration)) {\r\n            initiateMsg.types_override = {\r\n                owner_type: { type: configuration.owner.type, name: configuration.owner.name, configuration: configuration.owner },\r\n                helper_types: configuration.helpers && configuration.helpers.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); })\r\n            };\r\n        }\r\n        else {\r\n            initiateMsg.configuration = configuration && configuration.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); });\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise(initiateMsg, gwMessageActivityInitiated, function (msg, requestId) { return msg.request_id === requestId; }, gwMessageActivityCreated, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, gwMessageActivityDestroyed, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, function (msg) { return msg.activity_id; }).then(function (id) {\r\n            if (_this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                if (!_this._activityTypesInitiatedFromMe[activityType]) {\r\n                    _this._activityTypesInitiatedFromMe[activityType] = true;\r\n                    return _this._gw3Session\r\n                        .send({\r\n                        type: \"subscribe\",\r\n                        activity_types: [activityType]\r\n                    })\r\n                        .then(function () {\r\n                        return id;\r\n                    });\r\n                }\r\n            }\r\n            return id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.stopActivity = function (activity) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyActivity,\r\n            activity_id: activity.id,\r\n            reason_uri: \"com.tick42.glue.activity.constants.destroyReason.general\",\r\n            reason: \"Destroying activity\"\r\n        }).then(function (_) { return true; });\r\n    };\r\n    GW3Bridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        if (fullReplace) {\r\n            return this._contexts.set(activity.id, context);\r\n        }\r\n        else {\r\n            removedKeys = removedKeys || [];\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var x = removedKeys_1[_i];\r\n                context[x] = null;\r\n            }\r\n            return this._contexts.update(activity.id, context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        throw new Error(\"Invalid operation 'announceWindow' for GW3 protocol\");\r\n    };\r\n    GW3Bridge.prototype.registerWindow = function (type, name, independent) {\r\n        var shouldSendReady = typeof this._connection.gatewayToken !== \"undefined\";\r\n        var peerId = this._connection.peerId;\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                shouldSendReady = typeof glue42gd.activityInfo !== \"undefined\";\r\n            }\r\n        }\r\n        if (shouldSendReady) {\r\n            this._gw3Session.send({\r\n                type: gwMessageReady,\r\n            });\r\n        }\r\n        this.invokeCallbacks(this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(peerId, name, type, undefined, this.getAgmInstance(peerId), independent, this.generateWindowGetter(peerId), undefined), new EntityEventContext(EntityEventType.Added)), \"register window\");\r\n        return Promise.resolve(peerId);\r\n    };\r\n    GW3Bridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._activityWindowChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.createWindow = function (activityId, windowDefinition) {\r\n        var _this = this;\r\n        if (!windowDefinition.layout) {\r\n            if (windowDefinition.left || windowDefinition.width || windowDefinition.height || windowDefinition.top) {\r\n                windowDefinition.layout = {\r\n                    mode: \"pixels\",\r\n                    cellSize: 1,\r\n                };\r\n            }\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise({\r\n            type: gwMessageCreatePeer,\r\n            peer_type: windowDefinition.type,\r\n            peer_name: windowDefinition.name || windowDefinition.type,\r\n            configuration: windowDefinition,\r\n            activity_id: activityId,\r\n        }, undefined, undefined, gwMessagePeerCreated, function (msg, requestId) { return msg.request_id === requestId; }, undefined, undefined, function (msg) { return msg.created_id; })\r\n            .then(function (id) {\r\n            if (!activityId) {\r\n                return;\r\n            }\r\n            return _this.joinActivity(activityId, id, windowDefinition.name)\r\n                .then(function () {\r\n                return id;\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.closeWindow = function (id) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyPeer,\r\n            destroy_peer_id: id\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.getAnnouncementInfo = function () {\r\n        var activityId = this._config.activityId || (this._config.announcementInfo && this._config.announcementInfo.activityId);\r\n        var activityWindowType = (this._config.announcementInfo && this._config.announcementInfo.activityWindowType);\r\n        var activityWindowIndependent = (this._config.announcementInfo && this._config.announcementInfo.activityWindowIndependent);\r\n        var activityWindowName = (this._config.announcementInfo && this._config.announcementInfo.activityWindowName);\r\n        if (typeof window !== \"undefined\" &&\r\n            typeof window.location !== \"undefined\" &&\r\n            window.location.search &&\r\n            typeof URLSearchParams === \"function\") {\r\n            var searchParams = new URLSearchParams(location.search.slice(1));\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42PeerType\");\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42ActivityWindowType\");\r\n            if (typeof activityWindowIndependent === \"undefined\") {\r\n                activityWindowIndependent = searchParams.get(\"t42ActivityWindowIndependent\");\r\n            }\r\n            activityWindowName = activityWindowName || searchParams.get(\"t42ActivityWindowName\");\r\n            activityId = activityId || searchParams.get(\"t42ActivityId\");\r\n        }\r\n        activityWindowType = activityWindowType || \"unknown\";\r\n        activityWindowIndependent = activityWindowIndependent || false;\r\n        activityWindowName = activityWindowName || this._connection.peerId;\r\n        return {\r\n            activityWindowId: undefined,\r\n            activityId: activityId,\r\n            activityWindowType: activityWindowType,\r\n            activityWindowIndependent: activityWindowIndependent,\r\n            activityWindowName: activityWindowName,\r\n        };\r\n    };\r\n    GW3Bridge.prototype.joinActivity = function (activityId, windowId, name) {\r\n        var _this = this;\r\n        var maybeName = (name && { name: name }) || {};\r\n        return this._gw3Session.send(__assign({ type: gwMmessageJoinActivity, target_id: windowId, activity_id: activityId }, maybeName)).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, activityId, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), \"activity joined - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity joined - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMessageLeaveActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, null, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), \"activity left - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity left - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.getActivityTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getWindowTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivities = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivityWindows = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.getWindowBounds = function (id) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowBounds = function (id, bounds) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.activateWindow = function (id, focus) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowVisibility = function (id, visible) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.cloneActivity = function (id, cloneOptions) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.attachActivities = function (from, to, tag) {\r\n        return this._gw3Session.send({\r\n            type: gwNmessageMergeActivities,\r\n            into: to,\r\n            merge: from\r\n        });\r\n    };\r\n    GW3Bridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageSplitActivities,\r\n            from: activityId,\r\n        }).then(function () { return \"\"; });\r\n    };\r\n    GW3Bridge.prototype.onActivitiesAttached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivitiesDetached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.getAttachedDescriptors = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getRandomRequestId = function () {\r\n        return this._connection.peerId + \":\" + Math.floor(Math.random() * 1e9) + \"\";\r\n    };\r\n    GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler = function (addedMessageType, removedMessageType, mapper, handlers) {\r\n        var getGetEntityEvent = function (isAdded) { return function (entity) { return new EntityEvent(entity, new EntityEventContext(isAdded ?\r\n            EntityEventType.Added :\r\n            EntityEventType.Removed)); }; };\r\n        var sub1;\r\n        var sub2;\r\n        sub1 = addedMessageType && this.forwardMessageToEventHandler(addedMessageType, function (msg) { return mapper(msg, true); }, getGetEntityEvent(true), handlers);\r\n        sub2 = removedMessageType && this.forwardMessageToEventHandler(removedMessageType, function (msg) { return mapper(msg, false); }, getGetEntityEvent(false), handlers);\r\n        return [sub1, sub2].filter(function (x) { return x; });\r\n    };\r\n    GW3Bridge.prototype.forwardMessageToEventHandler = function (messageType, mapper, getEntityEvent, handler) {\r\n        return this.subscribe(messageType, function (msg) {\r\n            mapper(msg)\r\n                .forEach(function (ent) {\r\n                return handler.forEach(function (h) { return h(getEntityEvent(ent, msg)); });\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise = function (msg, initiatedMessageType, initiatedMessageFilter, createdMessageType, createdMessageFilter, cancelledMessageType, cancelledMessageFilter, createdMessageToPromiseResolution) {\r\n        var _this = this;\r\n        var reqId = this.getRandomRequestId();\r\n        var resolveCreatedPromise;\r\n        var rejectCreatedPromise;\r\n        var createdPromise = new Promise(function (resolve, reject) {\r\n            resolveCreatedPromise = resolve;\r\n            rejectCreatedPromise = reject;\r\n        });\r\n        var initiatedMessageAck = null;\r\n        var initiatedSubscription;\r\n        var createdSubscription;\r\n        var cancelledSubscription;\r\n        var errorSubscription;\r\n        var dropSubscriptions = function () {\r\n            _this.dropSubscription(initiatedSubscription);\r\n            _this.dropSubscription(createdSubscription);\r\n            _this.dropSubscription(cancelledSubscription);\r\n            _this.dropSubscription(errorSubscription);\r\n        };\r\n        initiatedSubscription = initiatedMessageType &&\r\n            this.subscribe(initiatedMessageType, function (msg4) {\r\n                if (!initiatedMessageFilter(msg4, reqId)) {\r\n                    return;\r\n                }\r\n                initiatedMessageAck = msg4;\r\n                _this.dropSubscription(initiatedSubscription);\r\n            });\r\n        createdSubscription =\r\n            this.subscribe(createdMessageType, function (msg1) {\r\n                if (!createdMessageFilter(msg1, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                resolveCreatedPromise(createdMessageToPromiseResolution(msg1));\r\n            });\r\n        cancelledSubscription = cancelledMessageType &&\r\n            this.subscribe(cancelledMessageType, function (msg2) {\r\n                if (!cancelledMessageFilter(msg2, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg2);\r\n            });\r\n        errorSubscription = cancelledMessageType &&\r\n            this.subscribe(gwMmessageError, function (msg3) {\r\n                if (msg3.request_id !== reqId) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg3);\r\n            });\r\n        msg.request_id = reqId;\r\n        var toReturn = this._gw3Session\r\n            .send(msg)\r\n            .then(function () {\r\n            return createdPromise;\r\n        });\r\n        toReturn.then(dropSubscriptions, dropSubscriptions);\r\n        return toReturn;\r\n    };\r\n    GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType = function (factoryId, ownerId) {\r\n        var peerType = this._peerIdAndFactoryIdToPeerType[ownerId + \":\" + factoryId];\r\n        if (!peerType) {\r\n            return null;\r\n        }\r\n        else {\r\n            return new WindowType(peerType, undefined);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (messageType, handler) {\r\n        var _this = this;\r\n        var sub = this._connection.on(messageType, function (msg) { return handler.bind(_this)(msg); });\r\n        this._gw3Subscriptions.push(sub);\r\n        return sub;\r\n    };\r\n    GW3Bridge.prototype.dropSubscription = function (subscription) {\r\n        if (subscription) {\r\n            this._connection.off(subscription);\r\n            delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(subscription)];\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeCallbacks = function (callbacks, event, description) {\r\n        var _this = this;\r\n        callbacks.forEach(function (cb) {\r\n            try {\r\n                cb(event);\r\n            }\r\n            catch (err) {\r\n                _this._logger.error(\"Error in \" + (description || event.context.type) + \" callback: \" + JSON.stringify(err));\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityCreatedMessage = function (msg) {\r\n        if (!msg.context_id) {\r\n            this._logger.error(\"Activity created with unknown context_id: \" + msg.activity_id);\r\n        }\r\n        else {\r\n            if (!this._contextSubscriptions[msg.activity_id]) {\r\n                this.subscribeToContext(msg);\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContext = function (msg) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var activityId, _a, _b;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        activityId = msg.activity_id;\r\n                        _a = this._contextSubscriptions;\r\n                        _b = activityId;\r\n                        return [4, this._contexts.subscribe(activityId, function (data, updated, removed) {\r\n                                var event = new EntityEvent(new Activity(activityId, undefined, undefined, data, undefined), new ActivityContextChangedEventContext(data, updated, removed));\r\n                                _this.invokeCallbacks(_this._activityChangeCallbacks, event, \"context updated\");\r\n                            })];\r\n                    case 1:\r\n                        _a[_b] =\r\n                            _c.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityDestroyedMessage = function (msg) {\r\n        var unsubscribeContext = this._contextSubscriptions[msg.activity_id];\r\n        if (typeof unsubscribeContext === \"function\") {\r\n            unsubscribeContext();\r\n        }\r\n        delete this._contextSubscriptions[msg.activity_id];\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesAdded = function (msg) {\r\n        var _this = this;\r\n        msg.factories.forEach(function (entity) {\r\n            _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + entity.id] = entity.peer_type;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesRemoved = function (msg) {\r\n        var _this = this;\r\n        msg.factory_ids.forEach(function (factoryId) {\r\n            delete _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + factoryId];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers = function () {\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded, gwMessageActivityTypesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.types.map(function (t) { return GW3Bridge.activityTypeGwMessageEntityToActivityType(t, undefined); })\r\n            : msg.types.map(function (t) { return new ActivityType(t.name, undefined, undefined, undefined); }); }, this._activityTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers = function () {\r\n        var _this = this;\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity, gwMessageOwnerChanged]; _i < _a.length; _i++) {\r\n            var activityCreatedMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(activityCreatedMessage, function (msg) {\r\n                return ([msg.owner || __assign(__assign({}, msg), { type: msg.peer_type, name: msg.peer_name, peer_id: msg.owner_id })])\r\n                    .concat(msg.participants || [])\r\n                    .map(function (info) { return new ActivityWindow(info.peer_id, info.name, info.type, msg.activity_id, _this.getAgmInstance(info.peer_id), undefined, _this.generateWindowGetter(info.peer_id), undefined); });\r\n            }, function (ent, msg) { return new EntityEvent(ent, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)); }, this._activityWindowChangeCallbacks);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers = function () {\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var createdMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(createdMessage, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"started\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        }\r\n        this.forwardMessageToEventHandler(gwMessageActivityDestroyed, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"destroyed\", msg.reason, new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageActivityInitiated, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageOwnerChanged, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers = function () {\r\n        var _this = this;\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded, gwMessagePeerFactoriesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType)\r\n            : msg.factory_ids.map(function (id) { return _this.peerFactoryIdAndOwnerIdToWindowType(id, msg.owner_id); }).filter(function (x) { return x != null; }); }, this._windowTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests = function () {\r\n        var _this = this;\r\n        this.subscribe(gwMessagePeerRequested, function (msg) {\r\n            var factory = _this._peerFactoriesRegisteredByUs[msg.peer_factory];\r\n            if (!factory) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: \"Unknown peer factory \" + msg.peer_factory\r\n                });\r\n                return;\r\n            }\r\n            try {\r\n                var configuration = msg.configuration || {};\r\n                configuration.gateway_token = configuration.gateway_token || msg.gateway_token;\r\n                configuration.peer_factory = configuration.peer_factory || msg.peer_factory;\r\n                var promise = factory({\r\n                    activityId: msg.activity && msg.activity.id,\r\n                    activityType: msg.activity && msg.activity.type,\r\n                    type: msg.configuration && msg.configuration.type,\r\n                    gwToken: configuration.gateway_token,\r\n                    configuration: configuration\r\n                });\r\n                if (promise && promise.then && promise.catch) {\r\n                    promise.catch(function (err) { return _this._gw3Session.send({\r\n                        type: gwMmessageError,\r\n                        request_id: msg.request_id,\r\n                        reason: err && (err.message || JSON.stringify(err))\r\n                    }); });\r\n                }\r\n            }\r\n            catch (err) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: err && (err.message || JSON.stringify(err))\r\n                });\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers = function () {\r\n        var _this = this;\r\n        var _loop_1 = function (joinedMessage) {\r\n            this_1.subscribe(joinedMessage, function (msg) {\r\n                var joinedId = (joinedMessage === gwMessageActivityJoined) ? msg.joined_id : msg.peer_id;\r\n                var joinedType = (joinedMessage === gwMessageActivityJoined) ? msg.joined_type : msg.peer_type;\r\n                var joinedName = (joinedMessage === gwMessageActivityJoined) ? msg.joined_name : msg.peer_name;\r\n                var entity = new ActivityWindow(joinedId, joinedName, joinedType, msg.activity_id, _this.getAgmInstance(joinedId), undefined, _this.generateWindowGetter(joinedId), undefined);\r\n                if (!_this._contextSubscriptions[msg.activity_id]) {\r\n                    _this.subscribeToContext(msg).then(function () {\r\n                        if (joinedMessage === gwMessageJoinedActivity) {\r\n                            _this._activityJoinedPromiseResolve({});\r\n                        }\r\n                    });\r\n                }\r\n                else if (joinedMessage === gwMessageJoinedActivity) {\r\n                    _this._activityJoinedPromiseResolve({});\r\n                }\r\n                _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), joinedMessage);\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = [gwMessageActivityJoined, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var joinedMessage = _a[_i];\r\n            _loop_1(joinedMessage);\r\n        }\r\n        this.subscribe(gwMessageActivityLeft, function (msg) {\r\n            var entity = new ActivityWindow(msg.left_id, undefined, undefined, null, _this.getAgmInstance(msg.left_id), undefined, _this.generateWindowGetter(msg.left_id), undefined);\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), gwMessageActivityLeft);\r\n        });\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated, undefined, function (msg) { return [\r\n            new ActivityWindow(msg.created_id, undefined, undefined, undefined, undefined, undefined, _this.generateWindowGetter(msg.created_id), undefined)\r\n        ]; }, this._activityWindowChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.getAgmInstance = function (id) {\r\n        return this._config.agm.servers().find(function (s) { return s.peerId === id || s.windowId === id; });\r\n    };\r\n    GW3Bridge.prototype.generateWindowGetter = function (peerId) {\r\n        var _this = this;\r\n        return function () {\r\n            var server = _this.getAgmInstance(peerId);\r\n            if (!server) {\r\n                return;\r\n            }\r\n            var windowId = server.windowId;\r\n            return _this._config.windows.list().filter(function (w) { return w.id === windowId; })[0];\r\n        };\r\n    };\r\n    GW3Bridge.prototype.isOverrideTypeDefinition = function (value) {\r\n        if (typeof value === \"undefined\") {\r\n            return false;\r\n        }\r\n        if (value.owner) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ActivityMy = (function () {\r\n    function ActivityMy(manager, windows) {\r\n        var _this = this;\r\n        this._myAttached = [];\r\n        this._myDetached = [];\r\n        this._myAttachedTo = [];\r\n        this._myDetachedFrom = [];\r\n        this._myActivityFrameColorChanged = [];\r\n        this._myActivityJoinedCallbacks = [];\r\n        this._myActivityRemovedCallbacks = [];\r\n        this._myContextUpdateCallbacks = [];\r\n        this._logger = Logger$1.Get(this);\r\n        this._m = manager;\r\n        manager.ready()\r\n            .then(function (am) {\r\n            am.subscribeActivityContextChanged(_this._subscribeMyContextChanged.bind(_this));\r\n            am.subscribeWindowEvents(_this._subscribeMyWindowEvent.bind(_this));\r\n            am.subscribeActivitiesAttached(_this._subscribeActivitiesAttached.bind(_this));\r\n            am.subscribeActivitiesDetached(_this._subscribeActivitiesDetached.bind(_this));\r\n            if (windows) {\r\n                windows.onWindowFrameColorChanged(_this._subscribeWindowFrameColorChanged.bind(_this));\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityMy.prototype, \"window\", {\r\n        get: function () {\r\n            if (isUndefinedOrNull(this._w)) {\r\n                var announcedWindows = this._m.announcedWindows;\r\n                if (announcedWindows.length > 0) {\r\n                    this._w = announcedWindows[0];\r\n                }\r\n            }\r\n            return this._w;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityMy.prototype, \"activity\", {\r\n        get: function () {\r\n            var myWin = this.window;\r\n            if (isUndefinedOrNull(myWin)) {\r\n                return undefined;\r\n            }\r\n            return myWin.activity;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.createWindow = function (windowType) {\r\n        return this._m.createWindow(this.activity, windowType);\r\n    };\r\n    ActivityMy.prototype.createStackedWindows = function (windowTypes, timeout) {\r\n        return this._m.createStackedWindows(this.activity, windowTypes, timeout);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"context\", {\r\n        get: function () {\r\n            var activity = this.activity;\r\n            if (isUndefined(activity)) {\r\n                return {};\r\n            }\r\n            return activity.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.updateContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.updateContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.setContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.setContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.onActivityJoined = function (callback) {\r\n        this._myActivityJoinedCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (!isUndefinedOrNull(myWin) && !isUndefinedOrNull(myWin.activity)) {\r\n            callback(myWin.activity);\r\n        }\r\n    };\r\n    ActivityMy.prototype.onActivityLeft = function (callback) {\r\n        this._myActivityRemovedCallbacks.push(callback);\r\n    };\r\n    ActivityMy.prototype.onContextChanged = function (callback) {\r\n        this._myContextUpdateCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var activity = myWin.activity;\r\n        if (isUndefinedOrNull(activity)) {\r\n            return;\r\n        }\r\n        callback(activity.context, activity.context, [], activity);\r\n    };\r\n    ActivityMy.prototype.clone = function (options, callback) {\r\n        var act = this.activity;\r\n        return this._m.clone(act, options, callback);\r\n    };\r\n    ActivityMy.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._m.attachActivities(activityId, this.activity.id, tag);\r\n    };\r\n    ActivityMy.prototype.onActivityAttached = function (callback) {\r\n        this._myAttached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onActivityDetached = function (callback) {\r\n        this._myDetached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onAttachedToActivity = function (callback) {\r\n        this._myAttachedTo.push(callback);\r\n    };\r\n    ActivityMy.prototype.onDetachedFromActivity = function (callback) {\r\n        this._myDetachedFrom.push(callback);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"attached\", {\r\n        get: function () {\r\n            if (!this.activity) {\r\n                return [];\r\n            }\r\n            return this.activity.attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.setFrameColor = function (color, callback) {\r\n        if (this.activity) {\r\n            return this.activity.setFrameColor(color, callback);\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    ActivityMy.prototype.getFrameColor = function () {\r\n        if (this.activity) {\r\n            return this.activity.getFrameColor();\r\n        }\r\n        return \"\";\r\n    };\r\n    ActivityMy.prototype.onFrameColorChanged = function (callback) {\r\n        this._myActivityFrameColorChanged.push(callback);\r\n    };\r\n    ActivityMy.prototype._subscribeMyContextChanged = function (activity, context, delta, removed) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (activity.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        this._notifyMyContextChanged(activity, context, delta, removed);\r\n    };\r\n    ActivityMy.prototype._subscribeMyWindowEvent = function (activity, window, event) {\r\n        if (isUndefinedOrNull(this.window)) {\r\n            return;\r\n        }\r\n        if (this.window.id !== window.id) {\r\n            return;\r\n        }\r\n        if (event === EntityEventType.ActivityWindowJoinedActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityJoinedCallbacks);\r\n            this._notifyMyContextChanged(activity, activity.context, null, null);\r\n        }\r\n        else if (event === EntityEventType.ActivityWindowLeftActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityRemovedCallbacks);\r\n        }\r\n    };\r\n    ActivityMy.prototype._notifyMyWindowEvent = function (activity, callbackStore) {\r\n        var _this = this;\r\n        callbackStore.forEach(function (element) {\r\n            try {\r\n                element(activity, event);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyMyContextChanged = function (activity, context, delta, removed) {\r\n        var _this = this;\r\n        delta = delta || {};\r\n        removed = removed || [];\r\n        this._myContextUpdateCallbacks.forEach(function (element) {\r\n            try {\r\n                element(context, delta, removed, activity);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttached = function (state) {\r\n        var _this = this;\r\n        this._myAttached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetached = function (state) {\r\n        var _this = this;\r\n        this._myDetached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttachedTo = function (state) {\r\n        var _this = this;\r\n        this._myAttachedTo.forEach(function (cb) {\r\n            try {\r\n                cb(_this.activity, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetachedFrom = function (detached, existing, state) {\r\n        var _this = this;\r\n        this._myDetachedFrom.forEach(function (cb) {\r\n            try {\r\n                cb(detached, existing, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesAttached = function (newAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (newAct.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        if (state.windowIds.indexOf(myWin.id) >= 0) {\r\n            this._notifyAttachedTo(state);\r\n            return;\r\n        }\r\n        this._notifyAttached(state);\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesDetached = function (newAct, oldAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (oldAct.id === myActivity.id) {\r\n            this._notifyDetached(state);\r\n        }\r\n        if (newAct.id === myActivity.id) {\r\n            this._notifyDetachedFrom(newAct, oldAct, state);\r\n        }\r\n    };\r\n    ActivityMy.prototype._subscribeWindowFrameColorChanged = function (window) {\r\n        var act = this.activity;\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id === window.id) {\r\n            this._myActivityFrameColorChanged.forEach(function (callback) {\r\n                callback(window.frameColor);\r\n            });\r\n        }\r\n    };\r\n    return ActivityMy;\r\n}());\n\nvar ReadyMarker = (function () {\r\n    function ReadyMarker(name, signalsToWait) {\r\n        this._logger = Logger$1.Get(\"ReadyMarker [\" + name + \"]\");\r\n        this._logger.debug(\"Initializing ready marker for '\" + name + \"' with \" + signalsToWait + \" signals to wait\");\r\n        if (signalsToWait <= 0) {\r\n            throw new Error(\"Invalid signal number. Should be > 0\");\r\n        }\r\n        this._signals = signalsToWait;\r\n        this._callbacks = [];\r\n        this._name = name;\r\n    }\r\n    ReadyMarker.prototype.setCallback = function (callback) {\r\n        if (this.isSet()) {\r\n            callback(undefined);\r\n            return;\r\n        }\r\n        else if (this.isError()) {\r\n            callback(this._error);\r\n            return;\r\n        }\r\n        this._callbacks.push(callback);\r\n    };\r\n    ReadyMarker.prototype.signal = function (message) {\r\n        this._logger.debug(\"Signaled - \" + message + \" - signals left \" + (this._signals - 1));\r\n        this._signals--;\r\n        if (this._signals < 0) {\r\n            throw new Error(\"Error in ready marker '\" + this._name + \" - signals are \" + this._signals);\r\n        }\r\n        if (this.isSet()) {\r\n            this._callbacks.forEach(function (callback) {\r\n                callback(undefined);\r\n            });\r\n        }\r\n    };\r\n    ReadyMarker.prototype.error = function (error) {\r\n        this._error = error;\r\n        this._callbacks.forEach(function (errorCallback) {\r\n            errorCallback(error);\r\n        });\r\n    };\r\n    ReadyMarker.prototype.isSet = function () {\r\n        if (this.isError()) {\r\n            return false;\r\n        }\r\n        return this._signals === 0;\r\n    };\r\n    ReadyMarker.prototype.isError = function () {\r\n        return !isUndefined(this._error);\r\n    };\r\n    ReadyMarker.prototype.getError = function () {\r\n        return this._error;\r\n    };\r\n    return ReadyMarker;\r\n}());\n\nvar EntityObservableCollection = (function () {\r\n    function EntityObservableCollection(processNew) {\r\n        this._items = {};\r\n        this._listeners = [];\r\n        this._processNew = processNew;\r\n    }\r\n    EntityObservableCollection.prototype.addOne = function (item) {\r\n        this.add([item]);\r\n    };\r\n    EntityObservableCollection.prototype.add = function (items) {\r\n        var _this = this;\r\n        items.forEach(function (element) {\r\n            _this.process(new EntityEvent(element, new EntityEventContext(EntityEventType.Added)));\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.process = function (event) {\r\n        var context = event.context;\r\n        var type = context.type;\r\n        var entity = event.entity;\r\n        if (type === EntityEventType.StatusChange &&\r\n            !context.oldStatus) {\r\n            var act = this._items[entity.id];\r\n            if (act) {\r\n                context.oldStatus = act.status;\r\n            }\r\n        }\r\n        if (type === EntityEventType.StatusChange &&\r\n            context.oldStatus &&\r\n            context.newStatus &&\r\n            context.oldStatus.state ===\r\n                context.newStatus.state) {\r\n            context.type = EntityEventType.Updated;\r\n        }\r\n        if (typeof htmlContainer === \"undefined\") {\r\n            if (type === EntityEventType.ActivityWindowJoinedActivity &&\r\n                this._items[entity.id] &&\r\n                this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n            if (type === EntityEventType.ActivityWindowLeftActivity &&\r\n                this._items[entity.id] &&\r\n                !this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n        }\r\n        var internalEntity = this._updateInternalCollections(entity, type, context);\r\n        this._notifyListeners(internalEntity, context);\r\n        return internalEntity;\r\n    };\r\n    EntityObservableCollection.prototype.get = function () {\r\n        var result = [];\r\n        for (var key in this._items) {\r\n            if (this._items.hasOwnProperty(key)) {\r\n                var element = this._items[key];\r\n                result.push(element);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    EntityObservableCollection.prototype.getByName = function (name) {\r\n        for (var key in this._items) {\r\n            if (key === name) {\r\n                return this._items[key];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    EntityObservableCollection.prototype.getOrWait = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var entityAddedHandler = function (entity) {\r\n                if (entity.id !== name) {\r\n                    return;\r\n                }\r\n                resolve(entity);\r\n                _this.unsubscribe(entityAddedHandler);\r\n            };\r\n            _this.subscribe(entityAddedHandler);\r\n            var window = _this.getByName(name);\r\n            if (window) {\r\n                _this.unsubscribe(entityAddedHandler);\r\n                resolve(window);\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.subscribe = function (handler) {\r\n        var _this = this;\r\n        this._listeners.push(handler);\r\n        Object.keys(this._items).forEach(function (key) {\r\n            var element = _this._items[key];\r\n            handler(element, new EntityEventContext(EntityEventType.Added.toString()));\r\n        });\r\n        return function () {\r\n            _this.unsubscribe(handler);\r\n        };\r\n    };\r\n    EntityObservableCollection.prototype.unsubscribe = function (handler) {\r\n        var index = this._listeners.indexOf(handler);\r\n        if (index !== -1) {\r\n            this._listeners.splice(index, 1);\r\n        }\r\n    };\r\n    EntityObservableCollection.prototype._notifyListeners = function (entity, context) {\r\n        this._listeners.forEach(function (listener) {\r\n            try {\r\n                listener(entity, context);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype._updateInternalCollections = function (entity, type, context) {\r\n        var entityAsAny = entity;\r\n        var isActivityDestroy = (type === EntityEventType.StatusChange &&\r\n            entityAsAny.status &&\r\n            entityAsAny.status.state === ActivityState.Destroyed) ||\r\n            (type === EntityEventType.StatusChange &&\r\n                context &&\r\n                context.newStatus &&\r\n                context.newStatus.state === ActivityState.Destroyed);\r\n        var isWindowClose = type === EntityEventType.Closed;\r\n        var isTypeRemove = type === EntityEventType.Removed && typeof entityAsAny.isIndependent === \"undefined\";\r\n        if (isTypeRemove || isWindowClose || isActivityDestroy) {\r\n            var oldEntity = this._items[entity.id];\r\n            delete this._items[entity.id];\r\n            this._processNew(entity);\r\n            if (oldEntity) {\r\n                entity._beforeDelete(oldEntity);\r\n            }\r\n            return entity;\r\n        }\r\n        else {\r\n            var key = entity.id;\r\n            if (!this._items.hasOwnProperty(key)) {\r\n                this._processNew(entity);\r\n                this._items[entity.id] = entity;\r\n            }\r\n            else {\r\n                this._items[entity.id]._update(entity);\r\n            }\r\n        }\r\n        return this._items[entity.id];\r\n    };\r\n    return EntityObservableCollection;\r\n}());\n\nvar ActivityManager = (function () {\r\n    function ActivityManager(bridge, autoAnnounce, windows) {\r\n        var _this = this;\r\n        this._logger = Logger$1.Get(\"activityManager\");\r\n        this._announcedWindows = [];\r\n        this._attachedCallbacks = [];\r\n        this._detachedCallbacks = [];\r\n        this._frameColorChangesCallbacks = [];\r\n        this._windowHandlers = [];\r\n        this._bridge = bridge;\r\n        this._activityTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windowTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._activities = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windows = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._dataReadyMarker = new ReadyMarker(\"Activity Manager Data\", [\"GetActivityTypes\", \"GetWindowTypes\", \"GetActivities\", \"GetWindows\"].length);\r\n        this._descriptorsMarker = new ReadyMarker(\"Attached Activities Descriptors\", [\"GetDescriptors\"].length);\r\n        if (autoAnnounce) {\r\n            this._readyMarker = new ReadyMarker(\"Activity Manager Announce\", [\"Announcement\"].length);\r\n            this._dataReadyMarker.setCallback(function (dataErr) {\r\n                if (dataErr) {\r\n                    _this._readyMarker.error(dataErr);\r\n                }\r\n                _this._descriptorsMarker.setCallback(function (err) {\r\n                    if (err) {\r\n                        _this._readyMarker.error(err);\r\n                    }\r\n                    _this._logger.debug(\"Auto announcing window\");\r\n                    _this.announceWindow()\r\n                        .then(function (w) {\r\n                        _this._announcedWindows.push(w);\r\n                        _this._readyMarker.signal(\"Successfully announced window with id '\" + w.id + \"'\");\r\n                    })\r\n                        .catch(function (errCatch) {\r\n                        _this._logger.debug(\"Will not announce window - \" + errCatch);\r\n                        _this._readyMarker.signal();\r\n                    });\r\n                });\r\n                _this.refreshDescriptors();\r\n            });\r\n        }\r\n        else {\r\n            this._readyMarker = this._dataReadyMarker;\r\n        }\r\n        this._bridge.onActivitiesAttached(function (e) {\r\n            _this._handleActivitiesAttached(e);\r\n        });\r\n        this._bridge.onActivitiesDetached(function (e) {\r\n            _this._handleActivitiesDetached(e);\r\n        });\r\n        this._bridge.onActivityAttachedDescriptorsRefreshed(function (e) {\r\n            _this._handleActivityDescriptorsRefreshed(e);\r\n        });\r\n        if (windows) {\r\n            windows.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this));\r\n        }\r\n        this._bridge.init();\r\n        this._subscribeForData();\r\n        this._bridge\r\n            .initReady()\r\n            .then(function (aw) {\r\n            _this._getInitialData();\r\n        })\r\n            .catch(function (error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityManager.prototype, \"usingHc\", {\r\n        get: function () {\r\n            return this._bridge.bridgeType === \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityManager.prototype, \"announcedWindows\", {\r\n        get: function () {\r\n            return this._announcedWindows;\r\n        },\r\n        set: function (v) {\r\n            throw new Error(\"not allowed\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityManager.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n        return nodeify(Promise.all([this._bridge.ready(), promise]).then(function () { return _this; }), callback);\r\n    };\r\n    ActivityManager.prototype.getActivityTypes = function () {\r\n        return this._activityTypes.get();\r\n    };\r\n    ActivityManager.prototype.getActivityType = function (name) {\r\n        return this._activityTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerActivityType = function (activityTypeName, ownerWindowType, helperWindowTypes, config, description, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activityTypeName)) {\r\n                reject(\"activityTypeName argument can not be undefined\");\r\n                return;\r\n            }\r\n            if (!isString(activityTypeName)) {\r\n                reject(\"activityTypeName should be string\");\r\n                return;\r\n            }\r\n            var actType = _this.getActivityType(activityTypeName);\r\n            if (!isUndefinedOrNull(actType)) {\r\n                reject(\"Activity type '\" + activityTypeName + \"' already exists\");\r\n                return;\r\n            }\r\n            var ownerDefinition;\r\n            if (isUndefined(ownerWindowType)) {\r\n                reject(\"Owner window type can not be undefined\");\r\n                return;\r\n            }\r\n            if (isString(ownerWindowType)) {\r\n                ownerDefinition = { type: ownerWindowType, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                ownerDefinition = ownerWindowType;\r\n            }\r\n            var helperDefinitions = [];\r\n            if (!isUndefined(helperWindowTypes) && isArray(helperWindowTypes)) {\r\n                for (var index in helperWindowTypes) {\r\n                    var item = helperWindowTypes[index];\r\n                    if (isString(item)) {\r\n                        var definition = {\r\n                            type: item,\r\n                            name: \"\",\r\n                            isIndependent: false,\r\n                            arguments: {},\r\n                            relativeTo: \"\",\r\n                            relativeDirection: \"\",\r\n                            windowStyleAttributes: {}\r\n                        };\r\n                        helperDefinitions.push(definition);\r\n                    }\r\n                    else {\r\n                        helperDefinitions.push(item);\r\n                    }\r\n                }\r\n            }\r\n            _this._bridge\r\n                .registerActivityType(activityTypeName, ownerDefinition, helperDefinitions, config, description)\r\n                .then(function (activityType) {\r\n                _this._grabEntity(activityType);\r\n                resolve(activityType);\r\n            })\r\n                .catch(function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterActivityType = function (type, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(type);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + type + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge.unregisterActivityType(type).then(function () { return resolve(actType); }, reject);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.initiate = function (activityType, context, callback, configuration) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(activityType);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + activityType + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .initiateActivity(activityType, context, configuration)\r\n                .then(function (actId) {\r\n                _this._activities\r\n                    .getOrWait(actId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityTypeEvents = function (handler) {\r\n        this._activityTypes.subscribe(function (at, context) {\r\n            handler(at, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowTypes = function () {\r\n        return this._windowTypes.get();\r\n    };\r\n    ActivityManager.prototype.getWindowType = function (name) {\r\n        return this._windowTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerWindowFactory = function (windowType, factoryMethod, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (isObject(windowType)) {\r\n                windowType = windowType.getName();\r\n            }\r\n            else if (!isString(windowType)) {\r\n                reject(\"windowType should be string or object that has getName method\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .registerWindowFactory(windowType, factoryMethod)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterWindowFactory = function (windowType, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (!isString(windowType)) {\r\n                reject(\"windowType should be a string\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .unregisterWindowFactory(windowType)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getActivities = function (activityType) {\r\n        var act = this._activities.get();\r\n        act = act.filter(function (a) { return a._ownerId; });\r\n        if (!activityType) {\r\n            return act;\r\n        }\r\n        var types = activityType;\r\n        if (isString(activityType)) {\r\n            types = [activityType];\r\n        }\r\n        else if (activityType instanceof ActivityType) {\r\n            types = [activityType.name];\r\n        }\r\n        else if (activityType instanceof Array) ;\r\n        else {\r\n            throw new Error(\"Invalid input argument 'activityType' = \" + activityType);\r\n        }\r\n        return act.filter(function (at) {\r\n            var type = at.type;\r\n            return some(types, function (t) {\r\n                return type.id === t.id;\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype.getActivityById = function (id) {\r\n        return this._activities.getByName(id);\r\n    };\r\n    ActivityManager.prototype.announceWindow = function (activityWindowId, windowType) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var announcementInfo = _this._bridge.getAnnouncementInfo();\r\n            if (isUndefined(activityWindowId)) {\r\n                activityWindowId = announcementInfo.activityWindowId;\r\n            }\r\n            if (isUndefined(windowType)) {\r\n                windowType = announcementInfo.activityWindowType;\r\n            }\r\n            if (isUndefinedOrNull(windowType)) {\r\n                throw new Error(\"Can not announce - unknown windowType\");\r\n            }\r\n            var activityId = announcementInfo && announcementInfo.activityId;\r\n            if (isUndefinedOrNull(activityWindowId)) {\r\n                _this._logger.debug(\"Registering window with type:'\" + windowType + \"', name:'\" + announcementInfo.activityWindowName + \"', ind.:'\" + announcementInfo.activityWindowIndependent + \"'\");\r\n                _this._bridge.registerWindow(windowType, announcementInfo.activityWindowName, announcementInfo.activityWindowIndependent)\r\n                    .then(_this._windows.getOrWait.bind(_this._windows))\r\n                    .then(function (w) {\r\n                    if (activityId) {\r\n                        return _this._activities.getOrWait(activityId).then(function (_) { return w; });\r\n                    }\r\n                    else {\r\n                        return w;\r\n                    }\r\n                })\r\n                    .then(function (w) {\r\n                    resolve(w);\r\n                })\r\n                    .catch(function (err) {\r\n                    _this._logger.error(err);\r\n                });\r\n            }\r\n            else {\r\n                _this._logger.debug(\"Announcing window with id '\" + activityWindowId + \"' and type '\" + windowType + \"'\");\r\n                var currentWindow = _this._windows.getByName(activityWindowId);\r\n                if (!isUndefinedOrNull(currentWindow)) {\r\n                    _this._logger.debug(\"Window with id '\" + activityWindowId + \"' already announced - reusing the window\");\r\n                    resolve(currentWindow);\r\n                    return;\r\n                }\r\n                var windowEventHandler_1 = function (a, w, e) {\r\n                    if (activityWindowId === w.id) {\r\n                        if (e === EntityEventType.ActivityWindowJoinedActivity) {\r\n                            var activity = w.activity;\r\n                            if (isUndefined(activity)) {\r\n                                reject(\"UNDEFINED ACTIVITY\");\r\n                            }\r\n                            _this._logger.trace(\"Got joined event for id '\" + activityWindowId + \"'\");\r\n                            resolve(w);\r\n                            _this.unsubscribeWindowEvents(windowEventHandler_1);\r\n                        }\r\n                    }\r\n                };\r\n                _this.subscribeWindowEvents(windowEventHandler_1);\r\n                _this._logger.trace(\"Waiting for joined event for id '\" + activityWindowId + \"'\");\r\n                _this._bridge.announceWindow(windowType, activityWindowId);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    ActivityManager.prototype.subscribeWindowTypeEvents = function (handler) {\r\n        this._windowTypes.subscribe(function (wt, context) {\r\n            handler(wt, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeActivityEvents = function (handler) {\r\n        var _this = this;\r\n        return this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.StatusChange) {\r\n                var p = context;\r\n                handler(act, p.newStatus, p.oldStatus);\r\n            }\r\n            if (context.type === EntityEventType.Removed ||\r\n                (context.type === EntityEventType.StatusChange &&\r\n                    context.newStatus.getState() === ActivityState.Destroyed)) {\r\n                for (var _i = 0, _a = _this._windows.get(); _i < _a.length; _i++) {\r\n                    var window_1 = _a[_i];\r\n                    if (window_1.activity && window_1.activity.id === act.id) {\r\n                        _this._windows.process(new EntityEvent(window_1, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)));\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeWindowEvents = function (handler) {\r\n        var wrappingHandler = function (window, context) {\r\n            var eventType = context.type;\r\n            if (eventType === EntityEventType.Added) {\r\n                eventType = \"opened\";\r\n            }\r\n            handler(window.activity, window, eventType);\r\n        };\r\n        this._windowHandlers.push([handler, wrappingHandler]);\r\n        return this._windows.subscribe(wrappingHandler);\r\n    };\r\n    ActivityManager.prototype.unsubscribeWindowEvents = function (handler) {\r\n        var found = this._windowHandlers.find(function (pair) { return pair[0] === handler; });\r\n        if (found) {\r\n            this._windowHandlers.splice(this._windowHandlers.indexOf(found), 1);\r\n            this._windows.unsubscribe(found[1]);\r\n        }\r\n    };\r\n    ActivityManager.prototype.createWindow = function (activity, windowTypeOrConfiguration, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowTypeOrConfiguration)) {\r\n                reject(\"windowType is undefined\");\r\n            }\r\n            var windowDefinition;\r\n            if (isString(windowTypeOrConfiguration)) {\r\n                windowDefinition = { type: windowTypeOrConfiguration, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else if (windowTypeOrConfiguration instanceof WindowType) {\r\n                windowDefinition = {\r\n                    type: windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    name: windowTypeOrConfiguration.name || windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    isIndependent: false\r\n                };\r\n            }\r\n            else {\r\n                var invalidKeys_1 = [\"url\"];\r\n                var filteredWindowTypeOrConfiguration_1 = {};\r\n                Object.keys(windowTypeOrConfiguration).forEach(function (key) {\r\n                    if (invalidKeys_1.indexOf(key) === -1) {\r\n                        filteredWindowTypeOrConfiguration_1[key] = windowTypeOrConfiguration[key];\r\n                    }\r\n                });\r\n                windowDefinition = filteredWindowTypeOrConfiguration_1;\r\n            }\r\n            var relativeToWindow;\r\n            if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                relativeToWindow = windowDefinition.relativeTo;\r\n                if (typeof relativeToWindow === \"string\") {\r\n                    var windows = _this.getWindows({ type: relativeToWindow });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                    var windows = _this.getWindows({ type: relativeToWindow.type });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                    windowDefinition.relativeTo = relativeToWindow.windowId;\r\n                }\r\n            }\r\n            _this._bridge.createWindow(activity && activity.id, windowDefinition)\r\n                .then(function (wid) {\r\n                _this._logger.debug(\"Window created, waiting for window entity with id \" + wid);\r\n                var handler = function (window, context) {\r\n                    if (window.id === wid && (!activity || window.activity)) {\r\n                        _this._logger.debug(\"Got entity window with id \" + wid);\r\n                        resolve(window);\r\n                        _this._windows.unsubscribe(handler);\r\n                    }\r\n                };\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.createStackedWindows = function (activity, relativeWindowTypes, timeout, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity is undefined\");\r\n            }\r\n            if (isUndefinedOrNull(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes is undefined\");\r\n            }\r\n            if (!Array.isArray(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes has to be an array\");\r\n            }\r\n            if (isUndefinedOrNull(timeout)) {\r\n                timeout = 20000;\r\n            }\r\n            var windowDefinitions = [];\r\n            relativeWindowTypes.forEach(function (element) {\r\n                var windowDefinition;\r\n                if (isString(element)) {\r\n                    windowDefinition = { type: element, name: \"\", isIndependent: false, arguments: {} };\r\n                }\r\n                else {\r\n                    windowDefinition = element;\r\n                }\r\n                windowDefinition.stackedWindow = true;\r\n                windowDefinition.timeout = timeout;\r\n                var relativeToWindow;\r\n                if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                    relativeToWindow = windowDefinition.relativeTo;\r\n                    if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                        windowDefinition.relativeTo = relativeToWindow.type;\r\n                    }\r\n                    else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                        var windows = _this.getWindows({ id: relativeToWindow.windowId });\r\n                        if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                            windowDefinition.relativeTo = windows[0].type.name;\r\n                        }\r\n                    }\r\n                }\r\n                windowDefinitions.push(windowDefinition);\r\n            });\r\n            var tasks = [];\r\n            windowDefinitions.forEach(function (wd) { return tasks.push(_this.createWindow(activity, wd)); });\r\n            Promise.all(tasks).then(resolve).catch(reject);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.addWindowToActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.joinActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.leaveWindowFromActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.leaveActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.setActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, true)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.updateActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            var removedKeys = [];\r\n            for (var key in context) {\r\n                if (context.hasOwnProperty(key) && context[key] === null) {\r\n                    removedKeys.push(key);\r\n                }\r\n            }\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var removedKey = removedKeys_1[_i];\r\n                delete context[removedKey];\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, false, removedKeys)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityContextChanged = function (handler) {\r\n        this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.ActivityContextChange) {\r\n                var updateContext = context;\r\n                handler(act, updateContext.context, updateContext.updated, updateContext.removed);\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.stopActivity = function (activity, callback) {\r\n        var promise = this._bridge.stopActivity(activity);\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getWindows = function (filter) {\r\n        if (isUndefined(filter)) {\r\n            return this._windows.get();\r\n        }\r\n        if (!isUndefined(filter.id)) {\r\n            return [this._windows.getByName(filter.id)];\r\n        }\r\n        var allWindows = this._windows.get();\r\n        return allWindows.filter(function (w) {\r\n            if (!isUndefined(filter.type) && w.type.id !== filter.type) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.name) && w.name !== filter.name) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.activityId)) {\r\n                if (isUndefinedOrNull(w.activity)) {\r\n                    return false;\r\n                }\r\n                if (w.activity.id !== filter.activityId) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowBounds = function (id) {\r\n        return this._bridge.getWindowBounds(id);\r\n    };\r\n    ActivityManager.prototype.setWindowBounds = function (id, bounds, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._bridge.setWindowBounds(id, bounds)\r\n                .then(function () { return resolve(); })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.closeWindow = function (id) {\r\n        return this._bridge.closeWindow(id);\r\n    };\r\n    ActivityManager.prototype.activateWindow = function (id, focus) {\r\n        return this._bridge.activateWindow(id, focus);\r\n    };\r\n    ActivityManager.prototype.setWindowVisibility = function (id, visible) {\r\n        return this._bridge.setWindowVisibility(id, visible);\r\n    };\r\n    ActivityManager.prototype.clone = function (activity, cloneOptions, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!activity) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge.cloneActivity(activity.id, cloneOptions)\r\n                .then(function (activityId) {\r\n                _this._activities\r\n                    .getOrWait(activityId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.attachActivities = function (from, to, tag, callback) {\r\n        var _this = this;\r\n        tag = tag || {};\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var fromActivity = _this._activities.getByName(from);\r\n            if (!fromActivity) {\r\n                reject(\"can not find activity with id \" + from);\r\n                return;\r\n            }\r\n            var toActivity = _this._activities.getByName(to);\r\n            if (!toActivity) {\r\n                reject(\"can not find activity with id \" + to);\r\n                return;\r\n            }\r\n            return _this._bridge.attachActivities(from, to, tag)\r\n                .then(function (data) {\r\n                var newActId = data.to;\r\n                var state = data.descriptor;\r\n                var allStates = data.descriptors;\r\n                _this._activities.getOrWait(newActId).then(function (act) {\r\n                    act._updateDescriptors(allStates);\r\n                    var stateWrapped = act.attached.filter(function (u) { return u.ownerId === state.ownerId; })[0];\r\n                    resolve(stateWrapped);\r\n                });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.detachActivities = function (activityId, descriptor, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            return _this._bridge.detachActivities(activityId, descriptor)\r\n                .then(function () {\r\n                var oldActId = undefined;\r\n                var newActId = undefined;\r\n                var descriptors = undefined;\r\n                _this._activities\r\n                    .getOrWait(oldActId)\r\n                    .then(function (oldAct) {\r\n                    oldAct._updateDescriptors(descriptors);\r\n                    _this._activities\r\n                        .getOrWait(newActId)\r\n                        .then(function (newAct) {\r\n                        resolve(newAct);\r\n                    });\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesAttached = function (callback) {\r\n        this._attachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesDetached = function (callback) {\r\n        this._detachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityFrameColorChanged = function (callback) {\r\n        this._frameColorChangesCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype._grabEntity = function (entity) {\r\n        entity._manager = this;\r\n    };\r\n    ActivityManager.prototype._getInitialData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Request initial data...\");\r\n        this._bridge.getActivityTypes()\r\n            .then(function (at) {\r\n            _this._activityTypes.add(at);\r\n            _this._dataReadyMarker.signal(\"Got act types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity types -\" + error);\r\n        });\r\n        this._bridge.getWindowTypes()\r\n            .then(function (wt) {\r\n            _this._windowTypes.add(wt);\r\n            _this._dataReadyMarker.signal(\"Got window types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting window types  \" + error);\r\n        });\r\n        this._bridge.getActivities()\r\n            .then(function (ac) {\r\n            _this._activities.add(ac);\r\n            _this._dataReadyMarker.signal(\"Got activities\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity instances -\" + error);\r\n        });\r\n        this._bridge.getActivityWindows()\r\n            .then(function (aw) {\r\n            _this._windows.add(aw);\r\n            _this._dataReadyMarker.signal(\"Got windows\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity windows -\" + error);\r\n        });\r\n    };\r\n    ActivityManager.prototype._subscribeForData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Subscribe for data...\");\r\n        this._bridge.onActivityTypeStatusChange(function (event) {\r\n            _this._activityTypes.process(event);\r\n        });\r\n        this._bridge.onWindowTypeStatusChange(function (event) {\r\n            _this._windowTypes.process(event);\r\n        });\r\n        this._bridge.onActivityWindowChange(function (event) {\r\n            _this._windows.process(event);\r\n        });\r\n        this._bridge.onActivityStatusChange(function (event) {\r\n            _this._activities.process(event);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesAttached = function (data) {\r\n        var _this = this;\r\n        var newActId = data.to;\r\n        var descriptor = data.descriptor;\r\n        var descriptors = data.descriptors;\r\n        this._activities.getOrWait(newActId).then(function (act) {\r\n            act._updateDescriptors(descriptors);\r\n            var descriptorAsObjectFromAPI = act.attached.filter(function (u) { return u.ownerId === descriptor.ownerId; })[0];\r\n            _this._attachedCallbacks.forEach(function (callback) {\r\n                try {\r\n                    callback(act, descriptorAsObjectFromAPI);\r\n                }\r\n                catch (err) {\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesDetached = function (data) {\r\n        var _this = this;\r\n        var oldActId = data.oldActivityId;\r\n        var newActId = data.newActivityId;\r\n        var descriptors = data.descriptors;\r\n        var descriptor = data.descriptor;\r\n        this._activities.getOrWait(oldActId).then(function (oldAct) {\r\n            oldAct._updateDescriptors(descriptors);\r\n            _this._activities.getOrWait(newActId).then(function (newAct) {\r\n                _this._detachedCallbacks.forEach(function (callback) {\r\n                    try {\r\n                        callback(newAct, oldAct, descriptor);\r\n                    }\r\n                    catch (err) {\r\n                        return;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivityDescriptorsRefreshed = function (data) {\r\n        var id = data.id;\r\n        var descriptors = data.descriptors;\r\n        var act = this._activities.getByName(id);\r\n        if (act) {\r\n            act._updateDescriptors(descriptors);\r\n        }\r\n    };\r\n    ActivityManager.prototype.refreshDescriptors = function () {\r\n        var _this = this;\r\n        this._bridge.getAttachedDescriptors()\r\n            .then(function (map) {\r\n            if (map) {\r\n                Object.keys(map).forEach(function (key) {\r\n                    var actId = key;\r\n                    var descriptors = map[key];\r\n                    var act = _this._activities.getByName(actId);\r\n                    if (act) {\r\n                        act._updateDescriptors(descriptors);\r\n                    }\r\n                });\r\n            }\r\n            _this._descriptorsMarker.signal(\"Successfully got descriptors\");\r\n        })\r\n            .catch(function (err) {\r\n            _this._descriptorsMarker.error(\"failed to get descriptors - \" + err);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleWindowFrameColorChanged = function (win) {\r\n        if (!win.activityId) {\r\n            return;\r\n        }\r\n        var act = this._activities.getByName(win.activityId);\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id !== win.id) {\r\n            return;\r\n        }\r\n        this._frameColorChangesCallbacks.forEach(function (callback) {\r\n            try {\r\n                callback(act, win.frameColor);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    return ActivityManager;\r\n}());\n\nvar ActivityManagementAPI = (function () {\r\n    function ActivityManagementAPI(manager, my) {\r\n        this._m = manager;\r\n        this._my = my;\r\n        this.activityTypes = {\r\n            get: this._getActivityTypesWrapper.bind(this),\r\n            register: this._m.registerActivityType.bind(this._m),\r\n            unregister: this._m.unregisterActivityType.bind(this._m),\r\n            subscribe: this._m.subscribeActivityTypeEvents.bind(this._m),\r\n            unsubscribe: undefined,\r\n            initiate: this._m.initiate.bind(this._m)\r\n        };\r\n        this.windowTypes = {\r\n            get: this._getWindowTypesWrapper.bind(this),\r\n            registerFactory: this._m.registerWindowFactory.bind(this._m),\r\n            unregisterFactory: this._m.unregisterWindowFactory.bind(this._m),\r\n            subscribe: this._m.subscribeWindowTypeEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n        this.windows = {\r\n            get: this._m.getWindows.bind(this._m),\r\n            subscribe: this._m.subscribeWindowEvents.bind(this._m),\r\n            announce: this._m.announceWindow.bind(this._m),\r\n            unsubscribe: undefined,\r\n            create: this._m.createWindow.bind(this._m)\r\n        };\r\n        this.instances = {\r\n            get: this._m.getActivities.bind(this._m),\r\n            subscribe: this._m.subscribeActivityEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n    }\r\n    ActivityManagementAPI.prototype.onAttached = function (callback) {\r\n        this._m.subscribeActivitiesAttached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onDetached = function (callback) {\r\n        this._m.subscribeActivitiesDetached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onActivityFrameColorChanged = function (callback) {\r\n        this._m.subscribeActivityFrameColorChanged(callback);\r\n    };\r\n    ActivityManagementAPI.prototype._getActivityTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getActivityTypes();\r\n        }\r\n        return this._m.getActivityType(name);\r\n    };\r\n    ActivityManagementAPI.prototype._getWindowTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getWindowTypes();\r\n        }\r\n        return this._m.getWindowType(name);\r\n    };\r\n    return ActivityManagementAPI;\r\n}());\n\nvar ActivityAPI = (function () {\r\n    function ActivityAPI(manager, my) {\r\n        this._mgr = manager;\r\n        this._my = my;\r\n        this.all = new ActivityManagementAPI(manager, my);\r\n    }\r\n    ActivityAPI.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._mgr.ready()\r\n                .then(function () {\r\n                resolve(_this);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Object.defineProperty(ActivityAPI.prototype, \"my\", {\r\n        get: function () {\r\n            return this._my;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"aware\", {\r\n        get: function () {\r\n            return this._my.window !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"inActivity\", {\r\n        get: function () {\r\n            return this.aware && this._my.activity !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"agm\", {\r\n        get: function () {\r\n            if (!this.aware) {\r\n                return undefined;\r\n            }\r\n            if (!this.inActivity) {\r\n                return new ActivityAGM(null);\r\n            }\r\n            return this._my.activity.agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityAPI.prototype.getAvailableFrameColors = function () {\r\n        return [];\r\n    };\r\n    return ActivityAPI;\r\n}());\n\nvar ActivityModule = (function () {\r\n    function ActivityModule(config) {\r\n        var _this = this;\r\n        if (!config) {\r\n            throw new Error(\"config can not be null\");\r\n        }\r\n        if (!isUndefined(config.logLevel)) {\r\n            Logger$1.Level = config.logLevel;\r\n        }\r\n        if (!isUndefinedOrNull(config.logger)) {\r\n            Logger$1.GlueLogger = config.logger;\r\n        }\r\n        var bridge;\r\n        this._isUsingHCImplementation = config.gdMajorVersion === 2;\r\n        this._isUsingGW3Implementation = ActivityModule.checkIsUsingGW3Implementation(config.connection);\r\n        if (this._isUsingHCImplementation) {\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (this._isUsingGW3Implementation) {\r\n            bridge = new GW3Bridge$1(config);\r\n        }\r\n        else {\r\n            throw new Error(\"Unable to instantiate activity bridge implementation\");\r\n        }\r\n        if (!bridge) {\r\n            throw new Error(\"A bridge to native activity is needed to create activity lib.\");\r\n        }\r\n        ActivityAGM.AGM = config.agm;\r\n        var activityManager = new ActivityManager(bridge, !config.disableAutoAnnounce, config.windows);\r\n        var my = new ActivityMy(activityManager, config.windows);\r\n        this._api = new ActivityAPI(activityManager, my);\r\n        this._readyPromise = activityManager.ready().then(function (_) { return _this; });\r\n    }\r\n    ActivityModule.checkIsUsingGW3Implementation = function (connection) {\r\n        return connection.protocolVersion === 3;\r\n    };\r\n    Object.defineProperty(ActivityModule.prototype, \"api\", {\r\n        get: function () {\r\n            return this._api;\r\n        },\r\n        set: function (value) {\r\n            this._api = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingHCImplementation\", {\r\n        get: function () {\r\n            return this._isUsingHCImplementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingGW3Implementation\", {\r\n        get: function () {\r\n            return this._isUsingGW3Implementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityModule.prototype.ready = function (callback) {\r\n        return nodeify(this._readyPromise, callback);\r\n    };\r\n    return ActivityModule;\r\n}());\n\nvar ShutdownMethodName = \"T42.ACS.Shutdown\";\r\nvar RestartMethodName = \"T42.ACS.Restart\";\r\nvar GetConfigurationRegionMethodName = \"T42.ACS.GetConfigurationRegion\";\r\nvar SetConfigurationRegionMethodName = \"T42.ACS.SetConfigurationRegion\";\r\nvar GetUserMethodName = \"T42.ACS.GetUser\";\r\nvar GetBranchesMethodName = \"T42.ACS.GetBranches\";\r\nvar GetCurrentBranchMethodName = \"T42.ACS.GetCurrentBranch\";\r\nvar SetCurrentBranchMethodName = \"T42.ACS.SetCurrentBranch\";\r\nvar GetFunctionalEntitlementMethodName = \"T42.ACS.GetFunctionalEntitlement\";\r\nvar CanIMethodName = \"T42.ACS.CanI\";\r\nvar StartApplicationMethodName = \"T42.ACS.StartApplication\";\r\nvar StopApplicationMethodName = \"T42.ACS.StopApplication\";\r\nvar ActivateApplicationMethodName = \"T42.ACS.ActivateApplication\";\r\nvar OnEventMethodName = \"T42.ACS.OnEvent\";\r\nvar GetApplicationsMethodName = \"T42.ACS.GetApplications\";\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            if (allForKey.length === 0) {\r\n                delete callbacks[key];\r\n            }\r\n            else {\r\n                callbacks[key] = allForKey;\r\n            }\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nfunction objectValues(source) {\r\n    if (!source) {\r\n        return [];\r\n    }\r\n    return Object.keys(source).map(function (key) { return source[key]; });\r\n}\r\nfunction objectClone(obj) {\r\n    var result;\r\n    try {\r\n        result = JSON.parse(JSON.stringify(obj || {}));\r\n    }\r\n    catch (error) {\r\n        result = {};\r\n    }\r\n    return result;\r\n}\n\nvar ApplicationImpl = (function () {\r\n    function ApplicationImpl(_appManager, _name, _agm) {\r\n        var _this = this;\r\n        this._appManager = _appManager;\r\n        this._name = _name;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n        });\r\n        _appManager.onAppRemoved(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        });\r\n        _appManager.onAppChanged(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appChanged\", app);\r\n        });\r\n        _appManager.onAppAvailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appAvailable\", app);\r\n        });\r\n        _appManager.onAppUnavailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appUnavailable\", app);\r\n        });\r\n    }\r\n    Object.defineProperty(ApplicationImpl.prototype, \"name\", {\r\n        get: function () { return this._name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"title\", {\r\n        get: function () { return this._props.Title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"version\", {\r\n        get: function () { return this._props.Version; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"autoStart\", {\r\n        get: function () { return this._props.AutoStart; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isShell\", {\r\n        get: function () { return this._props.IsShell; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"caption\", {\r\n        get: function () { return this._props.Caption; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"hidden\", {\r\n        get: function () { return this._props.IsHidden; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"container\", {\r\n        get: function () { return this._props.ApplicationName; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityType\", {\r\n        get: function () { return this._props.ActivityType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityWindowType\", {\r\n        get: function () { return this._props.ActivityWindowType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"windowSettings\", {\r\n        get: function () {\r\n            if (!this._props.Arguments) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.Arguments);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"allowMultiple\", {\r\n        get: function () { return this._props.AllowMultiple; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"available\", {\r\n        get: function () { return this._props.IsReady || true; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"icon\", {\r\n        get: function () { return this._props.Icon; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"iconURL\", {\r\n        get: function () { return this._props.IconUrl; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"sortOrder\", {\r\n        get: function () { return this._props.SortOrder; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"userProperties\", {\r\n        get: function () {\r\n            if (!this._props.UserProperties) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.UserProperties);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isActivity\", {\r\n        get: function () {\r\n            return this._props.ActivityType !== undefined && this._props.ActivityType !== \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"configuration\", {\r\n        get: function () {\r\n            return {\r\n                autoStart: this._props.AutoStart,\r\n                caption: this._props.Caption,\r\n                hidden: this._props.IsHidden,\r\n                container: this._props.ApplicationName,\r\n                activityType: this._props.ActivityType,\r\n                allowMultiple: this._props.AllowMultiple\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this._name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"type\", {\r\n        get: function () {\r\n            return this._props.Type;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"mode\", {\r\n        get: function () {\r\n            if (!this._props) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Mode && typeof this._props.Mode === \"string\") {\r\n                return this._props.Mode.toLowerCase();\r\n            }\r\n            if (this.isActivity) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Arguments && this._props.Arguments.mode && typeof this._props.Arguments.mode === \"string\") {\r\n                return this._props.Arguments.mode.toLowerCase();\r\n            }\r\n            var styleAttributes = this._props.WindowStyleAttributes;\r\n            if (styleAttributes) {\r\n                styleAttributes = styleAttributes.split(\" \").join(\"\");\r\n                var searchFor = \"mode:\\\"\";\r\n                var modeIndex = styleAttributes.indexOf(searchFor);\r\n                if (modeIndex !== -1) {\r\n                    var startModeIndex = modeIndex + searchFor.length;\r\n                    var stopModeIndex = styleAttributes.indexOf(\"\\\"\", startModeIndex);\r\n                    var style = styleAttributes.substr(startModeIndex, stopModeIndex - startModeIndex);\r\n                    if (style && typeof style === \"string\") {\r\n                        return style.toLowerCase();\r\n                    }\r\n                }\r\n            }\r\n            return \"flat\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ApplicationImpl.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        if (!this._props) {\r\n            this._props = { Name: props.Name };\r\n        }\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.start = function (context, options) {\r\n        var _this = this;\r\n        var name = this._name;\r\n        var startTimeout = 10000;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            context = context || {};\r\n            var waitForAGMInstance = true;\r\n            var waitForApplicationInstance = function (id) {\r\n                var check = function () {\r\n                    var filtered = _this._appManager.instances().filter(function (i) { return i.id === id; });\r\n                    var result;\r\n                    if (filtered.length === 2) {\r\n                        result = filtered[0].isActivityInstance ? filtered[0] : filtered[1];\r\n                    }\r\n                    else {\r\n                        result = filtered[0];\r\n                    }\r\n                    if (result && waitForAGMInstance) {\r\n                        if (result.agm) {\r\n                            return result;\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n                var unsub;\r\n                var timeout = setTimeout(function () {\r\n                    if (unsub) {\r\n                        unsub();\r\n                    }\r\n                    reject(\"timeout\");\r\n                }, startTimeout);\r\n                var waitFunc = function (i) {\r\n                    if (i.id !== id) {\r\n                        return;\r\n                    }\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    setTimeout(function () {\r\n                        resolve(check());\r\n                    }, 1);\r\n                };\r\n                {\r\n                    unsub = _this._appManager.onInstanceAgmServerReady(waitFunc);\r\n                }\r\n                var instances = check();\r\n                if (instances) {\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    resolve(instances);\r\n                }\r\n            };\r\n            _this._agm.invoke(StartApplicationMethodName, {\r\n                Name: name,\r\n                Context: context,\r\n                Options: options\r\n            }, \"best\", {\r\n                methodResponseTimeoutMs: startTimeout\r\n            }, function (result) {\r\n                var acsResult = result.returned && result.returned.Instance_0\r\n                    ? result.returned.Instance_0\r\n                    : result.returned;\r\n                if (acsResult && acsResult.Id) {\r\n                    if (_this._appManager.mode === \"startOnly\") {\r\n                        var instance = _this._appManager.handleInstanceStarted(acsResult);\r\n                        resolve(instance);\r\n                    }\r\n                    else {\r\n                        waitForApplicationInstance(acsResult.Id);\r\n                    }\r\n                }\r\n                else {\r\n                    resolve(undefined);\r\n                }\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onAvailable = function (callback) {\r\n        this._registry.add(\"appAvailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onUnavailable = function (callback) {\r\n        this._registry.add(\"appUnavailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onChanged = function (callback) {\r\n        this._registry.add(\"appChanged\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onRemoved = function (callback) {\r\n        this._registry.add(\"appRemoved\", callback);\r\n    };\r\n    return ApplicationImpl;\r\n}());\n\nvar InstanceImpl = (function () {\r\n    function InstanceImpl(_id, _appName, _appManager, _agm, _activities, _windows, startFailed) {\r\n        var _this = this;\r\n        this._id = _id;\r\n        this._appName = _appName;\r\n        this._appManager = _appManager;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this.onAgmReady = this._addToRegistry(\"agmReady\");\r\n        this.onStopped = this._addToRegistry(\"stopped\");\r\n        this._registry = lib$2();\r\n        if (startFailed) {\r\n            return;\r\n        }\r\n        this._unsubscribeInstanceStopped = this._appManager.onInstanceStopped(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"stopped\", instance);\r\n        });\r\n        this._unsubscribeInstanceAgmServerReady = this._appManager.onInstanceAgmServerReady(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"agmReady\", instance);\r\n        });\r\n    }\r\n    Object.defineProperty(InstanceImpl.prototype, \"id\", {\r\n        get: function () { return this._id; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"application\", {\r\n        get: function () { return this._appManager.application(this._appName); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activity\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._activities) {\r\n                throw new Error(\"This method requires glue.activities library to be enabled.\");\r\n            }\r\n            return this._activities.all.instances.get()\r\n                .filter(function (activityInstance) { return activityInstance.id === _this._activityId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityOwner\", {\r\n        get: function () { return this._isActivityOwner; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityInstances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (i) {\r\n                return i.application.type !== \"activity\" &&\r\n                    i.activityId &&\r\n                    i.activityId === _this._activityId;\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityOwnerInstance\", {\r\n        get: function () {\r\n            if (!this._activityId) {\r\n                return undefined;\r\n            }\r\n            return this.activityInstances.filter(function (inst) { var _a; return (_a = inst) === null || _a === void 0 ? void 0 : _a.isActivityOwner; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"window\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._windows) {\r\n                throw new Error(\"This method requires glue.windows library to be enabled.\");\r\n            }\r\n            var win = this._windows.list().filter(function (w) { return w.id === _this._id; })[0];\r\n            if (!win && this.activity && this.activityOwnerInstance) {\r\n                win = this.activityOwnerInstance.window;\r\n            }\r\n            return win;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"context\", {\r\n        get: function () {\r\n            var _a, _b, _c;\r\n            return _c = (_a = this._startUpContext, (_a !== null && _a !== void 0 ? _a : (_b = this.window) === null || _b === void 0 ? void 0 : _b.context)), (_c !== null && _c !== void 0 ? _c : {});\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"title\", {\r\n        get: function () { return this._title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityInstance\", {\r\n        get: function () { return this._isActivityInstance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityId\", {\r\n        get: function () { return this._activityId; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"inActivity\", {\r\n        get: function () { return this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isSingleWindowApp\", {\r\n        get: function () { return !this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agmInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InstanceImpl.prototype.updateFromProps = function (props) {\r\n        this._startUpContext = props.Context;\r\n        this._title = props.Title;\r\n        this._isActivityInstance = false;\r\n        if (props.ActivityId && props.ActivityId !== \"\") {\r\n            this._activityId = props.ActivityId;\r\n            this._isActivityInstance = true;\r\n        }\r\n        this._isActivityOwner = props.IsActivityOwner;\r\n        if (!this._activityId && this._startUpContext && this._startUpContext.activityId) {\r\n            this._activityId = this._startUpContext.activityId;\r\n        }\r\n        this._inActivity = Boolean(this._activityId);\r\n        this.updateAgmInstanceFromProps(props);\r\n    };\r\n    InstanceImpl.prototype.updateAgmInstanceFromProps = function (props) {\r\n        if (!props.AgmServers) {\r\n            return;\r\n        }\r\n        if (props.GD3) {\r\n            var agmInstances = props.AgmServers;\r\n            if (agmInstances) {\r\n                this._agmInstance = agmInstances[0];\r\n            }\r\n        }\r\n        else {\r\n            var gdAgmServers = props.AgmServers;\r\n            var propsAgmServer = Object.keys(gdAgmServers)[0];\r\n            if (!propsAgmServer) {\r\n                return;\r\n            }\r\n            var propsAgm = gdAgmServers[propsAgmServer];\r\n            this._agmInstance = {\r\n                machine: propsAgm.machineName,\r\n                user: propsAgm.userName,\r\n                environment: propsAgm.environment,\r\n                application: propsAgm.applicationName,\r\n            };\r\n        }\r\n    };\r\n    InstanceImpl.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var unsubscribe = _this._appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this._id) {\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            _this._agm.invoke(StopApplicationMethodName, {\r\n                Name: _this._appName,\r\n                Id: _this._id\r\n            })\r\n                .then(function () {\r\n                if (_this._appManager.mode === \"startOnly\") {\r\n                    _this._appManager.handleInstanceStopped({\r\n                        Name: _this._appName,\r\n                        Id: _this.id,\r\n                        Context: undefined,\r\n                        Title: undefined,\r\n                        ActivityId: undefined,\r\n                        IsActivityOwner: undefined,\r\n                        AgmServers: undefined\r\n                    });\r\n                    resolve();\r\n                }\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    InstanceImpl.prototype.activate = function () {\r\n        return this._agm.invoke(ActivateApplicationMethodName, { Name: this._appName, Id: this._id });\r\n    };\r\n    InstanceImpl.prototype.done = function () {\r\n        this._registry.clear();\r\n        this._unsubscribeInstanceAgmServerReady();\r\n        this._unsubscribeInstanceStopped();\r\n    };\r\n    InstanceImpl.prototype.getContext = function () {\r\n        return Promise.resolve(this.context);\r\n    };\r\n    InstanceImpl.prototype._addToRegistry = function (key) {\r\n        var _this = this;\r\n        return function (callback) {\r\n            _this._registry.add(key, callback);\r\n        };\r\n    };\r\n    return InstanceImpl;\r\n}());\n\nvar AppManagerImpl = (function () {\r\n    function AppManagerImpl(mode, _agm, _activities, _windows, _logger, _gdMajorVersion) {\r\n        var _this = this;\r\n        this.mode = mode;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this._logger = _logger;\r\n        this._gdMajorVersion = _gdMajorVersion;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this._registry = lib$2();\r\n        this.application = function (name) {\r\n            return _this._apps[name];\r\n        };\r\n        this.applications = function () {\r\n            return Object.keys(_this._apps).map(function (k) { return _this._apps[k]; });\r\n        };\r\n        this.instances = function () {\r\n            return _this._instances;\r\n        };\r\n        this.getMyInstance = function () {\r\n            if (_this._gdMajorVersion >= 3) {\r\n                var instanceId_1 = window.glue42gd.appInstanceId;\r\n                return _this._instances.filter(function (i) { return i.id === instanceId_1; })[0];\r\n            }\r\n            return undefined;\r\n        };\r\n        this.handleAppAdded = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"adding app \" + id);\r\n            _this._apps[id] = new ApplicationImpl(_this, id, _this._agm);\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appAdded\", app);\r\n        };\r\n        this.handleAppUpdated = function (props) {\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appChanged\", app);\r\n        };\r\n        this.handleAppRemoved = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"removing app \" + id);\r\n            var app = _this.application(id);\r\n            _this._instances = _this._instances.filter(function (i) { return i.application.name !== app.name; });\r\n            delete _this._apps[id];\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        };\r\n        this.handleAppReady = function (props) {\r\n            var id = _this._getAppId(props);\r\n            var app = _this._getAppOrThrow(id);\r\n            app.updateFromProps(props);\r\n            if (app.available) {\r\n                _this._registry.execute(\"appAvailable\", app);\r\n            }\r\n            else {\r\n                _this._registry.execute(\"appUnavailable\", app);\r\n            }\r\n        };\r\n        this.handleInstanceStarted = function (props) {\r\n            _this._logger.trace(\"started app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = new InstanceImpl(id, appName, _this, _this._agm, _this._activities, _this._windows);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._instances.push(instance);\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n            return instance;\r\n        };\r\n        this.handleInstanceStopped = function (props) {\r\n            _this._logger.trace(\"failed to start app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            _this._instances = _this._instances.filter(function (i) { return !_this._matchInstance(i, id, appName); });\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n            instance.done();\r\n        };\r\n        this.handleInstanceAgmServerReady = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            instance.updateAgmInstanceFromProps(props);\r\n            _this._registry.execute(\"instanceAgmServerReady\", instance);\r\n        };\r\n        this.handleInstanceStartFailed = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var startFailed = true;\r\n            var instance = new InstanceImpl(id, appName, undefined, undefined, undefined, undefined, startFailed);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._registry.execute(\"instanceStartFailed\", instance);\r\n        };\r\n        this.handleInstanceUpdated = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, app);\r\n            _this._updateInstanceFromProps(instance, props);\r\n        };\r\n        this.onInstanceStarted = function (callback) {\r\n            return _this._registry.add(\"instanceStarted\", callback, _this._instances);\r\n        };\r\n        this.onInstanceStartFailed = function (callback) {\r\n            return _this._registry.add(\"instanceStartFailed\", callback);\r\n        };\r\n        this.onInstanceStopped = function (callback) {\r\n            return _this._registry.add(\"instanceStopped\", callback);\r\n        };\r\n        this.onInstanceUpdated = function (callback) {\r\n            return _this._registry.add(\"instanceChanged\", callback);\r\n        };\r\n        this.onInstanceAgmServerReady = function (callback) {\r\n            return _this._registry.add(\"instanceAgmServerReady\", callback);\r\n        };\r\n        this.onAppAdded = function (callback) {\r\n            return _this._registry.add(\"appAdded\", callback, Object.values(_this._apps));\r\n        };\r\n        this.onAppRemoved = function (callback) {\r\n            return _this._registry.add(\"appRemoved\", callback);\r\n        };\r\n        this.onAppAvailable = function (callback) {\r\n            return _this._registry.add(\"appAvailable\", callback);\r\n        };\r\n        this.onAppUnavailable = function (callback) {\r\n            return _this._registry.add(\"appUnavailable\", callback);\r\n        };\r\n        this.onAppChanged = function (callback) {\r\n            return _this._registry.add(\"appChanged\", callback);\r\n        };\r\n    }\r\n    AppManagerImpl.prototype._getAppOrThrow = function (id) {\r\n        var result = this.application(id);\r\n        if (!result) {\r\n            throw Error(\"app with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getAppId = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._matchInstance = function (instance, id, appName) {\r\n        return instance.id === id && instance.application.name === appName;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceByIdAndName = function (id, appName) {\r\n        var _this = this;\r\n        return this._instances.filter(function (i) { return _this._matchInstance(i, id, appName); })[0];\r\n    };\r\n    AppManagerImpl.prototype._getInstanceOrThrow = function (id, appName) {\r\n        var result = this._getInstanceByIdAndName(id, appName);\r\n        if (!result) {\r\n            throw Error(\"instance with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceId = function (props) {\r\n        return props.Id;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceAppName = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._updateAppFromProps = function (props) {\r\n        var id = this._getAppId(props);\r\n        this._logger.trace(\"updating app with  + \" + id + \", \" + props);\r\n        var app = this._getAppOrThrow(id);\r\n        app.updateFromProps(props);\r\n        return app;\r\n    };\r\n    AppManagerImpl.prototype._updateInstanceFromProps = function (instance, props) {\r\n        this._logger.trace(\"updating instance with \" + this._getInstanceId(props) + \" for app \" + this._getInstanceAppName(props));\r\n        instance.updateFromProps(props);\r\n    };\r\n    return AppManagerImpl;\r\n}());\n\nfunction promisify$2(promise, successCallback, errorCallback) {\r\n    var isFunction = function (arg) {\r\n        return !!(arg && arg.constructor && arg.call && arg.apply);\r\n    };\r\n    if (!isFunction(successCallback) && !isFunction(errorCallback)) {\r\n        return promise;\r\n    }\r\n    if (!isFunction(successCallback)) {\r\n        successCallback = function () {\r\n        };\r\n    }\r\n    else if (!isFunction(errorCallback)) {\r\n        errorCallback = function () {\r\n        };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nvar EntitlementsImpl = (function () {\r\n    function EntitlementsImpl(_agm) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        this.handleBranchModified = function (branch) {\r\n            _this._registry.execute(\"branchChanged\", branch);\r\n        };\r\n        this.handleBranchesModified = function (branches) {\r\n            _this._registry.execute(\"branchesChanged\", branches);\r\n        };\r\n        this.getRegion = function (success, error) {\r\n            return promisify$2(_this._agmInvoke(GetConfigurationRegionMethodName, function (e) { return e.returned.Region; }), success, error);\r\n        };\r\n        this.getBranches = function (success, error) {\r\n            var promise = _this._agmInvoke(GetBranchesMethodName, function (e) {\r\n                var obj = e.returned.Branches;\r\n                return Object.keys(obj).map(function (key) { return obj[key]; });\r\n            });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getCurrentBranch = function (success, error) {\r\n            var promise = _this._agmInvoke(GetCurrentBranchMethodName, function (e) { return e.returned.Branch; }, undefined);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setRegion = function (region, success, error) {\r\n            var promise = _this._agmInvoke(SetConfigurationRegionMethodName, function (e) { return e.returned.ResultMessage; }, { Region: region });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setCurrentBranch = function (branch, success, error) {\r\n            var promise = _this._agmInvoke(SetCurrentBranchMethodName, function (e) { return e.returned.ResultMessage; }, { Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.currentUser = function (success, error) {\r\n            var promise = _this._agmInvoke(GetUserMethodName);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlement = function (funct, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlementBranch = function (funct, branch, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canI = function (func, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canIBranch = function (func, branch, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.onBranchesChanged = function (callback) {\r\n            _this._registry.add(\"branchesChanged\", callback);\r\n        };\r\n        this.onBranchChanged = function (callback) {\r\n            _this._registry.add(\"branchChanged\", callback);\r\n        };\r\n        this.exit = function (options) {\r\n            return _this._agmInvoke(ShutdownMethodName, null, options);\r\n        };\r\n        this.restart = function (options) {\r\n            return _this._agmInvoke(RestartMethodName, null, options);\r\n        };\r\n        this._agmInvoke = function (method, transformFunction, args) {\r\n            args = args || {};\r\n            return new Promise(function (resolve, reject) {\r\n                var errHandler = function (error) { return reject(error); };\r\n                _this._agm.invoke(method, args)\r\n                    .then(function (result) {\r\n                    if (!transformFunction) {\r\n                        transformFunction = function (d) { return d.returned; };\r\n                    }\r\n                    resolve(transformFunction(result));\r\n                })\r\n                    .catch(errHandler);\r\n            });\r\n        };\r\n    }\r\n    return EntitlementsImpl;\r\n}());\n\nfunction snapshot(agm, appManager) {\r\n    return new Promise(function (resolve, reject) {\r\n        agm.invoke(GetApplicationsMethodName, { skipIcon: true })\r\n            .then(function (response) {\r\n            var data = response.returned;\r\n            if (!data) {\r\n                resolve();\r\n            }\r\n            var applications = data.applications;\r\n            if (!applications) {\r\n                resolve();\r\n            }\r\n            objectValues(applications).map(function (item) { return appManager.handleAppAdded(item); });\r\n            resolve();\r\n        })\r\n            .catch(function (err) { return reject(\"Error getting application snapshot: \" + err.message); });\r\n    });\r\n}\n\nvar OnBranchChangedEvent = \"OnBranchChanged\";\r\nvar OnBranchesModifiedEvent = \"OnBranchesModified\";\r\nvar OnApplicationAddedEvent = \"OnApplicationAdded\";\r\nvar OnApplicationRemovedEvent = \"OnApplicationRemoved\";\r\nvar OnApplicationChangedEvent = \"OnApplicationChanged\";\r\nvar OnApplicationReadyEvent = \"OnApplicationReady\";\r\nvar OnApplicationStartedEvent = \"OnApplicationStarted\";\r\nvar OnApplicationAgmServerReadyEvent = \"OnApplicationAgmServerReady\";\r\nvar OnApplicationUpdatedEvent = \"OnApplicationUpdated\";\r\nvar OnApplicationStoppedEvent = \"OnApplicationStopped\";\r\nvar OnApplicationStartFailedEvent = \"OnApplicationStartFailed\";\n\nfunction createDataSubscription(agm, applications, entitlements, skipIcons) {\r\n    var subscription;\r\n    var start = function () {\r\n        var resolveFunc;\r\n        var rejectFunc;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            resolveFunc = resolve;\r\n            rejectFunc = reject;\r\n        });\r\n        agm.subscribe(OnEventMethodName, { arguments: { skipIcon: skipIcons }, waitTimeoutMs: 10000 })\r\n            .then(function (s) {\r\n            subscription = s;\r\n            subscription.onData(function (streamData) {\r\n                var events = streamData.data;\r\n                objectValues(events[OnApplicationAddedEvent])\r\n                    .map(function (item) { return applications.handleAppAdded(item); });\r\n                objectValues(events[OnApplicationChangedEvent])\r\n                    .map(function (item) { return applications.handleAppUpdated(item); });\r\n                objectValues(events[OnApplicationRemovedEvent])\r\n                    .map(function (item) { return applications.handleAppRemoved(item); });\r\n                objectValues(events[OnApplicationReadyEvent])\r\n                    .map(function (item) { return applications.handleAppReady(item); });\r\n                objectValues(events[OnApplicationStartedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStarted(item); });\r\n                objectValues(events[OnApplicationStartFailedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStartFailed(item); });\r\n                objectValues(events[OnApplicationStoppedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStopped(item); });\r\n                objectValues(events[OnApplicationUpdatedEvent])\r\n                    .map(function (item) { return applications.handleInstanceUpdated(item); });\r\n                objectValues(events[OnApplicationAgmServerReadyEvent])\r\n                    .map(function (item) { return applications.handleInstanceAgmServerReady(item); });\r\n                objectValues(events[OnBranchChangedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchModified(item); });\r\n                objectValues(events[OnBranchesModifiedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchesModified(item); });\r\n                resolveFunc();\r\n            });\r\n            subscription.onFailed(function (err) { return rejectFunc(err); });\r\n        })\r\n            .catch(function (err) { return rejectFunc(\"Error subscribing for \" + OnEventMethodName + \" stream. Err: \" + err); });\r\n        return resultPromise;\r\n    };\r\n    var stop = function () {\r\n        if (subscription) {\r\n            subscription.close();\r\n        }\r\n    };\r\n    return {\r\n        start: start,\r\n        stop: stop\r\n    };\r\n}\n\nvar AppManagerFactory = (function (config) {\r\n    if (!config) {\r\n        throw Error(\"config not set\");\r\n    }\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is missing\");\r\n    }\r\n    var START_ONLY = \"startOnly\";\r\n    var SKIP_ICONS = \"skipIcons\";\r\n    var FULL = \"full\";\r\n    var mode = config.mode || START_ONLY;\r\n    if (mode !== START_ONLY && mode !== SKIP_ICONS && mode !== FULL) {\r\n        throw new Error(\"Invalid mode for appManager lib - \" + mode + \" is not supported\");\r\n    }\r\n    var activities = config.activities;\r\n    var agm = config.agm;\r\n    var logger = config.logger;\r\n    var windows = config.windows;\r\n    var appManager = new AppManagerImpl(mode, agm, activities, windows, logger.subLogger(\"applications\"), config.gdMajorVersion);\r\n    var entitlements = new EntitlementsImpl(agm);\r\n    var readyPromise;\r\n    if (mode === START_ONLY) {\r\n        readyPromise = snapshot(agm, appManager);\r\n    }\r\n    else {\r\n        var subscription = createDataSubscription(agm, appManager, entitlements, mode === SKIP_ICONS);\r\n        readyPromise = subscription.start();\r\n    }\r\n    var api = {\r\n        ready: function () { return readyPromise; },\r\n        applications: appManager.applications,\r\n        application: appManager.application,\r\n        onAppAdded: appManager.onAppAdded,\r\n        onAppRemoved: appManager.onAppRemoved,\r\n        onAppChanged: appManager.onAppChanged,\r\n        onAppAvailable: appManager.onAppAvailable,\r\n        onAppUnavailable: appManager.onAppUnavailable,\r\n        instances: appManager.instances,\r\n        get myInstance() {\r\n            return appManager.getMyInstance();\r\n        },\r\n        onInstanceStarted: appManager.onInstanceStarted,\r\n        onInstanceStopped: appManager.onInstanceStopped,\r\n        onInstanceUpdated: appManager.onInstanceUpdated,\r\n        onInstanceStartFailed: appManager.onInstanceStartFailed,\r\n        getRegion: entitlements.getRegion,\r\n        getBranches: entitlements.getBranches,\r\n        getCurrentBranch: entitlements.getCurrentBranch,\r\n        getFunctionalEntitlement: entitlements.getFunctionalEntitlement,\r\n        getFunctionalEntitlementBranch: entitlements.getFunctionalEntitlementBranch,\r\n        setCurrentBranch: entitlements.setCurrentBranch,\r\n        setRegion: entitlements.setRegion,\r\n        currentUser: entitlements.currentUser,\r\n        canI: entitlements.canI,\r\n        canIBranch: entitlements.canIBranch,\r\n        onBranchesChanged: entitlements.onBranchesChanged,\r\n        exit: entitlements.exit,\r\n        restart: entitlements.restart\r\n    };\r\n    return api;\r\n});\n\nvar WindowStore = (function () {\r\n    function WindowStore() {\r\n        this.waitForTimeoutInMilliseconds = 60000;\r\n        this._windows = {};\r\n        this._pendingWindows = {};\r\n        this._pendingWindowsStates = {};\r\n        this._registry = lib$2();\r\n    }\r\n    WindowStore.prototype.init = function (logger) {\r\n        this._logger = logger;\r\n    };\r\n    WindowStore.prototype.get = function (id) {\r\n        return this._windows[id] || this._pendingWindows[id];\r\n    };\r\n    WindowStore.prototype.getIfReady = function (id) {\r\n        return this._windows[id];\r\n    };\r\n    Object.defineProperty(WindowStore.prototype, \"list\", {\r\n        get: function () {\r\n            return this._windows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowStore.prototype.add = function (window) {\r\n        var isExist = this._pendingWindows[window.API.id] ? true : false;\r\n        if (isExist) {\r\n            this._logger.error(\"trying to add window with id \" + window.API.id + \" from windowStore, which already exists\");\r\n            return;\r\n        }\r\n        var remote = window.API.windowType === \"remote\";\r\n        this._pendingWindows[window.API.id] = window;\r\n        this._pendingWindowsStates[window.API.id] = {\r\n            ready: false,\r\n            urlChanged: remote,\r\n        };\r\n        this._registry.execute(\"on-added\", window);\r\n    };\r\n    WindowStore.prototype.remove = function (window) {\r\n        delete this._windows[window.API.id];\r\n        delete this._pendingWindows[window.API.id];\r\n        delete this._pendingWindowsStates[window.API.id];\r\n        this._registry.execute(\"on-removed\", window);\r\n    };\r\n    WindowStore.prototype.setReadyState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.ready = true;\r\n        if (targetWindowState.urlChanged) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.setUrlChangedState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.urlChanged = true;\r\n        if (targetWindowState.ready) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.waitFor = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var un;\r\n            var timeout = setTimeout(function () {\r\n                un();\r\n                reject(\"waitFor timed out.\");\r\n            }, _this.waitForTimeoutInMilliseconds);\r\n            var win = _this._windows[id];\r\n            if (win) {\r\n                clearTimeout(timeout);\r\n                resolve(win);\r\n            }\r\n            else {\r\n                un = _this.onReadyWindow(function (w) {\r\n                    if (w.API.id !== id) {\r\n                        return;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    un();\r\n                    resolve(w);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    WindowStore.prototype.onReadyWindow = function (callback) {\r\n        return this._registry.add(\"on-ready\", callback);\r\n    };\r\n    WindowStore.prototype.onAdded = function (callback) {\r\n        return this._registry.add(\"on-added\", callback);\r\n    };\r\n    WindowStore.prototype.onRemoved = function (callback) {\r\n        return this._registry.add(\"on-removed\", callback);\r\n    };\r\n    WindowStore.prototype.markReadyToShow = function (windowId) {\r\n        if (this._pendingWindows[windowId]) {\r\n            this._windows[windowId] = this._pendingWindows[windowId];\r\n            delete this._pendingWindows[windowId];\r\n            delete this._pendingWindowsStates[windowId];\r\n        }\r\n        this._registry.execute(\"on-ready\", this._windows[windowId]);\r\n    };\r\n    return WindowStore;\r\n}());\r\nvar windowStore = new WindowStore();\n\nvar Utils$1 = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.callbackifyPromise = function (action, successCallback, errorCallback) {\r\n        var fail = function (error) {\r\n            var msg = error;\r\n            if (error instanceof Error) {\r\n                msg = error.message;\r\n            }\r\n            if (typeof errorCallback === \"function\") {\r\n                errorCallback(msg);\r\n                return;\r\n            }\r\n            return Promise.reject(msg);\r\n        };\r\n        try {\r\n            return action()\r\n                .then(function (result) {\r\n                if (typeof successCallback === \"function\") {\r\n                    successCallback(result);\r\n                }\r\n                return result;\r\n            })\r\n                .catch(function (error) {\r\n                return fail(error);\r\n            });\r\n        }\r\n        catch (err) {\r\n            return fail(err);\r\n        }\r\n    };\r\n    Utils.getMonitor = function (bounds, displays) {\r\n        var _this = this;\r\n        var monitorsSortedByOverlap = displays.map(function (m) {\r\n            var left = m.left, top = m.top, width = m.workingAreaWidth, height = m.workingAreaHeight;\r\n            var overlap = _this.calculateTotalOverlap({ left: left, top: top, width: width, height: height }, bounds);\r\n            return {\r\n                monitor: m,\r\n                totalOverlap: overlap\r\n            };\r\n        }).sort(function (a, b) { return b.totalOverlap - a.totalOverlap; });\r\n        return monitorsSortedByOverlap[0].monitor;\r\n    };\r\n    Utils.getDisplayCenterOfScreen = function (a, display) {\r\n        var left = Math.floor(Math.max(display.left, (display.left + (display.workingAreaWidth - a.width) / 2)));\r\n        var top = Math.floor(Math.max(display.top, (display.top + (display.workingAreaHeight - a.height) / 2)));\r\n        return {\r\n            top: top,\r\n            left: left\r\n        };\r\n    };\r\n    Utils.calculateTotalOverlap = function (r1, r2) {\r\n        var r1x = r1.left;\r\n        var r1y = r1.top;\r\n        var r1xMax = r1x + r1.width;\r\n        var r1yMax = r1y + r1.height;\r\n        var r2x = r2.left;\r\n        var r2y = r2.top;\r\n        var r2xMax = r2x + r2.width;\r\n        var r2yMax = r2y + r2.height;\r\n        var xOverlap = Math.max(0, Math.min(r1xMax, r2xMax) - Math.max(r1x, r2x));\r\n        var yOverlap = Math.max(0, Math.min(r1yMax, r2yMax) - Math.max(r1y, r2y));\r\n        return xOverlap * yOverlap;\r\n    };\r\n    return Utils;\r\n}());\n\nvar windowFactory = (function (id, options, executor, logger, appManagerGetter, agm, registry) {\r\n    var _a;\r\n    var _registry = (registry !== null && registry !== void 0 ? registry : lib$2());\r\n    var _logger = logger.subLogger(\"window \" + id);\r\n    var _name = options.name;\r\n    var _mode = options.mode;\r\n    var _url = options.url;\r\n    var _title = options.title;\r\n    var _context = options.context || {};\r\n    var _bounds = options.bounds;\r\n    var _frameColor = options.frameColor;\r\n    var _focus = options.focus;\r\n    var _neighbours = options.neighbours || {};\r\n    var _groupId = options.groupId;\r\n    var _isGroupHeaderVisible = options.isGroupHeaderVisible;\r\n    var _isTabHeaderVisible = options.isTabHeaderVisible;\r\n    var _isTabSelected = options.isTabSelected;\r\n    var _settings = options.settings;\r\n    var _isVisible = options.isVisible;\r\n    var _isSticky = (_a = options.settings) === null || _a === void 0 ? void 0 : _a.isSticky;\r\n    var isCollapsed = options.isCollapsed;\r\n    var _windowState = options.state;\r\n    var _tabGroupId = options.tabGroupId;\r\n    var _isLocked = options.isLocked;\r\n    var _group;\r\n    var resultWindow;\r\n    var _frameButtons = [];\r\n    var _zoomFactor = options.zoomFactor;\r\n    function close(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.close(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function navigate(newUrl, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.navigate(resultWindow, newUrl)\r\n                .then(function () {\r\n                if (newUrl === _url) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onUrlChanged(function (url, win) {\r\n                    if (win.id === id && url === win.url) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setStyle(style, success, error) {\r\n        if (!style || Object.keys(style).length === 0 || Object.keys(style).every(function (key) { return !key; })) {\r\n            var errMessage = \"Invalid style arguments: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        if (style && style.focus !== undefined) {\r\n            if (typeof style.focus !== \"boolean\") {\r\n                var errMessage = \"Focus must be boolean. Currently only focus true is supported ! \" + JSON.stringify(style);\r\n                error(errMessage);\r\n                return Promise.reject(new Error(errMessage));\r\n            }\r\n            else if (style.focus === false) {\r\n                _logger.warn(\"Focus false is not supported ! \");\r\n            }\r\n        }\r\n        if (style && style.hidden !== undefined && typeof style.hidden !== \"boolean\") {\r\n            var errMessage = \"Hidden must be boolean ! provided: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setStyle(resultWindow, style); }, success, error);\r\n    }\r\n    function resetButtons(buttons, success, error) {\r\n        return Utils$1.callbackifyPromise(function () { return executor.resetButtons(resultWindow, buttons); }, success, error);\r\n    }\r\n    function setOnTop(onTop, success, error) {\r\n        if (this.onTop === onTop) {\r\n            var errMessage = \"OnTop setting is already set to '\" + onTop + \"'\";\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setOnTop(resultWindow, onTop); }, success, error);\r\n    }\r\n    function setSizeConstraints(constraints, success, error) {\r\n        if (!constraints || Object.keys(constraints).every(function (value) { return value === undefined; })) {\r\n            var errMessage = \"Invalid Constraints: \" + JSON.stringify(constraints);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setSizeConstraints(resultWindow, constraints); }, success, error);\r\n    }\r\n    function setTitle(newTitle, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTitle(resultWindow, newTitle)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setSticky(isSticky, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setSticky(resultWindow, isSticky)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function moveResize(dimensions, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var resolveImmediately = areBoundsEqual(dimensions, _bounds);\r\n            var isDone = false;\r\n            var done = function () {\r\n                if (isDone) {\r\n                    return;\r\n                }\r\n                isDone = true;\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n                if (unsubscribeBoundsChanged) {\r\n                    unsubscribeBoundsChanged();\r\n                    unsubscribeBoundsChanged = undefined;\r\n                }\r\n                if (resolveTimeout) {\r\n                    clearTimeout(resolveTimeout);\r\n                    resolveTimeout = undefined;\r\n                }\r\n            };\r\n            var resolveTimeout;\r\n            var unsubscribeBoundsChanged;\r\n            if (!resolveImmediately) {\r\n                unsubscribeBoundsChanged = onBoundsChanged(function (win) {\r\n                    if (win.id !== resultWindow.id) {\r\n                        return;\r\n                    }\r\n                    if (!areBoundsEqual(dimensions, win.bounds)) {\r\n                        return;\r\n                    }\r\n                    done();\r\n                });\r\n            }\r\n            executor.moveResize(resultWindow, dimensions)\r\n                .then(function () {\r\n                if (resolveImmediately) {\r\n                    done();\r\n                    return;\r\n                }\r\n                resolveTimeout = setTimeout(function () {\r\n                    done();\r\n                }, 1000);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function addFrameButton(buttonInfo, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof buttonInfo === \"undefined\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No button info\");\r\n                    return;\r\n                }\r\n                reject(\"No button info\");\r\n                return;\r\n            }\r\n            if (buttonInfo.buttonId === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            if (buttonInfo.imageBase64 === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No imageBase64\");\r\n                    return;\r\n                }\r\n                reject(\"No imageBase64\");\r\n                return;\r\n            }\r\n            executor.addFrameButton(resultWindow, buttonInfo)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function removeFrameButton(buttonId, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (buttonId === undefined || buttonId === \"\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            executor.removeFrameButton(resultWindow, buttonId)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function activate(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.activate(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function focus(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.focus(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximizeRestore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = _windowState === \"normal\" ? onMaximized : onNormal;\r\n            executor.maximizeRestore(resultWindow)\r\n                .then(function () {\r\n                var un = currEvent(function () {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    if (un) {\r\n                        un();\r\n                    }\r\n                    resolve(resultWindow);\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.maximize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"maximized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMaximized(function (win) {\r\n                    if (win.id === id && win.state === \"maximized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function restore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.restore(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"normal\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onNormal(function (win) {\r\n                    if (id === win.id && win.state === \"normal\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function minimize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.minimize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"minimized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMinimized(function (win) {\r\n                    if (id === win.id && win.state === \"minimized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        return resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function collapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.collapse(resultWindow)\r\n                .then(function () {\r\n                if (isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onCollapsed(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function expand(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (!isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.expand(resultWindow)\r\n                .then(function () {\r\n                if (!isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onExpanded(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function toggleCollapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = isCollapsed ? onExpanded : onCollapsed;\r\n            executor.toggleCollapse(resultWindow)\r\n                .then(function () {\r\n                currEvent(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function snap(target, direction, success, error) {\r\n        var targetWindowGroup;\r\n        if (!target) {\r\n            return Promise.reject(\"Please specify a target window! calledWith: \" + target);\r\n        }\r\n        if (typeof target === \"string\") {\r\n            var targetWindow = windowStore.get(target);\r\n            if (!targetWindow) {\r\n                return Promise.reject(new Error(\"Invalid target parameter or no such window. Invoked with:  \" + target));\r\n            }\r\n            targetWindowGroup = targetWindow.API.group;\r\n        }\r\n        else {\r\n            targetWindowGroup = target.group;\r\n        }\r\n        return Promise.all([\r\n            waitForMyWindowToJoinTargetGroup(targetWindowGroup),\r\n            executor.snap(resultWindow, target, direction)\r\n        ])\r\n            .then(function () {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return resultWindow;\r\n        })\r\n            .catch(function (e) {\r\n            if (typeof error === \"function\") {\r\n                error(e);\r\n            }\r\n            return e;\r\n        });\r\n    }\r\n    function waitForMyWindowToJoinTargetGroup(targetGroup) {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = targetGroup.onWindowAdded(function (_, window) {\r\n                if (resultWindow.id === window.id) {\r\n                    unsub();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function attachTab(tab, index, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId;\r\n            var targetWindowId = resultWindow.id;\r\n            var errorMessage = \"Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!tab) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof tab === \"string\") {\r\n                sourceWindowId = tab;\r\n            }\r\n            else if (typeof tab.id !== \"undefined\") {\r\n                sourceWindowId = tab.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var argsForSend = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (index) {\r\n                argsForSend.index = index;\r\n            }\r\n            var sourceWin = windowStore.get(argsForSend.sourceWindowId).API;\r\n            var un = sourceWin.onAttached(function (win) {\r\n                if (win.id === sourceWin.id) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    un();\r\n                    resolve(resultWindow);\r\n                }\r\n            });\r\n            executor.attachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                un();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function detachTab(opt, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var argsForSend = { windowId: resultWindow.id };\r\n            var _options = opt || {};\r\n            if (typeof _options.relativeTo !== \"undefined\") {\r\n                if (typeof _options.relativeTo === \"string\") {\r\n                    argsForSend.relativeTo = _options.relativeTo;\r\n                }\r\n                else if (typeof _options.relativeTo.id !== \"undefined\") {\r\n                    argsForSend.relativeTo = _options.relativeTo.id;\r\n                }\r\n                if (typeof _options.relativeDirection !== \"undefined\") {\r\n                    argsForSend.relativeDirection = _options.relativeDirection;\r\n                }\r\n                if (typeof _options.width !== \"undefined\") {\r\n                    argsForSend.width = _options.width;\r\n                }\r\n                if (typeof _options.height !== \"undefined\") {\r\n                    argsForSend.height = _options.height;\r\n                }\r\n            }\r\n            if (typeof _options.bounds !== \"undefined\") {\r\n                argsForSend.bounds = _options.bounds;\r\n            }\r\n            if (typeof _options.hideTabHeader !== \"undefined\") {\r\n                argsForSend.hideTabHeader = _options.hideTabHeader;\r\n            }\r\n            var visibilityChangeHeard = false;\r\n            var detachedHeard = false;\r\n            var unVisibility = _registry.add(\"frame-attached\", (function (win) {\r\n                var isVisibilityCorrect = _options.hideTabHeader === undefined || _options.hideTabHeader !== win.isTabHeaderVisible;\r\n                if (id === win.id && isVisibilityCorrect) {\r\n                    visibilityChangeHeard = true;\r\n                    unVisibility();\r\n                    if (detachedHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unDetached === \"function\") {\r\n                            unDetached();\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n            var unDetached = onDetached(function (win) {\r\n                if (id === win.id) {\r\n                    detachedHeard = true;\r\n                    unDetached();\r\n                    if (visibilityChangeHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unVisibility === \"function\") {\r\n                            unVisibility();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            executor.detachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                unDetached();\r\n                unVisibility();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setVisible(toBeVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setVisible(resultWindow, toBeVisible)\r\n                .then(function () {\r\n                var isVisibilityCorrect = toBeVisible === undefined ? _isVisible === true : _isVisible === toBeVisible;\r\n                if (isVisibilityCorrect) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onVisibilityChanged(function (win) {\r\n                    isVisibilityCorrect = toBeVisible === undefined ? win.isVisible === true : win.isVisible === toBeVisible;\r\n                    if (win.id === id && isVisibilityCorrect) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function showLoader(loader) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.showLoader(resultWindow, loader)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideLoader() {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.hideLoader(resultWindow)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function updateContext(context, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.updateContext(resultWindow, context)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function lock(success, error) {\r\n        if (resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.lock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function unlock(success, error) {\r\n        if (!resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.unlock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function waitForLockingChanged() {\r\n        return new Promise(function (resolve) {\r\n            var un = onLockingChanged(function (window) {\r\n                if (window.id === resultWindow.id) {\r\n                    un();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function getIcon(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.getIcon(resultWindow)\r\n                .then(function (icon) {\r\n                if (typeof success === \"function\") {\r\n                    success(icon);\r\n                }\r\n                resolve(icon);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setIcon(base64Image, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setIcon(resultWindow, base64Image)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setFrameColor(frameColor, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setFrameColor(resultWindow, frameColor)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabHeaderVisible(toBeTabHeaderVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTabHeaderVisible(resultWindow, toBeTabHeaderVisible)\r\n                .then(function () {\r\n                if (_isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onTabHeaderVisibilityChanged(function (win) {\r\n                    if (win.id === id && win.isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabTooltip(tooltip) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!tooltip) {\r\n                    throw new Error(tooltip + \" is null or undefined\");\r\n                }\r\n                return [2, executor.setTabTooltip(resultWindow, tooltip)];\r\n            });\r\n        });\r\n    }\r\n    function showPopup(config) {\r\n        return executor.showPopup(resultWindow, config);\r\n    }\r\n    function createFlydown(config) {\r\n        return executor.createFlydown(resultWindow.id, config);\r\n    }\r\n    function setModalState(isModal) {\r\n        return executor.setModalState(resultWindow.id, isModal || false);\r\n    }\r\n    function zoomIn(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomIn(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function zoomOut(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomOut(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function setZoomFactor(zoomFactor, success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            if (isNaN(zoomFactor)) {\r\n                throw new Error(\"zoomFactor is not a number\");\r\n            }\r\n            return executor.setZoomFactor(resultWindow, zoomFactor);\r\n        }, success, error);\r\n    }\r\n    function showDevTools() {\r\n        return executor.showDevTools(resultWindow);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.capture(resultWindow, captureOptions);\r\n    }\r\n    function flash(suppliedOptions, mode) {\r\n        var flashOptions = {\r\n            shouldFlash: true,\r\n            mode: \"auto\"\r\n        };\r\n        if (typeof suppliedOptions === \"boolean\") {\r\n            flashOptions.shouldFlash = suppliedOptions;\r\n        }\r\n        if (typeof mode !== \"undefined\") {\r\n            flashOptions.mode = mode;\r\n        }\r\n        return executor.flash(resultWindow, flashOptions);\r\n    }\r\n    function print(printOptions) {\r\n        return executor.print(resultWindow, printOptions);\r\n    }\r\n    function printToPDF(printToPDFOptions) {\r\n        return executor.printToPDF(resultWindow, printToPDFOptions);\r\n    }\r\n    function onTitleChanged(callback) {\r\n        callback(resultWindow.title, resultWindow);\r\n        return _registry.add(\"onTitleChanged\", callback);\r\n    }\r\n    function onClose(callback) {\r\n        return _registry.add(\"onClose\", callback);\r\n    }\r\n    function onUrlChanged(callback) {\r\n        return _registry.add(\"onUrlChanged\", callback);\r\n    }\r\n    function onFrameButtonAdded(callback) {\r\n        return _registry.add(\"onFrameButtonAdded\", callback);\r\n    }\r\n    function onFrameButtonRemoved(callback) {\r\n        return _registry.add(\"onFrameButtonRemoved\", callback);\r\n    }\r\n    function onFrameButtonClicked(callback) {\r\n        return _registry.add(\"onFrameButtonClicked\", callback);\r\n    }\r\n    function onCollapsed(callback) {\r\n        if (isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"collapsed\", callback);\r\n    }\r\n    function onExpanded(callback) {\r\n        if (!isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"expanded\", callback);\r\n    }\r\n    function onMaximized(callback) {\r\n        if (_windowState === \"maximized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"maximized\", callback);\r\n    }\r\n    function onMinimized(callback) {\r\n        if (_windowState === \"minimized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"minimized\", callback);\r\n    }\r\n    function onNormal(callback) {\r\n        if (_windowState === \"normal\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"normal\", callback);\r\n    }\r\n    function onAttached(callback) {\r\n        return _registry.add(\"attached\", callback);\r\n    }\r\n    function onDetached(callback) {\r\n        return _registry.add(\"detached\", callback);\r\n    }\r\n    function onVisibilityChanged(callback) {\r\n        return _registry.add(\"visibility-changed\", callback);\r\n    }\r\n    function onContextUpdated(callback) {\r\n        return _registry.add(\"context-updated\", callback);\r\n    }\r\n    function onLockingChanged(callback) {\r\n        return _registry.add(\"lock-changed\", callback);\r\n    }\r\n    function onBoundsChanged(callback) {\r\n        return _registry.add(\"bounds-changed\", callback);\r\n    }\r\n    function onFocusChanged(callback) {\r\n        return _registry.add(\"focus-changed\", callback);\r\n    }\r\n    function onStickyChanged(callback) {\r\n        return _registry.add(\"sticky-changed\", callback);\r\n    }\r\n    function onFrameColorChanged(callback) {\r\n        return _registry.add(\"frame-color-changed\", callback);\r\n    }\r\n    function onTabHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"tab-header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAttached(callback) {\r\n        return _registry.add(\"window-attached\", callback);\r\n    }\r\n    function onWindowDetached(callback) {\r\n        return _registry.add(\"window-detached\", callback);\r\n    }\r\n    function onGroupChanged(callback) {\r\n        return _registry.add(\"group-changed\", callback);\r\n    }\r\n    function onTabSelectionChanged(callback) {\r\n        return _registry.add(\"tab-selection-changed\", callback);\r\n    }\r\n    function onClosing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error) {\r\n            var promise = callback();\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onClosing(callbackWrap, id);\r\n    }\r\n    function onRefreshing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error, prevent) {\r\n            var promise = callback(prevent);\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onRefreshing(callbackWrap, id);\r\n    }\r\n    function onZoomFactorChanged(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        return _registry.add(\"zoom-factor-changed\", callback);\r\n    }\r\n    function handleTitleChanged(newTitle) {\r\n        _title = newTitle;\r\n        _registry.execute(\"onTitleChanged\", newTitle, resultWindow);\r\n    }\r\n    function handleUrlChanged(newUrl) {\r\n        _url = newUrl;\r\n        _registry.execute(\"onUrlChanged\", newUrl, resultWindow);\r\n    }\r\n    function handleVisibilityChanged(isVisible) {\r\n        if (isVisible === _isVisible) {\r\n            return;\r\n        }\r\n        _isVisible = isVisible;\r\n        _registry.execute(\"visibility-changed\", resultWindow);\r\n    }\r\n    function handleWindowSettingsChanged(settings) {\r\n        _settings = settings;\r\n        _registry.execute(\"settings-changed\", resultWindow);\r\n    }\r\n    function handleContextUpdated(context) {\r\n        _context = context;\r\n        _registry.execute(\"context-updated\", _context, resultWindow);\r\n    }\r\n    function handleWindowClose() {\r\n        if (resultWindow.id === undefined) {\r\n            return;\r\n        }\r\n        resultWindow.id = undefined;\r\n        _registry.execute(\"onClose\", resultWindow);\r\n    }\r\n    function handleFrameButtonAdded(frameButton) {\r\n        var buttonObj = [\"buttonId\", \"imageBase64\", \"order\", \"tooltip\"].reduce(function (memo, k) {\r\n            memo[k] = frameButton[k];\r\n            return memo;\r\n        }, {});\r\n        var frameButtonsIds = _frameButtons.map(function (btn) {\r\n            return btn.buttonId;\r\n        });\r\n        if (frameButtonsIds.indexOf(frameButton.buttonId) === -1) {\r\n            _frameButtons.push(buttonObj);\r\n        }\r\n        _registry.execute(\"onFrameButtonAdded\", buttonObj, resultWindow);\r\n    }\r\n    function handleFrameButtonRemoved(frameButtonId) {\r\n        var button;\r\n        _frameButtons = _frameButtons.reduce(function (memo, btn) {\r\n            if (btn.buttonId === frameButtonId) {\r\n                button = btn;\r\n            }\r\n            else {\r\n                memo.push(btn);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (button !== undefined) {\r\n            _registry.execute(\"onFrameButtonRemoved\", button, resultWindow);\r\n        }\r\n    }\r\n    function handleFrameButtonClicked(frameButton) {\r\n        var button = _frameButtons.filter(function (btn) {\r\n            return btn.buttonId === frameButton.buttonId;\r\n        });\r\n        if (button.length > 0) {\r\n            _registry.execute(\"onFrameButtonClicked\", button[0], resultWindow);\r\n        }\r\n    }\r\n    function handleWindowChangeState(state) {\r\n        if (state === \"collapsed\") {\r\n            isCollapsed = true;\r\n        }\r\n        else if (state === \"expanded\") {\r\n            isCollapsed = false;\r\n        }\r\n        else {\r\n            _windowState = state;\r\n        }\r\n        _registry.execute(state, resultWindow);\r\n    }\r\n    function handleFrameIsLockedChanged(isLocked) {\r\n        _isLocked = isLocked;\r\n        _registry.execute(\"lock-changed\", resultWindow);\r\n    }\r\n    function handleBoundsChanged(bounds) {\r\n        if (_bounds.top === bounds.top && _bounds.left === bounds.left && _bounds.width === bounds.width && _bounds.height === bounds.height) {\r\n            return;\r\n        }\r\n        _bounds.top = bounds.top;\r\n        _bounds.left = bounds.left;\r\n        _bounds.width = bounds.width;\r\n        _bounds.height = bounds.height;\r\n        _registry.execute(\"bounds-changed\", resultWindow);\r\n    }\r\n    function handleFocusChanged(isFocused) {\r\n        _focus = isFocused;\r\n        _registry.execute(\"focus-changed\", resultWindow);\r\n    }\r\n    function handleIsStickyChanged(isSticky) {\r\n        _isSticky = isSticky;\r\n        _registry.execute(\"sticky-changed\", isSticky, resultWindow);\r\n    }\r\n    function handleFrameColorChanged(frameColor) {\r\n        _frameColor = frameColor;\r\n        _registry.execute(\"frame-color-changed\", resultWindow);\r\n    }\r\n    function handleFrameAttached(tabGroupId, isTabHeaderVisible) {\r\n        _tabGroupId = tabGroupId;\r\n        _isTabHeaderVisible = isTabHeaderVisible;\r\n        _registry.execute(\"frame-attached\", resultWindow);\r\n    }\r\n    function handleCompositionChanged(neighbours, groupId) {\r\n        _neighbours = neighbours || {};\r\n        _groupId = groupId;\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(isGroupHeaderVisible) {\r\n        _isGroupHeaderVisible = isGroupHeaderVisible;\r\n    }\r\n    function handleTabHeaderVisibilityChanged(isTabHeaderVisible) {\r\n        if (_isTabHeaderVisible !== isTabHeaderVisible) {\r\n            _isTabHeaderVisible = isTabHeaderVisible;\r\n            _registry.execute(\"tab-header-visibility-changed\", resultWindow);\r\n        }\r\n    }\r\n    function handleFrameSelectionChanged(newWindow, prevWindow) {\r\n        var selectedWindow;\r\n        if (typeof newWindow !== \"undefined\" && newWindow === id) {\r\n            _isTabSelected = true;\r\n            selectedWindow = resultWindow;\r\n        }\r\n        else {\r\n            _isTabSelected = false;\r\n            selectedWindow = windowStore.get(newWindow) ? windowStore.get(newWindow).API : undefined;\r\n        }\r\n        var previousWindow = windowStore.get(prevWindow) ? windowStore.get(prevWindow).API : undefined;\r\n        if (_isTabSelected && previousWindow) {\r\n            var un_1 = previousWindow.onTabSelectionChanged(function (newWin, prevWin) {\r\n                if ((prevWin && prevWin.id) === previousWindow.id) {\r\n                    un_1();\r\n                    _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n        }\r\n    }\r\n    function handleAttached(newTabGroupId, tabHeaderVisible) {\r\n        _tabGroupId = newTabGroupId;\r\n        _isTabHeaderVisible = tabHeaderVisible;\r\n        _registry.execute(\"attached\", resultWindow);\r\n    }\r\n    function handleWindowAttached(win) {\r\n        _registry.execute(\"window-attached\", win);\r\n    }\r\n    function handleDetached(tabGroupId) {\r\n        _tabGroupId = tabGroupId;\r\n        var un = _registry.add(\"frame-attached\", function (win) {\r\n            if (win.id === id) {\r\n                un();\r\n                _registry.execute(\"detached\", resultWindow);\r\n            }\r\n        });\r\n    }\r\n    function handleWindowDetached(win) {\r\n        _registry.execute(\"window-detached\", win);\r\n    }\r\n    function handleZoomFactorChanged(zoomFactor) {\r\n        _zoomFactor = zoomFactor;\r\n        _registry.execute(\"zoom-factor-changed\", resultWindow);\r\n    }\r\n    function handleGroupChanged(newGroup, oldGroup) {\r\n        _logger.trace(\"handle group changed to win: \" + id + \" with group id: \" + newGroup.id);\r\n        _group = newGroup;\r\n        _groupId = newGroup.id;\r\n        _registry.execute(\"group-changed\", resultWindow, newGroup, oldGroup);\r\n    }\r\n    function handleGroupAssociation(group) {\r\n        if (group) {\r\n            _logger.trace(\"setting group to win: \" + id + \" with group id: \" + group.id);\r\n        }\r\n        _group = group;\r\n    }\r\n    function getAllTabs() {\r\n        var allWindows = windowStore.list;\r\n        if (_mode.toLowerCase() !== \"tab\") {\r\n            return [];\r\n        }\r\n        return Object.keys(allWindows).reduce(function (memo, win) {\r\n            var window = allWindows[win];\r\n            if (window\r\n                && window.API.tabGroupId\r\n                && typeof window.API.tabGroupId !== \"undefined\"\r\n                && typeof resultWindow.tabGroupId !== \"undefined\"\r\n                && window.API.tabGroupId === resultWindow.tabGroupId) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function mapWindowIdsToWindowObjects(windowIdArr) {\r\n        return windowIdArr.reduce(function (memo, winId) {\r\n            var window = windowStore.get(winId);\r\n            if (window) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function getNeighboursByDirection(direction) {\r\n        var windowIds = _neighbours[direction];\r\n        if (typeof windowIds !== \"undefined\") {\r\n            return mapWindowIdsToWindowObjects(windowIds);\r\n        }\r\n    }\r\n    function getApplicationName() {\r\n        if (_context._APPLICATION_NAME) {\r\n            return _context._APPLICATION_NAME;\r\n        }\r\n        if (_context && _context._t42 && _context._t42.application) {\r\n            return _context._t42.application;\r\n        }\r\n        var info = getWindowInfo();\r\n        if (!info) {\r\n            return undefined;\r\n        }\r\n        return info.applicationName;\r\n    }\r\n    function getWindowInfo() {\r\n        if (typeof window !== \"undefined\" && window.glue42gd && window.glue42gd.getWindowInfo) {\r\n            var info = window.glue42gd.getWindowInfo(id);\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return info;\r\n            }\r\n        }\r\n    }\r\n    function areBoundsEqual(requested, current) {\r\n        var height = requested.height;\r\n        var width = requested.width;\r\n        if (requested.height < _settings.minHeight) {\r\n            height = _settings.minHeight;\r\n        }\r\n        if (requested.height > _settings.maxHeight) {\r\n            height = _settings.maxHeight;\r\n        }\r\n        if (requested.width < _settings.minWidth) {\r\n            width = _settings.minWidth;\r\n        }\r\n        if (requested.width > _settings.maxWidth) {\r\n            width = _settings.maxWidth;\r\n        }\r\n        var areHeightsEqual = height ? current.height === height : true;\r\n        var areWidthsEqual = width ? current.width === width : true;\r\n        var areLeftsEqual = requested.left ? current.left === requested.left : true;\r\n        var areTopsEqual = requested.top ? current.top === requested.top : true;\r\n        return areHeightsEqual && areWidthsEqual && areLeftsEqual && areTopsEqual;\r\n    }\r\n    resultWindow = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get application() {\r\n            var appManager = appManagerGetter();\r\n            return appManager ? appManager.application(getApplicationName()) : undefined;\r\n        },\r\n        get hostInstance() {\r\n            return executor.hostInstance;\r\n        },\r\n        get agmInstance() {\r\n            var _this = this;\r\n            if (typeof window !== \"undefined\" && window.glue42gd) {\r\n                return agm.servers().find(function (s) { return s.windowId === _this.id; });\r\n            }\r\n            var appName = getApplicationName();\r\n            return appName ? { application: appName } : undefined;\r\n        },\r\n        get url() {\r\n            return _url;\r\n        },\r\n        id: id,\r\n        get title() {\r\n            return _title;\r\n        },\r\n        get windowStyleAttributes() {\r\n            return _settings;\r\n        },\r\n        get settings() {\r\n            return _settings;\r\n        },\r\n        get tabGroupId() {\r\n            return _mode.toLowerCase() === \"tab\" ? _tabGroupId : undefined;\r\n        },\r\n        get frameButtons() {\r\n            return _frameButtons;\r\n        },\r\n        get mode() {\r\n            return _mode;\r\n        },\r\n        get state() {\r\n            return _windowState;\r\n        },\r\n        get isCollapsed() {\r\n            return isCollapsed;\r\n        },\r\n        get isVisible() {\r\n            return _isVisible;\r\n        },\r\n        get isLocked() {\r\n            return _isLocked;\r\n        },\r\n        get context() {\r\n            return _context;\r\n        },\r\n        get bounds() {\r\n            return _bounds;\r\n        },\r\n        get minHeight() {\r\n            return _settings.minHeight;\r\n        },\r\n        get maxHeight() {\r\n            return _settings.maxHeight;\r\n        },\r\n        get minWidth() {\r\n            return _settings.minWidth;\r\n        },\r\n        get maxWidth() {\r\n            return _settings.maxWidth;\r\n        },\r\n        get isFocused() {\r\n            return _focus;\r\n        },\r\n        get frameColor() {\r\n            return _frameColor;\r\n        },\r\n        get opened() {\r\n            return resultWindow.id !== undefined;\r\n        },\r\n        get group() {\r\n            return _group;\r\n        },\r\n        get groupId() {\r\n            return _groupId;\r\n        },\r\n        get isSticky() {\r\n            return _isSticky;\r\n        },\r\n        get topNeighbours() {\r\n            return getNeighboursByDirection(\"top\");\r\n        },\r\n        get leftNeighbours() {\r\n            return getNeighboursByDirection(\"left\");\r\n        },\r\n        get rightNeighbours() {\r\n            return getNeighboursByDirection(\"right\");\r\n        },\r\n        get bottomNeighbours() {\r\n            return getNeighboursByDirection(\"bottom\");\r\n        },\r\n        get isGroupHeaderVisible() {\r\n            return _isGroupHeaderVisible;\r\n        },\r\n        get activityId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityId;\r\n        },\r\n        get activityWindowId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityWindowId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityWindowId;\r\n        },\r\n        get windowType() {\r\n            return options.windowType || \"electron\";\r\n        },\r\n        get zoomFactor() {\r\n            return _zoomFactor;\r\n        },\r\n        get screen() {\r\n            if (typeof window !== \"undefined\" && window.glue42gd) {\r\n                return Utils$1.getMonitor(resultWindow.bounds, window.glue42gd.monitors);\r\n            }\r\n            return undefined;\r\n        },\r\n        maximize: maximize,\r\n        restore: restore,\r\n        minimize: minimize,\r\n        maximizeRestore: maximizeRestore,\r\n        collapse: collapse,\r\n        expand: expand,\r\n        toggleCollapse: toggleCollapse,\r\n        focus: focus,\r\n        activate: activate,\r\n        moveResize: moveResize,\r\n        setTitle: setTitle,\r\n        setStyle: setStyle,\r\n        setOnTop: setOnTop,\r\n        resetButtons: resetButtons,\r\n        setSizeConstraints: setSizeConstraints,\r\n        navigate: navigate,\r\n        addFrameButton: addFrameButton,\r\n        removeFrameButton: removeFrameButton,\r\n        setVisible: setVisible,\r\n        show: function () { return setVisible(true); },\r\n        hide: function () { return setVisible(false); },\r\n        center: function (screen) { return moveResize(Utils$1.getDisplayCenterOfScreen(resultWindow.bounds, screen || resultWindow.screen)); },\r\n        close: close,\r\n        snap: snap,\r\n        showLoader: showLoader,\r\n        hideLoader: hideLoader,\r\n        updateContext: updateContext,\r\n        lock: lock,\r\n        unlock: unlock,\r\n        getIcon: getIcon,\r\n        setIcon: setIcon,\r\n        setFrameColor: setFrameColor,\r\n        setTabTooltip: setTabTooltip,\r\n        attachTab: attachTab,\r\n        detachTab: detachTab,\r\n        setTabHeaderVisible: setTabHeaderVisible,\r\n        showPopup: showPopup,\r\n        createFlydown: createFlydown,\r\n        setModalState: setModalState,\r\n        setZoomFactor: setZoomFactor,\r\n        zoomIn: zoomIn,\r\n        zoomOut: zoomOut,\r\n        showDevTools: showDevTools,\r\n        capture: capture,\r\n        flash: flash,\r\n        setSticky: setSticky,\r\n        print: print,\r\n        printToPDF: printToPDF,\r\n        onClose: onClose,\r\n        onUrlChanged: onUrlChanged,\r\n        onTitleChanged: onTitleChanged,\r\n        onFrameButtonAdded: onFrameButtonAdded,\r\n        onFrameButtonRemoved: onFrameButtonRemoved,\r\n        onFrameButtonClicked: onFrameButtonClicked,\r\n        onCollapsed: onCollapsed,\r\n        onExpanded: onExpanded,\r\n        onMinimized: onMinimized,\r\n        onMaximized: onMaximized,\r\n        onNormal: onNormal,\r\n        onAttached: onAttached,\r\n        onDetached: onDetached,\r\n        onVisibilityChanged: onVisibilityChanged,\r\n        onContextUpdated: onContextUpdated,\r\n        onLockingChanged: onLockingChanged,\r\n        onBoundsChanged: onBoundsChanged,\r\n        onFrameColorChanged: onFrameColorChanged,\r\n        onFocusChanged: onFocusChanged,\r\n        onStickyChanged: onStickyChanged,\r\n        onGroupChanged: onGroupChanged,\r\n        onWindowAttached: onWindowAttached,\r\n        onWindowDetached: onWindowDetached,\r\n        onTabSelectionChanged: onTabSelectionChanged,\r\n        onTabHeaderVisibilityChanged: onTabHeaderVisibilityChanged,\r\n        onClosing: onClosing,\r\n        onRefreshing: onRefreshing,\r\n        onZoomFactorChanged: onZoomFactorChanged,\r\n        get tabs() {\r\n            return getAllTabs();\r\n        },\r\n        get isTabHeaderVisible() {\r\n            return _isTabHeaderVisible;\r\n        },\r\n        get isTabSelected() {\r\n            return _isTabSelected;\r\n        },\r\n        getURL: function () {\r\n            return Promise.resolve(_url);\r\n        },\r\n        getTitle: function () {\r\n            return Promise.resolve(_title);\r\n        },\r\n        getBounds: function () {\r\n            return Promise.resolve(_bounds);\r\n        },\r\n        getContext: function () {\r\n            return Promise.resolve(_context);\r\n        },\r\n        setContext: function (context) {\r\n            return updateContext(context);\r\n        },\r\n        resizeTo: function (width, height) {\r\n            return moveResize({ width: width, height: height });\r\n        },\r\n        moveTo: function (top, left) {\r\n            return moveResize({ top: top, left: left });\r\n        },\r\n        getParentWindow: function () {\r\n            var _a;\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var myParentId;\r\n                return __generator(this, function (_b) {\r\n                    myParentId = _settings.parentInstanceId;\r\n                    if (!myParentId) {\r\n                        return [2, undefined];\r\n                    }\r\n                    return [2, (_a = windowStore.list[myParentId]) === null || _a === void 0 ? void 0 : _a.API];\r\n                });\r\n            });\r\n        },\r\n        getChildWindows: function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    return [2, Object.keys(windowStore.list)\r\n                            .map(function (key) { return windowStore.list[key].API; })\r\n                            .filter(function (w) {\r\n                            var parentId = w.settings.parentInstanceId;\r\n                            return parentId === id;\r\n                        })];\r\n                });\r\n            });\r\n        }\r\n    };\r\n    var events = {\r\n        handleWindowClose: handleWindowClose,\r\n        handleWindowChangeState: handleWindowChangeState,\r\n        handleTitleChanged: handleTitleChanged,\r\n        handleVisibilityChanged: handleVisibilityChanged,\r\n        handleUrlChanged: handleUrlChanged,\r\n        handleWindowSettingsChanged: handleWindowSettingsChanged,\r\n        handleContextUpdated: handleContextUpdated,\r\n        handleFrameIsLockedChanged: handleFrameIsLockedChanged,\r\n        handleBoundsChanged: handleBoundsChanged,\r\n        handleFocusChanged: handleFocusChanged,\r\n        handleFrameButtonAdded: handleFrameButtonAdded,\r\n        handleFrameButtonRemoved: handleFrameButtonRemoved,\r\n        handleFrameButtonClicked: handleFrameButtonClicked,\r\n        handleFrameColorChanged: handleFrameColorChanged,\r\n        handleFrameAttached: handleFrameAttached,\r\n        handleFrameSelectionChanged: handleFrameSelectionChanged,\r\n        handleCompositionChanged: handleCompositionChanged,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n        handleTabHeaderVisibilityChanged: handleTabHeaderVisibilityChanged,\r\n        handleGroupChanged: handleGroupChanged,\r\n        handleGroupAssociation: handleGroupAssociation,\r\n        handleAttached: handleAttached,\r\n        handleDetached: handleDetached,\r\n        handleWindowAttached: handleWindowAttached,\r\n        handleWindowDetached: handleWindowDetached,\r\n        handleZoomFactorChanged: handleZoomFactorChanged,\r\n        handleIsStickyChanged: handleIsStickyChanged,\r\n    };\r\n    return {\r\n        API: resultWindow,\r\n        Events: events,\r\n        Registry: _registry\r\n    };\r\n});\n\nvar GDExecutor = (function () {\r\n    function GDExecutor() {\r\n        this._registry = lib$2();\r\n    }\r\n    Object.defineProperty(GDExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    GDExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"close\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"navigate\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    url: newUrl\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var stylePromises, wait, toBeVisible, toolTip, maxWidth, maxHeight, minWidth, minHeight, allowClose, allowCollapse, allowLockUnlock, allowMaximize, allowMinimize;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        stylePromises = [];\r\n                        wait = function (promise) { return stylePromises.push(promise); };\r\n                        if (style.focus !== undefined && !resultWindow.isFocused) {\r\n                            wait(resultWindow.focus());\r\n                        }\r\n                        if (style.hidden !== undefined) {\r\n                            toBeVisible = !style.hidden;\r\n                            wait(resultWindow.setVisible(toBeVisible));\r\n                        }\r\n                        if (style.onTop !== undefined) {\r\n                            wait(resultWindow.setOnTop(style.onTop));\r\n                        }\r\n                        if (style.tabTooltip !== undefined || style.tabToolTip !== undefined) {\r\n                            toolTip = (_a = style.tabTooltip, (_a !== null && _a !== void 0 ? _a : style.tabToolTip));\r\n                            wait(resultWindow.setTabTooltip(toolTip));\r\n                        }\r\n                        maxWidth = style.maxWidth, maxHeight = style.maxHeight, minWidth = style.minWidth, minHeight = style.minHeight, allowClose = style.allowClose, allowCollapse = style.allowCollapse, allowLockUnlock = style.allowLockUnlock, allowMaximize = style.allowMaximize, allowMinimize = style.allowMinimize;\r\n                        wait(resultWindow.setSizeConstraints({ maxWidth: maxWidth, maxHeight: maxHeight, minWidth: minWidth, minHeight: minHeight }));\r\n                        wait(resultWindow.resetButtons({ allowClose: allowClose, allowCollapse: allowCollapse, allowLockUnlock: allowLockUnlock, allowMaximize: allowMaximize, allowMinimize: allowMinimize }));\r\n                        return [4, Promise.all(stylePromises)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setSizeConstraints = function (resultWindow, constraints) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setSizeConstraints\", {\r\n                windowId: resultWindow.id,\r\n                options: constraints\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabTooltip = function (w, tabToolTip) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setTabTooltip\", { windowId: w.id, options: { tabToolTip: tabToolTip } })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, w];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.resetButtons = function (resultWindow, buttonsConfig) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"resetButtons\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonsConfig\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setOnTop = function (resultWindow, onTop) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setOnTop\", {\r\n                windowId: resultWindow.id,\r\n                options: { onTop: onTop }\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    title: newTitle\r\n                }\r\n            };\r\n            _this.execute(\"setTitle\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setSticky = function (resultWindow, isSticky) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    isSticky: isSticky\r\n                }\r\n            };\r\n            _this.execute(\"setSticky\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"moveResize\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    bounds: dimensions\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"addButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonInfo\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"removeButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonId\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"activate\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"focus\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximizeRestore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"restore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"minimize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"collapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"expand\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"toggleCollapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" +\r\n                resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                targetWindowId: targetWindowId\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            _this.execute(\"snap\", {\r\n                windowId: resultWindow.id,\r\n                options: args\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.attachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"attachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.detachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"detachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        if (toBeVisible === void 0) { toBeVisible = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            var command;\r\n            if (toBeVisible) {\r\n                command = \"show\";\r\n            }\r\n            else {\r\n                command = \"hide\";\r\n            }\r\n            _this.execute(command, { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"showLoadingAnimation\", { windowId: resultWindow.id, options: loader })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"hideLoadingAnimation\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"updateContext\", {\r\n                windowId: resultWindow.id,\r\n                context: context,\r\n                replace: Object.keys(resultWindow.context).length > 0 ? false : true\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: true\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: false\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"getIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {}\r\n            })\r\n                .then(function (result) {\r\n                resolve(result.icon);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    dataURL: base64Image\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setFrameColor\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    frameColor: frameColor\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setTabHeaderVisible\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    toShow: toBeTabHeaderVisible\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showPopup = function (targetWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var optionsCopy, reformatedOptions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            return [2, Promise.reject(\"The options object is not valid!\")];\r\n                        }\r\n                        optionsCopy = __assign({}, options);\r\n                        if (!optionsCopy.targetLocation) {\r\n                            optionsCopy.targetLocation = \"bottom\";\r\n                        }\r\n                        reformatedOptions = __assign(__assign({}, optionsCopy), { popupBounds: optionsCopy.size, targetId: targetWindow.id, popupId: optionsCopy.windowId });\r\n                        return [4, this.execute(\"showPopupWindow\", {\r\n                                windowId: targetWindow.id,\r\n                                options: reformatedOptions\r\n                            })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, targetWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.createFlydown = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var optionsCopy, fullOptions;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                if (!options) {\r\n                    return [2, Promise.reject(\"The options object is not valid!\")];\r\n                }\r\n                optionsCopy = __assign({}, options);\r\n                if (!optionsCopy.horizontalOffset) {\r\n                    optionsCopy.horizontalOffset = 0;\r\n                }\r\n                if (!optionsCopy.verticalOffset) {\r\n                    optionsCopy.verticalOffset = 0;\r\n                }\r\n                fullOptions = this.reformatFlydownOptions(windowId, optionsCopy);\r\n                return [2, this.execute(\"setFlydownArea\", { windowId: windowId, options: fullOptions }).then(function () {\r\n                        var zoneIds = fullOptions.zones.map(function (z) { return z.id; });\r\n                        fullOptions.zones.forEach(function (z) {\r\n                            var callback = typeof (z.flydownSize) === \"function\" ?\r\n                                z.flydownSize : function () { return z.flydownSize; };\r\n                            if (options.size instanceof Function && z.flydownSize) {\r\n                                callback = function (data, cancel) { return __awaiter(_this, void 0, void 0, function () {\r\n                                    var result;\r\n                                    return __generator(this, function (_a) {\r\n                                        switch (_a.label) {\r\n                                            case 0:\r\n                                                if (!(options.size instanceof Function)) return [3, 2];\r\n                                                return [4, options.size(data, cancel)];\r\n                                            case 1:\r\n                                                result = _a.sent();\r\n                                                _a.label = 2;\r\n                                            case 2:\r\n                                                if (!(z.flydownSize instanceof Function && z.flydownSize !== options.size)) return [3, 4];\r\n                                                return [4, z.flydownSize(data, cancel)];\r\n                                            case 3: return [2, (_a.sent()) || result];\r\n                                            case 4: return [2, result || z.flydownSize];\r\n                                        }\r\n                                    });\r\n                                }); };\r\n                            }\r\n                            _this._registry.clearKey(fullOptions.targetId + \"_\" + z.id);\r\n                            _this._registry.add(fullOptions.targetId + \"_\" + z.id, callback);\r\n                        });\r\n                        return {\r\n                            destroy: function () { return _this.clearFlydownArea(fullOptions.targetId, zoneIds); },\r\n                            options: optionsCopy\r\n                        };\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setModalState = function (windowId, isModal) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.execute(\"setModalState\", { windowId: windowId, options: { isModal: isModal } })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.handleFlydownBoundsRequested = function (targetId, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var cancelCallback, callbackData, responses, defaultResponse, response, responseOptions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        cancelCallback = function () { return data.cancel = true; };\r\n                        callbackData = {\r\n                            zoneId: data.flydownId,\r\n                            flydownWindowBounds: data.flydownWindowBounds,\r\n                            flydownWindowId: data.flydownWindowId,\r\n                        };\r\n                        return [4, Promise.all(this._registry.execute(targetId + \"_\" + data.flydownId, callbackData, cancelCallback))];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        if (responses.length === 1) {\r\n                            defaultResponse = { height: 0, width: 0, top: 0, left: 0 };\r\n                            response = typeof (responses[0]) === \"object\" && !Array.isArray(responses[0]) ? responses[0] : defaultResponse;\r\n                            responseOptions = __assign(__assign({}, data), { flydownWindowBounds: response });\r\n                            return [2, responseOptions];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomIn = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomIn\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomOut = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomOut\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setZoomFactor = function (window, zoomFactor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setZoomFactor\", {\r\n                            windowId: window.id,\r\n                            options: {\r\n                                zoomFactor: zoomFactor\r\n                            }\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showDevTools = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"showDevTools\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.capture = function (window, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureScreenshot\", { windowId: window.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.captureGroup = function (windowIds, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureGroupScreenshot\", { windowId: windowIds[0], options: __assign({ groupWindowIds: windowIds }, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.flash = function (resultWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"flash\", { windowId: resultWindow.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.configure = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.execute(\"configure\", { windowId: windowId, options: __assign({}, options) })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.print = function (resultWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"print\", { windowId: resultWindow.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.printToPDF = function (resultWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var filePath;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"printToPDF\", { windowId: resultWindow.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        filePath = (_a.sent()).filePath;\r\n                        return [2, filePath];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.execute = function (command, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var args = __assign(__assign({}, options), { command: command });\r\n            _this.agm\r\n                .invoke(\"T42.Wnd.Execute\", args, _this.agmTarget)\r\n                .then(function (i) {\r\n                if (i.returned && i.returned.errorMsg) {\r\n                    reject(i);\r\n                }\r\n                else {\r\n                    resolve(i.returned);\r\n                }\r\n            })\r\n                .catch(function (i) {\r\n                reject(i);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.execute(\"setGroupHeaderVisibility\", {\r\n            windowId: windowId,\r\n            options: {\r\n                toShow: toShow\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.getGroupTitle = function (windowId) {\r\n        return this.execute(\"getGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function (r) { return r.title; });\r\n    };\r\n    GDExecutor.prototype.setGroupTitle = function (windowId, title) {\r\n        return this.execute(\"setGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {\r\n                title: title\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.onClosing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addCloseHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.onRefreshing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addRefreshHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.reformatFlydownOptions = function (windowId, options) {\r\n        var assignGeneralIfUnassigned = function (zone, prop) {\r\n            if (options[prop] && (zone[prop] === undefined || zone[prop] === null)) {\r\n                var valueFromOptions = options[prop];\r\n                zone[prop] = valueFromOptions;\r\n            }\r\n        };\r\n        var zones = options.zones.map(function (z) {\r\n            assignGeneralIfUnassigned(z, \"windowId\");\r\n            assignGeneralIfUnassigned(z, \"targetLocation\");\r\n            if (options.size && (z.flydownSize === undefined || z.flydownSize === null)) {\r\n                z.flydownSize = options.size;\r\n            }\r\n            z.flydownBounds = z.flydownSize;\r\n            z.flydownId = z.windowId;\r\n            if (!z.targetLocation) {\r\n                z.targetLocation = \"bottom\";\r\n            }\r\n            return z;\r\n        });\r\n        return __assign(__assign({}, options), { zones: zones, targetId: windowId, flydownBounds: options.size, flydownActiveArea: options.activeArea });\r\n    };\r\n    GDExecutor.prototype.clearFlydownArea = function (windowId, areaIds) {\r\n        var _this = this;\r\n        return this.execute(\"clearFlydownWindowArea\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function () {\r\n            areaIds.forEach(function (id) {\r\n                _this._registry.clearKey(windowId + \"_\" + id);\r\n            });\r\n        });\r\n    };\r\n    return GDExecutor;\r\n}());\r\nvar executor = new GDExecutor();\n\nfunction getWindowsByTabGroupId(windowId, tabGroupId) {\r\n    var windows = windowStore.list;\r\n    return Object.keys(windows).reduce(function (memo, id) {\r\n        var win = windows[id];\r\n        if (win.API.tabGroupId === tabGroupId && win.API.id !== windowId) {\r\n            memo[id] = win;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\n\nvar GDEnvironment = (function () {\r\n    function GDEnvironment(agm, logger, appManagerGetter, instance, wndId) {\r\n        this._registry = lib$2();\r\n        this._waitTimeout = 10000;\r\n        this._agm = agm;\r\n        this._logger = logger.subLogger(\"gd-env\");\r\n        this._agmInstance = this.normalizeInstance(instance);\r\n        this._windowId = wndId;\r\n        this._appManagerGetter = appManagerGetter;\r\n    }\r\n    GDEnvironment.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof _this._agmInstance === \"undefined\") {\r\n                _this._agmInstance = \"best\";\r\n            }\r\n            _this._agm.registerAsync(\"T42.Wnd.OnEventWithResponse\", function (args, caller, success, err) {\r\n                _this.respondToEvent(args).then(success).catch(err);\r\n            });\r\n            var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n                _this._agm.subscribe(\"T42.Wnd.OnEvent\", {\r\n                    waitTimeoutMs: _this._waitTimeout,\r\n                    target: _this._agmInstance,\r\n                    onData: function (streamData) {\r\n                        _this.updateWindow(streamData.data, resolve);\r\n                    },\r\n                    onConnected: function (instance) {\r\n                        _this._agmInstance = _this.normalizeInstance(instance);\r\n                        executor.init(_this._agm, _this._agmInstance);\r\n                    }\r\n                }).catch(function (err) {\r\n                    reject(\"Can not subscribe for stream T42.Wnd.OnEvent. Err: \" + err);\r\n                });\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(GDEnvironment.prototype, \"executor\", {\r\n        get: function () {\r\n            return executor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDEnvironment.prototype.open = function (name, url, options, success, error) {\r\n        options = options || {};\r\n        var copyOptions = __assign({}, options);\r\n        if (name === undefined) {\r\n            error({ message: \"The name is undefined\" });\r\n            return;\r\n        }\r\n        if (copyOptions.relativeTo !== undefined && typeof copyOptions.relativeTo !== \"string\") {\r\n            copyOptions.relativeTo = copyOptions.relativeTo.id || \"\";\r\n        }\r\n        copyOptions.name = name;\r\n        copyOptions.url = url;\r\n        copyOptions.windowState = options.windowState || options.state;\r\n        delete copyOptions.state;\r\n        this._agm.invoke(\"T42.Wnd.Create\", copyOptions, this._agmInstance)\r\n            .then(function (message) {\r\n            if (message.returned !== undefined) {\r\n                var id = message.returned.id;\r\n                success(id);\r\n            }\r\n            else {\r\n                error({ message: \"failed to execute T42.Wnd.Create - unknown reason\" });\r\n            }\r\n        })\r\n            .catch(error);\r\n    };\r\n    GDEnvironment.prototype.createFlydown = function (windowId, options) {\r\n        return this.executor.createFlydown(windowId, options);\r\n    };\r\n    GDEnvironment.prototype.showPopup = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var window;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        window = windowStore.get(windowId);\r\n                        return [4, this.executor.showPopup(window.API, options)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDEnvironment.prototype.tabAttached = function (callback) {\r\n        return this._registry.add(\"tab-attached\", callback);\r\n    };\r\n    GDEnvironment.prototype.tabDetached = function (callback) {\r\n        return this._registry.add(\"tab-detached\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowFrameColorChanged = function (callback) {\r\n        return this._registry.add(\"frame-color-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onEvent = function (callback) {\r\n        return this._registry.add(\"window-event\", callback);\r\n    };\r\n    GDEnvironment.prototype.my = function () {\r\n        return this._windowId;\r\n    };\r\n    GDEnvironment.prototype.execute = function (command, windowId, options) {\r\n        return this._agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n            windowId: windowId,\r\n        });\r\n    };\r\n    GDEnvironment.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this._agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this._agmInstance);\r\n    };\r\n    GDEnvironment.prototype.onCompositionChanged = function (callback) {\r\n        return this._registry.add(\"composition-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onGroupHeaderVisibilityChanged = function (callback) {\r\n        return this._registry.add(\"group-header-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowGotFocus = function (callback) {\r\n        return this._registry.add(\"got-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowLostFocus = function (callback) {\r\n        return this._registry.add(\"lost-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.normalizeInstance = function (instance) {\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            application: instance.application,\r\n            machine: instance.machine,\r\n            user: instance.user,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.respondToEvent = function (args) {\r\n        if (args.type === \"ShowFlydownBoundsRequested\") {\r\n            return this.executor.handleFlydownBoundsRequested(args.data.windowId, args.data);\r\n        }\r\n        return Promise.reject(\"There isn't a handler for \" + args.type);\r\n    };\r\n    GDEnvironment.prototype.updateWindow = function (windowInfo, readyResolve) {\r\n        var _this = this;\r\n        var extendedStreamEvent = this.getExtendedStreamEvent(windowInfo);\r\n        if (windowInfo.type === \"Snapshot\") {\r\n            var windowInfoFullInfoEvent = windowInfo;\r\n            windowInfoFullInfoEvent.windows.forEach(function (w) {\r\n                var win = _this.createWindow(w.id, w);\r\n                windowStore.markReadyToShow(win.API.id);\r\n                _this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            });\r\n            readyResolve(this);\r\n            return;\r\n        }\r\n        if (windowInfo.type === \"Created\") {\r\n            var windowInfoCreatedEvent = windowInfo;\r\n            var win = this.createWindow(windowInfoCreatedEvent.windowId, windowInfoCreatedEvent.data || {});\r\n            windowStore.setReadyState(win.API.id);\r\n            this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            return;\r\n        }\r\n        var windowObjectAndEvents = windowStore.get(windowInfo.windowId);\r\n        if (!windowObjectAndEvents) {\r\n            this._logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n            return;\r\n        }\r\n        var theWindow = windowObjectAndEvents.API;\r\n        var theWindowEvents = windowObjectAndEvents.Events;\r\n        if (windowInfo.type === \"BoundsChanged\") {\r\n            var windowInfoBoundsChangedEvent = windowInfo;\r\n            theWindowEvents.handleBoundsChanged(windowInfoBoundsChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"UrlChanged\") {\r\n            var windowInfoUrlChangedEvent = windowInfo;\r\n            windowStore.setUrlChangedState(windowInfoUrlChangedEvent.windowId);\r\n            theWindowEvents.handleUrlChanged(windowInfoUrlChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"TitleChanged\") {\r\n            var windowInfoTitleChanged = windowInfo;\r\n            theWindowEvents.handleTitleChanged(windowInfoTitleChanged.data);\r\n        }\r\n        if (windowInfo.type === \"IsStickyChanged\") {\r\n            var windowInfoIsStickyChangedChanged = windowInfo;\r\n            theWindowEvents.handleIsStickyChanged(windowInfoIsStickyChangedChanged.data);\r\n        }\r\n        if (windowInfo.type === \"VisibilityChanged\") {\r\n            theWindowEvents.handleVisibilityChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ContextChanged\") {\r\n            theWindowEvents.handleContextUpdated(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"StateChanged\") {\r\n            theWindowEvents.handleWindowChangeState(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"FrameColorChanged\") {\r\n            theWindowEvents.handleFrameColorChanged(windowInfo.data);\r\n            this._registry.execute(\"frame-color-changed\", theWindow);\r\n        }\r\n        if (windowInfo.type === \"CompositionChanged\") {\r\n            var windowInfoCompositionChanged = windowInfo;\r\n            theWindowEvents.handleCompositionChanged(windowInfoCompositionChanged.data.neighbors, windowInfoCompositionChanged.data.groupId);\r\n            this._registry.execute(\"composition-changed\", windowInfoCompositionChanged.data);\r\n        }\r\n        if (windowInfo.type === \"GroupHeaderVisibilityChanged\") {\r\n            var info = windowInfo;\r\n            theWindowEvents.handleGroupHeaderVisibilityChanged(info.data.groupHeaderVisible);\r\n            this._registry.execute(\"group-header-changed\", info.data);\r\n        }\r\n        if (windowInfo.type === \"FocusChanged\") {\r\n            var windowInfoFocusChanged = windowInfo;\r\n            this.focusChanged(theWindowEvents, theWindow, windowInfoFocusChanged.data);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameChanged\") {\r\n            theWindowEvents.handleFrameAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            this._registry.execute(\"frame-changed\");\r\n        }\r\n        if (windowInfo.type === \"WindowFrameAdded\") {\r\n            theWindowEvents.handleAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            var winsToBeNotified_1 = getWindowsByTabGroupId(theWindow.id, windowInfo.data.frameId);\r\n            Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                var win = winsToBeNotified_1[id];\r\n                win.Events.handleWindowAttached(theWindow);\r\n            });\r\n            this._registry.execute(\"tab-attached\", theWindow, windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameRemoved\") {\r\n            var oldTabGroupId = theWindow.tabGroupId;\r\n            theWindowEvents.handleDetached(windowInfo.data.frameId);\r\n            var winsToBeNotified_2 = getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n            Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                var win = winsToBeNotified_2[id];\r\n                win.Events.handleWindowDetached(theWindow);\r\n            });\r\n            var un_1 = this._registry.add(\"frame-changed\", function () {\r\n                un_1();\r\n                _this._registry.execute(\"tab-detached\", theWindow, windowInfo.data.frameId, theWindow.tabGroupId);\r\n            });\r\n        }\r\n        if (windowInfo.type === \"TabHeaderVisibilityChanged\") {\r\n            theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"FrameSelectionChanged\") {\r\n            theWindowEvents.handleFrameSelectionChanged(windowInfo.data.newWindowId, windowInfo.data.prevWindowId);\r\n        }\r\n        if (windowInfo.type === \"ButtonClicked\") {\r\n            theWindowEvents.handleFrameButtonClicked(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonAdded\") {\r\n            theWindowEvents.handleFrameButtonAdded(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonRemoved\") {\r\n            theWindowEvents.handleFrameButtonRemoved(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"WindowZoomFactorChanged\") {\r\n            theWindowEvents.handleZoomFactorChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"Closed\") {\r\n            windowStore.remove(windowObjectAndEvents);\r\n            theWindowEvents.handleWindowClose();\r\n        }\r\n        if (windowInfo.type === \"FrameIsLockedChanged\") {\r\n            theWindowEvents.handleFrameIsLockedChanged(windowInfo.data);\r\n        }\r\n        this._registry.execute(\"window-event\", extendedStreamEvent);\r\n    };\r\n    GDEnvironment.prototype.createWindow = function (windowId, options) {\r\n        var _a;\r\n        var wrapper = windowStore.get(windowId);\r\n        var windowObjAndEvents = windowFactory(windowId, this.mapToWindowConstructorOptions(options), executor, this._logger, this._appManagerGetter, this._agm, (_a = wrapper) === null || _a === void 0 ? void 0 : _a.Registry);\r\n        windowStore.add(windowObjAndEvents);\r\n        return windowObjAndEvents;\r\n    };\r\n    GDEnvironment.prototype.focusChanged = function (theWindowEvents, theWindow, focus) {\r\n        theWindowEvents.handleFocusChanged(focus);\r\n        if (focus) {\r\n            this._registry.execute(\"got-focus\", theWindow);\r\n        }\r\n        else {\r\n            this._registry.execute(\"lost-focus\", theWindow);\r\n        }\r\n    };\r\n    GDEnvironment.prototype.mapToWindowConstructorOptions = function (args) {\r\n        return {\r\n            name: args.name,\r\n            context: args.context,\r\n            bounds: args.bounds,\r\n            url: args.url,\r\n            title: args.title,\r\n            isVisible: args.isVisible,\r\n            focus: args.isFocused,\r\n            state: args.state,\r\n            frameColor: args.frameColor,\r\n            groupId: args.groupId,\r\n            neighbours: args.neighbors,\r\n            isFocused: args.isFocused,\r\n            isGroupHeaderVisible: args.groupHeaderVisible,\r\n            isCollapsed: args.isCollapsed,\r\n            tabGroupId: args.frameId,\r\n            mode: args.mode,\r\n            isTabHeaderVisible: args.isTabHeaderVisible,\r\n            isTabSelected: args.isActiveTab,\r\n            settings: args.settings,\r\n            windowType: args.windowType,\r\n            zoomFactor: args.zoomFactor,\r\n            isLocked: args.isLocked,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.getExtendedStreamEvent = function (streamEvent) {\r\n        try {\r\n            var result = __assign({ state: streamEvent.type, windowName: windowStore.get(streamEvent.windowId).API.name }, streamEvent);\r\n            if (result.state === \"WindowFrameAdded\") {\r\n                result.state = \"TabAttached\";\r\n            }\r\n            if (result.state === \"StateChanged\") {\r\n                result.state = result.data.charAt(0).toUpperCase() + result.data.slice(1);\r\n            }\r\n            if (result.state === \"ButtonAdded\") {\r\n                result.state = \"FrameButtonAdded\";\r\n            }\r\n            if (result.state === \"ButtonRemoved\") {\r\n                result.state = \"FrameButtonRemoved\";\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            return streamEvent;\r\n        }\r\n    };\r\n    return GDEnvironment;\r\n}());\n\nvar envDetector = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _logger = logger;\r\n    return new Promise(function (resolve, reject) {\r\n        if (gdMajorVersion === 2) {\r\n            _logger.trace(\"running in HC\");\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (gdMajorVersion >= 3) {\r\n            _logger.trace(\"running in GD 3\");\r\n            var gd = new GDEnvironment(agm, _logger, appManagerGetter, undefined, window.glue42gd.windowId);\r\n            gd.init()\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else {\r\n            var gdPromise = new GDEnvironment(agm, _logger, appManagerGetter).init();\r\n            var wait = function (ms) { return new Promise(function (res, rej) { return setTimeout(function () { rej(\"timeout waiting for streams\"); }, ms); }); };\r\n            Promise.race([gdPromise, wait(10000)])\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n    });\r\n});\n\nvar groupFactory = (function (id, executor) {\r\n    var _registry = lib$2();\r\n    var _windowsId = [];\r\n    function addWindow(winId) {\r\n        if (_windowsId.indexOf(winId) === -1) {\r\n            _windowsId.push(winId);\r\n            var window_1 = windowStore.get(winId);\r\n            window_1.Events.handleGroupAssociation(groupObject);\r\n            _registry.execute(\"window-added\", groupObject, window_1.API);\r\n        }\r\n    }\r\n    function removeWindow(winId) {\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            _windowsId.splice(index, 1);\r\n            var window_2 = _mapToWindowObject(winId);\r\n            _registry.execute(\"window-removed\", groupObject, window_2);\r\n        }\r\n    }\r\n    function find(window, success) {\r\n        var winId;\r\n        if (typeof window === \"string\") {\r\n            winId = window;\r\n        }\r\n        else {\r\n            winId = window.id;\r\n        }\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            var mappedWindow = _mapToWindowObject(_windowsId[index]);\r\n            if (typeof success === \"function\") {\r\n                success(mappedWindow);\r\n            }\r\n            return mappedWindow;\r\n        }\r\n    }\r\n    function windows(success) {\r\n        var mappedWindows = _mapToWindowObjects();\r\n        if (typeof success === \"function\") {\r\n            success(mappedWindows);\r\n        }\r\n        return mappedWindows;\r\n    }\r\n    function showHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], true),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], false),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                return;\r\n            });\r\n        });\r\n    }\r\n    function getTitle() {\r\n        return executor.getGroupTitle(_windowsId[0]);\r\n    }\r\n    function setTitle(title) {\r\n        return executor.setGroupTitle(_windowsId[0], title);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.captureGroup(_windowsId, captureOptions);\r\n    }\r\n    function waitForHeaderVisibilityChanged() {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = onHeaderVisibilityChanged(function (group) {\r\n                unsub();\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n    function execute(command, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.execute(command, options)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(windowInfo) {\r\n        _registry.execute(\"header-visibility-changed\", groupObject);\r\n    }\r\n    function _mapToWindowObjects() {\r\n        var winObjects = [];\r\n        _windowsId.forEach(function (winId) {\r\n            var windowObject = _mapToWindowObject(winId);\r\n            if (typeof windowObject !== \"undefined\") {\r\n                winObjects.push(windowObject);\r\n            }\r\n        });\r\n        return winObjects;\r\n    }\r\n    function _mapToWindowObject(windowId) {\r\n        return windowStore.get(windowId) ? windowStore.get(windowId).API : undefined;\r\n    }\r\n    function _getGroupHeaderVisibility() {\r\n        var windowWithHiddenHeader = _mapToWindowObjects().find(function (w) { return !w.isGroupHeaderVisible; });\r\n        var _isGroupHeaderVisible = windowWithHiddenHeader === undefined;\r\n        return _isGroupHeaderVisible;\r\n    }\r\n    function onHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function onWindowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    var groupObject = {\r\n        id: id,\r\n        get windows() {\r\n            return windows();\r\n        },\r\n        find: find,\r\n        get isHeaderVisible() {\r\n            return _getGroupHeaderVisibility();\r\n        },\r\n        showHeader: showHeader,\r\n        hideHeader: hideHeader,\r\n        getTitle: getTitle,\r\n        setTitle: setTitle,\r\n        capture: capture,\r\n        maximize: function (success, error) {\r\n            return execute(\"maximize\", { groupId: id }, success);\r\n        },\r\n        restore: function (success, error) {\r\n            return execute(\"restore\", { groupId: id }, success);\r\n        },\r\n        onHeaderVisibilityChanged: onHeaderVisibilityChanged,\r\n        onWindowAdded: onWindowAdded,\r\n        onWindowRemoved: onWindowRemoved,\r\n    };\r\n    var internal = {\r\n        addWindow: addWindow,\r\n        removeWindow: removeWindow,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n    };\r\n    return {\r\n        groupAPI: groupObject,\r\n        groupInternal: internal,\r\n    };\r\n});\n\nvar groupsFactory = (function (environment, logger) {\r\n    var _logger = logger.subLogger(\"groups\");\r\n    var _registry = lib$2();\r\n    var _groups = {};\r\n    var heardForWindowsCounter = -1;\r\n    var windows = windowStore.list;\r\n    Object.keys(windows).forEach(function (k) {\r\n        addNewWindow(windows[k]);\r\n    });\r\n    environment.onCompositionChanged(function (windowInfo) {\r\n        handleCompositionChanged(windowInfo);\r\n    });\r\n    environment.onGroupHeaderVisibilityChanged(function (windowInfo) {\r\n        var windowId = windowInfo.windowId;\r\n        var group = findGroupByWindow(windowId);\r\n        if (typeof group !== \"undefined\") {\r\n            var groupEvents = _groups[group.id];\r\n            if (heardForWindowsCounter === -1) {\r\n                heardForWindowsCounter = group.windows.length;\r\n            }\r\n            heardForWindowsCounter--;\r\n            if (heardForWindowsCounter === 0) {\r\n                heardForWindowsCounter = -1;\r\n                groupEvents.groupInternal.handleGroupHeaderVisibilityChanged(windowInfo);\r\n            }\r\n        }\r\n    });\r\n    windowStore.onAdded(function (win) {\r\n        addNewWindow(win);\r\n    });\r\n    windowStore.onRemoved(function (win) {\r\n        removeWindow(win);\r\n    });\r\n    function my() {\r\n        return findGroupByWindow(environment.my());\r\n    }\r\n    function list(success) {\r\n        var result = Object.keys(_groups).map(function (groupId) {\r\n            if (_groups[groupId]) {\r\n                return _groups[groupId].groupAPI;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(result);\r\n        }\r\n        return result;\r\n    }\r\n    function findGroupByWindow(winId, success) {\r\n        var windowId;\r\n        if (typeof winId === \"undefined\") {\r\n            logger.debug(\"trying to find a group by a window, but winId is undefined\");\r\n            return;\r\n        }\r\n        if (typeof winId === \"string\") {\r\n            windowId = winId;\r\n        }\r\n        else {\r\n            windowId = winId.id;\r\n        }\r\n        var groupFound;\r\n        Object.keys(_groups).forEach(function (groupId) {\r\n            var group = _groups[groupId].groupAPI;\r\n            if (group.find(windowId) !== undefined) {\r\n                groupFound = group;\r\n                return;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(groupFound);\r\n        }\r\n        return groupFound;\r\n    }\r\n    function onWindowMoved(callback) {\r\n        return _registry.add(\"window-moved\", callback);\r\n    }\r\n    function createOrGetGroup(groupId) {\r\n        if (!_groups.hasOwnProperty(groupId)) {\r\n            var createdGroup = groupFactory(groupId, environment.executor);\r\n            _groups[groupId] = createdGroup;\r\n            return createdGroup;\r\n        }\r\n        else {\r\n            return _groups[groupId];\r\n        }\r\n    }\r\n    function deleteGroup(groupId) {\r\n        if (_groups.hasOwnProperty(groupId) && typeof _groups[groupId] !== \"undefined\") {\r\n            if (_groups[groupId].groupAPI.windows.length === 0) {\r\n                delete _groups[groupId];\r\n            }\r\n        }\r\n    }\r\n    function addNewWindow(win) {\r\n        _logger.trace(\"Adding new window \" + win.API.id + \" to win.API.groupId \" + win.API.groupId);\r\n        var group = addWindow(win);\r\n        if (group) {\r\n            _logger.trace(\"handleGroupAssociation \" + win.API.id + \" to group.groupAPI.id \" + group.groupAPI.id);\r\n            win.Events.handleGroupAssociation(group.groupAPI);\r\n        }\r\n    }\r\n    function addWindow(win, groupId) {\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        var windowId = win.API.id;\r\n        if (typeof windowGroupId === \"undefined\" || typeof windowId === \"undefined\") {\r\n            _logger.debug(\"trying to add a window without group - winId: \" + windowId);\r\n            return;\r\n        }\r\n        var group = createOrGetGroup(windowGroupId);\r\n        group.groupInternal.addWindow(windowId);\r\n        return group;\r\n    }\r\n    function removeWindow(win, groupId) {\r\n        var windowId = win.API.id;\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        if (typeof windowGroupId !== \"undefined\") {\r\n            var group = _groups[windowGroupId];\r\n            group.groupInternal.removeWindow(windowId);\r\n            win.Events.handleGroupAssociation(undefined);\r\n            deleteGroup(windowGroupId);\r\n        }\r\n    }\r\n    function handleCompositionChanged(windowInfo) {\r\n        var newGroupId = windowInfo.groupId;\r\n        var windowId = windowInfo.windowId;\r\n        var oldGroup = findGroupByWindow(windowId);\r\n        var oldGroupId = oldGroup ? oldGroup.id : undefined;\r\n        _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId);\r\n        if (oldGroupId === newGroupId) {\r\n            _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId + \" are the same - returning...\");\r\n            return;\r\n        }\r\n        var win = windowStore.get(windowId) || windowStore.get(windowId);\r\n        var newGroup = addWindow(win, newGroupId);\r\n        if (oldGroup) {\r\n            removeWindow(win, oldGroupId);\r\n            _registry.execute(\"window-moved\", windowId, oldGroup, newGroupId);\r\n        }\r\n        win.Events.handleGroupChanged(newGroup.groupAPI, oldGroup);\r\n    }\r\n    var groups = {\r\n        get my() {\r\n            return my();\r\n        },\r\n        list: list,\r\n        findGroupByWindow: findGroupByWindow,\r\n    };\r\n    var events = { onWindowMoved: onWindowMoved };\r\n    return {\r\n        groupsAPI: groups,\r\n        groupsEvents: events,\r\n    };\r\n});\n\nvar WindowsFactory = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _registry = lib$2();\r\n    var _logger = logger;\r\n    var groups;\r\n    var environment;\r\n    windowStore.init(_logger);\r\n    var isReady = new Promise(function (resolve, reject) {\r\n        envDetector(agm, _logger, appManagerGetter, gdMajorVersion)\r\n            .then(function (env) {\r\n            environment = env;\r\n            groups = groupsFactory(env, _logger);\r\n            resolve();\r\n        })\r\n            .catch(function (e) {\r\n            var err = \"Environment detector fails with: \" + e;\r\n            _logger.error(err);\r\n            reject(err);\r\n        });\r\n    });\r\n    function ready() {\r\n        return isReady;\r\n    }\r\n    function my() {\r\n        var myWindow = windowStore.getIfReady(environment.my());\r\n        return myWindow ? myWindow.API : undefined;\r\n    }\r\n    function open(name, url, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var errorHandler = function (errorResponse) {\r\n                if (typeof error === \"function\") {\r\n                    error(errorResponse);\r\n                }\r\n                reject(errorResponse);\r\n            };\r\n            var successHandler = function (id) {\r\n                windowStore.waitFor(id)\r\n                    .then(function (win) {\r\n                    if (typeof success === \"function\") {\r\n                        success(win.API);\r\n                    }\r\n                    resolve(win.API);\r\n                    if (win.API.windowType === \"electron\") {\r\n                        win.Events.handleUrlChanged(win.API.url);\r\n                    }\r\n                })\r\n                    .catch(errorHandler);\r\n            };\r\n            environment.open(name, url, options, successHandler, errorHandler);\r\n        });\r\n    }\r\n    function find(name, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (window && window.API.name === name) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with name:\" + name);\r\n            }\r\n        }\r\n    }\r\n    function findById(id, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (typeof window !== \"undefined\" && window.API.id === id) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with such id:\" + id);\r\n            }\r\n        }\r\n    }\r\n    function list(success) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows)\r\n            .map(function (k) {\r\n            return windows[k].API;\r\n        });\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing;\r\n        }\r\n        success(windowsForListing);\r\n    }\r\n    function configure(options) {\r\n        var win = my();\r\n        var winId = win ? win.id : \"\";\r\n        return executor.configure(winId, options);\r\n    }\r\n    function windowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function windowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    function tabAttached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabAttached(callback);\r\n        });\r\n    }\r\n    function tabDetached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabDetached(callback);\r\n        });\r\n    }\r\n    function onWindowFrameColorChanged(callback) {\r\n        return isReady.then(function () {\r\n            return environment.onWindowFrameColorChanged(callback);\r\n        });\r\n    }\r\n    function onWindowGotFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowGotFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onWindowLostFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowLostFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onEvent(callback) {\r\n        var unsubFunc;\r\n        var unsubscribed = false;\r\n        isReady.then(function () {\r\n            if (unsubscribed) {\r\n                return;\r\n            }\r\n            unsubFunc = environment.onEvent(callback);\r\n        });\r\n        return function () {\r\n            unsubscribed = true;\r\n            if (unsubFunc) {\r\n                unsubFunc();\r\n            }\r\n        };\r\n    }\r\n    function createFlydown(targetId, config) {\r\n        return environment.createFlydown(targetId, config);\r\n    }\r\n    function showPopup(targetId, config) {\r\n        return environment.showPopup(targetId, config);\r\n    }\r\n    function handleWindowAdded(w) {\r\n        _registry.execute(\"window-added\", w.API);\r\n    }\r\n    function handleWindowRemoved(w) {\r\n        _registry.execute(\"window-removed\", w.API);\r\n    }\r\n    windowStore.onReadyWindow(handleWindowAdded);\r\n    windowStore.onRemoved(handleWindowRemoved);\r\n    return {\r\n        my: my,\r\n        open: open,\r\n        find: find,\r\n        findById: findById,\r\n        list: list,\r\n        ready: ready,\r\n        onWindowAdded: windowAdded,\r\n        windowAdded: windowAdded,\r\n        onWindowRemoved: windowRemoved,\r\n        windowRemoved: windowRemoved,\r\n        onTabAttached: tabAttached,\r\n        onTabDetached: tabDetached,\r\n        onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n        get groups() {\r\n            return groups.groupsAPI;\r\n        },\r\n        onWindowGotFocus: onWindowGotFocus,\r\n        onWindowLostFocus: onWindowLostFocus,\r\n        onEvent: onEvent,\r\n        createFlydown: createFlydown,\r\n        showPopup: showPopup,\r\n        configure: configure\r\n    };\r\n});\n\nvar LayoutStore = (function () {\r\n    function LayoutStore() {\r\n        this.layouts = [];\r\n    }\r\n    LayoutStore.prototype.removeWhere = function (condition) {\r\n        this.layouts = this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.add = function (item) {\r\n        this.layouts.push(item);\r\n    };\r\n    Object.defineProperty(LayoutStore.prototype, \"all\", {\r\n        get: function () {\r\n            return this.layouts;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LayoutStore.prototype.where = function (condition) {\r\n        return this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.first = function (condition) {\r\n        return this.where(condition)[0];\r\n    };\r\n    return LayoutStore;\r\n}());\r\nvar store = new LayoutStore();\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$3(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$3,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode$1(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1$1 = encode$1;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode$1(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1$1 = decode$1;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1$1(alphabet_1$1.lookup, version$1);\n    str = str + encode_1$1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1$1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1$1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$3 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1$1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1$1 = lib$3.generate;\nvar lib_2$1 = lib$3.seed;\nvar lib_3$1 = lib$3.worker;\nvar lib_4$1 = lib$3.characters;\nvar lib_5$1 = lib$3.decode;\nvar lib_6$1 = lib$3.isValid;\n\nvar shortid$1 = lib$3;\n\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\nvar ContextProvider = (function () {\r\n    function ContextProvider(config, activitiesGetter, callbacks, logger) {\r\n        this.config = config;\r\n        this.activitiesGetter = activitiesGetter;\r\n        this.callbacks = callbacks;\r\n        this.logger = logger;\r\n        this.interop = config.agm;\r\n        this.registerRequestMethods();\r\n    }\r\n    ContextProvider.prototype.onSaveRequested = function (callback) {\r\n        return this.callbacks.add(\"saveRequested\", callback);\r\n    };\r\n    ContextProvider.prototype.isActivityOwner = function () {\r\n        if (typeof htmlContainer !== \"undefined\") {\r\n            var context_1 = htmlContainer.getContext();\r\n            return context_1 && context_1._t42 && context_1._t42.activityIsOwner;\r\n        }\r\n        var activities = this.activitiesGetter();\r\n        if (!activities) {\r\n            return false;\r\n        }\r\n        if (!activities.inActivity) {\r\n            return false;\r\n        }\r\n        var myWindow = activities.my.window;\r\n        var myActivity = activities.my.activity;\r\n        if (!myActivity && !myWindow) {\r\n            return false;\r\n        }\r\n        return myActivity.owner.id === myWindow.id;\r\n    };\r\n    ContextProvider.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.interop.register(SaveContextMethodName, function (args) {\r\n            var _a, _b, _c;\r\n            var usersCbs = _this.callbacks.execute(\"saveRequested\", args);\r\n            if (((_a = usersCbs) === null || _a === void 0 ? void 0 : _a.length) > 1) {\r\n                _this.logger.warn(\"Multiple subscriptions for \\\"glue.layouts.onSaveRequested\\\" - only the first one will be used\");\r\n            }\r\n            var requestResult = usersCbs[0];\r\n            var autoSaveWindowContext = _this.config.autoSaveWindowContext;\r\n            if (autoSaveWindowContext) {\r\n                return { autoSaveWindowContext: autoSaveWindowContext };\r\n            }\r\n            var result = { windowContext: (_b = requestResult) === null || _b === void 0 ? void 0 : _b.windowContext, activityContext: undefined };\r\n            if (_this.isActivityOwner()) {\r\n                result.activityContext = (_c = requestResult) === null || _c === void 0 ? void 0 : _c.activityContext;\r\n            }\r\n            return result;\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\n\nfunction transformACSLayout(something) {\r\n    if (!something) {\r\n        return something;\r\n    }\r\n    if (Array.isArray(something)) {\r\n        return something.map(function (item) {\r\n            return transformACSLayout(item);\r\n        });\r\n    }\r\n    if (typeof something === \"string\" || typeof something === \"number\" || typeof something === \"boolean\") {\r\n        return something;\r\n    }\r\n    var initial = {};\r\n    return Object.keys(something).reduce(function (accumulator, current) {\r\n        var value = something[current];\r\n        var convertedValue = transformACSLayout(value);\r\n        var key = current;\r\n        if (current[0].toLowerCase() !== current[0]) {\r\n            key = current[0].toLowerCase() + current.substr(1);\r\n        }\r\n        accumulator[key] = convertedValue;\r\n        return accumulator;\r\n    }, initial);\r\n}\n\nvar LayoutImpl = (function () {\r\n    function LayoutImpl(data) {\r\n        this.name = data.name;\r\n        this.type = data.type;\r\n        this.components = data.components;\r\n        this.context = data.context;\r\n        this.metadata = data.metadata;\r\n        this.version = data.version;\r\n    }\r\n    return LayoutImpl;\r\n}());\n\nvar LayoutsAPIImpl = (function () {\r\n    function LayoutsAPIImpl(config, stream, callbacks, logger) {\r\n        this.config = config;\r\n        this.stream = stream;\r\n        this.callbacks = callbacks;\r\n        this.appManager = config.appManager;\r\n        this.onEvent = stream.onEvent;\r\n        this.provider = new ContextProvider(config, config.activityGetter, callbacks, logger);\r\n        stream.subscribe();\r\n    }\r\n    LayoutsAPIImpl.prototype.setDefaultGlobal = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.SelectDefaultLayout\", { name: name })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.clearDefaultGlobal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.DeselectDefaultLayout\")];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getDefaultGlobal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetDefaultLayout\")];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (this.isSlimMode()) {\r\n                            return [2, layout];\r\n                        }\r\n                        return [2, this.list().find(function (l) { return l.name === layout.name && l.type === \"Global\"; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.ready = function () {\r\n        if (this.config.mode === \"fullWaitSnapshot\") {\r\n            return this.stream.gotSnapshot;\r\n        }\r\n        return this.stream.ready;\r\n    };\r\n    LayoutsAPIImpl.prototype.save = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout.name) {\r\n                throw Error(\"layout.name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                layout.type = \"Global\";\r\n            }\r\n            if (layout.activityId) {\r\n                layout.type = \"Activity\";\r\n            }\r\n            if (typeof layout.ignoreHidden === \"undefined\") {\r\n                layout.ignoreHidden = true;\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                actIds: [],\r\n                appIds: [],\r\n                type: layout.type,\r\n                context: layout.context,\r\n                metadata: layout.metadata || {},\r\n                options: { ignoreLayoutRestrictions: false },\r\n            };\r\n            if (layout.type === \"Activity\") {\r\n                var actId = layout.activityId;\r\n                if (!actId) {\r\n                    if (!_this.appManager.myInstance.inActivity) {\r\n                        throw new Error(\"Current application is not in activity. Can not save activity layout for it\");\r\n                    }\r\n                    actId = _this.appManager.myInstance.activityId;\r\n                }\r\n                layoutObject.actIds.push(actId);\r\n                layoutObject.options = { ignoreLayoutRestrictions: true };\r\n            }\r\n            else if (layout.type === \"Global\") {\r\n                if (_this.config.gdMajorVersion === 2) {\r\n                    var instances = _this.appManager.instances();\r\n                    if (layout.ignoreHidden) {\r\n                        instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n                    }\r\n                    if (layout.ignoreMyInstance && _this.appManager.myInstance) {\r\n                        instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n                    }\r\n                    instances.reduce(function (prev, current) {\r\n                        if (!current.id) {\r\n                            return prev;\r\n                        }\r\n                        if (current.inActivity) {\r\n                            var actId = current.activityId;\r\n                            if (prev.actIds.indexOf(actId) === -1) {\r\n                                prev.actIds.push(actId);\r\n                            }\r\n                        }\r\n                        else {\r\n                            prev.appIds.push(current.id);\r\n                        }\r\n                        return prev;\r\n                    }, layoutObject);\r\n                }\r\n                else {\r\n                    layoutObject.autoCollectApps = true;\r\n                }\r\n            }\r\n            else {\r\n                throw new Error(\"layout type \" + layout.type + \" not supported\");\r\n            }\r\n            _this.invokeMethodAndTrack(\"T42.ACS.SaveLayout\", layoutObject, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.restore = function (options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (typeof options === \"undefined\") {\r\n                throw Error(\"options argument is required\");\r\n            }\r\n            if (!options.name) {\r\n                throw Error(\"options.name argument is required\");\r\n            }\r\n            if (!options.type) {\r\n                options.type = \"Global\";\r\n            }\r\n            if (options.activityIdToJoin) {\r\n                options.type = \"Activity\";\r\n            }\r\n            if (typeof options.restoreActivityOwner === \"undefined\") {\r\n                options.restoreActivityOwner = false;\r\n            }\r\n            if (typeof options.ignoreActivityWindowTypes === \"undefined\") {\r\n                options.ignoreActivityWindowTypes = [];\r\n            }\r\n            if (typeof options.setActivityContext === \"undefined\") {\r\n                options.setActivityContext = true;\r\n            }\r\n            if (typeof options.closeRunningInstance === \"undefined\") {\r\n                if (options.type === \"Global\") {\r\n                    options.closeRunningInstance = true;\r\n                }\r\n                else if (options.type === \"Activity\") {\r\n                    options.closeRunningInstance = false;\r\n                }\r\n            }\r\n            if (typeof options.reuseWindows === \"undefined\") {\r\n                options.reuseWindows = true;\r\n            }\r\n            options.context = options.context || {};\r\n            var t42 = {\r\n                restoreOptions: {\r\n                    activityToJoin: options.activityIdToJoin,\r\n                    setActivityContext: options.setActivityContext,\r\n                    ignoreActivityWindowTypes: options.ignoreActivityWindowTypes,\r\n                    restoreActivityOwner: options.restoreActivityOwner,\r\n                    closeOldWindows: options.closeRunningInstance,\r\n                    reuseExistingWindows: options.reuseWindows\r\n                }\r\n            };\r\n            var arg = {\r\n                type: options.type,\r\n                name: options.name,\r\n                context: options.context,\r\n                toClose: [],\r\n                splash: options.splash\r\n            };\r\n            if (_this.config.gdMajorVersion === 2) {\r\n                if (options.closeRunningInstance) {\r\n                    arg.toClose = _this.getInstancesToClose(options);\r\n                }\r\n            }\r\n            if (options.timeout) {\r\n                arg.timeout = options.timeout;\r\n            }\r\n            arg.context._t42 = t42;\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RestoreLayout\", arg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.remove = function (type, name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = {\r\n                type: type,\r\n                name: name,\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RemoveLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.list = function () {\r\n        this.verifyNotSlimMode();\r\n        return store.all;\r\n    };\r\n    LayoutsAPIImpl.prototype.import = function (layouts, mode) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            var msg = {\r\n                mode: mode || \"replace\",\r\n                layouts: layouts\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ImportLayouts\", msg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.export = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var handleResult = function (result) {\r\n                var layouts = _this.getObjectValues(result.Layouts).map(function (t) { return new LayoutImpl(transformACSLayout(t)); });\r\n                resolve(layouts);\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ExportLayouts\", {}, handleResult, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.rename = function (layout, newName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = { type: layout.type, oldName: layout.name, newName: newName };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RenameLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateMetadata = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            if (!layout.metadata) {\r\n                throw Error(\"metadata argument is required\");\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                type: layout.type,\r\n                metadata: layout.metadata\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateMetadata\", layoutObject, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.hibernate = function (name, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            options = options || {};\r\n            var request = {\r\n                name: name,\r\n                type: \"Global\",\r\n                context: options.context || {},\r\n                metadata: options.metadata || {},\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.HibernateLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.resume = function (name, context, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            var request = __assign({ name: name, type: \"Global\", context: context }, options);\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ResumeLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getCurrentLayout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetCurrentLayout\", {}, \"best\", { methodResponseTimeoutMs: 120 * 1000 })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned.layout;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (!this.isSlimMode()) {\r\n                            layout = this.list().find(function (l) { return l.name === layout.name && l.type === layout.type; });\r\n                        }\r\n                        return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.onAdded = function (callback) {\r\n        var result = this.callbacks.add(\"added\", callback);\r\n        if (store.all.length > 0) {\r\n            store.all.forEach(function (layout) {\r\n                try {\r\n                    callback(layout);\r\n                }\r\n                catch (err) { }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    LayoutsAPIImpl.prototype.onRemoved = function (callback) {\r\n        return this.callbacks.add(\"removed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onChanged = function (callback) {\r\n        return this.callbacks.add(\"changed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRestored = function (callback) {\r\n        return this.callbacks.add(\"restored\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRenamed = function (callback) {\r\n        return this.callbacks.add(\"renamed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onEvent = function (callback) {\r\n        return this.stream.onEvent(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onSaveRequested = function (callback) {\r\n        return this.provider.onSaveRequested(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.updateAppContextInCurrent = function (context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (context && typeof context !== \"object\") {\r\n                reject(\"context must be an object\");\r\n            }\r\n            context = (context !== null && context !== void 0 ? context : {});\r\n            var request = {\r\n                context: context\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateLayoutComponentContext\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateDefaultContext = function (context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (context && typeof context !== \"object\") {\r\n                reject(\"context must be an object\");\r\n            }\r\n            context = (context !== null && context !== void 0 ? context : {});\r\n            var request = {\r\n                context: context\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateDefaultContext\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.isSlimMode = function () {\r\n        return this.config.mode === \"slim\";\r\n    };\r\n    LayoutsAPIImpl.prototype.verifyNotSlimMode = function () {\r\n        if (this.isSlimMode()) {\r\n            throw Error(\"Operation not allowed in slim mode. Run in full mode.\");\r\n        }\r\n    };\r\n    LayoutsAPIImpl.prototype.isVisibleWindow = function (instance) {\r\n        if (instance.application.type === \"exe\" || instance.application.type === \"node\") {\r\n            return true;\r\n        }\r\n        if (instance.application.type === \"activity\") {\r\n            return true;\r\n        }\r\n        if (!instance || !instance.window) {\r\n            return false;\r\n        }\r\n        return instance.window.isVisible;\r\n    };\r\n    LayoutsAPIImpl.prototype.invokeMethodAndTrack = function (methodName, args, resolve, reject, skipStreamEvent) {\r\n        var streamEventReceived = skipStreamEvent;\r\n        var agmResult;\r\n        var token = shortid$1();\r\n        args.token = token;\r\n        var handleResult = function () {\r\n            if (streamEventReceived && agmResult) {\r\n                resolve(agmResult);\r\n            }\r\n        };\r\n        if (!skipStreamEvent) {\r\n            this.stream.waitFor(token)\r\n                .then(function () {\r\n                streamEventReceived = true;\r\n                handleResult();\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        var responseHandler = function (result) {\r\n            if (!result.returned) {\r\n                reject(\"No result from method \" + methodName);\r\n            }\r\n            if (result.returned.status && (result.returned.status !== \"Success\" && result.returned.status !== \"PartialSuccess\")) {\r\n                reject(result.returned);\r\n            }\r\n            agmResult = result.returned;\r\n            handleResult();\r\n        };\r\n        this.config.agm.invoke(methodName, args, \"best\", { methodResponseTimeoutMs: 120 * 1000 })\r\n            .then(responseHandler)\r\n            .catch(function (err) { return reject(err); });\r\n    };\r\n    LayoutsAPIImpl.prototype.getInstancesToClose = function (options) {\r\n        var _this = this;\r\n        var instances = [];\r\n        var shellApp = this.appManager.applications().filter(function (a) { return a.isShell; })[0];\r\n        var shellApplicationName = shellApp ? shellApp.name : \"AppManager\";\r\n        this.appManager.instances().forEach(function (i) {\r\n            if (_this.appManager.myInstance && i.id === _this.appManager.myInstance.id) {\r\n                return;\r\n            }\r\n            if (i.application.name === shellApplicationName) {\r\n                return;\r\n            }\r\n            if (!_this.isVisibleWindow(i)) {\r\n                return;\r\n            }\r\n            if (options.type === \"Activity\") {\r\n                if (i.activityId !== options.activityIdToJoin) {\r\n                    return;\r\n                }\r\n            }\r\n            instances.push({ application: i.application.name, instance: i.id });\r\n        });\r\n        return instances;\r\n    };\r\n    LayoutsAPIImpl.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return LayoutsAPIImpl;\r\n}());\n\nvar ACSStream = (function () {\r\n    function ACSStream(agm, callbacks) {\r\n        var _this = this;\r\n        this.agm = agm;\r\n        this.callbacks = callbacks;\r\n        this.ready = new Promise(function (resolve, reject) {\r\n            _this.resolveReady = resolve;\r\n            _this.rejectReady = reject;\r\n        });\r\n        this.gotSnapshot = new Promise(function (resolve, reject) {\r\n            _this.resolveGotSnapshot = resolve;\r\n            _this.rejectGotSnapshot = reject;\r\n        });\r\n    }\r\n    ACSStream.prototype.subscribe = function (noRetry) {\r\n        var _this = this;\r\n        var transform = function (obj) {\r\n            return _this.getObjectValues(obj).map(function (t) { return transformACSLayout(t); });\r\n        };\r\n        if (!this.checkForLayoutEventMethod()) {\r\n            if (noRetry) {\r\n                this.resolveReady();\r\n            }\r\n            setTimeout(function () {\r\n                _this.subscribe(true);\r\n            }, 500);\r\n        }\r\n        else {\r\n            this.agm.subscribe(\"T42.ACS.OnLayoutEvent\", { waitTimeoutMs: 10000 })\r\n                .then(function (subs) {\r\n                subs.onData(function (args) {\r\n                    var data = args.data;\r\n                    if (data.IsSnapshot) {\r\n                        _this.resolveGotSnapshot();\r\n                    }\r\n                    _this.addLayouts(transform(data.OnLayoutAdded));\r\n                    _this.removeLayouts(transform(data.OnLayoutRemoved));\r\n                    _this.changeLayouts(transform(data.OnLayoutChanged));\r\n                    _this.renameLayouts(transform(data.OnLayoutRenamed));\r\n                    _this.restoredLayout(transform(data.OnLayoutRestored));\r\n                    _this.callbacks.execute(\"streamEvent\", data);\r\n                });\r\n                subs.onFailed(function (err) {\r\n                    var msg = \"can not subscribe to T42.ACS.OnLayoutEvent \" + err;\r\n                    _this.rejectReady(msg);\r\n                    _this.rejectGotSnapshot(msg);\r\n                });\r\n                _this.resolveReady();\r\n            })\r\n                .catch(function (err) {\r\n                var msg = \"Error subscribing for T42.ACS.OnLayoutEvent stream. Err: \" + err;\r\n                _this.rejectReady(msg);\r\n                _this.rejectGotSnapshot(msg);\r\n            });\r\n        }\r\n    };\r\n    ACSStream.prototype.onEvent = function (callback) {\r\n        return this.callbacks.add(\"streamEvent\", callback);\r\n    };\r\n    ACSStream.prototype.waitFor = function (token, timeout) {\r\n        var _this = this;\r\n        if (!timeout) {\r\n            timeout = 10000;\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var done = false;\r\n            var unsubscribe = _this.onEvent(function (streamEvent) {\r\n                if (streamEvent.Token === token) {\r\n                    done = true;\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                if (!done) {\r\n                    reject(\"timed out\");\r\n                }\r\n            }, timeout);\r\n        });\r\n    };\r\n    ACSStream.prototype.checkForLayoutEventMethod = function () {\r\n        try {\r\n            return this.agm\r\n                .methods()\r\n                .map(function (m) { return m.name; })\r\n                .indexOf(\"T42.ACS.OnLayoutEvent\") !== -1;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    ACSStream.prototype.addLayouts = function (layoutsData) {\r\n        var _this = this;\r\n        if (!layoutsData) {\r\n            return;\r\n        }\r\n        layoutsData.forEach(function (layoutData) {\r\n            var layout = new LayoutImpl(layoutData);\r\n            store.add(layout);\r\n            _this.callbacks.execute(\"added\", layout);\r\n        });\r\n    };\r\n    ACSStream.prototype.removeLayouts = function (removedLayouts) {\r\n        var _this = this;\r\n        if (!removedLayouts) {\r\n            return;\r\n        }\r\n        removedLayouts.forEach(function (removedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, removedLayout); });\r\n            _this.callbacks.execute(\"removed\", removedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.changeLayouts = function (changedLayouts) {\r\n        var _this = this;\r\n        if (!changedLayouts) {\r\n            return;\r\n        }\r\n        changedLayouts.forEach(function (changedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, changedLayout); });\r\n            store.add(new LayoutImpl(changedLayout));\r\n            _this.callbacks.execute(\"changed\", changedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.renameLayouts = function (renamedLayouts) {\r\n        var _this = this;\r\n        if (!renamedLayouts) {\r\n            return;\r\n        }\r\n        renamedLayouts.forEach(function (renamedLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: renamedLayout.type, name: renamedLayout.oldName }); });\r\n            if (!existingLayout) {\r\n                throw Error(\"received rename event for unknown layout with type \" + renamedLayout.type + \" and name \" + renamedLayout.oldName);\r\n            }\r\n            existingLayout.name = renamedLayout.newName;\r\n            _this.callbacks.execute(\"renamed\", existingLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.compareLayouts = function (layout1, layout2) {\r\n        return layout1.name === layout2.name && layout1.type === layout2.type;\r\n    };\r\n    ACSStream.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    ACSStream.prototype.restoredLayout = function (restoredLayouts) {\r\n        var _this = this;\r\n        if (!restoredLayouts) {\r\n            return;\r\n        }\r\n        restoredLayouts.forEach(function (restoredLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: restoredLayout.type, name: restoredLayout.name }); });\r\n            _this.callbacks.execute(\"restored\", existingLayout);\r\n        });\r\n    };\r\n    return ACSStream;\r\n}());\n\nfunction streamNull () {\r\n    return {\r\n        ready: Promise.resolve(undefined),\r\n        subscribe: function () { },\r\n        onEvent: function (callback) { return function () { }; },\r\n        waitFor: function (token, timeout) { return Promise.resolve(undefined); },\r\n        gotSnapshot: Promise.resolve(undefined),\r\n    };\r\n}\n\nfunction LayoutsFactory (config) {\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is required\");\r\n    }\r\n    if (!config.logger) {\r\n        throw Error(\"config.logger is required\");\r\n    }\r\n    config.mode = config.mode || \"slim\";\r\n    var logger = config.logger;\r\n    var callbacks = lib$2();\r\n    var acsStream;\r\n    if (config.mode === \"full\" || \"fullWaitSnapshot\") {\r\n        acsStream = new ACSStream(config.agm, callbacks);\r\n    }\r\n    else {\r\n        acsStream = streamNull();\r\n    }\r\n    return new LayoutsAPIImpl(config, acsStream, callbacks, logger);\r\n}\n\nvar T42DisplayCommand = \"T42.Displays.Command\";\r\nvar DisplayManager = (function () {\r\n    function DisplayManager(_agm, _logger) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._logger = _logger;\r\n        this.all = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var displays;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetAll, {})];\r\n                    case 1:\r\n                        displays = _a.sent();\r\n                        return [2, displays.map(this.decorateDisplay)];\r\n                }\r\n            });\r\n        }); };\r\n        this.get = function (id) { return __awaiter(_this, void 0, void 0, function () {\r\n            var display;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Get, { id: id })];\r\n                    case 1:\r\n                        display = _a.sent();\r\n                        return [2, this.decorateDisplay(display)];\r\n                }\r\n            });\r\n        }); };\r\n        this.getPrimary = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var primary;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        primary = (_a.sent()).find(function (d) { return d.isPrimary; });\r\n                        return [2, primary];\r\n                }\r\n            });\r\n        }); };\r\n        this.capture = function (options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Capture, __assign({}, options))];\r\n                    case 1:\r\n                        screenshot = _a.sent();\r\n                        return [2, screenshot];\r\n                }\r\n            });\r\n        }); };\r\n        this.captureAll = function (options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var screenshots;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.CaptureAll, __assign({}, options))];\r\n                    case 1:\r\n                        screenshots = _a.sent();\r\n                        return [2, screenshots];\r\n                }\r\n            });\r\n        }); };\r\n        this.getMousePosition = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var point;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetMousePosition)];\r\n                    case 1:\r\n                        point = _a.sent();\r\n                        return [2, point];\r\n                }\r\n            });\r\n        }); };\r\n        this.callGD = function (command, options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var invocationResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this._agm.invoke(T42DisplayCommand, { options: __assign({}, options), command: command })];\r\n                    case 1:\r\n                        invocationResult = _a.sent();\r\n                        return [2, invocationResult.returned.data];\r\n                }\r\n            });\r\n        }); };\r\n        this.decorateDisplay = function (original) {\r\n            return __assign(__assign({}, original), { capture: function (size) { return _this.capture({ id: original.id, size: size }); } });\r\n        };\r\n    }\r\n    return DisplayManager;\r\n}());\r\nvar DisplayCommand;\r\n(function (DisplayCommand) {\r\n    DisplayCommand[\"Capture\"] = \"capture\";\r\n    DisplayCommand[\"CaptureAll\"] = \"captureAll\";\r\n    DisplayCommand[\"GetAll\"] = \"getAll\";\r\n    DisplayCommand[\"Get\"] = \"get\";\r\n    DisplayCommand[\"GetMousePosition\"] = \"getMousePosition\";\r\n})(DisplayCommand || (DisplayCommand = {}));\n\nvar interop;\r\nvar windowId;\r\nfunction setupAGM(interopLib, channels) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    interop = interopLib;\r\n                    if (typeof window !== \"undefined\") {\r\n                        if (window.glue42gd) {\r\n                            windowId = window.glue42gd.windowId;\r\n                        }\r\n                    }\r\n                    if (!windowId) {\r\n                        return [2];\r\n                    }\r\n                    return [4, interop.register(\"T42.Channels.Command\", function (args) {\r\n                            var command = args.command;\r\n                            if (!command) {\r\n                                throw new Error(\"missing command argument\");\r\n                            }\r\n                            if (command === \"join\") {\r\n                                var id = args.channel;\r\n                                if (!id) {\r\n                                    throw new Error(\"missing argument id\");\r\n                                }\r\n                                channels.joinNoSelectorSwitch(id);\r\n                                return;\r\n                            }\r\n                            if (command === \"leave\") {\r\n                                channels.leaveNoSelectorSwitch();\r\n                                return;\r\n                            }\r\n                            if (command === \"get\") {\r\n                                var id = channels.current();\r\n                                return { id: id };\r\n                            }\r\n                            throw new Error(\"unknown command \" + command);\r\n                        })];\r\n                case 1:\r\n                    _a.sent();\r\n                    interop.invoke(\"T42.Channels.Announce\", { swId: windowId, instance: interop.instance.instance });\r\n                    return [2];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction switchChannel(channel, id) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            interop.invoke(\"T42.Channels.Announce\", {\r\n                swId: (id !== null && id !== void 0 ? id : windowId),\r\n                command: \"switchChannel\",\r\n                data: { newChannel: channel }\r\n            });\r\n            return [2];\r\n        });\r\n    });\r\n}\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n            var _a;\r\n            callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n                                var _a;\r\n                                if (_this.callback) {\r\n                                    _this.callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (data) {\r\n                resolve(data);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.updateChannel = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.update(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.updateData = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        if (this.contexts.setPathSupported) {\r\n            var pathValues = Object.keys(data).map(function (key) {\r\n                return {\r\n                    path: \"data.\" + key,\r\n                    value: data[key]\r\n                };\r\n            });\r\n            return this.contexts.setPaths(contextName, pathValues);\r\n        }\r\n        else {\r\n            return this.contexts.update(contextName, { data: data });\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return CONTEXT_PREFIX + name;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar ChannelsImpl = (function () {\r\n    function ChannelsImpl(shared) {\r\n        this.shared = shared;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$2();\r\n        this.shared.subscribe(this.handler.bind(this));\r\n    }\r\n    ChannelsImpl.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.publish = function (data, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof data !== \"object\") {\r\n                    throw new Error(\"Please provide the data as an object!\");\r\n                }\r\n                if (name) {\r\n                    if (typeof name !== \"string\") {\r\n                        throw new Error(\"Please provide the name as a string!\");\r\n                    }\r\n                    if (!this.shared.isChannel(name)) {\r\n                        return [2, Promise.reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"))];\r\n                    }\r\n                    return [2, this.shared.updateData(name, data)];\r\n                }\r\n                if (!this.currentContext) {\r\n                    throw new Error(\"Not joined to any channel!\");\r\n                }\r\n                return [2, this.shared.updateData(this.currentContext, data)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    ChannelsImpl.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    ChannelsImpl.prototype.join = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.joinCore(name)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.joinNoSelectorSwitch = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.joinCore(name, false)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leave = function () {\r\n        return this.leaveCore();\r\n    };\r\n    ChannelsImpl.prototype.leaveNoSelectorSwitch = function () {\r\n        return this.leaveCore(false);\r\n    };\r\n    ChannelsImpl.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    ChannelsImpl.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    ChannelsImpl.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    ChannelsImpl.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta || {},\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.updateChannel(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    ChannelsImpl.prototype.joinCore = function (name, changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        if (name === this.currentContext) {\r\n                            return [2];\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.currentContext = name;\r\n                        return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        if (changeSelector) {\r\n                            switchChannel(name);\r\n                        }\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leaveCore = function (changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        if (changeSelector) {\r\n            switchChannel();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    return ChannelsImpl;\r\n}());\n\nfunction factory(contexts, agm) {\r\n    var sharedContexts = new SharedContextSubscriber(contexts);\r\n    var channels = new ChannelsImpl(sharedContexts);\r\n    setupAGM(agm, channels);\r\n    return {\r\n        subscribe: channels.subscribe.bind(channels),\r\n        subscribeFor: channels.subscribeFor.bind(channels),\r\n        publish: channels.publish.bind(channels),\r\n        all: channels.all.bind(channels),\r\n        list: channels.list.bind(channels),\r\n        get: channels.get.bind(channels),\r\n        join: channels.join.bind(channels),\r\n        leave: channels.leave.bind(channels),\r\n        current: channels.current.bind(channels),\r\n        my: channels.my.bind(channels),\r\n        changed: channels.changed.bind(channels),\r\n        onChanged: channels.onChanged.bind(channels),\r\n        add: channels.add.bind(channels),\r\n        ready: function () { return contexts.ready(); }\r\n    };\r\n}\n\nvar CommandMethod = \"T42.Hotkeys.Command\";\r\nvar InvokeMethod = \"T42.Hotkeys.Invoke\";\r\nvar RegisterCommand = \"register\";\r\nvar UnregisterCommand = \"unregister\";\r\nvar UnregisterAllCommand = \"unregisterAll\";\r\nvar HotkeysImpl = (function () {\r\n    function HotkeysImpl(agm) {\r\n        this.agm = agm;\r\n        this.registry = lib$2();\r\n        this.firstHotkey = true;\r\n        this.hotkeys = new Map();\r\n    }\r\n    HotkeysImpl.prototype.register = function (info, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info === \"undefined\") {\r\n                            throw new Error(\"Hotkey parameter missing\");\r\n                        }\r\n                        if (typeof info === \"string\") {\r\n                            info = {\r\n                                hotkey: info\r\n                            };\r\n                        }\r\n                        else {\r\n                            if (!info.hotkey) {\r\n                                throw new Error(\"Info's hotkey parameter missing\");\r\n                            }\r\n                            info = {\r\n                                hotkey: info.hotkey,\r\n                                description: info.description\r\n                            };\r\n                        }\r\n                        hkToLower = this.formatHotkey(info.hotkey);\r\n                        if (this.hotkeys.has(hkToLower)) {\r\n                            throw new Error(\"Shortcut for \" + hkToLower + \" already registered\");\r\n                        }\r\n                        if (!this.firstHotkey) return [3, 2];\r\n                        this.firstHotkey = false;\r\n                        return [4, this.registerInvokeAGMMethod()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.registry.add(hkToLower, callback);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: RegisterCommand, hotkey: hkToLower, description: info.description })];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.hotkeys.set(hkToLower, info);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregister = function (hotkey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof hotkey === \"undefined\") {\r\n                            throw new Error(\"hotkey parameter missing\");\r\n                        }\r\n                        if (typeof hotkey !== \"string\") {\r\n                            throw new Error(\"hotkey parameter must be string\");\r\n                        }\r\n                        hkToLower = this.formatHotkey(hotkey);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: UnregisterCommand, hotkey: hkToLower })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.delete(hkToLower);\r\n                        this.registry.clearKey(hkToLower);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregisterAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.agm.invoke(CommandMethod, { command: UnregisterAllCommand })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.clear();\r\n                        this.registry.clear();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.isRegistered = function (hotkey) {\r\n        var hkToLower = this.formatHotkey(hotkey);\r\n        return this.hotkeys.has(hkToLower);\r\n    };\r\n    HotkeysImpl.prototype.registerInvokeAGMMethod = function () {\r\n        var _this = this;\r\n        this.agm.register(InvokeMethod, function (args) {\r\n            var hkToLower = args.key.toLowerCase();\r\n            var info = _this.hotkeys.get(hkToLower);\r\n            _this.registry.execute(hkToLower, info);\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.formatHotkey = function (hotkey) {\r\n        if (hotkey) {\r\n            return hotkey.replace(/\\s/g, \"\").toLowerCase();\r\n        }\r\n    };\r\n    return HotkeysImpl;\r\n}());\n\nfunction factory$1(agm) {\r\n    var hotkeys = new HotkeysImpl(agm);\r\n    return {\r\n        register: hotkeys.register.bind(hotkeys),\r\n        unregister: hotkeys.unregister.bind(hotkeys),\r\n        unregisterAll: hotkeys.unregisterAll.bind(hotkeys),\r\n        isRegistered: hotkeys.isRegistered.bind(hotkeys),\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\n\nvar version$2 = \"5.3.2\";\n\nvar prepareConfig$1 = (function (options) {\r\n    function getLibConfig(value, defaultMode, trueMode) {\r\n        if (typeof value === \"boolean\" && !value) {\r\n            return undefined;\r\n        }\r\n        var mode = getModeAsString(value, defaultMode, trueMode);\r\n        if (typeof value === \"object\") {\r\n            value.mode = mode;\r\n            return value;\r\n        }\r\n        return {\r\n            mode: mode,\r\n        };\r\n    }\r\n    function getModeAsString(value, defaultMode, trueMode) {\r\n        if (typeof value === \"object\") {\r\n            return getModeAsString(value.mode, defaultMode, trueMode) + \"\";\r\n        }\r\n        else if (typeof value === \"undefined\") {\r\n            if (typeof defaultMode === \"boolean\" && !defaultMode) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return defaultMode + \"\";\r\n            }\r\n        }\r\n        else if (typeof value === \"boolean\") {\r\n            if (value) {\r\n                return ((trueMode === undefined) ? defaultMode : trueMode) + \"\";\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n        return value + \"\";\r\n    }\r\n    var appDefaultMode = false;\r\n    var appDefaultTrueMode = \"startOnly\";\r\n    var activitiesDefaultMode = \"trackMyTypeAndInitiatedFromMe\";\r\n    var layoutsDefaultMode = \"slim\";\r\n    return {\r\n        layouts: getLibConfig(options.layouts, layoutsDefaultMode),\r\n        activities: getLibConfig(options.activities, activitiesDefaultMode),\r\n        appManager: getLibConfig(options.appManager, appDefaultMode, appDefaultTrueMode),\r\n        windows: getLibConfig(options.windows, true),\r\n        channels: getLibConfig(options.channels || false, false),\r\n        displays: getLibConfig(options.displays, true)\r\n    };\r\n});\n\nvar Glue42Notification = (function () {\r\n    function Glue42Notification(options) {\r\n        this.options = options;\r\n        this.callbacks = lib$2();\r\n        this.actions = options.actions;\r\n        this.body = options.body;\r\n        this.badge = options.badge;\r\n        this.data = options.data;\r\n        this.dir = options.dir;\r\n        this.icon = options.icon;\r\n        this.image = options.image;\r\n        this.lang = options.lang;\r\n        this.renotify = options.renotify;\r\n        this.requireInteraction = options.requireInteraction;\r\n        this.silent = options.silent;\r\n        this.tag = options.tag;\r\n        this.timestamp = options.timestamp;\r\n        this.title = options.title;\r\n    }\r\n    Glue42Notification.prototype.close = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    Glue42Notification.prototype.addEventListener = function (type, listener, options) {\r\n        this.callbacks.add(type, listener);\r\n    };\r\n    Glue42Notification.prototype.removeEventListener = function (type, listener, options) {\r\n    };\r\n    Glue42Notification.prototype.dispatchEvent = function (event) {\r\n        this.callbacks.execute(event.type, event);\r\n        return true;\r\n    };\r\n    return Glue42Notification;\r\n}());\n\nvar STARTING_INDEX = 0;\r\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n        this.methodsRegistered = false;\r\n        this.methodNameRoot = \"T42.Notifications.Handler-\" + shortid$1();\r\n        this.nextId = 0;\r\n        this.notifications = {};\r\n    }\r\n    Object.defineProperty(Notifications.prototype, \"maxActions\", {\r\n        get: function () {\r\n            return 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Notifications.prototype.raise = function (options) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bunchOfPromises, index, id, notification, validActions, index, _loop_1, this_1, _i, validActions_1, action, g42notification;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            throw new Error(\"invalid options - should be an object\");\r\n                        }\r\n                        if (!options.title) {\r\n                            throw new Error(\"invalid options - should have title\");\r\n                        }\r\n                        if (!!this.methodsRegistered) return [3, 2];\r\n                        bunchOfPromises = [];\r\n                        for (index = STARTING_INDEX; index < this.maxActions; index++) {\r\n                            bunchOfPromises.push(this.interop.register(this.methodNameRoot + \"_\" + index, this.handleNotificationAction.bind(this)));\r\n                        }\r\n                        return [4, Promise.all(bunchOfPromises)];\r\n                    case 1:\r\n                        _c.sent();\r\n                        this.methodsRegistered = true;\r\n                        _c.label = 2;\r\n                    case 2:\r\n                        id = String(this.nextId++);\r\n                        notification = {\r\n                            title: options.title,\r\n                            severity: \"Medium\",\r\n                            description: options.body,\r\n                            glueRoutingDetailMethodName: this.methodNameRoot + \"_\" + STARTING_INDEX,\r\n                            actions: [],\r\n                            source: id\r\n                        };\r\n                        if (options.actions) {\r\n                            validActions = options.actions.slice(0, this.maxActions);\r\n                            index = STARTING_INDEX;\r\n                            _loop_1 = function (action) {\r\n                                var args = {\r\n                                    g42notificationId: id,\r\n                                    g42action: action.action,\r\n                                    g42interopMethod: (_a = action.interop) === null || _a === void 0 ? void 0 : _a.method,\r\n                                    g42interopTarget: (_b = action.interop) === null || _b === void 0 ? void 0 : _b.target,\r\n                                };\r\n                                var parameters = Object.keys(args).map(function (key) {\r\n                                    var value = args[key];\r\n                                    return {\r\n                                        name: key,\r\n                                        value: {\r\n                                            stringValue: value\r\n                                        }\r\n                                    };\r\n                                });\r\n                                var glueAction = {\r\n                                    name: this_1.methodNameRoot + \"_\" + index,\r\n                                    description: action.title,\r\n                                    displayName: action.title,\r\n                                    parameters: parameters\r\n                                };\r\n                                notification.actions.push(glueAction);\r\n                                index++;\r\n                            };\r\n                            this_1 = this;\r\n                            for (_i = 0, validActions_1 = validActions; _i < validActions_1.length; _i++) {\r\n                                action = validActions_1[_i];\r\n                                _loop_1(action);\r\n                            }\r\n                        }\r\n                        return [4, this.interop.invoke(\"T42.GNS.Publish.RaiseNotification\", { notification: notification })];\r\n                    case 3:\r\n                        _c.sent();\r\n                        g42notification = new Glue42Notification(options);\r\n                        this.notifications[id] = g42notification;\r\n                        return [2, g42notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.handleNotificationAction = function (args) {\r\n        if (args.g42notificationId) {\r\n            var payload_1 = args;\r\n            var id = payload_1.g42notificationId;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_1 = new Event(\"onaction\");\r\n            event_1.action = payload_1.g42action;\r\n            if (notification.onaction) {\r\n                notification.onaction(event_1);\r\n            }\r\n            var actionDefinition = (notification.actions || []).find(function (item) { return item.action === payload_1.g42action; });\r\n            var actionInterop = actionDefinition.interop;\r\n            if (actionInterop) {\r\n                this.interop.invoke(actionInterop.method, actionInterop.arguments || {}, actionInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_1);\r\n        }\r\n        else if (args.notification && args.notification.source) {\r\n            var id = args.notification.source;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_2 = new Event(\"onclick\");\r\n            if (notification.onclick) {\r\n                notification.onclick(event_2);\r\n            }\r\n            var clickInterop = notification.options.clickInterop;\r\n            if (clickInterop) {\r\n                this.interop.invoke(clickInterop.method, clickInterop.arguments || {}, clickInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_2);\r\n        }\r\n    };\r\n    return Notifications;\r\n}());\n\nvar ThemesConfigurationMethodName = \"T42.Themes.Configuration\";\r\nvar ThemesImpl = (function () {\r\n    function ThemesImpl(core) {\r\n        this.core = core;\r\n        this.registry = lib$2();\r\n        this.isSubscribed = false;\r\n        this.getConfiguration();\r\n    }\r\n    ThemesImpl.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2: return [2, (_a.sent()).returned.all];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getCurrent = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var all;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2:\r\n                        all = _a.sent();\r\n                        return [2, all.returned.all.find(function (t) { return t.name === all.returned.selected; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.select = function (theme) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.setMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.core.interop.invoke(this.setMethodName, { theme: theme })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.onChanged = function (callback) {\r\n        this.subscribe();\r\n        return this.registry.add(\"changed\", callback);\r\n    };\r\n    ThemesImpl.prototype.getConfiguration = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var config, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        if (this.sharedContextName) {\r\n                            return [2];\r\n                        }\r\n                        return [4, this.core.interop.invoke(ThemesConfigurationMethodName)];\r\n                    case 1:\r\n                        config = _a.sent();\r\n                        this.sharedContextName = config.returned.sharedContextName;\r\n                        this.getMethodName = config.returned.getThemesMethodName;\r\n                        this.setMethodName = config.returned.setThemesMethodName;\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [2];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.core.interop.invoke(this.getMethodName)];\r\n                    case 2: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.subscribe = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (this.isSubscribed) {\r\n                            return [2];\r\n                        }\r\n                        this.isSubscribed = true;\r\n                        this.core.contexts.subscribe(this.sharedContextName, function (data) {\r\n                            if (data && data.all && data.selected) {\r\n                                _this.registry.execute(\"changed\", data.all.find(function (t) { return t.name === data.selected; }));\r\n                            }\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ThemesImpl;\r\n}());\n\nfunction factory$2(core) {\r\n    var themes = new ThemesImpl(core);\r\n    return {\r\n        list: themes.list.bind(themes),\r\n        getCurrent: themes.getCurrent.bind(themes),\r\n        select: themes.select.bind(themes),\r\n        onChanged: themes.onChanged.bind(themes),\r\n        ready: function () { return Promise.resolve(); },\r\n    };\r\n}\n\nvar GLUE42_FDC3_INTENTS_METHOD_PREFIX = \"Tick42.FDC3.Intents.\";\r\nvar Intents = (function () {\r\n    function Intents(interop, windows, logger) {\r\n        this.interop = interop;\r\n        this.windows = windows;\r\n        this.logger = logger;\r\n    }\r\n    Intents.prototype.find = function (intentFilter) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intents, ctToLower_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        intents = _a.sent();\r\n                        if (typeof intentFilter === \"undefined\") {\r\n                            return [2, intents];\r\n                        }\r\n                        if (typeof intentFilter === \"string\") {\r\n                            return [2, intents.filter(function (intent) { return intent.name === intentFilter; })];\r\n                        }\r\n                        if (typeof intentFilter !== \"object\") {\r\n                            throw new Error(\"Please provide the intentFilter as a string or an object!\");\r\n                        }\r\n                        if (intentFilter.contextType) {\r\n                            ctToLower_1 = intentFilter.contextType.toLowerCase();\r\n                            intents = intents.filter(function (intent) { return intent.handlers.some(function (handler) { var _a; return (_a = handler.contextTypes) === null || _a === void 0 ? void 0 : _a.some(function (ct) { return ct.toLowerCase() === ctToLower_1; }); }); });\r\n                        }\r\n                        if (intentFilter.name) {\r\n                            intents = intents.filter(function (intent) { return intent.name === intentFilter.name; });\r\n                        }\r\n                        return [2, intents];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raise = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intentName, intentDef, isDynamicIntent, target, handler, anAppHandler, anInstanceHandler, instanceId, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if ((typeof intent !== \"string\" && typeof intent !== \"object\") || (typeof intent === \"object\" && typeof intent.intent !== \"string\")) {\r\n                            throw new Error(\"Please provide the intent as a string or an object with an intent property!\");\r\n                        }\r\n                        if (typeof intent === \"string\") {\r\n                            intent = {\r\n                                intent: intent\r\n                            };\r\n                        }\r\n                        intentName = intent.intent;\r\n                        return [4, this.get(intentName)];\r\n                    case 1:\r\n                        intentDef = _a.sent();\r\n                        if (typeof intentDef === \"undefined\") {\r\n                            throw new Error(\"Intent \" + intentName + \" not found.\");\r\n                        }\r\n                        isDynamicIntent = !intentDef.handlers.some(function (intentDefHandler) { return intentDefHandler.type === \"app\"; });\r\n                        target = intent.target || (isDynamicIntent ? \"reuse\" : \"startNew\");\r\n                        anAppHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\"; });\r\n                        if (target === \"startNew\") {\r\n                            handler = anAppHandler;\r\n                        }\r\n                        else if (target === \"reuse\") {\r\n                            anInstanceHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\"; });\r\n                            handler = anInstanceHandler || anAppHandler;\r\n                        }\r\n                        else if (target.instance) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\" && intentHandler.instanceId === target.instance; });\r\n                        }\r\n                        else if (target.app) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\" && intentHandler.applicationName === target.app; });\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Invalid intent target: \" + JSON.stringify(target));\r\n                        }\r\n                        if (!handler) {\r\n                            throw new Error(\"Can not raise intent for request \" + JSON.stringify(intent) + \" - can not find intent handler.\");\r\n                        }\r\n                        instanceId = handler.instanceId;\r\n                        if (!(handler.type === \"app\")) return [3, 3];\r\n                        return [4, this.startApp(handler.applicationName, intent.options)];\r\n                    case 2:\r\n                        instanceId = _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [4, this.raiseIntentToInstance(instanceId, intentName, intent.context)];\r\n                    case 4:\r\n                        result = _a.sent();\r\n                        result.request = intent;\r\n                        result.handler = handler;\r\n                        return [2, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.all = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, apps_1, intents_1, appsWithIntents, _i, appsWithIntents_1, app, _a, _b, intentDef, intent, handler, _loop_1, _c, _d, server, e_1;\r\n            var _this = this;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        _e.trys.push([0, 6, , 7]);\r\n                        return [4, this.interop.invoke(\"T42.ACS.GetApplications\", { withIntentsInfo: true })];\r\n                    case 1:\r\n                        result = _e.sent();\r\n                        apps_1 = result.returned.applications;\r\n                        intents_1 = {};\r\n                        appsWithIntents = apps_1.filter(function (app) { return app.intents && app.intents.length > 0; });\r\n                        for (_i = 0, appsWithIntents_1 = appsWithIntents; _i < appsWithIntents_1.length; _i++) {\r\n                            app = appsWithIntents_1[_i];\r\n                            for (_a = 0, _b = app.intents; _a < _b.length; _a++) {\r\n                                intentDef = _b[_a];\r\n                                intent = intents_1[intentDef.name];\r\n                                if (!intent) {\r\n                                    intent = {\r\n                                        name: intentDef.name,\r\n                                        handlers: [],\r\n                                    };\r\n                                    intents_1[intentDef.name] = intent;\r\n                                }\r\n                                handler = {\r\n                                    applicationName: app.name,\r\n                                    applicationTitle: app.title,\r\n                                    applicationDescription: app.caption,\r\n                                    displayName: intentDef.displayName,\r\n                                    contextTypes: intentDef.contexts,\r\n                                    applicationIcon: app.icon,\r\n                                    type: \"app\"\r\n                                };\r\n                                intent.handlers.push(handler);\r\n                            }\r\n                        }\r\n                        _loop_1 = function (server) {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, Promise.all(server.getMethods()\r\n                                            .filter(function (method) { return method.name.startsWith(GLUE42_FDC3_INTENTS_METHOD_PREFIX); })\r\n                                            .map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                                            var intentName, intent, info, app, appIntent, window, title, handler;\r\n                                            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\r\n                                            return __generator(this, function (_l) {\r\n                                                switch (_l.label) {\r\n                                                    case 0:\r\n                                                        intentName = method.name.replace(GLUE42_FDC3_INTENTS_METHOD_PREFIX, \"\");\r\n                                                        intent = intents_1[intentName];\r\n                                                        if (!intent) {\r\n                                                            intent = {\r\n                                                                name: intentName,\r\n                                                                handlers: [],\r\n                                                            };\r\n                                                            intents_1[intentName] = intent;\r\n                                                        }\r\n                                                        if (method.description) {\r\n                                                            try {\r\n                                                                info = JSON.parse(method.description);\r\n                                                            }\r\n                                                            catch (_m) { }\r\n                                                        }\r\n                                                        app = apps_1.find(function (appWithIntents) { return appWithIntents.name === server.application; });\r\n                                                        if (app && app.intents) {\r\n                                                            appIntent = app.intents.find(function (appDefIntent) { return appDefIntent.name === intentName; });\r\n                                                        }\r\n                                                        window = this.windows.findById(server.windowId);\r\n                                                        return [4, ((_a = window) === null || _a === void 0 ? void 0 : _a.getTitle())];\r\n                                                    case 1:\r\n                                                        title = _l.sent();\r\n                                                        handler = {\r\n                                                            instanceId: server.instance,\r\n                                                            applicationName: server.application,\r\n                                                            applicationIcon: ((_b = info) === null || _b === void 0 ? void 0 : _b.icon) || ((_c = app) === null || _c === void 0 ? void 0 : _c.icon),\r\n                                                            applicationTitle: (_d = app) === null || _d === void 0 ? void 0 : _d.title,\r\n                                                            applicationDescription: ((_e = info) === null || _e === void 0 ? void 0 : _e.description) || ((_f = app) === null || _f === void 0 ? void 0 : _f.caption),\r\n                                                            displayName: ((_g = info) === null || _g === void 0 ? void 0 : _g.displayName) || ((_h = appIntent) === null || _h === void 0 ? void 0 : _h.displayName),\r\n                                                            contextTypes: ((_j = info) === null || _j === void 0 ? void 0 : _j.contextTypes) || ((_k = appIntent) === null || _k === void 0 ? void 0 : _k.contexts),\r\n                                                            instanceTitle: title,\r\n                                                            type: \"instance\"\r\n                                                        };\r\n                                                        intent.handlers.push(handler);\r\n                                                        return [2];\r\n                                                }\r\n                                            });\r\n                                        }); }))];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        };\r\n                        _c = 0, _d = this.interop.servers();\r\n                        _e.label = 2;\r\n                    case 2:\r\n                        if (!(_c < _d.length)) return [3, 5];\r\n                        server = _d[_c];\r\n                        return [5, _loop_1(server)];\r\n                    case 3:\r\n                        _e.sent();\r\n                        _e.label = 4;\r\n                    case 4:\r\n                        _c++;\r\n                        return [3, 2];\r\n                    case 5: return [2, Object.values(intents_1)];\r\n                    case 6:\r\n                        e_1 = _e.sent();\r\n                        this.logger.error(\"Failed to get the applications!\", e_1);\r\n                        return [2, []];\r\n                    case 7: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.addIntentListener = function (intent, handler) {\r\n        var _this = this;\r\n        if ((typeof intent !== \"string\" && typeof intent !== \"object\") || (typeof intent === \"object\" && typeof intent.intent !== \"string\")) {\r\n            throw new Error(\"Please provide the intent as a string or an object with an intent property!\");\r\n        }\r\n        if (typeof handler !== \"function\") {\r\n            throw new Error(\"Please provide the handler as a function!\");\r\n        }\r\n        var result = { unsubscribe: function () { return console.log(\"Could not unsubscribe!\"); } };\r\n        var intentName = typeof intent === \"string\" ? intent : intent.intent;\r\n        var methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intentName;\r\n        var methodDescription = typeof intent === \"string\" ? undefined : JSON.stringify(intent);\r\n        this.interop.register({ name: methodName, description: methodDescription }, function (args) {\r\n            return handler(args);\r\n        }).then(function () {\r\n            result.unsubscribe = function () {\r\n                _this.interop.unregister(methodName);\r\n            };\r\n        });\r\n        return result;\r\n    };\r\n    Intents.prototype.get = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1: return [2, (_a.sent()).find(function (registeredIntent) { return registeredIntent.name === intent; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.startApp = function (application, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.interop.invoke(\"T42.ACS.StartApplication\", { Name: application, options: options })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned.Id];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raiseIntentToInstance = function (instanceId, intent, context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodName, interopServer, method, result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intent;\r\n                        interopServer = this.interop.servers().find(function (server) { return server.instance === instanceId; });\r\n                        if (!!interopServer) return [3, 2];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.serverAdded(function (server) {\r\n                                    if (server.instance === instanceId) {\r\n                                        interopServer = server;\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop server for instance \" + instanceId));\r\n                                }, 30 * 1000);\r\n                            }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        method = interopServer.getMethods().find(function (registeredMethod) { return registeredMethod.name === methodName; });\r\n                        if (!!method) return [3, 4];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.methodAdded(function (addedMethod) {\r\n                                    if (addedMethod.name === methodName) {\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop method \" + methodName + \" for instance \" + instanceId));\r\n                                }, 10 * 1000);\r\n                            }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [4, this.interop.invoke(methodName, context, { instance: instanceId })];\r\n                    case 5:\r\n                        result = _a.sent();\r\n                        return [2, {\r\n                                result: result.returned\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Intents;\r\n}());\n\nvar instances = [];\r\nvar factory$3 = function (options) { return __awaiter(void 0, void 0, void 0, function () {\r\n    function createWindows(core) {\r\n        if (glueConfig.windows) {\r\n            var windowsLogger = getLibLogger(\"windows\", core.logger, glueConfig.windows);\r\n            _windows = WindowsFactory(core.agm, windowsLogger, function () {\r\n                return _appManager;\r\n            }, gdMajorVersion);\r\n            debugLog(_windows);\r\n            return _windows;\r\n        }\r\n    }\r\n    function createActivities(core) {\r\n        var _a, _b;\r\n        if (glueConfig.activities) {\r\n            if (ActivityModule.checkIsUsingGW3Implementation && ActivityModule.checkIsUsingGW3Implementation(core.connection)) {\r\n                var activityLogger = getLibLogger(\"activity\", core.logger, glueConfig.activities);\r\n                _activity = new ActivityModule({\r\n                    connection: core.connection,\r\n                    contexts: core.contexts,\r\n                    agm: core.agm,\r\n                    logger: activityLogger,\r\n                    logLevel: \"info\",\r\n                    disableAutoAnnounce: false,\r\n                    disposeRequestHandling: \"exit\",\r\n                    announcementInfo: null,\r\n                    windows: _windows,\r\n                    appManagerGetter: function () {\r\n                        return _appManager;\r\n                    },\r\n                    mode: glueConfig.activities.mode,\r\n                    typesToTrack: glueConfig.activities.typesToTrack,\r\n                    activityId: (_b = (_a = glue42gd) === null || _a === void 0 ? void 0 : _a.activityInfo) === null || _b === void 0 ? void 0 : _b.activityId,\r\n                    gdMajorVersion: gdMajorVersion\r\n                }).api;\r\n                debugLog(_activity);\r\n                return _activity;\r\n            }\r\n        }\r\n    }\r\n    function createAppManager(core) {\r\n        if (!glueConfig.appManager) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"appManager\", core.logger, glueConfig.appManager);\r\n        _appManager = AppManagerFactory({\r\n            agm: core.agm,\r\n            windows: _windows,\r\n            logger: logger,\r\n            activities: _activity,\r\n            mode: glueConfig.appManager.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(_appManager);\r\n        return _appManager;\r\n    }\r\n    function createLayouts(core) {\r\n        var _a;\r\n        if (!glueConfig.layouts) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"layouts\", core.logger, glueConfig.layouts);\r\n        var layoutsConfig = glueConfig.layouts;\r\n        var lay = LayoutsFactory({\r\n            agm: core.agm,\r\n            appManager: _appManager,\r\n            activityGetter: function () { return _activity; },\r\n            logger: logger,\r\n            mode: layoutsConfig.mode,\r\n            autoSaveWindowContext: (_a = layoutsConfig.autoSaveWindowContext, (_a !== null && _a !== void 0 ? _a : false)),\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(lay);\r\n        return lay;\r\n    }\r\n    function createChannels(core) {\r\n        if (!glueConfig.channels) {\r\n            return;\r\n        }\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var channelsAPI = factory(core.contexts, core.agm);\r\n        debugLog(channelsAPI);\r\n        return channelsAPI;\r\n    }\r\n    function createHotkeys(core) {\r\n        var hotkeysAPI = factory$1(core.agm);\r\n        debugLog(hotkeysAPI);\r\n        return hotkeysAPI;\r\n    }\r\n    function createIntents(core) {\r\n        var intentsAPI = new Intents(core.agm, _windows, core.logger.subLogger(\"intents\"));\r\n        debugLog(intentsAPI);\r\n        return intentsAPI;\r\n    }\r\n    function createNotifications(core) {\r\n        var notificationsAPI = new Notifications(core.interop);\r\n        debugLog(notificationsAPI);\r\n        return notificationsAPI;\r\n    }\r\n    function createDisplaysApi(core) {\r\n        if (glueConfig.displays) {\r\n            var displaysLogger = getLibLogger(\"displays\", core.logger, glueConfig.displays);\r\n            _displays = new DisplayManager(core.agm, displaysLogger);\r\n            debugLog(_displays);\r\n            return _displays;\r\n        }\r\n    }\r\n    function createThemes(core) {\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var themesAPI = factory$2(core);\r\n        debugLog(themesAPI);\r\n        return themesAPI;\r\n    }\r\n    function getLibLogger(loggerName, logger, config) {\r\n        var newLogger = logger.subLogger(loggerName);\r\n        if (config && config.logger) {\r\n            var loggerConfig = config.logger;\r\n            if (loggerConfig.console) {\r\n                newLogger.consoleLevel(loggerConfig.console);\r\n            }\r\n            if (loggerConfig.publish) {\r\n                newLogger.publishLevel(loggerConfig.publish);\r\n            }\r\n        }\r\n        return newLogger;\r\n    }\r\n    function debugLog(entry) {\r\n        currentLog.push(entry);\r\n    }\r\n    var glue42gd, gdMajorVersion, glueConfig, _appManager, _activity, _windows, _displays, ext, currentLog, glueApi;\r\n    var _a;\r\n    return __generator(this, function (_b) {\r\n        switch (_b.label) {\r\n            case 0:\r\n                glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n                if (glue42gd) {\r\n                    if (instances.length > 0) {\r\n                        return [2, instances[0]];\r\n                    }\r\n                }\r\n                gdMajorVersion = Utils$1.getGDMajorVersion();\r\n                options = options || {};\r\n                glueConfig = prepareConfig$1(options);\r\n                options.gateway = options.gateway || {};\r\n                ext = {\r\n                    libs: [\r\n                        { name: \"windows\", create: createWindows },\r\n                        { name: \"activities\", create: createActivities },\r\n                        { name: \"appManager\", create: createAppManager },\r\n                        { name: \"layouts\", create: createLayouts },\r\n                        { name: \"channels\", create: createChannels },\r\n                        { name: \"hotkeys\", create: createHotkeys },\r\n                        { name: \"displays\", create: createDisplaysApi },\r\n                        { name: \"intents\", create: createIntents },\r\n                        { name: \"notifications\", create: createNotifications },\r\n                        { name: \"themes\", create: createThemes }\r\n                    ],\r\n                    version: version$2,\r\n                    enrichGlue: function (glue) {\r\n                        glue.config.activities = glueConfig.activities;\r\n                        glue.config.windows = glueConfig.windows;\r\n                        glue.config.appManager = glueConfig.appManager;\r\n                        glue.config.layouts = glueConfig.layouts;\r\n                        glue.config.channels = glueConfig.channels;\r\n                        glue.config.displays = glueConfig.displays;\r\n                    },\r\n                };\r\n                currentLog = [];\r\n                if (typeof window !== \"undefined\") {\r\n                    if (!window.glueFactoryLog) {\r\n                        window.glueFactoryLog = [];\r\n                    }\r\n                    window.glueFactoryLog.push(currentLog);\r\n                }\r\n                return [4, GlueCore(options, ext)];\r\n            case 1:\r\n                glueApi = (_b.sent());\r\n                instances.push(glueApi);\r\n                if (!(Array.isArray((_a = options) === null || _a === void 0 ? void 0 : _a.libraries) && options.libraries.length)) return [3, 3];\r\n                return [4, Promise.all(options.libraries.map(function (lib) { return lib(glueApi, options); }))];\r\n            case 2:\r\n                _b.sent();\r\n                _b.label = 3;\r\n            case 3: return [2, glueApi];\r\n        }\r\n    });\r\n}); };\r\nfactory$3.coreVersion = GlueCore.version;\r\nfactory$3.version = version$2;\r\nfactory$3.instances = instances;\n\nvar whatToExpose = factory$3;\r\nvar shouldSetToWindow = true;\r\nif (typeof window !== \"undefined\") {\r\n    var glue42gd = window.glue42gd;\r\n    if (glue42gd && glue42gd.autoInjected) {\r\n        whatToExpose = window.Glue;\r\n        shouldSetToWindow = false;\r\n    }\r\n    if (shouldSetToWindow) {\r\n        window.Glue = whatToExpose;\r\n    }\r\n    delete window.GlueCore;\r\n}\r\nwhatToExpose.default = whatToExpose;\r\nvar whatToExpose$1 = whatToExpose;\n\nexport default whatToExpose$1;\n//# sourceMappingURL=desktop.es.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar version = \"1.6.7\";\n\nfunction createCommonjsModule(fn, basedir, module) {\n\treturn module = {\n\t  path: basedir,\n\t  exports: {},\n\t  require: function (path, base) {\n      return commonjsRequire(path, (base === undefined || base === null) ? module.path : base);\n    }\n\t}, fn(module, module.exports), module.exports;\n}\n\nfunction commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nvar alphabet_1 = {\n    get: get,\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nvar randomByteBrowser = randomByte;\n\n// This file replaces `format.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\nvar format_browser = function (random, alphabet, size) {\n  // We can’t use bytes bigger than the alphabet. To make bytes values closer\n  // to the alphabet, we apply bitmask on them. We look for the closest\n  // `2 ** x - 1` number, which will be bigger than alphabet size. If we have\n  // 30 symbols in the alphabet, we will take 31 (00011111).\n  // We do not use faster Math.clz32, because it is not available in browsers.\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1;\n  // Bitmask is not a perfect solution (in our example it will pass 31 bytes,\n  // which is bigger than the alphabet). As a result, we will need more bytes,\n  // than ID size, because we will refuse bytes bigger than the alphabet.\n\n  // Every hardware random generator call is costly,\n  // because we need to wait for entropy collection. This is why often it will\n  // be faster to ask for few extra bytes in advance, to avoid additional calls.\n\n  // Here we calculate how many random bytes should we call in advance.\n  // It depends on ID length, mask / alphabet size and magic number 1.6\n  // (which was selected according benchmarks).\n\n  // -~f => Math.ceil(f) if n is float number\n  // -~i => i + 1 if n is integer number\n  var step = -~(1.6 * mask * size / alphabet.length);\n  var id = '';\n\n  while (true) {\n    var bytes = random(step);\n    // Compact alternative for `for (var i = 0; i < step; i++)`\n    var i = step;\n    while (i--) {\n      // If random byte is bigger than alphabet even after bitmask,\n      // we refuse it by `|| ''`.\n      id += alphabet[bytes[i] & mask] || '';\n      // More compact than `id.length + 1 === size`\n      if (id.length === +size) return id\n    }\n  }\n};\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format_browser(randomByteBrowser, alphabet_1.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar generate_1 = generate;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1567752802062;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 7;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate_1(version$1);\n    str = str + generate_1(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate_1(counter);\n    }\n    str = str + generate_1(seconds);\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet_1.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nvar isValid = isShortId;\n\nvar lib = createCommonjsModule(function (module) {\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n});\n\nvar shortid = lib;\n\nvar RemoteWebWindow = (function () {\r\n    function RemoteWebWindow(id, name, control, windows) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.control = control;\r\n        this.windows = windows;\r\n    }\r\n    RemoteWebWindow.prototype.getURL = function () {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, this.callControl(\"getURL\", {})];\r\n                    case 1:\r\n                        result = _b.sent();\r\n                        return [2, (_a = result === null || result === void 0 ? void 0 : result.returned) === null || _a === void 0 ? void 0 : _a._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveResize = function (bounds) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", bounds, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                return [2, new Promise(function (resolve, reject) {\r\n                        var done = function () {\r\n                            if (timeout) {\r\n                                clearTimeout(timeout);\r\n                            }\r\n                            if (un) {\r\n                                un();\r\n                            }\r\n                        };\r\n                        var un = _this.windows.onWindowRemoved(function (w) {\r\n                            if (w.id === _this.id) {\r\n                                resolve(_this);\r\n                                done();\r\n                            }\r\n                        });\r\n                        var timeout = setTimeout(function () {\r\n                            reject(\"can not close window - probably not opened by your window\");\r\n                            done();\r\n                        }, 5000);\r\n                        _this.callControl(\"close\", {}, true)\r\n                            .catch(function () {\r\n                        });\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof title === \"string\") {\r\n                            title = { title: title };\r\n                        }\r\n                        return [4, this.callControl(\"setTitle\", title, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { width: width, height: height }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { top: top, left: left }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"focus\", {}, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getBounds\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getContext\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getTitle\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.onContextUpdated = function (callback) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    RemoteWebWindow.prototype.updateContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"updateContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"setContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.control.send({ command: command, domain: \"windows\", args: args, skipResult: skipResult }, { windowId: this.id })];\r\n                    case 1: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return RemoteWebWindow;\r\n}());\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib$1 = createRegistry;\n\nvar Control = (function () {\r\n    function Control() {\r\n        this.callbacks = {};\r\n        this.registry = lib$1();\r\n    }\r\n    Control.prototype.start = function (interop, logger) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.interop = interop;\r\n                        this.logger = logger;\r\n                        return [4, this.interop.register(Control.CONTROL_METHOD, function (arg) { return __awaiter(_this, void 0, void 0, function () {\r\n                                var command, result, result, callback;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0:\r\n                                            command = arg;\r\n                                            logger.trace(\"received control command \" + JSON.stringify(command));\r\n                                            if (!(command.domain === \"windows\")) return [3, 2];\r\n                                            if (!this.myWindow) {\r\n                                                return [2];\r\n                                            }\r\n                                            return [4, this.myWindow[command.command].call(this.myWindow, command.args)];\r\n                                        case 1:\r\n                                            result = _a.sent();\r\n                                            if (command.skipResult) {\r\n                                                return [2, {}];\r\n                                            }\r\n                                            else {\r\n                                                return [2, result];\r\n                                            }\r\n                                        case 2:\r\n                                            if (!(command.domain === \"appManager\")) return [3, 4];\r\n                                            if (!this.myInstance) {\r\n                                                return [2];\r\n                                            }\r\n                                            return [4, this.myInstance[command.command].call(this.myInstance, command.args)];\r\n                                        case 3:\r\n                                            result = _a.sent();\r\n                                            if (command.skipResult) {\r\n                                                return [2, {}];\r\n                                            }\r\n                                            else {\r\n                                                return [2, result];\r\n                                            }\r\n                                        case 4:\r\n                                            if (command.domain === \"layouts\") {\r\n                                                callback = this.callbacks[command.domain];\r\n                                                if (callback) {\r\n                                                    callback(command);\r\n                                                }\r\n                                            }\r\n                                            return [2];\r\n                                    }\r\n                                });\r\n                            }); })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.registry.execute(\"started\");\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Control.prototype.send = function (command, target) {\r\n        if (!this.interop) {\r\n            throw new Error(\"Control not started\");\r\n        }\r\n        this.logger.info(\"sending control command \" + JSON.stringify(command) + \" to \" + JSON.stringify(target) + \"}\");\r\n        return this.interop.invoke(Control.CONTROL_METHOD, command, target);\r\n    };\r\n    Control.prototype.subscribe = function (domain, callback) {\r\n        this.callbacks[domain] = callback;\r\n    };\r\n    Control.prototype.setLocalWindow = function (window) {\r\n        this.myWindow = window;\r\n    };\r\n    Control.prototype.setLocalInstance = function (instance) {\r\n        this.myInstance = instance;\r\n    };\r\n    Control.prototype.onStart = function (callback) {\r\n        return this.registry.add(\"started\", callback);\r\n    };\r\n    Control.CONTROL_METHOD = \"GC.Control\";\r\n    return Control;\r\n}());\n\nvar LocalWebWindow = (function () {\r\n    function LocalWebWindow(id, name, window, control, interop) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.window = window;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this.context = {};\r\n        this.registry = lib$1();\r\n        control.setLocalWindow(this);\r\n    }\r\n    LocalWebWindow.prototype.getURL = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.location.href];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveResize = function (_a) {\r\n        var left = _a.left, top = _a.top, width = _a.width, height = _a.height;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_b) {\r\n                left = left !== null && left !== void 0 ? left : window.screenLeft;\r\n                top = top !== null && top !== void 0 ? top : window.screenTop;\r\n                width = width !== null && width !== void 0 ? width : window.outerWidth;\r\n                height = height !== null && height !== void 0 ? height : window.outerHeight;\r\n                window.moveTo(left, top);\r\n                window.resizeTo(width, height);\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.parent) {\r\n                    throw new Error(\"can not close window if it's not opened by script\");\r\n                }\r\n                try {\r\n                    window.close();\r\n                }\r\n                catch (_b) {\r\n                    console.log(\"what\");\r\n                }\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof title === \"object\" && title !== null) {\r\n                    title = title.title;\r\n                }\r\n                document.title = title;\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ width: width, height: height })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ top: top, left: left })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                window.focus();\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getBoundsSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getContextSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContextSync = function () {\r\n        return this.context;\r\n    };\r\n    LocalWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.document.title];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.onContextUpdated = function (callback) {\r\n        return this.registry.add(\"context-updated\", callback);\r\n    };\r\n    LocalWebWindow.prototype.updateContext = function (context) {\r\n        var oldContext = this.context;\r\n        this.context = Object.assign({}, oldContext, context);\r\n        this.registry.execute(\"context-updated\", this.context, oldContext);\r\n        return Promise.resolve(this);\r\n    };\r\n    LocalWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var oldContext;\r\n            return __generator(this, function (_a) {\r\n                oldContext = this.context;\r\n                this.context = Object.assign({}, context);\r\n                this.registry.execute(\"context-updated\", context, oldContext);\r\n                return [2, Promise.resolve(this)];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBoundsSync = function () {\r\n        return {\r\n            left: this.window.screenLeft,\r\n            top: this.window.screenTop,\r\n            width: this.window.outerWidth,\r\n            height: this.window.outerHeight\r\n        };\r\n    };\r\n    return LocalWebWindow;\r\n}());\n\nvar ChildWebWindow = (function (_super) {\r\n    __extends(ChildWebWindow, _super);\r\n    function ChildWebWindow(window, id, name, control, windows) {\r\n        var _this = _super.call(this, id, name, control, windows) || this;\r\n        _this.window = window;\r\n        _this.id = id;\r\n        _this.name = name;\r\n        return _this;\r\n    }\r\n    return ChildWebWindow;\r\n}(RemoteWebWindow));\n\nvar createMethodName = function (id) { return \"GC.Wnd.\" + id; };\r\nvar registerChildStartupContext = function (interop, parent, id, name, options) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var methodName, startingContext;\r\n    var _a;\r\n    return __generator(this, function (_b) {\r\n        switch (_b.label) {\r\n            case 0:\r\n                methodName = createMethodName(id);\r\n                startingContext = {\r\n                    context: (_a = options === null || options === void 0 ? void 0 : options.context) !== null && _a !== void 0 ? _a : {},\r\n                    name: name,\r\n                    parent: parent\r\n                };\r\n                return [4, interop.register(methodName, function () { return startingContext; })];\r\n            case 1:\r\n                _b.sent();\r\n                return [2];\r\n        }\r\n    });\r\n}); };\r\nvar initStartupContext = function (my, interop, instance) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var methodName, result, context_1;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                methodName = createMethodName(my.id);\r\n                if (!interop.methods().find(function (m) { return m.name === methodName; })) return [3, 2];\r\n                return [4, interop.invoke(methodName)];\r\n            case 1:\r\n                result = _a.sent();\r\n                if (my) {\r\n                    context_1 = result.returned.context;\r\n                    my.setContext(context_1);\r\n                    my.name = result.returned.name;\r\n                    my.parent = result.returned.parent;\r\n                    if (instance) {\r\n                        instance.startedByScript = true;\r\n                        instance.context = context_1;\r\n                    }\r\n                }\r\n                _a.label = 2;\r\n            case 2: return [2];\r\n        }\r\n    });\r\n}); };\n\nvar Windows = (function () {\r\n    function Windows(interop, control) {\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.registry = lib$1();\r\n        this.childWindows = [];\r\n        var id = interop.instance.windowId;\r\n        var name = \"document.title (\" + shortid() + \")\";\r\n        this.myWindow = new LocalWebWindow(id, name, window, this.control, this.interop);\r\n        this.trackWindowsLifetime();\r\n    }\r\n    Windows.prototype.list = function () {\r\n        var _this = this;\r\n        var method = this.interop.methods({ name: Control.CONTROL_METHOD })[0];\r\n        if (!method) {\r\n            return [];\r\n        }\r\n        var servers = method.getServers ? method.getServers() : [];\r\n        return servers.reduce(function (prev, current) {\r\n            var remoteWindow = _this.remoteFromServer(current);\r\n            if (remoteWindow) {\r\n                prev.push(remoteWindow);\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Windows.prototype.findById = function (id) {\r\n        return this.list().find(function (w) { return w.id === id; });\r\n    };\r\n    Windows.prototype.my = function () {\r\n        return this.myWindow;\r\n    };\r\n    Windows.prototype.open = function (name, url, options) {\r\n        var _a, _b, _c, _d, _e;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var width, height, left, top, id, relativeWindowId_1, relativeWindow, relativeWindowBounds, relativeDir, newBounds, optionsString, newWindow, remoteWindow;\r\n            return __generator(this, function (_f) {\r\n                switch (_f.label) {\r\n                    case 0:\r\n                        width = (_a = options === null || options === void 0 ? void 0 : options.width) !== null && _a !== void 0 ? _a : 400;\r\n                        height = (_b = options === null || options === void 0 ? void 0 : options.height) !== null && _b !== void 0 ? _b : 400;\r\n                        left = (_c = options === null || options === void 0 ? void 0 : options.left) !== null && _c !== void 0 ? _c : window.screen.availWidth - window.screenLeft;\r\n                        top = (_d = options === null || options === void 0 ? void 0 : options.top) !== null && _d !== void 0 ? _d : 0;\r\n                        id = shortid();\r\n                        return [4, registerChildStartupContext(this.interop, this.my().id, id, name, options)];\r\n                    case 1:\r\n                        _f.sent();\r\n                        if (!(options === null || options === void 0 ? void 0 : options.relativeTo)) return [3, 3];\r\n                        relativeWindowId_1 = options.relativeTo;\r\n                        relativeWindow = this.list().find(function (w) { return w.id === relativeWindowId_1; });\r\n                        if (!relativeWindow) return [3, 3];\r\n                        return [4, relativeWindow.getBounds()];\r\n                    case 2:\r\n                        relativeWindowBounds = _f.sent();\r\n                        relativeDir = (_e = options.relativeDirection) !== null && _e !== void 0 ? _e : \"right\";\r\n                        newBounds = this.getRelativeBounds({ width: width, height: height, left: left, top: top }, relativeWindowBounds, relativeDir);\r\n                        width = newBounds.width;\r\n                        height = newBounds.height;\r\n                        left = newBounds.left;\r\n                        top = newBounds.top;\r\n                        _f.label = 3;\r\n                    case 3:\r\n                        optionsString = \"width=\" + width + \",height=\" + height + \",left=\" + left + \",top=\" + top + \",scrollbars=none,location=no,status=no,menubar=no\";\r\n                        newWindow = window.open(url, id, optionsString);\r\n                        if (!newWindow) {\r\n                            throw new Error(\"failed to open a window with url=\" + url + \" and options=\" + optionsString);\r\n                        }\r\n                        newWindow.focus();\r\n                        newWindow.moveTo(left, top);\r\n                        newWindow.resizeTo(width, height);\r\n                        remoteWindow = new ChildWebWindow(newWindow, id, name, this.control, this);\r\n                        this.childWindows.push(remoteWindow);\r\n                        return [2, remoteWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Windows.prototype.onWindowAdded = function (callback) {\r\n        return this.registry.add(\"window-added\", callback);\r\n    };\r\n    Windows.prototype.onWindowRemoved = function (callback) {\r\n        return this.registry.add(\"window-removed\", callback);\r\n    };\r\n    Windows.prototype.getChildWindows = function () {\r\n        this.childWindows = this.childWindows.filter(function (cw) { return !cw.window.closed; });\r\n        return this.childWindows;\r\n    };\r\n    Windows.prototype.remoteFromServer = function (server) {\r\n        var _a;\r\n        if (!server.windowId) {\r\n            return undefined;\r\n        }\r\n        return new RemoteWebWindow(server.windowId, (_a = server.application) !== null && _a !== void 0 ? _a : \"\", this.control, this);\r\n    };\r\n    Windows.prototype.getRelativeBounds = function (rect, relativeTo, relativeDirection) {\r\n        var edgeDistance = 0;\r\n        switch (relativeDirection) {\r\n            case \"bottom\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top + relativeTo.height + edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"top\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top - rect.height - edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"right\":\r\n                return {\r\n                    left: relativeTo.left + relativeTo.width + edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n            case \"left\":\r\n                return {\r\n                    left: relativeTo.left - rect.width - edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n            default:\r\n                throw new Error(\"invalid relativeDirection\");\r\n        }\r\n    };\r\n    Windows.prototype.trackWindowsLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            if (method.name !== Control.CONTROL_METHOD) {\r\n                return;\r\n            }\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-added\", remoteWindow);\r\n            }\r\n        });\r\n        this.interop.serverRemoved(function (server) {\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-removed\", remoteWindow);\r\n            }\r\n        });\r\n    };\r\n    return Windows;\r\n}());\n\n/**\r\n * Wraps values in an `Ok` type.\r\n *\r\n * Example: `ok(5) // => {ok: true, result: 5}`\r\n */\r\nvar ok = function (result) { return ({ ok: true, result: result }); };\r\n/**\r\n * Typeguard for `Ok`.\r\n */\r\nvar isOk = function (r) { return r.ok === true; };\r\n/**\r\n * Wraps errors in an `Err` type.\r\n *\r\n * Example: `err('on fire') // => {ok: false, error: 'on fire'}`\r\n */\r\nvar err = function (error) { return ({ ok: false, error: error }); };\r\n/**\r\n * Typeguard for `Err`.\r\n */\r\nvar isErr = function (r) { return r.ok === false; };\r\n/**\r\n * Create a `Promise` that either resolves with the result of `Ok` or rejects\r\n * with the error of `Err`.\r\n */\r\nvar asPromise = function (r) {\r\n    return r.ok === true ? Promise.resolve(r.result) : Promise.reject(r.error);\r\n};\r\n/**\r\n * Unwraps a `Result` and returns either the result of an `Ok`, or\r\n * `defaultValue`.\r\n *\r\n * Example:\r\n * ```\r\n * Result.withDefault(5, number().run(json))\r\n * ```\r\n *\r\n * It would be nice if `Decoder` had an instance method that mirrored this\r\n * function. Such a method would look something like this:\r\n * ```\r\n * class Decoder<A> {\r\n *   runWithDefault = (defaultValue: A, json: any): A =>\r\n *     Result.withDefault(defaultValue, this.run(json));\r\n * }\r\n *\r\n * number().runWithDefault(5, json)\r\n * ```\r\n * Unfortunately, the type of `defaultValue: A` on the method causes issues\r\n * with type inference on  the `object` decoder in some situations. While these\r\n * inference issues can be solved by providing the optional type argument for\r\n * `object`s, the extra trouble and confusion doesn't seem worth it.\r\n */\r\nvar withDefault = function (defaultValue, r) {\r\n    return r.ok === true ? r.result : defaultValue;\r\n};\r\n/**\r\n * Return the successful result, or throw an error.\r\n */\r\nvar withException = function (r) {\r\n    if (r.ok === true) {\r\n        return r.result;\r\n    }\r\n    else {\r\n        throw r.error;\r\n    }\r\n};\r\n/**\r\n * Given an array of `Result`s, return the successful values.\r\n */\r\nvar successes = function (results) {\r\n    return results.reduce(function (acc, r) { return (r.ok === true ? acc.concat(r.result) : acc); }, []);\r\n};\r\n/**\r\n * Apply `f` to the result of an `Ok`, or pass the error through.\r\n */\r\nvar map = function (f, r) {\r\n    return r.ok === true ? ok(f(r.result)) : r;\r\n};\r\n/**\r\n * Apply `f` to the result of two `Ok`s, or pass an error through. If both\r\n * `Result`s are errors then the first one is returned.\r\n */\r\nvar map2 = function (f, ar, br) {\r\n    return ar.ok === false ? ar :\r\n        br.ok === false ? br :\r\n            ok(f(ar.result, br.result));\r\n};\r\n/**\r\n * Apply `f` to the error of an `Err`, or pass the success through.\r\n */\r\nvar mapError = function (f, r) {\r\n    return r.ok === true ? r : err(f(r.error));\r\n};\r\n/**\r\n * Chain together a sequence of computations that may fail, similar to a\r\n * `Promise`. If the first computation fails then the error will propagate\r\n * through. If it succeeds, then `f` will be applied to the value, returning a\r\n * new `Result`.\r\n */\r\nvar andThen = function (f, r) {\r\n    return r.ok === true ? f(r.result) : r;\r\n};\r\n\n\nvar result = Object.freeze({\n\tok: ok,\n\tisOk: isOk,\n\terr: err,\n\tisErr: isErr,\n\tasPromise: asPromise,\n\twithDefault: withDefault,\n\twithException: withException,\n\tsuccesses: successes,\n\tmap: map,\n\tmap2: map2,\n\tmapError: mapError,\n\tandThen: andThen\n});\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction isEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a === null && b === null) {\r\n        return true;\r\n    }\r\n    if (typeof (a) !== typeof (b)) {\r\n        return false;\r\n    }\r\n    if (typeof (a) === 'object') {\r\n        // Array\r\n        if (Array.isArray(a)) {\r\n            if (!Array.isArray(b)) {\r\n                return false;\r\n            }\r\n            if (a.length !== b.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (!isEqual(a[i], b[i])) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        // Hash table\r\n        var keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!b.hasOwnProperty(keys[i])) {\r\n                return false;\r\n            }\r\n            if (!isEqual(a[keys[i]], b[keys[i]])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n/*\r\n * Helpers\r\n */\r\nvar isJsonArray = function (json) { return Array.isArray(json); };\r\nvar isJsonObject = function (json) {\r\n    return typeof json === 'object' && json !== null && !isJsonArray(json);\r\n};\r\nvar typeString = function (json) {\r\n    switch (typeof json) {\r\n        case 'string':\r\n            return 'a string';\r\n        case 'number':\r\n            return 'a number';\r\n        case 'boolean':\r\n            return 'a boolean';\r\n        case 'undefined':\r\n            return 'undefined';\r\n        case 'object':\r\n            if (json instanceof Array) {\r\n                return 'an array';\r\n            }\r\n            else if (json === null) {\r\n                return 'null';\r\n            }\r\n            else {\r\n                return 'an object';\r\n            }\r\n        default:\r\n            return JSON.stringify(json);\r\n    }\r\n};\r\nvar expectedGot = function (expected, got) {\r\n    return \"expected \" + expected + \", got \" + typeString(got);\r\n};\r\nvar printPath = function (paths) {\r\n    return paths.map(function (path) { return (typeof path === 'string' ? \".\" + path : \"[\" + path + \"]\"); }).join('');\r\n};\r\nvar prependAt = function (newAt, _a) {\r\n    var at = _a.at, rest = __rest(_a, [\"at\"]);\r\n    return (__assign$1({ at: newAt + (at || '') }, rest));\r\n};\r\n/**\r\n * Decoders transform json objects with unknown structure into known and\r\n * verified forms. You can create objects of type `Decoder<A>` with either the\r\n * primitive decoder functions, such as `boolean()` and `string()`, or by\r\n * applying higher-order decoders to the primitives, such as `array(boolean())`\r\n * or `dict(string())`.\r\n *\r\n * Each of the decoder functions are available both as a static method on\r\n * `Decoder` and as a function alias -- for example the string decoder is\r\n * defined at `Decoder.string()`, but is also aliased to `string()`. Using the\r\n * function aliases exported with the library is recommended.\r\n *\r\n * `Decoder` exposes a number of 'run' methods, which all decode json in the\r\n * same way, but communicate success and failure in different ways. The `map`\r\n * and `andThen` methods modify decoders without having to call a 'run' method.\r\n *\r\n * Alternatively, the main decoder `run()` method returns an object of type\r\n * `Result<A, DecoderError>`. This library provides a number of helper\r\n * functions for dealing with the `Result` type, so you can do all the same\r\n * things with a `Result` as with the decoder methods.\r\n */\r\nvar Decoder = /** @class */ (function () {\r\n    /**\r\n     * The Decoder class constructor is kept private to separate the internal\r\n     * `decode` function from the external `run` function. The distinction\r\n     * between the two functions is that `decode` returns a\r\n     * `Partial<DecoderError>` on failure, which contains an unfinished error\r\n     * report. When `run` is called on a decoder, the relevant series of `decode`\r\n     * calls is made, and then on failure the resulting `Partial<DecoderError>`\r\n     * is turned into a `DecoderError` by filling in the missing information.\r\n     *\r\n     * While hiding the constructor may seem restrictive, leveraging the\r\n     * provided decoder combinators and helper functions such as\r\n     * `andThen` and `map` should be enough to build specialized decoders as\r\n     * needed.\r\n     */\r\n    function Decoder(decode) {\r\n        var _this = this;\r\n        this.decode = decode;\r\n        /**\r\n         * Run the decoder and return a `Result` with either the decoded value or a\r\n         * `DecoderError` containing the json input, the location of the error, and\r\n         * the error message.\r\n         *\r\n         * Examples:\r\n         * ```\r\n         * number().run(12)\r\n         * // => {ok: true, result: 12}\r\n         *\r\n         * string().run(9001)\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {\r\n         * //     kind: 'DecoderError',\r\n         * //     input: 9001,\r\n         * //     at: 'input',\r\n         * //     message: 'expected a string, got 9001'\r\n         * //   }\r\n         * // }\r\n         * ```\r\n         */\r\n        this.run = function (json) {\r\n            return mapError(function (error) { return ({\r\n                kind: 'DecoderError',\r\n                input: json,\r\n                at: 'input' + (error.at || ''),\r\n                message: error.message || ''\r\n            }); }, _this.decode(json));\r\n        };\r\n        /**\r\n         * Run the decoder as a `Promise`.\r\n         */\r\n        this.runPromise = function (json) { return asPromise(_this.run(json)); };\r\n        /**\r\n         * Run the decoder and return the value on success, or throw an exception\r\n         * with a formatted error string.\r\n         */\r\n        this.runWithException = function (json) { return withException(_this.run(json)); };\r\n        /**\r\n         * Construct a new decoder that applies a transformation to the decoded\r\n         * result. If the decoder succeeds then `f` will be applied to the value. If\r\n         * it fails the error will propagated through.\r\n         *\r\n         * Example:\r\n         * ```\r\n         * number().map(x => x * 5).run(10)\r\n         * // => {ok: true, result: 50}\r\n         * ```\r\n         */\r\n        this.map = function (f) {\r\n            return new Decoder(function (json) { return map(f, _this.decode(json)); });\r\n        };\r\n        /**\r\n         * Chain together a sequence of decoders. The first decoder will run, and\r\n         * then the function will determine what decoder to run second. If the result\r\n         * of the first decoder succeeds then `f` will be applied to the decoded\r\n         * value. If it fails the error will propagate through.\r\n         *\r\n         * This is a very powerful method -- it can act as both the `map` and `where`\r\n         * methods, can improve error messages for edge cases, and can be used to\r\n         * make a decoder for custom types.\r\n         *\r\n         * Example of adding an error message:\r\n         * ```\r\n         * const versionDecoder = valueAt(['version'], number());\r\n         * const infoDecoder3 = object({a: boolean()});\r\n         *\r\n         * const decoder = versionDecoder.andThen(version => {\r\n         *   switch (version) {\r\n         *     case 3:\r\n         *       return infoDecoder3;\r\n         *     default:\r\n         *       return fail(`Unable to decode info, version ${version} is not supported.`);\r\n         *   }\r\n         * });\r\n         *\r\n         * decoder.run({version: 3, a: true})\r\n         * // => {ok: true, result: {a: true}}\r\n         *\r\n         * decoder.run({version: 5, x: 'abc'})\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {... message: 'Unable to decode info, version 5 is not supported.'}\r\n         * // }\r\n         * ```\r\n         *\r\n         * Example of decoding a custom type:\r\n         * ```\r\n         * // nominal type for arrays with a length of at least one\r\n         * type NonEmptyArray<T> = T[] & { __nonEmptyArrayBrand__: void };\r\n         *\r\n         * const nonEmptyArrayDecoder = <T>(values: Decoder<T>): Decoder<NonEmptyArray<T>> =>\r\n         *   array(values).andThen(arr =>\r\n         *     arr.length > 0\r\n         *       ? succeed(createNonEmptyArray(arr))\r\n         *       : fail(`expected a non-empty array, got an empty array`)\r\n         *   );\r\n         * ```\r\n         */\r\n        this.andThen = function (f) {\r\n            return new Decoder(function (json) {\r\n                return andThen(function (value) { return f(value).decode(json); }, _this.decode(json));\r\n            });\r\n        };\r\n        /**\r\n         * Add constraints to a decoder _without_ changing the resulting type. The\r\n         * `test` argument is a predicate function which returns true for valid\r\n         * inputs. When `test` fails on an input, the decoder fails with the given\r\n         * `errorMessage`.\r\n         *\r\n         * ```\r\n         * const chars = (length: number): Decoder<string> =>\r\n         *   string().where(\r\n         *     (s: string) => s.length === length,\r\n         *     `expected a string of length ${length}`\r\n         *   );\r\n         *\r\n         * chars(5).run('12345')\r\n         * // => {ok: true, result: '12345'}\r\n         *\r\n         * chars(2).run('HELLO')\r\n         * // => {ok: false, error: {... message: 'expected a string of length 2'}}\r\n         *\r\n         * chars(12).run(true)\r\n         * // => {ok: false, error: {... message: 'expected a string, got a boolean'}}\r\n         * ```\r\n         */\r\n        this.where = function (test, errorMessage) {\r\n            return _this.andThen(function (value) { return (test(value) ? Decoder.succeed(value) : Decoder.fail(errorMessage)); });\r\n        };\r\n    }\r\n    /**\r\n     * Decoder primitive that validates strings, and fails on all other input.\r\n     */\r\n    Decoder.string = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'string'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a string', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates numbers, and fails on all other input.\r\n     */\r\n    Decoder.number = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'number'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a number', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates booleans, and fails on all other input.\r\n     */\r\n    Decoder.boolean = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'boolean'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a boolean', json) });\r\n        });\r\n    };\r\n    Decoder.constant = function (value) {\r\n        return new Decoder(function (json) {\r\n            return isEqual(json, value)\r\n                ? ok(value)\r\n                : err({ message: \"expected \" + JSON.stringify(value) + \", got \" + JSON.stringify(json) });\r\n        });\r\n    };\r\n    Decoder.object = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json) && decoders) {\r\n                var obj = {};\r\n                for (var key in decoders) {\r\n                    if (decoders.hasOwnProperty(key)) {\r\n                        var r = decoders[key].decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            // tslint:disable-next-line:strict-type-predicates\r\n                            if (r.result !== undefined) {\r\n                                obj[key] = r.result;\r\n                            }\r\n                        }\r\n                        else if (json[key] === undefined) {\r\n                            return err({ message: \"the key '\" + key + \"' is required but was not present\" });\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else if (isJsonObject(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.array = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json) && decoder) {\r\n                var decodeValue_1 = function (v, i) {\r\n                    return mapError(function (err$$1) { return prependAt(\"[\" + i + \"]\", err$$1); }, decoder.decode(v));\r\n                };\r\n                return json.reduce(function (acc, v, i) {\r\n                    return map2(function (arr, result) { return arr.concat([result]); }, acc, decodeValue_1(v, i));\r\n                }, ok([]));\r\n            }\r\n            else if (isJsonArray(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an array', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.tuple = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json)) {\r\n                if (json.length !== decoders.length) {\r\n                    return err({\r\n                        message: \"expected a tuple of length \" + decoders.length + \", got one of length \" + json.length\r\n                    });\r\n                }\r\n                var result = [];\r\n                for (var i = 0; i < decoders.length; i++) {\r\n                    var nth = decoders[i].decode(json[i]);\r\n                    if (nth.ok) {\r\n                        result[i] = nth.result;\r\n                    }\r\n                    else {\r\n                        return err(prependAt(\"[\" + i + \"]\", nth.error));\r\n                    }\r\n                }\r\n                return ok(result);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot(\"a tuple of length \" + decoders.length, json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.union = function (ad, bd) {\r\n        var decoders = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            decoders[_i - 2] = arguments[_i];\r\n        }\r\n        return Decoder.oneOf.apply(Decoder, [ad, bd].concat(decoders));\r\n    };\r\n    Decoder.intersection = function (ad, bd) {\r\n        var ds = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            ds[_i - 2] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            return [ad, bd].concat(ds).reduce(function (acc, decoder) { return map2(Object.assign, acc, decoder.decode(json)); }, ok({}));\r\n        });\r\n    };\r\n    /**\r\n     * Escape hatch to bypass validation. Always succeeds and types the result as\r\n     * `any`. Useful for defining decoders incrementally, particularly for\r\n     * complex objects.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   name: string;\r\n     *   complexUserData: ComplexType;\r\n     * }\r\n     *\r\n     * const userDecoder: Decoder<User> = object({\r\n     *   name: string(),\r\n     *   complexUserData: anyJson()\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.anyJson = function () { return new Decoder(function (json) { return ok(json); }); };\r\n    /**\r\n     * Decoder identity function which always succeeds and types the result as\r\n     * `unknown`.\r\n     */\r\n    Decoder.unknownJson = function () {\r\n        return new Decoder(function (json) { return ok(json); });\r\n    };\r\n    /**\r\n     * Decoder for json objects where the keys are unknown strings, but the values\r\n     * should all be of the same type.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * dict(number()).run({chocolate: 12, vanilla: 10, mint: 37});\r\n     * // => {ok: true, result: {chocolate: 12, vanilla: 10, mint: 37}}\r\n     * ```\r\n     */\r\n    Decoder.dict = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json)) {\r\n                var obj = {};\r\n                for (var key in json) {\r\n                    if (json.hasOwnProperty(key)) {\r\n                        var r = decoder.decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            obj[key] = r.result;\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Decoder for values that may be `undefined`. This is primarily helpful for\r\n     * decoding interfaces with optional fields.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   id: number;\r\n     *   isOwner?: boolean;\r\n     * }\r\n     *\r\n     * const decoder: Decoder<User> = object({\r\n     *   id: number(),\r\n     *   isOwner: optional(boolean())\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.optional = function (decoder) {\r\n        return new Decoder(function (json) { return (json === undefined ? ok(undefined) : decoder.decode(json)); });\r\n    };\r\n    /**\r\n     * Decoder that attempts to run each decoder in `decoders` and either succeeds\r\n     * with the first successful decoder, or fails after all decoders have failed.\r\n     *\r\n     * Note that `oneOf` expects the decoders to all have the same return type,\r\n     * while `union` creates a decoder for the union type of all the input\r\n     * decoders.\r\n     *\r\n     * Examples:\r\n     * ```\r\n     * oneOf(string(), number().map(String))\r\n     * oneOf(constant('start'), constant('stop'), succeed('unknown'))\r\n     * ```\r\n     */\r\n    Decoder.oneOf = function () {\r\n        var decoders = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            decoders[_i] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            var errors = [];\r\n            for (var i = 0; i < decoders.length; i++) {\r\n                var r = decoders[i].decode(json);\r\n                if (r.ok === true) {\r\n                    return r;\r\n                }\r\n                else {\r\n                    errors[i] = r.error;\r\n                }\r\n            }\r\n            var errorsList = errors\r\n                .map(function (error) { return \"at error\" + (error.at || '') + \": \" + error.message; })\r\n                .join('\", \"');\r\n            return err({\r\n                message: \"expected a value matching one of the decoders, got the errors [\\\"\" + errorsList + \"\\\"]\"\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that always succeeds with either the decoded value, or a fallback\r\n     * default value.\r\n     */\r\n    Decoder.withDefault = function (defaultValue, decoder) {\r\n        return new Decoder(function (json) {\r\n            return ok(withDefault(defaultValue, decoder.decode(json)));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that pulls a specific field out of a json structure, instead of\r\n     * decoding and returning the full structure. The `paths` array describes the\r\n     * object keys and array indices to traverse, so that values can be pulled out\r\n     * of a nested structure.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * const decoder = valueAt(['a', 'b', 0], string());\r\n     *\r\n     * decoder.run({a: {b: ['surprise!']}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * decoder.run({a: {x: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b[0]' message: 'path does not exist'}}\r\n     * ```\r\n     *\r\n     * Note that the `decoder` is ran on the value found at the last key in the\r\n     * path, even if the last key is not found. This allows the `optional`\r\n     * decoder to succeed when appropriate.\r\n     * ```\r\n     * const optionalDecoder = valueAt(['a', 'b', 'c'], optional(string()));\r\n     *\r\n     * optionalDecoder.run({a: {b: {c: 'surprise!'}}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * optionalDecoder.run({a: {b: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b.c' message: 'expected an object, got \"cats\"'}\r\n     *\r\n     * optionalDecoder.run({a: {b: {z: 1}}})\r\n     * // => {ok: true, result: undefined}\r\n     * ```\r\n     */\r\n    Decoder.valueAt = function (paths, decoder) {\r\n        return new Decoder(function (json) {\r\n            var jsonAtPath = json;\r\n            for (var i = 0; i < paths.length; i++) {\r\n                if (jsonAtPath === undefined) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: 'path does not exist'\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'string' && !isJsonObject(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an object', jsonAtPath)\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'number' && !isJsonArray(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an array', jsonAtPath)\r\n                    });\r\n                }\r\n                else {\r\n                    jsonAtPath = jsonAtPath[paths[i]];\r\n                }\r\n            }\r\n            return mapError(function (error) {\r\n                return jsonAtPath === undefined\r\n                    ? { at: printPath(paths), message: 'path does not exist' }\r\n                    : prependAt(printPath(paths), error);\r\n            }, decoder.decode(jsonAtPath));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always succeeds with `fixedValue`.\r\n     */\r\n    Decoder.succeed = function (fixedValue) {\r\n        return new Decoder(function (json) { return ok(fixedValue); });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always fails with `errorMessage`.\r\n     */\r\n    Decoder.fail = function (errorMessage) {\r\n        return new Decoder(function (json) { return err({ message: errorMessage }); });\r\n    };\r\n    /**\r\n     * Decoder that allows for validating recursive data structures. Unlike with\r\n     * functions, decoders assigned to variables can't reference themselves\r\n     * before they are fully defined. We can avoid prematurely referencing the\r\n     * decoder by wrapping it in a function that won't be called until use, at\r\n     * which point the decoder has been defined.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface Comment {\r\n     *   msg: string;\r\n     *   replies: Comment[];\r\n     * }\r\n     *\r\n     * const decoder: Decoder<Comment> = object({\r\n     *   msg: string(),\r\n     *   replies: lazy(() => array(decoder))\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.lazy = function (mkDecoder) {\r\n        return new Decoder(function (json) { return mkDecoder().decode(json); });\r\n    };\r\n    return Decoder;\r\n}());\n\n/* tslint:disable:variable-name */\r\n/** See `Decoder.string` */\r\nvar string = Decoder.string;\r\n/** See `Decoder.number` */\r\nvar number = Decoder.number;\r\n/** See `Decoder.boolean` */\r\nvar boolean = Decoder.boolean;\r\n/** See `Decoder.anyJson` */\r\nvar anyJson = Decoder.anyJson;\r\n/** See `Decoder.constant` */\r\nvar constant = Decoder.constant;\r\n/** See `Decoder.object` */\r\nvar object = Decoder.object;\r\n/** See `Decoder.array` */\r\nvar array = Decoder.array;\r\n/** See `Decoder.optional` */\r\nvar optional = Decoder.optional;\r\n/** See `Decoder.oneOf` */\r\nvar oneOf = Decoder.oneOf;\r\n/** See `Decoder.lazy` */\r\nvar lazy = Decoder.lazy;\n\nvar nonEmptyStringDecoder = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\n\nvar windowLayoutItemDecoder = object({\r\n    type: constant(\"window\"),\r\n    config: object({\r\n        appName: nonEmptyStringDecoder,\r\n        url: optional(nonEmptyStringDecoder)\r\n    })\r\n});\r\nvar groupLayoutItemDecoder = object({\r\n    type: constant(\"group\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(windowLayoutItemDecoder))\r\n});\r\nvar columnLayoutItemDecoder = object({\r\n    type: constant(\"column\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return columnLayoutItemDecoder; }), lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar rowLayoutItemDecoder = object({\r\n    type: constant(\"row\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar workspaceComponentDecoder = object({\r\n    type: constant(\"Workspace\"),\r\n    state: object({\r\n        config: anyJson(),\r\n        context: anyJson(),\r\n        children: array(oneOf(rowLayoutItemDecoder, columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder))\r\n    })\r\n});\n\nvar windowComponentDecoder = object({\r\n    type: constant(\"window\"),\r\n    componentType: constant(\"application\"),\r\n    state: object({\r\n        name: anyJson(),\r\n        context: anyJson(),\r\n        url: nonEmptyStringDecoder,\r\n        bounds: anyJson(),\r\n        id: nonEmptyStringDecoder,\r\n        parentId: optional(nonEmptyStringDecoder),\r\n        main: boolean()\r\n    })\r\n});\n\nvar layoutTypeDecoder = oneOf(constant(\"Global\"), constant(\"Workspace\"));\r\nvar newLayoutOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson())\r\n});\r\nvar restoreOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    closeRunningInstance: optional(boolean())\r\n});\r\nvar layoutDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    type: layoutTypeDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson()),\r\n    components: array(oneOf(workspaceComponentDecoder, windowComponentDecoder))\r\n});\n\nvar Layouts = (function () {\r\n    function Layouts(controller) {\r\n        this.controller = controller;\r\n    }\r\n    Layouts.prototype.ready = function () {\r\n        return this.controller.ready();\r\n    };\r\n    Layouts.prototype.getAll = function (type) {\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.getAll(type);\r\n    };\r\n    Layouts.prototype.get = function (name, type) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.get(name, type);\r\n    };\r\n    Layouts.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (layoutType) {\r\n                    layoutTypeDecoder.runWithException(layoutType);\r\n                }\r\n                return [2, this.controller.export(layoutType)];\r\n            });\r\n        });\r\n    };\r\n    Layouts.prototype.import = function (layouts) {\r\n        layouts.forEach(function (layout) { return layoutDecoder.runWithException(layout); });\r\n        return this.controller.import(layouts);\r\n    };\r\n    Layouts.prototype.save = function (layout) {\r\n        newLayoutOptionsDecoder.runWithException(layout);\r\n        return this.controller.save(layout);\r\n    };\r\n    Layouts.prototype.restore = function (options) {\r\n        restoreOptionsDecoder.runWithException(options);\r\n        return this.controller.restore(options);\r\n    };\r\n    Layouts.prototype.remove = function (type, name) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.remove(type, name);\r\n    };\r\n    Layouts.prototype.onAdded = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutAdded(callback);\r\n    };\r\n    Layouts.prototype.onChanged = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutChanged(callback);\r\n    };\r\n    Layouts.prototype.onRemoved = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutRemoved(callback);\r\n    };\r\n    return Layouts;\r\n}());\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n        this.setContextDataToEmptyObjIfMissing = function (context) {\r\n            return __assign(__assign({}, context), { data: context.data || {} });\r\n        };\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        var _this = this;\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n            var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n            callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n                                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                                if (_this.callback) {\r\n                                    _this.callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.set(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (context) {\r\n                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                resolve(contextWithDataObj);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.updateChannel = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        var newData = {\r\n            name: data.name,\r\n            meta: data.meta\r\n        };\r\n        if ((data === null || data === void 0 ? void 0 : data.data) && !this.isEmptyObject(data.data)) {\r\n            newData.data = data.data;\r\n        }\r\n        return this.contexts.update(contextName, newData);\r\n    };\r\n    SharedContextSubscriber.prototype.updateData = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        if (this.contexts.setPathSupported) {\r\n            var pathValues = Object.keys(data).map(function (key) {\r\n                return {\r\n                    path: \"data.\" + key,\r\n                    value: data[key]\r\n                };\r\n            });\r\n            return this.contexts.setPaths(contextName, pathValues);\r\n        }\r\n        else {\r\n            return this.contexts.update(contextName, { data: data });\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return \"\" + CONTEXT_PREFIX + name;\r\n    };\r\n    SharedContextSubscriber.prototype.isEmptyObject = function (obj) {\r\n        return Object.keys(obj).length === 0 && obj.constructor === Object;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar Channels = (function () {\r\n    function Channels(contexts, channels) {\r\n        var _this = this;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$1();\r\n        this.shared = new SharedContextSubscriber(contexts);\r\n        this.shared.subscribe(this.handler.bind(this));\r\n        this.readyPromise = Promise.resolve(channels === null || channels === void 0 ? void 0 : channels.reduce(function (promise, channel) {\r\n            return promise.then(function () { return _this.add(channel); });\r\n        }, Promise.resolve({})));\r\n    }\r\n    Channels.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    Channels.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.publish = function (data, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof data !== \"object\") {\r\n                    throw new Error(\"Please provide the data as an object!\");\r\n                }\r\n                if (name) {\r\n                    if (typeof name !== \"string\") {\r\n                        throw new Error(\"Please provide the name as a string!\");\r\n                    }\r\n                    if (!this.shared.isChannel(name)) {\r\n                        throw new Error(\"A channel with name: \" + name + \" doesn't exist!\");\r\n                    }\r\n                    return [2, this.shared.updateData(name, data)];\r\n                }\r\n                if (!this.currentContext) {\r\n                    throw new Error(\"Not joined to any channel!\");\r\n                }\r\n                return [2, this.shared.updateData(this.currentContext, data)];\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    Channels.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    Channels.prototype.join = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.currentContext = name;\r\n                        return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.leave = function () {\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        return Promise.resolve();\r\n    };\r\n    Channels.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    Channels.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    Channels.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    Channels.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    Channels.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta,\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.updateChannel(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Channels.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    return Channels;\r\n}());\n\nvar fetchTimeout = function (url, timeoutMilliseconds) {\r\n    if (timeoutMilliseconds === void 0) { timeoutMilliseconds = 3000; }\r\n    return new Promise(function (resolve, reject) {\r\n        var timeoutHit = false;\r\n        var timeout = setTimeout(function () {\r\n            timeoutHit = true;\r\n            reject(new Error(\"Fetch request for: \" + url + \" timed out at: \" + timeoutMilliseconds + \" milliseconds\"));\r\n        }, timeoutMilliseconds);\r\n        fetch(url)\r\n            .then(function (response) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                resolve(response);\r\n            }\r\n        })\r\n            .catch(function (err) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                reject(err);\r\n            }\r\n        });\r\n    });\r\n};\n\nvar promisePlus = function (promise, timeoutMilliseconds, timeoutMessage) {\r\n    return new Promise(function (resolve, reject) {\r\n        var timeout = setTimeout(function () {\r\n            var message = timeoutMessage || \"Promise timeout hit: \" + timeoutMilliseconds;\r\n            reject(message);\r\n        }, timeoutMilliseconds);\r\n        promise()\r\n            .then(function (result) {\r\n            clearTimeout(timeout);\r\n            resolve(result);\r\n        })\r\n            .catch(function (error) {\r\n            clearTimeout(timeout);\r\n            reject(error);\r\n        });\r\n    });\r\n};\n\nvar Application = (function () {\r\n    function Application(_appManager, _props, _windows) {\r\n        var _this = this;\r\n        var _a, _b, _c, _d;\r\n        this._appManager = _appManager;\r\n        this._props = _props;\r\n        this._windows = _windows;\r\n        this._registry = lib$1();\r\n        this.start = function (context, options) {\r\n            if (typeof context !== \"undefined\" && typeof context !== \"object\") {\r\n                throw new Error(\"Please provide the context as an object!\");\r\n            }\r\n            if (typeof options !== \"undefined\" && typeof options !== \"object\") {\r\n                throw new Error(\"Please provide the options as an object!\");\r\n            }\r\n            return promisePlus(function () { return _this.startWithoutTimeout(context, options); }, 3000, \"Application \\\"\" + _this.name + \"\\\" start timeout!\");\r\n        };\r\n        if (typeof ((_a = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) === \"undefined\") {\r\n            this._url = (_c = (_b = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _b === void 0 ? void 0 : _b.details) === null || _c === void 0 ? void 0 : _c.url;\r\n        }\r\n        else {\r\n            var parsedManifest = JSON.parse(_props.userProperties.manifest);\r\n            this._url = ((_d = parsedManifest.details) === null || _d === void 0 ? void 0 : _d.url) || parsedManifest.url;\r\n        }\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStarted\", instance);\r\n            }\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStopped\", instance);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(Application.prototype, \"name\", {\r\n        get: function () {\r\n            return this._props.name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"title\", {\r\n        get: function () {\r\n            return this._props.title || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"version\", {\r\n        get: function () {\r\n            return this._props.version || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"icon\", {\r\n        get: function () {\r\n            return this._props.icon || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"caption\", {\r\n        get: function () {\r\n            return this._props.caption || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"userProperties\", {\r\n        get: function () {\r\n            return this._props.userProperties || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this.name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Application.prototype.onInstanceStarted = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    Application.prototype.onInstanceStopped = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    Application.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        var url = typeof ((_a = props === null || props === void 0 ? void 0 : props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) !== \"undefined\" ? JSON.parse(props === null || props === void 0 ? void 0 : props.userProperties.manifest).url : (_b = props === null || props === void 0 ? void 0 : props.userProperties) === null || _b === void 0 ? void 0 : _b.details.url;\r\n        this._url = url;\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    Application.prototype.startWithoutTimeout = function (context, options) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openOptions, appWindow, unsubscribeFunc, resolveCallback, startedAppsWindowIdsToInstances, checkResolveCondition, appInstanceStartedPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        openOptions = __assign(__assign(__assign({}, (_b = (_a = this._props) === null || _a === void 0 ? void 0 : _a.userProperties) === null || _b === void 0 ? void 0 : _b.details), options), { context: context || (options === null || options === void 0 ? void 0 : options.context) });\r\n                        if (!this._url) {\r\n                            throw new Error(\"Application \" + this.name + \" doesn't have a URL.\");\r\n                        }\r\n                        startedAppsWindowIdsToInstances = {};\r\n                        checkResolveCondition = function () {\r\n                            if (typeof appWindow !== \"undefined\") {\r\n                                var instance = startedAppsWindowIdsToInstances[appWindow.id];\r\n                                if (typeof instance !== \"undefined\") {\r\n                                    unsubscribeFunc();\r\n                                    return resolveCallback(instance);\r\n                                }\r\n                            }\r\n                        };\r\n                        appInstanceStartedPromise = new Promise(function (resolve) {\r\n                            resolveCallback = resolve;\r\n                            unsubscribeFunc = _this._appManager.onInstanceStarted(function (startedInstance) {\r\n                                var windowId = startedInstance.agm.windowId;\r\n                                if (typeof windowId !== \"undefined\") {\r\n                                    startedAppsWindowIdsToInstances[windowId] = startedInstance;\r\n                                    checkResolveCondition();\r\n                                }\r\n                            });\r\n                        });\r\n                        return [4, this._windows.open(this.name, this._url, openOptions)];\r\n                    case 1:\r\n                        appWindow = _c.sent();\r\n                        checkResolveCondition();\r\n                        return [2, appInstanceStartedPromise];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Application;\r\n}());\n\nvar RemoteInstance = (function () {\r\n    function RemoteInstance(id, application, control, agm, appManager, window) {\r\n        var _this = this;\r\n        this.id = id;\r\n        this.application = application;\r\n        this.control = control;\r\n        this.agm = agm;\r\n        this.appManager = appManager;\r\n        this.window = window;\r\n        this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND = \"Peer has left while waiting for result\";\r\n        var unsub = control.onStart(function () {\r\n            var _a;\r\n            (_a = _this.window) === null || _a === void 0 ? void 0 : _a.getContext().then(function (context) {\r\n                unsub();\r\n                _this.context = context;\r\n            });\r\n        });\r\n    }\r\n    RemoteInstance.prototype.stop = function () {\r\n        var _this = this;\r\n        var instanceStoppedPromise = new Promise(function (resolve, reject) {\r\n            _this.appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this.id) {\r\n                    resolve();\r\n                }\r\n            });\r\n            _this.callControl(\"stop\", {}, false).catch(function (error) {\r\n                if (error.message !== _this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND) {\r\n                    reject(error);\r\n                }\r\n            });\r\n        });\r\n        return promisePlus(function () { return instanceStoppedPromise; }, 10000, \"Instance \" + this.id + \" stop timeout!\");\r\n    };\r\n    RemoteInstance.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return this.control.send({ command: command, domain: \"appManager\", args: args, skipResult: skipResult }, { instance: this.id });\r\n    };\r\n    return RemoteInstance;\r\n}());\n\nvar LocalInstance = (function () {\r\n    function LocalInstance(id, control, agm) {\r\n        this.id = id;\r\n        this.control = control;\r\n        this.agm = agm;\r\n        this.context = {};\r\n        this.startedByScript = false;\r\n        this.application = undefined;\r\n        this.control.setLocalInstance(this);\r\n    }\r\n    LocalInstance.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (_this.startedByScript) {\r\n                resolve();\r\n                window.close();\r\n            }\r\n            else {\r\n                reject(\"Can't close a window that wasn't started by a script.\");\r\n            }\r\n        });\r\n    };\r\n    return LocalInstance;\r\n}());\n\nvar nonEmptyStringDecoder$1 = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\r\nvar fdc3AppImageDecoder = object({\r\n    url: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IconDecoder = object({\r\n    icon: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IntentDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    displayName: optional(string()),\r\n    contexts: optional(array(string())),\r\n    customConfig: optional(object())\r\n});\r\nvar glue42CoreCreateOptionsDecoder = object({\r\n    url: optional(nonEmptyStringDecoder$1),\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    width: optional(number()),\r\n    height: optional(number()),\r\n    context: optional(anyJson()),\r\n    relativeTo: optional(nonEmptyStringDecoder$1),\r\n    relativeDirection: optional(oneOf(constant(\"top\"), constant(\"left\"), constant(\"right\"), constant(\"bottom\")))\r\n});\r\nvar fdc3ApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    appId: nonEmptyStringDecoder$1,\r\n    manifest: nonEmptyStringDecoder$1,\r\n    manifestType: nonEmptyStringDecoder$1,\r\n    tooltip: optional(string()),\r\n    description: optional(string()),\r\n    contactEmail: optional(string()),\r\n    supportEmail: optional(string()),\r\n    publisher: optional(string()),\r\n    images: optional(array(fdc3AppImageDecoder)),\r\n    icons: optional(array(fdc3IconDecoder)),\r\n    customConfig: optional(object()),\r\n    intents: optional(array(fdc3IntentDecoder))\r\n});\r\nvar glue42CoreApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    details: glue42CoreCreateOptionsDecoder,\r\n    customProperties: optional(object()),\r\n    icon: optional(string()),\r\n    caption: optional(string())\r\n});\n\nvar AppManager = (function () {\r\n    function AppManager(windows, interop, control, config, appName) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        this.windows = windows;\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.config = config;\r\n        this.appName = appName;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this.registry = lib$1();\r\n        this.DEFAULT_POLLING_INTERVAL = 3000;\r\n        this.DEFAULT_REQUEST_TIMEOUT = 3000;\r\n        this.OKAY_MESSAGE = \"OK\";\r\n        this.LOCAL_SOURCE = \"LOCAL_SOURCE\";\r\n        var myId = interop.instance.instance;\r\n        this._myInstance = new LocalInstance(myId, this.control, this.interop.instance);\r\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a.remoteSources) {\r\n            this.readyPromise = this.subscribeForRemoteApplications(this.config.remoteSources).then(function () { return _this.trackInstanceLifetime(); });\r\n        }\r\n        if ((_b = this.config) === null || _b === void 0 ? void 0 : _b.localApplications) {\r\n            var validatedApplications = this.getValidatedApplications(this.config.localApplications);\r\n            this.addApplications(validatedApplications);\r\n        }\r\n    }\r\n    Object.defineProperty(AppManager.prototype, \"myInstance\", {\r\n        get: function () {\r\n            if (!this.appName) {\r\n                console.warn(\"application wasn't provided to the GlueWeb factory function!\");\r\n            }\r\n            if (!this._myInstance) {\r\n                console.warn(\"The application isn't defined in any of the local/remote application sources!\");\r\n            }\r\n            return this._myInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AppManager.prototype.application = function (name) {\r\n        var _a;\r\n        if (typeof name !== \"string\") {\r\n            throw new Error(\"Please provide the name as a string!\");\r\n        }\r\n        return (_a = this._apps[name]) === null || _a === void 0 ? void 0 : _a.application;\r\n    };\r\n    AppManager.prototype.applications = function () {\r\n        var _this = this;\r\n        return Object.keys(this._apps).map(function (appName) { return _this._apps[appName].application; });\r\n    };\r\n    AppManager.prototype.instances = function () {\r\n        return this._instances;\r\n    };\r\n    AppManager.prototype.onAppAdded = function (callback) {\r\n        var _this = this;\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        var applications = Object.keys(this._apps).map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        return this.registry.add(\"appAdded\", callback, applications);\r\n    };\r\n    AppManager.prototype.onAppRemoved = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"appRemoved\", callback);\r\n    };\r\n    AppManager.prototype.onAppChanged = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"appChanged\", callback);\r\n    };\r\n    AppManager.prototype.onInstanceStarted = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"instanceStarted\", callback, this._instances);\r\n    };\r\n    AppManager.prototype.onInstanceStopped = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"instanceStopped\", callback);\r\n    };\r\n    AppManager.prototype.ready = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, this.readyPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getValidatedApplications = function (applications) {\r\n        var verifiedApplications = applications.filter(function (application) {\r\n            var isFDC3App = typeof application.manifest !== \"undefined\";\r\n            var isValid;\r\n            if (isFDC3App) {\r\n                isValid = fdc3ApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            else {\r\n                isValid = glue42CoreApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            if (!isValid) {\r\n                console.warn(\"Validation failed for application \\\"\" + application.name + \"\\\"!\");\r\n            }\r\n            return isValid;\r\n        });\r\n        return verifiedApplications;\r\n    };\r\n    AppManager.prototype.subscribeForRemoteApplications = function (remoteSources) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var initialFetchAppsPromises, _loop_1, this_1, _i, remoteSources_1, remoteSource;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        initialFetchAppsPromises = [];\r\n                        _loop_1 = function (remoteSource) {\r\n                            var url = remoteSource.url;\r\n                            var appsFetch = function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                var response, json, validatedApplications, error_2;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0:\r\n                                            _a.trys.push([0, 3, , 4]);\r\n                                            return [4, fetchTimeout(url, remoteSource.requestTimeout || this.DEFAULT_REQUEST_TIMEOUT)];\r\n                                        case 1:\r\n                                            response = _a.sent();\r\n                                            return [4, response.json()];\r\n                                        case 2:\r\n                                            json = (_a.sent());\r\n                                            if (json.message === this.OKAY_MESSAGE) {\r\n                                                validatedApplications = this.getValidatedApplications(json.applications);\r\n                                                this.addApplications(validatedApplications, url);\r\n                                            }\r\n                                            return [3, 4];\r\n                                        case 3:\r\n                                            error_2 = _a.sent();\r\n                                            console.warn(\"Failed to fetch apps from \" + url);\r\n                                            return [3, 4];\r\n                                        case 4: return [2];\r\n                                    }\r\n                                });\r\n                            }); };\r\n                            initialFetchAppsPromises.push(appsFetch());\r\n                            setInterval(function () { return appsFetch(); }, remoteSource.pollingInterval || this_1.DEFAULT_POLLING_INTERVAL);\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, remoteSources_1 = remoteSources; _i < remoteSources_1.length; _i++) {\r\n                            remoteSource = remoteSources_1[_i];\r\n                            _loop_1(remoteSource);\r\n                        }\r\n                        return [4, Promise.all(initialFetchAppsPromises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getAppProps = function (application) {\r\n        var glue42CoreAppProps = [\"name\", \"title\", \"version\", \"customProperties\", \"icon\", \"caption\"];\r\n        var userProperties = Object.fromEntries(Object.entries(application).filter(function (_a) {\r\n            var key = _a[0];\r\n            return !glue42CoreAppProps.includes(key);\r\n        }));\r\n        return {\r\n            name: application.name,\r\n            title: application.title,\r\n            version: application.version,\r\n            icon: application.icon,\r\n            caption: application.caption,\r\n            userProperties: __assign(__assign({}, userProperties), application.customProperties)\r\n        };\r\n    };\r\n    AppManager.prototype.handleAppsChanged = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var _loop_2 = function (newlyAddedApplication) {\r\n            var currentApplicationWithTheSameNameAndSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source === source;\r\n            });\r\n            var currentApplicationWithTheSameNameButDifferentSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source !== source;\r\n            });\r\n            if (currentApplicationWithTheSameNameAndSource) {\r\n                var currentApplication = this_2._apps[currentApplicationWithTheSameNameAndSource];\r\n                var appProps = this_2.getAppProps(newlyAddedApplication);\r\n                if (JSON.stringify(currentApplication.appProps) !== JSON.stringify(appProps)) {\r\n                    var newlyAddedApplicationInstance = new Application(this_2, appProps, this_2.windows);\r\n                    this_2.registry.execute(\"appChanged\", newlyAddedApplicationInstance);\r\n                    this_2._apps[newlyAddedApplication.name] = {\r\n                        source: currentApplication.source,\r\n                        application: newlyAddedApplicationInstance,\r\n                        appProps: appProps\r\n                    };\r\n                }\r\n            }\r\n            else if (currentApplicationWithTheSameNameButDifferentSource) {\r\n                console.warn(\"Application \\\"\" + newlyAddedApplication.name + \"\\\" already defined by source \\\"\" + this_2._apps[currentApplicationWithTheSameNameButDifferentSource].source + \"\\\". Skipping application definition from source \" + source + \".\");\r\n            }\r\n        };\r\n        var this_2 = this;\r\n        for (var _i = 0, newlyAddedApplications_1 = newlyAddedApplications; _i < newlyAddedApplications_1.length; _i++) {\r\n            var newlyAddedApplication = newlyAddedApplications_1[_i];\r\n            _loop_2(newlyAddedApplication);\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsAdded = function (newlyAddedApplications, source) {\r\n        var currentAppNames = Object.keys(this._apps);\r\n        var newApplications = newlyAddedApplications.filter(function (newlyAddedApplication) {\r\n            return !currentAppNames.includes(newlyAddedApplication.name);\r\n        });\r\n        for (var _i = 0, newApplications_1 = newApplications; _i < newApplications_1.length; _i++) {\r\n            var newApplication = newApplications_1[_i];\r\n            var appProps = this.getAppProps(newApplication);\r\n            var newApplicationInstance = new Application(this, appProps, this.windows);\r\n            this.registry.execute(\"appAdded\", newApplicationInstance);\r\n            this._apps[newApplication.name] = {\r\n                source: source || this.LOCAL_SOURCE,\r\n                application: newApplicationInstance,\r\n                appProps: appProps\r\n            };\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsRemoved = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var currentApplicationsFromThisSource = Object.keys(this._apps)\r\n            .filter(function (appName) {\r\n            return _this._apps[appName].source === source;\r\n        })\r\n            .map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        var newlyAddedApplicationNames = newlyAddedApplications.map(function (newlyAddedApplication) {\r\n            return newlyAddedApplication.name;\r\n        });\r\n        var removedApplications = currentApplicationsFromThisSource.filter(function (currentApplicationFromThisSource) {\r\n            return !newlyAddedApplicationNames.includes(currentApplicationFromThisSource.name);\r\n        });\r\n        for (var _i = 0, removedApplications_1 = removedApplications; _i < removedApplications_1.length; _i++) {\r\n            var removedApplication = removedApplications_1[_i];\r\n            this.registry.execute(\"appRemoved\", removedApplication);\r\n            delete this._apps[removedApplication.name];\r\n        }\r\n    };\r\n    AppManager.prototype.tryPopulateMyInstanceApplication = function () {\r\n        var _this = this;\r\n        var _a;\r\n        if (this.appName) {\r\n            var myApp = (_a = Object.values(this._apps).find(function (app) { return app.application.name === _this.appName; })) === null || _a === void 0 ? void 0 : _a.application;\r\n            if (myApp) {\r\n                if (myApp.title) {\r\n                    document.title = myApp.title;\r\n                }\r\n                this._myInstance.application = myApp;\r\n            }\r\n        }\r\n    };\r\n    AppManager.prototype.addApplications = function (newlyAddedApplications, source) {\r\n        this.handleAppsChanged(newlyAddedApplications, source);\r\n        this.handleAppsAdded(newlyAddedApplications, source);\r\n        this.handleAppsRemoved(newlyAddedApplications, source);\r\n        if (!this._myInstance.application) {\r\n            this.tryPopulateMyInstanceApplication();\r\n        }\r\n    };\r\n    AppManager.prototype.remoteFromServer = function (server) {\r\n        var serverApp = server.application;\r\n        if (!server.instance || !serverApp || !this._apps[serverApp]) {\r\n            return undefined;\r\n        }\r\n        var id = server.instance;\r\n        var app = this._apps[serverApp].application;\r\n        var appWindow = this.windows.list().find(function (window) { return window.id === server.windowId; });\r\n        return new RemoteInstance(id, app, this.control, server, this, appWindow);\r\n    };\r\n    AppManager.prototype.trackInstanceLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            if (method.name !== Control.CONTROL_METHOD) {\r\n                return;\r\n            }\r\n            var remoteInstance = _this.remoteFromServer(server);\r\n            if (remoteInstance) {\r\n                if (_this._instances.some(function (instance) { return instance.id === remoteInstance.id; })) {\r\n                    return;\r\n                }\r\n                _this._instances.push(remoteInstance);\r\n                _this.registry.execute(\"instanceStarted\", remoteInstance);\r\n            }\r\n        });\r\n        this.interop.serverRemoved(function (server) {\r\n            var serverId = server.instance;\r\n            if (!serverId) {\r\n                return;\r\n            }\r\n            var remoteInstance = _this._instances.find(function (instance) { return instance.id === serverId; });\r\n            if (remoteInstance) {\r\n                _this._instances = _this._instances.filter(function (instance) { return instance.id !== remoteInstance.id; });\r\n                _this.registry.execute(\"instanceStopped\", remoteInstance);\r\n            }\r\n        });\r\n    };\r\n    return AppManager;\r\n}());\n\nvar nonEmptyStringDecoder$2 = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\r\nvar glue42CoreCreateOptionsDecoder$1 = object({\r\n    url: optional(nonEmptyStringDecoder$2),\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    width: optional(number()),\r\n    height: optional(number()),\r\n    context: optional(anyJson()),\r\n    relativeTo: optional(nonEmptyStringDecoder$2),\r\n    relativeDirection: optional(oneOf(constant(\"top\"), constant(\"left\"), constant(\"right\"), constant(\"bottom\")))\r\n});\r\nvar glue42CoreIntentContextDecoder = object({\r\n    type: optional(nonEmptyStringDecoder$2),\r\n    data: optional(object())\r\n});\r\nvar glue42CoreIntentFilterDecoder = optional(oneOf(object({\r\n    name: optional(string()),\r\n    contextType: optional(string())\r\n}), nonEmptyStringDecoder$2));\r\nvar glue42CoreIntentDefinitionDecoder = oneOf(object({\r\n    intent: nonEmptyStringDecoder$2,\r\n    contextTypes: optional(array(string())),\r\n    displayName: optional(string())\r\n}), nonEmptyStringDecoder$2);\r\nvar glue42CoreIntentRequestDecoder = oneOf(object({\r\n    intent: nonEmptyStringDecoder$2,\r\n    target: optional(oneOf(constant(\"startNew\"), constant(\"reuse\"), object({\r\n        app: optional(string()),\r\n        instance: optional(string())\r\n    }))),\r\n    context: optional(glue42CoreIntentContextDecoder),\r\n    options: optional(glue42CoreCreateOptionsDecoder$1)\r\n}), nonEmptyStringDecoder$2);\n\nvar GLUE42_FDC3_INTENTS_METHOD_PREFIX = \"Tick42.FDC3.Intents.\";\r\nvar Intents = (function () {\r\n    function Intents(interop, windows, appManager) {\r\n        this.interop = interop;\r\n        this.windows = windows;\r\n        this.appManager = appManager;\r\n    }\r\n    Intents.prototype.find = function (intentFilter) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intents, ctToLower_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        glue42CoreIntentFilterDecoder.runWithException(intentFilter);\r\n                        return [4, this.all()];\r\n                    case 1:\r\n                        intents = _a.sent();\r\n                        if (typeof intentFilter === \"undefined\") {\r\n                            return [2, intents];\r\n                        }\r\n                        if (typeof intentFilter === \"string\") {\r\n                            return [2, intents.filter(function (intent) { return intent.name === intentFilter; })];\r\n                        }\r\n                        if (intentFilter.contextType) {\r\n                            ctToLower_1 = intentFilter.contextType.toLowerCase();\r\n                            intents = intents.filter(function (intent) { return intent.handlers.some(function (handler) { var _a; return (_a = handler.contextTypes) === null || _a === void 0 ? void 0 : _a.some(function (ct) { return ct.toLowerCase() === ctToLower_1; }); }); });\r\n                        }\r\n                        if (intentFilter.name) {\r\n                            intents = intents.filter(function (intent) { return intent.name === intentFilter.name; });\r\n                        }\r\n                        return [2, intents];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raise = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intentName, intentDef, isDynamicIntent, target, handler, anAppHandler, anInstanceHandler, instanceId, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        glue42CoreIntentRequestDecoder.runWithException(intent);\r\n                        if (typeof intent === \"string\") {\r\n                            intent = {\r\n                                intent: intent\r\n                            };\r\n                        }\r\n                        intentName = intent.intent;\r\n                        return [4, this.get(intentName)];\r\n                    case 1:\r\n                        intentDef = _a.sent();\r\n                        if (typeof intentDef === \"undefined\") {\r\n                            throw new Error(\"Intent \" + intentName + \" not found.\");\r\n                        }\r\n                        isDynamicIntent = !intentDef.handlers.some(function (intentDefHandler) { return intentDefHandler.type === \"app\"; });\r\n                        target = intent.target || (isDynamicIntent ? \"reuse\" : \"startNew\");\r\n                        anAppHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\"; });\r\n                        if (target === \"startNew\") {\r\n                            handler = anAppHandler;\r\n                        }\r\n                        else if (target === \"reuse\") {\r\n                            anInstanceHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\"; });\r\n                            handler = anInstanceHandler || anAppHandler;\r\n                        }\r\n                        else if (target.instance) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\" && intentHandler.instanceId === target.instance; });\r\n                        }\r\n                        else if (target.app) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\" && intentHandler.applicationName === target.app; });\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Invalid intent target: \" + JSON.stringify(target));\r\n                        }\r\n                        if (!handler) {\r\n                            throw new Error(\"Can not raise intent for request \" + JSON.stringify(intent) + \" - can not find intent handler.\");\r\n                        }\r\n                        instanceId = handler.instanceId;\r\n                        if (!(handler.type === \"app\")) return [3, 3];\r\n                        return [4, this.startApp(handler.applicationName, intent.options)];\r\n                    case 2:\r\n                        instanceId = _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [4, this.raiseIntentToInstance(instanceId, intentName, intent.context)];\r\n                    case 4:\r\n                        result = _a.sent();\r\n                        result.request = intent;\r\n                        result.handler = handler;\r\n                        return [2, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.all = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var apps, intents, appsWithIntents, _i, appsWithIntents_1, app, _a, _b, intentDef, intent, handler, _loop_1, _c, _d, server;\r\n            var _this = this;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        apps = this.appManager.applications().map(function (app) {\r\n                            return {\r\n                                name: app.name,\r\n                                title: app.title,\r\n                                icon: app.icon,\r\n                                caption: app.caption,\r\n                                intents: app.userProperties.intents\r\n                            };\r\n                        });\r\n                        intents = {};\r\n                        appsWithIntents = apps.filter(function (app) { return app.intents && app.intents.length > 0; });\r\n                        for (_i = 0, appsWithIntents_1 = appsWithIntents; _i < appsWithIntents_1.length; _i++) {\r\n                            app = appsWithIntents_1[_i];\r\n                            for (_a = 0, _b = app.intents; _a < _b.length; _a++) {\r\n                                intentDef = _b[_a];\r\n                                intent = intents[intentDef.name];\r\n                                if (!intent) {\r\n                                    intent = {\r\n                                        name: intentDef.name,\r\n                                        handlers: [],\r\n                                    };\r\n                                    intents[intentDef.name] = intent;\r\n                                }\r\n                                handler = {\r\n                                    applicationName: app.name,\r\n                                    applicationTitle: app.title,\r\n                                    applicationDescription: app.caption,\r\n                                    displayName: intentDef.displayName,\r\n                                    contextTypes: intentDef.contexts,\r\n                                    applicationIcon: app.icon,\r\n                                    type: \"app\"\r\n                                };\r\n                                intent.handlers.push(handler);\r\n                            }\r\n                        }\r\n                        _loop_1 = function (server) {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, Promise.all(server.getMethods()\r\n                                            .filter(function (method) { return method.name.startsWith(GLUE42_FDC3_INTENTS_METHOD_PREFIX); })\r\n                                            .map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                                            var intentName, intent, info, app, appIntent, window, title, handler;\r\n                                            return __generator(this, function (_a) {\r\n                                                switch (_a.label) {\r\n                                                    case 0:\r\n                                                        intentName = method.name.replace(GLUE42_FDC3_INTENTS_METHOD_PREFIX, \"\");\r\n                                                        intent = intents[intentName];\r\n                                                        if (!intent) {\r\n                                                            intent = {\r\n                                                                name: intentName,\r\n                                                                handlers: [],\r\n                                                            };\r\n                                                            intents[intentName] = intent;\r\n                                                        }\r\n                                                        if (method.description) {\r\n                                                            try {\r\n                                                                info = JSON.parse(method.description);\r\n                                                            }\r\n                                                            catch (_b) { }\r\n                                                        }\r\n                                                        app = apps.find(function (appDef) { return appDef.name === server.application; });\r\n                                                        if (app && app.intents) {\r\n                                                            appIntent = app.intents.find(function (appDefIntent) { return appDefIntent.name === intentName; });\r\n                                                        }\r\n                                                        window = this.windows.findById(server.windowId);\r\n                                                        return [4, (window === null || window === void 0 ? void 0 : window.getTitle())];\r\n                                                    case 1:\r\n                                                        title = _a.sent();\r\n                                                        handler = {\r\n                                                            instanceId: server.instance,\r\n                                                            applicationName: server.application,\r\n                                                            applicationIcon: (info === null || info === void 0 ? void 0 : info.icon) || (app === null || app === void 0 ? void 0 : app.icon),\r\n                                                            applicationTitle: app === null || app === void 0 ? void 0 : app.title,\r\n                                                            applicationDescription: (info === null || info === void 0 ? void 0 : info.description) || (app === null || app === void 0 ? void 0 : app.caption),\r\n                                                            displayName: (info === null || info === void 0 ? void 0 : info.displayName) || (appIntent === null || appIntent === void 0 ? void 0 : appIntent.displayName),\r\n                                                            contextTypes: (info === null || info === void 0 ? void 0 : info.contextTypes) || (appIntent === null || appIntent === void 0 ? void 0 : appIntent.contexts),\r\n                                                            instanceTitle: title,\r\n                                                            type: \"instance\"\r\n                                                        };\r\n                                                        intent.handlers.push(handler);\r\n                                                        return [2];\r\n                                                }\r\n                                            });\r\n                                        }); }))];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        };\r\n                        _c = 0, _d = this.interop.servers();\r\n                        _e.label = 1;\r\n                    case 1:\r\n                        if (!(_c < _d.length)) return [3, 4];\r\n                        server = _d[_c];\r\n                        return [5, _loop_1(server)];\r\n                    case 2:\r\n                        _e.sent();\r\n                        _e.label = 3;\r\n                    case 3:\r\n                        _c++;\r\n                        return [3, 1];\r\n                    case 4: return [2, Object.values(intents)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.addIntentListener = function (intent, handler) {\r\n        var _this = this;\r\n        glue42CoreIntentDefinitionDecoder.runWithException(intent);\r\n        if (typeof handler !== \"function\") {\r\n            throw new Error(\"Please provide the handler as a function!\");\r\n        }\r\n        var result = { unsubscribe: function () { return console.log(\"Could not unsubscribe!\"); } };\r\n        var intentName = typeof intent === \"string\" ? intent : intent.intent;\r\n        var methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intentName;\r\n        var methodDescription = typeof intent === \"string\" ? undefined : JSON.stringify(intent);\r\n        this.interop.register({ name: methodName, description: methodDescription }, function (args) {\r\n            return handler(args);\r\n        }).then(function () {\r\n            result.unsubscribe = function () {\r\n                _this.interop.unregister(methodName);\r\n            };\r\n        });\r\n        return result;\r\n    };\r\n    Intents.prototype.get = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1: return [2, (_a.sent()).find(function (registeredIntent) { return registeredIntent.name === intent; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.startApp = function (application, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var instance;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.appManager.application(application).start({}, options)];\r\n                    case 1:\r\n                        instance = _a.sent();\r\n                        return [2, instance.id];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raiseIntentToInstance = function (instanceId, intent, context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodName, interopServer, method, result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intent;\r\n                        interopServer = this.interop.servers().find(function (server) { return server.instance === instanceId; });\r\n                        if (!!interopServer) return [3, 2];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.serverAdded(function (server) {\r\n                                    if (server.instance === instanceId) {\r\n                                        interopServer = server;\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop server for instance \" + instanceId));\r\n                                }, 30 * 1000);\r\n                            }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        method = interopServer.getMethods().find(function (registeredMethod) { return registeredMethod.name === methodName; });\r\n                        if (!!method) return [3, 4];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.methodAdded(function (addedMethod) {\r\n                                    if (addedMethod.name === methodName) {\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop method \" + methodName + \" for instance \" + instanceId));\r\n                                }, 10 * 1000);\r\n                            }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [4, this.interop.invoke(methodName, context, { instance: instanceId })];\r\n                    case 5:\r\n                        result = _a.sent();\r\n                        return [2, {\r\n                                result: result.returned\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Intents;\r\n}());\n\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n    }\r\n    Notifications.prototype.raise = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionPromise, notification, interopOptions_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(\"Notification\" in window)) {\r\n                            throw new Error(\"this browser does not support desktop notification\");\r\n                        }\r\n                        if (Notification.permission === \"granted\") {\r\n                            permissionPromise = Promise.resolve(\"granted\");\r\n                        }\r\n                        else if (Notification.permission === \"denied\") {\r\n                            permissionPromise = Promise.reject(\"no permissions from user\");\r\n                        }\r\n                        else {\r\n                            permissionPromise = Notification.requestPermission();\r\n                        }\r\n                        return [4, permissionPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        notification = this.raiseUsingWebApi(options);\r\n                        if (options.clickInterop) {\r\n                            interopOptions_1 = options.clickInterop;\r\n                            notification.onclick = function () {\r\n                                var _a, _b;\r\n                                _this.interop.invoke(interopOptions_1.method, (_a = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.arguments) !== null && _a !== void 0 ? _a : {}, (_b = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.target) !== null && _b !== void 0 ? _b : \"best\");\r\n                            };\r\n                        }\r\n                        return [2, notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.raiseUsingWebApi = function (options) {\r\n        return new Notification(options.title, options);\r\n    };\r\n    return Notifications;\r\n}());\n\nvar defaultAssetsBaseLocation = \"/glue\";\r\nvar defaultWorkerName = \"worker.js\";\r\nvar defaultConfigName = \"glue.config.json\";\r\nvar defaultLayoutsName = \"glue.layouts.json\";\r\nvar defaultWorkerLocation = defaultAssetsBaseLocation + \"/\" + defaultWorkerName;\r\nvar defaultConfig = {\r\n    layouts: {\r\n        autoRestore: false,\r\n        autoSaveWindowContext: false\r\n    },\r\n    logger: \"error\",\r\n    assets: {\r\n        location: defaultAssetsBaseLocation\r\n    },\r\n    channels: false,\r\n    appManager: false,\r\n    libraries: []\r\n};\n\nvar getRemoteConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfigLocation, response, json, _a;\r\n    var _b, _c;\r\n    return __generator(this, function (_d) {\r\n        switch (_d.label) {\r\n            case 0:\r\n                if (((_b = userConfig.assets) === null || _b === void 0 ? void 0 : _b.extendConfig) === false || userConfig.extends === false) {\r\n                    return [2, {}];\r\n                }\r\n                remoteConfigLocation = ((_c = userConfig.assets) === null || _c === void 0 ? void 0 : _c.location) ? userConfig.assets.location + \"/\" + defaultConfigName :\r\n                    typeof userConfig.extends === \"string\" ? userConfig.extends :\r\n                        defaultAssetsBaseLocation + \"/\" + defaultConfigName;\r\n                _d.label = 1;\r\n            case 1:\r\n                _d.trys.push([1, 4, , 5]);\r\n                return [4, fetchTimeout(remoteConfigLocation)];\r\n            case 2:\r\n                response = _d.sent();\r\n                if (!response.ok) {\r\n                    return [2, {}];\r\n                }\r\n                return [4, response.json()];\r\n            case 3:\r\n                json = _d.sent();\r\n                return [2, json !== null && json !== void 0 ? json : {}];\r\n            case 4:\r\n                _a = _d.sent();\r\n                return [2, {}];\r\n            case 5: return [2];\r\n        }\r\n    });\r\n}); };\r\nvar buildConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfig, resultWebConfig, lastIndex, worker;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                userConfig = userConfig !== null && userConfig !== void 0 ? userConfig : {};\r\n                return [4, getRemoteConfig(userConfig)];\r\n            case 1:\r\n                remoteConfig = _a.sent();\r\n                resultWebConfig = __assign(__assign(__assign({}, defaultConfig), remoteConfig.glue), userConfig);\r\n                resultWebConfig.worker = resultWebConfig.assets.location + \"/\" + defaultWorkerName;\r\n                if (typeof (resultWebConfig === null || resultWebConfig === void 0 ? void 0 : resultWebConfig.extends) === \"string\") {\r\n                    lastIndex = resultWebConfig.extends.lastIndexOf(\"/\");\r\n                    worker = resultWebConfig.extends.substr(0, lastIndex + 1) + defaultWorkerName;\r\n                    resultWebConfig.worker = worker;\r\n                }\r\n                if (!remoteConfig.layouts) {\r\n                    remoteConfig.layouts = { remoteType: \"json\" };\r\n                }\r\n                return [2, __assign(__assign({}, remoteConfig), { glue: resultWebConfig })];\r\n        }\r\n    });\r\n}); };\n\nvar dbName = \"glue42core\";\r\nvar dbVersion = 1;\r\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\nvar LayoutEventMethodName = \"T42.Layouts.Events\";\n\nvar LayoutsController = (function () {\r\n    function LayoutsController(storage, windows, control, interop, config) {\r\n        var _a, _b;\r\n        this.storage = storage;\r\n        this.windows = windows;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this._registry = lib$1();\r\n        this.autoSaveContext = (_b = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoSaveWindowContext) !== null && _b !== void 0 ? _b : false;\r\n        this.control.subscribe(\"layouts\", this.handleControlMessage.bind(this));\r\n        this.readyPromise = Promise.all([\r\n            this.registerRequestMethods(),\r\n            this.registerEventsMethod()\r\n        ]).then(function () {\r\n            console.log(\"methods are live\");\r\n            return;\r\n        });\r\n    }\r\n    LayoutsController.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    LayoutsController.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, globalLayouts, workspaceLayouts;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (layoutType) {\r\n                            return [2, this.storage.getAll(layoutType)];\r\n                        }\r\n                        return [4, Promise.all([\r\n                                this.storage.getAll(\"Global\"),\r\n                                this.storage.getAll(\"Workspace\")\r\n                            ])];\r\n                    case 1:\r\n                        _a = _b.sent(), globalLayouts = _a[0], workspaceLayouts = _a[1];\r\n                        return [2, globalLayouts.concat(workspaceLayouts)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.import = function (layouts) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(layouts.map(function (layout) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var layoutEvent, _a, eventPromise, unsubscribe, error_1;\r\n                            return __generator(this, function (_b) {\r\n                                switch (_b.label) {\r\n                                    case 0: return [4, this.get(layout.name, layout.type)];\r\n                                    case 1:\r\n                                        layoutEvent = (_b.sent()) ? \"layoutChanged\" : \"layoutAdded\";\r\n                                        return [4, this.storage.store(layout, layout.type)];\r\n                                    case 2:\r\n                                        _b.sent();\r\n                                        _a = this.waitHearLayout(layout.name, layoutEvent), eventPromise = _a.eventPromise, unsubscribe = _a.unsubscribe;\r\n                                        this.emitLayoutEvent(layoutEvent, layout);\r\n                                        _b.label = 3;\r\n                                    case 3:\r\n                                        _b.trys.push([3, 5, , 6]);\r\n                                        return [4, eventPromise];\r\n                                    case 4:\r\n                                        _b.sent();\r\n                                        unsubscribe();\r\n                                        return [3, 6];\r\n                                    case 5:\r\n                                        error_1 = _b.sent();\r\n                                        unsubscribe();\r\n                                        return [2, Promise.reject(error_1)];\r\n                                    case 6: return [2];\r\n                                }\r\n                            });\r\n                        }); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.save = function (layoutOptions, autoSave) {\r\n        if (autoSave === void 0) { autoSave = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openedWindows, components, layout, layoutEvent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        openedWindows = this.windows.getChildWindows().map(function (w) { return w.id; });\r\n                        return [4, this.getRemoteWindowsInfo(openedWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(this.getLocalLayoutComponent(layoutOptions.context, true));\r\n                        layout = {\r\n                            type: \"Global\",\r\n                            name: layoutOptions.name,\r\n                            components: components,\r\n                            context: layoutOptions.context || {},\r\n                            metadata: layoutOptions.metadata || {}\r\n                        };\r\n                        return [4, this.get(layoutOptions.name, \"Global\")];\r\n                    case 2:\r\n                        layoutEvent = (_a.sent()) ? \"layoutChanged\" : \"layoutAdded\";\r\n                        if (!autoSave) return [3, 3];\r\n                        this.storage.storeAutoLayout(layout);\r\n                        return [3, 5];\r\n                    case 3: return [4, this.storage.store(layout, \"Global\")];\r\n                    case 4:\r\n                        _a.sent();\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        this.emitLayoutEvent(layoutEvent, layout);\r\n                        return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.autoSave = function (layoutOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.save(layoutOptions, true)];\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restore = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.get(options.name, \"Global\")];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            throw new Error(\"can not find layout with name \" + options.name);\r\n                        }\r\n                        this.restoreComponents(layout);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restoreAutoSavedLayout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutName, layout, my, mainComponent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutName = \"_auto_\" + document.location.href;\r\n                        return [4, this.storage.getAutoLayout(layoutName)];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        my = this.windows.my();\r\n                        if (my.parent) {\r\n                            return [2];\r\n                        }\r\n                        mainComponent = layout.components.find(function (c) { return c.state.main; });\r\n                        my.setContext(mainComponent === null || mainComponent === void 0 ? void 0 : mainComponent.state.context);\r\n                        try {\r\n                            this.restoreComponents(layout);\r\n                        }\r\n                        catch (e) {\r\n                            return [2];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.remove = function (type, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutToRemove;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.get(name, type)];\r\n                    case 1:\r\n                        layoutToRemove = _a.sent();\r\n                        return [4, this.storage.remove(name, type)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        if (layoutToRemove) {\r\n                            this.emitLayoutEvent(\"layoutRemoved\", layoutToRemove);\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.getAll = function (type) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.getAll(type)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.map(function (layout) {\r\n                                return {\r\n                                    name: layout.name,\r\n                                    type: layout.type,\r\n                                    context: layout.context,\r\n                                    metadata: layout.metadata\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.get = function (name, type) {\r\n        return this.storage.get(name, type);\r\n    };\r\n    LayoutsController.prototype.getLocalLayoutComponent = function (context, main) {\r\n        if (main === void 0) { main = false; }\r\n        var requestResult;\r\n        var my = this.windows.my();\r\n        try {\r\n            if (this.autoSaveContext) {\r\n                requestResult = {\r\n                    windowContext: my.getContextSync()\r\n                };\r\n            }\r\n        }\r\n        catch (err) {\r\n        }\r\n        return {\r\n            type: \"window\",\r\n            componentType: \"application\",\r\n            state: {\r\n                name: my.name,\r\n                context: (requestResult === null || requestResult === void 0 ? void 0 : requestResult.windowContext) || {},\r\n                bounds: my.getBoundsSync(),\r\n                url: window.document.location.href,\r\n                id: my.id,\r\n                parentId: my.parent,\r\n                main: main\r\n            }\r\n        };\r\n    };\r\n    LayoutsController.prototype.onLayoutAdded = function (callback) {\r\n        return this._registry.add(\"layoutAdded\", callback);\r\n    };\r\n    LayoutsController.prototype.onLayoutChanged = function (callback) {\r\n        return this._registry.add(\"layoutChanged\", callback);\r\n    };\r\n    LayoutsController.prototype.onLayoutRemoved = function (callback) {\r\n        return this._registry.add(\"layoutRemoved\", callback);\r\n    };\r\n    LayoutsController.prototype.waitHearLayout = function (name, layoutEvent) {\r\n        var _this = this;\r\n        var unsubscribe;\r\n        var eventPromise = promisePlus(function () {\r\n            return new Promise(function (resolve) {\r\n                var cb = function (layout) {\r\n                    if (layout.name === name) {\r\n                        resolve();\r\n                    }\r\n                };\r\n                unsubscribe = layoutEvent === \"layoutAdded\" ?\r\n                    _this.onLayoutAdded(cb) :\r\n                    _this.onLayoutChanged(cb);\r\n            });\r\n        }, 5000, \"Timed out waiting to hear \" + layoutEvent + \" for layout name: \" + name);\r\n        return { eventPromise: eventPromise, unsubscribe: unsubscribe };\r\n    };\r\n    LayoutsController.prototype.restoreComponents = function (layout) {\r\n        var _this = this;\r\n        layout.components.forEach(function (c) {\r\n            if (c.type === \"window\") {\r\n                var state = c.state;\r\n                if (state.main) {\r\n                    return;\r\n                }\r\n                var newWindowOptions = __assign(__assign({}, state.bounds), { context: state.context });\r\n                _this.windows.open(state.name, state.url, newWindowOptions);\r\n            }\r\n        });\r\n    };\r\n    LayoutsController.prototype.getRemoteWindowsInfo = function (windows) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises, _loop_1, this_1, _i, windows_1, id, responses;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        promises = [];\r\n                        _loop_1 = function (id) {\r\n                            var interopServer = this_1.interop.servers().find(function (s) { return s.windowId === id; });\r\n                            if (!interopServer || !interopServer.getMethods) {\r\n                                return \"continue\";\r\n                            }\r\n                            var methods = interopServer.getMethods();\r\n                            if (methods.find(function (m) { return m.name === SaveContextMethodName; })) {\r\n                                try {\r\n                                    promises.push(this_1.interop.invoke(SaveContextMethodName, {}, { windowId: id }));\r\n                                }\r\n                                catch (_a) {\r\n                                }\r\n                            }\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, windows_1 = windows; _i < windows_1.length; _i++) {\r\n                            id = windows_1[_i];\r\n                            _loop_1(id);\r\n                        }\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        return [2, responses.map(function (response) { return response.returned; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        return this.interop.register(SaveContextMethodName, function (args) {\r\n            return _this.getLocalLayoutComponent(args);\r\n        });\r\n    };\r\n    LayoutsController.prototype.handleControlMessage = function (command) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutCommand, args, components;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutCommand = command;\r\n                        if (!(layoutCommand.command === \"saveLayoutAndClose\")) return [3, 3];\r\n                        args = layoutCommand.args;\r\n                        return [4, this.getRemoteWindowsInfo(args.childWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(args.parentInfo);\r\n                        return [4, this.storage.storeAutoLayout({\r\n                                type: \"Global\",\r\n                                name: args.layoutName,\r\n                                components: components,\r\n                                context: args.context || {},\r\n                                metadata: args.metadata || {}\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        args.childWindows.forEach(function (cw) {\r\n                            var _a;\r\n                            (_a = _this.windows.findById(cw)) === null || _a === void 0 ? void 0 : _a.close();\r\n                        });\r\n                        _a.label = 3;\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.registerEventsMethod = function () {\r\n        var _this = this;\r\n        return this.interop.register(LayoutEventMethodName, function (args) {\r\n            _this._registry.execute(args.event, args.layout);\r\n        });\r\n    };\r\n    LayoutsController.prototype.emitLayoutEvent = function (event, layout) {\r\n        var hasLayoutMethod = this.interop.methods().some(function (m) { return m.name === LayoutEventMethodName; });\r\n        if (hasLayoutMethod) {\r\n            this.interop.invoke(LayoutEventMethodName, { event: event, layout: layout }, \"all\").catch(function () { });\r\n        }\r\n    };\r\n    return LayoutsController;\r\n}());\n\nvar LayoutStorage = (function () {\r\n    function LayoutStorage(localStore, autoStore, remoteStore) {\r\n        this.localStore = localStore;\r\n        this.autoStore = autoStore;\r\n        this.remoteStore = remoteStore;\r\n    }\r\n    LayoutStorage.prototype.get = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var foundRemote, foundLocal;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        foundRemote = _b.sent();\r\n                        return [4, this.localStore.get(name, layoutType)];\r\n                    case 2:\r\n                        foundLocal = _b.sent();\r\n                        if (foundRemote && foundLocal) {\r\n                            return [2, foundRemote];\r\n                        }\r\n                        return [2, foundRemote || foundLocal];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, local, remote, nonConflictLocal;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, Promise.all([\r\n                            this.localStore.getAll(layoutType),\r\n                            new Promise(function (resolve) {\r\n                                if (_this.remoteStore) {\r\n                                    return _this.remoteStore.getAll(layoutType).then(resolve);\r\n                                }\r\n                                resolve([]);\r\n                            })\r\n                        ])];\r\n                    case 1:\r\n                        _a = _b.sent(), local = _a[0], remote = _a[1];\r\n                        nonConflictLocal = local.filter(function (localLayout) { return !remote.some(function (remoteLayout) { return remoteLayout.name === localLayout.name; }); });\r\n                        return [2, remote.concat(nonConflictLocal)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.store = function (layout, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(layout.name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot save layout with name: \" + layout.name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        if (!layout.metadata) {\r\n                            layout.metadata = { allowSave: true };\r\n                        }\r\n                        else {\r\n                            layout.metadata.allowSave = true;\r\n                        }\r\n                        return [4, this.localStore.store(layout, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.remove = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot remove layout with name: \" + name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        return [4, this.localStore.delete(name, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAutoLayout = function (name) {\r\n        return this.autoStore.get(name, \"Global\");\r\n    };\r\n    LayoutStorage.prototype.storeAutoLayout = function (layout) {\r\n        this.autoStore.save(layout);\r\n    };\r\n    return LayoutStorage;\r\n}());\n\nconst instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nvar LocalStore = (function () {\r\n    function LocalStore() {\r\n        if (!(\"indexedDB\" in window)) {\r\n            throw new Error(\"Cannot initialize the local storage, because IndexedDb is not supported\");\r\n        }\r\n    }\r\n    Object.defineProperty(LocalStore.prototype, \"database\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (this._database) {\r\n                return Promise.resolve(this._database);\r\n            }\r\n            return new Promise(function (resolve) {\r\n                openDB(dbName, dbVersion, { upgrade: _this.setUpDb.bind(_this) })\r\n                    .then(function (database) {\r\n                    _this._database = database;\r\n                    resolve(_this._database);\r\n                });\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LocalStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).getAll(\"workspaceLayouts\")];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).getAll(\"globalLayouts\")];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.delete = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).delete(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).delete(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).get(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).get(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.store = function (layout, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        layoutDecoder.runWithException(layout);\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).put(\"workspaceLayouts\", layout, layout.name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).put(\"globalLayouts\", layout, layout.name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.setUpDb = function (database) {\r\n        if (!database.objectStoreNames.contains(\"workspaceLayouts\")) {\r\n            database.createObjectStore(\"workspaceLayouts\");\r\n        }\r\n        if (!database.objectStoreNames.contains(\"globalLayouts\")) {\r\n            database.createObjectStore(\"globalLayouts\");\r\n        }\r\n    };\r\n    return LocalStore;\r\n}());\n\nvar JSONStore = (function () {\r\n    function JSONStore(storeBaseUrl) {\r\n        this.storeBaseUrl = storeBaseUrl;\r\n    }\r\n    JSONStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var fetchUrl, response, layouts, error_1, layoutProp, layoutsToVerify;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        fetchUrl = this.storeBaseUrl + \"/\" + defaultLayoutsName;\r\n                        return [4, fetchTimeout(fetchUrl)];\r\n                    case 1:\r\n                        response = _a.sent();\r\n                        if (!response.ok) {\r\n                            return [2, []];\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4, response.json()];\r\n                    case 3:\r\n                        layouts = _a.sent();\r\n                        return [3, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        return [2, []];\r\n                    case 5:\r\n                        if (!layouts) {\r\n                            return [2, []];\r\n                        }\r\n                        layoutProp = layoutType === \"Global\" ? \"globals\" : \"workspaces\";\r\n                        layoutsToVerify = (layouts[layoutProp] || []);\r\n                        return [2, layoutsToVerify.filter(function (layout) {\r\n                                var decodeResult = layoutDecoder.run(layout);\r\n                                if (!decodeResult.ok) {\r\n                                    console.warn(\"Fetched layout: \" + layout.name + \" is discarded, because it failed the validation: \" + JSON.stringify(decodeResult));\r\n                                }\r\n                                return decodeResult.ok;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JSONStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getAll(layoutType)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.find(function (layout) { return layout.name === name; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return JSONStore;\r\n}());\n\nvar AutoStorage = (function () {\r\n    function AutoStorage() {\r\n    }\r\n    AutoStorage.prototype.get = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        return obj[key];\r\n    };\r\n    AutoStorage.prototype.save = function (layout) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(layout.name, layout.type);\r\n        obj[key] = layout;\r\n        this.setObjectToLocalStorage(obj);\r\n        return layout;\r\n    };\r\n    AutoStorage.prototype.remove = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        delete obj[key];\r\n    };\r\n    AutoStorage.prototype.getObjectFromLocalStorage = function () {\r\n        var values = window.localStorage.getItem(AutoStorage.KEY);\r\n        if (values) {\r\n            return JSON.parse(values);\r\n        }\r\n        return {};\r\n    };\r\n    AutoStorage.prototype.setObjectToLocalStorage = function (obj) {\r\n        window.localStorage.setItem(AutoStorage.KEY, JSON.stringify(obj));\r\n    };\r\n    AutoStorage.prototype.getKey = function (name, type) {\r\n        return type + \"_\" + name;\r\n    };\r\n    AutoStorage.KEY = \"G0_layouts\";\r\n    return AutoStorage;\r\n}());\n\nvar hookCloseEvents = function (api, config, control, layoutsController) {\r\n    var done = false;\r\n    var doneFn = function () { return __awaiter(void 0, void 0, void 0, function () {\r\n        var shouldSave, allChildren, firstChild, layoutName, command;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            if (!done) {\r\n                done = true;\r\n                shouldSave = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoRestore;\r\n                if (shouldSave) {\r\n                    allChildren = api.windows.getChildWindows().map(function (w) { return w.id; });\r\n                    firstChild = allChildren[0];\r\n                    layoutName = \"_auto_\" + document.location.href;\r\n                    if (allChildren.length > 0) {\r\n                        command = {\r\n                            domain: \"layouts\",\r\n                            command: \"saveLayoutAndClose\",\r\n                            args: {\r\n                                childWindows: allChildren,\r\n                                closeEveryone: true,\r\n                                layoutName: layoutName,\r\n                                context: {},\r\n                                metadata: {},\r\n                                parentInfo: layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.getLocalLayoutComponent({}, true)\r\n                            }\r\n                        };\r\n                        control.send(command, { windowId: firstChild });\r\n                    }\r\n                    else {\r\n                        layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.autoSave({ name: layoutName });\r\n                    }\r\n                }\r\n                api.done();\r\n            }\r\n            return [2];\r\n        });\r\n    }); };\r\n    window.addEventListener(\"beforeunload\", function () {\r\n        doneFn();\r\n    });\r\n};\r\nvar createFactoryFunction = function (coreFactoryFunction) {\r\n    return function (config) { return __awaiter(void 0, void 0, void 0, function () {\r\n        var builtCoreConfig, isWebEnvironment, shouldInitializeChannels, shouldInitializeAppManager, gdWindowContext, control, windows, appManager, layoutsController, ext, channelsLib, appManagerLib, intentsLib, coreConfig, core;\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;\r\n        return __generator(this, function (_r) {\r\n            switch (_r.label) {\r\n                case 0: return [4, buildConfig(config)];\r\n                case 1:\r\n                    builtCoreConfig = _r.sent();\r\n                    isWebEnvironment = typeof window !== \"undefined\";\r\n                    shouldInitializeChannels = ((_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.channels) || false;\r\n                    shouldInitializeAppManager = ((_b = builtCoreConfig.glue) === null || _b === void 0 ? void 0 : _b.appManager) || false;\r\n                    if (isWebEnvironment) {\r\n                        gdWindowContext = window;\r\n                        if ((gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.glue42gd) && (gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.Glue)) {\r\n                            return [2, gdWindowContext.Glue({\r\n                                    windows: true,\r\n                                    logger: (_c = builtCoreConfig.glue) === null || _c === void 0 ? void 0 : _c.logger,\r\n                                    channels: shouldInitializeChannels,\r\n                                    layouts: true,\r\n                                    appManager: shouldInitializeAppManager,\r\n                                    libraries: config.libraries\r\n                                })];\r\n                        }\r\n                    }\r\n                    control = new Control();\r\n                    ext = {\r\n                        libs: [\r\n                            {\r\n                                name: \"notifications\",\r\n                                create: function (coreLib) { return new Notifications(coreLib.interop); }\r\n                            }\r\n                        ],\r\n                        version: version\r\n                    };\r\n                    if (shouldInitializeChannels) {\r\n                        channelsLib = {\r\n                            name: \"channels\",\r\n                            create: function (coreLib) { return new Channels(coreLib.contexts, builtCoreConfig.channels); }\r\n                        };\r\n                        (_d = ext.libs) === null || _d === void 0 ? void 0 : _d.push(channelsLib);\r\n                    }\r\n                    if (isWebEnvironment) {\r\n                        (_e = ext.libs) === null || _e === void 0 ? void 0 : _e.push({\r\n                            name: \"windows\",\r\n                            create: function (coreLib) {\r\n                                windows = new Windows(coreLib.interop, control);\r\n                                return windows;\r\n                            }\r\n                        }, {\r\n                            name: \"layouts\",\r\n                            create: function (coreLib) {\r\n                                var _a, _b;\r\n                                var remoteStore;\r\n                                if (((_a = builtCoreConfig.layouts) === null || _a === void 0 ? void 0 : _a.remoteType) === \"json\") {\r\n                                    var baseLocation = ((_b = builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue.assets) === null || _b === void 0 ? void 0 : _b.location) || defaultAssetsBaseLocation;\r\n                                    remoteStore = new JSONStore(baseLocation);\r\n                                }\r\n                                var localStore = new LocalStore();\r\n                                var autoStore = new AutoStorage();\r\n                                var layoutsStorage = new LayoutStorage(localStore, autoStore, remoteStore);\r\n                                layoutsController = new LayoutsController(layoutsStorage, windows, control, coreLib.interop, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue);\r\n                                return new Layouts(layoutsController);\r\n                            }\r\n                        });\r\n                        appManagerLib = {\r\n                            name: \"appManager\",\r\n                            create: function (coreLib) {\r\n                                var _a;\r\n                                appManager = new AppManager(windows, coreLib.interop, control, builtCoreConfig.appManager, (_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.application);\r\n                                return shouldInitializeAppManager ? appManager : undefined;\r\n                            }\r\n                        };\r\n                        intentsLib = {\r\n                            name: \"intents\",\r\n                            create: function (coreLib) { return new Intents(coreLib.interop, windows, appManager); }\r\n                        };\r\n                        (_f = ext.libs) === null || _f === void 0 ? void 0 : _f.push(appManagerLib, intentsLib);\r\n                    }\r\n                    coreConfig = {\r\n                        gateway: {\r\n                            sharedWorker: (_h = (_g = builtCoreConfig.glue) === null || _g === void 0 ? void 0 : _g.worker) !== null && _h !== void 0 ? _h : defaultWorkerLocation,\r\n                            inproc: (_j = builtCoreConfig.glue) === null || _j === void 0 ? void 0 : _j.inproc\r\n                        },\r\n                        logger: (_k = builtCoreConfig.glue) === null || _k === void 0 ? void 0 : _k.logger,\r\n                        application: (_l = builtCoreConfig.glue) === null || _l === void 0 ? void 0 : _l.application\r\n                    };\r\n                    if (isWebEnvironment && !window.SharedWorker) {\r\n                        throw new Error(\"Cannot initialize Glue Web, because this environment does not support Shared Workers\");\r\n                    }\r\n                    return [4, promisePlus(function () { return coreFactoryFunction(coreConfig, ext); }, 10000, \"Glue Web initialization timed out\")];\r\n                case 2:\r\n                    core = _r.sent();\r\n                    if (!(config === null || config === void 0 ? void 0 : config.libraries)) return [3, 4];\r\n                    return [4, Promise.all(config.libraries.map(function (lib) { return lib(core, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue); }))];\r\n                case 3:\r\n                    _r.sent();\r\n                    _r.label = 4;\r\n                case 4:\r\n                    if (!isWebEnvironment) return [3, 9];\r\n                    return [4, initStartupContext(core.windows.my(), core.interop, (_m = core.appManager) === null || _m === void 0 ? void 0 : _m.myInstance)];\r\n                case 5:\r\n                    _r.sent();\r\n                    if (!((_p = (_o = builtCoreConfig.glue) === null || _o === void 0 ? void 0 : _o.layouts) === null || _p === void 0 ? void 0 : _p.autoRestore)) return [3, 7];\r\n                    return [4, (layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.restoreAutoSavedLayout())];\r\n                case 6:\r\n                    _r.sent();\r\n                    _r.label = 7;\r\n                case 7: return [4, hookCloseEvents(core, (_q = builtCoreConfig.glue) !== null && _q !== void 0 ? _q : {}, control, layoutsController)];\r\n                case 8:\r\n                    _r.sent();\r\n                    _r.label = 9;\r\n                case 9:\r\n                    control.start(core.interop, core.logger.subLogger(\"control\"));\r\n                    return [2, core];\r\n            }\r\n        });\r\n    }); };\r\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$2 = function() {\r\n    __assign$2 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$2.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    var _this = this;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metric, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (system.parent === undefined) {\r\n                        return [2];\r\n                    }\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    metric = {\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        type: \"object\",\r\n                        composite: {\r\n                            Description: {\r\n                                type: \"string\",\r\n                                description: \"\",\r\n                            },\r\n                            Value: {\r\n                                type: \"number\",\r\n                                description: \"\",\r\n                            },\r\n                        },\r\n                        description: \"System state\",\r\n                        context: {},\r\n                    };\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [metric],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateSystem = function (system, state) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var shadowedUpdateMetric, stateObj, rootMetric;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    shadowedUpdateMetric = {\r\n                        type: \"publish\",\r\n                        values: [{\r\n                                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                                value: {\r\n                                    Description: state.description,\r\n                                    Value: state.state,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(shadowedUpdateMetric);\r\n                    stateObj = composeMsgForRootStateMetric(system);\r\n                    rootMetric = {\r\n                        type: \"publish\",\r\n                        peer_id: connection.peerId,\r\n                        values: [{\r\n                                name: \"/State\",\r\n                                value: {\r\n                                    Description: stateObj.description,\r\n                                    Value: stateObj.value,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(rootMetric);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var createMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone, m, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    m = serializeMetric(metricClone);\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [m],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    if (typeof metricClone.value !== \"undefined\") {\r\n                        updateMetricCore(metricClone);\r\n                    }\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    updateMetricCore(metricClone);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            return session.sendFireAndForget(publishMetricsMsg);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign$2({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign$2({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends$1(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends$1(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends$1(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends$1(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing\r\n                    .update(value)\r\n                    .catch(function () { });\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar PerfTracker = (function () {\r\n    function PerfTracker(api, initialPublishTimeout, publishInterval) {\r\n        this.api = api;\r\n        this.lastCount = 0;\r\n        this.initialPublishTimeout = 10 * 1000;\r\n        this.publishInterval = 60 * 1000;\r\n        this.initialPublishTimeout = initialPublishTimeout !== null && initialPublishTimeout !== void 0 ? initialPublishTimeout : this.initialPublishTimeout;\r\n        this.publishInterval = publishInterval !== null && publishInterval !== void 0 ? publishInterval : this.publishInterval;\r\n        this.scheduleCollection();\r\n        this.system = this.api.subSystem(\"performance\", \"Performance data published by the web application\");\r\n    }\r\n    PerfTracker.prototype.scheduleCollection = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.collect();\r\n            setInterval(function () {\r\n                _this.collect();\r\n            }, _this.publishInterval);\r\n        }, this.initialPublishTimeout);\r\n    };\r\n    PerfTracker.prototype.collect = function () {\r\n        try {\r\n            this.collectMemory();\r\n            this.collectEntries();\r\n        }\r\n        catch (_a) {\r\n        }\r\n    };\r\n    PerfTracker.prototype.collectMemory = function () {\r\n        var memory = window.performance.memory;\r\n        this.system.stringMetric(\"memory\", JSON.stringify({\r\n            totalJSHeapSize: memory.totalJSHeapSize,\r\n            usedJSHeapSize: memory.usedJSHeapSize\r\n        }));\r\n    };\r\n    PerfTracker.prototype.collectEntries = function () {\r\n        var allEntries = window.performance.getEntries();\r\n        if (allEntries.length <= this.lastCount) {\r\n            return;\r\n        }\r\n        this.lastCount = allEntries.length;\r\n        this.system.stringMetric(\"entries\", JSON.stringify(allEntries));\r\n    };\r\n    return PerfTracker;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    var rootSystem = repo.root;\r\n    if (!options.disableAutoAppSystem) {\r\n        rootSystem = rootSystem.subSystem(\"App\");\r\n    }\r\n    var api = addFAVSupport(rootSystem);\r\n    initPerf(api, options.pagePerformanceMetrics);\r\n    return api;\r\n});\r\nvar perf;\r\nfunction initPerf(api, config) {\r\n    var _a, _b;\r\n    if (typeof window === \"undefined\") {\r\n        return;\r\n    }\r\n    var perfConfig = (_b = (_a = window === null || window === void 0 ? void 0 : window.glue42gd) === null || _a === void 0 ? void 0 : _a.metrics) === null || _b === void 0 ? void 0 : _b.pagePerformanceMetrics;\r\n    if (perfConfig) {\r\n        config = perfConfig;\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.enabled) {\r\n        perf = new PerfTracker(api, config.initialPublishTimeout, config.publishInterval);\r\n    }\r\n}\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            if (allForKey.length === 0) {\r\n                delete callbacks[key];\r\n            }\r\n            else {\r\n                callbacks[key] = allForKey;\r\n            }\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib$2();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib$2();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar timers = {};\r\nfunction getAllTimers() {\r\n    return timers;\r\n}\r\nfunction timer (timerName) {\r\n    var existing = timers[timerName];\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    var marks = [];\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    mark(\"start\", startTime);\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        mark(\"end\", endTime);\r\n        period = endTime - startTime;\r\n        return period;\r\n    }\r\n    function mark(name, time) {\r\n        var currentTime = time !== null && time !== void 0 ? time : now();\r\n        var diff = 0;\r\n        if (marks.length > 0) {\r\n            diff = currentTime - marks[marks.length - 1].time;\r\n        }\r\n        marks.push({ name: name, time: currentTime, diff: diff });\r\n    }\r\n    var timerObj = {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop,\r\n        mark: mark,\r\n        marks: marks\r\n    };\r\n    timers[timerName] = timerObj;\r\n    return timerObj;\r\n}\n\nvar WebSocketConstructor = Utils.isNode() ? require(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this.startupTimer = timer(\"connection\");\r\n        this._running = true;\r\n        this._registry = lib$2();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.startupTimer.mark(\"opening-socket\");\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.startupTimer.mark(\"socket-initiated\");\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.startupTimer.mark(\"ws-opened\");\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$1$1(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$1$1,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$1$1 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1$1.lookup, version);\n    str = str + encode_1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1 = lib$1$1.generate;\nvar lib_2 = lib$1$1.seed;\nvar lib_3 = lib$1$1.worker;\nvar lib_4 = lib$1$1.characters;\nvar lib_5 = lib$1$1.decode;\nvar lib_6 = lib$1$1.isValid;\n\nvar shortid$1 = lib$1$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib$2();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid$1();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        return connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib$2();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected.bind(_this), _this.settings.reconnectInterval || 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib$2();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        timer(\"connection\").mark(\"transport-opened\");\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        timer(\"connection\").mark(\"protocol-logged-in\");\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        try {\r\n                            _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                        }\r\n                        catch (loggerError) {\r\n                            console.log(\"Message handler failed\", error);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            var interop = Logger.Interop;\r\n            if (interop) {\r\n                try {\r\n                    if (interop.methods({ name: Logger.InteropMethodName }).length > 0) {\r\n                        interop.invoke(Logger.InteropMethodName, {\r\n                            msg: \"\" + message,\r\n                            logger: loggerName,\r\n                            level: level\r\n                        });\r\n                    }\r\n                }\r\n                catch (_a) {\r\n                }\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version$2 = \"5.2.7\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d, _e;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_f) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid$1();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version$2\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid$1();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"warn\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        var gdConsoleLevel;\r\n        if (glue42gd) {\r\n            gdConsoleLevel = glue42gd.consoleLogLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    var application = getApplication();\r\n    if (typeof window !== \"undefined\") {\r\n        var windowAsAny = window;\r\n        var containerApplication = windowAsAny.htmlContainer ?\r\n            windowAsAny.htmlContainer.containerName + \".\" + windowAsAny.htmlContainer.application : (_a = windowAsAny === null || windowAsAny === void 0 ? void 0 : windowAsAny.glue42gd) === null || _a === void 0 ? void 0 : _a.application;\r\n        if (containerApplication) {\r\n            application = containerApplication;\r\n        }\r\n    }\r\n    return {\r\n        bus: (_b = configuration.bus) !== null && _b !== void 0 ? _b : false,\r\n        application: application,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_c = configuration.metrics) !== null && _c !== void 0 ? _c : true,\r\n        contexts: (_d = configuration.contexts) !== null && _d !== void 0 ? _d : true,\r\n        version: ext.version || version$2,\r\n        libs: (_e = ext.libs) !== null && _e !== void 0 ? _e : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta, logger) {\r\n    try {\r\n        if (logger === null || logger === void 0 ? void 0 : logger.canPublish(\"trace\")) {\r\n            logger === null || logger === void 0 ? void 0 : logger.trace(\"applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context));\r\n        }\r\n        if (!delta) {\r\n            return context;\r\n        }\r\n        if (delta.reset) {\r\n            context = __assign$2({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        if (delta.commands) {\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    deletePath(context, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(context, command.value, command.path);\r\n                }\r\n            }\r\n            return context;\r\n        }\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n        return context;\r\n    }\r\n    catch (e) {\r\n        logger === null || logger === void 0 ? void 0 : logger.error(\"error applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context), e);\r\n        return context;\r\n    }\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction setValueToPath(obj, value, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        if (typeof obj[pathArr[i]] !== \"object\") {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    obj[pathArr[i]] = value;\r\n}\r\nfunction deletePath(obj, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            return;\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    delete obj[pathArr[i]];\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._protocolVersion = undefined;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(GW3Bridge.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._protocolVersion) {\r\n                var contextsDomainInfo = this._connection.availableDomains.find(function (d) { return d.uri === \"context\"; });\r\n                this._protocolVersion = (_a = contextsDomainInfo === null || contextsDomainInfo === void 0 ? void 0 : contextsDomainInfo.version) !== null && _a !== void 0 ? _a : 1;\r\n            }\r\n            return this._protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(GW3Bridge.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this.protocolVersion >= 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            _this._contextIdToName[createContextMsg.context_id] = name;\r\n            var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n            contextData.isAnnounced = true;\r\n            contextData.name = name;\r\n            contextData.contextId = createContextMsg.context_id;\r\n            contextData.context = data;\r\n            _this._contextNameToData[name] = contextData;\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name)];\r\n                    case 1:\r\n                        currentContext = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.protocolVersion === 2 ?\r\n                            this.calculateContextDeltaV2(currentContext, delta) :\r\n                            this.calculateContextDeltaV1(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length\r\n                            && !((_a = calculatedDelta.commands) === null || _a === void 0 ? void 0 : _a.length)) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.setPath = function (name, path, value) {\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPath operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        return this.setPaths(name, [{ path: path, value: value }]);\r\n    };\r\n    GW3Bridge.prototype.setPaths = function (name, pathValues) {\r\n        var _this = this;\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            var obj = {};\r\n            for (var _i = 0, pathValues_1 = pathValues; _i < pathValues_1.length; _i++) {\r\n                var pathValue = pathValues_1[_i];\r\n                setValueToPath(obj, pathValue.value, pathValue.path);\r\n            }\r\n            return this.createContext(name, obj);\r\n        }\r\n        var commands = [];\r\n        for (var _a = 0, pathValues_2 = pathValues; _a < pathValues_2.length; _a++) {\r\n            var pathValue = pathValues_2[_a];\r\n            if (pathValue.value === null) {\r\n                commands.push({ type: \"remove\", path: pathValue.path });\r\n            }\r\n            else {\r\n                commands.push({ type: \"set\", path: pathValue.path, value: pathValue.value });\r\n            }\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { commands: commands }\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { added: {}, removed: [], updated: {}, commands: commands }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var _a;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return Promise.resolve({});\r\n        }\r\n        if (contextData && !contextData.hasCallbacks()) {\r\n            return new Promise(function (resolve, _) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator$1(this, function (_a) {\r\n                    this.subscribe(name, function (data, _d, _r, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        var context = (_a = contextData === null || contextData === void 0 ? void 0 : contextData.context) !== null && _a !== void 0 ? _a : {};\r\n        return Promise.resolve(context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context && contextData.sentExplicitSubscription) {\r\n                    var clone = deepClone(contextData.context);\r\n                    callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                var clone = deepClone(contextData.context);\r\n                callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            var clone = deepClone(contextData.context);\r\n            callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.destroy = function (name) {\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData) {\r\n            return Promise.reject(\"context with \" + name + \" does not exist\");\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_DESTROY_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta, this._logger);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta, this._logger);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        if (delta.commands) {\r\n            delta.added = delta.updated = delta.reset = {};\r\n            delta.removed = [];\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    if (command.path.indexOf(\".\") === -1) {\r\n                        delta.removed.push(command.path);\r\n                    }\r\n                    setValueToPath(delta.updated, null, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(delta.updated, command.value, command.path);\r\n                }\r\n            }\r\n        }\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(contextData.context), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV1 = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV2 = function (from, to) {\r\n        var _a, _b;\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined, commands: [] };\r\n        for (var _i = 0, _c = Object.keys(to); _i < _c.length; _i++) {\r\n            var x = _c[_i];\r\n            if (to[x] !== null) {\r\n                var fromX = from ? from[x] : null;\r\n                if (!deepEqual(fromX, to[x])) {\r\n                    (_a = delta.commands) === null || _a === void 0 ? void 0 : _a.push({ type: \"set\", path: x, value: to[x] });\r\n                }\r\n            }\r\n            else {\r\n                (_b = delta.commands) === null || _b === void 0 ? void 0 : _b.push({ type: \"remove\", path: x });\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.update(name, data);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.setPath = function (name, path, data) {\r\n        this.checkName(name);\r\n        this.checkPath(path);\r\n        var isTopLevelPath = path === \"\";\r\n        if (isTopLevelPath) {\r\n            this.checkData(data);\r\n            return this.set(name, data);\r\n        }\r\n        return this._bridge.setPath(name, path, data);\r\n    };\r\n    ContextsModule.prototype.setPaths = function (name, paths) {\r\n        this.checkName(name);\r\n        if (!Array.isArray(paths)) {\r\n            throw new Error(\"Please provide the paths as an array of PathValues!\");\r\n        }\r\n        for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\r\n            var _a = paths_1[_i], path = _a.path, value = _a.value;\r\n            this.checkPath(path);\r\n            var isTopLevelPath = path === \"\";\r\n            if (isTopLevelPath) {\r\n                this.checkData(value);\r\n            }\r\n        }\r\n        return this._bridge.setPaths(name, paths);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.destroy = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.destroy(name);\r\n    };\r\n    Object.defineProperty(ContextsModule.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this._bridge.setPathSupported;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" || name === \"\") {\r\n            throw new Error(\"Please provide the name as a non-empty string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkPath = function (path) {\r\n        if (typeof path !== \"string\") {\r\n            throw new Error(\"Please provide the path as a dot delimited string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkData = function (data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Please provide the data as an object!\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, promise, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    var timeout;\r\n    promise.finally(function () {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n    });\r\n    return new Promise(function (resolve, reject) {\r\n        timeout = setTimeout(function () { return reject(error); }, ms);\r\n    });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign$2({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign$2({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator$1(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign$2({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign$2(__assign$2({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid$1();\r\n                                    var method = serversMethodPair.methods[0];\r\n                                    var server = serversMethodPair.server;\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, method, argumentObj, server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, invokePromise, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached for method name: \" + (method === null || method === void 0 ? void 0 : method.name) + \", target instance: \" + JSON.stringify(server.instance) + \", options: \" + JSON.stringify(additionalOptionsCopy),\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign$2({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign$2({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid$1();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib$2();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib$2();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib$2();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer(\"glue\");\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            inner.marks = t.marks;\r\n            if (_allowTrace) {\r\n                _logger.trace(name + \" is ready - \" + (t.endTime - t.startTime));\r\n            }\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer(\"connection\");\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                authPromise = glue42gd.getGWToken()\r\n                    .then(function (token) {\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            initTimer.mark(\"auth-promise-resolved\");\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer(\"logger\");\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        if (_logger.canPublish(\"debug\")) {\r\n            _logger.debug(\"initializing glue...\");\r\n        }\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c, _d;\r\n        var initTimer = timer(\"metrics\");\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var disableAutoAppSystem = (_a = (typeof config !== \"boolean\" && config.disableAutoAppSystem)) !== null && _a !== void 0 ? _a : false;\r\n        _metrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_b = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _b !== void 0 ? _b : \"metrics-service\",\r\n            instance: (_d = (_c = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _c !== void 0 ? _c : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _d !== void 0 ? _d : shortid$1(),\r\n            disableAutoAppSystem: disableAutoAppSystem,\r\n            pagePerformanceMetrics: typeof config !== \"boolean\" ? config === null || config === void 0 ? void 0 : config.pagePerformanceMetrics : undefined\r\n        });\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer(\"interop\");\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer(\"contexts\");\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator$1(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer(\"bus\");\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer(name);\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version$2,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var all = getAllTimers();\r\n                return Object.keys(all).map(function (key) {\r\n                    var t = all[key];\r\n                    return {\r\n                        name: key,\r\n                        duration: t.endTime - t.startTime,\r\n                        marks: t.marks\r\n                    };\r\n                });\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        if (glue.agm) {\r\n            var deprecatedDecorator = function (fn, wrong, proper) {\r\n                return function () {\r\n                    glue.logger.warn(\"glue.js - 'glue.agm.\" + wrong + \"' method is deprecated, use 'glue.interop.\" + proper + \"' instead.\");\r\n                    fn.apply(glue.agm, arguments);\r\n                };\r\n            };\r\n            var agmAny = glue.agm;\r\n            agmAny.method_added = deprecatedDecorator(glue.agm.methodAdded, \"method_added\", \"methodAdded\");\r\n            agmAny.method_removed = deprecatedDecorator(glue.agm.methodRemoved, \"method_removed\", \"methodRemoved\");\r\n            agmAny.server_added = deprecatedDecorator(glue.agm.serverAdded, \"server_added\", \"serverAdded\");\r\n            agmAny.server_method_aded = deprecatedDecorator(glue.agm.serverMethodAdded, \"server_method_aded\", \"serverMethodAdded\");\r\n            agmAny.server_method_removed = deprecatedDecorator(glue.agm.serverMethodRemoved, \"server_method_removed\", \"serverMethodRemoved\");\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version$2;\r\nGlueCore.default = GlueCore;\n\nvar glueWebFactory = createFactoryFunction(GlueCore);\r\nif (typeof window !== \"undefined\") {\r\n    var windowAny = window;\r\n    windowAny.GlueWeb = glueWebFactory;\r\n    delete windowAny.GlueCore;\r\n}\r\nglueWebFactory.default = glueWebFactory;\r\nglueWebFactory.version = version;\n\nexport default glueWebFactory;\n//# sourceMappingURL=web.es.js.map\n","import createDesktopAgent from \"./agent\";\nimport Glue, { Glue42 } from \"@glue42/desktop\";\nimport GlueWebFactory, { Glue42Web } from \"@glue42/web\";\nimport { isGlue42Core, waitFor } from \"./utils\";\nimport { version } from \"../package.json\";\nimport { WindowType } from \"./types/windowtype\";\nimport { DesktopAgent } from \"@finos/fdc3\";\nimport { Glue42GD, Glue42GDOriginalGlue } from \"./types/glue42gd\";\n\nconst defaultGlueConfig = {\n    application: (window as WindowType).fdc3AppName,\n    context: true,\n    channels: true,\n    agm: true\n};\n\nconst validateGlue = (glue: Glue42.Glue | Glue42Web.API): void => {\n    const apisFDC3ReliesUpon: [\"contexts\", \"intents\", \"channels\", \"agm\", \"appManager\"] = [\n        \"contexts\",\n        \"intents\",\n        \"channels\",\n        \"agm\",\n        \"appManager\"\n    ];\n\n    for (const apiFDC3ReliesUpon of apisFDC3ReliesUpon) {\n        if (typeof glue[apiFDC3ReliesUpon] === \"undefined\") {\n            throw new Error(`Failed to initialize @glue42/fdc3. @glue42/fdc3 depends on the Glue42 ${apiFDC3ReliesUpon.replace(/^./, apiFDC3ReliesUpon[0].toUpperCase())} API being available. Ignore this error if you do not plan on using FDC3.`);\n        }\n    }\n};\n\nconst resolveGlue = (glue: Glue42.Glue | Glue42Web.API): Glue42.Glue | Glue42Web.API => {\n    validateGlue(glue);\n    (window as WindowType).glue = glue;\n\n    return glue;\n};\n\nconst setupGlue42Core = (): void => {\n    (window as WindowType).fdc3GluePromise = GlueWebFactory({\n        ...defaultGlueConfig,\n        appManager: true\n    })\n        .then((glue) => {\n            return resolveGlue(glue);\n        });\n};\n\nconst setupGlue42Enterprise = (): void => {\n    (window as WindowType).fdc3GluePromise = waitFor<void>(() => typeof (window as WindowType).glue42gd !== \"undefined\", 300)\n        .then(() => {\n            // Whether to initialize glue or to reuse an existing instance.\n            const shouldInitGlue = ((window as WindowType).glue42gd as Glue42GD).fdc3InitsGlue;\n\n            if (shouldInitGlue) {\n                // Use the auto-injected Glue factory function if available.\n                const GlueFactory = (window as WindowType).Glue || Glue;\n\n                return GlueFactory({\n                    ...defaultGlueConfig,\n                    appManager: \"full\"\n                });\n            } else {\n                const predicate = (): boolean => {\n                    const length = ((window as WindowType).glue42gd as Glue42GD).originalGlue?.instances?.length;\n\n                    return typeof length !== \"undefined\" && length > 0;\n                };\n\n                return waitFor<Glue42.Glue>(predicate, 300, () => (((window as WindowType).glue42gd as Glue42GD).originalGlue as Glue42GDOriginalGlue).instances[0]);\n            }\n        })\n        .then((glue) => {\n            return resolveGlue(glue);\n        });\n};\n\nconst setupGlue = (): void => {\n    if (isGlue42Core) {\n        setupGlue42Core();\n    } else {\n        setupGlue42Enterprise();\n    }\n};\n\nconst fdc3Factory = (): DesktopAgent & { version: string } => {\n    setupGlue();\n\n    const agentApi = createDesktopAgent();\n\n    return {\n        ...agentApi,\n        version\n    };\n};\n\nexport default fdc3Factory;\n","import fdc3Factory from \"./main\";\nimport { WindowType } from \"./types/windowtype\";\n\nlet globalFdc3 = (window as WindowType).fdc3;\n\nif (typeof globalFdc3 === \"undefined\") {\n    globalFdc3 = fdc3Factory();\n\n    (window as WindowType).fdc3 = globalFdc3;\n} else {\n    console.warn(\"Defaulting to using the auto-injected fdc3.\");\n}\n\nexport default globalFdc3;\n"],"names":["OpenError","ResolveError","ChannelError","ContextTypes","Intents","newSubscribe","id","callback","didReplay","window","glue","contexts","subscribe","data","delta","removed","unsubscribe","extraData","updaterId","interop","instance","isEmptyObject","obj","Object","keys","length","constructor","isGlue42Core","navigator","userAgent","toLowerCase","includes","AsyncListener","actualUnsub","[object Object]","then","unsubFunc","console","error","waitFor","predicate","retryMs","resolution","Promise","resolve","resolvePromise","interval","setInterval","clearInterval","SystemChannel","glChannel","this","name","displayMetadata","meta","context","channels","publish","contextType","channel","get","type","contextTypeInput","handlerInput","arguments","handler","unsubPromise","subscribeFor","unsub","join","leave","AppChannel","update","createChannelsAgent","currentChannel","pendingSubscription","systemChannels","initDone","fdc3GluePromise","current","handleSwitchChannelUI","changed","channelId","setChannelsPromise","channelNames","all","map","channelContents","channelContext","mapToFDC3SystemChannel","setSystemChannelsPromise","doesAppChannelExist","some","ctxName","isSystem","n","glueChannel","mapToFDC3AppChannel","channelName","setCurrentChannel","createPendingListener","setActualUnsub","getSystemChannels","getOrCreateAppChannel","set","createNewAppChannel","tryLeaveSystem","addContextListener","warn","listener","windows","my","getContext","startupContext","subHandler","onNewData","newChannel","getOrCreateChannel","find","systemChannel","joinChannel","Error","NoChannelFound","appChannel","tryGetAppChannel","getCurrentChannel","leaveCurrentChannel","broadcast","convertGlue42IntentToFDC3AppIntent","glueIntent","handlers","appIntents","filter","dynamicInstanceIntents","appIntent","applicationName","handlersToUse","intent","displayName","apps","appName","app","appManager","application","title","applicationTitle","instanceTitle","tooltip","userProperties","description","applicationDescription","icons","applicationIcon","images","createIntentsAgent","open","props","AppNotFound","start","findIntent","glueIntents","intents","NoAppsFound","findIntentsByContext","raiseIntent","target","glueTarget","appInstances","instances","glueIntentResult","raise","source","version","result","addIntentListener","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","prototype","create","__assign","assign","t","s","i","call","apply","__awaiter","thisArg","_arguments","P","generator","reject","fulfilled","value","step","next","e","rejected","done","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","extendStatics$1","__extends$1","__assign$1","__awaiter$1","__generator$1","__spreadArrays","il","r","k","a","j","jl","MetricTypes","getMetricTypeByValue","metric","getTypeByValue","Date","serializeMetric","serializedMetrics","values","reduce","memo","key","innerType","composite","defineNestedComposite","normalizeMetricName","path","getMetricValueByType","now","publishNestedComposite","getTime","Boolean","toString","flatten","arr","flat","toFlatten","concat","isArray","composeMsgForRootStateMetric","system","merged","root","getAggregateState","highestState","sort","state","msg","forEach","m","idx","slice","aggregateDescription","Helpers","definition","parent","transport","BaseMetric","createMetric","defineProperty","_a","repo","enumerable","configurable","newValue","updateMetric","NumberMetric","_super","incrementBy","num","increment","decrement","decrementBy","ObjectMetric","mergeValues","_this","StringMetric","TimestampMetric","protocol","separator","_transport","_name","_description","_repo","_parent","_path","_buildPath","shadowedSystem","_state","_subSystems","_metrics","_getOrCreateMetric","metricObject","expectedType","metricDef","matching","shadowedMetric","existing","catch","me","subSystems","metrics","subSystem","nameSystem","descriptionSystem","match","_system","getState","setState","stateDescription","updateSystem","stringMetric","timestampMetric","objectMetric","numberMetric","aggState","shadowedSubSystem","createSystem","Repository","options","init","addSystemMetrics","clickStream","undefined","rootSystem","useClickStream","document","clickStream_1","documentClickHandler","timestamp","className","tagName","href","page","location","addEventListener","attachEvent","urlMetric","appNameMetric","startUrl","glue42gd","NullProtocol","PerfTracker","api","initialPublishTimeout","publishInterval","lastCount","scheduleCollection","setTimeout","collect","collectMemory","collectEntries","memory","performance","JSON","stringify","totalJSHeapSize","usedJSHeapSize","allEntries","getEntries","connection","config","joinPromise","session","replayRepo","replaySystem","ss","createMetricsMsg","Description","Value","send","metricClone","cloneMetric","updateMetricCore","canUpdate","publishMetricsMsg","sendFireAndForget","canUpdateMetric","_b","resolveReadyPromise","domain","onJoined","reconnect","defineRootMetricsMsg","service","shadowedUpdateMetric","stateObj","rootMetric","peer_id","peerId","gw3","disableAutoAppSystem","featureMetric","reportingSystem","def","featureMetricFunc","action","payload","addFAVSupport","perfConfig","pagePerformanceMetrics","enabled","initPerf","createRegistry","errorHandling","_userErrorHandler","callbacks","_handleError","exceptionArtifact","errParam","stack","add","replayArgumentsArr","callbacksForKey","replayArgument","err","allForKey","acc","element","index","execute","argumentsArr","_i","results","clear","clearKey","default","lib","InProcTransport","settings","logger","registry","gw","facade","connect","_client","message","messageHandler","client","sendObject","_msg","onMessage","onConnectedChanged","close","SharedWorkerTransport","workerFile","worker","SharedWorker","port","onmessage","postMessage","Utils","getGDMajorVersion","glueDesktop","ver","Number","substr","isNaN","isNode","_isNode","global","process","PromiseWrapper","resolved","promise","delay","time","timers","timer","timerName","marks","endTime","period","startTime","mark","currentTime","diff","timerObj","stop","WebSocketConstructor","require","WebSocket","WS","startupTimer","_running","_registry","wsRequests","ws","waitForSocketConnection","info","pw","failed","readyState","openSocket","retryInterval","retriesLeft","reconnectInterval","notifyForSocketState","debug","initiateSocket","retries","onerror","reason","seen_1","WeakSet","has","notifyStatusChanged","onclose","onopen","identity","wsRequest","status","seed","alphabet","previousSeed","shuffled","randomFromSeed","nextValue","_seed_","ORIGINAL","reset","setCharacters","_alphabet_","unique","split","item","ind","lastIndexOf","getShuffled","characterIndex","sourceArray","targetArray","Math","floor","splice","shuffle","alphabet_1","characters","lookup","crypto","msCrypto","randomByteBrowser","getRandomValues","random","dest","Uint8Array","encode_1","number","loopCounter","str","pow","decode_1","indexOf","isValid","len","lib$1","fn","module","exports","createCommonjsModule","counter","previousSeconds","clusterWorkerId","generate","seconds","seedValue","workerId","newCharacters","decode","shortid","domainSession","successMessages","errorMessages","_latestOptions","isJoined","tryReconnecting","_connectionOn","disconnected","loggedIn","on","handleSuccessMessage","handleErrorMessage","sm","requestsMap","destination","wasReconnect","handleJoined","requestId","request_id","entry","success","getNextRequestId","tag","skipPeerId","successMsg","_tag","errorMsg","onLeft","connected","GW3ProtocolImpl","protocolVersion","datePrefix","datePrefixLen","dateMinLen","datePrefixFirstChar","_isLoggedIn","shouldTryLogin","initialLogin","initialLoginAttempts","sessions","handleDisconnected","ping","processStringMessage","parse","substring","milliseconds","parseInt","ex","msgType","createStringMessage","oldToJson","toJSON","datePrefix_1","processObjectMessage","createObjectMessage","login","authentication","e_1","helloMsg","sendOptions","welcomeMsg","token","err_1","_c","loginConfig","username","password","gatewayToken","getNewGWToken","method","flowName","provider","flowCallback","sessionId","secret","globalDomain","subLogger","maxRetries","reconnectAttempts","Buffer","from","resolvedIdentity","resolved_identity","availableDomains","available_domains","access_token","setLoggedIn","logout","promises","pingTimer","clearTimeout","domainName","domainLogger","authToken","res","getGWToken","MessageReplayerImpl","specs","specsNames","messages","subs","subsRefCount","specs_1","spec","name_1","_loop_1","refCount","this_1","sub","processMessage","types","isDone","name_2","drain","off","Connection","messageHandlers","ids","_connected","isTrace","inproc","sharedWorker","canPublish","handleConnectionChanged","bind","handleTransportMessage","replaySpecs","replayer","isObjectBasedTransport","trace","strMessage","isLoggedIn","authRequest","distributeMessage","handlerId","loggerError","log","msgObj","order","Logger","logFn","subLoggers","customLogFn","loggerFullName","includeTimeAndLevel","existingSub","publishLevel","level","_publishLevel","consoleLevel","_consoleLevel","publishMessage","compareWith","loggerName","Interop","methods","InteropMethodName","invoke","prefix","date","getHours","getMinutes","getSeconds","getMilliseconds","toPrint","GW_MESSAGE_CREATE_CONTEXT","GW_MESSAGE_ACTIVITY_CREATED","GW_MESSAGE_ACTIVITY_DESTROYED","GW_MESSAGE_CONTEXT_CREATED","GW_MESSAGE_CONTEXT_ADDED","GW_MESSAGE_SUBSCRIBE_CONTEXT","GW_MESSAGE_SUBSCRIBED_CONTEXT","GW_MESSAGE_UNSUBSCRIBE_CONTEXT","GW_MESSAGE_DESTROY_CONTEXT","GW_MESSAGE_CONTEXT_DESTROYED","GW_MESSAGE_UPDATE_CONTEXT","GW_MESSAGE_CONTEXT_UPDATED","GW_MESSAGE_JOINED_ACTIVITY","ContextMessageReplaySpec","GW3ContextData","contextId","isAnnounced","activityId","updateCallbacks","hasCallbacks","applyContextDelta","deepClone","commands","command","deletePath","setValueToPath","added_1","added","updated_1","updated","mergeObjectsProperties","hash","WeakMap","Set","RegExp","flags","Map","val","what","withWhat","right","left","deepEqual","x","pathArr","InvokeStatus","GW3Bridge","_contextNameToData","_gw3Subscriptions","_nextCallbackSubscriptionNumber","_contextNameToId","_contextIdToName","_protocolVersion","_connection","_logger","_gw3Session","subscribeToContextCreatedMessages","subscribeToContextUpdatedMessages","subscribeToContextDestroyedMessages","handleContextCreatedMessage","handleContextUpdatedMessage","handleContextDestroyedMessage","contextsDomainInfo","uri","dispose","contextName","createContext","lifetime","createContextMsg","context_id","contextData","currentContext","calculatedDelta","calculateContextDeltaV2","calculateContextDeltaV1","gwResponse","handleUpdated","setPath","setPathSupported","setPaths","pathValues","pathValues_1","pathValue","pathValues_2","_d","_r","un","thisCallbackSubscriptionNumber","clone","hadCallbacks","joinedActivity","sentExplicitSubscription","sendSubscribe","subscriptionKey","sendUnsubscribe","destroy","oldContext","invokeUpdateCallbacks","createdMessageTypes_1","createdMessageType","contextCreatedMsg","activity_id","updatedMessageTypes_1","updatedMessageType","contextUpdatedMsg","justSeen","context_snapshot","updater_id","updateCallbackIndex","updateCallback","destroyedMessageTypes_1","destroyedMessageType","destroyedMsg","to","ContextsModule","_bridge","checkName","checkData","checkPath","paths","paths_1","ready","promisify","successCallback","errorCallback","rejectAfter","ms","timeout","finally","Client","configuration","callProtocolSubscribe","targetServers","stream","successProxy","errorProxy","methodResponseTimeout","waitTimeoutMs","methodDef","method_response_timeout","wait_for_method_timeout","delayTillNow","currentServers","getServerMethodsByFilterAndTarget","retry_1","streamInfo","servers","methodFilter","filterCopy","getServers","serverMethodMap","server","getMethods","methodsForInstance","getMethodsForInstance","methodAdded","onMethodAdded","methodRemoved","onMethodRemoved","serverAdded","onServerAdded","serverRemoved","onServerRemoved","serverMethodAdded","onServerMethodAdded","serverMethodRemoved","onServerMethodRemoved","argumentObj","additionalOptions","methodDefinition","serversMethodMap","errorObj","additionalOptionsCopy","invokePromises","invocationMessages","methodResponseTimeoutMs","tryToAwaitForMethods","supportsStreaming","objectTypes","called_with","executed_by","returned","serversMethodPair","invId","invokePromise","race","invocationId","getInvocationResultObj","every","getInvokePromise","invocationResults","calledWith","all_return_values","invokeMessage","Success","allValues","currentValue","all_errors","allErrors","currError","invResult","filterByTarget","matches","myMatches","serverMethodPair","instanceMatch","localMachine","isLocal","instanceFilter","instanceDefinition","containsProps","methodMatch","repoMethod","prop","isMatch","filterValue","repoMethodValue","filterObjTypes","repoObjectTypes","objTypeToContains","object","objType","repoObjType","isFullfiled","containsAllFromFilter","String","matchingServers","resultMethodsObject","methodKey","identifier","prev","matchingMethods","getServerMethodsById","ServerSubscription","subscription","branchKey","closeSingleSubscription","pushDataToSingle","Request","requestContext","accept","acceptRequestOnBranch","acceptOnBranch","branch","rejectRequest","ServerStreaming","onSubRequest","rc","rm","handleSubRequest","onSubAdded","handleSubAdded","onSubRemoved","handleSubRemoved","streamCallbacks","subscriptionRequestHandler","request","subscriptionAddedHandler","subscriptionRemovedHandler","ServerBranch","subscriptions","getSubscriptionList","closeAllSubscriptions","pushData","ServerStream","_protocol","_repoMethod","_server","branches","bList","getBranchList","def2","accepts","returns","unregister","updateRepoMethod","Server","serverRepository","invocations","currentlyUnregistering","streaming","onInvoked","onMethodInvoked","createStream","streamDef","existingStream","streamMethodDefinition","getList","serverMethod","protocolState","streamUserObject","repoId","remove","register","wrappedCallbackFunction","resultCallback","resultValue","args","userCallback","registerCore","registerAsync","wrappedCallback","resultCalled_1","methodResult","userCallbackAsync","forStream","methodToBeRemoved","unregisterWithPredicate","removeMethodsOrStreams","filterPredicate","methodsOrStreamsToRemove","methodsToRemove","methodUnregPromises","addAsCurrentlyUnregistering","methodName","theFunction","unregisterInProgress","methodToExecute","invocationArgs","unStrException","_value","methodInvocationResult","InstanceWrapper","wrapped","getStreams","refreshWrappedObject","refresh","unwrap","user","pid","machine","environment","region","windowId","API","ClientRepository","methodsCount","addServer","serverId","wrapper","serverEntry","removeServerById","methodId","removeServerMethod","addServerMethod","createMethodIdentifier","that","gatewayId","display_name","object_types","input_signature","result_signature","getServersByMethod","allMethods","allServers","unsubscribeFunc","serversWithMethodsToReplay","returnUnsubWithDelayedReplay","methodsToReplay","unsubCalled","getServerById","methodInfo","collectionToReplay","ServerRepository","nextId","getById","SUBSCRIPTION_REQUEST","SUBSCRIPTION_ADDED","SUBSCRIPTION_REMOVED","ServerStreaming$1","repository","ERR_URI_SUBSCRIPTION_FAILED","nextStreamId","handleAddInterest","handleRemoveInterest","streamingMethod","subscriptionsMap","branchKeyToStreamIdMap","streamId","getStreamId","subscription_id","subscribeMsg","stream_id","sendSubscriptionFailed","br","dropSubscriptionMessage","closeMultipleSubscriptions","subscriptionsToClose","drop","allSubscriptions","onSubscriptionLifetimeEvent","method_id","eventName","handlerFunc","getNextStreamId","caller_id","arguments_kv","subscriptionId","errorMessage","reason_uri","needleBranch","ServerProtocol","clientRepository","handleInvokeMessage","isStreaming","registerMsg","restrictions","invocation_id","callerId","UserSubscription","subscriptionData","params","trackedServers","pair","onData","dataCallback","queued","dataItem","onClosed","closedCallback","onFailed","onConnected","setNewSubscription","newSub","STATUS_AWAITING_ACCEPT","STATUS_SUBSCRIBED","ERR_MSG_SUB_FAILED","ON_CLOSE_MSG_CLIENT_INIT","ClientStreaming","subscriptionsList","subscriptionIdToLocalKeyMap","nextSubLocalKey","handleErrorSubscribing","errorResponse","subLocalKey","pendingSub","timeoutId","callArgs","callOnClosedHandlers","handleSubscribed","acceptingServer","isFirstResponse","serverInstance","handleEventData","trackedServersFound","isPrivateData","oob","sendingServerId","receivedStreamData","requestArguments","private","onDataHandlers","queuedData","handleSubscriptionCancelled","expectedNewLength","closers","getNextSubscriptionLocalKey","registerSubscription","server_id","drainSubscriptions","subsInfo","localKey","closeSubscription","closingServer","closersCount","closingServerId","ClientProtocol","handlePeerAdded","handlePeerRemoved","handleMethodsAddedMessage","handleMethodsRemovedMessage","handleResultMessage","handleInvocationError","newPeerId","new_peer_id","remoteId","local","serverInfo","removedPeerId","removed_id","methodIdList","gW3ProtocolFactory","libConfig","readyPromise","existingSubscriptions_1","registeredMethods","registeredMethods_1","handleReconnect","protocolPromise","MessageBus","topic","routingKey","removeEmptyValues","routing_key","target_identity","response","watchOnEvent","keysMatch","cleaned","obj1","obj2","keysObj1","allMatch","GlueCore","userConfig","ext","gdVersion","preloadPromise","gdPreloadPromise","_interop","_contexts","_bus","_allowTrace","glueInitTimer","internalConfig","_e","nodeStartingContext","startingContextString","env","_GD_STARTING_CONTEXT_","_f","getApplication","uid","applicationConfig","instanceId","gwConfig","gateway","gwURL","uniqueAppName","appInstanceId","getConnection","windowAsAny","containerApplication","htmlContainer","containerName","bus","auth","gwToken","getAuth","gdConsoleLevel","defaultLevel","consoleLogLevel","getLogger","libs","customLogger","prepareConfig","registerLib","inner","initTime","initEndTime","initStartTime","setupInterop","initTimer","agmConfig","setupContexts","hasActivities","activities","setupBus","setupExternalLibs","externalLibs","createCallback","setupExternalLib","authPromise","authConfig","metricsPublishingEnabledFunc","getMetricsPublishingEnabled","libsReadyPromises","coreVersion","feedback","feedbackInfo","agm","glueVer","glueConfig","browser","timing","initTimes","duration","extOptions","enrichGlue","updatePerfData","deprecatedDecorator","wrong","proper","agmAny","method_added","method_removed","server_added","server_method_aded","server_method_removed","ActivityEntity","_id","_update","other","_updateCore","_beforeDelete","isString","arg","isUndefined","isUndefinedOrNull","isFunction","ifNotUndefined","doWithIt","ActivityType","ownerWindow","helperWindows","_ownerWindow","_helperWindows","hw","covertToWindowDef","initiate","_manager","windowType","WindowType","appByWindowTypeGetter","_appByWindowTypeGetter","getWindows","activity","isIndependent","createWindow","EntityEvent","entitiy","entity","EntityEventContext","eventType","ActivityStatusChangeEventContext","newStatus","oldStatus","EntityEventType","StatusChange","ActivityContextChangedEventContext","ActivityContextChange","Added","Removed","Updated","Closed","ActivityWindowEvent","ActivityWindowJoinedActivity","ActivityWindowLeftActivity","ActivityState","Created","Started","Destroyed","ActivityAGM","_activity","_ensureHasAgm","AGM","w","methodNames","methodsForWindow","currentWindowMethod","activityServers","promisify$1","potentialTargets","firstElem","_isInstance","_isActivityWindow","win","parameters","AttachedActivityDescriptor","manager","ownerActivityId","_ownerActivityId","ownerId","windowIds","frameColor","detach","descriptor","detachActivities","nextTick","cb","nodeify","resp","Activity","actType","_actType","_status","_context","_ownerId","_agm","getActivityType","addWindow","addWindowToActivity","createStackedWindows","windowTypes","leaveWindowFromActivity","getWindowsByType","setContext","setActivityContext","updateContext","updateActivityContext","onStatusChange","subscribeActivityEvents","ns","os","onWindowEvent","subscribeWindowEvents","onContextChanged","subscribeActivityContextChanged","act","stopActivity","attach","attachActivities","onActivityAttached","subscribeActivitiesAttached","newActId","oldActId","onDetached","subscribeActivitiesDetached","newAct","originalActivity","_updateDescriptors","allStates","_attached","setFrameColor","color","callbacksToWait","underlyingWindow","getFrameColor","LogLevel","Trace","Debug","Info","Warn","Logger$1","GlueLogger","_glueLogger","GetNamed","Get","owner","GetTypeName","Level","_getMessage","exec","ActivityWindow","windowGetter","hcWindowId","_type","_activityId","_instance","_isIndependent","_windowGetter","_hcWindowId","getBounds","getWindowBounds","getWindowType","getActivityById","setVisible","isVisible","setWindowVisibility","activate","focus","activateWindow","setBounds","bounds","setWindowBounds","closeWindow","onActivityJoined","_subscribeForActivityWindowEvent","onActivityRemoved","event","ActivityStatus","getMessage","gwMmessageError","gwMessageAddActivityTypes","gwMessageActivityCreated","gwMessageActivityDestroyed","gwMessageActivityInitiated","gwMessageJoinedActivity","gwMessageActivityJoined","gwMessageActivityLeft","gwMessageOwnerChanged","gwMessageAddPeerFactories","gwMessagePeerFactoriesAdded","gwMessagePeerFactoriesRemoved","gwMessagePeerCreated","GW3Bridge$1","_activityChangeCallbacks","_activityTypeStatusChangeCallbacks","_activityWindowChangeCallbacks","_windowTypeStatusChangeCallbacks","_peerIdAndFactoryIdToPeerType","_peerFactoriesRegisteredByUs","_contextSubscriptions","_activityTypesInitiatedFromMe","_config","_windows","_sessionJoinedPromise","_sessionJoinedPromiseResolve","_activityJoinedPromise","_activityJoinedPromiseResolve","glue42gd_1","addRefreshHandler","setGWToken","activityTypeGwMessageEntityToActivityType","nameToWindowType","windowName","owner_type","helper_types","peerFactoryGwMessageEntityToWindowType","peer_type","activityGwMessageToActivity","owner_id","activity_type","activityToActivityStatusChangeEvent","forwardActivityTypeMessagesToStatusEventHandlers","handleActivityCreatedMessage","handleActivityDestroyedMessage","forwardActivityMessagesToStatusEventHandlers","forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers","forwardPeerFactoryMessagesToStatusEventHandlers","forwardPeerFactoryMessagesToPeerFactoryRequests","handlePeerFactoriesAdded","handlePeerFactoriesRemoved","forwardActivityWindowMessagesToEventHandlers","disposeRequestHandling","exit","mode","activity_types","typesToTrack","initReady","onActivityTypeStatusChange","registerActivityType","activityTypeName","toActivityPeerConfig","windowDefinition","activityType","invokeCallbacks","unregisterActivityType","onWindowTypeStatusChange","registerWindowFactory","factory","factories","unregisterWindowFactory","factory_ids","onActivityStatusChange","initiateActivity","initiateMsg","initial_context","isOverrideTypeDefinition","types_override","helpers","wd","sendCreateAndMapResultingMessagesToPromise","initMsg","fullReplace","removedKeys","removedKeys_1","announceWindow","activityWindowId","registerWindow","independent","shouldSendReady","activityInfo","getAgmInstance","generateWindowGetter","onActivityWindowChange","layout","width","height","top","cellSize","peer_name","created_id","joinActivity","destroy_peer_id","getAnnouncementInfo","announcementInfo","activityWindowType","activityWindowIndependent","activityWindowName","search","URLSearchParams","searchParams","maybeName","target_id","leaveActivity","getActivityTypes","getWindowTypes","getActivities","getActivityWindows","windowDefinitions","visible","cloneActivity","cloneOptions","into","merge","newActivityInfo","onActivitiesAttached","onActivitiesDetached","onActivityAttachedDescriptorsRefreshed","getAttachedDescriptors","getRandomRequestId","forwardAddedAndRemovedMessagesToEventHandler","addedMessageType","removedMessageType","mapper","getGetEntityEvent","isAdded","forwardMessageToEventHandler","messageType","getEntityEvent","ent","h","initiatedMessageType","initiatedMessageFilter","createdMessageFilter","cancelledMessageType","cancelledMessageFilter","createdMessageToPromiseResolution","resolveCreatedPromise","rejectCreatedPromise","initiatedSubscription","createdSubscription","cancelledSubscription","errorSubscription","reqId","createdPromise","initiatedMessageAck","dropSubscriptions","dropSubscription","msg4","msg1","msg2","msg3","toReturn","peerFactoryIdAndOwnerIdToWindowType","factoryId","peerType","subscribeToContext","unsubscribeContext","activityCreatedMessage","participants","createdMessage","peer_factory","gateway_token","joinedMessage","joinedId","joined_id","joinedType","joined_type","joinedName","joined_name","left_id","list","ActivityMy","_myAttached","_myDetached","_myAttachedTo","_myDetachedFrom","_myActivityFrameColorChanged","_myActivityJoinedCallbacks","_myActivityRemovedCallbacks","_myContextUpdateCallbacks","_m","am","_subscribeMyContextChanged","_subscribeMyWindowEvent","_subscribeActivitiesAttached","_subscribeActivitiesDetached","onWindowFrameColorChanged","_subscribeWindowFrameColorChanged","_w","announcedWindows","myWin","onActivityLeft","onActivityDetached","onAttachedToActivity","onDetachedFromActivity","attached","onFrameColorChanged","myActivity","_notifyMyContextChanged","_notifyMyWindowEvent","callbackStore","_notifyAttached","_notifyDetached","_notifyAttachedTo","_notifyDetachedFrom","detached","oldAct","ReadyMarker","signalsToWait","_signals","_callbacks","setCallback","isSet","isError","_error","signal","getError","EntityObservableCollection","processNew","_items","_listeners","_processNew","addOne","items","internalEntity","_updateInternalCollections","_notifyListeners","getByName","getOrWait","entityAddedHandler","entityAsAny","isActivityDestroy","isWindowClose","oldEntity","ActivityManager","bridge","autoAnnounce","_announcedWindows","_attachedCallbacks","_detachedCallbacks","_frameColorChangesCallbacks","_windowHandlers","_activityTypes","_grabEntity","_windowTypes","_activities","_dataReadyMarker","_descriptorsMarker","_readyMarker","dataErr","errCatch","refreshDescriptors","_handleActivitiesAttached","_handleActivitiesDetached","_handleActivityDescriptorsRefreshed","_handleWindowFrameColorChanged","_subscribeForData","aw","_getInitialData","bridgeType","ownerWindowType","helperWindowTypes","ownerDefinition","helperDefinitions","relativeTo","relativeDirection","windowStyleAttributes","actId","subscribeActivityTypeEvents","at","factoryMethod","getName","array","currentWindow","windowEventHandler_1","unsubscribeWindowEvents","subscribeWindowTypeEvents","wt","window_1","wrappingHandler","found","windowTypeOrConfiguration","relativeToWindow","invalidKeys_1","filteredWindowTypeOrConfiguration_1","wid","relativeWindowTypes","stackedWindow","tasks","removedKey","descriptors","stateWrapped","u","subscribeActivityFrameColorChanged","ac","descriptorAsObjectFromAPI","oldActivityId","newActivityId","ActivityManagementAPI","_my","activityTypes","_getActivityTypesWrapper","_getWindowTypesWrapper","registerFactory","unregisterFactory","announce","onAttached","onActivityFrameColorChanged","ActivityAPI","_mgr","aware","inActivity","getAvailableFrameColors","ActivityModule","logLevel","_isUsingHCImplementation","gdMajorVersion","_isUsingGW3Implementation","checkIsUsingGW3Implementation","activityManager","disableAutoAnnounce","_api","_readyPromise","GetFunctionalEntitlementMethodName","CanIMethodName","OnEventMethodName","createRegistry$1","lib$2","objectValues","objectClone","ApplicationImpl","_appManager","onInstanceStarted","onInstanceStopped","onAppRemoved","onAppChanged","onAppAvailable","onAppUnavailable","_props","Title","Version","AutoStart","IsShell","Caption","IsHidden","ApplicationName","ActivityWindowType","Arguments","AllowMultiple","IsReady","Icon","IconUrl","SortOrder","UserProperties","autoStart","caption","hidden","container","allowMultiple","Type","Mode","isActivity","styleAttributes","WindowStyleAttributes","searchFor","modeIndex","startModeIndex","stopModeIndex","style","updateFromProps","Name","Context","Options","acsResult","Instance_0","Id","handleInstanceStarted","check","filtered","isActivityInstance","onInstanceAgmServerReady","waitForApplicationInstance","onAvailable","onUnavailable","onChanged","onRemoved","InstanceImpl","_appName","startFailed","onAgmReady","_addToRegistry","onStopped","_unsubscribeInstanceStopped","_unsubscribeInstanceAgmServerReady","activityInstance","_isActivityOwner","activityInstances","inst","isActivityOwner","activityOwnerInstance","_startUpContext","_title","_isActivityInstance","_inActivity","_agmInstance","ActivityId","IsActivityOwner","updateAgmInstanceFromProps","AgmServers","GD3","agmInstances","gdAgmServers","propsAgmServer","propsAgm","machineName","userName","handleInstanceStopped","AppManagerImpl","_gdMajorVersion","_apps","_instances","applications","getMyInstance","instanceId_1","handleAppAdded","_getAppId","_updateAppFromProps","handleAppUpdated","handleAppRemoved","handleAppReady","_getAppOrThrow","available","_getInstanceId","_getInstanceAppName","_updateInstanceFromProps","_getInstanceOrThrow","_matchInstance","handleInstanceAgmServerReady","handleInstanceStartFailed","handleInstanceUpdated","onInstanceStartFailed","onInstanceUpdated","onAppAdded","_getInstanceByIdAndName","promisify$2","EntitlementsImpl","handleBranchModified","handleBranchesModified","getRegion","_agmInvoke","Region","getBranches","Branches","getCurrentBranch","Branch","setRegion","ResultMessage","setCurrentBranch","currentUser","getFunctionalEntitlement","funct","Entitlement","Function","getFunctionalEntitlementBranch","canI","func","Result","canIBranch","onBranchesChanged","onBranchChanged","restart","transformFunction","AppManagerFactory","START_ONLY","SKIP_ICONS","entitlements","skipIcon","snapshot","skipIcons","resolveFunc","rejectFunc","resultPromise","streamData","events","createDataSubscription","myInstance","windowStore","WindowStore","waitForTimeoutInMilliseconds","_pendingWindows","_pendingWindowsStates","getIfReady","remote","urlChanged","setReadyState","targetWindowState","markReadyToShow","setUrlChangedState","onReadyWindow","onAdded","Utils$1","callbackifyPromise","fail","getMonitor","displays","workingAreaWidth","workingAreaHeight","monitor","totalOverlap","calculateTotalOverlap","getDisplayCenterOfScreen","display","max","r1","r2","r1x","r1y","r1xMax","r1yMax","r2x","r2y","r2xMax","r2yMax","min","windowFactory","executor","appManagerGetter","_group","resultWindow","_mode","_url","url","_bounds","_frameColor","_focus","_neighbours","neighbours","_groupId","groupId","_isGroupHeaderVisible","isGroupHeaderVisible","_isTabHeaderVisible","isTabHeaderVisible","_isTabSelected","isTabSelected","_settings","_isVisible","_isSticky","isSticky","isCollapsed","_windowState","_tabGroupId","tabGroupId","_isLocked","isLocked","_frameButtons","_zoomFactor","zoomFactor","moveResize","dimensions","resolveTimeout","unsubscribeBoundsChanged","resolveImmediately","areBoundsEqual","onBoundsChanged","toBeVisible","isVisibilityCorrect","onVisibilityChanged","waitForLockingChanged","onLockingChanged","onUrlChanged","onCollapsed","onExpanded","onMaximized","onMinimized","onNormal","onTabHeaderVisibilityChanged","getNeighboursByDirection","direction","winId","getApplicationName","_APPLICATION_NAME","_t42","getWindowInfo","requested","minHeight","maxHeight","minWidth","maxWidth","areHeightsEqual","areWidthsEqual","areLeftsEqual","areTopsEqual","handleWindowClose","handleWindowChangeState","handleTitleChanged","newTitle","handleVisibilityChanged","handleUrlChanged","newUrl","handleWindowSettingsChanged","handleContextUpdated","handleFrameIsLockedChanged","handleBoundsChanged","handleFocusChanged","isFocused","handleFrameButtonAdded","frameButton","buttonObj","btn","buttonId","handleFrameButtonRemoved","frameButtonId","button","handleFrameButtonClicked","handleFrameColorChanged","handleFrameAttached","handleFrameSelectionChanged","newWindow","prevWindow","selectedWindow","previousWindow","un_1","onTabSelectionChanged","newWin","prevWin","handleCompositionChanged","handleGroupHeaderVisibilityChanged","handleTabHeaderVisibilityChanged","handleGroupChanged","newGroup","oldGroup","handleGroupAssociation","group","handleAttached","newTabGroupId","tabHeaderVisible","handleDetached","handleWindowAttached","handleWindowDetached","handleZoomFactorChanged","handleIsStickyChanged","hostInstance","agmInstance","frameButtons","opened","topNeighbours","leftNeighbours","rightNeighbours","bottomNeighbours","screen","monitors","maximize","restore","minimize","maximizeRestore","currEvent","collapse","expand","toggleCollapse","setTitle","setStyle","errMessage","setOnTop","onTop","resetButtons","buttons","setSizeConstraints","constraints","navigate","addFrameButton","buttonInfo","imageBase64","removeFrameButton","show","hide","center","snap","targetWindowGroup","targetGroup","targetWindow","onWindowAdded","showLoader","loader","hideLoader","lock","unlock","getIcon","icon","setIcon","base64Image","setTabTooltip","attachTab","tab","sourceWindowId","targetWindowId","argsForSend","sourceWin","detachTab","opt","_options","hideTabHeader","visibilityChangeHeard","detachedHeard","unVisibility","unDetached","setTabHeaderVisible","toBeTabHeaderVisible","showPopup","createFlydown","setModalState","isModal","setZoomFactor","zoomIn","zoomOut","showDevTools","capture","captureOptions","flash","suppliedOptions","flashOptions","shouldFlash","setSticky","print","printOptions","printToPDF","printToPDFOptions","onClose","onTitleChanged","onFrameButtonAdded","onFrameButtonRemoved","onFrameButtonClicked","onContextUpdated","onFocusChanged","onStickyChanged","onGroupChanged","onWindowAttached","onWindowDetached","onClosing","onRefreshing","prevent","onZoomFactorChanged","tabs","allWindows","getURL","getTitle","resizeTo","moveTo","getParentWindow","myParentId","parentInstanceId","getChildWindows","Events","Registry","GDExecutor","agmTarget","stylePromises","wait","toolTip","allowClose","allowCollapse","allowLockUnlock","allowMaximize","allowMinimize","tabTooltip","tabToolTip","buttonsConfig","snappingEdge","replace","dataURL","toShow","optionsCopy","reformatedOptions","targetLocation","popupBounds","size","targetId","popupId","fullOptions","horizontalOffset","verticalOffset","reformatFlydownOptions","zoneIds","zones","z","flydownSize","cancel","clearFlydownArea","handleFlydownBoundsRequested","cancelCallback","callbackData","responses","defaultResponse","zoneId","flydownId","flydownWindowBounds","flydownWindowId","captureGroup","groupWindowIds","configure","filePath","setGroupHeaderVisible","getGroupTitle","setGroupTitle","addCloseHandler","assignGeneralIfUnassigned","zone","valueFromOptions","flydownBounds","flydownActiveArea","activeArea","areaIds","getWindowsByTabGroupId","GDEnvironment","wndId","_waitTimeout","normalizeInstance","_windowId","_appManagerGetter","caller","respondToEvent","streamResolve","streamReject","updateWindow","copyOptions","windowState","tabAttached","tabDetached","onEvent","onCompositionChanged","onGroupHeaderVisibilityChanged","onWindowGotFocus","onWindowLostFocus","windowInfo","readyResolve","extendedStreamEvent","getExtendedStreamEvent","windowInfoCreatedEvent","windowObjectAndEvents","theWindow","theWindowEvents","windowInfoBoundsChangedEvent","windowInfoUrlChangedEvent","windowInfoTitleChanged","windowInfoIsStickyChangedChanged","windowInfoCompositionChanged","neighbors","groupHeaderVisible","windowInfoFocusChanged","focusChanged","frameId","winsToBeNotified_1","oldTabGroupId","winsToBeNotified_2","newWindowId","prevWindowId","windowObjAndEvents","mapToWindowConstructorOptions","isActiveTab","streamEvent","charAt","toUpperCase","groupFactory","_windowsId","waitForHeaderVisibilityChanged","onHeaderVisibilityChanged","groupObject","_mapToWindowObjects","winObjects","windowObject","_mapToWindowObject","mappedWindows","mappedWindow","isHeaderVisible","showHeader","hideHeader","onWindowRemoved","groupAPI","groupInternal","removeWindow","window_2","groupsFactory","_groups","heardForWindowsCounter","findGroupByWindow","groupFound","addNewWindow","windowGroupId","createdGroup","createOrGetGroup","deleteGroup","newGroupId","oldGroupId","groupEvents","groupsAPI","groupsEvents","onWindowMoved","WindowsFactory","groups","isReady","gdPromise","rej","envDetector","myWindow","windowAdded","windowRemoved","errorHandler","windowsForListing","findById","onTabAttached","onTabDetached","unsubscribed","store","LayoutStore","layouts","removeWhere","condition","where","first","seed$1","alphabet$1","previousSeed$1","shuffled$1","randomFromSeed$1","ORIGINAL$1","reset$1","setCharacters$1","getShuffled$1","shuffle$1","alphabet_1$1","crypto$1","randomByteBrowser$1","encode_1$1","decode_1$1","build_1","isValid$1","lib$3","createCommonjsModule$1","shortid$1","ContextProvider","activitiesGetter","registerRequestMethods","onSaveRequested","context_1","activityIsOwner","usersCbs","requestResult","autoSaveWindowContext","windowContext","activityContext","transformACSLayout","something","accumulator","convertedValue","LayoutImpl","components","metadata","LayoutsAPIImpl","activityGetter","setDefaultGlobal","clearDefaultGlobal","getDefaultGlobal","isSlimMode","l","gotSnapshot","save","verifyNotSlimMode","ignoreHidden","layoutObject","actIds","appIds","ignoreLayoutRestrictions","isVisibleWindow","ignoreMyInstance","autoCollectApps","invokeMethodAndTrack","activityIdToJoin","restoreActivityOwner","ignoreActivityWindowTypes","closeRunningInstance","reuseWindows","t42","restoreOptions","activityToJoin","closeOldWindows","reuseExistingWindows","toClose","splash","getInstancesToClose","import","export","getObjectValues","Layouts","rename","newName","oldName","updateMetadata","hibernate","resume","getCurrentLayout","onRestored","onRenamed","updateAppContextInCurrent","updateDefaultContext","skipStreamEvent","agmResult","streamEventReceived","handleResult","shellApp","isShell","shellApplicationName","ACSStream","resolveReady","rejectReady","resolveGotSnapshot","rejectGotSnapshot","noRetry","transform","checkForLayoutEventMethod","IsSnapshot","addLayouts","OnLayoutAdded","removeLayouts","OnLayoutRemoved","changeLayouts","OnLayoutChanged","renameLayouts","OnLayoutRenamed","restoredLayout","OnLayoutRestored","Token","layoutsData","layoutData","removedLayouts","removedLayout","existingLayout","compareLayouts","changedLayouts","changedLayout","renamedLayouts","renamedLayout","layout1","layout2","restoredLayouts","LayoutsFactory","acsStream","DisplayCommand","DisplayManager","callGD","GetAll","decorateDisplay","getPrimary","isPrimary","Capture","captureAll","CaptureAll","getMousePosition","GetMousePosition","original","switchChannel","swId","CONTEXT_PREFIX","SharedContextSubscriber","isChannel","createContextName","___","startsWith","channelContextName","getContextData","updateChannel","updateData","ChannelsImpl","shared","subsKey","changedKey","joinCore","joinNoSelectorSwitch","leaveCore","leaveNoSelectorSwitch","changeSelector","doesChannelExist","intervalId","sharedContexts","interopLib","setupAGM","CommandMethod","HotkeysImpl","firstHotkey","hotkeys","hkToLower","hotkey","formatHotkey","registerInvokeAGMMethod","delete","unregisterAll","isRegistered","version$2","prepareConfig$1","getLibConfig","defaultMode","trueMode","getModeAsString","Glue42Notification","actions","badge","dir","image","lang","renotify","requireInteraction","silent","removeEventListener","dispatchEvent","Notifications","methodsRegistered","methodNameRoot","notifications","bunchOfPromises","notification","validActions","validActions_1","g42notification","maxActions","handleNotificationAction","severity","glueRoutingDetailMethodName","g42notificationId","g42action","g42interopMethod","g42interopTarget","stringValue","glueAction","payload_1","event_1","Event","onaction","actionInterop","event_2","onclick","clickInterop","ThemesImpl","core","isSubscribed","getConfiguration","getMethodName","getAll","getCurrent","selected","select","theme","setMethodName","sharedContextName","getThemesMethodName","setThemesMethodName","GLUE42_FDC3_INTENTS_METHOD_PREFIX","intentFilter","ctToLower_1","contextTypes","ct","intentName","intentDef","isDynamicIntent","anAppHandler","anInstanceHandler","intentDefHandler","intentHandler","startApp","raiseIntentToInstance","apps_1","intents_1","appsWithIntents","appsWithIntents_1","withIntentsInfo","_g","_h","_j","_k","_l","appWithIntents","appDefIntent","methodDescription","registeredIntent","interopServer","registeredMethod","addedMethod","factory$3","createWindows","windowsLogger","getLibLogger","debugLog","createActivities","activityLogger","createAppManager","createLayouts","layoutsConfig","lay","createChannels","channelsAPI","createHotkeys","hotkeysAPI","createIntents","intentsAPI","createNotifications","notificationsAPI","createDisplaysApi","displaysLogger","_displays","createThemes","themesAPI","themes","factory$2","newLogger","loggerConfig","currentLog","glueApi","glueFactoryLog","libraries","whatToExpose","shouldSetToWindow","autoInjected","Glue","whatToExpose$1","bytes","format_browser","mask","LN2","generate_1","test","basedir","base","commonjsRequire","RemoteWebWindow","control","callControl","skipResult","Control","CONTROL_METHOD","setLocalWindow","setLocalInstance","onStart","LocalWebWindow","screenLeft","screenTop","outerWidth","outerHeight","getBoundsSync","getContextSync","ChildWebWindow","createMethodName","registerChildStartupContext","startingContext","initStartupContext","startedByScript","Windows","childWindows","trackWindowsLifetime","remoteWindow","remoteFromServer","relativeWindowId_1","relativeWindow","relativeWindowBounds","relativeDir","newBounds","optionsString","availWidth","getRelativeBounds","cw","closed","rect","ok","asPromise","withDefault","defaultValue","withException","map2","ar","mapError","andThen","freeze","isOk","isErr","successes","isEqual","isJsonArray","json","isJsonObject","expectedGot","expected","got","typeString","printPath","prependAt","newAt","rest","getOwnPropertySymbols","propertyIsEnumerable","__rest","Decoder","run","kind","input","runPromise","runWithException","succeed","string","boolean","constant","decoders","decoder","err$$1","decodeValue_1","tuple","nth","union","ad","bd","oneOf","intersection","ds","anyJson","unknownJson","dict","optional","errors","errorsList","valueAt","jsonAtPath","fixedValue","lazy","mkDecoder","nonEmptyStringDecoder","windowLayoutItemDecoder","groupLayoutItemDecoder","children","columnLayoutItemDecoder","rowLayoutItemDecoder","workspaceComponentDecoder","windowComponentDecoder","componentType","parentId","main","layoutTypeDecoder","newLayoutOptionsDecoder","restoreOptionsDecoder","layoutDecoder","controller","layoutType","onLayoutAdded","onLayoutChanged","onLayoutRemoved","setContextDataToEmptyObjIfMissing","contextWithDataObj","newData","Channels","fetchTimeout","timeoutMilliseconds","timeoutHit","fetch","promisePlus","timeoutMessage","Application","startWithoutTimeout","manifest","details","parsedManifest","openOptions","appWindow","resolveCallback","startedAppsWindowIdsToInstances","checkResolveCondition","appInstanceStartedPromise","startedInstance","RemoteInstance","WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND","instanceStoppedPromise","LocalInstance","nonEmptyStringDecoder$1","fdc3AppImageDecoder","fdc3IconDecoder","fdc3IntentDecoder","customConfig","glue42CoreCreateOptionsDecoder","fdc3ApplicationConfigDecoder","appId","manifestType","contactEmail","supportEmail","publisher","glue42CoreApplicationConfigDecoder","customProperties","AppManager","DEFAULT_POLLING_INTERVAL","DEFAULT_REQUEST_TIMEOUT","OKAY_MESSAGE","LOCAL_SOURCE","myId","_myInstance","remoteSources","subscribeForRemoteApplications","trackInstanceLifetime","localApplications","validatedApplications","getValidatedApplications","addApplications","initialFetchAppsPromises","remoteSources_1","remoteSource","appsFetch","requestTimeout","pollingInterval","getAppProps","glue42CoreAppProps","fromEntries","entries","handleAppsChanged","newlyAddedApplications","_loop_2","newlyAddedApplication","currentApplicationWithTheSameNameAndSource","this_2","currentApplicationWithTheSameNameButDifferentSource","currentApplication","appProps","newlyAddedApplicationInstance","newlyAddedApplications_1","handleAppsAdded","currentAppNames","newApplications_1","newApplication","newApplicationInstance","handleAppsRemoved","currentApplicationsFromThisSource","newlyAddedApplicationNames","removedApplications_1","currentApplicationFromThisSource","removedApplication","tryPopulateMyInstanceApplication","myApp","serverApp","remoteInstance","nonEmptyStringDecoder$2","glue42CoreCreateOptionsDecoder$1","glue42CoreIntentContextDecoder","glue42CoreIntentFilterDecoder","glue42CoreIntentDefinitionDecoder","glue42CoreIntentRequestDecoder","appDef","interopOptions_1","Notification","permission","requestPermission","raiseUsingWebApi","defaultAssetsBaseLocation","defaultWorkerName","defaultConfigName","defaultConfig","autoRestore","assets","getRemoteConfig","remoteConfigLocation","extendConfig","extends","SaveContextMethodName","LayoutEventMethodName","LayoutsController","storage","autoSaveContext","handleControlMessage","registerEventsMethod","globalLayouts","workspaceLayouts","layoutEvent","eventPromise","error_1","waitHearLayout","emitLayoutEvent","layoutOptions","autoSave","openedWindows","getRemoteWindowsInfo","getLocalLayoutComponent","storeAutoLayout","restoreComponents","restoreAutoSavedLayout","layoutName","mainComponent","getAutoLayout","c","layoutToRemove","newWindowOptions","windows_1","layoutCommand","parentInfo","LayoutStorage","localStore","autoStore","remoteStore","foundRemote","foundLocal","nonConflictLocal","localLayout","remoteLayout","allowSave","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","receiver","IDBTransaction","objectStoreNames","objectStore","wrap","wrapFunction","IDBDatabase","transaction","IDBCursor","advance","continue","continuePrimaryKey","storeNames","tx","transformCachableValue","unlisten","complete","DOMException","cacheDonePromiseForTransaction","constructors","instanceOfAny","IDBObjectStore","IDBIndex","Proxy","IDBRequest","promisifyRequest","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","async","storeName","shift","returnVal","oldTraps","LocalStore","_database","blocked","upgrade","blocking","terminated","indexedDB","openPromise","oldVersion","newVersion","db","openDB","setUpDb","database","put","contains","createObjectStore","JSONStore","storeBaseUrl","fetchUrl","decodeResult","AutoStorage","getObjectFromLocalStorage","getKey","setObjectToLocalStorage","localStorage","getItem","KEY","setItem","hookCloseEvents","layoutsController","allChildren","firstChild","closeEveryone","__assign$2","lib$1$1","coreFactoryFunction","glueWebFactory","builtCoreConfig","isWebEnvironment","shouldInitializeChannels","shouldInitializeAppManager","gdWindowContext","channelsLib","appManagerLib","intentsLib","coreConfig","_o","_p","_q","remoteConfig","resultWebConfig","lastIndex","remoteType","coreLib","baseLocation","layoutsStorage","windowAny","GlueWeb","defaultGlueConfig","fdc3AppName","resolveGlue","apisFDC3ReliesUpon","apiFDC3ReliesUpon","validateGlue","setupGlue","GlueWebFactory","fdc3InitsGlue","originalGlue","fdc3Factory","agentApi","intentsAgent","channelsAgent","createDesktopAgent","globalFdc3","fdc3"],"mappings":"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"}