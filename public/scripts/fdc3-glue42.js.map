{"version":3,"file":"fdc3-glue42.js","sources":["../src/utils.ts","../src/channels/channel.ts","../src/channels/channels.ts","../src/agent.ts","../node_modules/@glue42/desktop/dist/desktop.es.js","../../web/dist/web.es.js","../src/main.ts","../src/index.ts"],"sourcesContent":["import { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"./windowtype\";\n\n/**\n * Changes to subscribe to comply with the FDC3 specification:\n * 1. Skip updates from myself\n * 2. Ignore initial replay\n */\nexport const newSubscribe = (id: string, callback: (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => void) => {\n    let didReplay = false;\n\n    return (window as WindowType).glue.contexts.subscribe(id, (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => {\n        if (!didReplay) {\n            didReplay = true;\n            return;\n        }\n\n        const updateFromMe = extraData.updaterId === (window as WindowType).glue.interop.instance.instance;\n\n        if (!updateFromMe) {\n            callback(data, delta, removed, unsubscribe, extraData);\n        }\n    });\n};\n\n/**\n * Returns a list of all channel contexts. We are not using `glue.channels.list()` so that @glue42/fdc3 can be used with older versions of the Glue42 JS SDK.\n */\nexport const getChannelsList = async () => {\n    const channelNames = await (window as WindowType).glue.channels.all();\n    const channelContents: Array<Glue42.Channels.ChannelContext> =\n        await Promise.all(channelNames.map((name: string) => (window as WindowType).glue.channels.get(name)));\n\n    return channelContents;\n};\n\nexport const isEmptyObject = (obj: object): boolean => {\n    return Object.keys(obj).length === 0 && obj.constructor === Object;\n};\n\nexport const isGlue42Core = !navigator.userAgent.toLowerCase().includes(\" electron/\");\n","import { FDC3 } from \"../../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"../windowtype\";\nimport { newSubscribe } from \"../utils\";\n\nexport class SystemChannel implements FDC3.Channel {\n    id: string;\n    readonly type: string = \"system\";\n    displayMetadata: FDC3.DisplayMetadata;\n\n    constructor(glChannel: Glue42.Channels.ChannelContext) {\n        this.id = glChannel.name;\n        this.displayMetadata = glChannel.meta;\n    }\n\n    broadcast(context: FDC3.Context): Promise<void> {\n        return (window as WindowType).glue.channels.publish(context, this.id);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<FDC3.Context | null> {\n        const channel = await (window as WindowType).glue.channels.get(this.id);\n\n        const { data } = channel;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextType: string, handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = (window as WindowType).glue.channels.subscribeFor(this.id, subHandler);\n\n        return {\n            unsubscribe(): void {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n\n    join(): Promise<void> {\n        return (window as WindowType).glue.channels.join(this.id);\n    }\n\n    leave(): Promise<void> {\n        return (window as WindowType).glue.channels.leave();\n    }\n}\n\nexport class AppChannel implements FDC3.Channel {\n    readonly type: string = \"app\";\n\n    constructor(public id: string) {\n    }\n\n    broadcast(context: FDC3.Context): Promise<void> {\n        return (window as WindowType).glue.contexts.update(this.id, context);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<FDC3.Context | null> {\n        const context = await (window as WindowType).glue.contexts.get(this.id);\n\n        const { data } = context;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextType: string, handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = newSubscribe(this.id, subHandler);\n\n        return {\n            unsubscribe: (): void => {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n}\n","import { FDC3 } from \"../../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { SystemChannel, AppChannel } from \"./channel\";\nimport { WindowType } from \"../windowtype\";\nimport { getChannelsList, isGlue42Core, newSubscribe, isEmptyObject } from \"../utils\";\n\nconst Listener = (actualUnsub:\n    (() => void)\n    | Promise<() => void>\n): FDC3.Listener => {\n    return {\n        unsubscribe(): void {\n            if (!actualUnsub) {\n                // tslint:disable-next-line:no-console\n                console.error(\"Could not unsubscribe!\");\n                return;\n            }\n\n            if (typeof actualUnsub === \"function\") {\n                actualUnsub();\n            } else {\n                (actualUnsub as Promise<() => void>).then((unsubFunc: () => void) => unsubFunc());\n            }\n        }\n    };\n};\n\ninterface PendingSubscription {\n    contextType: string;\n    handler: (context: FDC3.Context) => void;\n    setActualUnsub: (actualUnsub: () => void) => void;\n}\n\nconst createChannelsApi = (): FDC3.ChannelsAPI => {\n    let currentChannel: FDC3.Channel | null;\n    let pendingSubscription: PendingSubscription | null;\n\n    const channels: { [name: string]: FDC3.Channel } = {};\n\n    let systemChannels: string[] = [];\n\n    const doesAppChannelExist = async (name: string): Promise<boolean> => {\n        const exists = (await (window as WindowType).glue.contexts.all())\n            .some((ctxName) => ctxName === name);\n\n        return exists;\n    };\n\n    const createNewAppChannel = async (channelId: string): Promise<void> => {\n        await (window as WindowType).glue.contexts.set(channelId, null);\n    };\n\n    const isSystem = (channel: FDC3.Channel | null): boolean => {\n        if (!channel) {\n            return false;\n        }\n        return systemChannels.some((n) => n === channel.id);\n    };\n\n    const mapToFDC3SystemChannel = (glueChannel: Glue42.Channels.ChannelContext): FDC3.Channel => {\n        return new SystemChannel(glueChannel);\n    };\n\n    const mapToFDC3AppChannel = (channelName: string): FDC3.Channel => {\n        return new AppChannel(channelName);\n    };\n\n    const handleSwitchChannelUI = (channelId: string): void => {\n        setCurrentChannel(channels[channelId]);\n    };\n\n    const createPendingListener = (contextType: string, handler: (context: FDC3.Context) => void): FDC3.Listener => {\n        let unsubscribe = (): void => { pendingSubscription = null; };\n\n        const setActualUnsub = (actualUnsub: () => void): void => { unsubscribe = actualUnsub; };\n\n        // Used inside of setCurrentChannel.\n        pendingSubscription = { contextType, handler, setActualUnsub };\n\n        return {\n            unsubscribe\n        };\n    };\n\n    const init = async (): Promise<void> => {\n        await (window as WindowType).gluePromise;\n\n        const channelContents: Array<Glue42.Channels.ChannelContext> = await getChannelsList();\n\n        channelContents.map((channelContext) => {\n            channels[channelContext.name] = mapToFDC3SystemChannel(channelContext);\n        });\n\n        systemChannels = await (window as WindowType).glue.channels.all();\n\n        const current = await (window as WindowType).glue.channels.current();\n\n        // In Glue42 Core the channel selector widget needs to use the FDC3 Channels API instead of the Glue42 Channels API to navigate between the channels.\n        if (!isGlue42Core) {\n            if (current) {\n                handleSwitchChannelUI(current);\n            }\n\n            (window as WindowType).glue.channels.changed((channelId: string) => {\n                handleSwitchChannelUI(channelId);\n            });\n        }\n    };\n\n    const initDone = init();\n\n    const getSystemChannels = async (): Promise<FDC3.Channel[]> => {\n        await initDone;\n\n        const systemChannelImpls = systemChannels.map((id) => channels[id]);\n\n        return systemChannelImpls;\n    };\n\n    const getOrCreateAppChannel = async (channelId: FDC3.ChannelId): Promise<FDC3.Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            await createNewAppChannel(channelId);\n        }\n\n        return mapToFDC3AppChannel(channelId);\n    };\n\n    const getOrCreateChannel = async (channelId: FDC3.ChannelId): Promise<FDC3.Channel> => {\n        const systemChannels = await getSystemChannels();\n        const channel = systemChannels.find((systemChannel) => systemChannel.id === channelId);\n\n        if (typeof channel === \"undefined\") {\n            return getOrCreateAppChannel(channelId);\n        } else {\n            return channel;\n        }\n    };\n\n    const tryLeaveSystem = async (): Promise<void> => {\n        if (isSystem(currentChannel)) {\n            await (currentChannel as SystemChannel).leave();\n        }\n    };\n\n    const tryGetAppChannel = async (channelId: string): Promise<FDC3.Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            throw new Error(FDC3.ChannelError.NoChannelFound);\n        }\n\n        const appChannel = mapToFDC3AppChannel(channelId);\n        channels[channelId] = appChannel;\n\n        return appChannel;\n    };\n\n    const joinChannel = async (channelId: string): Promise<void> => {\n        await initDone;\n\n        const channel: FDC3.Channel = channels[channelId]\n            || await tryGetAppChannel(channelId);\n\n        if (!channel) {\n            throw new Error(FDC3.ChannelError.NoChannelFound);\n        }\n\n        if (isSystem(channel)) {\n            (channel as SystemChannel).join();\n        } else {\n            await tryLeaveSystem();\n        }\n\n        setCurrentChannel(channel);\n    };\n\n    const getCurrentChannel = async (): Promise<FDC3.Channel> => {\n        await initDone;\n\n        return currentChannel as FDC3.Channel;\n    };\n\n    const leaveCurrentChannel = async (): Promise<void> => {\n        await initDone;\n\n        await tryLeaveSystem();\n\n        currentChannel = null;\n    };\n\n    const broadcast = async (context: FDC3.Context): Promise<void> => {\n        await initDone;\n\n        if (!currentChannel) {\n            // tslint:disable-next-line:no-console\n            console.error(\"You must join a channel first.\");\n            return;\n        }\n\n        const { id, type } = currentChannel;\n        (type === \"system\")\n            ? (window as WindowType).glue.channels.publish(context)\n            : (window as WindowType).glue.contexts.update(id, context);\n    };\n\n    function addContextListener(handler: (context: FDC3.Context) => void): FDC3.Listener;\n    function addContextListener(contextType: string, handler: (context: FDC3.Context) => void): FDC3.Listener;\n    function addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        if (!currentChannel) {\n            // tslint:disable-next-line:no-console\n            console.warn(\"You will start receiving broadcasts only after you join a channel !\");\n            const listener = createPendingListener(contextType, handler);\n\n            // Handle context passed to `fdc3.open()`.\n            (window as WindowType).gluePromise.then(() => {\n                const startupContext = (window as WindowType).glue.appManager.myInstance.context;\n                if (!isEmptyObject(startupContext)) {\n                    handler(startupContext);\n                }\n            });\n\n            return listener;\n        }\n\n        const { id, type } = currentChannel;\n\n        const subscribe = (subHandler: (data: any) => void): (() => void) | Promise<() => void> => type === \"system\"\n            ? (window as WindowType).glue.channels.subscribe(subHandler)\n            : newSubscribe(id, subHandler);\n\n        const onNewData = (data: any): void => {\n            if (contextType) {\n                if (data.type === contextType) {\n                    handler(data);\n                }\n                return;\n            }\n            handler(data);\n        };\n\n        const unsubFunc = subscribe(onNewData);\n\n        return Listener(unsubFunc);\n    }\n\n    const setCurrentChannel = (newChannel: FDC3.Channel): void => {\n        currentChannel = newChannel;\n\n        if (pendingSubscription) {\n            const { contextType, handler, setActualUnsub } = pendingSubscription;\n\n            const listener = addContextListener(contextType, handler);\n\n            setActualUnsub(listener.unsubscribe);\n\n            pendingSubscription = null;\n        }\n    };\n\n    return {\n        getSystemChannels,\n        getOrCreateChannel,\n        joinChannel,\n        getCurrentChannel,\n        leaveCurrentChannel,\n        broadcast,\n        addContextListener,\n    };\n};\n\nexport default createChannelsApi;\n","import { FDC3 } from \"../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { Glue42Web } from \"@glue42/web\";\nimport createChannelsApi from \"./channels/channels\";\nimport { isGlue42Core } from \"./utils\";\nimport { WindowType } from \"./windowtype\";\n\nconst GLUE42_CORE_FDC3_INTENTS_METHOD_PREFIX = \"Tick42.FDC3.Intents.\";\n\nconst convertGlue42IntentToFDC3AppIntent = (glueIntent: Glue42.Intents.Intent): FDC3.AppIntent => {\n    const { name, handlers } = glueIntent;\n\n    const appIntent: FDC3.AppIntent = {\n        intent: { name, displayName: handlers[0].displayName },\n        apps: glueIntent.handlers.map((handler) => {\n            const app = (window as WindowType).glue.appManager.application(handler.applicationName);\n\n            return {\n                name: app.name,\n                title: app.title,\n                tooltip: app.userProperties.tooltip,\n                description: app.userProperties.description,\n                icons: app.userProperties.icons,\n                images: app.userProperties.images\n            };\n        })\n    };\n\n    return appIntent;\n};\n\nconst getGlue42CoreIntents = async (): Promise<{ intent: FDC3.Intent | undefined; apps: Glue42Web.AppManager.Application[] }[]> => {\n    const apps = await ((window as WindowType).glue as Glue42Web.API).appManager.applications();\n    const appIntents: { intent: FDC3.Intent; app: Glue42Web.AppManager.Application }[] = apps.flatMap((app: Glue42Web.AppManager.Application) => {\n        return (app.userProperties.intents?.map((intent: FDC3.Intent) => {\n            return {\n                intent,\n                app: {\n                    name: app.name,\n                    title: app.title,\n                    tooltip: app.userProperties.tooltip,\n                    description: app.userProperties.description,\n                    icons: app.userProperties.icons,\n                    images: app.userProperties.images\n                }\n            };\n        }) || []);\n    });\n    const intentNames = Array.from(new Set(appIntents.map((appIntent) => {\n        return appIntent.intent.name;\n    })));\n    const intents = intentNames.map((intentName) => {\n        return {\n            intent: appIntents.find((appIntent) => {\n                return appIntent.intent.name === intentName;\n            })?.intent,\n            apps: [...appIntents.filter((appIntent) => {\n                return appIntent.intent.name === intentName;\n            }).map((appIntent) => {\n                return appIntent.app;\n            })]\n        };\n    });\n\n    return intents;\n};\n\nconst getGlue42CoreIntentsByContext = async (context: FDC3.Context): Promise<{ intent: FDC3.Intent; app: Glue42Web.AppManager.Application }[]> => {\n    const apps = await ((window as WindowType).glue as Glue42Web.API).appManager.applications();\n    const appIntents: { intent: FDC3.Intent; app: Glue42Web.AppManager.Application }[] = apps.flatMap((app: Glue42Web.AppManager.Application) => {\n        return (app.userProperties.intents?.map((intent: FDC3.Intent) => {\n            return {\n                intent,\n                app: {\n                    name: app.name,\n                    title: app.title,\n                    tooltip: app.userProperties.tooltip,\n                    description: app.userProperties.description,\n                    icons: app.userProperties.icons,\n                    images: app.userProperties.images\n                }\n            };\n        }) || []);\n    });\n\n    const appIntentsForContext = appIntents.filter((appIntent) => {\n        return appIntent.intent.contexts?.includes(context.type);\n    });\n\n    return appIntentsForContext;\n};\n\nconst startAppAndWaitForIntentMethod = async (app: Glue42.AppManager.Application | Glue42Web.AppManager.Application, intent: string): Promise<Glue42Web.Interop.Instance> => {\n    try {\n        await app.start();\n    } catch (error) {\n        // `start()` is expected to reject as the started application needs to pass in application name to `GlueWeb()`\n    }\n\n    // Wait for the newly started application to call addIntentListener.\n    const methodAddedPromise = new Promise<Glue42Web.Interop.Instance>((resolve, reject) => {\n        const timeout = setTimeout(() => {\n            reject(`Raise intent ${intent} target ${app.name} application did not call addIntentListener after being started.`);\n        }, 3000);\n\n        const unsub = (window as WindowType).glue.interop.serverMethodAdded((info) => {\n            if (info.method.name === `${GLUE42_CORE_FDC3_INTENTS_METHOD_PREFIX}${intent}`) {\n                clearTimeout(timeout);\n                unsub();\n                resolve(info.server);\n            }\n        });\n    });\n\n    return methodAddedPromise;\n};\n\nconst createCoreDesktopAgent = (): Partial<FDC3.DesktopAgent> => {\n    const open = async (name: string, context?: FDC3.Context): Promise<void> => {\n        const app = (window as WindowType).glue.appManager.application(name);\n        if (!app) {\n            throw new Error(FDC3.OpenError.AppNotFound);\n        }\n\n        try {\n            await app.start(context);\n        } catch (error) {\n            // `start()` is expected to reject as the started application needs to pass in application name to `GlueWeb()`\n        }\n    };\n\n    return {\n        open: async (...props): Promise<void> => {\n            await (window as WindowType).gluePromise;\n            return open(...props);\n        }\n    };\n};\n\nconst createGlue42CoreDesktopAgent = (): Partial<FDC3.DesktopAgent> => {\n    const findIntent = async (intent: string, context?: FDC3.Context): Promise<FDC3.AppIntent> => {\n        const glueIntents = await getGlue42CoreIntents();\n\n        const foundIntent = glueIntents.find((glueIntent) => {\n            if (context) {\n                return glueIntent.intent?.name === intent && glueIntent.intent.contexts?.includes(context.type);\n            } else {\n                return glueIntent.intent?.name === intent;\n            }\n        });\n\n        if (!foundIntent) {\n            throw new Error(FDC3.ResolveError.NoAppsFound);\n        }\n\n        return foundIntent as FDC3.AppIntent;\n    };\n\n    const findIntentsByContext = async (context: FDC3.Context): Promise<FDC3.AppIntent[]> => {\n        if (!context.type) {\n            throw new Error(\"Only filtering by context.type is supported.\");\n        }\n\n        const intents = await getGlue42CoreIntentsByContext(context);\n\n        return intents.map((intent) => ({\n            intent: intent.intent,\n            apps: [intent.app]\n        })) as FDC3.AppIntent[];\n    };\n\n    const raiseIntent = async (intent: string, context: FDC3.Context, target?: string): Promise<FDC3.IntentResolution> => {\n        let instancesToTarget;\n        let invocationResult;\n        const methodName = `${GLUE42_CORE_FDC3_INTENTS_METHOD_PREFIX}${intent}`;\n\n        if (target) {\n            const appTarget = ((window as WindowType).glue as Glue42Web.API).appManager.application(target);\n\n            if (!appTarget) {\n                throw new Error(FDC3.OpenError.AppNotFound);\n            }\n\n            instancesToTarget = ((window as WindowType).glue as Glue42Web.API).appManager.instances().filter((appInstance) => {\n                return appInstance.application.name === target;\n            }).map((appInstance) => {\n                return appInstance.agm;\n            });\n\n            if (instancesToTarget.length === 0) {\n                instancesToTarget = [await startAppAndWaitForIntentMethod(appTarget, intent)];\n            }\n        } else {\n            const methods = (window as WindowType).glue.interop.methods().filter((method) => {\n                return method.name === methodName;\n            });\n\n            instancesToTarget = methods[0]?.getServers();\n\n            if (!instancesToTarget || instancesToTarget.length === 0) {\n                const appTarget = ((window as WindowType).glue as Glue42Web.API).appManager.applications().find((application) => {\n                    return application.userProperties.intents?.some((appIntent: FDC3.Intent) => {\n                        return appIntent.name === intent;\n                    });\n                });\n\n                if (!appTarget) {\n                    throw new Error(FDC3.OpenError.AppNotFound);\n                }\n\n                instancesToTarget = [await startAppAndWaitForIntentMethod(appTarget, intent)];\n            }\n        }\n\n        invocationResult = (await (window as WindowType).glue.interop.invoke(methodName, context, instancesToTarget[0] || \"best\")).all_return_values;\n\n        if (invocationResult) {\n            return {\n                source: invocationResult[0].executed_by?.applicationName || \"unknown\",\n                version: \"1.0.0\",\n                data: invocationResult[0].returned\n            };\n        } else {\n            return {\n                source: \"unknown\",\n                version: \"1.0.0\"\n            };\n        }\n    };\n\n    const addIntentListener = (intent: string, handler: (context: FDC3.Context) => void): FDC3.Listener => {\n        let unsub: () => void;\n        let initialContext: FDC3.Context;\n\n        const methodName = `${GLUE42_CORE_FDC3_INTENTS_METHOD_PREFIX}${intent}`;\n\n        (window as WindowType).gluePromise\n            .then(() => {\n                return (window as WindowType).glue.windows.my().getContext();\n            })\n            .then((glueContext) => {\n                initialContext = glueContext?.intentContext;\n\n                return (window as WindowType).glue.interop.register(methodName, handler);\n            }).then(() => {\n                unsub = (): void => (window as WindowType).glue.interop.unregister(methodName);\n\n                if (initialContext) {\n                    handler(initialContext);\n                }\n            });\n\n        return {\n            unsubscribe: (): void => unsub()\n        };\n    };\n\n    return {\n        findIntent: async (...props): Promise<FDC3.AppIntent> => {\n            await (window as WindowType).gluePromise;\n            return findIntent(...props);\n        },\n        findIntentsByContext: async (...props): Promise<FDC3.AppIntent[]> => {\n            await (window as WindowType).gluePromise;\n            return findIntentsByContext(...props);\n        },\n        raiseIntent: async (...props): Promise<FDC3.IntentResolution> => {\n            await (window as WindowType).gluePromise;\n            return raiseIntent(...props);\n        },\n        addIntentListener\n    };\n};\n\nconst createGlue42EnterpriseDesktopAgent = (): Partial<FDC3.DesktopAgent> => {\n    const findIntent = async (intent: string, context?: FDC3.Context): Promise<FDC3.AppIntent> => {\n        const glueIntent = await ((window as WindowType).glue as Glue42.Glue).intents.find({ name: intent, contextType: context?.type });\n\n        if (!glueIntent) {\n            throw new Error(FDC3.ResolveError.NoAppsFound);\n        }\n\n        return convertGlue42IntentToFDC3AppIntent(glueIntent);\n    };\n\n\n    const findIntentsByContext = async (context: FDC3.Context): Promise<FDC3.AppIntent[]> => {\n        if (!context.type) {\n            throw new Error(\"Only filtering by context.type is supported.\");\n        }\n        const glueIntents = await ((window as WindowType).glue as Glue42.Glue).intents.findByContext(context.type);\n\n        if (!glueIntents || glueIntents.length === 0) {\n            throw new Error(FDC3.ResolveError.NoAppsFound);\n        }\n\n        return glueIntents.map((gIntent) => convertGlue42IntentToFDC3AppIntent(gIntent));\n    };\n\n\n    const raiseIntent = async (intent: string, context: FDC3.Context, target?: string): Promise<FDC3.IntentResolution> => {\n        const glueIntentResult = await ((window as WindowType).glue as Glue42.Glue).intents.raise({ intent, context, target });\n\n        if (!glueIntentResult) {\n            throw new Error(`No intent resolution for ${intent}, context: ${JSON.stringify(context)}, target: ${target}`);\n        }\n\n        return {\n            source: glueIntentResult.applicationInstance,\n            version: \"1.0.0\"\n        };\n    };\n\n\n    const addIntentListener = (intent: string, handler: (context: FDC3.Context) => void): FDC3.Listener => {\n        let unsub: () => void;\n        let initialContext: FDC3.Context;\n\n        (window as WindowType).gluePromise\n            .then(() => {\n                return (window as WindowType).glue.windows.my().getContext();\n            })\n            .then((glueContext) => {\n                initialContext = glueContext?.intentContext;\n\n                // Fixed in @glue42/desktop@5.2.0.\n                unsub = ((window as WindowType).glue as Glue42.Glue).intents.addIntentListener(intent, handler as (context: object) => void) as unknown as () => {};\n\n                if (initialContext) {\n                    handler(initialContext);\n                }\n            });\n\n        return {\n            unsubscribe: (): void => unsub()\n        };\n    };\n\n    return {\n        findIntent: async (...props): Promise<FDC3.AppIntent> => {\n            await (window as WindowType).gluePromise;\n            return findIntent(...props);\n        },\n        findIntentsByContext: async (...props): Promise<FDC3.AppIntent[]> => {\n            await (window as WindowType).gluePromise;\n            return findIntentsByContext(...props);\n        },\n        raiseIntent: async (...props): Promise<FDC3.IntentResolution> => {\n            await (window as WindowType).gluePromise;\n            return raiseIntent(...props);\n        },\n        addIntentListener\n    };\n};\n\nconst createDesktopAgent = (): FDC3.DesktopAgent => {\n    const coreDesktopAgent = createCoreDesktopAgent();\n    const desktopAgent = isGlue42Core ? createGlue42CoreDesktopAgent() : createGlue42EnterpriseDesktopAgent();\n    const channelsAPI = createChannelsApi();\n\n    return {\n        ...coreDesktopAgent,\n        ...desktopAgent,\n        ...channelsAPI\n    } as FDC3.DesktopAgent;\n};\n\nexport default createDesktopAgent;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) {\r\n        if (system.parent === undefined) {\r\n            return;\r\n        }\r\n        joinPromise.then(function () {\r\n            var metric = {\r\n                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [metric],\r\n            };\r\n            session.send(createMetricsMsg);\r\n        });\r\n    };\r\n    var updateSystem = function (system, state) {\r\n        joinPromise.then(function () {\r\n            var shadowedUpdateMetric = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        value: {\r\n                            Description: state.description,\r\n                            Value: state.state,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(shadowedUpdateMetric);\r\n            var stateObj = composeMsgForRootStateMetric(system);\r\n            var rootMetric = {\r\n                type: \"publish\",\r\n                peer_id: connection.peerId,\r\n                values: [{\r\n                        name: \"/State\",\r\n                        value: {\r\n                            Description: stateObj.description,\r\n                            Value: stateObj.value,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(rootMetric);\r\n        });\r\n    };\r\n    var createMetric = function (metric) {\r\n        var metricClone = cloneMetric(metric);\r\n        joinPromise.then(function () {\r\n            var m = serializeMetric(metricClone);\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [m],\r\n            };\r\n            session.send(createMetricsMsg);\r\n            if (typeof metricClone.value !== \"undefined\") {\r\n                updateMetricCore(metricClone);\r\n            }\r\n        });\r\n    };\r\n    var updateMetric = function (metric) {\r\n        var metricClone = cloneMetric(metric);\r\n        joinPromise.then(function () { return updateMetricCore(metricClone); });\r\n    };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(publishMetricsMsg);\r\n        }\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing.update(value);\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    return repo.root;\r\n});\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib = createRegistry;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar WebSocketConstructor = Utils.isNode() ? require(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this._running = true;\r\n        this._registry = lib();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1 = {\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte() {\n    if (!crypto || !crypto.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser = randomByte;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid = isShortId;\n\nvar lib$1 = createCommonjsModule(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1.lookup, version);\n    str = str + encode_1(alphabet_1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid;\n});\nvar lib_1 = lib$1.generate;\nvar lib_2 = lib$1.seed;\nvar lib_3 = lib$1.worker;\nvar lib_4 = lib$1.characters;\nvar lib_5 = lib$1.decode;\nvar lib_6 = lib$1.isValid;\n\nvar shortid = lib$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected, 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var _a, _b;\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            if (((_a = Logger.Interop) === null || _a === void 0 ? void 0 : _a.methods({ name: Logger.InteropMethodName }).length) > 0) {\r\n                (_b = Logger.Interop) === null || _b === void 0 ? void 0 : _b.invoke(Logger.InteropMethodName, {\r\n                    msg: \"\" + message,\r\n                    logger: loggerName,\r\n                    level: level\r\n                });\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version = \"5.0.7\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_e) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"error\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    return {\r\n        bus: (_a = configuration.bus) !== null && _a !== void 0 ? _a : false,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_b = configuration.metrics) !== null && _b !== void 0 ? _b : true,\r\n        contexts: (_c = configuration.contexts) !== null && _c !== void 0 ? _c : true,\r\n        version: ext.version || version,\r\n        libs: (_d = ext.libs) !== null && _d !== void 0 ? _d : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nfunction timer () {\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        period = now() - startTime;\r\n        return period;\r\n    }\r\n    return {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta) {\r\n    if (delta) {\r\n        if (delta.reset) {\r\n            context = __assign({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n    }\r\n    return context;\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            if (!_this._contextIdToName[createContextMsg.context_id]) {\r\n                _this._contextIdToName[createContextMsg.context_id] = name;\r\n                var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n                contextData.isAnnounced = true;\r\n                contextData.name = name;\r\n                contextData.contextId = createContextMsg.context_id;\r\n                _this._contextNameToData[name] = contextData;\r\n                contextData.context = createContextMsg.data;\r\n                contextData.sentExplicitSubscription = true;\r\n                if (contextData.context) {\r\n                    _this.invokeUpdateCallbacks(contextData, contextData.context, undefined);\r\n                }\r\n                return _this.update(name, data).then(function () { return createContextMsg.context_id; });\r\n            }\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name, false)];\r\n                    case 1:\r\n                        currentContext = _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.calculateContextDelta(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name, resolveImmediately) {\r\n        var _this = this;\r\n        if (resolveImmediately === undefined) {\r\n            resolveImmediately = true;\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced ||\r\n            !contextData.hasCallbacks()) {\r\n            if (!resolveImmediately) {\r\n                return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _this = this;\r\n                    return __generator(this, function (_a) {\r\n                        this.subscribe(name, function (data, delta, removed, un) {\r\n                            _this.unsubscribe(un);\r\n                            resolve(data);\r\n                        });\r\n                        return [2];\r\n                    });\r\n                }); });\r\n            }\r\n        }\r\n        return Promise.resolve(contextData && contextData.context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context &&\r\n                    contextData.sentExplicitSubscription) {\r\n                    callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, data, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(data), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDelta = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, delta) {\r\n        this.checkName(name);\r\n        return this._bridge.update(name, delta);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name, resolveImmediately) {\r\n        if (resolveImmediately === undefined) {\r\n            resolveImmediately = true;\r\n        }\r\n        return this._bridge.get(name, resolveImmediately);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" ||\r\n            name === \"\") {\r\n            throw new Error(\"'name' must be non-empty string, got '\" + name + \"'\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    return new Promise(function (resolve, reject) { return setTimeout(function () { return reject(error); }, ms); });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign(__assign({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid();\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, serversMethodPair.methods[0], argumentObj, serversMethodPair.server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached\",\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer();\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            _logger.trace(name + \" is ready\");\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer();\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                _logger.trace(\"trying to get gw token...\");\r\n                authPromise = glue42gd.getGWToken().then(function (token) {\r\n                    _logger.trace(\"got GW token \" + (token === null || token === void 0 ? void 0 : token.substring(token.length - 10)));\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer();\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c;\r\n        var initTimer = timer();\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var rootMetrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_a = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _a !== void 0 ? _a : \"metrics-service\",\r\n            instance: (_c = (_b = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _b !== void 0 ? _b : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _c !== void 0 ? _c : shortid(),\r\n        });\r\n        var rootSystem = rootMetrics;\r\n        if (typeof config !== \"boolean\" && config.disableAutoAppSystem) {\r\n            rootSystem = rootMetrics;\r\n        }\r\n        else {\r\n            rootSystem = rootMetrics.subSystem(\"App\");\r\n        }\r\n        _metrics = addFAVSupport(rootSystem);\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer();\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer();\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer();\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer();\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var result = Object.keys(glue)\r\n                    .filter(function (key) {\r\n                    var _a;\r\n                    if (key === \"initTimes\" || key === \"agm\") {\r\n                        return false;\r\n                    }\r\n                    return (_a = glue[key]) === null || _a === void 0 ? void 0 : _a.initTime;\r\n                })\r\n                    .map(function (key) {\r\n                    return {\r\n                        name: key,\r\n                        time: glue[key].initTime,\r\n                        startTime: glue[key].initStartTime,\r\n                        endTime: glue[key].initEndTime\r\n                    };\r\n                });\r\n                result.push({\r\n                    name: \"glue\",\r\n                    startTime: glueInitTimer.startTime,\r\n                    endTime: glueInitTimer.endTime,\r\n                    time: glueInitTimer.period\r\n                });\r\n                return result;\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version;\r\nGlueCore.default = GlueCore;\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar ActivityEntity = (function () {\r\n    function ActivityEntity(id) {\r\n        this._id = id;\r\n    }\r\n    Object.defineProperty(ActivityEntity.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityEntity.prototype._update = function (other) {\r\n        if (other._id !== this._id) {\r\n            throw Error(\"Can not update from entity with different id.\");\r\n        }\r\n        this._updateCore(other);\r\n    };\r\n    ActivityEntity.prototype._updateCore = function (other) {\r\n        return;\r\n    };\r\n    ActivityEntity.prototype._beforeDelete = function (other) {\r\n        return;\r\n    };\r\n    return ActivityEntity;\r\n}());\n\nfunction isString(arg) {\r\n    return typeof arg === \"string\";\r\n}\r\nfunction isObject(arg) {\r\n    return typeof arg === \"object\" && arg !== null;\r\n}\r\nfunction isArray(arg) {\r\n    if (Array.isArray) {\r\n        return Array.isArray(arg);\r\n    }\r\n    return toString.call(arg) === \"[object Array]\";\r\n}\r\nfunction isUndefined(arg) {\r\n    return typeof arg === \"undefined\";\r\n}\r\nfunction isUndefinedOrNull(arg) {\r\n    return !arg || typeof arg === \"undefined\";\r\n}\r\nfunction isFunction(arg) {\r\n    return !!(arg && arg.constructor && arg.call && arg.apply);\r\n}\r\nfunction some(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction ifNotUndefined(what, doWithIt) {\r\n    if (typeof what !== \"undefined\") {\r\n        doWithIt(what);\r\n    }\r\n}\r\nfunction promisify$1(promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { return; };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { return; };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\n\nvar ActivityType = (function (_super) {\r\n    __extends$1(ActivityType, _super);\r\n    function ActivityType(name, ownerWindow, helperWindows, description) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._description = description;\r\n        _this._ownerWindow = ownerWindow;\r\n        _this._helperWindows = helperWindows || [];\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ActivityType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"description\", {\r\n        get: function () {\r\n            return this._description;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"helperWindows\", {\r\n        get: function () {\r\n            return this._helperWindows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"ownerWindow\", {\r\n        get: function () {\r\n            return this._ownerWindow;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityType.prototype.initiate = function (context, callback, configuration) {\r\n        return this._manager.initiate(this._name, context, callback, configuration);\r\n    };\r\n    ActivityType.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._description, function (x) { return _this._description = x; });\r\n        ifNotUndefined(other._ownerWindow, function (x) { return _this._ownerWindow = x; });\r\n        ifNotUndefined(other._helperWindows, function (x) { return _this._helperWindows = x; });\r\n    };\r\n    return ActivityType;\r\n}(ActivityEntity));\n\nvar WindowType = (function (_super) {\r\n    __extends$1(WindowType, _super);\r\n    function WindowType(name, appByWindowTypeGetter) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._appByWindowTypeGetter = appByWindowTypeGetter;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(WindowType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"config\", {\r\n        get: function () {\r\n            return this._appByWindowTypeGetter(this._name);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ type: this._name });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowType.prototype.create = function (activity, configuration) {\r\n        var definition = Object.assign({ type: this.name, name: this.name, isIndependent: false }, configuration);\r\n        return this._manager.createWindow(activity, definition);\r\n    };\r\n    return WindowType;\r\n}(ActivityEntity));\n\nvar EntityEvent = (function () {\r\n    function EntityEvent(entitiy, context) {\r\n        this.entity = entitiy;\r\n        this.context = context;\r\n    }\r\n    return EntityEvent;\r\n}());\r\nvar EntityEventContext = (function () {\r\n    function EntityEventContext(eventType) {\r\n        this.type = eventType;\r\n    }\r\n    return EntityEventContext;\r\n}());\r\nvar ActivityStatusChangeEventContext = (function (_super) {\r\n    __extends$1(ActivityStatusChangeEventContext, _super);\r\n    function ActivityStatusChangeEventContext(newStatus, oldStatus) {\r\n        var _this = _super.call(this, EntityEventType.StatusChange) || this;\r\n        _this.newStatus = newStatus;\r\n        _this.oldStatus = oldStatus;\r\n        return _this;\r\n    }\r\n    return ActivityStatusChangeEventContext;\r\n}(EntityEventContext));\r\nvar ActivityContextChangedEventContext = (function (_super) {\r\n    __extends$1(ActivityContextChangedEventContext, _super);\r\n    function ActivityContextChangedEventContext(context, updated, removed) {\r\n        var _this = _super.call(this, EntityEventType.ActivityContextChange) || this;\r\n        _this.context = typeof context === \"string\" ? JSON.parse(context) : context;\r\n        _this.updated = updated;\r\n        _this.removed = removed;\r\n        return _this;\r\n    }\r\n    return ActivityContextChangedEventContext;\r\n}(EntityEventContext));\r\nvar EntityEventType = (function () {\r\n    function EntityEventType() {\r\n    }\r\n    EntityEventType.Added = \"added\";\r\n    EntityEventType.Removed = \"removed\";\r\n    EntityEventType.Updated = \"updated\";\r\n    EntityEventType.Closed = \"closed\";\r\n    EntityEventType.StatusChange = \"statusChange\";\r\n    EntityEventType.ActivityContextChange = \"activityContextUpdate\";\r\n    EntityEventType.ActivityWindowEvent = \"activityWindowEvent\";\r\n    EntityEventType.ActivityWindowJoinedActivity = \"joined\";\r\n    EntityEventType.ActivityWindowLeftActivity = \"left\";\r\n    return EntityEventType;\r\n}());\r\nvar ActivityState = (function () {\r\n    function ActivityState() {\r\n    }\r\n    ActivityState.Created = \"created\";\r\n    ActivityState.Started = \"started\";\r\n    ActivityState.Destroyed = \"destroyed\";\r\n    return ActivityState;\r\n}());\n\nvar ActivityAGM = (function () {\r\n    function ActivityAGM(activity) {\r\n        this._activity = activity;\r\n    }\r\n    ActivityAGM.prototype.register = function (definition, handler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.register(definition, handler);\r\n    };\r\n    ActivityAGM.prototype.servers = function () {\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        return this._activity.windows.map(function (w) {\r\n            return w.instance;\r\n        });\r\n    };\r\n    ActivityAGM.prototype.methods = function () {\r\n        var _this = this;\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        var windows = this._activity.windows;\r\n        var methodNames = [];\r\n        var methods = [];\r\n        windows.forEach(function (window) {\r\n            var windowMethods = _this.methodsForWindow(window);\r\n            windowMethods.forEach(function (currentWindowMethod) {\r\n                if (methodNames.indexOf(currentWindowMethod.name) === -1) {\r\n                    methodNames.push(currentWindowMethod.name);\r\n                    methods.push(currentWindowMethod);\r\n                }\r\n            });\r\n        });\r\n        return methods;\r\n    };\r\n    ActivityAGM.prototype.methodsForWindow = function (window) {\r\n        this._ensureHasAgm();\r\n        if (!window.instance) {\r\n            return [];\r\n        }\r\n        return ActivityAGM.AGM.methodsForInstance(window.instance);\r\n    };\r\n    ActivityAGM.prototype.invoke = function (methodName, arg, target, options, success, error) {\r\n        this._ensureHasAgm();\r\n        var activityServers = this.servers();\r\n        var serversToInvokeAgainst = [];\r\n        if (isUndefinedOrNull(target)) {\r\n            target = \"activity.all\";\r\n        }\r\n        if (isString(target)) {\r\n            if (target === \"activity.all\") {\r\n                serversToInvokeAgainst = activityServers;\r\n            }\r\n            else if (target === \"activity.best\") {\r\n                var potentialTargets = activityServers.filter(function (server) {\r\n                    var methods = ActivityAGM.AGM.methodsForInstance(server);\r\n                    return methods.filter(function (m) {\r\n                        return m.name === methodName;\r\n                    }).length > 0;\r\n                });\r\n                if (potentialTargets.length > 0) {\r\n                    serversToInvokeAgainst = [potentialTargets[0]];\r\n                }\r\n            }\r\n            else if (target === \"all\" || target === \"best\") {\r\n                return promisify$1(ActivityAGM.AGM.invoke(methodName, arg, target, options), success, error);\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid invoke target \" + target);\r\n            }\r\n        }\r\n        else if (isArray(target)) {\r\n            if (target.length >= 0) {\r\n                var firstElem = target[0];\r\n                if (this._isInstance(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (instance) { return instance; });\r\n                }\r\n                else if (this._isActivityWindow(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (win) { return win.instance; });\r\n                }\r\n                else {\r\n                    throw new Error(\"Unknown target object\");\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isInstance(target)) {\r\n                serversToInvokeAgainst = [target];\r\n            }\r\n            else if (this._isActivityWindow(target)) {\r\n                serversToInvokeAgainst = [target.instance];\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown target object\");\r\n            }\r\n        }\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    ActivityAGM.prototype.unregister = function (definition) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.unregister(definition);\r\n    };\r\n    ActivityAGM.prototype.createStream = function (methodDefinition, subscriptionAddedHandler, subscriptionRemovedHandler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.createStream(methodDefinition, {\r\n            subscriptionAddedHandler: subscriptionAddedHandler,\r\n            subscriptionRemovedHandler: subscriptionRemovedHandler,\r\n            subscriptionRequestHandler: undefined\r\n        });\r\n    };\r\n    ActivityAGM.prototype.subscribe = function (methodDefinition, parameters, target) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.subscribe(methodDefinition, parameters);\r\n    };\r\n    ActivityAGM.prototype._ensureHasAgm = function () {\r\n        if (isUndefinedOrNull(ActivityAGM.AGM)) {\r\n            throw new Error(\"Agm should be configured to be used in activity\");\r\n        }\r\n    };\r\n    ActivityAGM.prototype._isInstance = function (obj) {\r\n        return obj.application !== undefined;\r\n    };\r\n    ActivityAGM.prototype._isActivityWindow = function (obj) {\r\n        return obj.instance !== undefined;\r\n    };\r\n    return ActivityAGM;\r\n}());\n\nvar AttachedActivityDescriptor = (function () {\r\n    function AttachedActivityDescriptor(manager, ownerActivityId, state) {\r\n        this._manager = manager;\r\n        this._ownerActivityId = ownerActivityId;\r\n        this._state = state;\r\n    }\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"ownerId\", {\r\n        get: function () {\r\n            return this._state.ownerId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"windowIds\", {\r\n        get: function () {\r\n            return this._state.windowIds;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"frameColor\", {\r\n        get: function () {\r\n            return this._state.frameColor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"context\", {\r\n        get: function () {\r\n            return this._state.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"tag\", {\r\n        get: function () {\r\n            return this._state.tag;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AttachedActivityDescriptor.prototype.detach = function (descriptor) {\r\n        var _this = this;\r\n        descriptor = descriptor || {};\r\n        var merged = {};\r\n        Object.keys(this._state).forEach(function (prop) {\r\n            merged[prop] = _this._state[prop];\r\n        });\r\n        merged.context = descriptor.context || merged.context;\r\n        merged.frameColor = descriptor.frameColor || merged.frameColor;\r\n        return this._manager.detachActivities(this._ownerActivityId, merged);\r\n    };\r\n    return AttachedActivityDescriptor;\r\n}());\n\nvar nextTick = function (cb) {\r\n    setTimeout(cb, 0);\r\n};\r\nfunction nodeify(promise, callback) {\r\n    if (!isFunction(callback)) {\r\n        return promise;\r\n    }\r\n    promise.then(function (resp) {\r\n        nextTick(function () {\r\n            callback(null, resp);\r\n        });\r\n    }, function (err) {\r\n        nextTick(function () {\r\n            callback(err, null);\r\n        });\r\n    });\r\n}\n\nvar Activity = (function (_super) {\r\n    __extends$1(Activity, _super);\r\n    function Activity(id, actType, status, context, ownerId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._id = id;\r\n        _this._actType = actType;\r\n        _this._status = status;\r\n        _this._context = context;\r\n        _this._ownerId = ownerId;\r\n        _this._agm = new ActivityAGM(_this);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Activity.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getActivityType(this._actType);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"context\", {\r\n        get: function () {\r\n            return this._context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"status\", {\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"owner\", {\r\n        get: function () {\r\n            if (!this._ownerId) {\r\n                return null;\r\n            }\r\n            return this._manager.getWindows({ id: this._ownerId })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ activityId: this._id });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.addWindow = function (window, callback) {\r\n        return this._manager.addWindowToActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.createWindow = function (windowType, callback) {\r\n        return this._manager.createWindow(this, windowType, callback);\r\n    };\r\n    Activity.prototype.createStackedWindows = function (windowTypes, timeout, callback) {\r\n        return this._manager.createStackedWindows(this, windowTypes, timeout, callback);\r\n    };\r\n    Activity.prototype.leave = function (window, callback) {\r\n        return this._manager.leaveWindowFromActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.getWindowsByType = function (windowType) {\r\n        var filter = { activityId: this._id, type: windowType };\r\n        return this._manager.getWindows(filter);\r\n    };\r\n    Activity.prototype.setContext = function (context, callback) {\r\n        return this._manager.setActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.updateContext = function (context, callback) {\r\n        return this._manager.updateActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.onStatusChange = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeActivityEvents(function (a, ns, os) {\r\n            if (a.id === _this.id) {\r\n                handler(a, ns, os);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onWindowEvent = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeWindowEvents(function (a, w, e) {\r\n            if (a.id === _this.id) {\r\n                handler(a, w, e);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onContextChanged = function (handler) {\r\n        var _this = this;\r\n        this._manager.subscribeActivityContextChanged(function (act, context, updated, removed) {\r\n            if (act.id === _this.id) {\r\n                handler(context, updated, removed, act);\r\n            }\r\n        });\r\n        try {\r\n            handler(this.context, this.context, [], this);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n    };\r\n    Activity.prototype.stop = function () {\r\n        this._manager.stopActivity(this);\r\n    };\r\n    Activity.prototype.clone = function (options) {\r\n        return this._manager.clone(this, options);\r\n    };\r\n    Activity.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._manager.attachActivities(activityId, this.id, tag);\r\n    };\r\n    Activity.prototype.onActivityAttached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesAttached(function (newActId, oldActId, descriptor) {\r\n            if (newActId !== _this._id) {\r\n                return;\r\n            }\r\n            callback(descriptor);\r\n        });\r\n    };\r\n    Activity.prototype.onDetached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesDetached(function (newAct, originalActivity, state) {\r\n            if (originalActivity.id !== _this._id) {\r\n                return;\r\n            }\r\n            callback(newAct, state);\r\n        });\r\n    };\r\n    Activity.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._actType, function (x) { return _this._actType = x; });\r\n        ifNotUndefined(other._context, function (x) { return _this._context = x; });\r\n        ifNotUndefined(other._ownerId, function (x) { return _this._ownerId = x; });\r\n        if (other._status && (!this._status || (this._status.state !== other._status.state))) {\r\n            this._status = other._status;\r\n        }\r\n    };\r\n    Activity.prototype._updateDescriptors = function (allStates) {\r\n        var _this = this;\r\n        this._attached = allStates.map(function (s) {\r\n            return new AttachedActivityDescriptor(_this._manager, _this._id, s);\r\n        });\r\n    };\r\n    Object.defineProperty(Activity.prototype, \"attached\", {\r\n        get: function () {\r\n            return this._attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.setFrameColor = function (color, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var callbacksToWait = _this.windows.length;\r\n            if (callbacksToWait === 0) {\r\n                resolve(_this);\r\n            }\r\n            _this.windows.forEach(function (w) {\r\n                w.underlyingWindow.setFrameColor(color, function () {\r\n                    callbacksToWait--;\r\n                    if (callbacksToWait <= 0) {\r\n                        resolve(_this);\r\n                    }\r\n                });\r\n            });\r\n            setTimeout(function () {\r\n                if (callbacksToWait > 0) {\r\n                    reject(_this.id + \" - timed out waiting for setFrameColor with\" + color);\r\n                }\r\n            }, 5000);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Activity.prototype.getFrameColor = function () {\r\n        if (!this.windows || this.windows.length === 0) {\r\n            return \"\";\r\n        }\r\n        return this.windows[0].underlyingWindow.frameColor;\r\n    };\r\n    return Activity;\r\n}(ActivityEntity));\n\nvar LogLevel = (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.Trace = \"trace\";\r\n    LogLevel.Debug = \"debug\";\r\n    LogLevel.Info = \"info\";\r\n    LogLevel.Warn = \"warn\";\r\n    LogLevel.Error = \"error\";\r\n    return LogLevel;\r\n}());\r\nvar Logger$1 = (function () {\r\n    function Logger(name) {\r\n        this._name = name;\r\n        if (!isUndefinedOrNull(Logger.GlueLogger)) {\r\n            this._glueLogger = Logger.GlueLogger.subLogger(name);\r\n        }\r\n    }\r\n    Logger.GetNamed = function (name) {\r\n        return new Logger(name);\r\n    };\r\n    Logger.Get = function (owner) {\r\n        return new Logger(Logger.GetTypeName(owner));\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.trace(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Trace));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.debug(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Debug));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.info(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.warn(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info ||\r\n                Logger.Level === LogLevel.Warn) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.error = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.error(message);\r\n        }\r\n        else {\r\n            console.error(this._getMessage(message, LogLevel.Error));\r\n            console.trace();\r\n        }\r\n    };\r\n    Logger.prototype._getMessage = function (message, level) {\r\n        return \"[\" + level + \"] \" + this._name + \" - \" + message;\r\n    };\r\n    Logger.GetTypeName = function (object) {\r\n        var funcNameRegex = /function (.{1,})\\(/;\r\n        var results = (funcNameRegex).exec(object.constructor.toString());\r\n        return (results && results.length > 1) ? results[1] : \"\";\r\n    };\r\n    Logger.Level = LogLevel.Info;\r\n    return Logger;\r\n}());\n\nvar ActivityWindow = (function (_super) {\r\n    __extends$1(ActivityWindow, _super);\r\n    function ActivityWindow(id, name, type, activityId, instance, isIndependent, windowGetter, hcWindowId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._logger = Logger$1.Get(\"window\");\r\n        _this._type = type;\r\n        _this._activityId = activityId;\r\n        _this._name = name;\r\n        _this._instance = instance;\r\n        _this._isIndependent = isIndependent;\r\n        _this._windowGetter = windowGetter;\r\n        _this._hcWindowId = hcWindowId;\r\n        return _this;\r\n    }\r\n    ActivityWindow.prototype.getBounds = function () {\r\n        return this._manager.getWindowBounds(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isIndependent\", {\r\n        get: function () {\r\n            return this._isIndependent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getWindowType(this._type);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"activity\", {\r\n        get: function () {\r\n            if (isUndefined(this._activityId)) {\r\n                return undefined;\r\n            }\r\n            return this._manager.getActivityById(this._activityId);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isOwner\", {\r\n        get: function () {\r\n            var act = this.activity;\r\n            if (isUndefined(act)) {\r\n                return false;\r\n            }\r\n            return act.owner.id === this.id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.setVisible = function (isVisible, callback) {\r\n        return this._manager.setWindowVisibility(this.id, isVisible);\r\n    };\r\n    ActivityWindow.prototype.activate = function (focus) {\r\n        return this._manager.activateWindow(this.id, focus);\r\n    };\r\n    ActivityWindow.prototype.setBounds = function (bounds, callback) {\r\n        return this._manager.setWindowBounds(this.id, bounds, callback);\r\n    };\r\n    ActivityWindow.prototype.close = function () {\r\n        return this._manager.closeWindow(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"instance\", {\r\n        get: function () {\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"underlyingWindow\", {\r\n        get: function () {\r\n            var window = this._windowGetter();\r\n            if (!window) {\r\n                return {\r\n                    id: this._hcWindowId\r\n                };\r\n            }\r\n            return window;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.onActivityJoined = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowJoinedActivity, callback);\r\n    };\r\n    ActivityWindow.prototype.onActivityRemoved = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowLeftActivity, callback);\r\n    };\r\n    ActivityWindow.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        ifNotUndefined(other._activityId, function (x) { return _this._activityId = x; });\r\n        ifNotUndefined(other._isIndependent, function (x) { return _this._isIndependent = x; });\r\n        ifNotUndefined(other._hcWindowId, function (x) { return _this._hcWindowId = x; });\r\n        ifNotUndefined(other._type, function (x) { return _this._type = x; });\r\n        ifNotUndefined(other._name, function (x) { return _this._name = x; });\r\n        if (!isUndefinedOrNull(other._instance)) {\r\n            this._instance = other._instance;\r\n        }\r\n    };\r\n    ActivityWindow.prototype._subscribeForActivityWindowEvent = function (eventName, callback) {\r\n        var _this = this;\r\n        this._manager.subscribeWindowEvents(function (activity, window, event) {\r\n            if (window.id !== _this.id) {\r\n                return;\r\n            }\r\n            if (event === eventName) {\r\n                callback(activity);\r\n            }\r\n        });\r\n    };\r\n    ActivityWindow.prototype._beforeDelete = function (other) {\r\n        this._hcWindowId = other._hcWindowId;\r\n    };\r\n    return ActivityWindow;\r\n}(ActivityEntity));\n\nvar ActivityStatus = (function () {\r\n    function ActivityStatus(state, message, time) {\r\n        this.state = state;\r\n        this.message = message;\r\n        this.time = time;\r\n    }\r\n    ActivityStatus.prototype.getState = function () {\r\n        return this.state;\r\n    };\r\n    ActivityStatus.prototype.getMessage = function () {\r\n        return this.message;\r\n    };\r\n    ActivityStatus.prototype.getTime = function () {\r\n        return this.time;\r\n    };\r\n    return ActivityStatus;\r\n}());\n\nvar gwMmessageError = \"error\";\r\nvar gwMessageAddActivityTypes = \"add-types\";\r\nvar gwMmessageActivityTypesAdded = \"types-added\";\r\nvar gwMessageRemoveActivityTypes = \"remove-types\";\r\nvar gwMessageActivityTypesRemoved = \"types-removed\";\r\nvar gwMessageActivityCreated = \"created\";\r\nvar gwMessageActivityDestroyed = \"destroyed\";\r\nvar gwMessageActivityInitiated = \"initiated\";\r\nvar gwMmessageJoinActivity = \"join-activity\";\r\nvar gwMessageJoinedActivity = \"joined\";\r\nvar gwMessageActivityJoined = \"activity-joined\";\r\nvar gwMessageLeaveActivity = \"leave-activity\";\r\nvar gwMessageActivityLeft = \"left\";\r\nvar gwNmessageMergeActivities = \"merge\";\r\nvar gwMessageSplitActivities = \"split\";\r\nvar gwMessageOwnerChanged = \"owner-changed\";\r\nvar gwMessageAddPeerFactories = \"add-peer-factories\";\r\nvar gwMessagePeerFactoriesAdded = \"peer-factories-added\";\r\nvar gwMessageRemovePeerFactories = \"remove-peer-factories\";\r\nvar gwMessagePeerFactoriesRemoved = \"peer-factories-removed\";\r\nvar gwMessageCreateActivity = \"create\";\r\nvar gwMessageCreatePeer = \"create-peer\";\r\nvar gwMessagePeerRequested = \"peer-requested\";\r\nvar gwMessageReady = \"ready\";\r\nvar gwMessagePeerCreated = \"peer-created\";\r\nvar gwMessageDestroyActivity = \"destroy\";\r\nvar gwMessageDisposePeer = \"dispose-peer\";\r\nvar GW3Bridge$1 = (function () {\r\n    function GW3Bridge(connection, logger, contexts, config) {\r\n        var _this = this;\r\n        this._activityChangeCallbacks = [];\r\n        this._activityTypeStatusChangeCallbacks = [];\r\n        this._activityWindowChangeCallbacks = [];\r\n        this._windowTypeStatusChangeCallbacks = [];\r\n        this._peerIdAndFactoryIdToPeerType = {};\r\n        this._peerFactoriesRegisteredByUs = {};\r\n        this._gw3Subscriptions = [];\r\n        this._contextSubscriptions = {};\r\n        this._activityTypesInitiatedFromMe = {};\r\n        this._config = config;\r\n        this._connection = connection;\r\n        this._logger = logger;\r\n        this._contexts = contexts;\r\n        this._sessionJoinedPromise = new Promise(function (resolve) {\r\n            _this._sessionJoinedPromiseResolve = resolve;\r\n        });\r\n        this._activityJoinedPromise = new Promise(function (resolve) {\r\n            _this._activityJoinedPromiseResolve = resolve;\r\n        });\r\n        if (!this._config.activityId) {\r\n            this._activityJoinedPromiseResolve({});\r\n        }\r\n        this._gw3Session = connection.domain(\"activity\", [\"joined\", \"initiated\", \"peer-created\", \"token\"]);\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd_1 = window.glue42gd;\r\n            if (glue42gd_1 && typeof glue42gd_1.addRefreshHandler === \"function\") {\r\n                glue42gd_1.addRefreshHandler(function (success, error) {\r\n                    _this._gw3Session\r\n                        .send({\r\n                        type: \"reload\"\r\n                    })\r\n                        .then(function (msg) {\r\n                        if (!msg.token) {\r\n                            error(\"Expected gateway token for refreshing.\");\r\n                            return;\r\n                        }\r\n                        try {\r\n                            glue42gd_1.setGWToken(msg.token);\r\n                        }\r\n                        catch (e) {\r\n                            error(e.message || e);\r\n                            return;\r\n                        }\r\n                        success();\r\n                    }, error);\r\n                });\r\n            }\r\n        }\r\n    }\r\n    GW3Bridge.activityTypeGwMessageEntityToActivityType = function (entity, description) {\r\n        var nameToWindowType = function (windowName) {\r\n            return new WindowType(windowName, undefined);\r\n        };\r\n        return new ActivityType(entity.name, entity.owner_type && nameToWindowType(entity.owner_type), entity.helper_types && entity.helper_types.map(nameToWindowType), description);\r\n    };\r\n    GW3Bridge.peerFactoryGwMessageEntityToWindowType = function (entity) {\r\n        return new WindowType(entity.peer_type, function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.activityGwMessageToActivity = function (msg, status) {\r\n        var ownerId = msg.owner !== undefined ? msg.owner.peer_id : msg.owner_id;\r\n        return new Activity(msg.activity_id, msg.activity_type, status, msg.context_snapshot, ownerId);\r\n    };\r\n    GW3Bridge.activityToActivityStatusChangeEvent = function (act) {\r\n        return new EntityEvent(act, new ActivityStatusChangeEventContext(act.status, undefined));\r\n    };\r\n    Object.defineProperty(GW3Bridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"GW3\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.init = function () {\r\n        var _this = this;\r\n        this.forwardActivityTypeMessagesToStatusEventHandlers();\r\n        this.subscribe(gwMessageActivityCreated, this.handleActivityCreatedMessage);\r\n        this.subscribe(gwMessageActivityDestroyed, this.handleActivityDestroyedMessage);\r\n        this.forwardActivityMessagesToStatusEventHandlers();\r\n        this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers();\r\n        this.forwardPeerFactoryMessagesToStatusEventHandlers();\r\n        this.forwardPeerFactoryMessagesToPeerFactoryRequests();\r\n        this.subscribe(gwMessagePeerFactoriesAdded, this.handlePeerFactoriesAdded);\r\n        this.subscribe(gwMessagePeerFactoriesRemoved, this.handlePeerFactoriesRemoved);\r\n        this.forwardActivityWindowMessagesToEventHandlers();\r\n        this.subscribe(gwMessageDisposePeer, function () {\r\n            if (_this._config.disposeRequestHandling === \"dispose\") {\r\n                _this.dispose();\r\n                return;\r\n            }\r\n            if (_this._config.disposeRequestHandling === \"exit\") {\r\n                if (typeof window !== \"undefined\" &&\r\n                    typeof window.close === \"function\") {\r\n                    window.close();\r\n                    return;\r\n                }\r\n                if (typeof process !== \"undefined\" &&\r\n                    typeof process.exit === \"function\") {\r\n                    process.exit();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        this._gw3Session.onJoined(function () {\r\n            if (_this._config.mode === \"trackMyOnly\" ||\r\n                _this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                _this._sessionJoinedPromiseResolve(_this);\r\n            }\r\n            else {\r\n                _this._gw3Session\r\n                    .send({\r\n                    type: \"subscribe\",\r\n                    activity_types: (_this._config.mode === \"trackAll\" ? [] :\r\n                        _this._config.mode === \"trackTypes\" ? _this._config.typesToTrack : [])\r\n                })\r\n                    .then(function () {\r\n                    _this._sessionJoinedPromiseResolve(_this);\r\n                });\r\n            }\r\n        });\r\n        this._gw3Session.join();\r\n    };\r\n    GW3Bridge.prototype.dispose = function () {\r\n        var _this = this;\r\n        this._gw3Subscriptions.forEach(function (sub) { return sub && _this._connection.off(sub); });\r\n        this._gw3Subscriptions.length = 0;\r\n    };\r\n    GW3Bridge.prototype.ready = function () {\r\n        return Promise.all([this._sessionJoinedPromise, this._activityJoinedPromise]);\r\n    };\r\n    GW3Bridge.prototype.initReady = function () {\r\n        return this._sessionJoinedPromise;\r\n    };\r\n    GW3Bridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, config, description) {\r\n        var _this = this;\r\n        var entity = {};\r\n        entity.name = activityTypeName;\r\n        var toActivityPeerConfig = function (windowDefinition) { return ({ type: windowDefinition.type, name: windowDefinition.name, configuration: windowDefinition }); };\r\n        entity.owner_type = toActivityPeerConfig(ownerWindow);\r\n        entity.helper_types = helperWindows.map(toActivityPeerConfig);\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageAddActivityTypes,\r\n            types: [entity]\r\n        })\r\n            .then(function () {\r\n            var activityType = GW3Bridge.activityTypeGwMessageEntityToActivityType(entity, description);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Added)), gwMessageAddActivityTypes);\r\n            return activityType;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageRemoveActivityTypes,\r\n            types: [activityTypeName]\r\n        })\r\n            .then(function () {\r\n            var activityType = new ActivityType(activityTypeName, undefined, undefined, undefined);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Removed)), gwMessageAddActivityTypes);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerWindowFactory = function (windowType, factory, parameters) {\r\n        var _this = this;\r\n        if (this._peerFactoriesRegisteredByUs[windowType]) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" already registered.\"));\r\n        }\r\n        this._peerFactoriesRegisteredByUs[windowType] = factory;\r\n        var entity = {\r\n            id: windowType,\r\n            peer_type: windowType,\r\n            configuration: parameters\r\n        };\r\n        return this._gw3Session.send({\r\n            type: gwMessageAddPeerFactories,\r\n            factories: [entity]\r\n        })\r\n            .then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(entity), new EntityEventContext(EntityEventType.Added)), gwMessageAddPeerFactories);\r\n        })\r\n            .catch(function () {\r\n            delete _this._peerFactoriesRegisteredByUs[windowType];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterWindowFactory = function (windowType) {\r\n        var _this = this;\r\n        var factory = this._peerFactoriesRegisteredByUs[windowType];\r\n        if (!factory) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" not registered.\"));\r\n        }\r\n        delete this._peerFactoriesRegisteredByUs[windowType];\r\n        return this._gw3Session.send({\r\n            type: gwMessageRemovePeerFactories,\r\n            factory_ids: [windowType]\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(new WindowType(windowType, undefined), new EntityEventContext(EntityEventType.Removed)), gwMessageAddPeerFactories);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        var initiateMsg = {\r\n            type: gwMessageCreateActivity,\r\n            activity_type: activityType,\r\n            initial_context: context,\r\n        };\r\n        if (this.isOverrideTypeDefinition(configuration)) {\r\n            initiateMsg.types_override = {\r\n                owner_type: { type: configuration.owner.type, name: configuration.owner.name, configuration: configuration.owner },\r\n                helper_types: configuration.helpers && configuration.helpers.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); })\r\n            };\r\n        }\r\n        else {\r\n            initiateMsg.configuration = configuration && configuration.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); });\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise(initiateMsg, gwMessageActivityInitiated, function (msg, requestId) { return msg.request_id === requestId; }, gwMessageActivityCreated, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, gwMessageActivityDestroyed, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, function (msg) { return msg.activity_id; }).then(function (id) {\r\n            if (_this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                if (!_this._activityTypesInitiatedFromMe[activityType]) {\r\n                    _this._activityTypesInitiatedFromMe[activityType] = true;\r\n                    return _this._gw3Session\r\n                        .send({\r\n                        type: \"subscribe\",\r\n                        activity_types: [activityType]\r\n                    })\r\n                        .then(function () {\r\n                        return id;\r\n                    });\r\n                }\r\n            }\r\n            return id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.stopActivity = function (activity) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyActivity,\r\n            activity_id: activity.id,\r\n            reason_uri: \"com.tick42.glue.activity.constants.destroyReason.general\",\r\n            reason: \"Destroying activity\"\r\n        }).then(function (_) { return true; });\r\n    };\r\n    GW3Bridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        if (fullReplace) {\r\n            return this._contexts.set(activity.id, context);\r\n        }\r\n        else {\r\n            removedKeys = removedKeys || [];\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var x = removedKeys_1[_i];\r\n                context[x] = null;\r\n            }\r\n            return this._contexts.update(activity.id, context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        throw new Error(\"Invalid operation 'announceWindow' for GW3 protocol\");\r\n    };\r\n    GW3Bridge.prototype.registerWindow = function (type, name, independent) {\r\n        var shouldSendReady = typeof this._connection.gatewayToken !== \"undefined\";\r\n        var peerId = this._connection.peerId;\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                shouldSendReady = typeof glue42gd.activityInfo !== \"undefined\";\r\n            }\r\n        }\r\n        if (shouldSendReady) {\r\n            this._gw3Session.send({\r\n                type: gwMessageReady,\r\n            });\r\n        }\r\n        this.invokeCallbacks(this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(peerId, name, type, undefined, this.getAgmInstance(peerId), independent, this.generateWindowGetter(peerId), undefined), new EntityEventContext(EntityEventType.Added)), \"register window\");\r\n        return Promise.resolve(peerId);\r\n    };\r\n    GW3Bridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._activityWindowChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.createWindow = function (activityId, windowDefinition) {\r\n        var _this = this;\r\n        if (!windowDefinition.layout) {\r\n            if (windowDefinition.left || windowDefinition.width || windowDefinition.height || windowDefinition.top) {\r\n                windowDefinition.layout = {\r\n                    mode: \"pixels\",\r\n                    cellSize: 1,\r\n                };\r\n            }\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise({\r\n            type: gwMessageCreatePeer,\r\n            peer_type: windowDefinition.type,\r\n            peer_name: windowDefinition.name || windowDefinition.type,\r\n            configuration: windowDefinition,\r\n            activity_id: activityId,\r\n        }, undefined, undefined, gwMessagePeerCreated, function (msg, requestId) { return msg.request_id === requestId; }, undefined, undefined, function (msg) { return msg.created_id; })\r\n            .then(function (id) {\r\n            if (!activityId) {\r\n                return;\r\n            }\r\n            return _this.joinActivity(activityId, id, windowDefinition.name)\r\n                .then(function () {\r\n                return id;\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.closeWindow = function (id) {\r\n        return this._gw3Session.send({\r\n            destroy_peer_id: id\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.getAnnouncementInfo = function () {\r\n        var activityId = this._config.activityId || (this._config.announcementInfo && this._config.announcementInfo.activityId);\r\n        var activityWindowType = (this._config.announcementInfo && this._config.announcementInfo.activityWindowType);\r\n        var activityWindowIndependent = (this._config.announcementInfo && this._config.announcementInfo.activityWindowIndependent);\r\n        var activityWindowName = (this._config.announcementInfo && this._config.announcementInfo.activityWindowName);\r\n        if (typeof window !== \"undefined\" &&\r\n            typeof window.location !== \"undefined\" &&\r\n            window.location.search &&\r\n            typeof URLSearchParams === \"function\") {\r\n            var searchParams = new URLSearchParams(location.search.slice(1));\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42PeerType\");\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42ActivityWindowType\");\r\n            if (typeof activityWindowIndependent === \"undefined\") {\r\n                activityWindowIndependent = searchParams.get(\"t42ActivityWindowIndependent\");\r\n            }\r\n            activityWindowName = activityWindowName || searchParams.get(\"t42ActivityWindowName\");\r\n            activityId = activityId || searchParams.get(\"t42ActivityId\");\r\n        }\r\n        activityWindowType = activityWindowType || \"unknown\";\r\n        activityWindowIndependent = activityWindowIndependent || false;\r\n        activityWindowName = activityWindowName || this._connection.peerId;\r\n        return {\r\n            activityWindowId: undefined,\r\n            activityId: activityId,\r\n            activityWindowType: activityWindowType,\r\n            activityWindowIndependent: activityWindowIndependent,\r\n            activityWindowName: activityWindowName,\r\n        };\r\n    };\r\n    GW3Bridge.prototype.joinActivity = function (activityId, windowId, name) {\r\n        var _this = this;\r\n        var maybeName = (name && { name: name }) || {};\r\n        return this._gw3Session.send(__assign$1({ type: gwMmessageJoinActivity, target_id: windowId, activity_id: activityId }, maybeName)).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, activityId, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), \"activity joined - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity joined - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMessageLeaveActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, null, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), \"activity left - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity left - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.getActivityTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getWindowTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivities = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivityWindows = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.getWindowBounds = function (id) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowBounds = function (id, bounds) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.activateWindow = function (id, focus) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowVisibility = function (id, visible) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.cloneActivity = function (id, cloneOptions) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.attachActivities = function (from, to, tag) {\r\n        return this._gw3Session.send({\r\n            type: gwNmessageMergeActivities,\r\n            into: to,\r\n            merge: from\r\n        });\r\n    };\r\n    GW3Bridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageSplitActivities,\r\n            from: activityId,\r\n        }).then(function () { return \"\"; });\r\n    };\r\n    GW3Bridge.prototype.onActivitiesAttached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivitiesDetached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.getAttachedDescriptors = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getRandomRequestId = function () {\r\n        return this._connection.peerId + \":\" + Math.floor(Math.random() * 1e9) + \"\";\r\n    };\r\n    GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler = function (addedMessageType, removedMessageType, mapper, handlers) {\r\n        var getGetEntityEvent = function (isAdded) { return function (entity) { return new EntityEvent(entity, new EntityEventContext(isAdded ?\r\n            EntityEventType.Added :\r\n            EntityEventType.Removed)); }; };\r\n        var sub1;\r\n        var sub2;\r\n        sub1 = addedMessageType && this.forwardMessageToEventHandler(addedMessageType, function (msg) { return mapper(msg, true); }, getGetEntityEvent(true), handlers);\r\n        sub2 = removedMessageType && this.forwardMessageToEventHandler(removedMessageType, function (msg) { return mapper(msg, false); }, getGetEntityEvent(false), handlers);\r\n        return [sub1, sub2].filter(function (x) { return x; });\r\n    };\r\n    GW3Bridge.prototype.forwardMessageToEventHandler = function (messageType, mapper, getEntityEvent, handler) {\r\n        return this.subscribe(messageType, function (msg) {\r\n            mapper(msg)\r\n                .forEach(function (ent) {\r\n                return handler.forEach(function (h) { return h(getEntityEvent(ent, msg)); });\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise = function (msg, initiatedMessageType, initiatedMessageFilter, createdMessageType, createdMessageFilter, cancelledMessageType, cancelledMessageFilter, createdMessageToPromiseResolution) {\r\n        var _this = this;\r\n        var reqId = this.getRandomRequestId();\r\n        var resolveCreatedPromise;\r\n        var rejectCreatedPromise;\r\n        var createdPromise = new Promise(function (resolve, reject) {\r\n            resolveCreatedPromise = resolve;\r\n            rejectCreatedPromise = reject;\r\n        });\r\n        var initiatedMessageAck = null;\r\n        var initiatedSubscription;\r\n        var createdSubscription;\r\n        var cancelledSubscription;\r\n        var errorSubscription;\r\n        var dropSubscriptions = function () {\r\n            _this.dropSubscription(initiatedSubscription);\r\n            _this.dropSubscription(createdSubscription);\r\n            _this.dropSubscription(cancelledSubscription);\r\n            _this.dropSubscription(errorSubscription);\r\n        };\r\n        initiatedSubscription = initiatedMessageType &&\r\n            this.subscribe(initiatedMessageType, function (msg4) {\r\n                if (!initiatedMessageFilter(msg4, reqId)) {\r\n                    return;\r\n                }\r\n                initiatedMessageAck = msg4;\r\n                _this.dropSubscription(initiatedSubscription);\r\n            });\r\n        createdSubscription =\r\n            this.subscribe(createdMessageType, function (msg1) {\r\n                if (!createdMessageFilter(msg1, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                resolveCreatedPromise(createdMessageToPromiseResolution(msg1));\r\n            });\r\n        cancelledSubscription = cancelledMessageType &&\r\n            this.subscribe(cancelledMessageType, function (msg2) {\r\n                if (!cancelledMessageFilter(msg2, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg2);\r\n            });\r\n        errorSubscription = cancelledMessageType &&\r\n            this.subscribe(gwMmessageError, function (msg3) {\r\n                if (msg3.request_id !== reqId) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg3);\r\n            });\r\n        msg.request_id = reqId;\r\n        var toReturn = this._gw3Session\r\n            .send(msg)\r\n            .then(function () {\r\n            return createdPromise;\r\n        });\r\n        toReturn.then(dropSubscriptions, dropSubscriptions);\r\n        return toReturn;\r\n    };\r\n    GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType = function (factoryId, ownerId) {\r\n        var peerType = this._peerIdAndFactoryIdToPeerType[ownerId + \":\" + factoryId];\r\n        if (!peerType) {\r\n            return null;\r\n        }\r\n        else {\r\n            return new WindowType(peerType, undefined);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (messageType, handler) {\r\n        var _this = this;\r\n        var sub = this._connection.on(messageType, function (msg) { return handler.bind(_this)(msg); });\r\n        this._gw3Subscriptions.push(sub);\r\n        return sub;\r\n    };\r\n    GW3Bridge.prototype.dropSubscription = function (subscription) {\r\n        if (subscription) {\r\n            this._connection.off(subscription);\r\n            delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(subscription)];\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeCallbacks = function (callbacks, event, description) {\r\n        var _this = this;\r\n        callbacks.forEach(function (cb) {\r\n            try {\r\n                cb(event);\r\n            }\r\n            catch (err) {\r\n                _this._logger.error(\"Error in \" + (description || event.context.type) + \" callback: \" + JSON.stringify(err));\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityCreatedMessage = function (msg) {\r\n        if (!msg.context_id) {\r\n            this._logger.error(\"Activity created with unknown context_id: \" + msg.activity_id);\r\n        }\r\n        else {\r\n            if (!this._contextSubscriptions[msg.activity_id]) {\r\n                this.subscribeToContext(msg);\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContext = function (msg) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var activityId, _a, _b;\r\n            var _this = this;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        activityId = msg.activity_id;\r\n                        _a = this._contextSubscriptions;\r\n                        _b = activityId;\r\n                        return [4, this._contexts.subscribe(activityId, function (data, updated, removed) {\r\n                                var event = new EntityEvent(new Activity(activityId, undefined, undefined, data, undefined), new ActivityContextChangedEventContext(data, updated, removed));\r\n                                _this.invokeCallbacks(_this._activityChangeCallbacks, event, \"context updated\");\r\n                            })];\r\n                    case 1:\r\n                        _a[_b] =\r\n                            _c.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityDestroyedMessage = function (msg) {\r\n        var unsubscribeContext = this._contextSubscriptions[msg.activity_id];\r\n        if (typeof unsubscribeContext === \"function\") {\r\n            unsubscribeContext();\r\n        }\r\n        delete this._contextSubscriptions[msg.activity_id];\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesAdded = function (msg) {\r\n        var _this = this;\r\n        msg.factories.forEach(function (entity) {\r\n            _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + entity.id] = entity.peer_type;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesRemoved = function (msg) {\r\n        var _this = this;\r\n        msg.factory_ids.forEach(function (factoryId) {\r\n            delete _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + factoryId];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers = function () {\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded, gwMessageActivityTypesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.types.map(function (t) { return GW3Bridge.activityTypeGwMessageEntityToActivityType(t, undefined); })\r\n            : msg.types.map(function (t) { return new ActivityType(t.name, undefined, undefined, undefined); }); }, this._activityTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers = function () {\r\n        var _this = this;\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity, gwMessageOwnerChanged]; _i < _a.length; _i++) {\r\n            var activityCreatedMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(activityCreatedMessage, function (msg) {\r\n                return ([msg.owner || __assign$1(__assign$1({}, msg), { type: msg.peer_type, name: msg.peer_name, peer_id: msg.owner_id })])\r\n                    .concat(msg.participants || [])\r\n                    .map(function (info) { return new ActivityWindow(info.peer_id, info.name, info.type, msg.activity_id, _this.getAgmInstance(info.peer_id), undefined, _this.generateWindowGetter(info.peer_id), undefined); });\r\n            }, function (ent, msg) { return new EntityEvent(ent, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)); }, this._activityWindowChangeCallbacks);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers = function () {\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var createdMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(createdMessage, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"started\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        }\r\n        this.forwardMessageToEventHandler(gwMessageActivityDestroyed, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"destroyed\", msg.reason, new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageActivityInitiated, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageOwnerChanged, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers = function () {\r\n        var _this = this;\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded, gwMessagePeerFactoriesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType)\r\n            : msg.factory_ids.map(function (id) { return _this.peerFactoryIdAndOwnerIdToWindowType(id, msg.owner_id); }).filter(function (x) { return x != null; }); }, this._windowTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests = function () {\r\n        var _this = this;\r\n        this.subscribe(gwMessagePeerRequested, function (msg) {\r\n            var factory = _this._peerFactoriesRegisteredByUs[msg.peer_factory];\r\n            if (!factory) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: \"Unknown peer factory \" + msg.peer_factory\r\n                });\r\n                return;\r\n            }\r\n            try {\r\n                var configuration = msg.configuration || {};\r\n                configuration.gateway_token = configuration.gateway_token || msg.gateway_token;\r\n                configuration.peer_factory = configuration.peer_factory || msg.peer_factory;\r\n                var promise = factory({\r\n                    activityId: msg.activity && msg.activity.id,\r\n                    activityType: msg.activity && msg.activity.type,\r\n                    type: msg.configuration && msg.configuration.type,\r\n                    gwToken: configuration.gateway_token,\r\n                    configuration: configuration\r\n                });\r\n                if (promise && promise.then && promise.catch) {\r\n                    promise.catch(function (err) { return _this._gw3Session.send({\r\n                        type: gwMmessageError,\r\n                        request_id: msg.request_id,\r\n                        reason: err && (err.message || JSON.stringify(err))\r\n                    }); });\r\n                }\r\n            }\r\n            catch (err) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: err && (err.message || JSON.stringify(err))\r\n                });\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers = function () {\r\n        var _this = this;\r\n        var _loop_1 = function (joinedMessage) {\r\n            this_1.subscribe(joinedMessage, function (msg) {\r\n                var joinedId = (joinedMessage === gwMessageActivityJoined) ? msg.joined_id : msg.peer_id;\r\n                var joinedType = (joinedMessage === gwMessageActivityJoined) ? msg.joined_type : msg.peer_type;\r\n                var joinedName = (joinedMessage === gwMessageActivityJoined) ? msg.joined_name : msg.peer_name;\r\n                var entity = new ActivityWindow(joinedId, joinedName, joinedType, msg.activity_id, _this.getAgmInstance(joinedId), undefined, _this.generateWindowGetter(joinedId), undefined);\r\n                if (!_this._contextSubscriptions[msg.activity_id]) {\r\n                    _this.subscribeToContext(msg).then(function () {\r\n                        if (joinedMessage === gwMessageJoinedActivity) {\r\n                            _this._activityJoinedPromiseResolve({});\r\n                        }\r\n                    });\r\n                }\r\n                else if (joinedMessage === gwMessageJoinedActivity) {\r\n                    _this._activityJoinedPromiseResolve({});\r\n                }\r\n                _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), joinedMessage);\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = [gwMessageActivityJoined, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var joinedMessage = _a[_i];\r\n            _loop_1(joinedMessage);\r\n        }\r\n        this.subscribe(gwMessageActivityLeft, function (msg) {\r\n            var entity = new ActivityWindow(msg.left_id, undefined, undefined, null, _this.getAgmInstance(msg.left_id), undefined, _this.generateWindowGetter(msg.left_id), undefined);\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), gwMessageActivityLeft);\r\n        });\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated, undefined, function (msg) { return [\r\n            new ActivityWindow(msg.created_id, undefined, undefined, undefined, undefined, undefined, _this.generateWindowGetter(msg.created_id), undefined)\r\n        ]; }, this._activityWindowChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.getAgmInstance = function (id) {\r\n        return this._config.agm.servers().find(function (s) { return s.peerId === id || s.windowId === id; });\r\n    };\r\n    GW3Bridge.prototype.generateWindowGetter = function (peerId) {\r\n        var _this = this;\r\n        return function () {\r\n            var server = _this.getAgmInstance(peerId);\r\n            if (!server) {\r\n                return;\r\n            }\r\n            var windowId = server.windowId;\r\n            return _this._config.windows.list().filter(function (w) { return w.id === windowId; })[0];\r\n        };\r\n    };\r\n    GW3Bridge.prototype.isOverrideTypeDefinition = function (value) {\r\n        if (typeof value === \"undefined\") {\r\n            return false;\r\n        }\r\n        if (value.owner) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ActivityMy = (function () {\r\n    function ActivityMy(manager, windows) {\r\n        var _this = this;\r\n        this._myAttached = [];\r\n        this._myDetached = [];\r\n        this._myAttachedTo = [];\r\n        this._myDetachedFrom = [];\r\n        this._myActivityFrameColorChanged = [];\r\n        this._myActivityJoinedCallbacks = [];\r\n        this._myActivityRemovedCallbacks = [];\r\n        this._myContextUpdateCallbacks = [];\r\n        this._logger = Logger$1.Get(this);\r\n        this._m = manager;\r\n        manager.ready()\r\n            .then(function (am) {\r\n            am.subscribeActivityContextChanged(_this._subscribeMyContextChanged.bind(_this));\r\n            am.subscribeWindowEvents(_this._subscribeMyWindowEvent.bind(_this));\r\n            am.subscribeActivitiesAttached(_this._subscribeActivitiesAttached.bind(_this));\r\n            am.subscribeActivitiesDetached(_this._subscribeActivitiesDetached.bind(_this));\r\n            if (windows) {\r\n                windows.onWindowFrameColorChanged(_this._subscribeWindowFrameColorChanged.bind(_this));\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityMy.prototype, \"window\", {\r\n        get: function () {\r\n            if (isUndefinedOrNull(this._w)) {\r\n                var announcedWindows = this._m.announcedWindows;\r\n                if (announcedWindows.length > 0) {\r\n                    this._w = announcedWindows[0];\r\n                }\r\n            }\r\n            return this._w;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityMy.prototype, \"activity\", {\r\n        get: function () {\r\n            var myWin = this.window;\r\n            if (isUndefinedOrNull(myWin)) {\r\n                return undefined;\r\n            }\r\n            return myWin.activity;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.createWindow = function (windowType) {\r\n        return this._m.createWindow(this.activity, windowType);\r\n    };\r\n    ActivityMy.prototype.createStackedWindows = function (windowTypes, timeout) {\r\n        return this._m.createStackedWindows(this.activity, windowTypes, timeout);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"context\", {\r\n        get: function () {\r\n            var activity = this.activity;\r\n            if (isUndefined(activity)) {\r\n                return {};\r\n            }\r\n            return activity.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.updateContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.updateContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.setContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.setContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.onActivityJoined = function (callback) {\r\n        this._myActivityJoinedCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (!isUndefinedOrNull(myWin) && !isUndefinedOrNull(myWin.activity)) {\r\n            callback(myWin.activity);\r\n        }\r\n    };\r\n    ActivityMy.prototype.onActivityLeft = function (callback) {\r\n        this._myActivityRemovedCallbacks.push(callback);\r\n    };\r\n    ActivityMy.prototype.onContextChanged = function (callback) {\r\n        this._myContextUpdateCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var activity = myWin.activity;\r\n        if (isUndefinedOrNull(activity)) {\r\n            return;\r\n        }\r\n        callback(activity.context, activity.context, [], activity);\r\n    };\r\n    ActivityMy.prototype.clone = function (options, callback) {\r\n        var act = this.activity;\r\n        return this._m.clone(act, options, callback);\r\n    };\r\n    ActivityMy.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._m.attachActivities(activityId, this.activity.id, tag);\r\n    };\r\n    ActivityMy.prototype.onActivityAttached = function (callback) {\r\n        this._myAttached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onActivityDetached = function (callback) {\r\n        this._myDetached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onAttachedToActivity = function (callback) {\r\n        this._myAttachedTo.push(callback);\r\n    };\r\n    ActivityMy.prototype.onDetachedFromActivity = function (callback) {\r\n        this._myDetachedFrom.push(callback);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"attached\", {\r\n        get: function () {\r\n            if (!this.activity) {\r\n                return [];\r\n            }\r\n            return this.activity.attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.setFrameColor = function (color, callback) {\r\n        if (this.activity) {\r\n            return this.activity.setFrameColor(color, callback);\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    ActivityMy.prototype.getFrameColor = function () {\r\n        if (this.activity) {\r\n            return this.activity.getFrameColor();\r\n        }\r\n        return \"\";\r\n    };\r\n    ActivityMy.prototype.onFrameColorChanged = function (callback) {\r\n        this._myActivityFrameColorChanged.push(callback);\r\n    };\r\n    ActivityMy.prototype._subscribeMyContextChanged = function (activity, context, delta, removed) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (activity.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        this._notifyMyContextChanged(activity, context, delta, removed);\r\n    };\r\n    ActivityMy.prototype._subscribeMyWindowEvent = function (activity, window, event) {\r\n        if (isUndefinedOrNull(this.window)) {\r\n            return;\r\n        }\r\n        if (this.window.id !== window.id) {\r\n            return;\r\n        }\r\n        if (event === EntityEventType.ActivityWindowJoinedActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityJoinedCallbacks);\r\n            this._notifyMyContextChanged(activity, activity.context, null, null);\r\n        }\r\n        else if (event === EntityEventType.ActivityWindowLeftActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityRemovedCallbacks);\r\n        }\r\n    };\r\n    ActivityMy.prototype._notifyMyWindowEvent = function (activity, callbackStore) {\r\n        var _this = this;\r\n        callbackStore.forEach(function (element) {\r\n            try {\r\n                element(activity, event);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyMyContextChanged = function (activity, context, delta, removed) {\r\n        var _this = this;\r\n        delta = delta || {};\r\n        removed = removed || [];\r\n        this._myContextUpdateCallbacks.forEach(function (element) {\r\n            try {\r\n                element(context, delta, removed, activity);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttached = function (state) {\r\n        var _this = this;\r\n        this._myAttached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetached = function (state) {\r\n        var _this = this;\r\n        this._myDetached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttachedTo = function (state) {\r\n        var _this = this;\r\n        this._myAttachedTo.forEach(function (cb) {\r\n            try {\r\n                cb(_this.activity, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetachedFrom = function (detached, existing, state) {\r\n        var _this = this;\r\n        this._myDetachedFrom.forEach(function (cb) {\r\n            try {\r\n                cb(detached, existing, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesAttached = function (newAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (newAct.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        if (state.windowIds.indexOf(myWin.id) >= 0) {\r\n            this._notifyAttachedTo(state);\r\n            return;\r\n        }\r\n        this._notifyAttached(state);\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesDetached = function (newAct, oldAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (oldAct.id === myActivity.id) {\r\n            this._notifyDetached(state);\r\n        }\r\n        if (newAct.id === myActivity.id) {\r\n            this._notifyDetachedFrom(newAct, oldAct, state);\r\n        }\r\n    };\r\n    ActivityMy.prototype._subscribeWindowFrameColorChanged = function (window) {\r\n        var act = this.activity;\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id === window.id) {\r\n            this._myActivityFrameColorChanged.forEach(function (callback) {\r\n                callback(window.frameColor);\r\n            });\r\n        }\r\n    };\r\n    return ActivityMy;\r\n}());\n\nvar ReadyMarker = (function () {\r\n    function ReadyMarker(name, signalsToWait) {\r\n        this._logger = Logger$1.Get(\"ReadyMarker [\" + name + \"]\");\r\n        this._logger.debug(\"Initializing ready marker for '\" + name + \"' with \" + signalsToWait + \" signals to wait\");\r\n        if (signalsToWait <= 0) {\r\n            throw new Error(\"Invalid signal number. Should be > 0\");\r\n        }\r\n        this._signals = signalsToWait;\r\n        this._callbacks = [];\r\n        this._name = name;\r\n    }\r\n    ReadyMarker.prototype.setCallback = function (callback) {\r\n        if (this.isSet()) {\r\n            callback(undefined);\r\n            return;\r\n        }\r\n        else if (this.isError()) {\r\n            callback(this._error);\r\n            return;\r\n        }\r\n        this._callbacks.push(callback);\r\n    };\r\n    ReadyMarker.prototype.signal = function (message) {\r\n        this._logger.debug(\"Signaled - \" + message + \" - signals left \" + (this._signals - 1));\r\n        this._signals--;\r\n        if (this._signals < 0) {\r\n            throw new Error(\"Error in ready marker '\" + this._name + \" - signals are \" + this._signals);\r\n        }\r\n        if (this.isSet()) {\r\n            this._callbacks.forEach(function (callback) {\r\n                callback(undefined);\r\n            });\r\n        }\r\n    };\r\n    ReadyMarker.prototype.error = function (error) {\r\n        this._error = error;\r\n        this._callbacks.forEach(function (errorCallback) {\r\n            errorCallback(error);\r\n        });\r\n    };\r\n    ReadyMarker.prototype.isSet = function () {\r\n        if (this.isError()) {\r\n            return false;\r\n        }\r\n        return this._signals === 0;\r\n    };\r\n    ReadyMarker.prototype.isError = function () {\r\n        return !isUndefined(this._error);\r\n    };\r\n    ReadyMarker.prototype.getError = function () {\r\n        return this._error;\r\n    };\r\n    return ReadyMarker;\r\n}());\n\nvar EntityObservableCollection = (function () {\r\n    function EntityObservableCollection(processNew) {\r\n        this._items = {};\r\n        this._listeners = [];\r\n        this._processNew = processNew;\r\n    }\r\n    EntityObservableCollection.prototype.addOne = function (item) {\r\n        this.add([item]);\r\n    };\r\n    EntityObservableCollection.prototype.add = function (items) {\r\n        var _this = this;\r\n        items.forEach(function (element) {\r\n            _this.process(new EntityEvent(element, new EntityEventContext(EntityEventType.Added)));\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.process = function (event) {\r\n        var context = event.context;\r\n        var type = context.type;\r\n        var entity = event.entity;\r\n        if (type === EntityEventType.StatusChange &&\r\n            !context.oldStatus) {\r\n            var act = this._items[entity.id];\r\n            if (act) {\r\n                context.oldStatus = act.status;\r\n            }\r\n        }\r\n        if (type === EntityEventType.StatusChange &&\r\n            context.oldStatus &&\r\n            context.newStatus &&\r\n            context.oldStatus.state ===\r\n                context.newStatus.state) {\r\n            context.type = EntityEventType.Updated;\r\n        }\r\n        if (typeof htmlContainer === \"undefined\") {\r\n            if (type === EntityEventType.ActivityWindowJoinedActivity &&\r\n                this._items[entity.id] &&\r\n                this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n            if (type === EntityEventType.ActivityWindowLeftActivity &&\r\n                this._items[entity.id] &&\r\n                !this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n        }\r\n        var internalEntity = this._updateInternalCollections(entity, type, context);\r\n        this._notifyListeners(internalEntity, context);\r\n        return internalEntity;\r\n    };\r\n    EntityObservableCollection.prototype.get = function () {\r\n        var result = [];\r\n        for (var key in this._items) {\r\n            if (this._items.hasOwnProperty(key)) {\r\n                var element = this._items[key];\r\n                result.push(element);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    EntityObservableCollection.prototype.getByName = function (name) {\r\n        for (var key in this._items) {\r\n            if (key === name) {\r\n                return this._items[key];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    EntityObservableCollection.prototype.getOrWait = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var entityAddedHandler = function (entity) {\r\n                if (entity.id !== name) {\r\n                    return;\r\n                }\r\n                resolve(entity);\r\n                _this.unsubscribe(entityAddedHandler);\r\n            };\r\n            _this.subscribe(entityAddedHandler);\r\n            var window = _this.getByName(name);\r\n            if (window) {\r\n                _this.unsubscribe(entityAddedHandler);\r\n                resolve(window);\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.subscribe = function (handler) {\r\n        var _this = this;\r\n        this._listeners.push(handler);\r\n        Object.keys(this._items).forEach(function (key) {\r\n            var element = _this._items[key];\r\n            handler(element, new EntityEventContext(EntityEventType.Added.toString()));\r\n        });\r\n        return function () {\r\n            _this.unsubscribe(handler);\r\n        };\r\n    };\r\n    EntityObservableCollection.prototype.unsubscribe = function (handler) {\r\n        var index = this._listeners.indexOf(handler);\r\n        if (index !== -1) {\r\n            this._listeners.splice(index, 1);\r\n        }\r\n    };\r\n    EntityObservableCollection.prototype._notifyListeners = function (entity, context) {\r\n        this._listeners.forEach(function (listener) {\r\n            try {\r\n                listener(entity, context);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype._updateInternalCollections = function (entity, type, context) {\r\n        var entityAsAny = entity;\r\n        var isActivityDestroy = (type === EntityEventType.StatusChange &&\r\n            entityAsAny.status &&\r\n            entityAsAny.status.state === ActivityState.Destroyed) ||\r\n            (type === EntityEventType.StatusChange &&\r\n                context &&\r\n                context.newStatus &&\r\n                context.newStatus.state === ActivityState.Destroyed);\r\n        var isWindowClose = type === EntityEventType.Closed;\r\n        var isTypeRemove = type === EntityEventType.Removed && typeof entityAsAny.isIndependent === \"undefined\";\r\n        if (isTypeRemove || isWindowClose || isActivityDestroy) {\r\n            var oldEntity = this._items[entity.id];\r\n            delete this._items[entity.id];\r\n            this._processNew(entity);\r\n            if (oldEntity) {\r\n                entity._beforeDelete(oldEntity);\r\n            }\r\n            return entity;\r\n        }\r\n        else {\r\n            var key = entity.id;\r\n            if (!this._items.hasOwnProperty(key)) {\r\n                this._processNew(entity);\r\n                this._items[entity.id] = entity;\r\n            }\r\n            else {\r\n                this._items[entity.id]._update(entity);\r\n            }\r\n        }\r\n        return this._items[entity.id];\r\n    };\r\n    return EntityObservableCollection;\r\n}());\n\nvar ActivityManager = (function () {\r\n    function ActivityManager(bridge, autoAnnounce, windows) {\r\n        var _this = this;\r\n        this._logger = Logger$1.Get(\"activityManager\");\r\n        this._announcedWindows = [];\r\n        this._attachedCallbacks = [];\r\n        this._detachedCallbacks = [];\r\n        this._frameColorChangesCallbacks = [];\r\n        this._windowHandlers = [];\r\n        this._bridge = bridge;\r\n        this._activityTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windowTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._activities = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windows = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._dataReadyMarker = new ReadyMarker(\"Activity Manager Data\", [\"GetActivityTypes\", \"GetWindowTypes\", \"GetActivities\", \"GetWindows\"].length);\r\n        this._descriptorsMarker = new ReadyMarker(\"Attached Activities Descriptors\", [\"GetDescriptors\"].length);\r\n        if (autoAnnounce) {\r\n            this._readyMarker = new ReadyMarker(\"Activity Manager Announce\", [\"Announcement\"].length);\r\n            this._dataReadyMarker.setCallback(function (dataErr) {\r\n                if (dataErr) {\r\n                    _this._readyMarker.error(dataErr);\r\n                }\r\n                _this._descriptorsMarker.setCallback(function (err) {\r\n                    if (err) {\r\n                        _this._readyMarker.error(err);\r\n                    }\r\n                    _this._logger.debug(\"Auto announcing window\");\r\n                    _this.announceWindow()\r\n                        .then(function (w) {\r\n                        _this._announcedWindows.push(w);\r\n                        _this._readyMarker.signal(\"Successfully announced window with id '\" + w.id + \"'\");\r\n                    })\r\n                        .catch(function (errCatch) {\r\n                        _this._logger.debug(\"Will not announce window - \" + errCatch);\r\n                        _this._readyMarker.signal();\r\n                    });\r\n                });\r\n                _this.refreshDescriptors();\r\n            });\r\n        }\r\n        else {\r\n            this._readyMarker = this._dataReadyMarker;\r\n        }\r\n        this._bridge.onActivitiesAttached(function (e) {\r\n            _this._handleActivitiesAttached(e);\r\n        });\r\n        this._bridge.onActivitiesDetached(function (e) {\r\n            _this._handleActivitiesDetached(e);\r\n        });\r\n        this._bridge.onActivityAttachedDescriptorsRefreshed(function (e) {\r\n            _this._handleActivityDescriptorsRefreshed(e);\r\n        });\r\n        if (windows) {\r\n            windows.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this));\r\n        }\r\n        this._bridge.init();\r\n        this._subscribeForData();\r\n        this._bridge\r\n            .initReady()\r\n            .then(function (aw) {\r\n            _this._getInitialData();\r\n        })\r\n            .catch(function (error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityManager.prototype, \"usingHc\", {\r\n        get: function () {\r\n            return this._bridge.bridgeType === \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityManager.prototype, \"announcedWindows\", {\r\n        get: function () {\r\n            return this._announcedWindows;\r\n        },\r\n        set: function (v) {\r\n            throw new Error(\"not allowed\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityManager.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n        return nodeify(Promise.all([this._bridge.ready(), promise]).then(function () { return _this; }), callback);\r\n    };\r\n    ActivityManager.prototype.getActivityTypes = function () {\r\n        return this._activityTypes.get();\r\n    };\r\n    ActivityManager.prototype.getActivityType = function (name) {\r\n        return this._activityTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerActivityType = function (activityTypeName, ownerWindowType, helperWindowTypes, config, description, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activityTypeName)) {\r\n                reject(\"activityTypeName argument can not be undefined\");\r\n                return;\r\n            }\r\n            if (!isString(activityTypeName)) {\r\n                reject(\"activityTypeName should be string\");\r\n                return;\r\n            }\r\n            var actType = _this.getActivityType(activityTypeName);\r\n            if (!isUndefinedOrNull(actType)) {\r\n                reject(\"Activity type '\" + activityTypeName + \"' already exists\");\r\n                return;\r\n            }\r\n            var ownerDefinition;\r\n            if (isUndefined(ownerWindowType)) {\r\n                reject(\"Owner window type can not be undefined\");\r\n                return;\r\n            }\r\n            if (isString(ownerWindowType)) {\r\n                ownerDefinition = { type: ownerWindowType, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                ownerDefinition = ownerWindowType;\r\n            }\r\n            var helperDefinitions = [];\r\n            if (!isUndefined(helperWindowTypes) && isArray(helperWindowTypes)) {\r\n                for (var index in helperWindowTypes) {\r\n                    var item = helperWindowTypes[index];\r\n                    if (isString(item)) {\r\n                        var definition = {\r\n                            type: item,\r\n                            name: \"\",\r\n                            isIndependent: false,\r\n                            arguments: {},\r\n                            relativeTo: \"\",\r\n                            relativeDirection: \"\",\r\n                            windowStyleAttributes: {}\r\n                        };\r\n                        helperDefinitions.push(definition);\r\n                    }\r\n                    else {\r\n                        helperDefinitions.push(item);\r\n                    }\r\n                }\r\n            }\r\n            _this._bridge\r\n                .registerActivityType(activityTypeName, ownerDefinition, helperDefinitions, config, description)\r\n                .then(function (activityType) {\r\n                _this._grabEntity(activityType);\r\n                resolve(activityType);\r\n            })\r\n                .catch(function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterActivityType = function (type, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(type);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + type + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge.unregisterActivityType(type).then(function () { return resolve(actType); }, reject);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.initiate = function (activityType, context, callback, configuration) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(activityType);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + activityType + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .initiateActivity(activityType, context, configuration)\r\n                .then(function (actId) {\r\n                _this._activities\r\n                    .getOrWait(actId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityTypeEvents = function (handler) {\r\n        this._activityTypes.subscribe(function (at, context) {\r\n            handler(at, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowTypes = function () {\r\n        return this._windowTypes.get();\r\n    };\r\n    ActivityManager.prototype.getWindowType = function (name) {\r\n        return this._windowTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerWindowFactory = function (windowType, factoryMethod, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (isObject(windowType)) {\r\n                windowType = windowType.getName();\r\n            }\r\n            else if (!isString(windowType)) {\r\n                reject(\"windowType should be string or object that has getName method\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .registerWindowFactory(windowType, factoryMethod)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterWindowFactory = function (windowType, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (!isString(windowType)) {\r\n                reject(\"windowType should be a string\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .unregisterWindowFactory(windowType)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getActivities = function (activityType) {\r\n        var act = this._activities.get();\r\n        act = act.filter(function (a) { return a._ownerId; });\r\n        if (!activityType) {\r\n            return act;\r\n        }\r\n        var types = activityType;\r\n        if (isString(activityType)) {\r\n            types = [activityType];\r\n        }\r\n        else if (activityType instanceof ActivityType) {\r\n            types = [activityType.name];\r\n        }\r\n        else if (activityType instanceof Array) ;\r\n        else {\r\n            throw new Error(\"Invalid input argument 'activityType' = \" + activityType);\r\n        }\r\n        return act.filter(function (at) {\r\n            var type = at.type;\r\n            return some(types, function (t) {\r\n                return type.id === t.id;\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype.getActivityById = function (id) {\r\n        return this._activities.getByName(id);\r\n    };\r\n    ActivityManager.prototype.announceWindow = function (activityWindowId, windowType) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var announcementInfo = _this._bridge.getAnnouncementInfo();\r\n            if (isUndefined(activityWindowId)) {\r\n                activityWindowId = announcementInfo.activityWindowId;\r\n            }\r\n            if (isUndefined(windowType)) {\r\n                windowType = announcementInfo.activityWindowType;\r\n            }\r\n            if (isUndefinedOrNull(windowType)) {\r\n                throw new Error(\"Can not announce - unknown windowType\");\r\n            }\r\n            var activityId = announcementInfo && announcementInfo.activityId;\r\n            if (isUndefinedOrNull(activityWindowId)) {\r\n                _this._logger.debug(\"Registering window with type:'\" + windowType + \"', name:'\" + announcementInfo.activityWindowName + \"', ind.:'\" + announcementInfo.activityWindowIndependent + \"'\");\r\n                _this._bridge.registerWindow(windowType, announcementInfo.activityWindowName, announcementInfo.activityWindowIndependent)\r\n                    .then(_this._windows.getOrWait.bind(_this._windows))\r\n                    .then(function (w) {\r\n                    if (activityId) {\r\n                        return _this._activities.getOrWait(activityId).then(function (_) { return w; });\r\n                    }\r\n                    else {\r\n                        return w;\r\n                    }\r\n                })\r\n                    .then(function (w) {\r\n                    resolve(w);\r\n                })\r\n                    .catch(function (err) {\r\n                    _this._logger.error(err);\r\n                });\r\n            }\r\n            else {\r\n                _this._logger.debug(\"Announcing window with id '\" + activityWindowId + \"' and type '\" + windowType + \"'\");\r\n                var currentWindow = _this._windows.getByName(activityWindowId);\r\n                if (!isUndefinedOrNull(currentWindow)) {\r\n                    _this._logger.debug(\"Window with id '\" + activityWindowId + \"' already announced - reusing the window\");\r\n                    resolve(currentWindow);\r\n                    return;\r\n                }\r\n                var windowEventHandler_1 = function (a, w, e) {\r\n                    if (activityWindowId === w.id) {\r\n                        if (e === EntityEventType.ActivityWindowJoinedActivity) {\r\n                            var activity = w.activity;\r\n                            if (isUndefined(activity)) {\r\n                                reject(\"UNDEFINED ACTIVITY\");\r\n                            }\r\n                            _this._logger.trace(\"Got joined event for id '\" + activityWindowId + \"'\");\r\n                            resolve(w);\r\n                            _this.unsubscribeWindowEvents(windowEventHandler_1);\r\n                        }\r\n                    }\r\n                };\r\n                _this.subscribeWindowEvents(windowEventHandler_1);\r\n                _this._logger.trace(\"Waiting for joined event for id '\" + activityWindowId + \"'\");\r\n                _this._bridge.announceWindow(windowType, activityWindowId);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    ActivityManager.prototype.subscribeWindowTypeEvents = function (handler) {\r\n        this._windowTypes.subscribe(function (wt, context) {\r\n            handler(wt, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeActivityEvents = function (handler) {\r\n        var _this = this;\r\n        return this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.StatusChange) {\r\n                var p = context;\r\n                handler(act, p.newStatus, p.oldStatus);\r\n            }\r\n            if (context.type === EntityEventType.Removed ||\r\n                (context.type === EntityEventType.StatusChange &&\r\n                    context.newStatus.getState() === ActivityState.Destroyed)) {\r\n                for (var _i = 0, _a = _this._windows.get(); _i < _a.length; _i++) {\r\n                    var window_1 = _a[_i];\r\n                    if (window_1.activity && window_1.activity.id === act.id) {\r\n                        _this._windows.process(new EntityEvent(window_1, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)));\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeWindowEvents = function (handler) {\r\n        var wrappingHandler = function (window, context) {\r\n            var eventType = context.type;\r\n            if (eventType === EntityEventType.Added) {\r\n                eventType = \"opened\";\r\n            }\r\n            handler(window.activity, window, eventType);\r\n        };\r\n        this._windowHandlers.push([handler, wrappingHandler]);\r\n        return this._windows.subscribe(wrappingHandler);\r\n    };\r\n    ActivityManager.prototype.unsubscribeWindowEvents = function (handler) {\r\n        var found = this._windowHandlers.find(function (pair) { return pair[0] === handler; });\r\n        if (found) {\r\n            this._windowHandlers.splice(this._windowHandlers.indexOf(found), 1);\r\n            this._windows.unsubscribe(found[1]);\r\n        }\r\n    };\r\n    ActivityManager.prototype.createWindow = function (activity, windowTypeOrConfiguration, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowTypeOrConfiguration)) {\r\n                reject(\"windowType is undefined\");\r\n            }\r\n            var windowDefinition;\r\n            if (isString(windowTypeOrConfiguration)) {\r\n                windowDefinition = { type: windowTypeOrConfiguration, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else if (windowTypeOrConfiguration instanceof WindowType) {\r\n                windowDefinition = {\r\n                    type: windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    name: windowTypeOrConfiguration.name || windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    isIndependent: false\r\n                };\r\n            }\r\n            else {\r\n                windowDefinition = windowTypeOrConfiguration;\r\n            }\r\n            var relativeToWindow;\r\n            if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                relativeToWindow = windowDefinition.relativeTo;\r\n                if (typeof relativeToWindow === \"string\") {\r\n                    var windows = _this.getWindows({ type: relativeToWindow });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                    var windows = _this.getWindows({ type: relativeToWindow.type });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                    windowDefinition.relativeTo = relativeToWindow.windowId;\r\n                }\r\n            }\r\n            _this._bridge.createWindow(activity && activity.id, windowDefinition)\r\n                .then(function (wid) {\r\n                _this._logger.debug(\"Window created, waiting for window entity with id \" + wid);\r\n                var handler = function (window, context) {\r\n                    if (window.id === wid && (!activity || window.activity)) {\r\n                        _this._logger.debug(\"Got entity window with id \" + wid);\r\n                        resolve(window);\r\n                        _this._windows.unsubscribe(handler);\r\n                    }\r\n                };\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.createStackedWindows = function (activity, relativeWindowTypes, timeout, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity is undefined\");\r\n            }\r\n            if (isUndefinedOrNull(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes is undefined\");\r\n            }\r\n            if (!Array.isArray(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes has to be array\");\r\n            }\r\n            if (isUndefinedOrNull(timeout)) {\r\n                timeout = 20000;\r\n            }\r\n            var relativeWindows = [];\r\n            relativeWindowTypes.forEach(function (element) {\r\n                var windowDefinition;\r\n                if (isString(element)) {\r\n                    windowDefinition = { type: element, name: \"\", isIndependent: false, arguments: {} };\r\n                }\r\n                else {\r\n                    windowDefinition = element;\r\n                }\r\n                var relativeToWindow;\r\n                if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                    relativeToWindow = windowDefinition.relativeTo;\r\n                    if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                        windowDefinition.relativeTo = relativeToWindow.type;\r\n                    }\r\n                    else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                        var windows = _this.getWindows({ id: relativeToWindow.windowId });\r\n                        if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                            windowDefinition.relativeTo = windows[0].type.name;\r\n                            windowDefinition.useExisting = true;\r\n                        }\r\n                    }\r\n                }\r\n                relativeWindows.push(windowDefinition);\r\n            });\r\n            _this._bridge.createStackedWindows(activity.id, relativeWindows, timeout)\r\n                .then(function (wid) {\r\n                var activityWindows = [];\r\n                var alreadyCreated = [];\r\n                var handler = function (window, context) {\r\n                    if (wid.indexOf(window.id) >= 0 && alreadyCreated.indexOf(window.id) < 0 && window.activity) {\r\n                        this._logger.debug(\"Got entity window with id \" + wid);\r\n                        activityWindows.push(window);\r\n                        alreadyCreated.push(window.id);\r\n                        if (activityWindows.length === wid.length) {\r\n                            resolve(activityWindows);\r\n                            this._windows.unsubscribe(handler);\r\n                        }\r\n                    }\r\n                }.bind(_this);\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.addWindowToActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.joinActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.leaveWindowFromActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.leaveActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.setActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, true)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.updateActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            var removedKeys = [];\r\n            for (var key in context) {\r\n                if (context.hasOwnProperty(key) && context[key] === null) {\r\n                    removedKeys.push(key);\r\n                }\r\n            }\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var removedKey = removedKeys_1[_i];\r\n                delete context[removedKey];\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, false, removedKeys)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityContextChanged = function (handler) {\r\n        this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.ActivityContextChange) {\r\n                var updateContext = context;\r\n                handler(act, updateContext.context, updateContext.updated, updateContext.removed);\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.stopActivity = function (activity, callback) {\r\n        var promise = this._bridge.stopActivity(activity);\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getWindows = function (filter) {\r\n        if (isUndefined(filter)) {\r\n            return this._windows.get();\r\n        }\r\n        if (!isUndefined(filter.id)) {\r\n            return [this._windows.getByName(filter.id)];\r\n        }\r\n        var allWindows = this._windows.get();\r\n        return allWindows.filter(function (w) {\r\n            if (!isUndefined(filter.type) && w.type.id !== filter.type) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.name) && w.name !== filter.name) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.activityId)) {\r\n                if (isUndefinedOrNull(w.activity)) {\r\n                    return false;\r\n                }\r\n                if (w.activity.id !== filter.activityId) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowBounds = function (id) {\r\n        return this._bridge.getWindowBounds(id);\r\n    };\r\n    ActivityManager.prototype.setWindowBounds = function (id, bounds, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._bridge.setWindowBounds(id, bounds)\r\n                .then(function () { return resolve(); })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.closeWindow = function (id) {\r\n        return this._bridge.closeWindow(id);\r\n    };\r\n    ActivityManager.prototype.activateWindow = function (id, focus) {\r\n        return this._bridge.activateWindow(id, focus);\r\n    };\r\n    ActivityManager.prototype.setWindowVisibility = function (id, visible) {\r\n        return this._bridge.setWindowVisibility(id, visible);\r\n    };\r\n    ActivityManager.prototype.clone = function (activity, cloneOptions, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!activity) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge.cloneActivity(activity.id, cloneOptions)\r\n                .then(function (activityId) {\r\n                _this._activities\r\n                    .getOrWait(activityId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.attachActivities = function (from, to, tag, callback) {\r\n        var _this = this;\r\n        tag = tag || {};\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var fromActivity = _this._activities.getByName(from);\r\n            if (!fromActivity) {\r\n                reject(\"can not find activity with id \" + from);\r\n                return;\r\n            }\r\n            var toActivity = _this._activities.getByName(to);\r\n            if (!toActivity) {\r\n                reject(\"can not find activity with id \" + to);\r\n                return;\r\n            }\r\n            return _this._bridge.attachActivities(from, to, tag)\r\n                .then(function (data) {\r\n                var newActId = data.to;\r\n                var state = data.descriptor;\r\n                var allStates = data.descriptors;\r\n                _this._activities.getOrWait(newActId).then(function (act) {\r\n                    act._updateDescriptors(allStates);\r\n                    var stateWrapped = act.attached.filter(function (u) { return u.ownerId === state.ownerId; })[0];\r\n                    resolve(stateWrapped);\r\n                });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.detachActivities = function (activityId, descriptor, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            return _this._bridge.detachActivities(activityId, descriptor)\r\n                .then(function () {\r\n                var oldActId = undefined;\r\n                var newActId = undefined;\r\n                var descriptors = undefined;\r\n                _this._activities\r\n                    .getOrWait(oldActId)\r\n                    .then(function (oldAct) {\r\n                    oldAct._updateDescriptors(descriptors);\r\n                    _this._activities\r\n                        .getOrWait(newActId)\r\n                        .then(function (newAct) {\r\n                        resolve(newAct);\r\n                    });\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesAttached = function (callback) {\r\n        this._attachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesDetached = function (callback) {\r\n        this._detachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityFrameColorChanged = function (callback) {\r\n        this._frameColorChangesCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype._grabEntity = function (entity) {\r\n        entity._manager = this;\r\n    };\r\n    ActivityManager.prototype._getInitialData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Request initial data...\");\r\n        this._bridge.getActivityTypes()\r\n            .then(function (at) {\r\n            _this._activityTypes.add(at);\r\n            _this._dataReadyMarker.signal(\"Got act types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity types -\" + error);\r\n        });\r\n        this._bridge.getWindowTypes()\r\n            .then(function (wt) {\r\n            _this._windowTypes.add(wt);\r\n            _this._dataReadyMarker.signal(\"Got window types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting window types  \" + error);\r\n        });\r\n        this._bridge.getActivities()\r\n            .then(function (ac) {\r\n            _this._activities.add(ac);\r\n            _this._dataReadyMarker.signal(\"Got activities\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity instances -\" + error);\r\n        });\r\n        this._bridge.getActivityWindows()\r\n            .then(function (aw) {\r\n            _this._windows.add(aw);\r\n            _this._dataReadyMarker.signal(\"Got windows\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity windows -\" + error);\r\n        });\r\n    };\r\n    ActivityManager.prototype._subscribeForData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Subscribe for data...\");\r\n        this._bridge.onActivityTypeStatusChange(function (event) {\r\n            _this._activityTypes.process(event);\r\n        });\r\n        this._bridge.onWindowTypeStatusChange(function (event) {\r\n            _this._windowTypes.process(event);\r\n        });\r\n        this._bridge.onActivityWindowChange(function (event) {\r\n            _this._windows.process(event);\r\n        });\r\n        this._bridge.onActivityStatusChange(function (event) {\r\n            _this._activities.process(event);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesAttached = function (data) {\r\n        var _this = this;\r\n        var newActId = data.to;\r\n        var descriptor = data.descriptor;\r\n        var descriptors = data.descriptors;\r\n        this._activities.getOrWait(newActId).then(function (act) {\r\n            act._updateDescriptors(descriptors);\r\n            var descriptorAsObjectFromAPI = act.attached.filter(function (u) { return u.ownerId === descriptor.ownerId; })[0];\r\n            _this._attachedCallbacks.forEach(function (callback) {\r\n                try {\r\n                    callback(act, descriptorAsObjectFromAPI);\r\n                }\r\n                catch (err) {\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesDetached = function (data) {\r\n        var _this = this;\r\n        var oldActId = data.oldActivityId;\r\n        var newActId = data.newActivityId;\r\n        var descriptors = data.descriptors;\r\n        var descriptor = data.descriptor;\r\n        this._activities.getOrWait(oldActId).then(function (oldAct) {\r\n            oldAct._updateDescriptors(descriptors);\r\n            _this._activities.getOrWait(newActId).then(function (newAct) {\r\n                _this._detachedCallbacks.forEach(function (callback) {\r\n                    try {\r\n                        callback(newAct, oldAct, descriptor);\r\n                    }\r\n                    catch (err) {\r\n                        return;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivityDescriptorsRefreshed = function (data) {\r\n        var id = data.id;\r\n        var descriptors = data.descriptors;\r\n        var act = this._activities.getByName(id);\r\n        if (act) {\r\n            act._updateDescriptors(descriptors);\r\n        }\r\n    };\r\n    ActivityManager.prototype.refreshDescriptors = function () {\r\n        var _this = this;\r\n        this._bridge.getAttachedDescriptors()\r\n            .then(function (map) {\r\n            if (map) {\r\n                Object.keys(map).forEach(function (key) {\r\n                    var actId = key;\r\n                    var descriptors = map[key];\r\n                    var act = _this._activities.getByName(actId);\r\n                    if (act) {\r\n                        act._updateDescriptors(descriptors);\r\n                    }\r\n                });\r\n            }\r\n            _this._descriptorsMarker.signal(\"Successfully got descriptors\");\r\n        })\r\n            .catch(function (err) {\r\n            _this._descriptorsMarker.error(\"failed to get descriptors - \" + err);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleWindowFrameColorChanged = function (win) {\r\n        if (!win.activityId) {\r\n            return;\r\n        }\r\n        var act = this._activities.getByName(win.activityId);\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id !== win.id) {\r\n            return;\r\n        }\r\n        this._frameColorChangesCallbacks.forEach(function (callback) {\r\n            try {\r\n                callback(act, win.frameColor);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    return ActivityManager;\r\n}());\n\nvar ActivityManagementAPI = (function () {\r\n    function ActivityManagementAPI(manager, my) {\r\n        this._m = manager;\r\n        this._my = my;\r\n        this.activityTypes = {\r\n            get: this._getActivityTypesWrapper.bind(this),\r\n            register: this._m.registerActivityType.bind(this._m),\r\n            unregister: this._m.unregisterActivityType.bind(this._m),\r\n            subscribe: this._m.subscribeActivityTypeEvents.bind(this._m),\r\n            unsubscribe: undefined,\r\n            initiate: this._m.initiate.bind(this._m)\r\n        };\r\n        this.windowTypes = {\r\n            get: this._getWindowTypesWrapper.bind(this),\r\n            registerFactory: this._m.registerWindowFactory.bind(this._m),\r\n            unregisterFactory: this._m.unregisterWindowFactory.bind(this._m),\r\n            subscribe: this._m.subscribeWindowTypeEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n        this.windows = {\r\n            get: this._m.getWindows.bind(this._m),\r\n            subscribe: this._m.subscribeWindowEvents.bind(this._m),\r\n            announce: this._m.announceWindow.bind(this._m),\r\n            unsubscribe: undefined,\r\n            create: this._m.createWindow.bind(this._m)\r\n        };\r\n        this.instances = {\r\n            get: this._m.getActivities.bind(this._m),\r\n            subscribe: this._m.subscribeActivityEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n    }\r\n    ActivityManagementAPI.prototype.onAttached = function (callback) {\r\n        this._m.subscribeActivitiesAttached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onDetached = function (callback) {\r\n        this._m.subscribeActivitiesDetached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onActivityFrameColorChanged = function (callback) {\r\n        this._m.subscribeActivityFrameColorChanged(callback);\r\n    };\r\n    ActivityManagementAPI.prototype._getActivityTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getActivityTypes();\r\n        }\r\n        return this._m.getActivityType(name);\r\n    };\r\n    ActivityManagementAPI.prototype._getWindowTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getWindowTypes();\r\n        }\r\n        return this._m.getWindowType(name);\r\n    };\r\n    return ActivityManagementAPI;\r\n}());\n\nvar ActivityAPI = (function () {\r\n    function ActivityAPI(manager, my) {\r\n        this._mgr = manager;\r\n        this._my = my;\r\n        this.all = new ActivityManagementAPI(manager, my);\r\n    }\r\n    ActivityAPI.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._mgr.ready()\r\n                .then(function () {\r\n                resolve(_this);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Object.defineProperty(ActivityAPI.prototype, \"my\", {\r\n        get: function () {\r\n            return this._my;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"aware\", {\r\n        get: function () {\r\n            return this._my.window !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"inActivity\", {\r\n        get: function () {\r\n            return this.aware && this._my.activity !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"agm\", {\r\n        get: function () {\r\n            if (!this.aware) {\r\n                return undefined;\r\n            }\r\n            if (!this.inActivity) {\r\n                return new ActivityAGM(null);\r\n            }\r\n            return this._my.activity.agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityAPI.prototype.getAvailableFrameColors = function () {\r\n        return [];\r\n    };\r\n    return ActivityAPI;\r\n}());\n\nvar ActivityModule = (function () {\r\n    function ActivityModule(config) {\r\n        var _this = this;\r\n        if (!config) {\r\n            throw new Error(\"config can not be null\");\r\n        }\r\n        if (!isUndefined(config.logLevel)) {\r\n            Logger$1.Level = config.logLevel;\r\n        }\r\n        if (!isUndefinedOrNull(config.logger)) {\r\n            Logger$1.GlueLogger = config.logger;\r\n        }\r\n        var bridge;\r\n        this._isUsingHCImplementation = config.gdMajorVersion === 2;\r\n        this._isUsingGW3Implementation = ActivityModule.checkIsUsingGW3Implementation(config.connection);\r\n        if (this._isUsingHCImplementation) {\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (this._isUsingGW3Implementation) {\r\n            bridge = new GW3Bridge$1(config.connection, config.logger, config.contexts, config);\r\n        }\r\n        else {\r\n            throw new Error(\"Unable to instantiate activity bridge implementation\");\r\n        }\r\n        if (!bridge) {\r\n            throw new Error(\"A bridge to native activity is needed to create activity lib.\");\r\n        }\r\n        ActivityAGM.AGM = config.agm;\r\n        var activityManager = new ActivityManager(bridge, !config.disableAutoAnnounce, config.windows);\r\n        var my = new ActivityMy(activityManager, config.windows);\r\n        this._api = new ActivityAPI(activityManager, my);\r\n        this._readyPromise = activityManager.ready().then(function (_) { return _this; });\r\n    }\r\n    ActivityModule.checkIsUsingGW3Implementation = function (connection) {\r\n        return connection.protocolVersion === 3;\r\n    };\r\n    Object.defineProperty(ActivityModule.prototype, \"api\", {\r\n        get: function () {\r\n            return this._api;\r\n        },\r\n        set: function (value) {\r\n            this._api = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingHCImplementation\", {\r\n        get: function () {\r\n            return this._isUsingHCImplementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingGW3Implementation\", {\r\n        get: function () {\r\n            return this._isUsingGW3Implementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityModule.prototype.ready = function (callback) {\r\n        return nodeify(this._readyPromise, callback);\r\n    };\r\n    return ActivityModule;\r\n}());\n\nvar ShutdownMethodName = \"T42.ACS.Shutdown\";\r\nvar RestartMethodName = \"T42.ACS.Restart\";\r\nvar GetConfigurationRegionMethodName = \"T42.ACS.GetConfigurationRegion\";\r\nvar SetConfigurationRegionMethodName = \"T42.ACS.SetConfigurationRegion\";\r\nvar GetUserMethodName = \"T42.ACS.GetUser\";\r\nvar GetBranchesMethodName = \"T42.ACS.GetBranches\";\r\nvar GetCurrentBranchMethodName = \"T42.ACS.GetCurrentBranch\";\r\nvar SetCurrentBranchMethodName = \"T42.ACS.SetCurrentBranch\";\r\nvar GetFunctionalEntitlementMethodName = \"T42.ACS.GetFunctionalEntitlement\";\r\nvar CanIMethodName = \"T42.ACS.CanI\";\r\nvar StartApplicationMethodName = \"T42.ACS.StartApplication\";\r\nvar StopApplicationMethodName = \"T42.ACS.StopApplication\";\r\nvar ActivateApplicationMethodName = \"T42.ACS.ActivateApplication\";\r\nvar OnEventMethodName = \"T42.ACS.OnEvent\";\r\nvar GetApplicationsMethodName = \"T42.ACS.GetApplications\";\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nfunction objectValues(source) {\r\n    if (!source) {\r\n        return [];\r\n    }\r\n    return Object.keys(source).map(function (key) { return source[key]; });\r\n}\r\nfunction objectClone(obj) {\r\n    var result;\r\n    try {\r\n        result = JSON.parse(JSON.stringify(obj || {}));\r\n    }\r\n    catch (error) {\r\n        result = {};\r\n    }\r\n    return result;\r\n}\n\nvar ApplicationImpl = (function () {\r\n    function ApplicationImpl(_appManager, _name, _agm) {\r\n        var _this = this;\r\n        this._appManager = _appManager;\r\n        this._name = _name;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n        });\r\n        _appManager.onAppRemoved(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        });\r\n        _appManager.onAppChanged(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appChanged\", app);\r\n        });\r\n        _appManager.onAppAvailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appAvailable\", app);\r\n        });\r\n        _appManager.onAppUnavailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appUnavailable\", app);\r\n        });\r\n    }\r\n    Object.defineProperty(ApplicationImpl.prototype, \"name\", {\r\n        get: function () { return this._name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"title\", {\r\n        get: function () { return this._props.Title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"version\", {\r\n        get: function () { return this._props.Version; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"autoStart\", {\r\n        get: function () { return this._props.AutoStart; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isShell\", {\r\n        get: function () { return this._props.IsShell; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"caption\", {\r\n        get: function () { return this._props.Caption; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"hidden\", {\r\n        get: function () { return this._props.IsHidden; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"container\", {\r\n        get: function () { return this._props.ApplicationName; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityType\", {\r\n        get: function () { return this._props.ActivityType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityWindowType\", {\r\n        get: function () { return this._props.ActivityWindowType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"windowSettings\", {\r\n        get: function () {\r\n            if (!this._props.Arguments) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.Arguments);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"allowMultiple\", {\r\n        get: function () { return this._props.AllowMultiple; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"available\", {\r\n        get: function () { return this._props.IsReady || false; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"icon\", {\r\n        get: function () { return this._props.Icon; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"iconURL\", {\r\n        get: function () { return this._props.IconUrl; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"sortOrder\", {\r\n        get: function () { return this._props.SortOrder; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"userProperties\", {\r\n        get: function () {\r\n            if (!this._props.UserProperties) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.UserProperties);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isActivity\", {\r\n        get: function () {\r\n            return this._props.ActivityType !== undefined && this._props.ActivityType !== \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"configuration\", {\r\n        get: function () {\r\n            return {\r\n                autoStart: this._props.AutoStart,\r\n                caption: this._props.Caption,\r\n                hidden: this._props.IsHidden,\r\n                container: this._props.ApplicationName,\r\n                activityType: this._props.ActivityType,\r\n                allowMultiple: this._props.AllowMultiple\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this._name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"type\", {\r\n        get: function () {\r\n            return this._props.Type;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"mode\", {\r\n        get: function () {\r\n            if (!this._props) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Mode && typeof this._props.Mode === \"string\") {\r\n                return this._props.Mode.toLowerCase();\r\n            }\r\n            if (this.isActivity) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Arguments && this._props.Arguments.mode && typeof this._props.Arguments.mode === \"string\") {\r\n                return this._props.Arguments.mode.toLowerCase();\r\n            }\r\n            var styleAttributes = this._props.WindowStyleAttributes;\r\n            if (styleAttributes) {\r\n                styleAttributes = styleAttributes.split(\" \").join(\"\");\r\n                var searchFor = \"mode:\\\"\";\r\n                var modeIndex = styleAttributes.indexOf(searchFor);\r\n                if (modeIndex !== -1) {\r\n                    var startModeIndex = modeIndex + searchFor.length;\r\n                    var stopModeIndex = styleAttributes.indexOf(\"\\\"\", startModeIndex);\r\n                    var style = styleAttributes.substr(startModeIndex, stopModeIndex - startModeIndex);\r\n                    if (style && typeof style === \"string\") {\r\n                        return style.toLowerCase();\r\n                    }\r\n                }\r\n            }\r\n            return \"flat\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ApplicationImpl.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        if (!this._props) {\r\n            this._props = { Name: props.Name };\r\n        }\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.start = function (context, options) {\r\n        var _this = this;\r\n        var name = this._name;\r\n        var startTimeout = 10000;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            context = context || {};\r\n            var waitForAGMInstance = true;\r\n            var waitForApplicationInstance = function (id) {\r\n                var check = function () {\r\n                    var filtered = _this._appManager.instances().filter(function (i) { return i.id === id; });\r\n                    var result;\r\n                    if (filtered.length === 2) {\r\n                        result = filtered[0].isActivityInstance ? filtered[0] : filtered[1];\r\n                    }\r\n                    else {\r\n                        result = filtered[0];\r\n                    }\r\n                    if (result && waitForAGMInstance) {\r\n                        if (result.agm) {\r\n                            return result;\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n                var unsub;\r\n                var timeout = setTimeout(function () {\r\n                    if (unsub) {\r\n                        unsub();\r\n                    }\r\n                    reject(\"timeout\");\r\n                }, startTimeout);\r\n                var waitFunc = function (i) {\r\n                    if (i.id !== id) {\r\n                        return;\r\n                    }\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    setTimeout(function () {\r\n                        resolve(check());\r\n                    }, 1);\r\n                };\r\n                {\r\n                    unsub = _this._appManager.onInstanceAgmServerReady(waitFunc);\r\n                }\r\n                var instances = check();\r\n                if (instances) {\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    resolve(instances);\r\n                }\r\n            };\r\n            _this._agm.invoke(StartApplicationMethodName, {\r\n                Name: name,\r\n                Context: context,\r\n                Options: options\r\n            }, \"best\", {\r\n                methodResponseTimeoutMs: startTimeout\r\n            }, function (result) {\r\n                var acsResult = result.returned && result.returned.Instance_0\r\n                    ? result.returned.Instance_0\r\n                    : result.returned;\r\n                if (acsResult && acsResult.Id) {\r\n                    if (_this._appManager.mode === \"startOnly\") {\r\n                        var instance = _this._appManager.handleInstanceStarted(acsResult);\r\n                        resolve(instance);\r\n                    }\r\n                    else {\r\n                        waitForApplicationInstance(acsResult.Id);\r\n                    }\r\n                }\r\n                else {\r\n                    resolve(undefined);\r\n                }\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onAvailable = function (callback) {\r\n        this._registry.add(\"appAvailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onUnavailable = function (callback) {\r\n        this._registry.add(\"appUnavailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onChanged = function (callback) {\r\n        this._registry.add(\"appChanged\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onRemoved = function (callback) {\r\n        this._registry.add(\"appRemoved\", callback);\r\n    };\r\n    return ApplicationImpl;\r\n}());\n\nvar InstanceImpl = (function () {\r\n    function InstanceImpl(_id, _appName, _appManager, _agm, _activities, _windows, startFailed) {\r\n        var _this = this;\r\n        this._id = _id;\r\n        this._appName = _appName;\r\n        this._appManager = _appManager;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this.onAgmReady = this._addToRegistry(\"agmReady\");\r\n        this.onStopped = this._addToRegistry(\"stopped\");\r\n        this._registry = lib$2();\r\n        if (startFailed) {\r\n            return;\r\n        }\r\n        this._unsubscribeInstanceStopped = this._appManager.onInstanceStopped(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"stopped\", instance);\r\n        });\r\n        this._unsubscribeInstanceAgmServerReady = this._appManager.onInstanceAgmServerReady(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"agmReady\", instance);\r\n        });\r\n    }\r\n    Object.defineProperty(InstanceImpl.prototype, \"id\", {\r\n        get: function () { return this._id; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"application\", {\r\n        get: function () { return this._appManager.application(this._appName); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activity\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._activities) {\r\n                throw new Error(\"This method requires glue.activities library to be enabled.\");\r\n            }\r\n            return this._activities.all.instances.get()\r\n                .filter(function (activityInstance) { return activityInstance.id === _this._activityId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityInstances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances()\r\n                .filter(function (i) { return i.context && (i.context.activityId === _this._activityId); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityOwnerInstance\", {\r\n        get: function () {\r\n            return this._appManager.instances()\r\n                .filter(function (instance) {\r\n                if (instance.window && instance.window.context) {\r\n                    var instWinCntx = instance.window.context;\r\n                    if (instWinCntx._t42 && instWinCntx._t42.activityIsOwner) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"window\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._windows) {\r\n                throw new Error(\"This method requires glue.windows library to be enabled.\");\r\n            }\r\n            var win = this._windows.list().filter(function (w) { return w.id === _this._id; })[0];\r\n            if (!win && this.activity && this.activityOwnerInstance) {\r\n                win = this.activityOwnerInstance.window;\r\n            }\r\n            return win;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"context\", {\r\n        get: function () {\r\n            var _a, _b, _c;\r\n            return _c = (_a = this._startUpContext, (_a !== null && _a !== void 0 ? _a : (_b = this.window) === null || _b === void 0 ? void 0 : _b.context)), (_c !== null && _c !== void 0 ? _c : {});\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"title\", {\r\n        get: function () { return this._title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityInstance\", {\r\n        get: function () { return this._isActivityInstance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityId\", {\r\n        get: function () { return this._activityId; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"inActivity\", {\r\n        get: function () { return this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isSingleWindowApp\", {\r\n        get: function () { return !this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agmInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InstanceImpl.prototype.updateFromProps = function (props) {\r\n        this._startUpContext = props.Context;\r\n        this._title = props.Title;\r\n        this._isActivityInstance = false;\r\n        if (props.ActivityId && props.ActivityId !== \"\") {\r\n            this._activityId = props.ActivityId;\r\n            this._isActivityInstance = true;\r\n        }\r\n        if (!this._activityId && this._startUpContext && this._startUpContext.activityId) {\r\n            this._activityId = this._startUpContext.activityId;\r\n        }\r\n        this._inActivity = Boolean(this._activityId);\r\n        this.updateAgmInstanceFromProps(props);\r\n    };\r\n    InstanceImpl.prototype.updateAgmInstanceFromProps = function (props) {\r\n        if (!props.AgmServers) {\r\n            return;\r\n        }\r\n        if (props.GD3) {\r\n            var agmInstances = props.AgmServers;\r\n            if (agmInstances) {\r\n                this._agmInstance = agmInstances[0];\r\n            }\r\n        }\r\n        else {\r\n            var gdAgmServers = props.AgmServers;\r\n            var propsAgmServer = Object.keys(gdAgmServers)[0];\r\n            if (!propsAgmServer) {\r\n                return;\r\n            }\r\n            var propsAgm = gdAgmServers[propsAgmServer];\r\n            this._agmInstance = {\r\n                machine: propsAgm.machineName,\r\n                user: propsAgm.userName,\r\n                environment: propsAgm.environment,\r\n                application: propsAgm.applicationName,\r\n            };\r\n        }\r\n    };\r\n    InstanceImpl.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var unsubscribe = _this._appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this._id) {\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            _this._agm.invoke(StopApplicationMethodName, {\r\n                Name: _this._appName,\r\n                Id: _this._id\r\n            })\r\n                .then(function () {\r\n                if (_this._appManager.mode === \"startOnly\") {\r\n                    _this._appManager.handleInstanceStopped({\r\n                        Name: _this._appName,\r\n                        Id: _this.id,\r\n                        Context: undefined,\r\n                        Title: undefined,\r\n                        ActivityId: undefined,\r\n                        AgmServers: undefined\r\n                    });\r\n                    resolve();\r\n                }\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    InstanceImpl.prototype.activate = function () {\r\n        return this._agm.invoke(ActivateApplicationMethodName, { Name: this._appName, Id: this._id });\r\n    };\r\n    InstanceImpl.prototype.done = function () {\r\n        this._registry.clear();\r\n        this._unsubscribeInstanceAgmServerReady();\r\n        this._unsubscribeInstanceStopped();\r\n    };\r\n    InstanceImpl.prototype._addToRegistry = function (key) {\r\n        var _this = this;\r\n        return function (callback) {\r\n            _this._registry.add(key, callback);\r\n        };\r\n    };\r\n    return InstanceImpl;\r\n}());\n\nvar AppManagerImpl = (function () {\r\n    function AppManagerImpl(mode, _agm, _activities, _windows, _logger, _gdMajorVersion) {\r\n        var _this = this;\r\n        this.mode = mode;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this._logger = _logger;\r\n        this._gdMajorVersion = _gdMajorVersion;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this._registry = lib$2();\r\n        this.application = function (name) {\r\n            return _this._apps[name];\r\n        };\r\n        this.applications = function () {\r\n            return Object.keys(_this._apps).map(function (k) { return _this._apps[k]; });\r\n        };\r\n        this.instances = function () {\r\n            return _this._instances;\r\n        };\r\n        this.getMyInstance = function () {\r\n            if (_this._gdMajorVersion >= 3) {\r\n                var instanceId_1 = window.glue42gd.appInstanceId;\r\n                return _this._instances.filter(function (i) { return i.id === instanceId_1; })[0];\r\n            }\r\n            return undefined;\r\n        };\r\n        this.handleAppAdded = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"adding app \" + id);\r\n            _this._apps[id] = new ApplicationImpl(_this, id, _this._agm);\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appAdded\", app);\r\n        };\r\n        this.handleAppUpdated = function (props) {\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appChanged\", app);\r\n        };\r\n        this.handleAppRemoved = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"removing app \" + id);\r\n            var app = _this.application(id);\r\n            _this._instances = _this._instances.filter(function (i) { return i.application.name !== app.name; });\r\n            delete _this._apps[id];\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        };\r\n        this.handleAppReady = function (props) {\r\n            var id = _this._getAppId(props);\r\n            var app = _this._getAppOrThrow(id);\r\n            app.updateFromProps(props);\r\n            if (app.available) {\r\n                _this._registry.execute(\"appAvailable\", app);\r\n            }\r\n            else {\r\n                _this._registry.execute(\"appUnavailable\", app);\r\n            }\r\n        };\r\n        this.handleInstanceStarted = function (props) {\r\n            _this._logger.trace(\"started app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = new InstanceImpl(id, appName, _this, _this._agm, _this._activities, _this._windows);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._instances.push(instance);\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n            return instance;\r\n        };\r\n        this.handleInstanceStopped = function (props) {\r\n            _this._logger.trace(\"failed to start app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            _this._instances = _this._instances.filter(function (i) { return !_this._matchInstance(i, id, appName); });\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n            instance.done();\r\n        };\r\n        this.handleInstanceAgmServerReady = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            instance.updateAgmInstanceFromProps(props);\r\n            _this._registry.execute(\"instanceAgmServerReady\", instance);\r\n        };\r\n        this.handleInstanceStartFailed = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var startFailed = true;\r\n            var instance = new InstanceImpl(id, appName, undefined, undefined, undefined, undefined, startFailed);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._registry.execute(\"instanceStartFailed\", instance);\r\n        };\r\n        this.handleInstanceUpdated = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, app);\r\n            _this._updateInstanceFromProps(instance, props);\r\n        };\r\n        this.onInstanceStarted = function (callback) {\r\n            _this._replay(_this._instances, callback);\r\n            return _this._registry.add(\"instanceStarted\", callback);\r\n        };\r\n        this.onInstanceStartFailed = function (callback) {\r\n            return _this._registry.add(\"instanceStartFailed\", callback);\r\n        };\r\n        this.onInstanceStopped = function (callback) {\r\n            return _this._registry.add(\"instanceStopped\", callback);\r\n        };\r\n        this.onInstanceUpdated = function (callback) {\r\n            return _this._registry.add(\"instanceChanged\", callback);\r\n        };\r\n        this.onInstanceAgmServerReady = function (callback) {\r\n            return _this._registry.add(\"instanceAgmServerReady\", callback);\r\n        };\r\n        this.onAppAdded = function (callback) {\r\n            _this._replay(_this._apps, callback);\r\n            return _this._registry.add(\"appAdded\", callback);\r\n        };\r\n        this.onAppRemoved = function (callback) {\r\n            return _this._registry.add(\"appRemoved\", callback);\r\n        };\r\n        this.onAppAvailable = function (callback) {\r\n            return _this._registry.add(\"appAvailable\", callback);\r\n        };\r\n        this.onAppUnavailable = function (callback) {\r\n            return _this._registry.add(\"appUnavailable\", callback);\r\n        };\r\n        this.onAppChanged = function (callback) {\r\n            return _this._registry.add(\"appChanged\", callback);\r\n        };\r\n    }\r\n    AppManagerImpl.prototype._getAppOrThrow = function (id) {\r\n        var result = this.application(id);\r\n        if (!result) {\r\n            throw Error(\"app with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getAppId = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._matchInstance = function (instance, id, appName) {\r\n        return instance.id === id && instance.application.name === appName;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceByIdAndName = function (id, appName) {\r\n        var _this = this;\r\n        return this._instances.filter(function (i) { return _this._matchInstance(i, id, appName); })[0];\r\n    };\r\n    AppManagerImpl.prototype._getInstanceOrThrow = function (id, appName) {\r\n        var result = this._getInstanceByIdAndName(id, appName);\r\n        if (!result) {\r\n            throw Error(\"instance with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceId = function (props) {\r\n        return props.Id;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceAppName = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._updateAppFromProps = function (props) {\r\n        var id = this._getAppId(props);\r\n        this._logger.trace(\"updating app with  + \" + id + \", \" + props);\r\n        var app = this._getAppOrThrow(id);\r\n        app.updateFromProps(props);\r\n        return app;\r\n    };\r\n    AppManagerImpl.prototype._updateInstanceFromProps = function (instance, props) {\r\n        this._logger.trace(\"updating instance with \" + this._getInstanceId(props) + \" for app \" + this._getInstanceAppName(props));\r\n        instance.updateFromProps(props);\r\n    };\r\n    AppManagerImpl.prototype._replay = function (itemsToReplay, callback) {\r\n        if (itemsToReplay) {\r\n            if (Array.isArray(itemsToReplay)) {\r\n                itemsToReplay.forEach(function (item) { return callback(item); });\r\n            }\r\n            else {\r\n                var itemsToReplayArr = Object.keys(itemsToReplay).map(function (key) { return itemsToReplay[key]; });\r\n                itemsToReplayArr.forEach(function (item) { return callback(item); });\r\n            }\r\n        }\r\n    };\r\n    return AppManagerImpl;\r\n}());\n\nfunction promisify$2(promise, successCallback, errorCallback) {\r\n    var isFunction = function (arg) {\r\n        return !!(arg && arg.constructor && arg.call && arg.apply);\r\n    };\r\n    if (!isFunction(successCallback) && !isFunction(errorCallback)) {\r\n        return promise;\r\n    }\r\n    if (!isFunction(successCallback)) {\r\n        successCallback = function () {\r\n        };\r\n    }\r\n    else if (!isFunction(errorCallback)) {\r\n        errorCallback = function () {\r\n        };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nvar EntitlementsImpl = (function () {\r\n    function EntitlementsImpl(_agm) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        this.handleBranchModified = function (branch) {\r\n            _this._registry.execute(\"branchChanged\", branch);\r\n        };\r\n        this.handleBranchesModified = function (branches) {\r\n            _this._registry.execute(\"branchesChanged\", branches);\r\n        };\r\n        this.getRegion = function (success, error) {\r\n            return promisify$2(_this._agmInvoke(GetConfigurationRegionMethodName, function (e) { return e.returned.Region; }), success, error);\r\n        };\r\n        this.getBranches = function (success, error) {\r\n            var promise = _this._agmInvoke(GetBranchesMethodName, function (e) {\r\n                var obj = e.returned.Branches;\r\n                return Object.keys(obj).map(function (key) { return obj[key]; });\r\n            });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getCurrentBranch = function (success, error) {\r\n            var promise = _this._agmInvoke(GetCurrentBranchMethodName, function (e) { return e.returned.Branch; }, undefined);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setRegion = function (region, success, error) {\r\n            var promise = _this._agmInvoke(SetConfigurationRegionMethodName, function (e) { return e.returned.ResultMessage; }, { Region: region });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setCurrentBranch = function (branch, success, error) {\r\n            var promise = _this._agmInvoke(SetCurrentBranchMethodName, function (e) { return e.returned.ResultMessage; }, { Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.currentUser = function (success, error) {\r\n            var promise = _this._agmInvoke(GetUserMethodName);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlement = function (funct, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlementBranch = function (funct, branch, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canI = function (func, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canIBranch = function (func, branch, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.onBranchesChanged = function (callback) {\r\n            _this._registry.add(\"branchesChanged\", callback);\r\n        };\r\n        this.onBranchChanged = function (callback) {\r\n            _this._registry.add(\"branchChanged\", callback);\r\n        };\r\n        this.exit = function (options) {\r\n            return _this._agmInvoke(ShutdownMethodName, null, options);\r\n        };\r\n        this.restart = function (options) {\r\n            return _this._agmInvoke(RestartMethodName, null, options);\r\n        };\r\n        this._agmInvoke = function (method, transformFunction, args) {\r\n            args = args || {};\r\n            return new Promise(function (resolve, reject) {\r\n                var errHandler = function (error) { return reject(error); };\r\n                _this._agm.invoke(method, args)\r\n                    .then(function (result) {\r\n                    if (!transformFunction) {\r\n                        transformFunction = function (d) { return d.returned; };\r\n                    }\r\n                    resolve(transformFunction(result));\r\n                })\r\n                    .catch(errHandler);\r\n            });\r\n        };\r\n    }\r\n    return EntitlementsImpl;\r\n}());\n\nfunction snapshot(agm, appManager) {\r\n    return new Promise(function (resolve, reject) {\r\n        agm.invoke(GetApplicationsMethodName, { skipIcon: true })\r\n            .then(function (response) {\r\n            var data = response.returned;\r\n            if (!data) {\r\n                resolve();\r\n            }\r\n            var applications = data.applications;\r\n            if (!applications) {\r\n                resolve();\r\n            }\r\n            objectValues(applications).map(function (item) { return appManager.handleAppAdded(item); });\r\n            resolve();\r\n        })\r\n            .catch(function (err) { return reject(\"Error getting application snapshot: \" + err.message); });\r\n    });\r\n}\n\nvar OnBranchChangedEvent = \"OnBranchChanged\";\r\nvar OnBranchesModifiedEvent = \"OnBranchesModified\";\r\nvar OnApplicationAddedEvent = \"OnApplicationAdded\";\r\nvar OnApplicationRemovedEvent = \"OnApplicationRemoved\";\r\nvar OnApplicationChangedEvent = \"OnApplicationChanged\";\r\nvar OnApplicationReadyEvent = \"OnApplicationReady\";\r\nvar OnApplicationStartedEvent = \"OnApplicationStarted\";\r\nvar OnApplicationAgmServerReadyEvent = \"OnApplicationAgmServerReady\";\r\nvar OnApplicationUpdatedEvent = \"OnApplicationUpdated\";\r\nvar OnApplicationStoppedEvent = \"OnApplicationStopped\";\r\nvar OnApplicationStartFailedEvent = \"OnApplicationStartFailed\";\n\nfunction createDataSubscription(agm, applications, entitlements, skipIcons) {\r\n    var subscription;\r\n    var start = function () {\r\n        var resolveFunc;\r\n        var rejectFunc;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            resolveFunc = resolve;\r\n            rejectFunc = reject;\r\n        });\r\n        agm.subscribe(OnEventMethodName, { arguments: { skipIcon: skipIcons }, waitTimeoutMs: 10000 })\r\n            .then(function (s) {\r\n            subscription = s;\r\n            subscription.onData(function (streamData) {\r\n                var events = streamData.data;\r\n                objectValues(events[OnApplicationAddedEvent])\r\n                    .map(function (item) { return applications.handleAppAdded(item); });\r\n                objectValues(events[OnApplicationChangedEvent])\r\n                    .map(function (item) { return applications.handleAppUpdated(item); });\r\n                objectValues(events[OnApplicationRemovedEvent])\r\n                    .map(function (item) { return applications.handleAppRemoved(item); });\r\n                objectValues(events[OnApplicationReadyEvent])\r\n                    .map(function (item) { return applications.handleAppReady(item); });\r\n                objectValues(events[OnApplicationStartedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStarted(item); });\r\n                objectValues(events[OnApplicationStartFailedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStartFailed(item); });\r\n                objectValues(events[OnApplicationStoppedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStopped(item); });\r\n                objectValues(events[OnApplicationUpdatedEvent])\r\n                    .map(function (item) { return applications.handleInstanceUpdated(item); });\r\n                objectValues(events[OnApplicationAgmServerReadyEvent])\r\n                    .map(function (item) { return applications.handleInstanceAgmServerReady(item); });\r\n                objectValues(events[OnBranchChangedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchModified(item); });\r\n                objectValues(events[OnBranchesModifiedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchesModified(item); });\r\n                resolveFunc();\r\n            });\r\n            subscription.onFailed(function (err) { return rejectFunc(err); });\r\n        })\r\n            .catch(function (err) { return rejectFunc(\"Error subscribing for \" + OnEventMethodName + \" stream. Err: \" + err); });\r\n        return resultPromise;\r\n    };\r\n    var stop = function () {\r\n        if (subscription) {\r\n            subscription.close();\r\n        }\r\n    };\r\n    return {\r\n        start: start,\r\n        stop: stop\r\n    };\r\n}\n\nvar AppManagerFactory = (function (config) {\r\n    if (!config) {\r\n        throw Error(\"config not set\");\r\n    }\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is missing\");\r\n    }\r\n    var START_ONLY = \"startOnly\";\r\n    var SKIP_ICONS = \"skipIcons\";\r\n    var FULL = \"full\";\r\n    var mode = config.mode || START_ONLY;\r\n    if (mode !== START_ONLY && mode !== SKIP_ICONS && mode !== FULL) {\r\n        throw new Error(\"Invalid mode for appManager lib - \" + mode + \" is not supported\");\r\n    }\r\n    var activities = config.activities;\r\n    var agm = config.agm;\r\n    var logger = config.logger;\r\n    var windows = config.windows;\r\n    var appManager = new AppManagerImpl(mode, agm, activities, windows, logger.subLogger(\"applications\"), config.gdMajorVersion);\r\n    var entitlements = new EntitlementsImpl(agm);\r\n    var readyPromise;\r\n    if (mode === START_ONLY) {\r\n        readyPromise = snapshot(agm, appManager);\r\n    }\r\n    else {\r\n        var subscription = createDataSubscription(agm, appManager, entitlements, mode === SKIP_ICONS);\r\n        readyPromise = subscription.start();\r\n    }\r\n    var api = {\r\n        ready: function () { return readyPromise; },\r\n        applications: appManager.applications,\r\n        application: appManager.application,\r\n        onAppAdded: appManager.onAppAdded,\r\n        onAppRemoved: appManager.onAppRemoved,\r\n        onAppChanged: appManager.onAppChanged,\r\n        onAppAvailable: appManager.onAppAvailable,\r\n        onAppUnavailable: appManager.onAppUnavailable,\r\n        instances: appManager.instances,\r\n        get myInstance() {\r\n            return appManager.getMyInstance();\r\n        },\r\n        onInstanceStarted: appManager.onInstanceStarted,\r\n        onInstanceStopped: appManager.onInstanceStopped,\r\n        onInstanceUpdated: appManager.onInstanceUpdated,\r\n        onInstanceStartFailed: appManager.onInstanceStartFailed,\r\n        getRegion: entitlements.getRegion,\r\n        getBranches: entitlements.getBranches,\r\n        getCurrentBranch: entitlements.getCurrentBranch,\r\n        getFunctionalEntitlement: entitlements.getFunctionalEntitlement,\r\n        getFunctionalEntitlementBranch: entitlements.getFunctionalEntitlementBranch,\r\n        setCurrentBranch: entitlements.setCurrentBranch,\r\n        setRegion: entitlements.setRegion,\r\n        currentUser: entitlements.currentUser,\r\n        canI: entitlements.canI,\r\n        canIBranch: entitlements.canIBranch,\r\n        onBranchesChanged: entitlements.onBranchesChanged,\r\n        exit: entitlements.exit,\r\n        restart: entitlements.restart\r\n    };\r\n    return api;\r\n});\n\nvar WindowStore = (function () {\r\n    function WindowStore() {\r\n        this.waitForTimeoutInMilliseconds = 60000;\r\n        this._windows = {};\r\n        this._pendingWindows = {};\r\n        this._pendingWindowsStates = {};\r\n        this._registry = lib$2();\r\n    }\r\n    WindowStore.prototype.init = function (logger) {\r\n        this._logger = logger;\r\n    };\r\n    WindowStore.prototype.get = function (id) {\r\n        return this._windows[id] || this._pendingWindows[id];\r\n    };\r\n    WindowStore.prototype.getIfReady = function (id) {\r\n        return this._windows[id];\r\n    };\r\n    Object.defineProperty(WindowStore.prototype, \"list\", {\r\n        get: function () {\r\n            return this._windows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowStore.prototype.add = function (window) {\r\n        var isExist = this._pendingWindows[window.API.id] ? true : false;\r\n        if (isExist) {\r\n            this._logger.error(\"trying to add window with id \" + window.API.id + \" from windowStore, which already exists\");\r\n            return;\r\n        }\r\n        var remote = window.API.windowType === \"remote\";\r\n        this._pendingWindows[window.API.id] = window;\r\n        this._pendingWindowsStates[window.API.id] = {\r\n            ready: false,\r\n            urlChanged: remote,\r\n        };\r\n        this._registry.execute(\"on-added\", window);\r\n    };\r\n    WindowStore.prototype.remove = function (window) {\r\n        delete this._windows[window.API.id];\r\n        delete this._pendingWindows[window.API.id];\r\n        delete this._pendingWindowsStates[window.API.id];\r\n        this._registry.execute(\"on-removed\", window);\r\n    };\r\n    WindowStore.prototype.setReadyState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.ready = true;\r\n        if (targetWindowState.urlChanged) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.setUrlChangedState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.urlChanged = true;\r\n        if (targetWindowState.ready) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.waitFor = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var un;\r\n            var timeout = setTimeout(function () {\r\n                un();\r\n                reject(\"waitFor timed out.\");\r\n            }, _this.waitForTimeoutInMilliseconds);\r\n            var win = _this._windows[id];\r\n            if (win) {\r\n                clearTimeout(timeout);\r\n                resolve(win);\r\n            }\r\n            else {\r\n                un = _this.onReadyWindow(function (w) {\r\n                    if (w.API.id !== id) {\r\n                        return;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    un();\r\n                    resolve(w);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    WindowStore.prototype.onReadyWindow = function (callback) {\r\n        return this._registry.add(\"on-ready\", callback);\r\n    };\r\n    WindowStore.prototype.onAdded = function (callback) {\r\n        return this._registry.add(\"on-added\", callback);\r\n    };\r\n    WindowStore.prototype.onRemoved = function (callback) {\r\n        return this._registry.add(\"on-removed\", callback);\r\n    };\r\n    WindowStore.prototype.markReadyToShow = function (windowId) {\r\n        if (this._pendingWindows[windowId]) {\r\n            this._windows[windowId] = this._pendingWindows[windowId];\r\n            delete this._pendingWindows[windowId];\r\n            delete this._pendingWindowsStates[windowId];\r\n        }\r\n        this._registry.execute(\"on-ready\", this._windows[windowId]);\r\n    };\r\n    return WindowStore;\r\n}());\r\nvar windowStore = new WindowStore();\n\nvar Utils$1 = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.callbackifyPromise = function (action, successCallback, errorCallback) {\r\n        var fail = function (error) {\r\n            var msg = error;\r\n            if (error instanceof Error) {\r\n                msg = error.message;\r\n            }\r\n            if (typeof errorCallback === \"function\") {\r\n                errorCallback(msg);\r\n                return;\r\n            }\r\n            return Promise.reject(msg);\r\n        };\r\n        try {\r\n            return action()\r\n                .then(function (result) {\r\n                if (typeof successCallback === \"function\") {\r\n                    successCallback(result);\r\n                }\r\n                return result;\r\n            })\r\n                .catch(function (error) {\r\n                return fail(error);\r\n            });\r\n        }\r\n        catch (err) {\r\n            return fail(err);\r\n        }\r\n    };\r\n    Utils.getMonitor = function (bounds, displays) {\r\n        var _this = this;\r\n        var monitorsSortedByOverlap = displays.map(function (m) {\r\n            var left = m.left, top = m.top, width = m.workingAreaWidth, height = m.workingAreaHeight;\r\n            var overlap = _this.calculateTotalOverlap({ left: left, top: top, width: width, height: height }, bounds);\r\n            return {\r\n                monitor: m,\r\n                totalOverlap: overlap\r\n            };\r\n        }).sort(function (a, b) { return b.totalOverlap - a.totalOverlap; });\r\n        return monitorsSortedByOverlap[0].monitor;\r\n    };\r\n    Utils.getDisplayCenterOfScreen = function (a, display) {\r\n        var left = Math.floor(Math.max(display.left, (display.left + (display.workingAreaWidth - a.width) / 2)));\r\n        var top = Math.floor(Math.max(display.top, (display.top + (display.workingAreaHeight - a.height) / 2)));\r\n        return {\r\n            top: top,\r\n            left: left\r\n        };\r\n    };\r\n    Utils.calculateTotalOverlap = function (r1, r2) {\r\n        var r1x = r1.left;\r\n        var r1y = r1.top;\r\n        var r1xMax = r1x + r1.width;\r\n        var r1yMax = r1y + r1.height;\r\n        var r2x = r2.left;\r\n        var r2y = r2.top;\r\n        var r2xMax = r2x + r2.width;\r\n        var r2yMax = r2y + r2.height;\r\n        var xOverlap = Math.max(0, Math.min(r1xMax, r2xMax) - Math.max(r1x, r2x));\r\n        var yOverlap = Math.max(0, Math.min(r1yMax, r2yMax) - Math.max(r1y, r2y));\r\n        return xOverlap * yOverlap;\r\n    };\r\n    return Utils;\r\n}());\n\nvar windowFactory = (function (id, options, executor, logger, appManagerGetter, agm) {\r\n    var _registry = lib$2();\r\n    var _logger = logger.subLogger(\"window \" + id);\r\n    var _name = options.name;\r\n    var _mode = options.mode;\r\n    var _url = options.url;\r\n    var _title = options.title;\r\n    var _context = options.context || {};\r\n    var _bounds = options.bounds;\r\n    var _frameColor = options.frameColor;\r\n    var _focus = options.focus;\r\n    var _neighbours = options.neighbours || {};\r\n    var _groupId = options.groupId;\r\n    var _isGroupHeaderVisible = options.isGroupHeaderVisible;\r\n    var _isTabHeaderVisible = options.isTabHeaderVisible;\r\n    var _isTabSelected = options.isTabSelected;\r\n    var _settings = options.settings;\r\n    var _isVisible = options.isVisible;\r\n    var isCollapsed = options.isCollapsed;\r\n    var _windowState = options.state;\r\n    var _tabGroupId = options.tabGroupId;\r\n    var _isLocked = options.isLocked;\r\n    var _group;\r\n    var resultWindow;\r\n    var _frameButtons = [];\r\n    var _zoomFactor = options.zoomFactor;\r\n    function close(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.close(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function navigate(newUrl, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.navigate(resultWindow, newUrl)\r\n                .then(function () {\r\n                if (newUrl === _url) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onUrlChanged(function (url, win) {\r\n                    if (win.id === id && url === win.url) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setStyle(style, success, error) {\r\n        if (!style || Object.keys(style).length === 0 || Object.keys(style).every(function (key) { return !key; })) {\r\n            var errMessage = \"Invalid style arguments: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        if (style && style.focus !== undefined) {\r\n            if (typeof style.focus !== \"boolean\") {\r\n                var errMessage = \"Focus must be boolean. Currently only focus true is supported ! \" + JSON.stringify(style);\r\n                error(errMessage);\r\n                return Promise.reject(new Error(errMessage));\r\n            }\r\n            else if (style.focus === false) {\r\n                console.warn(\"Focus false is not supported ! \");\r\n            }\r\n        }\r\n        if (style && style.hidden !== undefined && typeof style.hidden !== \"boolean\") {\r\n            var errMessage = \"Hidden must be boolean ! provided: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setStyle(resultWindow, style); }, success, error);\r\n    }\r\n    function resetButtons(buttons, success, error) {\r\n        return Utils$1.callbackifyPromise(function () { return executor.resetButtons(resultWindow, buttons); }, success, error);\r\n    }\r\n    function setOnTop(onTop, success, error) {\r\n        if (this.onTop === onTop) {\r\n            var errMessage = \"OnTop setting is already set to '\" + onTop + \"'\";\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setOnTop(resultWindow, onTop); }, success, error);\r\n    }\r\n    function setSizeConstraints(constraints, success, error) {\r\n        if (!constraints || Object.keys(constraints).every(function (value) { return value === undefined; })) {\r\n            var errMessage = \"Invalid Constraints: \" + JSON.stringify(constraints);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setSizeConstraints(resultWindow, constraints); }, success, error);\r\n    }\r\n    function setTitle(newTitle, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTitle(resultWindow, newTitle)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function moveResize(dimensions, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var resolveImmediately = areBoundsEqual(dimensions, _bounds);\r\n            var isDone = false;\r\n            var done = function () {\r\n                if (isDone) {\r\n                    return;\r\n                }\r\n                isDone = true;\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n                if (unsubscribeBoundsChanged) {\r\n                    unsubscribeBoundsChanged();\r\n                    unsubscribeBoundsChanged = undefined;\r\n                }\r\n                if (resolveTimeout) {\r\n                    clearTimeout(resolveTimeout);\r\n                    resolveTimeout = undefined;\r\n                }\r\n            };\r\n            var resolveTimeout;\r\n            var unsubscribeBoundsChanged;\r\n            if (!resolveImmediately) {\r\n                unsubscribeBoundsChanged = onBoundsChanged(function (win) {\r\n                    if (win.id !== resultWindow.id) {\r\n                        return;\r\n                    }\r\n                    if (!areBoundsEqual(dimensions, win.bounds)) {\r\n                        return;\r\n                    }\r\n                    done();\r\n                });\r\n            }\r\n            executor.moveResize(resultWindow, dimensions)\r\n                .then(function () {\r\n                if (resolveImmediately) {\r\n                    done();\r\n                    return;\r\n                }\r\n                resolveTimeout = setTimeout(function () {\r\n                    done();\r\n                }, 1000);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function addFrameButton(buttonInfo, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof buttonInfo === \"undefined\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No button info\");\r\n                    return;\r\n                }\r\n                reject(\"No button info\");\r\n                return;\r\n            }\r\n            if (buttonInfo.buttonId === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            if (buttonInfo.imageBase64 === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No imageBase64\");\r\n                    return;\r\n                }\r\n                reject(\"No imageBase64\");\r\n                return;\r\n            }\r\n            executor.addFrameButton(resultWindow, buttonInfo)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function removeFrameButton(buttonId, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (buttonId === undefined || buttonId === \"\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            executor.removeFrameButton(resultWindow, buttonId)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function activate(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.activate(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function focus(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.focus(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximizeRestore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = _windowState === \"normal\" ? onMaximized : onNormal;\r\n            executor.maximizeRestore(resultWindow)\r\n                .then(function () {\r\n                var un = currEvent(function () {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    if (un) {\r\n                        un();\r\n                    }\r\n                    resolve(resultWindow);\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.maximize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"maximized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMaximized(function (win) {\r\n                    if (win.id === id && win.state === \"maximized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function restore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.restore(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"normal\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onNormal(function (win) {\r\n                    if (id === win.id && win.state === \"normal\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function minimize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.minimize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"minimized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMinimized(function (win) {\r\n                    if (id === win.id && win.state === \"minimized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        return resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function collapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.collapse(resultWindow)\r\n                .then(function () {\r\n                if (isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onCollapsed(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function expand(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (!isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.expand(resultWindow)\r\n                .then(function () {\r\n                if (!isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onExpanded(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function toggleCollapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = isCollapsed ? onExpanded : onCollapsed;\r\n            executor.toggleCollapse(resultWindow)\r\n                .then(function () {\r\n                currEvent(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function snap(target, direction, success, error) {\r\n        var targetWindowGroup;\r\n        if (!target) {\r\n            return Promise.reject(\"Please specify a target window! calledWith: \" + target);\r\n        }\r\n        if (typeof target === \"string\") {\r\n            var targetWindow = windowStore.get(target);\r\n            if (!targetWindow) {\r\n                return Promise.reject(new Error(\"Invalid target parameter or no such window. Invoked with:  \" + target));\r\n            }\r\n            targetWindowGroup = targetWindow.API.group;\r\n        }\r\n        else {\r\n            targetWindowGroup = target.group;\r\n        }\r\n        return Promise.all([\r\n            waitForMyWindowToJoinTargetGroup(targetWindowGroup),\r\n            executor.snap(resultWindow, target, direction)\r\n        ])\r\n            .then(function () {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return resultWindow;\r\n        })\r\n            .catch(function (e) {\r\n            if (typeof error === \"function\") {\r\n                error(e);\r\n            }\r\n            return e;\r\n        });\r\n    }\r\n    function waitForMyWindowToJoinTargetGroup(targetGroup) {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = targetGroup.onWindowAdded(function (_, window) {\r\n                if (resultWindow.id === window.id) {\r\n                    unsub();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function attachTab(tab, index, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId;\r\n            var targetWindowId = resultWindow.id;\r\n            var errorMessage = \"Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!tab) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof tab === \"string\") {\r\n                sourceWindowId = tab;\r\n            }\r\n            else if (typeof tab.id !== \"undefined\") {\r\n                sourceWindowId = tab.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var argsForSend = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (index) {\r\n                argsForSend.index = index;\r\n            }\r\n            var sourceWin = windowStore.get(argsForSend.sourceWindowId).API;\r\n            var un = sourceWin.onAttached(function (win) {\r\n                if (win.id === sourceWin.id) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    un();\r\n                    resolve(resultWindow);\r\n                }\r\n            });\r\n            executor.attachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                un();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function detachTab(opt, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var argsForSend = { windowId: resultWindow.id };\r\n            var _options = opt || {};\r\n            if (typeof _options.relativeTo !== \"undefined\") {\r\n                if (typeof _options.relativeTo === \"string\") {\r\n                    argsForSend.relativeTo = _options.relativeTo;\r\n                }\r\n                else if (typeof _options.relativeTo.id !== \"undefined\") {\r\n                    argsForSend.relativeTo = _options.relativeTo.id;\r\n                }\r\n                if (typeof _options.relativeDirection !== \"undefined\") {\r\n                    argsForSend.relativeDirection = _options.relativeDirection;\r\n                }\r\n                if (typeof _options.width !== \"undefined\") {\r\n                    argsForSend.width = _options.width;\r\n                }\r\n                if (typeof _options.height !== \"undefined\") {\r\n                    argsForSend.height = _options.height;\r\n                }\r\n            }\r\n            if (typeof _options.bounds !== \"undefined\") {\r\n                argsForSend.bounds = _options.bounds;\r\n            }\r\n            if (typeof _options.hideTabHeader !== \"undefined\") {\r\n                argsForSend.hideTabHeader = _options.hideTabHeader;\r\n            }\r\n            var visibilityChangeHeard = false;\r\n            var detachedHeard = false;\r\n            var unVisibility = _registry.add(\"frame-attached\", (function (win) {\r\n                var isVisibilityCorrect = _options.hideTabHeader === undefined || _options.hideTabHeader !== win.isTabHeaderVisible;\r\n                if (id === win.id && isVisibilityCorrect) {\r\n                    visibilityChangeHeard = true;\r\n                    unVisibility();\r\n                    if (detachedHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unDetached === \"function\") {\r\n                            unDetached();\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n            var unDetached = onDetached(function (win) {\r\n                if (id === win.id) {\r\n                    detachedHeard = true;\r\n                    unDetached();\r\n                    if (visibilityChangeHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unVisibility === \"function\") {\r\n                            unVisibility();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            executor.detachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                unDetached();\r\n                unVisibility();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setVisible(toBeVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setVisible(resultWindow, toBeVisible)\r\n                .then(function () {\r\n                var isVisibilityCorrect = toBeVisible === undefined ? _isVisible === true : _isVisible === toBeVisible;\r\n                if (isVisibilityCorrect) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onVisibilityChanged(function (win) {\r\n                    isVisibilityCorrect = toBeVisible === undefined ? win.isVisible === true : win.isVisible === toBeVisible;\r\n                    if (win.id === id && isVisibilityCorrect) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function showLoader(loader) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.showLoader(resultWindow, loader)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideLoader() {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.hideLoader(resultWindow)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function updateContext(context, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.updateContext(resultWindow, context)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function lock(success, error) {\r\n        if (resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.lock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function unlock(success, error) {\r\n        if (!resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.unlock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function waitForLockingChanged() {\r\n        return new Promise(function (resolve) {\r\n            var un = onLockingChanged(function (window) {\r\n                if (window.id === resultWindow.id) {\r\n                    un();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function getIcon(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.getIcon(resultWindow)\r\n                .then(function (icon) {\r\n                if (typeof success === \"function\") {\r\n                    success(icon);\r\n                }\r\n                resolve(icon);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setIcon(base64Image, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setIcon(resultWindow, base64Image)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setFrameColor(frameColor, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setFrameColor(resultWindow, frameColor)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabHeaderVisible(toBeTabHeaderVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTabHeaderVisible(resultWindow, toBeTabHeaderVisible)\r\n                .then(function () {\r\n                if (_isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onTabHeaderVisibilityChanged(function (win) {\r\n                    if (win.id === id && win.isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabTooltip(tooltip) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                if (!tooltip) {\r\n                    throw new Error(tooltip + \" is null or undefined\");\r\n                }\r\n                return [2, executor.setTabTooltip(resultWindow, tooltip)];\r\n            });\r\n        });\r\n    }\r\n    function showPopup(config) {\r\n        return executor.showPopup(resultWindow, config);\r\n    }\r\n    function createFlydown(config) {\r\n        return executor.createFlydown(resultWindow.id, config);\r\n    }\r\n    function setModalState(isModal) {\r\n        return executor.setModalState(resultWindow.id, isModal || false);\r\n    }\r\n    function zoomIn(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomIn(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function zoomOut(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomOut(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function setZoomFactor(zoomFactor, success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            if (isNaN(zoomFactor)) {\r\n                throw new Error(\"zoomFactor is not a number\");\r\n            }\r\n            return executor.setZoomFactor(resultWindow, zoomFactor);\r\n        }, success, error);\r\n    }\r\n    function showDevTools() {\r\n        return executor.showDevTools(resultWindow);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.capture(resultWindow, captureOptions);\r\n    }\r\n    function flash(suppliedOptions) {\r\n        var flashOptions = {\r\n            shouldFlash: true\r\n        };\r\n        if (typeof suppliedOptions === \"boolean\") {\r\n            flashOptions.shouldFlash = suppliedOptions;\r\n        }\r\n        return executor.flash(resultWindow, flashOptions);\r\n    }\r\n    function onTitleChanged(callback) {\r\n        callback(resultWindow.title, resultWindow);\r\n        return _registry.add(\"onTitleChanged\", callback);\r\n    }\r\n    function onClose(callback) {\r\n        return _registry.add(\"onClose\", callback);\r\n    }\r\n    function onUrlChanged(callback) {\r\n        return _registry.add(\"onUrlChanged\", callback);\r\n    }\r\n    function onFrameButtonAdded(callback) {\r\n        return _registry.add(\"onFrameButtonAdded\", callback);\r\n    }\r\n    function onFrameButtonRemoved(callback) {\r\n        return _registry.add(\"onFrameButtonRemoved\", callback);\r\n    }\r\n    function onFrameButtonClicked(callback) {\r\n        return _registry.add(\"onFrameButtonClicked\", callback);\r\n    }\r\n    function onCollapsed(callback) {\r\n        if (isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"collapsed\", callback);\r\n    }\r\n    function onExpanded(callback) {\r\n        if (!isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"expanded\", callback);\r\n    }\r\n    function onMaximized(callback) {\r\n        if (_windowState === \"maximized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"maximized\", callback);\r\n    }\r\n    function onMinimized(callback) {\r\n        if (_windowState === \"minimized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"minimized\", callback);\r\n    }\r\n    function onNormal(callback) {\r\n        if (_windowState === \"normal\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"normal\", callback);\r\n    }\r\n    function onAttached(callback) {\r\n        return _registry.add(\"attached\", callback);\r\n    }\r\n    function onDetached(callback) {\r\n        return _registry.add(\"detached\", callback);\r\n    }\r\n    function onVisibilityChanged(callback) {\r\n        return _registry.add(\"visibility-changed\", callback);\r\n    }\r\n    function onContextUpdated(callback) {\r\n        return _registry.add(\"context-updated\", callback);\r\n    }\r\n    function onLockingChanged(callback) {\r\n        return _registry.add(\"lock-changed\", callback);\r\n    }\r\n    function onBoundsChanged(callback) {\r\n        return _registry.add(\"bounds-changed\", callback);\r\n    }\r\n    function onFocusChanged(callback) {\r\n        return _registry.add(\"focus-changed\", callback);\r\n    }\r\n    function onFrameColorChanged(callback) {\r\n        return _registry.add(\"frame-color-changed\", callback);\r\n    }\r\n    function onTabHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"tab-header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAttached(callback) {\r\n        return _registry.add(\"window-attached\", callback);\r\n    }\r\n    function onWindowDetached(callback) {\r\n        return _registry.add(\"window-detached\", callback);\r\n    }\r\n    function onGroupChanged(callback) {\r\n        return _registry.add(\"group-changed\", callback);\r\n    }\r\n    function onTabSelectionChanged(callback) {\r\n        return _registry.add(\"tab-selection-changed\", callback);\r\n    }\r\n    function onClosing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error) {\r\n            var promise = callback();\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onClosing(callbackWrap, id);\r\n    }\r\n    function onRefreshing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error, prevent) {\r\n            var promise = callback(prevent);\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onRefreshing(callbackWrap, id);\r\n    }\r\n    function onZoomFactorChanged(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        return _registry.add(\"zoom-factor-changed\", callback);\r\n    }\r\n    function handleTitleChanged(newTitle) {\r\n        _title = newTitle;\r\n        _registry.execute(\"onTitleChanged\", newTitle, resultWindow);\r\n    }\r\n    function handleUrlChanged(newUrl) {\r\n        _url = newUrl;\r\n        _registry.execute(\"onUrlChanged\", newUrl, resultWindow);\r\n    }\r\n    function handleVisibilityChanged(isVisible) {\r\n        if (isVisible === _isVisible) {\r\n            return;\r\n        }\r\n        _isVisible = isVisible;\r\n        _registry.execute(\"visibility-changed\", resultWindow);\r\n    }\r\n    function handleWindowSettingsChanged(settings) {\r\n        _settings = settings;\r\n        _registry.execute(\"settings-changed\", resultWindow);\r\n    }\r\n    function handleContextUpdated(context) {\r\n        _context = context;\r\n        _registry.execute(\"context-updated\", _context, resultWindow);\r\n    }\r\n    function handleWindowClose() {\r\n        if (resultWindow.id === undefined) {\r\n            return;\r\n        }\r\n        resultWindow.id = undefined;\r\n        _registry.execute(\"onClose\", resultWindow);\r\n    }\r\n    function handleFrameButtonAdded(frameButton) {\r\n        var buttonObj = [\"buttonId\", \"imageBase64\", \"order\", \"tooltip\"].reduce(function (memo, k) {\r\n            memo[k] = frameButton[k];\r\n            return memo;\r\n        }, {});\r\n        var frameButtonsIds = _frameButtons.map(function (btn) {\r\n            return btn.buttonId;\r\n        });\r\n        if (frameButtonsIds.indexOf(frameButton.buttonId) === -1) {\r\n            _frameButtons.push(buttonObj);\r\n        }\r\n        _registry.execute(\"onFrameButtonAdded\", buttonObj, resultWindow);\r\n    }\r\n    function handleFrameButtonRemoved(frameButtonId) {\r\n        var button;\r\n        _frameButtons = _frameButtons.reduce(function (memo, btn) {\r\n            if (btn.buttonId === frameButtonId) {\r\n                button = btn;\r\n            }\r\n            else {\r\n                memo.push(btn);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (button !== undefined) {\r\n            _registry.execute(\"onFrameButtonRemoved\", button, resultWindow);\r\n        }\r\n    }\r\n    function handleFrameButtonClicked(frameButton) {\r\n        var button = _frameButtons.filter(function (btn) {\r\n            return btn.buttonId === frameButton.buttonId;\r\n        });\r\n        if (button.length > 0) {\r\n            _registry.execute(\"onFrameButtonClicked\", button[0], resultWindow);\r\n        }\r\n    }\r\n    function handleWindowChangeState(state) {\r\n        if (state === \"collapsed\") {\r\n            isCollapsed = true;\r\n        }\r\n        else if (state === \"expanded\") {\r\n            isCollapsed = false;\r\n        }\r\n        else {\r\n            _windowState = state;\r\n        }\r\n        _registry.execute(state, resultWindow);\r\n    }\r\n    function handleFrameIsLockedChanged(isLocked) {\r\n        _isLocked = isLocked;\r\n        _registry.execute(\"lock-changed\", resultWindow);\r\n    }\r\n    function handleBoundsChanged(bounds) {\r\n        if (_bounds.top === bounds.top && _bounds.left === bounds.left && _bounds.width === bounds.width && _bounds.height === bounds.height) {\r\n            return;\r\n        }\r\n        _bounds.top = bounds.top;\r\n        _bounds.left = bounds.left;\r\n        _bounds.width = bounds.width;\r\n        _bounds.height = bounds.height;\r\n        _registry.execute(\"bounds-changed\", resultWindow);\r\n    }\r\n    function handleFocusChanged(isFocused) {\r\n        _focus = isFocused;\r\n        _registry.execute(\"focus-changed\", resultWindow);\r\n    }\r\n    function handleFrameColorChanged(frameColor) {\r\n        _frameColor = frameColor;\r\n        _registry.execute(\"frame-color-changed\", resultWindow);\r\n    }\r\n    function handleFrameAttached(tabGroupId, isTabHeaderVisible) {\r\n        _tabGroupId = tabGroupId;\r\n        _isTabHeaderVisible = isTabHeaderVisible;\r\n        _registry.execute(\"frame-attached\", resultWindow);\r\n    }\r\n    function handleCompositionChanged(neighbours, groupId) {\r\n        _neighbours = neighbours || {};\r\n        _groupId = groupId;\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(isGroupHeaderVisible) {\r\n        _isGroupHeaderVisible = isGroupHeaderVisible;\r\n    }\r\n    function handleTabHeaderVisibilityChanged(isTabHeaderVisible) {\r\n        if (_isTabHeaderVisible !== isTabHeaderVisible) {\r\n            _isTabHeaderVisible = isTabHeaderVisible;\r\n            _registry.execute(\"tab-header-visibility-changed\", resultWindow);\r\n        }\r\n    }\r\n    function handleFrameSelectionChanged(newWindow, prevWindow) {\r\n        var selectedWindow;\r\n        if (typeof newWindow !== \"undefined\" && newWindow === id) {\r\n            _isTabSelected = true;\r\n            selectedWindow = resultWindow;\r\n        }\r\n        else {\r\n            _isTabSelected = false;\r\n            selectedWindow = windowStore.get(newWindow) ? windowStore.get(newWindow).API : undefined;\r\n        }\r\n        var previousWindow = windowStore.get(prevWindow) ? windowStore.get(prevWindow).API : undefined;\r\n        if (_isTabSelected && previousWindow) {\r\n            var un_1 = previousWindow.onTabSelectionChanged(function (newWin, prevWin) {\r\n                if ((prevWin && prevWin.id) === previousWindow.id) {\r\n                    un_1();\r\n                    _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n        }\r\n    }\r\n    function handleAttached(newTabGroupId, tabHeaderVisible) {\r\n        _tabGroupId = newTabGroupId;\r\n        _isTabHeaderVisible = tabHeaderVisible;\r\n        _registry.execute(\"attached\", resultWindow);\r\n    }\r\n    function handleWindowAttached(win) {\r\n        _registry.execute(\"window-attached\", win);\r\n    }\r\n    function handleDetached(tabGroupId) {\r\n        _tabGroupId = tabGroupId;\r\n        var un = _registry.add(\"frame-attached\", function (win) {\r\n            if (win.id === id) {\r\n                un();\r\n                _registry.execute(\"detached\", resultWindow);\r\n            }\r\n        });\r\n    }\r\n    function handleWindowDetached(win) {\r\n        _registry.execute(\"window-detached\", win);\r\n    }\r\n    function handleZoomFactorChanged(zoomFactor) {\r\n        _zoomFactor = zoomFactor;\r\n        _registry.execute(\"zoom-factor-changed\", resultWindow);\r\n    }\r\n    function handleGroupChanged(newGroup, oldGroup) {\r\n        logger.trace(\"handle group changed to win: \" + id + \" with group id: \" + newGroup.id);\r\n        _group = newGroup;\r\n        _groupId = newGroup.id;\r\n        _registry.execute(\"group-changed\", resultWindow, newGroup, oldGroup);\r\n    }\r\n    function handleGroupAssociation(group) {\r\n        if (group) {\r\n            _logger.trace(\"setting group to win: \" + id + \" with group id: \" + group.id);\r\n        }\r\n        _group = group;\r\n    }\r\n    function getAllTabs() {\r\n        var allWindows = windowStore.list;\r\n        if (_mode.toLowerCase() !== \"tab\") {\r\n            return [];\r\n        }\r\n        return Object.keys(allWindows).reduce(function (memo, win) {\r\n            var window = allWindows[win];\r\n            if (window\r\n                && window.API.tabGroupId\r\n                && typeof window.API.tabGroupId !== \"undefined\"\r\n                && typeof resultWindow.tabGroupId !== \"undefined\"\r\n                && window.API.tabGroupId === resultWindow.tabGroupId) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function mapWindowIdsToWindowObjects(windowIdArr) {\r\n        return windowIdArr.reduce(function (memo, winId) {\r\n            var window = windowStore.get(winId);\r\n            if (window) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function getNeighboursByDirection(direction) {\r\n        var windowIds = _neighbours[direction];\r\n        if (typeof windowIds !== \"undefined\") {\r\n            return mapWindowIdsToWindowObjects(windowIds);\r\n        }\r\n    }\r\n    function getApplicationName() {\r\n        if (_context._APPLICATION_NAME) {\r\n            return _context._APPLICATION_NAME;\r\n        }\r\n        if (_context && _context._t42 && _context._t42.application) {\r\n            return _context._t42.application;\r\n        }\r\n        var info = getWindowInfo();\r\n        if (!info) {\r\n            return undefined;\r\n        }\r\n        return info.applicationName;\r\n    }\r\n    function getWindowInfo() {\r\n        if (typeof window.glue42gd !== \"undefined\" && window.glue42gd.getWindowInfo) {\r\n            var info = window.glue42gd.getWindowInfo(id);\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return info;\r\n            }\r\n        }\r\n    }\r\n    function areBoundsEqual(requested, current) {\r\n        var height = requested.height;\r\n        var width = requested.width;\r\n        if (requested.height < _settings.minHeight) {\r\n            height = _settings.minHeight;\r\n        }\r\n        if (requested.height > _settings.maxHeight) {\r\n            height = _settings.maxHeight;\r\n        }\r\n        if (requested.width < _settings.minWidth) {\r\n            width = _settings.minWidth;\r\n        }\r\n        if (requested.width > _settings.maxWidth) {\r\n            width = _settings.maxWidth;\r\n        }\r\n        var areHeightsEqual = height ? current.height === height : true;\r\n        var areWidthsEqual = width ? current.width === width : true;\r\n        var areLeftsEqual = requested.left ? current.left === requested.left : true;\r\n        var areTopsEqual = requested.top ? current.top === requested.top : true;\r\n        return areHeightsEqual && areWidthsEqual && areLeftsEqual && areTopsEqual;\r\n    }\r\n    resultWindow = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get application() {\r\n            var appManager = appManagerGetter();\r\n            return appManager ? appManager.application(getApplicationName()) : undefined;\r\n        },\r\n        get hostInstance() {\r\n            return executor.hostInstance;\r\n        },\r\n        get agmInstance() {\r\n            var _this = this;\r\n            if (window.glue42gd) {\r\n                return agm.servers().find(function (s) { return s.windowId === _this.id; });\r\n            }\r\n            var appName = getApplicationName();\r\n            return appName ? { application: appName } : undefined;\r\n        },\r\n        get url() {\r\n            return _url;\r\n        },\r\n        id: id,\r\n        get title() {\r\n            return _title;\r\n        },\r\n        get windowStyleAttributes() {\r\n            return _settings;\r\n        },\r\n        get settings() {\r\n            return _settings;\r\n        },\r\n        get tabGroupId() {\r\n            return _mode.toLowerCase() === \"tab\" ? _tabGroupId : undefined;\r\n        },\r\n        get frameButtons() {\r\n            return _frameButtons;\r\n        },\r\n        get mode() {\r\n            return _mode;\r\n        },\r\n        get state() {\r\n            return _windowState;\r\n        },\r\n        get isCollapsed() {\r\n            return isCollapsed;\r\n        },\r\n        get isVisible() {\r\n            return _isVisible;\r\n        },\r\n        get isLocked() {\r\n            return _isLocked;\r\n        },\r\n        get context() {\r\n            return _context;\r\n        },\r\n        get bounds() {\r\n            return _bounds;\r\n        },\r\n        get minHeight() {\r\n            return _settings.minHeight;\r\n        },\r\n        get maxHeight() {\r\n            return _settings.maxHeight;\r\n        },\r\n        get minWidth() {\r\n            return _settings.minWidth;\r\n        },\r\n        get maxWidth() {\r\n            return _settings.maxWidth;\r\n        },\r\n        get isFocused() {\r\n            return _focus;\r\n        },\r\n        get frameColor() {\r\n            return _frameColor;\r\n        },\r\n        get opened() {\r\n            return resultWindow.id !== undefined;\r\n        },\r\n        get group() {\r\n            return _group;\r\n        },\r\n        get groupId() {\r\n            return _groupId;\r\n        },\r\n        get topNeighbours() {\r\n            return getNeighboursByDirection(\"top\");\r\n        },\r\n        get leftNeighbours() {\r\n            return getNeighboursByDirection(\"left\");\r\n        },\r\n        get rightNeighbours() {\r\n            return getNeighboursByDirection(\"right\");\r\n        },\r\n        get bottomNeighbours() {\r\n            return getNeighboursByDirection(\"bottom\");\r\n        },\r\n        get isGroupHeaderVisible() {\r\n            return _isGroupHeaderVisible;\r\n        },\r\n        get activityId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityId;\r\n        },\r\n        get activityWindowId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityWindowId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityWindowId;\r\n        },\r\n        get windowType() {\r\n            return options.windowType || \"electron\";\r\n        },\r\n        get zoomFactor() {\r\n            return _zoomFactor;\r\n        },\r\n        get screen() {\r\n            return Utils$1.getMonitor(resultWindow.bounds, window.glue42gd.monitors);\r\n        },\r\n        maximize: maximize,\r\n        restore: restore,\r\n        minimize: minimize,\r\n        maximizeRestore: maximizeRestore,\r\n        collapse: collapse,\r\n        expand: expand,\r\n        toggleCollapse: toggleCollapse,\r\n        focus: focus,\r\n        activate: activate,\r\n        moveResize: moveResize,\r\n        setTitle: setTitle,\r\n        setStyle: setStyle,\r\n        setOnTop: setOnTop,\r\n        resetButtons: resetButtons,\r\n        setSizeConstraints: setSizeConstraints,\r\n        navigate: navigate,\r\n        addFrameButton: addFrameButton,\r\n        removeFrameButton: removeFrameButton,\r\n        setVisible: setVisible,\r\n        show: function () { return setVisible(true); },\r\n        hide: function () { return setVisible(false); },\r\n        center: function (screen) { return moveResize(Utils$1.getDisplayCenterOfScreen(resultWindow.bounds, screen || resultWindow.screen)); },\r\n        close: close,\r\n        snap: snap,\r\n        showLoader: showLoader,\r\n        hideLoader: hideLoader,\r\n        updateContext: updateContext,\r\n        lock: lock,\r\n        unlock: unlock,\r\n        getIcon: getIcon,\r\n        setIcon: setIcon,\r\n        setFrameColor: setFrameColor,\r\n        setTabTooltip: setTabTooltip,\r\n        attachTab: attachTab,\r\n        detachTab: detachTab,\r\n        setTabHeaderVisible: setTabHeaderVisible,\r\n        showPopup: showPopup,\r\n        createFlydown: createFlydown,\r\n        setModalState: setModalState,\r\n        setZoomFactor: setZoomFactor,\r\n        zoomIn: zoomIn,\r\n        zoomOut: zoomOut,\r\n        showDevTools: showDevTools,\r\n        capture: capture,\r\n        flash: flash,\r\n        onClose: onClose,\r\n        onUrlChanged: onUrlChanged,\r\n        onTitleChanged: onTitleChanged,\r\n        onFrameButtonAdded: onFrameButtonAdded,\r\n        onFrameButtonRemoved: onFrameButtonRemoved,\r\n        onFrameButtonClicked: onFrameButtonClicked,\r\n        onCollapsed: onCollapsed,\r\n        onExpanded: onExpanded,\r\n        onMinimized: onMinimized,\r\n        onMaximized: onMaximized,\r\n        onNormal: onNormal,\r\n        onAttached: onAttached,\r\n        onDetached: onDetached,\r\n        onVisibilityChanged: onVisibilityChanged,\r\n        onContextUpdated: onContextUpdated,\r\n        onLockingChanged: onLockingChanged,\r\n        onBoundsChanged: onBoundsChanged,\r\n        onFrameColorChanged: onFrameColorChanged,\r\n        onFocusChanged: onFocusChanged,\r\n        onGroupChanged: onGroupChanged,\r\n        onWindowAttached: onWindowAttached,\r\n        onWindowDetached: onWindowDetached,\r\n        onTabSelectionChanged: onTabSelectionChanged,\r\n        onTabHeaderVisibilityChanged: onTabHeaderVisibilityChanged,\r\n        onClosing: onClosing,\r\n        onRefreshing: onRefreshing,\r\n        onZoomFactorChanged: onZoomFactorChanged,\r\n        get tabs() {\r\n            return getAllTabs();\r\n        },\r\n        get isTabHeaderVisible() {\r\n            return _isTabHeaderVisible;\r\n        },\r\n        get isTabSelected() {\r\n            return _isTabSelected;\r\n        },\r\n        getURL: function () {\r\n            return Promise.resolve(_url);\r\n        },\r\n        getTitle: function () {\r\n            return Promise.resolve(_title);\r\n        },\r\n        getBounds: function () {\r\n            return Promise.resolve(_bounds);\r\n        },\r\n        getContext: function () {\r\n            return Promise.resolve(_context);\r\n        },\r\n        setContext: function (context) {\r\n            return updateContext(context);\r\n        },\r\n        resizeTo: function (width, height) {\r\n            return moveResize({ width: width, height: height });\r\n        },\r\n        moveTo: function (top, left) {\r\n            return moveResize({ top: top, left: left });\r\n        },\r\n        getParentWindow: function () {\r\n            var _a;\r\n            return __awaiter$1(this, void 0, void 0, function () {\r\n                var myParentId;\r\n                return __generator$1(this, function (_b) {\r\n                    myParentId = _settings.parentInstanceId;\r\n                    if (!myParentId) {\r\n                        return [2, undefined];\r\n                    }\r\n                    return [2, (_a = windowStore.list[myParentId]) === null || _a === void 0 ? void 0 : _a.API];\r\n                });\r\n            });\r\n        },\r\n        getChildWindows: function () {\r\n            return __awaiter$1(this, void 0, void 0, function () {\r\n                return __generator$1(this, function (_a) {\r\n                    return [2, Object.keys(windowStore.list)\r\n                            .map(function (key) { return windowStore.list[key].API; })\r\n                            .filter(function (w) {\r\n                            var parentId = w.settings.parentInstanceId;\r\n                            return parentId === id;\r\n                        })];\r\n                });\r\n            });\r\n        }\r\n    };\r\n    var events = {\r\n        handleWindowClose: handleWindowClose,\r\n        handleWindowChangeState: handleWindowChangeState,\r\n        handleTitleChanged: handleTitleChanged,\r\n        handleVisibilityChanged: handleVisibilityChanged,\r\n        handleUrlChanged: handleUrlChanged,\r\n        handleWindowSettingsChanged: handleWindowSettingsChanged,\r\n        handleContextUpdated: handleContextUpdated,\r\n        handleFrameIsLockedChanged: handleFrameIsLockedChanged,\r\n        handleBoundsChanged: handleBoundsChanged,\r\n        handleFocusChanged: handleFocusChanged,\r\n        handleFrameButtonAdded: handleFrameButtonAdded,\r\n        handleFrameButtonRemoved: handleFrameButtonRemoved,\r\n        handleFrameButtonClicked: handleFrameButtonClicked,\r\n        handleFrameColorChanged: handleFrameColorChanged,\r\n        handleFrameAttached: handleFrameAttached,\r\n        handleFrameSelectionChanged: handleFrameSelectionChanged,\r\n        handleCompositionChanged: handleCompositionChanged,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n        handleTabHeaderVisibilityChanged: handleTabHeaderVisibilityChanged,\r\n        handleGroupChanged: handleGroupChanged,\r\n        handleGroupAssociation: handleGroupAssociation,\r\n        handleAttached: handleAttached,\r\n        handleDetached: handleDetached,\r\n        handleWindowAttached: handleWindowAttached,\r\n        handleWindowDetached: handleWindowDetached,\r\n        handleZoomFactorChanged: handleZoomFactorChanged\r\n    };\r\n    return {\r\n        API: resultWindow,\r\n        Events: events,\r\n    };\r\n});\n\nvar GDExecutor = (function () {\r\n    function GDExecutor() {\r\n        this._registry = lib$2();\r\n    }\r\n    Object.defineProperty(GDExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    GDExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"close\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"navigate\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    url: newUrl\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var stylePromises, wait, toBeVisible, toolTip, maxWidth, maxHeight, minWidth, minHeight, allowClose, allowCollapse, allowLockUnlock, allowMaximize, allowMinimize;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        stylePromises = [];\r\n                        wait = function (promise) { return stylePromises.push(promise); };\r\n                        if (style.focus !== undefined && !resultWindow.isFocused) {\r\n                            wait(resultWindow.focus());\r\n                        }\r\n                        if (style.hidden !== undefined) {\r\n                            toBeVisible = !style.hidden;\r\n                            wait(resultWindow.setVisible(toBeVisible));\r\n                        }\r\n                        if (style.onTop !== undefined) {\r\n                            wait(resultWindow.setOnTop(style.onTop));\r\n                        }\r\n                        if (style.tabTooltip !== undefined || style.tabToolTip !== undefined) {\r\n                            toolTip = (_a = style.tabTooltip, (_a !== null && _a !== void 0 ? _a : style.tabToolTip));\r\n                            wait(resultWindow.setTabTooltip(toolTip));\r\n                        }\r\n                        maxWidth = style.maxWidth, maxHeight = style.maxHeight, minWidth = style.minWidth, minHeight = style.minHeight, allowClose = style.allowClose, allowCollapse = style.allowCollapse, allowLockUnlock = style.allowLockUnlock, allowMaximize = style.allowMaximize, allowMinimize = style.allowMinimize;\r\n                        wait(resultWindow.setSizeConstraints({ maxWidth: maxWidth, maxHeight: maxHeight, minWidth: minWidth, minHeight: minHeight }));\r\n                        wait(resultWindow.resetButtons({ allowClose: allowClose, allowCollapse: allowCollapse, allowLockUnlock: allowLockUnlock, allowMaximize: allowMaximize, allowMinimize: allowMinimize }));\r\n                        return [4, Promise.all(stylePromises)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setSizeConstraints = function (resultWindow, constraints) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setSizeConstraints\", {\r\n                windowId: resultWindow.id,\r\n                options: constraints\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabTooltip = function (w, tabToolTip) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setTabTooltip\", { windowId: w.id, options: { tabToolTip: tabToolTip } })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, w];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.resetButtons = function (resultWindow, buttonsConfig) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"resetButtons\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonsConfig\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setOnTop = function (resultWindow, onTop) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setOnTop\", {\r\n                windowId: resultWindow.id,\r\n                options: { onTop: onTop }\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    title: newTitle\r\n                }\r\n            };\r\n            _this.execute(\"setTitle\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"moveResize\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    bounds: dimensions\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"addButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonInfo\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"removeButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonId\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"activate\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"focus\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximizeRestore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"restore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"minimize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"collapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"expand\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"toggleCollapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" +\r\n                resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                targetWindowId: targetWindowId\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            _this.execute(\"snap\", {\r\n                windowId: resultWindow.id,\r\n                options: args\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.attachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"attachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.detachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"detachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        if (toBeVisible === void 0) { toBeVisible = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            var command;\r\n            if (toBeVisible) {\r\n                command = \"show\";\r\n            }\r\n            else {\r\n                command = \"hide\";\r\n            }\r\n            _this.execute(command, { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"showLoadingAnimation\", { windowId: resultWindow.id, options: loader })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"hideLoadingAnimation\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"updateContext\", {\r\n                windowId: resultWindow.id,\r\n                context: context,\r\n                replace: Object.keys(resultWindow.context).length > 0 ? false : true\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: true\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: false\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"getIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {}\r\n            })\r\n                .then(function (result) {\r\n                resolve(result.icon);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    dataURL: base64Image\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setFrameColor\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    frameColor: frameColor\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setTabHeaderVisible\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    toShow: toBeTabHeaderVisible\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showPopup = function (targetWindow, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var optionsCopy, reformatedOptions;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            return [2, Promise.reject(\"The options object is not valid!\")];\r\n                        }\r\n                        optionsCopy = __assign$1({}, options);\r\n                        if (!optionsCopy.targetLocation) {\r\n                            optionsCopy.targetLocation = \"bottom\";\r\n                        }\r\n                        reformatedOptions = __assign$1(__assign$1({}, optionsCopy), { popupBounds: optionsCopy.size, targetId: targetWindow.id, popupId: optionsCopy.windowId });\r\n                        return [4, this.execute(\"showPopupWindow\", {\r\n                                windowId: targetWindow.id,\r\n                                options: reformatedOptions\r\n                            })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, targetWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.createFlydown = function (windowId, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var optionsCopy, fullOptions;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                if (!options) {\r\n                    return [2, Promise.reject(\"The options object is not valid!\")];\r\n                }\r\n                optionsCopy = __assign$1({}, options);\r\n                if (!optionsCopy.horizontalOffset) {\r\n                    optionsCopy.horizontalOffset = 0;\r\n                }\r\n                if (!optionsCopy.verticalOffset) {\r\n                    optionsCopy.verticalOffset = 0;\r\n                }\r\n                fullOptions = this.reformatFlydownOptions(windowId, optionsCopy);\r\n                return [2, this.execute(\"setFlydownArea\", { windowId: windowId, options: fullOptions }).then(function () {\r\n                        var zoneIds = fullOptions.zones.map(function (z) { return z.id; });\r\n                        fullOptions.zones.forEach(function (z) {\r\n                            var callback = typeof (z.flydownSize) === \"function\" ?\r\n                                z.flydownSize : function () { return z.flydownSize; };\r\n                            if (options.size instanceof Function && z.flydownSize) {\r\n                                callback = function (data, cancel) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                                    var result;\r\n                                    return __generator$1(this, function (_a) {\r\n                                        switch (_a.label) {\r\n                                            case 0:\r\n                                                if (!(options.size instanceof Function)) return [3, 2];\r\n                                                return [4, options.size(data, cancel)];\r\n                                            case 1:\r\n                                                result = _a.sent();\r\n                                                _a.label = 2;\r\n                                            case 2:\r\n                                                if (!(z.flydownSize instanceof Function && z.flydownSize !== options.size)) return [3, 4];\r\n                                                return [4, z.flydownSize(data, cancel)];\r\n                                            case 3: return [2, (_a.sent()) || result];\r\n                                            case 4: return [2, result || z.flydownSize];\r\n                                        }\r\n                                    });\r\n                                }); };\r\n                            }\r\n                            _this._registry.clearKey(fullOptions.targetId + \"_\" + z.id);\r\n                            _this._registry.add(fullOptions.targetId + \"_\" + z.id, callback);\r\n                        });\r\n                        return {\r\n                            destroy: function () { return _this.clearFlydownArea(fullOptions.targetId, zoneIds); },\r\n                            options: optionsCopy\r\n                        };\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setModalState = function (windowId, isModal) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                return [2, this.execute(\"setModalState\", { windowId: windowId, options: { isModal: isModal } })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.handleFlydownBoundsRequested = function (targetId, data) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var cancelCallback, callbackData, responses, defaultResponse, response, responseOptions;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        cancelCallback = function () { return data.cancel = true; };\r\n                        callbackData = {\r\n                            zoneId: data.flydownId,\r\n                            flydownWindowBounds: data.flydownWindowBounds,\r\n                            flydownWindowId: data.flydownWindowId,\r\n                        };\r\n                        return [4, Promise.all(this._registry.execute(targetId + \"_\" + data.flydownId, callbackData, cancelCallback))];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        if (responses.length === 1) {\r\n                            defaultResponse = { height: 0, width: 0, top: 0, left: 0 };\r\n                            response = typeof (responses[0]) === \"object\" && !Array.isArray(responses[0]) ? responses[0] : defaultResponse;\r\n                            responseOptions = __assign$1(__assign$1({}, data), { flydownWindowBounds: response });\r\n                            return [2, responseOptions];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomIn = function (window) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomIn\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomOut = function (window) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomOut\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setZoomFactor = function (window, zoomFactor) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setZoomFactor\", {\r\n                            windowId: window.id,\r\n                            options: {\r\n                                zoomFactor: zoomFactor\r\n                            }\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showDevTools = function (window) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"showDevTools\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.capture = function (window, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureScreenshot\", { windowId: window.id, options: __assign$1({}, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.captureGroup = function (windowIds, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureGroupScreenshot\", { windowId: windowIds[0], options: __assign$1({ groupWindowIds: windowIds }, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.flash = function (resultWindow, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"flash\", { windowId: resultWindow.id, options: __assign$1({}, options) })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.execute = function (command, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var args = __assign$1(__assign$1({}, options), { command: command });\r\n            _this.agm\r\n                .invoke(\"T42.Wnd.Execute\", args, _this.agmTarget)\r\n                .then(function (i) {\r\n                if (i.returned && i.returned.errorMsg) {\r\n                    reject(i);\r\n                }\r\n                else {\r\n                    resolve(i.returned);\r\n                }\r\n            })\r\n                .catch(function (i) {\r\n                reject(i);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.execute(\"setGroupHeaderVisibility\", {\r\n            windowId: windowId,\r\n            options: {\r\n                toShow: toShow\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.getGroupTitle = function (windowId) {\r\n        return this.execute(\"getGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function (r) { return r.title; });\r\n    };\r\n    GDExecutor.prototype.setGroupTitle = function (windowId, title) {\r\n        return this.execute(\"setGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {\r\n                title: title\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.onClosing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addCloseHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.onRefreshing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addRefreshHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.reformatFlydownOptions = function (windowId, options) {\r\n        var assignGeneralIfUnassigned = function (zone, prop) {\r\n            if (options[prop] && (zone[prop] === undefined || zone[prop] === null)) {\r\n                var valueFromOptions = options[prop];\r\n                zone[prop] = valueFromOptions;\r\n            }\r\n        };\r\n        var zones = options.zones.map(function (z) {\r\n            assignGeneralIfUnassigned(z, \"windowId\");\r\n            assignGeneralIfUnassigned(z, \"targetLocation\");\r\n            if (options.size && (z.flydownSize === undefined || z.flydownSize === null)) {\r\n                z.flydownSize = options.size;\r\n            }\r\n            z.flydownBounds = z.flydownSize;\r\n            z.flydownId = z.windowId;\r\n            if (!z.targetLocation) {\r\n                z.targetLocation = \"bottom\";\r\n            }\r\n            return z;\r\n        });\r\n        return __assign$1(__assign$1({}, options), { zones: zones, targetId: windowId, flydownBounds: options.size, flydownActiveArea: options.activeArea });\r\n    };\r\n    GDExecutor.prototype.clearFlydownArea = function (windowId, areaIds) {\r\n        var _this = this;\r\n        return this.execute(\"clearFlydownWindowArea\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function () {\r\n            areaIds.forEach(function (id) {\r\n                _this._registry.clearKey(windowId + \"_\" + id);\r\n            });\r\n        });\r\n    };\r\n    return GDExecutor;\r\n}());\r\nvar executor = new GDExecutor();\n\nfunction getWindowsByTabGroupId(windowId, tabGroupId) {\r\n    var windows = windowStore.list;\r\n    return Object.keys(windows).reduce(function (memo, id) {\r\n        var win = windows[id];\r\n        if (win.API.tabGroupId === tabGroupId && win.API.id !== windowId) {\r\n            memo[id] = win;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\n\nvar GDEnvironment = (function () {\r\n    function GDEnvironment(agm, logger, appManagerGetter, instance, wndId) {\r\n        this._registry = lib$2();\r\n        this._waitTimeout = 10000;\r\n        this._agm = agm;\r\n        this._logger = logger.subLogger(\"gd-env\");\r\n        this._agmInstance = this.normalizeInstance(instance);\r\n        this._windowId = wndId;\r\n        this._appManagerGetter = appManagerGetter;\r\n    }\r\n    GDEnvironment.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof _this._agmInstance === \"undefined\") {\r\n                _this._agmInstance = \"best\";\r\n            }\r\n            _this._agm.registerAsync(\"T42.Wnd.OnEventWithResponse\", function (args, caller, success, err) {\r\n                _this.respondToEvent(args).then(success).catch(err);\r\n            });\r\n            var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n                _this._agm.subscribe(\"T42.Wnd.OnEvent\", {\r\n                    waitTimeoutMs: _this._waitTimeout,\r\n                    target: _this._agmInstance,\r\n                    onData: function (streamData) {\r\n                        _this.updateWindow(streamData.data, resolve);\r\n                    },\r\n                    onConnected: function (instance) {\r\n                        _this._agmInstance = _this.normalizeInstance(instance);\r\n                        executor.init(_this._agm, _this._agmInstance);\r\n                    }\r\n                }).catch(function (err) {\r\n                    reject(\"Can not subscribe for stream T42.Wnd.OnEvent. Err: \" + err);\r\n                });\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(GDEnvironment.prototype, \"executor\", {\r\n        get: function () {\r\n            return executor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDEnvironment.prototype.open = function (name, url, options, success, error) {\r\n        options = options || {};\r\n        var copyOptions = __assign$1({}, options);\r\n        if (name === undefined) {\r\n            error({ message: \"The name is undefined\" });\r\n            return;\r\n        }\r\n        if (copyOptions.relativeTo !== undefined && typeof copyOptions.relativeTo !== \"string\") {\r\n            copyOptions.relativeTo = copyOptions.relativeTo.id || \"\";\r\n        }\r\n        copyOptions.name = name;\r\n        copyOptions.url = url;\r\n        copyOptions.windowState = options.windowState || options.state;\r\n        delete copyOptions.state;\r\n        this._agm.invoke(\"T42.Wnd.Create\", copyOptions, this._agmInstance)\r\n            .then(function (message) {\r\n            if (message.returned !== undefined) {\r\n                var id = message.returned.id;\r\n                success(id);\r\n            }\r\n            else {\r\n                error({ message: \"failed to execute T42.Wnd.Create - unknown reason\" });\r\n            }\r\n        })\r\n            .catch(error);\r\n    };\r\n    GDEnvironment.prototype.createFlydown = function (windowId, options) {\r\n        return this.executor.createFlydown(windowId, options);\r\n    };\r\n    GDEnvironment.prototype.showPopup = function (windowId, options) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var window;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        window = windowStore.get(windowId);\r\n                        return [4, this.executor.showPopup(window.API, options)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDEnvironment.prototype.tabAttached = function (callback) {\r\n        return this._registry.add(\"tab-attached\", callback);\r\n    };\r\n    GDEnvironment.prototype.tabDetached = function (callback) {\r\n        return this._registry.add(\"tab-detached\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowFrameColorChanged = function (callback) {\r\n        return this._registry.add(\"frame-color-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onEvent = function (callback) {\r\n        return this._registry.add(\"window-event\", callback);\r\n    };\r\n    GDEnvironment.prototype.my = function () {\r\n        return this._windowId;\r\n    };\r\n    GDEnvironment.prototype.execute = function (command, windowId, options) {\r\n        return this._agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n            windowId: windowId,\r\n        });\r\n    };\r\n    GDEnvironment.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this._agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this._agmInstance);\r\n    };\r\n    GDEnvironment.prototype.onCompositionChanged = function (callback) {\r\n        return this._registry.add(\"composition-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onGroupHeaderVisibilityChanged = function (callback) {\r\n        return this._registry.add(\"group-header-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowGotFocus = function (callback) {\r\n        return this._registry.add(\"got-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowLostFocus = function (callback) {\r\n        return this._registry.add(\"lost-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.normalizeInstance = function (instance) {\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            application: instance.application,\r\n            machine: instance.machine,\r\n            user: instance.user,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.respondToEvent = function (args) {\r\n        if (args.type === \"ShowFlydownBoundsRequested\") {\r\n            return this.executor.handleFlydownBoundsRequested(args.data.windowId, args.data);\r\n        }\r\n        return Promise.reject(\"There isn't a handler for \" + args.type);\r\n    };\r\n    GDEnvironment.prototype.updateWindow = function (windowInfo, readyResolve) {\r\n        var _this = this;\r\n        var extendedStreamEvent = this.getExtendedStreamEvent(windowInfo);\r\n        if (windowInfo.type === \"Snapshot\") {\r\n            var windowInfoFullInfoEvent = windowInfo;\r\n            windowInfoFullInfoEvent.windows.forEach(function (w) {\r\n                var win = _this.createWindow(w.id, w);\r\n                windowStore.markReadyToShow(win.API.id);\r\n                _this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            });\r\n            readyResolve(this);\r\n            return;\r\n        }\r\n        if (windowInfo.type === \"Created\") {\r\n            var windowInfoCreatedEvent = windowInfo;\r\n            var win = this.createWindow(windowInfoCreatedEvent.windowId, windowInfoCreatedEvent.data || {});\r\n            windowStore.setReadyState(win.API.id);\r\n            this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            return;\r\n        }\r\n        var windowObjectAndEvents = windowStore.get(windowInfo.windowId);\r\n        if (!windowObjectAndEvents) {\r\n            this._logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n            return;\r\n        }\r\n        var theWindow = windowObjectAndEvents.API;\r\n        var theWindowEvents = windowObjectAndEvents.Events;\r\n        if (windowInfo.type === \"BoundsChanged\") {\r\n            var windowInfoBoundsChangedEvent = windowInfo;\r\n            theWindowEvents.handleBoundsChanged(windowInfoBoundsChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"UrlChanged\") {\r\n            var windowInfoUrlChangedEvent = windowInfo;\r\n            windowStore.setUrlChangedState(windowInfoUrlChangedEvent.windowId);\r\n            theWindowEvents.handleUrlChanged(windowInfoUrlChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"TitleChanged\") {\r\n            var windowInfoTitleChanged = windowInfo;\r\n            theWindowEvents.handleTitleChanged(windowInfoTitleChanged.data);\r\n        }\r\n        if (windowInfo.type === \"VisibilityChanged\") {\r\n            theWindowEvents.handleVisibilityChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ContextChanged\") {\r\n            theWindowEvents.handleContextUpdated(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"StateChanged\") {\r\n            theWindowEvents.handleWindowChangeState(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"FrameColorChanged\") {\r\n            theWindowEvents.handleFrameColorChanged(windowInfo.data);\r\n            this._registry.execute(\"frame-color-changed\", theWindow);\r\n        }\r\n        if (windowInfo.type === \"CompositionChanged\") {\r\n            var windowInfoCompositionChanged = windowInfo;\r\n            theWindowEvents.handleCompositionChanged(windowInfoCompositionChanged.data.neighbors, windowInfoCompositionChanged.data.groupId);\r\n            this._registry.execute(\"composition-changed\", windowInfoCompositionChanged.data);\r\n        }\r\n        if (windowInfo.type === \"GroupHeaderVisibilityChanged\") {\r\n            var info = windowInfo;\r\n            theWindowEvents.handleGroupHeaderVisibilityChanged(info.data.groupHeaderVisible);\r\n            this._registry.execute(\"group-header-changed\", info.data);\r\n        }\r\n        if (windowInfo.type === \"FocusChanged\") {\r\n            var windowInfoFocusChanged = windowInfo;\r\n            this.focusChanged(theWindowEvents, theWindow, windowInfoFocusChanged.data);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameChanged\") {\r\n            theWindowEvents.handleFrameAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            this._registry.execute(\"frame-changed\");\r\n        }\r\n        if (windowInfo.type === \"WindowFrameAdded\") {\r\n            theWindowEvents.handleAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            var winsToBeNotified_1 = getWindowsByTabGroupId(theWindow.id, windowInfo.data.frameId);\r\n            Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                var win = winsToBeNotified_1[id];\r\n                win.Events.handleWindowAttached(theWindow);\r\n            });\r\n            this._registry.execute(\"tab-attached\", theWindow, windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameRemoved\") {\r\n            var oldTabGroupId = theWindow.tabGroupId;\r\n            theWindowEvents.handleDetached(windowInfo.data.frameId);\r\n            var winsToBeNotified_2 = getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n            Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                var win = winsToBeNotified_2[id];\r\n                win.Events.handleWindowDetached(theWindow);\r\n            });\r\n            var un_1 = this._registry.add(\"frame-changed\", function () {\r\n                un_1();\r\n                _this._registry.execute(\"tab-detached\", theWindow, windowInfo.data.frameId, theWindow.tabGroupId);\r\n            });\r\n        }\r\n        if (windowInfo.type === \"TabHeaderVisibilityChanged\") {\r\n            theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"FrameSelectionChanged\") {\r\n            theWindowEvents.handleFrameSelectionChanged(windowInfo.data.newWindowId, windowInfo.data.prevWindowId);\r\n        }\r\n        if (windowInfo.type === \"ButtonClicked\") {\r\n            theWindowEvents.handleFrameButtonClicked(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonAdded\") {\r\n            theWindowEvents.handleFrameButtonAdded(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonRemoved\") {\r\n            theWindowEvents.handleFrameButtonRemoved(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"WindowZoomFactorChanged\") {\r\n            theWindowEvents.handleZoomFactorChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"Closed\") {\r\n            windowStore.remove(windowObjectAndEvents);\r\n            theWindowEvents.handleWindowClose();\r\n        }\r\n        if (windowInfo.type === \"FrameIsLockedChanged\") {\r\n            theWindowEvents.handleFrameIsLockedChanged(windowInfo.data);\r\n        }\r\n        this._registry.execute(\"window-event\", extendedStreamEvent);\r\n    };\r\n    GDEnvironment.prototype.createWindow = function (windowId, options) {\r\n        var windowObjAndEvents = windowFactory(windowId, this.mapToWindowConstructorOptions(options), executor, this._logger, this._appManagerGetter, this._agm);\r\n        windowStore.add(windowObjAndEvents);\r\n        return windowObjAndEvents;\r\n    };\r\n    GDEnvironment.prototype.focusChanged = function (theWindowEvents, theWindow, focus) {\r\n        theWindowEvents.handleFocusChanged(focus);\r\n        if (focus) {\r\n            this._registry.execute(\"got-focus\", theWindow);\r\n        }\r\n        else {\r\n            this._registry.execute(\"lost-focus\", theWindow);\r\n        }\r\n    };\r\n    GDEnvironment.prototype.mapToWindowConstructorOptions = function (args) {\r\n        return {\r\n            name: args.name,\r\n            context: args.context,\r\n            bounds: args.bounds,\r\n            url: args.url,\r\n            title: args.title,\r\n            isVisible: args.isVisible,\r\n            focus: args.isFocused,\r\n            state: args.state,\r\n            frameColor: args.frameColor,\r\n            groupId: args.groupId,\r\n            neighbours: args.neighbors,\r\n            isFocused: args.isFocused,\r\n            isGroupHeaderVisible: args.groupHeaderVisible,\r\n            isCollapsed: args.isCollapsed,\r\n            tabGroupId: args.frameId,\r\n            mode: args.mode,\r\n            isTabHeaderVisible: args.isTabHeaderVisible,\r\n            isTabSelected: args.isActiveTab,\r\n            settings: args.settings,\r\n            windowType: args.windowType,\r\n            zoomFactor: args.zoomFactor,\r\n            isLocked: args.isLocked,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.getExtendedStreamEvent = function (streamEvent) {\r\n        try {\r\n            var result = __assign$1({ state: streamEvent.type, windowName: windowStore.get(streamEvent.windowId).API.name }, streamEvent);\r\n            if (result.state === \"WindowFrameAdded\") {\r\n                result.state = \"TabAttached\";\r\n            }\r\n            if (result.state === \"StateChanged\") {\r\n                result.state = result.data.charAt(0).toUpperCase() + result.data.slice(1);\r\n            }\r\n            if (result.state === \"ButtonAdded\") {\r\n                result.state = \"FrameButtonAdded\";\r\n            }\r\n            if (result.state === \"ButtonRemoved\") {\r\n                result.state = \"FrameButtonRemoved\";\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            return streamEvent;\r\n        }\r\n    };\r\n    return GDEnvironment;\r\n}());\n\nvar envDetector = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _logger = logger;\r\n    return new Promise(function (resolve, reject) {\r\n        if (gdMajorVersion === 2) {\r\n            _logger.trace(\"running in HC\");\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (gdMajorVersion >= 3) {\r\n            _logger.trace(\"running in GD 3\");\r\n            var gd = new GDEnvironment(agm, _logger, appManagerGetter, undefined, window.glue42gd.windowId);\r\n            gd.init()\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else {\r\n            var gdPromise = new GDEnvironment(agm, _logger, appManagerGetter).init();\r\n            var wait = function (ms) { return new Promise(function (res, rej) { return setTimeout(function () { rej(\"timeout waiting for streams\"); }, ms); }); };\r\n            Promise.race([gdPromise, wait(10000)])\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n    });\r\n});\n\nvar groupFactory = (function (id, executor) {\r\n    var _registry = lib$2();\r\n    var _windowsId = [];\r\n    function addWindow(winId) {\r\n        if (_windowsId.indexOf(winId) === -1) {\r\n            _windowsId.push(winId);\r\n            var window_1 = windowStore.get(winId);\r\n            window_1.Events.handleGroupAssociation(groupObject);\r\n            _registry.execute(\"window-added\", groupObject, window_1.API);\r\n        }\r\n    }\r\n    function removeWindow(winId) {\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            _windowsId.splice(index, 1);\r\n            var window_2 = _mapToWindowObject(winId);\r\n            _registry.execute(\"window-removed\", groupObject, window_2);\r\n        }\r\n    }\r\n    function find(window, success) {\r\n        var winId;\r\n        if (typeof window === \"string\") {\r\n            winId = window;\r\n        }\r\n        else {\r\n            winId = window.id;\r\n        }\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            var mappedWindow = _mapToWindowObject(_windowsId[index]);\r\n            if (typeof success === \"function\") {\r\n                success(mappedWindow);\r\n            }\r\n            return mappedWindow;\r\n        }\r\n    }\r\n    function windows(success) {\r\n        var mappedWindows = _mapToWindowObjects();\r\n        if (typeof success === \"function\") {\r\n            success(mappedWindows);\r\n        }\r\n        return mappedWindows;\r\n    }\r\n    function showHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], true),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], false),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                return;\r\n            });\r\n        });\r\n    }\r\n    function getTitle() {\r\n        return executor.getGroupTitle(_windowsId[0]);\r\n    }\r\n    function setTitle(title) {\r\n        return executor.setGroupTitle(_windowsId[0], title);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.captureGroup(_windowsId, captureOptions);\r\n    }\r\n    function waitForHeaderVisibilityChanged() {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = onHeaderVisibilityChanged(function (group) {\r\n                unsub();\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n    function execute(command, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.execute(command, options)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(windowInfo) {\r\n        _registry.execute(\"header-visibility-changed\", groupObject);\r\n    }\r\n    function _mapToWindowObjects() {\r\n        var winObjects = [];\r\n        _windowsId.forEach(function (winId) {\r\n            var windowObject = _mapToWindowObject(winId);\r\n            if (typeof windowObject !== \"undefined\") {\r\n                winObjects.push(windowObject);\r\n            }\r\n        });\r\n        return winObjects;\r\n    }\r\n    function _mapToWindowObject(windowId) {\r\n        return windowStore.get(windowId) ? windowStore.get(windowId).API : undefined;\r\n    }\r\n    function _getGroupHeaderVisibility() {\r\n        var windowWithHiddenHeader = _mapToWindowObjects().find(function (w) { return !w.isGroupHeaderVisible; });\r\n        var _isGroupHeaderVisible = windowWithHiddenHeader === undefined;\r\n        return _isGroupHeaderVisible;\r\n    }\r\n    function onHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function onWindowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    var groupObject = {\r\n        id: id,\r\n        get windows() {\r\n            return windows();\r\n        },\r\n        find: find,\r\n        get isHeaderVisible() {\r\n            return _getGroupHeaderVisibility();\r\n        },\r\n        showHeader: showHeader,\r\n        hideHeader: hideHeader,\r\n        getTitle: getTitle,\r\n        setTitle: setTitle,\r\n        capture: capture,\r\n        maximize: function (success, error) {\r\n            return execute(\"maximize\", { groupId: id }, success);\r\n        },\r\n        restore: function (success, error) {\r\n            return execute(\"restore\", { groupId: id }, success);\r\n        },\r\n        onHeaderVisibilityChanged: onHeaderVisibilityChanged,\r\n        onWindowAdded: onWindowAdded,\r\n        onWindowRemoved: onWindowRemoved,\r\n    };\r\n    var internal = {\r\n        addWindow: addWindow,\r\n        removeWindow: removeWindow,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n    };\r\n    return {\r\n        groupAPI: groupObject,\r\n        groupInternal: internal,\r\n    };\r\n});\n\nvar groupsFactory = (function (environment, logger) {\r\n    var _logger = logger.subLogger(\"groups\");\r\n    var _registry = lib$2();\r\n    var _groups = {};\r\n    var heardForWindowsCounter = -1;\r\n    var windows = windowStore.list;\r\n    Object.keys(windows).forEach(function (k) {\r\n        addNewWindow(windows[k]);\r\n    });\r\n    environment.onCompositionChanged(function (windowInfo) {\r\n        handleCompositionChanged(windowInfo);\r\n    });\r\n    environment.onGroupHeaderVisibilityChanged(function (windowInfo) {\r\n        var windowId = windowInfo.windowId;\r\n        var group = findGroupByWindow(windowId);\r\n        if (typeof group !== \"undefined\") {\r\n            var groupEvents = _groups[group.id];\r\n            if (heardForWindowsCounter === -1) {\r\n                heardForWindowsCounter = group.windows.length;\r\n            }\r\n            heardForWindowsCounter--;\r\n            if (heardForWindowsCounter === 0) {\r\n                heardForWindowsCounter = -1;\r\n                groupEvents.groupInternal.handleGroupHeaderVisibilityChanged(windowInfo);\r\n            }\r\n        }\r\n    });\r\n    windowStore.onAdded(function (win) {\r\n        addNewWindow(win);\r\n    });\r\n    windowStore.onRemoved(function (win) {\r\n        removeWindow(win);\r\n    });\r\n    function my() {\r\n        return findGroupByWindow(environment.my());\r\n    }\r\n    function list(success) {\r\n        var result = Object.keys(_groups).map(function (groupId) {\r\n            if (_groups[groupId]) {\r\n                return _groups[groupId].groupAPI;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(result);\r\n        }\r\n        return result;\r\n    }\r\n    function findGroupByWindow(winId, success) {\r\n        var windowId;\r\n        if (typeof winId === \"undefined\") {\r\n            logger.debug(\"trying to find a group by a window, but winId is undefined\");\r\n            return;\r\n        }\r\n        if (typeof winId === \"string\") {\r\n            windowId = winId;\r\n        }\r\n        else {\r\n            windowId = winId.id;\r\n        }\r\n        var groupFound;\r\n        Object.keys(_groups).forEach(function (groupId) {\r\n            var group = _groups[groupId].groupAPI;\r\n            if (group.find(windowId) !== undefined) {\r\n                groupFound = group;\r\n                return;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(groupFound);\r\n        }\r\n        return groupFound;\r\n    }\r\n    function onWindowMoved(callback) {\r\n        return _registry.add(\"window-moved\", callback);\r\n    }\r\n    function createOrGetGroup(groupId) {\r\n        if (!_groups.hasOwnProperty(groupId)) {\r\n            var createdGroup = groupFactory(groupId, environment.executor);\r\n            _groups[groupId] = createdGroup;\r\n            return createdGroup;\r\n        }\r\n        else {\r\n            return _groups[groupId];\r\n        }\r\n    }\r\n    function deleteGroup(groupId) {\r\n        if (_groups.hasOwnProperty(groupId) && typeof _groups[groupId] !== \"undefined\") {\r\n            if (_groups[groupId].groupAPI.windows.length === 0) {\r\n                delete _groups[groupId];\r\n            }\r\n        }\r\n    }\r\n    function addNewWindow(win) {\r\n        _logger.trace(\"Adding new window \" + win.API.id + \" to win.API.groupId \" + win.API.groupId);\r\n        var group = addWindow(win);\r\n        if (group) {\r\n            _logger.trace(\"handleGroupAssociation \" + win.API.id + \" to group.groupAPI.id \" + group.groupAPI.id);\r\n            win.Events.handleGroupAssociation(group.groupAPI);\r\n        }\r\n    }\r\n    function addWindow(win, groupId) {\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        var windowId = win.API.id;\r\n        if (typeof windowGroupId === \"undefined\" || typeof windowId === \"undefined\") {\r\n            _logger.debug(\"trying to add a window without group - winId: \" + windowId);\r\n            return;\r\n        }\r\n        var group = createOrGetGroup(windowGroupId);\r\n        group.groupInternal.addWindow(windowId);\r\n        return group;\r\n    }\r\n    function removeWindow(win, groupId) {\r\n        var windowId = win.API.id;\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        if (typeof windowGroupId !== \"undefined\") {\r\n            var group = _groups[windowGroupId];\r\n            group.groupInternal.removeWindow(windowId);\r\n            win.Events.handleGroupAssociation(undefined);\r\n            deleteGroup(windowGroupId);\r\n        }\r\n    }\r\n    function handleCompositionChanged(windowInfo) {\r\n        var newGroupId = windowInfo.groupId;\r\n        var windowId = windowInfo.windowId;\r\n        var oldGroup = findGroupByWindow(windowId);\r\n        var oldGroupId = oldGroup ? oldGroup.id : undefined;\r\n        _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId);\r\n        if (oldGroupId === newGroupId) {\r\n            _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId + \" are the same - returning...\");\r\n            return;\r\n        }\r\n        var win = windowStore.get(windowId) || windowStore.get(windowId);\r\n        var newGroup = addWindow(win, newGroupId);\r\n        if (oldGroup) {\r\n            removeWindow(win, oldGroupId);\r\n            _registry.execute(\"window-moved\", windowId, oldGroup, newGroupId);\r\n        }\r\n        win.Events.handleGroupChanged(newGroup.groupAPI, oldGroup);\r\n    }\r\n    var groups = {\r\n        get my() {\r\n            return my();\r\n        },\r\n        list: list,\r\n        findGroupByWindow: findGroupByWindow,\r\n    };\r\n    var events = { onWindowMoved: onWindowMoved };\r\n    return {\r\n        groupsAPI: groups,\r\n        groupsEvents: events,\r\n    };\r\n});\n\nvar WindowsFactory = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _registry = lib$2();\r\n    var _logger = logger;\r\n    var groups;\r\n    var environment;\r\n    windowStore.init(_logger);\r\n    var isReady = new Promise(function (resolve, reject) {\r\n        envDetector(agm, _logger, appManagerGetter, gdMajorVersion)\r\n            .then(function (env) {\r\n            environment = env;\r\n            groups = groupsFactory(env, _logger);\r\n            resolve();\r\n        })\r\n            .catch(function (e) {\r\n            var err = \"Environment detector fails with: \" + e;\r\n            _logger.error(err);\r\n            reject(err);\r\n        });\r\n    });\r\n    function ready() {\r\n        return isReady;\r\n    }\r\n    function my() {\r\n        var myWindow = windowStore.getIfReady(environment.my());\r\n        return myWindow ? myWindow.API : undefined;\r\n    }\r\n    function open(name, url, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var errorHandler = function (errorResponse) {\r\n                if (typeof error === \"function\") {\r\n                    error(errorResponse);\r\n                }\r\n                reject(errorResponse);\r\n            };\r\n            var successHandler = function (id) {\r\n                windowStore.waitFor(id)\r\n                    .then(function (win) {\r\n                    if (typeof success === \"function\") {\r\n                        success(win.API);\r\n                    }\r\n                    resolve(win.API);\r\n                    if (win.API.windowType === \"electron\") {\r\n                        win.Events.handleUrlChanged(win.API.url);\r\n                    }\r\n                })\r\n                    .catch(errorHandler);\r\n            };\r\n            environment.open(name, url, options, successHandler, errorHandler);\r\n        });\r\n    }\r\n    function find(name, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (window && window.API.name === name) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with name:\" + name);\r\n            }\r\n        }\r\n    }\r\n    function findById(id, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (typeof window !== \"undefined\" && window.API.id === id) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with such id:\" + id);\r\n            }\r\n        }\r\n    }\r\n    function list(success) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows)\r\n            .map(function (k) {\r\n            return windows[k].API;\r\n        });\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing;\r\n        }\r\n        success(windowsForListing);\r\n    }\r\n    function windowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function windowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    function tabAttached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabAttached(callback);\r\n        });\r\n    }\r\n    function tabDetached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabDetached(callback);\r\n        });\r\n    }\r\n    function onWindowFrameColorChanged(callback) {\r\n        return isReady.then(function () {\r\n            return environment.onWindowFrameColorChanged(callback);\r\n        });\r\n    }\r\n    function onWindowGotFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowGotFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onWindowLostFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowLostFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onEvent(callback) {\r\n        var unsubFunc;\r\n        var unsubscribed = false;\r\n        isReady.then(function () {\r\n            if (unsubscribed) {\r\n                return;\r\n            }\r\n            unsubFunc = environment.onEvent(callback);\r\n        });\r\n        return function () {\r\n            unsubscribed = true;\r\n            if (unsubFunc) {\r\n                unsubFunc();\r\n            }\r\n        };\r\n    }\r\n    function createFlydown(targetId, config) {\r\n        return environment.createFlydown(targetId, config);\r\n    }\r\n    function showPopup(targetId, config) {\r\n        return environment.showPopup(targetId, config);\r\n    }\r\n    function handleWindowAdded(w) {\r\n        _registry.execute(\"window-added\", w.API);\r\n    }\r\n    function handleWindowRemoved(w) {\r\n        _registry.execute(\"window-removed\", w.API);\r\n    }\r\n    windowStore.onReadyWindow(handleWindowAdded);\r\n    windowStore.onRemoved(handleWindowRemoved);\r\n    return {\r\n        my: my,\r\n        open: open,\r\n        find: find,\r\n        findById: findById,\r\n        list: list,\r\n        ready: ready,\r\n        onWindowAdded: windowAdded,\r\n        windowAdded: windowAdded,\r\n        onWindowRemoved: windowRemoved,\r\n        windowRemoved: windowRemoved,\r\n        onTabAttached: tabAttached,\r\n        onTabDetached: tabDetached,\r\n        onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n        get groups() {\r\n            return groups.groupsAPI;\r\n        },\r\n        onWindowGotFocus: onWindowGotFocus,\r\n        onWindowLostFocus: onWindowLostFocus,\r\n        onEvent: onEvent,\r\n        createFlydown: createFlydown,\r\n        showPopup: showPopup\r\n    };\r\n});\n\nvar LayoutStore = (function () {\r\n    function LayoutStore() {\r\n        this.layouts = [];\r\n    }\r\n    LayoutStore.prototype.removeWhere = function (condition) {\r\n        this.layouts = this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.add = function (item) {\r\n        this.layouts.push(item);\r\n    };\r\n    Object.defineProperty(LayoutStore.prototype, \"all\", {\r\n        get: function () {\r\n            return this.layouts;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LayoutStore.prototype.where = function (condition) {\r\n        return this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.first = function (condition) {\r\n        return this.where(condition)[0];\r\n    };\r\n    return LayoutStore;\r\n}());\r\nvar store = new LayoutStore();\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$3(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$3,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode$1(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1$1 = encode$1;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode$1(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1$1 = decode$1;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1$1(alphabet_1$1.lookup, version$1);\n    str = str + encode_1$1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1$1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1$1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$3 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1$1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1$1 = lib$3.generate;\nvar lib_2$1 = lib$3.seed;\nvar lib_3$1 = lib$3.worker;\nvar lib_4$1 = lib$3.characters;\nvar lib_5$1 = lib$3.decode;\nvar lib_6$1 = lib$3.isValid;\n\nvar shortid$1 = lib$3;\n\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\nvar ContextProvider = (function () {\r\n    function ContextProvider(agm, activitiesGetter, callbacks) {\r\n        this.agm = agm;\r\n        this.activitiesGetter = activitiesGetter;\r\n        this.callbacks = callbacks;\r\n        this.registeredRequestsMethods = false;\r\n    }\r\n    ContextProvider.prototype.onSaveRequested = function (callback) {\r\n        if (!this.registeredRequestsMethods) {\r\n            this.registerRequestMethods();\r\n            this.registeredRequestsMethods = true;\r\n        }\r\n        return this.callbacks.add(\"saveRequested\", callback);\r\n    };\r\n    ContextProvider.prototype.isActivityOwner = function () {\r\n        if (typeof htmlContainer !== \"undefined\") {\r\n            var context_1 = htmlContainer.getContext();\r\n            return context_1 && context_1._t42 && context_1._t42.activityIsOwner;\r\n        }\r\n        var activities = this.activitiesGetter();\r\n        if (!activities) {\r\n            return false;\r\n        }\r\n        if (!activities.inActivity) {\r\n            return false;\r\n        }\r\n        var myWindow = activities.my.window;\r\n        var myActivity = activities.my.activity;\r\n        if (!myActivity && !myWindow) {\r\n            return false;\r\n        }\r\n        return myActivity.owner.id === myWindow.id;\r\n    };\r\n    ContextProvider.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.agm.register(SaveContextMethodName, function (args) {\r\n            var requestResult = _this.callbacks.execute(\"saveRequested\", args)[0];\r\n            if (!requestResult) {\r\n                return {};\r\n            }\r\n            requestResult.activityContext = requestResult.activityContext || {};\r\n            requestResult.windowContext = requestResult.windowContext || {};\r\n            var result = { windowContext: requestResult.windowContext, activityContext: undefined };\r\n            if (_this.isActivityOwner()) {\r\n                result.activityContext = requestResult.activityContext;\r\n            }\r\n            return result;\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\n\nfunction transformACSLayout(something) {\r\n    if (!something) {\r\n        return something;\r\n    }\r\n    if (Array.isArray(something)) {\r\n        return something.map(function (item) {\r\n            return transformACSLayout(item);\r\n        });\r\n    }\r\n    if (typeof something === \"string\" || typeof something === \"number\" || typeof something === \"boolean\") {\r\n        return something;\r\n    }\r\n    var initial = {};\r\n    return Object.keys(something).reduce(function (accumulator, current) {\r\n        var value = something[current];\r\n        var convertedValue = transformACSLayout(value);\r\n        var key = current;\r\n        if (current[0].toLowerCase() !== current[0]) {\r\n            key = current[0].toLowerCase() + current.substr(1);\r\n        }\r\n        accumulator[key] = convertedValue;\r\n        return accumulator;\r\n    }, initial);\r\n}\n\nvar LayoutImpl = (function () {\r\n    function LayoutImpl(data) {\r\n        this.name = data.name;\r\n        this.type = data.type;\r\n        this.components = data.components;\r\n        this.context = data.context;\r\n        this.metadata = data.metadata;\r\n    }\r\n    return LayoutImpl;\r\n}());\n\nvar LayoutsAPIImpl = (function () {\r\n    function LayoutsAPIImpl(config, stream, callbacks) {\r\n        this.config = config;\r\n        this.stream = stream;\r\n        this.callbacks = callbacks;\r\n        this.appManager = config.appManager;\r\n        this.onEvent = stream.onEvent;\r\n        this.provider = new ContextProvider(config.agm, config.activityGetter, callbacks);\r\n        stream.subscribe();\r\n    }\r\n    LayoutsAPIImpl.prototype.setDefaultGlobal = function (name) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.SelectDefaultLayout\", { name: name })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.clearDefaultGlobal = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.DeselectDefaultLayout\")];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getDefaultGlobal = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetDefaultLayout\")];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (this.isSlimMode()) {\r\n                            return [2, layout];\r\n                        }\r\n                        return [2, this.list().find(function (l) { return l.name === layout.name && l.type === \"Global\"; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.ready = function () {\r\n        if (this.config.mode === \"fullWaitSnapshot\") {\r\n            return this.stream.gotSnapshot;\r\n        }\r\n        return this.stream.ready;\r\n    };\r\n    LayoutsAPIImpl.prototype.save = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout.name) {\r\n                throw Error(\"layout.name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                layout.type = \"Global\";\r\n            }\r\n            if (layout.activityId) {\r\n                layout.type = \"Activity\";\r\n            }\r\n            if (typeof layout.ignoreHidden === \"undefined\") {\r\n                layout.ignoreHidden = true;\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                actIds: [],\r\n                appIds: [],\r\n                type: layout.type,\r\n                context: layout.context,\r\n                metadata: layout.metadata || {},\r\n                options: { ignoreLayoutRestrictions: false },\r\n            };\r\n            if (layout.type === \"Activity\") {\r\n                var actId = layout.activityId;\r\n                if (!actId) {\r\n                    if (!_this.appManager.myInstance.inActivity) {\r\n                        throw new Error(\"Current application is not in activity. Can not save activity layout for it\");\r\n                    }\r\n                    actId = _this.appManager.myInstance.activityId;\r\n                }\r\n                layoutObject.actIds.push(actId);\r\n                layoutObject.options = { ignoreLayoutRestrictions: true };\r\n            }\r\n            else if (layout.type === \"Global\") {\r\n                if (_this.config.gdMajorVersion === 2) {\r\n                    var instances = _this.appManager.instances();\r\n                    if (layout.ignoreHidden) {\r\n                        instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n                    }\r\n                    if (layout.ignoreMyInstance && _this.appManager.myInstance) {\r\n                        instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n                    }\r\n                    instances.reduce(function (prev, current) {\r\n                        if (!current.id) {\r\n                            return prev;\r\n                        }\r\n                        if (current.inActivity) {\r\n                            var actId = current.activityId;\r\n                            if (prev.actIds.indexOf(actId) === -1) {\r\n                                prev.actIds.push(actId);\r\n                            }\r\n                        }\r\n                        else {\r\n                            prev.appIds.push(current.id);\r\n                        }\r\n                        return prev;\r\n                    }, layoutObject);\r\n                }\r\n                else {\r\n                    layoutObject.autoCollectApps = true;\r\n                }\r\n            }\r\n            else {\r\n                throw new Error(\"layout type \" + layout.type + \" not supported\");\r\n            }\r\n            _this.invokeMethodAndTrack(\"T42.ACS.SaveLayout\", layoutObject, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.restore = function (options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (typeof options === \"undefined\") {\r\n                throw Error(\"options argument is required\");\r\n            }\r\n            if (!options.name) {\r\n                throw Error(\"options.name argument is required\");\r\n            }\r\n            if (!options.type) {\r\n                options.type = \"Global\";\r\n            }\r\n            if (options.activityIdToJoin) {\r\n                options.type = \"Activity\";\r\n            }\r\n            if (typeof options.restoreActivityOwner === \"undefined\") {\r\n                options.restoreActivityOwner = false;\r\n            }\r\n            if (typeof options.ignoreActivityWindowTypes === \"undefined\") {\r\n                options.ignoreActivityWindowTypes = [];\r\n            }\r\n            if (typeof options.setActivityContext === \"undefined\") {\r\n                options.setActivityContext = true;\r\n            }\r\n            if (typeof options.closeRunningInstance === \"undefined\") {\r\n                if (options.type === \"Global\") {\r\n                    options.closeRunningInstance = true;\r\n                }\r\n                else if (options.type === \"Activity\") {\r\n                    options.closeRunningInstance = false;\r\n                }\r\n            }\r\n            if (typeof options.reuseWindows === \"undefined\") {\r\n                options.reuseWindows = true;\r\n            }\r\n            options.context = options.context || {};\r\n            var t42 = {\r\n                restoreOptions: {\r\n                    activityToJoin: options.activityIdToJoin,\r\n                    setActivityContext: options.setActivityContext,\r\n                    ignoreActivityWindowTypes: options.ignoreActivityWindowTypes,\r\n                    restoreActivityOwner: options.restoreActivityOwner,\r\n                    closeOldWindows: options.closeRunningInstance,\r\n                    reuseExistingWindows: options.reuseWindows\r\n                }\r\n            };\r\n            var arg = {\r\n                type: options.type,\r\n                name: options.name,\r\n                context: options.context,\r\n                toClose: [],\r\n                splash: options.splash\r\n            };\r\n            if (_this.config.gdMajorVersion === 2) {\r\n                if (options.closeRunningInstance) {\r\n                    arg.toClose = _this.getInstancesToClose(options);\r\n                }\r\n            }\r\n            if (options.timeout) {\r\n                arg.timeout = options.timeout;\r\n            }\r\n            arg.context._t42 = t42;\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RestoreLayout\", arg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.remove = function (type, name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = {\r\n                type: type,\r\n                name: name,\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RemoveLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.list = function () {\r\n        this.verifyNotSlimMode();\r\n        return store.all;\r\n    };\r\n    LayoutsAPIImpl.prototype.import = function (layouts, mode) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            var msg = {\r\n                mode: mode || \"replace\",\r\n                layouts: layouts\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ImportLayouts\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.export = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var handleResult = function (result) {\r\n                var layouts = _this.getObjectValues(result.Layouts).map(function (t) { return new LayoutImpl(transformACSLayout(t)); });\r\n                resolve(layouts);\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ExportLayouts\", {}, handleResult, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.rename = function (layout, newName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = { type: layout.type, oldName: layout.name, newName: newName };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RenameLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateMetadata = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            if (!layout.metadata) {\r\n                throw Error(\"metadata argument is required\");\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                type: layout.type,\r\n                metadata: layout.metadata\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateMetadata\", layoutObject, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.hibernate = function (name, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            options = options || {};\r\n            var request = {\r\n                name: name,\r\n                type: \"Global\",\r\n                context: options.context || {},\r\n                metadata: options.metadata || {},\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.HibernateLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.resume = function (name, context, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            var request = __assign$1({ name: name, type: \"Global\", context: context }, options);\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ResumeLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getCurrentLayout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetCurrentLayout\", {}, \"best\", { methodResponseTimeoutMs: 120 * 1000 })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned.layout;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (!this.isSlimMode()) {\r\n                            layout = this.list().find(function (l) { return l.name === layout.name && l.type === layout.type; });\r\n                        }\r\n                        return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.onAdded = function (callback) {\r\n        var result = this.callbacks.add(\"added\", callback);\r\n        if (store.all.length > 0) {\r\n            store.all.forEach(function (layout) {\r\n                try {\r\n                    callback(layout);\r\n                }\r\n                catch (err) { }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    LayoutsAPIImpl.prototype.onRemoved = function (callback) {\r\n        return this.callbacks.add(\"removed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onChanged = function (callback) {\r\n        return this.callbacks.add(\"changed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRestored = function (callback) {\r\n        return this.callbacks.add(\"restored\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRenamed = function (callback) {\r\n        return this.callbacks.add(\"renamed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onEvent = function (callback) {\r\n        return this.stream.onEvent(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onSaveRequested = function (callback) {\r\n        return this.provider.onSaveRequested(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.updateAppContextInCurrent = function (context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (context && typeof context !== \"object\") {\r\n                reject(\"context must be an object\");\r\n            }\r\n            context = (context !== null && context !== void 0 ? context : {});\r\n            var request = {\r\n                context: context\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateLayoutComponentContext\", request, resolve, reject, false);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.isSlimMode = function () {\r\n        return this.config.mode === \"slim\";\r\n    };\r\n    LayoutsAPIImpl.prototype.verifyNotSlimMode = function () {\r\n        if (this.isSlimMode()) {\r\n            throw Error(\"Operation not allowed in slim mode. Run in full mode.\");\r\n        }\r\n    };\r\n    LayoutsAPIImpl.prototype.isVisibleWindow = function (instance) {\r\n        if (instance.application.type === \"exe\" || instance.application.type === \"node\") {\r\n            return true;\r\n        }\r\n        if (instance.application.type === \"activity\") {\r\n            return true;\r\n        }\r\n        if (!instance || !instance.window) {\r\n            return false;\r\n        }\r\n        return instance.window.isVisible;\r\n    };\r\n    LayoutsAPIImpl.prototype.invokeMethodAndTrack = function (methodName, args, resolve, reject, skipStreamEvent) {\r\n        var streamEventReceived = skipStreamEvent;\r\n        var agmResult;\r\n        var token = shortid$1();\r\n        args.token = token;\r\n        var handleResult = function () {\r\n            if (streamEventReceived && agmResult) {\r\n                resolve(agmResult);\r\n            }\r\n        };\r\n        if (!skipStreamEvent) {\r\n            this.stream.waitFor(token)\r\n                .then(function () {\r\n                streamEventReceived = true;\r\n                handleResult();\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        var responseHandler = function (result) {\r\n            if (!result.returned) {\r\n                reject(\"No result from method \" + methodName);\r\n            }\r\n            if (result.returned.status && (result.returned.status !== \"Success\" && result.returned.status !== \"PartialSuccess\")) {\r\n                reject(result.returned);\r\n            }\r\n            agmResult = result.returned;\r\n            handleResult();\r\n        };\r\n        this.config.agm.invoke(methodName, args, \"best\", { methodResponseTimeoutMs: 120 * 1000 })\r\n            .then(responseHandler)\r\n            .catch(function (err) { return reject(err); });\r\n    };\r\n    LayoutsAPIImpl.prototype.getInstancesToClose = function (options) {\r\n        var _this = this;\r\n        var instances = [];\r\n        var shellApp = this.appManager.applications().filter(function (a) { return a.isShell; })[0];\r\n        var shellApplicationName = shellApp ? shellApp.name : \"AppManager\";\r\n        this.appManager.instances().forEach(function (i) {\r\n            if (_this.appManager.myInstance && i.id === _this.appManager.myInstance.id) {\r\n                return;\r\n            }\r\n            if (i.application.name === shellApplicationName) {\r\n                return;\r\n            }\r\n            if (!_this.isVisibleWindow(i)) {\r\n                return;\r\n            }\r\n            if (options.type === \"Activity\") {\r\n                if (i.activityId !== options.activityIdToJoin) {\r\n                    return;\r\n                }\r\n            }\r\n            instances.push({ application: i.application.name, instance: i.id });\r\n        });\r\n        return instances;\r\n    };\r\n    LayoutsAPIImpl.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return LayoutsAPIImpl;\r\n}());\n\nvar ACSStream = (function () {\r\n    function ACSStream(agm, callbacks) {\r\n        var _this = this;\r\n        this.agm = agm;\r\n        this.callbacks = callbacks;\r\n        this.ready = new Promise(function (resolve, reject) {\r\n            _this.resolveReady = resolve;\r\n            _this.rejectReady = reject;\r\n        });\r\n        this.gotSnapshot = new Promise(function (resolve, reject) {\r\n            _this.resolveGotSnapshot = resolve;\r\n            _this.rejectGotSnapshot = reject;\r\n        });\r\n    }\r\n    ACSStream.prototype.subscribe = function (noRetry) {\r\n        var _this = this;\r\n        var transform = function (obj) {\r\n            return _this.getObjectValues(obj).map(function (t) { return transformACSLayout(t); });\r\n        };\r\n        if (!this.checkForLayoutEventMethod()) {\r\n            if (noRetry) {\r\n                this.resolveReady();\r\n            }\r\n            setTimeout(function () {\r\n                _this.subscribe(true);\r\n            }, 500);\r\n        }\r\n        else {\r\n            this.agm.subscribe(\"T42.ACS.OnLayoutEvent\", { waitTimeoutMs: 10000 })\r\n                .then(function (subs) {\r\n                subs.onData(function (args) {\r\n                    var data = args.data;\r\n                    if (data.IsSnapshot) {\r\n                        _this.resolveGotSnapshot();\r\n                    }\r\n                    _this.addLayouts(transform(data.OnLayoutAdded));\r\n                    _this.removeLayouts(transform(data.OnLayoutRemoved));\r\n                    _this.changeLayouts(transform(data.OnLayoutChanged));\r\n                    _this.renameLayouts(transform(data.OnLayoutRenamed));\r\n                    _this.restoredLayout(transform(data.OnLayoutRestored));\r\n                    _this.callbacks.execute(\"streamEvent\", data);\r\n                });\r\n                subs.onFailed(function (err) {\r\n                    var msg = \"can not subscribe to T42.ACS.OnLayoutEvent \" + err;\r\n                    _this.rejectReady(msg);\r\n                    _this.rejectGotSnapshot(msg);\r\n                });\r\n                _this.resolveReady();\r\n            })\r\n                .catch(function (err) {\r\n                var msg = \"Error subscribing for T42.ACS.OnLayoutEvent stream. Err: \" + err;\r\n                _this.rejectReady(msg);\r\n                _this.rejectGotSnapshot(msg);\r\n            });\r\n        }\r\n    };\r\n    ACSStream.prototype.onEvent = function (callback) {\r\n        return this.callbacks.add(\"streamEvent\", callback);\r\n    };\r\n    ACSStream.prototype.waitFor = function (token, timeout) {\r\n        var _this = this;\r\n        if (!timeout) {\r\n            timeout = 10000;\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var done = false;\r\n            var unsubscribe = _this.onEvent(function (streamEvent) {\r\n                if (streamEvent.Token === token) {\r\n                    done = true;\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                if (!done) {\r\n                    reject(\"timed out\");\r\n                }\r\n            }, timeout);\r\n        });\r\n    };\r\n    ACSStream.prototype.checkForLayoutEventMethod = function () {\r\n        try {\r\n            return this.agm\r\n                .methods()\r\n                .map(function (m) { return m.name; })\r\n                .indexOf(\"T42.ACS.OnLayoutEvent\") !== -1;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    ACSStream.prototype.addLayouts = function (layoutsData) {\r\n        var _this = this;\r\n        if (!layoutsData) {\r\n            return;\r\n        }\r\n        layoutsData.forEach(function (layoutData) {\r\n            var layout = new LayoutImpl(layoutData);\r\n            store.add(layout);\r\n            _this.callbacks.execute(\"added\", layout);\r\n        });\r\n    };\r\n    ACSStream.prototype.removeLayouts = function (removedLayouts) {\r\n        var _this = this;\r\n        if (!removedLayouts) {\r\n            return;\r\n        }\r\n        removedLayouts.forEach(function (removedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, removedLayout); });\r\n            _this.callbacks.execute(\"removed\", removedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.changeLayouts = function (changedLayouts) {\r\n        var _this = this;\r\n        if (!changedLayouts) {\r\n            return;\r\n        }\r\n        changedLayouts.forEach(function (changedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, changedLayout); });\r\n            store.add(new LayoutImpl(changedLayout));\r\n            _this.callbacks.execute(\"changed\", changedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.renameLayouts = function (renamedLayouts) {\r\n        var _this = this;\r\n        if (!renamedLayouts) {\r\n            return;\r\n        }\r\n        renamedLayouts.forEach(function (renamedLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: renamedLayout.type, name: renamedLayout.oldName }); });\r\n            if (!existingLayout) {\r\n                throw Error(\"received rename event for unknown layout with type \" + renamedLayout.type + \" and name \" + renamedLayout.oldName);\r\n            }\r\n            existingLayout.name = renamedLayout.newName;\r\n            _this.callbacks.execute(\"renamed\", existingLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.compareLayouts = function (layout1, layout2) {\r\n        return layout1.name === layout2.name && layout1.type === layout2.type;\r\n    };\r\n    ACSStream.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    ACSStream.prototype.restoredLayout = function (restoredLayouts) {\r\n        var _this = this;\r\n        if (!restoredLayouts) {\r\n            return;\r\n        }\r\n        restoredLayouts.forEach(function (restoredLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: restoredLayout.type, name: restoredLayout.name }); });\r\n            _this.callbacks.execute(\"restored\", existingLayout);\r\n        });\r\n    };\r\n    return ACSStream;\r\n}());\n\nfunction streamNull () {\r\n    return {\r\n        ready: Promise.resolve(undefined),\r\n        subscribe: function () { },\r\n        onEvent: function (callback) { return function () { }; },\r\n        waitFor: function (token, timeout) { return Promise.resolve(undefined); },\r\n        gotSnapshot: Promise.resolve(undefined),\r\n    };\r\n}\n\nfunction LayoutsFactory (config) {\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is required\");\r\n    }\r\n    if (!config.logger) {\r\n        throw Error(\"config.logger is required\");\r\n    }\r\n    config.mode = config.mode || \"slim\";\r\n    var logger = config.logger;\r\n    var callbacks = lib$2();\r\n    var acsStream;\r\n    if (config.mode === \"full\" || \"fullWaitSnapshot\") {\r\n        acsStream = new ACSStream(config.agm, callbacks);\r\n    }\r\n    else {\r\n        acsStream = streamNull();\r\n    }\r\n    return new LayoutsAPIImpl(config, acsStream, callbacks);\r\n}\n\nvar T42DisplayCommand = \"T42.Displays.Command\";\r\nvar DisplayManager = (function () {\r\n    function DisplayManager(_agm, _logger) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._logger = _logger;\r\n        this.all = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var displays;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetAll, {})];\r\n                    case 1:\r\n                        displays = _a.sent();\r\n                        return [2, displays.map(this.decorateDisplay)];\r\n                }\r\n            });\r\n        }); };\r\n        this.get = function (id) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var display;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Get, { id: id })];\r\n                    case 1:\r\n                        display = _a.sent();\r\n                        return [2, this.decorateDisplay(display)];\r\n                }\r\n            });\r\n        }); };\r\n        this.getPrimary = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var primary;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        primary = (_a.sent()).find(function (d) { return d.isPrimary; });\r\n                        return [2, primary];\r\n                }\r\n            });\r\n        }); };\r\n        this.capture = function (options) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var screenshot;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Capture, __assign$1({}, options))];\r\n                    case 1:\r\n                        screenshot = _a.sent();\r\n                        return [2, screenshot];\r\n                }\r\n            });\r\n        }); };\r\n        this.captureAll = function (options) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var screenshots;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.CaptureAll, __assign$1({}, options))];\r\n                    case 1:\r\n                        screenshots = _a.sent();\r\n                        return [2, screenshots];\r\n                }\r\n            });\r\n        }); };\r\n        this.getMousePosition = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var point;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetMousePosition)];\r\n                    case 1:\r\n                        point = _a.sent();\r\n                        return [2, point];\r\n                }\r\n            });\r\n        }); };\r\n        this.callGD = function (command, options) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var invocationResult;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this._agm.invoke(T42DisplayCommand, { options: __assign$1({}, options), command: command })];\r\n                    case 1:\r\n                        invocationResult = _a.sent();\r\n                        return [2, invocationResult.returned.data];\r\n                }\r\n            });\r\n        }); };\r\n        this.decorateDisplay = function (original) {\r\n            return __assign$1(__assign$1({}, original), { capture: function (size) { return _this.capture({ id: original.id, size: size }); } });\r\n        };\r\n    }\r\n    return DisplayManager;\r\n}());\r\nvar DisplayCommand;\r\n(function (DisplayCommand) {\r\n    DisplayCommand[\"Capture\"] = \"capture\";\r\n    DisplayCommand[\"CaptureAll\"] = \"captureAll\";\r\n    DisplayCommand[\"GetAll\"] = \"getAll\";\r\n    DisplayCommand[\"Get\"] = \"get\";\r\n    DisplayCommand[\"GetMousePosition\"] = \"getMousePosition\";\r\n})(DisplayCommand || (DisplayCommand = {}));\n\nvar interop;\r\nvar windowId;\r\nfunction setupAGM(interopLib, channels) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    interop = interopLib;\r\n                    if (typeof window !== \"undefined\") {\r\n                        if (window.glue42gd) {\r\n                            windowId = window.glue42gd.windowId;\r\n                        }\r\n                    }\r\n                    if (!windowId) {\r\n                        return [2];\r\n                    }\r\n                    return [4, interop.register(\"T42.Channels.Command\", function (args) {\r\n                            var command = args.command;\r\n                            if (!command) {\r\n                                throw new Error(\"missing command argument\");\r\n                            }\r\n                            if (command === \"join\") {\r\n                                var id = args.channel;\r\n                                if (!id) {\r\n                                    throw new Error(\"missing argument id\");\r\n                                }\r\n                                channels.joinNoSelectorSwitch(id);\r\n                                return;\r\n                            }\r\n                            if (command === \"leave\") {\r\n                                channels.leaveNoSelectorSwitch();\r\n                                return;\r\n                            }\r\n                            if (command === \"get\") {\r\n                                var id = channels.current();\r\n                                return { id: id };\r\n                            }\r\n                            throw new Error(\"unknown command \" + command);\r\n                        })];\r\n                case 1:\r\n                    _a.sent();\r\n                    interop.invoke(\"T42.Channels.Announce\", { swId: windowId, instance: interop.instance.instance });\r\n                    return [2];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction switchChannel(channel, id) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            interop.invoke(\"T42.Channels.Announce\", {\r\n                swId: (id !== null && id !== void 0 ? id : windowId),\r\n                command: \"switchChannel\",\r\n                data: { newChannel: channel }\r\n            });\r\n            return [2];\r\n        });\r\n    });\r\n}\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n            var _a;\r\n            callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n                                var _a;\r\n                                if (_this.callback) {\r\n                                    _this.callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.set(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (data) {\r\n                resolve(data);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.update = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.update(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return CONTEXT_PREFIX + name;\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar ChannelsImpl = (function () {\r\n    function ChannelsImpl(shared) {\r\n        this.shared = shared;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$2();\r\n        this.shared.subscribe(this.handler.bind(this));\r\n    }\r\n    ChannelsImpl.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.publish = function (data, name) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var context_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof data !== \"object\") {\r\n                            throw new Error(\"Please provide the data as an object!\");\r\n                        }\r\n                        if (!name) return [3, 2];\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        return [4, this.get(name)];\r\n                    case 1:\r\n                        context_1 = _a.sent();\r\n                        return [2, this.shared.update(context_1.name, { data: data })];\r\n                    case 2:\r\n                        if (!this.currentContext) {\r\n                            throw new Error(\"Not joined to any channel!\");\r\n                        }\r\n                        return [2, this.shared.update(this.currentContext, { data: data })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    ChannelsImpl.prototype.list = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    ChannelsImpl.prototype.join = function (name) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                return [2, this.joinCore(name)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.joinNoSelectorSwitch = function (name) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                return [2, this.joinCore(name, false)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leave = function () {\r\n        return this.leaveCore();\r\n    };\r\n    ChannelsImpl.prototype.leaveNoSelectorSwitch = function () {\r\n        return this.leaveCore(false);\r\n    };\r\n    ChannelsImpl.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    ChannelsImpl.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    ChannelsImpl.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    ChannelsImpl.prototype.add = function (info) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta || {},\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.update(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    ChannelsImpl.prototype.joinCore = function (name, changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        if (name === this.currentContext) {\r\n                            return [2];\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        if (changeSelector) {\r\n                            switchChannel(name);\r\n                        }\r\n                        this.currentContext = name;\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leaveCore = function (changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        if (changeSelector) {\r\n            switchChannel();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    return ChannelsImpl;\r\n}());\n\nfunction factory(contexts, agm) {\r\n    var sharedContexts = new SharedContextSubscriber(contexts);\r\n    var channels = new ChannelsImpl(sharedContexts);\r\n    setupAGM(agm, channels);\r\n    return {\r\n        subscribe: channels.subscribe.bind(channels),\r\n        subscribeFor: channels.subscribeFor.bind(channels),\r\n        publish: channels.publish.bind(channels),\r\n        all: channels.all.bind(channels),\r\n        list: channels.list.bind(channels),\r\n        get: channels.get.bind(channels),\r\n        join: channels.join.bind(channels),\r\n        leave: channels.leave.bind(channels),\r\n        current: channels.current.bind(channels),\r\n        my: channels.my.bind(channels),\r\n        changed: channels.changed.bind(channels),\r\n        onChanged: channels.onChanged.bind(channels),\r\n        add: channels.add.bind(channels),\r\n        ready: function () { return contexts.ready(); }\r\n    };\r\n}\n\nvar CommandMethod = \"T42.Hotkeys.Command\";\r\nvar InvokeMethod = \"T42.Hotkeys.Invoke\";\r\nvar RegisterCommand = \"register\";\r\nvar UnregisterCommand = \"unregister\";\r\nvar UnregisterAllCommand = \"unregisterAll\";\r\nvar HotkeysImpl = (function () {\r\n    function HotkeysImpl(agm) {\r\n        this.agm = agm;\r\n        this.registry = lib$2();\r\n        this.firstHotkey = true;\r\n        this.hotkeys = new Map();\r\n    }\r\n    HotkeysImpl.prototype.register = function (info, callback) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info === \"undefined\") {\r\n                            throw new Error(\"Hotkey parameter missing\");\r\n                        }\r\n                        if (typeof info === \"string\") {\r\n                            info = {\r\n                                hotkey: info\r\n                            };\r\n                        }\r\n                        else {\r\n                            if (!info.hotkey) {\r\n                                throw new Error(\"Info's hotkey parameter missing\");\r\n                            }\r\n                            info = {\r\n                                hotkey: info.hotkey,\r\n                                description: info.description\r\n                            };\r\n                        }\r\n                        hkToLower = this.formatHotkey(info.hotkey);\r\n                        if (this.hotkeys.has(hkToLower)) {\r\n                            throw new Error(\"Shortcut for \" + hkToLower + \" already registered\");\r\n                        }\r\n                        if (!this.firstHotkey) return [3, 2];\r\n                        this.firstHotkey = false;\r\n                        return [4, this.registerInvokeAGMMethod()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.registry.add(hkToLower, callback);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: RegisterCommand, hotkey: hkToLower, description: info.description })];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.hotkeys.set(hkToLower, info);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregister = function (hotkey) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof hotkey === \"undefined\") {\r\n                            throw new Error(\"hotkey parameter missing\");\r\n                        }\r\n                        if (typeof hotkey !== \"string\") {\r\n                            throw new Error(\"hotkey parameter must be string\");\r\n                        }\r\n                        hkToLower = this.formatHotkey(hotkey);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: UnregisterCommand, hotkey: hkToLower })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.delete(hkToLower);\r\n                        this.registry.clearKey(hkToLower);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregisterAll = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.agm.invoke(CommandMethod, { command: UnregisterAllCommand })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.clear();\r\n                        this.registry.clear();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.isRegistered = function (hotkey) {\r\n        var hkToLower = this.formatHotkey(hotkey);\r\n        return this.hotkeys.has(hkToLower);\r\n    };\r\n    HotkeysImpl.prototype.registerInvokeAGMMethod = function () {\r\n        var _this = this;\r\n        this.agm.register(InvokeMethod, function (args) {\r\n            var hkToLower = args.key.toLowerCase();\r\n            var info = _this.hotkeys.get(hkToLower);\r\n            _this.registry.execute(hkToLower, info);\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.formatHotkey = function (hotkey) {\r\n        if (hotkey) {\r\n            return hotkey.replace(/\\s/g, \"\").toLowerCase();\r\n        }\r\n    };\r\n    return HotkeysImpl;\r\n}());\n\nfunction factory$1(agm) {\r\n    var hotkeys = new HotkeysImpl(agm);\r\n    return {\r\n        register: hotkeys.register.bind(hotkeys),\r\n        unregister: hotkeys.unregister.bind(hotkeys),\r\n        unregisterAll: hotkeys.unregisterAll.bind(hotkeys),\r\n        isRegistered: hotkeys.isRegistered.bind(hotkeys),\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\n\nvar version$2 = \"5.1.4\";\n\nvar prepareConfig$1 = (function (options) {\r\n    function getLibConfig(value, defaultMode, trueMode) {\r\n        if (typeof value === \"boolean\" && !value) {\r\n            return undefined;\r\n        }\r\n        var mode = getModeAsString(value, defaultMode, trueMode);\r\n        if (typeof value === \"object\") {\r\n            value.mode = mode;\r\n            return value;\r\n        }\r\n        return {\r\n            mode: mode,\r\n        };\r\n    }\r\n    function getModeAsString(value, defaultMode, trueMode) {\r\n        if (typeof value === \"object\") {\r\n            return getModeAsString(value.mode, defaultMode, trueMode) + \"\";\r\n        }\r\n        else if (typeof value === \"undefined\") {\r\n            if (typeof defaultMode === \"boolean\" && !defaultMode) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return defaultMode + \"\";\r\n            }\r\n        }\r\n        else if (typeof value === \"boolean\") {\r\n            if (value) {\r\n                return ((trueMode === undefined) ? defaultMode : trueMode) + \"\";\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n        return value + \"\";\r\n    }\r\n    var appDefaultMode = false;\r\n    var appDefaultTrueMode = \"startOnly\";\r\n    var activitiesDefaultMode = \"trackMyTypeAndInitiatedFromMe\";\r\n    var layoutsDefaultMode = \"slim\";\r\n    return {\r\n        layouts: getLibConfig(options.layouts, layoutsDefaultMode),\r\n        activities: getLibConfig(options.activities, activitiesDefaultMode),\r\n        appManager: getLibConfig(options.appManager, appDefaultMode, appDefaultTrueMode),\r\n        windows: getLibConfig(options.windows, true),\r\n        channels: getLibConfig(options.channels || false, false),\r\n        displays: getLibConfig(options.displays, true)\r\n    };\r\n});\n\nvar T42_INTENTS_COMMAND = \"T42.Intents.Command\";\r\nvar T42_INTENTS_EVENTS = \"T42.Intents.Events\";\r\nvar agm;\r\nvar IntentCommand;\r\n(function (IntentCommand) {\r\n    IntentCommand[\"Find\"] = \"find\";\r\n    IntentCommand[\"FindByContext\"] = \"findByContext\";\r\n    IntentCommand[\"GetAll\"] = \"all\";\r\n    IntentCommand[\"Raise\"] = \"raise\";\r\n})(IntentCommand || (IntentCommand = {}));\r\nvar intentListeners = {};\r\nfunction raise(request) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            if (typeof request === \"string\") {\r\n                request = { intent: request };\r\n            }\r\n            return [2, invokeGlue(IntentCommand.Raise, request)];\r\n        });\r\n    });\r\n}\r\nfunction find(intentFilter) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            if (typeof intentFilter === \"string\") {\r\n                intentFilter = { name: intentFilter };\r\n            }\r\n            return [2, invokeGlue(IntentCommand.Find, { intentFilter: intentFilter })];\r\n        });\r\n    });\r\n}\r\nfunction findByContext(contextType) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            if (!contextType || typeof contextType !== \"string\") {\r\n                return [2, Promise.reject(Error(\"findByContext called with invalid contextType: \" + contextType))];\r\n            }\r\n            return [2, invokeGlue(IntentCommand.FindByContext, { contextType: contextType })];\r\n        });\r\n    });\r\n}\r\nfunction all() {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        return __generator$1(this, function (_a) {\r\n            return [2, invokeGlue(IntentCommand.GetAll)];\r\n        });\r\n    });\r\n}\r\nfunction addIntentListener(intent, handler) {\r\n    if (!intentListeners[intent]) {\r\n        intentListeners[intent] = [];\r\n    }\r\n    var unsubId = shortid$1();\r\n    intentListeners[intent].push({ unsubId: unsubId, callback: handler });\r\n    return function () {\r\n        intentListeners[intent] = intentListeners[intent]\r\n            .filter(function (h) { return h.unsubId !== unsubId; });\r\n    };\r\n}\r\nfunction invokeGlue(command, options) {\r\n    return __awaiter$1(this, void 0, void 0, function () {\r\n        var invocationResult;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, agm.invoke(T42_INTENTS_COMMAND, { options: __assign$1({}, options), command: command })];\r\n                case 1:\r\n                    invocationResult = _a.sent();\r\n                    return [2, invocationResult.returned.result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction factory$2(agmAPI) {\r\n    agm = agmAPI;\r\n    agm.register(T42_INTENTS_EVENTS, handleEvent);\r\n    return {\r\n        raise: raise,\r\n        find: find,\r\n        findByContext: findByContext,\r\n        all: all,\r\n        addIntentListener: addIntentListener,\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\r\nvar IntentEvents;\r\n(function (IntentEvents) {\r\n    IntentEvents[\"IntentListenerRaised\"] = \"intentListenerRaised\";\r\n})(IntentEvents || (IntentEvents = {}));\r\nfunction handleEvent(args) {\r\n    var _a;\r\n    var type = args.type, intent = args.intent, context = args.context;\r\n    switch (type) {\r\n        case IntentEvents.IntentListenerRaised:\r\n            var callbacks = (_a = intentListeners[intent]) === null || _a === void 0 ? void 0 : _a.map(function (handler) { return handler.callback; });\r\n            if (callbacks && callbacks.length > 0) {\r\n                callbacks.forEach(function (cb) { return cb(context); });\r\n            }\r\n    }\r\n}\n\nvar Glue42Notification = (function () {\r\n    function Glue42Notification(options) {\r\n        this.options = options;\r\n        this.callbacks = lib$2();\r\n        this.actions = options.actions;\r\n        this.body = options.body;\r\n        this.badge = options.badge;\r\n        this.data = options.data;\r\n        this.dir = options.dir;\r\n        this.icon = options.icon;\r\n        this.image = options.image;\r\n        this.lang = options.lang;\r\n        this.renotify = options.renotify;\r\n        this.requireInteraction = options.requireInteraction;\r\n        this.silent = options.silent;\r\n        this.tag = options.tag;\r\n        this.timestamp = options.timestamp;\r\n        this.title = options.title;\r\n    }\r\n    Glue42Notification.prototype.close = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    Glue42Notification.prototype.addEventListener = function (type, listener, options) {\r\n        this.callbacks.add(type, listener);\r\n    };\r\n    Glue42Notification.prototype.removeEventListener = function (type, listener, options) {\r\n    };\r\n    Glue42Notification.prototype.dispatchEvent = function (event) {\r\n        this.callbacks.execute(event.type, event);\r\n        return true;\r\n    };\r\n    return Glue42Notification;\r\n}());\n\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n        this.methodRegistered = false;\r\n        this.methodName = \"T42.Notifications.Handler-\" + shortid$1();\r\n        this.nextId = 0;\r\n        this.notifications = {};\r\n    }\r\n    Notifications.prototype.raise = function (options) {\r\n        var _a, _b;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var id, notification, _loop_1, this_1, _i, _c, action, g42notification;\r\n            return __generator$1(this, function (_d) {\r\n                switch (_d.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            throw new Error(\"invalid options - should be an object\");\r\n                        }\r\n                        if (!options.title) {\r\n                            throw new Error(\"invalid options - should have title\");\r\n                        }\r\n                        if (!!this.methodRegistered) return [3, 2];\r\n                        return [4, this.interop.register(this.methodName, this.handleNotificationAction.bind(this))];\r\n                    case 1:\r\n                        _d.sent();\r\n                        this.methodRegistered = true;\r\n                        _d.label = 2;\r\n                    case 2:\r\n                        id = String(this.nextId++);\r\n                        notification = {\r\n                            title: options.title,\r\n                            severity: \"Medium\",\r\n                            description: options.body,\r\n                            glueRoutingDetailMethodName: this.methodName,\r\n                            actions: [],\r\n                            source: id\r\n                        };\r\n                        if (options.actions) {\r\n                            _loop_1 = function (action) {\r\n                                var args = {\r\n                                    g42notificationId: id,\r\n                                    g42action: action.action,\r\n                                    g42interopMethod: (_a = action.interop) === null || _a === void 0 ? void 0 : _a.method,\r\n                                    g42interopTarget: (_b = action.interop) === null || _b === void 0 ? void 0 : _b.target,\r\n                                };\r\n                                var parameters = Object.keys(args).map(function (key) {\r\n                                    var value = args[key];\r\n                                    return {\r\n                                        name: key,\r\n                                        value: {\r\n                                            stringValue: value\r\n                                        }\r\n                                    };\r\n                                });\r\n                                var glueAction = {\r\n                                    name: this_1.methodName,\r\n                                    description: action.title,\r\n                                    displayName: action.title,\r\n                                    parameters: parameters\r\n                                };\r\n                                notification.actions.push(glueAction);\r\n                            };\r\n                            this_1 = this;\r\n                            for (_i = 0, _c = options.actions; _i < _c.length; _i++) {\r\n                                action = _c[_i];\r\n                                _loop_1(action);\r\n                            }\r\n                        }\r\n                        return [4, this.interop.invoke(\"T42.GNS.Publish.RaiseNotification\", { notification: notification })];\r\n                    case 3:\r\n                        _d.sent();\r\n                        g42notification = new Glue42Notification(options);\r\n                        this.notifications[id] = g42notification;\r\n                        return [2, g42notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.handleNotificationAction = function (args) {\r\n        if (args.g42notificationId) {\r\n            var payload_1 = args;\r\n            var id = payload_1.g42notificationId;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_1 = new Event(\"onaction\");\r\n            event_1.action = payload_1.g42action;\r\n            if (notification.onaction) {\r\n                notification.onaction(event_1);\r\n            }\r\n            var actionDefinition = (notification.actions || []).find(function (item) { return item.action === payload_1.g42action; });\r\n            var actionInterop = actionDefinition.interop;\r\n            if (actionInterop) {\r\n                this.interop.invoke(actionInterop.method, actionInterop.arguments || {}, actionInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_1);\r\n        }\r\n        else if (args.notification && args.notification.source) {\r\n            var id = args.notification.source;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_2 = new Event(\"onclick\");\r\n            if (notification.onclick) {\r\n                notification.onclick(event_2);\r\n            }\r\n            var clickInterop = notification.options.clickInterop;\r\n            if (clickInterop) {\r\n                this.interop.invoke(clickInterop.method, clickInterop.arguments || {}, clickInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_2);\r\n        }\r\n    };\r\n    return Notifications;\r\n}());\n\nvar ThemesConfigurationMethodName = \"T42.Themes.Configuration\";\r\nvar ThemesImpl = (function () {\r\n    function ThemesImpl(core) {\r\n        this.core = core;\r\n        this.registry = lib$2();\r\n        this.getConfiguration();\r\n    }\r\n    ThemesImpl.prototype.list = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2: return [2, (_a.sent()).returned.all];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getCurrent = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var all;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2:\r\n                        all = _a.sent();\r\n                        return [2, all.returned.all.find(function (t) { return t.name === all.returned.selected; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.select = function (theme) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.setMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.core.interop.invoke(this.setMethodName, { theme: theme })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.onChanged = function (callback) {\r\n        this.subscribe();\r\n        return this.registry.add(\"changed\", callback);\r\n    };\r\n    ThemesImpl.prototype.getConfiguration = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var config, error_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        if (this.sharedContextName) {\r\n                            return [2];\r\n                        }\r\n                        return [4, this.core.interop.invoke(ThemesConfigurationMethodName)];\r\n                    case 1:\r\n                        config = _a.sent();\r\n                        this.sharedContextName = config.returned.sharedContextName;\r\n                        this.getMethodName = config.returned.getThemesMethodName;\r\n                        this.setMethodName = config.returned.setThemesMethodName;\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [2];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getAll = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.core.interop.invoke(this.getMethodName)];\r\n                    case 2: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.subscribe = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.core.contexts.subscribe(this.sharedContextName, function (data) {\r\n                            if (data && data.all && data.selected) {\r\n                                _this.registry.execute(\"changed\", data.all.find(function (t) { return t.name === data.selected; }));\r\n                            }\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ThemesImpl;\r\n}());\n\nfunction factory$3(core) {\r\n    var themes = new ThemesImpl(core);\r\n    return {\r\n        list: themes.list.bind(themes),\r\n        getCurrent: themes.getCurrent.bind(themes),\r\n        select: themes.select.bind(themes),\r\n        onChanged: themes.onChanged.bind(themes),\r\n        ready: function () { return Promise.resolve(); },\r\n    };\r\n}\n\nvar factory$4 = function (options) {\r\n    var gdMajorVersion = Utils$1.getGDMajorVersion();\r\n    options = options || {};\r\n    var glueConfig = prepareConfig$1(options);\r\n    options.gateway = options.gateway || {};\r\n    var _appManager;\r\n    var _activity;\r\n    var _windows;\r\n    var _displays;\r\n    function createWindows(core) {\r\n        if (glueConfig.windows) {\r\n            var windowsLogger = getLibLogger(\"windows\", core.logger, glueConfig.windows);\r\n            _windows = WindowsFactory(core.agm, windowsLogger, function () {\r\n                return _appManager;\r\n            }, gdMajorVersion);\r\n            debugLog(_windows);\r\n            return _windows;\r\n        }\r\n    }\r\n    function createActivities(core) {\r\n        if (glueConfig.activities) {\r\n            if (ActivityModule.checkIsUsingGW3Implementation && ActivityModule.checkIsUsingGW3Implementation(core.connection)) {\r\n                var activityLogger = getLibLogger(\"activity\", core.logger, glueConfig.activities);\r\n                _activity = new ActivityModule({\r\n                    connection: core.connection,\r\n                    contexts: core.contexts,\r\n                    agm: core.agm,\r\n                    logger: activityLogger,\r\n                    logLevel: \"info\",\r\n                    disableAutoAnnounce: false,\r\n                    disposeRequestHandling: \"ignore\",\r\n                    announcementInfo: null,\r\n                    windows: _windows,\r\n                    appManagerGetter: function () {\r\n                        return _appManager;\r\n                    },\r\n                    mode: glueConfig.activities.mode,\r\n                    typesToTrack: glueConfig.activities.typesToTrack,\r\n                    activityId: typeof window !== \"undefined\" && window.glue42gd && window.glue42gd.activityInfo && window.glue42gd.activityInfo.activityId,\r\n                    gdMajorVersion: gdMajorVersion\r\n                }).api;\r\n                debugLog(_activity);\r\n                return _activity;\r\n            }\r\n        }\r\n    }\r\n    function createAppManager(core) {\r\n        if (!glueConfig.appManager) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"appManager\", core.logger, glueConfig.appManager);\r\n        _appManager = AppManagerFactory({\r\n            agm: core.agm,\r\n            windows: _windows,\r\n            logger: logger,\r\n            activities: _activity,\r\n            mode: glueConfig.appManager.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(_appManager);\r\n        return _appManager;\r\n    }\r\n    function createLayouts(core) {\r\n        if (!glueConfig.layouts) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"layouts\", core.logger, glueConfig.layouts);\r\n        var lay = LayoutsFactory({\r\n            agm: core.agm,\r\n            appManager: _appManager,\r\n            activityGetter: function () { return _activity; },\r\n            logger: logger,\r\n            mode: glueConfig.layouts.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(lay);\r\n        return lay;\r\n    }\r\n    function createChannels(core) {\r\n        if (!glueConfig.channels) {\r\n            return;\r\n        }\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var channelsAPI = factory(core.contexts, core.agm);\r\n        debugLog(channelsAPI);\r\n        return channelsAPI;\r\n    }\r\n    function createHotkeys(core) {\r\n        var hotkeysAPI = factory$1(core.agm);\r\n        debugLog(hotkeysAPI);\r\n        return hotkeysAPI;\r\n    }\r\n    function createIntents(core) {\r\n        var intentsAPI = factory$2(core.agm);\r\n        debugLog(intentsAPI);\r\n        return intentsAPI;\r\n    }\r\n    function createNotifications(core) {\r\n        var notificationsAPI = new Notifications(core.interop);\r\n        debugLog(notificationsAPI);\r\n        return notificationsAPI;\r\n    }\r\n    function createDisplaysApi(core) {\r\n        if (glueConfig.displays) {\r\n            var displaysLogger = getLibLogger(\"displays\", core.logger, glueConfig.displays);\r\n            _displays = new DisplayManager(core.agm, displaysLogger);\r\n            debugLog(_displays);\r\n            return _displays;\r\n        }\r\n    }\r\n    function createThemes(core) {\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var themesAPI = factory$3(core);\r\n        debugLog(themesAPI);\r\n        return themesAPI;\r\n    }\r\n    function getLibLogger(loggerName, logger, config) {\r\n        var newLogger = logger.subLogger(loggerName);\r\n        if (config && config.logger) {\r\n            var loggerConfig = config.logger;\r\n            if (loggerConfig.console) {\r\n                newLogger.consoleLevel(loggerConfig.console);\r\n            }\r\n            if (loggerConfig.publish) {\r\n                newLogger.publishLevel(loggerConfig.publish);\r\n            }\r\n        }\r\n        return newLogger;\r\n    }\r\n    var ext = {\r\n        libs: [\r\n            { name: \"windows\", create: createWindows },\r\n            { name: \"activities\", create: createActivities },\r\n            { name: \"appManager\", create: createAppManager },\r\n            { name: \"layouts\", create: createLayouts },\r\n            { name: \"channels\", create: createChannels },\r\n            { name: \"hotkeys\", create: createHotkeys },\r\n            { name: \"displays\", create: createDisplaysApi },\r\n            { name: \"intents\", create: createIntents },\r\n            { name: \"notifications\", create: createNotifications },\r\n            { name: \"themes\", create: createThemes }\r\n        ],\r\n        version: version$2,\r\n        enrichGlue: function (glue) {\r\n            glue.config.activities = glueConfig.activities;\r\n            glue.config.windows = glueConfig.windows;\r\n            glue.config.appManager = glueConfig.appManager;\r\n            glue.config.layouts = glueConfig.layouts;\r\n            glue.config.channels = glueConfig.channels;\r\n            glue.config.displays = glueConfig.displays;\r\n        },\r\n    };\r\n    var currentLog = [];\r\n    if (typeof window !== \"undefined\") {\r\n        if (!window.glueFactoryLog) {\r\n            window.glueFactoryLog = [];\r\n        }\r\n        window.glueFactoryLog.push(currentLog);\r\n    }\r\n    function debugLog(entry) {\r\n        currentLog.push(entry);\r\n    }\r\n    return GlueCore(options, ext);\r\n};\r\nfactory$4.coreVersion = GlueCore.version;\r\nfactory$4.version = version$2;\n\nvar whatToExpose = factory$4;\r\nvar shouldSetToWindow = true;\r\nif (typeof window !== \"undefined\") {\r\n    var glue42gd = window.glue42gd;\r\n    if (glue42gd && glue42gd.autoInjected) {\r\n        whatToExpose = window.Glue;\r\n        shouldSetToWindow = false;\r\n    }\r\n    if (shouldSetToWindow) {\r\n        window.Glue = whatToExpose;\r\n    }\r\n    delete window.GlueCore;\r\n}\r\nwhatToExpose.default = whatToExpose;\r\nvar whatToExpose$1 = whatToExpose;\n\nexport default whatToExpose$1;\n//# sourceMappingURL=desktop.es.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar version = \"1.4.2\";\n\nfunction createCommonjsModule(fn, basedir, module) {\n\treturn module = {\n\t  path: basedir,\n\t  exports: {},\n\t  require: function (path, base) {\n      return commonjsRequire(path, (base === undefined || base === null) ? module.path : base);\n    }\n\t}, fn(module, module.exports), module.exports;\n}\n\nfunction commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nvar alphabet_1 = {\n    get: get,\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nvar randomByteBrowser = randomByte;\n\n// This file replaces `format.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\nvar format_browser = function (random, alphabet, size) {\n  // We can’t use bytes bigger than the alphabet. To make bytes values closer\n  // to the alphabet, we apply bitmask on them. We look for the closest\n  // `2 ** x - 1` number, which will be bigger than alphabet size. If we have\n  // 30 symbols in the alphabet, we will take 31 (00011111).\n  // We do not use faster Math.clz32, because it is not available in browsers.\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1;\n  // Bitmask is not a perfect solution (in our example it will pass 31 bytes,\n  // which is bigger than the alphabet). As a result, we will need more bytes,\n  // than ID size, because we will refuse bytes bigger than the alphabet.\n\n  // Every hardware random generator call is costly,\n  // because we need to wait for entropy collection. This is why often it will\n  // be faster to ask for few extra bytes in advance, to avoid additional calls.\n\n  // Here we calculate how many random bytes should we call in advance.\n  // It depends on ID length, mask / alphabet size and magic number 1.6\n  // (which was selected according benchmarks).\n\n  // -~f => Math.ceil(f) if n is float number\n  // -~i => i + 1 if n is integer number\n  var step = -~(1.6 * mask * size / alphabet.length);\n  var id = '';\n\n  while (true) {\n    var bytes = random(step);\n    // Compact alternative for `for (var i = 0; i < step; i++)`\n    var i = step;\n    while (i--) {\n      // If random byte is bigger than alphabet even after bitmask,\n      // we refuse it by `|| ''`.\n      id += alphabet[bytes[i] & mask] || '';\n      // More compact than `id.length + 1 === size`\n      if (id.length === +size) return id\n    }\n  }\n};\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format_browser(randomByteBrowser, alphabet_1.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar generate_1 = generate;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1567752802062;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 7;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate_1(version$1);\n    str = str + generate_1(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate_1(counter);\n    }\n    str = str + generate_1(seconds);\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet_1.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nvar isValid = isShortId;\n\nvar lib = createCommonjsModule(function (module) {\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n});\n\nvar shortid = lib;\n\nvar RemoteWebWindow = (function () {\r\n    function RemoteWebWindow(id, name, control, windows) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.control = control;\r\n        this.windows = windows;\r\n    }\r\n    RemoteWebWindow.prototype.getURL = function () {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, this.callControl(\"getURL\", {})];\r\n                    case 1:\r\n                        result = _b.sent();\r\n                        return [2, (_a = result === null || result === void 0 ? void 0 : result.returned) === null || _a === void 0 ? void 0 : _a._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveResize = function (bounds) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", bounds, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                return [2, new Promise(function (resolve, reject) {\r\n                        var done = function () {\r\n                            if (timeout) {\r\n                                clearTimeout(timeout);\r\n                            }\r\n                            if (un) {\r\n                                un();\r\n                            }\r\n                        };\r\n                        var un = _this.windows.onWindowRemoved(function (w) {\r\n                            if (w.id === _this.id) {\r\n                                resolve(_this);\r\n                                done();\r\n                            }\r\n                        });\r\n                        var timeout = setTimeout(function () {\r\n                            reject(\"can not close window - probably not opened by your window\");\r\n                            done();\r\n                        }, 1000);\r\n                        _this.callControl(\"close\", {}, true)\r\n                            .catch(function () {\r\n                        });\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof title === \"string\") {\r\n                            title = { title: title };\r\n                        }\r\n                        return [4, this.callControl(\"setTitle\", title, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { width: width, height: height }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { top: top, left: left }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"focus\", {}, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getBounds\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getContext\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getTitle\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.onContextUpdated = function (callback) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    RemoteWebWindow.prototype.updateContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"updateContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"setContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.control.send({ command: command, domain: \"windows\", args: args, skipResult: skipResult }, { windowId: this.id })];\r\n                    case 1: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return RemoteWebWindow;\r\n}());\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib$1 = createRegistry;\n\nvar Control = (function () {\r\n    function Control() {\r\n        this.callbacks = {};\r\n        this.registry = lib$1();\r\n    }\r\n    Control.prototype.start = function (interop, logger) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.interop = interop;\r\n                        this.logger = logger;\r\n                        return [4, this.interop.register(Control.CONTROL_METHOD, function (arg) { return __awaiter(_this, void 0, void 0, function () {\r\n                                var command, result, result, callback;\r\n                                return __generator(this, function (_a) {\r\n                                    command = arg;\r\n                                    logger.trace(\"received control command \" + JSON.stringify(command));\r\n                                    if (command.domain === \"windows\") {\r\n                                        if (!this.myWindow) {\r\n                                            return [2];\r\n                                        }\r\n                                        result = this.myWindow[command.command].call(this.myWindow, command.args);\r\n                                        if (command.skipResult) {\r\n                                            return [2, {}];\r\n                                        }\r\n                                        else {\r\n                                            return [2, result];\r\n                                        }\r\n                                    }\r\n                                    if (command.domain === \"appManager\") {\r\n                                        if (!this.myInstance) {\r\n                                            return [2];\r\n                                        }\r\n                                        result = this.myInstance[command.command].call(this.myInstance, command.args);\r\n                                        if (command.skipResult) {\r\n                                            return [2, {}];\r\n                                        }\r\n                                        else {\r\n                                            return [2, result];\r\n                                        }\r\n                                    }\r\n                                    if (command.domain === \"layouts\") {\r\n                                        callback = this.callbacks[command.domain];\r\n                                        if (callback) {\r\n                                            callback(command);\r\n                                        }\r\n                                    }\r\n                                    return [2];\r\n                                });\r\n                            }); })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.registry.execute(\"started\");\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Control.prototype.send = function (command, target) {\r\n        if (!this.interop) {\r\n            throw new Error(\"Control not started\");\r\n        }\r\n        this.logger.info(\"sending control command \" + JSON.stringify(command) + \" to \" + JSON.stringify(target) + \"}\");\r\n        return this.interop.invoke(Control.CONTROL_METHOD, command, target);\r\n    };\r\n    Control.prototype.subscribe = function (domain, callback) {\r\n        this.callbacks[domain] = callback;\r\n    };\r\n    Control.prototype.setLocalWindow = function (window) {\r\n        this.myWindow = window;\r\n    };\r\n    Control.prototype.setLocalInstance = function (instance) {\r\n        this.myInstance = instance;\r\n    };\r\n    Control.prototype.onStart = function (callback) {\r\n        return this.registry.add(\"started\", callback);\r\n    };\r\n    Control.CONTROL_METHOD = \"GC.Control\";\r\n    return Control;\r\n}());\n\nvar LocalWebWindow = (function () {\r\n    function LocalWebWindow(id, name, window, control, interop) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.window = window;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this.context = {};\r\n        this.registry = lib$1();\r\n        control.setLocalWindow(this);\r\n    }\r\n    LocalWebWindow.prototype.getURL = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.location.href];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveResize = function (_a) {\r\n        var left = _a.left, top = _a.top, width = _a.width, height = _a.height;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_b) {\r\n                left = left !== null && left !== void 0 ? left : window.screenLeft;\r\n                top = top !== null && top !== void 0 ? top : window.screenTop;\r\n                width = width !== null && width !== void 0 ? width : window.outerWidth;\r\n                height = height !== null && height !== void 0 ? height : window.outerHeight;\r\n                window.moveTo(left, top);\r\n                window.resizeTo(width, height);\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.parent) {\r\n                    throw new Error(\"can not close window if it's not opened by script\");\r\n                }\r\n                try {\r\n                    window.close();\r\n                }\r\n                catch (_b) {\r\n                    console.log(\"what\");\r\n                }\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof title === \"object\" && title !== null) {\r\n                    title = title.title;\r\n                }\r\n                document.title = title;\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ width: width, height: height })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ top: top, left: left })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                window.focus();\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getBoundsSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getContextSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContextSync = function () {\r\n        return this.context;\r\n    };\r\n    LocalWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.document.title];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.onContextUpdated = function (callback) {\r\n        return this.registry.add(\"context-updated\", callback);\r\n    };\r\n    LocalWebWindow.prototype.updateContext = function (context) {\r\n        var oldContext = this.context;\r\n        this.context = Object.assign({}, oldContext, context);\r\n        this.registry.execute(\"context-updated\", this.context, oldContext);\r\n        return Promise.resolve(this);\r\n    };\r\n    LocalWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var oldContext;\r\n            return __generator(this, function (_a) {\r\n                oldContext = this.context;\r\n                this.context = Object.assign({}, context);\r\n                this.registry.execute(\"context-updated\", context, oldContext);\r\n                return [2, Promise.resolve(this)];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBoundsSync = function () {\r\n        return {\r\n            left: this.window.screenLeft,\r\n            top: this.window.screenTop,\r\n            width: this.window.outerWidth,\r\n            height: this.window.outerHeight\r\n        };\r\n    };\r\n    return LocalWebWindow;\r\n}());\n\nvar ChildWebWindow = (function (_super) {\r\n    __extends(ChildWebWindow, _super);\r\n    function ChildWebWindow(window, id, name, control, windows) {\r\n        var _this = _super.call(this, id, name, control, windows) || this;\r\n        _this.window = window;\r\n        _this.id = id;\r\n        _this.name = name;\r\n        return _this;\r\n    }\r\n    return ChildWebWindow;\r\n}(RemoteWebWindow));\n\nvar createMethodName = function (id) { return \"\\\"GC.Wnd.\\\"\" + id; };\r\nvar registerChildStartupContext = function (interop, parent, id, name, options) {\r\n    var _a;\r\n    var methodName = createMethodName(id);\r\n    var startingContext = {\r\n        context: (_a = options === null || options === void 0 ? void 0 : options.context) !== null && _a !== void 0 ? _a : {},\r\n        name: name,\r\n        parent: parent\r\n    };\r\n    interop.register(methodName, function () { return startingContext; });\r\n};\r\nvar initStartupContext = function (my, interop, instance) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var methodName, result;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                methodName = createMethodName(my.id);\r\n                if (!interop.methods().find(function (m) { return m.name === methodName; })) return [3, 2];\r\n                return [4, interop.invoke(methodName)];\r\n            case 1:\r\n                result = _a.sent();\r\n                if (my) {\r\n                    my.setContext(result.returned.context);\r\n                    my.name = result.returned.name;\r\n                    my.parent = result.returned.parent;\r\n                    if (instance) {\r\n                        instance.startedByScript = true;\r\n                        instance.context = result.returned.context;\r\n                    }\r\n                }\r\n                _a.label = 2;\r\n            case 2: return [2];\r\n        }\r\n    });\r\n}); };\n\nvar Windows = (function () {\r\n    function Windows(interop, control) {\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.registry = lib$1();\r\n        this.childWindows = [];\r\n        var id = interop.instance.windowId;\r\n        var name = \"document.title (\" + shortid() + \")\";\r\n        this.myWindow = new LocalWebWindow(id, name, window, this.control, this.interop);\r\n        this.trackWindowsLifetime();\r\n    }\r\n    Windows.prototype.list = function () {\r\n        var _this = this;\r\n        var method = this.interop.methods({ name: Control.CONTROL_METHOD })[0];\r\n        if (!method) {\r\n            return [];\r\n        }\r\n        var servers = method.getServers ? method.getServers() : [];\r\n        return servers.reduce(function (prev, current) {\r\n            var remoteWindow = _this.remoteFromServer(current);\r\n            if (remoteWindow) {\r\n                prev.push(remoteWindow);\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Windows.prototype.findById = function (id) {\r\n        return this.list().find(function (w) { return w.id === id; });\r\n    };\r\n    Windows.prototype.my = function () {\r\n        return this.myWindow;\r\n    };\r\n    Windows.prototype.open = function (name, url, options) {\r\n        var _a, _b, _c, _d, _e;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var width, height, left, top, id, relativeWindowId_1, relativeWindow, relativeWindowBounds, relativeDir, newBounds, optionsString, newWindow, remoteWindow;\r\n            return __generator(this, function (_f) {\r\n                switch (_f.label) {\r\n                    case 0:\r\n                        width = (_a = options === null || options === void 0 ? void 0 : options.width) !== null && _a !== void 0 ? _a : 400;\r\n                        height = (_b = options === null || options === void 0 ? void 0 : options.height) !== null && _b !== void 0 ? _b : 400;\r\n                        left = (_c = options === null || options === void 0 ? void 0 : options.left) !== null && _c !== void 0 ? _c : window.screen.availWidth - window.screenLeft;\r\n                        top = (_d = options === null || options === void 0 ? void 0 : options.top) !== null && _d !== void 0 ? _d : 0;\r\n                        id = shortid();\r\n                        registerChildStartupContext(this.interop, this.my().id, id, name, options);\r\n                        if (!(options === null || options === void 0 ? void 0 : options.relativeTo)) return [3, 2];\r\n                        relativeWindowId_1 = options.relativeTo;\r\n                        relativeWindow = this.list().find(function (w) { return w.id === relativeWindowId_1; });\r\n                        if (!relativeWindow) return [3, 2];\r\n                        return [4, relativeWindow.getBounds()];\r\n                    case 1:\r\n                        relativeWindowBounds = _f.sent();\r\n                        relativeDir = (_e = options.relativeDirection) !== null && _e !== void 0 ? _e : \"right\";\r\n                        newBounds = this.getRelativeBounds({ width: width, height: height, left: left, top: top }, relativeWindowBounds, relativeDir);\r\n                        width = newBounds.width;\r\n                        height = newBounds.height;\r\n                        left = newBounds.left;\r\n                        top = newBounds.top;\r\n                        _f.label = 2;\r\n                    case 2:\r\n                        optionsString = \"width=\" + width + \",height=\" + height + \",left=\" + left + \",top=\" + top + \",scrollbars=none,location=no,status=no,menubar=no\";\r\n                        newWindow = window.open(url, id, optionsString);\r\n                        if (!newWindow) {\r\n                            throw new Error(\"failed to open a window with url=\" + url + \" and options=\" + optionsString);\r\n                        }\r\n                        newWindow.focus();\r\n                        newWindow.moveTo(left, top);\r\n                        newWindow.resizeTo(width, height);\r\n                        remoteWindow = new ChildWebWindow(newWindow, id, name, this.control, this);\r\n                        this.childWindows.push(remoteWindow);\r\n                        return [2, remoteWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Windows.prototype.onWindowAdded = function (callback) {\r\n        return this.registry.add(\"window-added\", callback);\r\n    };\r\n    Windows.prototype.onWindowRemoved = function (callback) {\r\n        return this.registry.add(\"window-removed\", callback);\r\n    };\r\n    Windows.prototype.getChildWindows = function () {\r\n        this.childWindows = this.childWindows.filter(function (cw) { return !cw.window.closed; });\r\n        return this.childWindows;\r\n    };\r\n    Windows.prototype.remoteFromServer = function (server) {\r\n        var _a;\r\n        if (!server.windowId) {\r\n            return undefined;\r\n        }\r\n        return new RemoteWebWindow(server.windowId, (_a = server.application) !== null && _a !== void 0 ? _a : \"\", this.control, this);\r\n    };\r\n    Windows.prototype.getRelativeBounds = function (rect, relativeTo, relativeDirection) {\r\n        var edgeDistance = 0;\r\n        switch (relativeDirection) {\r\n            case \"bottom\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top + relativeTo.height + edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"top\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top - rect.height - edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"right\":\r\n                return {\r\n                    left: relativeTo.left + relativeTo.width + edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n            case \"left\":\r\n                return {\r\n                    left: relativeTo.left - rect.width - edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n        }\r\n        throw new Error(\"invalid relativeDirection\");\r\n    };\r\n    Windows.prototype.trackWindowsLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            if (method.name !== Control.CONTROL_METHOD) {\r\n                return;\r\n            }\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-added\", remoteWindow);\r\n            }\r\n        });\r\n        this.interop.serverRemoved(function (server) {\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-removed\", remoteWindow);\r\n            }\r\n        });\r\n    };\r\n    return Windows;\r\n}());\n\n/**\r\n * Wraps values in an `Ok` type.\r\n *\r\n * Example: `ok(5) // => {ok: true, result: 5}`\r\n */\r\nvar ok = function (result) { return ({ ok: true, result: result }); };\r\n/**\r\n * Typeguard for `Ok`.\r\n */\r\nvar isOk = function (r) { return r.ok === true; };\r\n/**\r\n * Wraps errors in an `Err` type.\r\n *\r\n * Example: `err('on fire') // => {ok: false, error: 'on fire'}`\r\n */\r\nvar err = function (error) { return ({ ok: false, error: error }); };\r\n/**\r\n * Typeguard for `Err`.\r\n */\r\nvar isErr = function (r) { return r.ok === false; };\r\n/**\r\n * Create a `Promise` that either resolves with the result of `Ok` or rejects\r\n * with the error of `Err`.\r\n */\r\nvar asPromise = function (r) {\r\n    return r.ok === true ? Promise.resolve(r.result) : Promise.reject(r.error);\r\n};\r\n/**\r\n * Unwraps a `Result` and returns either the result of an `Ok`, or\r\n * `defaultValue`.\r\n *\r\n * Example:\r\n * ```\r\n * Result.withDefault(5, number().run(json))\r\n * ```\r\n *\r\n * It would be nice if `Decoder` had an instance method that mirrored this\r\n * function. Such a method would look something like this:\r\n * ```\r\n * class Decoder<A> {\r\n *   runWithDefault = (defaultValue: A, json: any): A =>\r\n *     Result.withDefault(defaultValue, this.run(json));\r\n * }\r\n *\r\n * number().runWithDefault(5, json)\r\n * ```\r\n * Unfortunately, the type of `defaultValue: A` on the method causes issues\r\n * with type inference on  the `object` decoder in some situations. While these\r\n * inference issues can be solved by providing the optional type argument for\r\n * `object`s, the extra trouble and confusion doesn't seem worth it.\r\n */\r\nvar withDefault = function (defaultValue, r) {\r\n    return r.ok === true ? r.result : defaultValue;\r\n};\r\n/**\r\n * Return the successful result, or throw an error.\r\n */\r\nvar withException = function (r) {\r\n    if (r.ok === true) {\r\n        return r.result;\r\n    }\r\n    else {\r\n        throw r.error;\r\n    }\r\n};\r\n/**\r\n * Given an array of `Result`s, return the successful values.\r\n */\r\nvar successes = function (results) {\r\n    return results.reduce(function (acc, r) { return (r.ok === true ? acc.concat(r.result) : acc); }, []);\r\n};\r\n/**\r\n * Apply `f` to the result of an `Ok`, or pass the error through.\r\n */\r\nvar map = function (f, r) {\r\n    return r.ok === true ? ok(f(r.result)) : r;\r\n};\r\n/**\r\n * Apply `f` to the result of two `Ok`s, or pass an error through. If both\r\n * `Result`s are errors then the first one is returned.\r\n */\r\nvar map2 = function (f, ar, br) {\r\n    return ar.ok === false ? ar :\r\n        br.ok === false ? br :\r\n            ok(f(ar.result, br.result));\r\n};\r\n/**\r\n * Apply `f` to the error of an `Err`, or pass the success through.\r\n */\r\nvar mapError = function (f, r) {\r\n    return r.ok === true ? r : err(f(r.error));\r\n};\r\n/**\r\n * Chain together a sequence of computations that may fail, similar to a\r\n * `Promise`. If the first computation fails then the error will propagate\r\n * through. If it succeeds, then `f` will be applied to the value, returning a\r\n * new `Result`.\r\n */\r\nvar andThen = function (f, r) {\r\n    return r.ok === true ? f(r.result) : r;\r\n};\r\n\n\nvar result = Object.freeze({\n\tok: ok,\n\tisOk: isOk,\n\terr: err,\n\tisErr: isErr,\n\tasPromise: asPromise,\n\twithDefault: withDefault,\n\twithException: withException,\n\tsuccesses: successes,\n\tmap: map,\n\tmap2: map2,\n\tmapError: mapError,\n\tandThen: andThen\n});\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction isEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a === null && b === null) {\r\n        return true;\r\n    }\r\n    if (typeof (a) !== typeof (b)) {\r\n        return false;\r\n    }\r\n    if (typeof (a) === 'object') {\r\n        // Array\r\n        if (Array.isArray(a)) {\r\n            if (!Array.isArray(b)) {\r\n                return false;\r\n            }\r\n            if (a.length !== b.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (!isEqual(a[i], b[i])) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        // Hash table\r\n        var keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!b.hasOwnProperty(keys[i])) {\r\n                return false;\r\n            }\r\n            if (!isEqual(a[keys[i]], b[keys[i]])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n/*\r\n * Helpers\r\n */\r\nvar isJsonArray = function (json) { return Array.isArray(json); };\r\nvar isJsonObject = function (json) {\r\n    return typeof json === 'object' && json !== null && !isJsonArray(json);\r\n};\r\nvar typeString = function (json) {\r\n    switch (typeof json) {\r\n        case 'string':\r\n            return 'a string';\r\n        case 'number':\r\n            return 'a number';\r\n        case 'boolean':\r\n            return 'a boolean';\r\n        case 'undefined':\r\n            return 'undefined';\r\n        case 'object':\r\n            if (json instanceof Array) {\r\n                return 'an array';\r\n            }\r\n            else if (json === null) {\r\n                return 'null';\r\n            }\r\n            else {\r\n                return 'an object';\r\n            }\r\n        default:\r\n            return JSON.stringify(json);\r\n    }\r\n};\r\nvar expectedGot = function (expected, got) {\r\n    return \"expected \" + expected + \", got \" + typeString(got);\r\n};\r\nvar printPath = function (paths) {\r\n    return paths.map(function (path) { return (typeof path === 'string' ? \".\" + path : \"[\" + path + \"]\"); }).join('');\r\n};\r\nvar prependAt = function (newAt, _a) {\r\n    var at = _a.at, rest = __rest(_a, [\"at\"]);\r\n    return (__assign$1({ at: newAt + (at || '') }, rest));\r\n};\r\n/**\r\n * Decoders transform json objects with unknown structure into known and\r\n * verified forms. You can create objects of type `Decoder<A>` with either the\r\n * primitive decoder functions, such as `boolean()` and `string()`, or by\r\n * applying higher-order decoders to the primitives, such as `array(boolean())`\r\n * or `dict(string())`.\r\n *\r\n * Each of the decoder functions are available both as a static method on\r\n * `Decoder` and as a function alias -- for example the string decoder is\r\n * defined at `Decoder.string()`, but is also aliased to `string()`. Using the\r\n * function aliases exported with the library is recommended.\r\n *\r\n * `Decoder` exposes a number of 'run' methods, which all decode json in the\r\n * same way, but communicate success and failure in different ways. The `map`\r\n * and `andThen` methods modify decoders without having to call a 'run' method.\r\n *\r\n * Alternatively, the main decoder `run()` method returns an object of type\r\n * `Result<A, DecoderError>`. This library provides a number of helper\r\n * functions for dealing with the `Result` type, so you can do all the same\r\n * things with a `Result` as with the decoder methods.\r\n */\r\nvar Decoder = /** @class */ (function () {\r\n    /**\r\n     * The Decoder class constructor is kept private to separate the internal\r\n     * `decode` function from the external `run` function. The distinction\r\n     * between the two functions is that `decode` returns a\r\n     * `Partial<DecoderError>` on failure, which contains an unfinished error\r\n     * report. When `run` is called on a decoder, the relevant series of `decode`\r\n     * calls is made, and then on failure the resulting `Partial<DecoderError>`\r\n     * is turned into a `DecoderError` by filling in the missing information.\r\n     *\r\n     * While hiding the constructor may seem restrictive, leveraging the\r\n     * provided decoder combinators and helper functions such as\r\n     * `andThen` and `map` should be enough to build specialized decoders as\r\n     * needed.\r\n     */\r\n    function Decoder(decode) {\r\n        var _this = this;\r\n        this.decode = decode;\r\n        /**\r\n         * Run the decoder and return a `Result` with either the decoded value or a\r\n         * `DecoderError` containing the json input, the location of the error, and\r\n         * the error message.\r\n         *\r\n         * Examples:\r\n         * ```\r\n         * number().run(12)\r\n         * // => {ok: true, result: 12}\r\n         *\r\n         * string().run(9001)\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {\r\n         * //     kind: 'DecoderError',\r\n         * //     input: 9001,\r\n         * //     at: 'input',\r\n         * //     message: 'expected a string, got 9001'\r\n         * //   }\r\n         * // }\r\n         * ```\r\n         */\r\n        this.run = function (json) {\r\n            return mapError(function (error) { return ({\r\n                kind: 'DecoderError',\r\n                input: json,\r\n                at: 'input' + (error.at || ''),\r\n                message: error.message || ''\r\n            }); }, _this.decode(json));\r\n        };\r\n        /**\r\n         * Run the decoder as a `Promise`.\r\n         */\r\n        this.runPromise = function (json) { return asPromise(_this.run(json)); };\r\n        /**\r\n         * Run the decoder and return the value on success, or throw an exception\r\n         * with a formatted error string.\r\n         */\r\n        this.runWithException = function (json) { return withException(_this.run(json)); };\r\n        /**\r\n         * Construct a new decoder that applies a transformation to the decoded\r\n         * result. If the decoder succeeds then `f` will be applied to the value. If\r\n         * it fails the error will propagated through.\r\n         *\r\n         * Example:\r\n         * ```\r\n         * number().map(x => x * 5).run(10)\r\n         * // => {ok: true, result: 50}\r\n         * ```\r\n         */\r\n        this.map = function (f) {\r\n            return new Decoder(function (json) { return map(f, _this.decode(json)); });\r\n        };\r\n        /**\r\n         * Chain together a sequence of decoders. The first decoder will run, and\r\n         * then the function will determine what decoder to run second. If the result\r\n         * of the first decoder succeeds then `f` will be applied to the decoded\r\n         * value. If it fails the error will propagate through.\r\n         *\r\n         * This is a very powerful method -- it can act as both the `map` and `where`\r\n         * methods, can improve error messages for edge cases, and can be used to\r\n         * make a decoder for custom types.\r\n         *\r\n         * Example of adding an error message:\r\n         * ```\r\n         * const versionDecoder = valueAt(['version'], number());\r\n         * const infoDecoder3 = object({a: boolean()});\r\n         *\r\n         * const decoder = versionDecoder.andThen(version => {\r\n         *   switch (version) {\r\n         *     case 3:\r\n         *       return infoDecoder3;\r\n         *     default:\r\n         *       return fail(`Unable to decode info, version ${version} is not supported.`);\r\n         *   }\r\n         * });\r\n         *\r\n         * decoder.run({version: 3, a: true})\r\n         * // => {ok: true, result: {a: true}}\r\n         *\r\n         * decoder.run({version: 5, x: 'abc'})\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {... message: 'Unable to decode info, version 5 is not supported.'}\r\n         * // }\r\n         * ```\r\n         *\r\n         * Example of decoding a custom type:\r\n         * ```\r\n         * // nominal type for arrays with a length of at least one\r\n         * type NonEmptyArray<T> = T[] & { __nonEmptyArrayBrand__: void };\r\n         *\r\n         * const nonEmptyArrayDecoder = <T>(values: Decoder<T>): Decoder<NonEmptyArray<T>> =>\r\n         *   array(values).andThen(arr =>\r\n         *     arr.length > 0\r\n         *       ? succeed(createNonEmptyArray(arr))\r\n         *       : fail(`expected a non-empty array, got an empty array`)\r\n         *   );\r\n         * ```\r\n         */\r\n        this.andThen = function (f) {\r\n            return new Decoder(function (json) {\r\n                return andThen(function (value) { return f(value).decode(json); }, _this.decode(json));\r\n            });\r\n        };\r\n        /**\r\n         * Add constraints to a decoder _without_ changing the resulting type. The\r\n         * `test` argument is a predicate function which returns true for valid\r\n         * inputs. When `test` fails on an input, the decoder fails with the given\r\n         * `errorMessage`.\r\n         *\r\n         * ```\r\n         * const chars = (length: number): Decoder<string> =>\r\n         *   string().where(\r\n         *     (s: string) => s.length === length,\r\n         *     `expected a string of length ${length}`\r\n         *   );\r\n         *\r\n         * chars(5).run('12345')\r\n         * // => {ok: true, result: '12345'}\r\n         *\r\n         * chars(2).run('HELLO')\r\n         * // => {ok: false, error: {... message: 'expected a string of length 2'}}\r\n         *\r\n         * chars(12).run(true)\r\n         * // => {ok: false, error: {... message: 'expected a string, got a boolean'}}\r\n         * ```\r\n         */\r\n        this.where = function (test, errorMessage) {\r\n            return _this.andThen(function (value) { return (test(value) ? Decoder.succeed(value) : Decoder.fail(errorMessage)); });\r\n        };\r\n    }\r\n    /**\r\n     * Decoder primitive that validates strings, and fails on all other input.\r\n     */\r\n    Decoder.string = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'string'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a string', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates numbers, and fails on all other input.\r\n     */\r\n    Decoder.number = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'number'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a number', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates booleans, and fails on all other input.\r\n     */\r\n    Decoder.boolean = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'boolean'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a boolean', json) });\r\n        });\r\n    };\r\n    Decoder.constant = function (value) {\r\n        return new Decoder(function (json) {\r\n            return isEqual(json, value)\r\n                ? ok(value)\r\n                : err({ message: \"expected \" + JSON.stringify(value) + \", got \" + JSON.stringify(json) });\r\n        });\r\n    };\r\n    Decoder.object = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json) && decoders) {\r\n                var obj = {};\r\n                for (var key in decoders) {\r\n                    if (decoders.hasOwnProperty(key)) {\r\n                        var r = decoders[key].decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            // tslint:disable-next-line:strict-type-predicates\r\n                            if (r.result !== undefined) {\r\n                                obj[key] = r.result;\r\n                            }\r\n                        }\r\n                        else if (json[key] === undefined) {\r\n                            return err({ message: \"the key '\" + key + \"' is required but was not present\" });\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else if (isJsonObject(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.array = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json) && decoder) {\r\n                var decodeValue_1 = function (v, i) {\r\n                    return mapError(function (err$$1) { return prependAt(\"[\" + i + \"]\", err$$1); }, decoder.decode(v));\r\n                };\r\n                return json.reduce(function (acc, v, i) {\r\n                    return map2(function (arr, result) { return arr.concat([result]); }, acc, decodeValue_1(v, i));\r\n                }, ok([]));\r\n            }\r\n            else if (isJsonArray(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an array', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.tuple = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json)) {\r\n                if (json.length !== decoders.length) {\r\n                    return err({\r\n                        message: \"expected a tuple of length \" + decoders.length + \", got one of length \" + json.length\r\n                    });\r\n                }\r\n                var result = [];\r\n                for (var i = 0; i < decoders.length; i++) {\r\n                    var nth = decoders[i].decode(json[i]);\r\n                    if (nth.ok) {\r\n                        result[i] = nth.result;\r\n                    }\r\n                    else {\r\n                        return err(prependAt(\"[\" + i + \"]\", nth.error));\r\n                    }\r\n                }\r\n                return ok(result);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot(\"a tuple of length \" + decoders.length, json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.union = function (ad, bd) {\r\n        var decoders = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            decoders[_i - 2] = arguments[_i];\r\n        }\r\n        return Decoder.oneOf.apply(Decoder, [ad, bd].concat(decoders));\r\n    };\r\n    Decoder.intersection = function (ad, bd) {\r\n        var ds = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            ds[_i - 2] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            return [ad, bd].concat(ds).reduce(function (acc, decoder) { return map2(Object.assign, acc, decoder.decode(json)); }, ok({}));\r\n        });\r\n    };\r\n    /**\r\n     * Escape hatch to bypass validation. Always succeeds and types the result as\r\n     * `any`. Useful for defining decoders incrementally, particularly for\r\n     * complex objects.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   name: string;\r\n     *   complexUserData: ComplexType;\r\n     * }\r\n     *\r\n     * const userDecoder: Decoder<User> = object({\r\n     *   name: string(),\r\n     *   complexUserData: anyJson()\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.anyJson = function () { return new Decoder(function (json) { return ok(json); }); };\r\n    /**\r\n     * Decoder identity function which always succeeds and types the result as\r\n     * `unknown`.\r\n     */\r\n    Decoder.unknownJson = function () {\r\n        return new Decoder(function (json) { return ok(json); });\r\n    };\r\n    /**\r\n     * Decoder for json objects where the keys are unknown strings, but the values\r\n     * should all be of the same type.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * dict(number()).run({chocolate: 12, vanilla: 10, mint: 37});\r\n     * // => {ok: true, result: {chocolate: 12, vanilla: 10, mint: 37}}\r\n     * ```\r\n     */\r\n    Decoder.dict = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json)) {\r\n                var obj = {};\r\n                for (var key in json) {\r\n                    if (json.hasOwnProperty(key)) {\r\n                        var r = decoder.decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            obj[key] = r.result;\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Decoder for values that may be `undefined`. This is primarily helpful for\r\n     * decoding interfaces with optional fields.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   id: number;\r\n     *   isOwner?: boolean;\r\n     * }\r\n     *\r\n     * const decoder: Decoder<User> = object({\r\n     *   id: number(),\r\n     *   isOwner: optional(boolean())\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.optional = function (decoder) {\r\n        return new Decoder(function (json) { return (json === undefined ? ok(undefined) : decoder.decode(json)); });\r\n    };\r\n    /**\r\n     * Decoder that attempts to run each decoder in `decoders` and either succeeds\r\n     * with the first successful decoder, or fails after all decoders have failed.\r\n     *\r\n     * Note that `oneOf` expects the decoders to all have the same return type,\r\n     * while `union` creates a decoder for the union type of all the input\r\n     * decoders.\r\n     *\r\n     * Examples:\r\n     * ```\r\n     * oneOf(string(), number().map(String))\r\n     * oneOf(constant('start'), constant('stop'), succeed('unknown'))\r\n     * ```\r\n     */\r\n    Decoder.oneOf = function () {\r\n        var decoders = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            decoders[_i] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            var errors = [];\r\n            for (var i = 0; i < decoders.length; i++) {\r\n                var r = decoders[i].decode(json);\r\n                if (r.ok === true) {\r\n                    return r;\r\n                }\r\n                else {\r\n                    errors[i] = r.error;\r\n                }\r\n            }\r\n            var errorsList = errors\r\n                .map(function (error) { return \"at error\" + (error.at || '') + \": \" + error.message; })\r\n                .join('\", \"');\r\n            return err({\r\n                message: \"expected a value matching one of the decoders, got the errors [\\\"\" + errorsList + \"\\\"]\"\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that always succeeds with either the decoded value, or a fallback\r\n     * default value.\r\n     */\r\n    Decoder.withDefault = function (defaultValue, decoder) {\r\n        return new Decoder(function (json) {\r\n            return ok(withDefault(defaultValue, decoder.decode(json)));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that pulls a specific field out of a json structure, instead of\r\n     * decoding and returning the full structure. The `paths` array describes the\r\n     * object keys and array indices to traverse, so that values can be pulled out\r\n     * of a nested structure.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * const decoder = valueAt(['a', 'b', 0], string());\r\n     *\r\n     * decoder.run({a: {b: ['surprise!']}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * decoder.run({a: {x: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b[0]' message: 'path does not exist'}}\r\n     * ```\r\n     *\r\n     * Note that the `decoder` is ran on the value found at the last key in the\r\n     * path, even if the last key is not found. This allows the `optional`\r\n     * decoder to succeed when appropriate.\r\n     * ```\r\n     * const optionalDecoder = valueAt(['a', 'b', 'c'], optional(string()));\r\n     *\r\n     * optionalDecoder.run({a: {b: {c: 'surprise!'}}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * optionalDecoder.run({a: {b: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b.c' message: 'expected an object, got \"cats\"'}\r\n     *\r\n     * optionalDecoder.run({a: {b: {z: 1}}})\r\n     * // => {ok: true, result: undefined}\r\n     * ```\r\n     */\r\n    Decoder.valueAt = function (paths, decoder) {\r\n        return new Decoder(function (json) {\r\n            var jsonAtPath = json;\r\n            for (var i = 0; i < paths.length; i++) {\r\n                if (jsonAtPath === undefined) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: 'path does not exist'\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'string' && !isJsonObject(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an object', jsonAtPath)\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'number' && !isJsonArray(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an array', jsonAtPath)\r\n                    });\r\n                }\r\n                else {\r\n                    jsonAtPath = jsonAtPath[paths[i]];\r\n                }\r\n            }\r\n            return mapError(function (error) {\r\n                return jsonAtPath === undefined\r\n                    ? { at: printPath(paths), message: 'path does not exist' }\r\n                    : prependAt(printPath(paths), error);\r\n            }, decoder.decode(jsonAtPath));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always succeeds with `fixedValue`.\r\n     */\r\n    Decoder.succeed = function (fixedValue) {\r\n        return new Decoder(function (json) { return ok(fixedValue); });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always fails with `errorMessage`.\r\n     */\r\n    Decoder.fail = function (errorMessage) {\r\n        return new Decoder(function (json) { return err({ message: errorMessage }); });\r\n    };\r\n    /**\r\n     * Decoder that allows for validating recursive data structures. Unlike with\r\n     * functions, decoders assigned to variables can't reference themselves\r\n     * before they are fully defined. We can avoid prematurely referencing the\r\n     * decoder by wrapping it in a function that won't be called until use, at\r\n     * which point the decoder has been defined.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface Comment {\r\n     *   msg: string;\r\n     *   replies: Comment[];\r\n     * }\r\n     *\r\n     * const decoder: Decoder<Comment> = object({\r\n     *   msg: string(),\r\n     *   replies: lazy(() => array(decoder))\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.lazy = function (mkDecoder) {\r\n        return new Decoder(function (json) { return mkDecoder().decode(json); });\r\n    };\r\n    return Decoder;\r\n}());\n\n/* tslint:disable:variable-name */\r\n/** See `Decoder.string` */\r\nvar string = Decoder.string;\r\n/** See `Decoder.number` */\r\nvar number = Decoder.number;\r\n/** See `Decoder.boolean` */\r\nvar boolean = Decoder.boolean;\r\n/** See `Decoder.anyJson` */\r\nvar anyJson = Decoder.anyJson;\r\n/** See `Decoder.constant` */\r\nvar constant = Decoder.constant;\r\n/** See `Decoder.object` */\r\nvar object = Decoder.object;\r\n/** See `Decoder.array` */\r\nvar array = Decoder.array;\r\n/** See `Decoder.optional` */\r\nvar optional = Decoder.optional;\r\n/** See `Decoder.oneOf` */\r\nvar oneOf = Decoder.oneOf;\r\n/** See `Decoder.lazy` */\r\nvar lazy = Decoder.lazy;\n\nvar nonEmptyStringDecoder = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\n\nvar windowLayoutItemDecoder = object({\r\n    type: constant(\"window\"),\r\n    config: object({\r\n        appName: nonEmptyStringDecoder,\r\n        url: optional(nonEmptyStringDecoder)\r\n    })\r\n});\r\nvar groupLayoutItemDecoder = object({\r\n    type: constant(\"group\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(windowLayoutItemDecoder))\r\n});\r\nvar columnLayoutItemDecoder = object({\r\n    type: constant(\"column\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return columnLayoutItemDecoder; }), lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar rowLayoutItemDecoder = object({\r\n    type: constant(\"row\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar workspaceComponentDecoder = object({\r\n    type: constant(\"Workspace\"),\r\n    state: object({\r\n        config: anyJson(),\r\n        children: array(oneOf(rowLayoutItemDecoder, columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder))\r\n    })\r\n});\n\nvar windowComponentDecoder = object({\r\n    type: constant(\"window\"),\r\n    componentType: constant(\"application\"),\r\n    state: object({\r\n        name: anyJson(),\r\n        context: anyJson(),\r\n        url: nonEmptyStringDecoder,\r\n        bounds: anyJson(),\r\n        id: nonEmptyStringDecoder,\r\n        parentId: optional(nonEmptyStringDecoder),\r\n        main: boolean()\r\n    })\r\n});\n\nvar layoutTypeDecoder = oneOf(constant(\"Global\"), constant(\"Workspace\"));\r\nvar newLayoutOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson())\r\n});\r\nvar restoreOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    closeRunningInstance: optional(boolean())\r\n});\r\nvar layoutDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    type: layoutTypeDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson()),\r\n    components: array(oneOf(workspaceComponentDecoder, windowComponentDecoder))\r\n});\n\nvar Layouts = (function () {\r\n    function Layouts(controller) {\r\n        this.controller = controller;\r\n    }\r\n    Layouts.prototype.getAll = function (type) {\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.getAll(type);\r\n    };\r\n    Layouts.prototype.get = function (name, type) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.get(name, type);\r\n    };\r\n    Layouts.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (layoutType) {\r\n                    layoutTypeDecoder.runWithException(layoutType);\r\n                }\r\n                return [2, this.controller.export(layoutType)];\r\n            });\r\n        });\r\n    };\r\n    Layouts.prototype.import = function (layouts) {\r\n        layouts.forEach(function (layout) { return layoutDecoder.runWithException(layout); });\r\n        return this.controller.import(layouts);\r\n    };\r\n    Layouts.prototype.save = function (layout) {\r\n        newLayoutOptionsDecoder.runWithException(layout);\r\n        return this.controller.save(layout);\r\n    };\r\n    Layouts.prototype.restore = function (options) {\r\n        restoreOptionsDecoder.runWithException(options);\r\n        return this.controller.restore(options);\r\n    };\r\n    Layouts.prototype.remove = function (type, name) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.remove(type, name);\r\n    };\r\n    return Layouts;\r\n}());\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n        this.setContextDataToEmptyObjIfMissing = function (context) {\r\n            return __assign(__assign({}, context), { data: context.data || {} });\r\n        };\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        var _this = this;\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n            var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n            callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n                                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                                if (_this.callback) {\r\n                                    _this.callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.set(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (context) {\r\n                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                resolve(contextWithDataObj);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.updateChannel = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        var newData = {\r\n            name: data.name,\r\n            meta: data.meta\r\n        };\r\n        if ((data === null || data === void 0 ? void 0 : data.data) && !this.isEmptyObject(data.data)) {\r\n            newData.data = data.data;\r\n        }\r\n        return this.contexts.update(contextName, newData);\r\n    };\r\n    SharedContextSubscriber.prototype.updateData = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        if (this.contexts.setPathSupported) {\r\n            var pathValues = Object.keys(data).map(function (key) {\r\n                return {\r\n                    path: \"data.\" + key,\r\n                    value: data[key]\r\n                };\r\n            });\r\n            return this.contexts.setPaths(contextName, pathValues);\r\n        }\r\n        else {\r\n            return this.contexts.update(contextName, { data: data });\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return \"\" + CONTEXT_PREFIX + name;\r\n    };\r\n    SharedContextSubscriber.prototype.isEmptyObject = function (obj) {\r\n        return Object.keys(obj).length === 0 && obj.constructor === Object;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar Channels = (function () {\r\n    function Channels(contexts, channels) {\r\n        var _this = this;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$1();\r\n        this.shared = new SharedContextSubscriber(contexts);\r\n        this.shared.subscribe(this.handler.bind(this));\r\n        this.readyPromise = Promise.resolve(channels === null || channels === void 0 ? void 0 : channels.reduce(function (promise, channel) {\r\n            return promise.then(function () { return _this.add(channel); });\r\n        }, Promise.resolve({})));\r\n    }\r\n    Channels.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    Channels.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.publish = function (data, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof data !== \"object\") {\r\n                    throw new Error(\"Please provide the data as an object!\");\r\n                }\r\n                if (name) {\r\n                    if (typeof name !== \"string\") {\r\n                        throw new Error(\"Please provide the name as a string!\");\r\n                    }\r\n                    if (!this.shared.isChannel(name)) {\r\n                        throw new Error(\"A channel with name: \" + name + \" doesn't exist!\");\r\n                    }\r\n                    return [2, this.shared.updateData(name, data)];\r\n                }\r\n                if (!this.currentContext) {\r\n                    throw new Error(\"Not joined to any channel!\");\r\n                }\r\n                return [2, this.shared.updateData(this.currentContext, data)];\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    Channels.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    Channels.prototype.join = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.currentContext = name;\r\n                        return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.leave = function () {\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        return Promise.resolve();\r\n    };\r\n    Channels.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    Channels.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    Channels.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    Channels.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    Channels.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta,\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.updateChannel(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Channels.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    return Channels;\r\n}());\n\nvar fetchTimeout = function (url, timeoutMilliseconds) {\r\n    if (timeoutMilliseconds === void 0) { timeoutMilliseconds = 1000; }\r\n    return new Promise(function (resolve, reject) {\r\n        var timeoutHit = false;\r\n        var timeout = setTimeout(function () {\r\n            timeoutHit = true;\r\n            reject(new Error(\"Fetch request for: \" + url + \" timed out at: \" + timeoutMilliseconds + \" milliseconds\"));\r\n        }, timeoutMilliseconds);\r\n        fetch(url)\r\n            .then(function (response) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                resolve(response);\r\n            }\r\n        })\r\n            .catch(function (err) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                reject(err);\r\n            }\r\n        });\r\n    });\r\n};\n\nvar promisePlus = function (promise, timeoutMilliseconds, timeoutMessage) {\r\n    return new Promise(function (resolve, reject) {\r\n        var timeout = setTimeout(function () {\r\n            var message = timeoutMessage || \"Promise timeout hit: \" + timeoutMilliseconds;\r\n            reject(message);\r\n        }, timeoutMilliseconds);\r\n        promise()\r\n            .then(function (result) {\r\n            clearTimeout(timeout);\r\n            resolve(result);\r\n        })\r\n            .catch(function (error) {\r\n            clearTimeout(timeout);\r\n            reject(error);\r\n        });\r\n    });\r\n};\n\nvar Application = (function () {\r\n    function Application(_appManager, _props, _windows) {\r\n        var _this = this;\r\n        var _a, _b, _c, _d;\r\n        this._appManager = _appManager;\r\n        this._props = _props;\r\n        this._windows = _windows;\r\n        this._registry = lib$1();\r\n        this.start = function (context, options) {\r\n            return promisePlus(function () { return _this.startWithoutTimeout(context, options); }, 3000, \"Application \\\"\" + _this.name + \"\\\" start timeout!\");\r\n        };\r\n        if (typeof ((_a = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) === \"undefined\") {\r\n            this._url = (_c = (_b = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _b === void 0 ? void 0 : _b.details) === null || _c === void 0 ? void 0 : _c.url;\r\n        }\r\n        else {\r\n            var parsedManifest = JSON.parse(_props.userProperties.manifest);\r\n            this._url = ((_d = parsedManifest.details) === null || _d === void 0 ? void 0 : _d.url) || parsedManifest.url;\r\n        }\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStarted\", instance);\r\n            }\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStopped\", instance);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(Application.prototype, \"name\", {\r\n        get: function () {\r\n            return this._props.name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"title\", {\r\n        get: function () {\r\n            return this._props.title || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"version\", {\r\n        get: function () {\r\n            return this._props.version || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"userProperties\", {\r\n        get: function () {\r\n            return this._props.userProperties || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this.name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Application.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    Application.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    Application.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        var url = typeof ((_a = props === null || props === void 0 ? void 0 : props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) !== \"undefined\" ? JSON.parse(props === null || props === void 0 ? void 0 : props.userProperties.manifest).url : (_b = props === null || props === void 0 ? void 0 : props.userProperties) === null || _b === void 0 ? void 0 : _b.details.url;\r\n        this._url = url;\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    Application.prototype.startWithoutTimeout = function (context, options) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openOptions, appWindow, unsubscribeFunc, resolveCallback, startedAppsWindowIdsToInstances, checkResolveCondition, appInstanceStartedPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        openOptions = __assign(__assign(__assign({}, (_b = (_a = this._props) === null || _a === void 0 ? void 0 : _a.userProperties) === null || _b === void 0 ? void 0 : _b.details), options), { context: context || (options === null || options === void 0 ? void 0 : options.context) });\r\n                        if (!this._url) {\r\n                            throw new Error(\"Application \" + this.name + \" doesn't have a URL.\");\r\n                        }\r\n                        startedAppsWindowIdsToInstances = {};\r\n                        checkResolveCondition = function () {\r\n                            if (typeof appWindow !== \"undefined\") {\r\n                                var instance = startedAppsWindowIdsToInstances[appWindow.id];\r\n                                if (typeof instance !== \"undefined\") {\r\n                                    unsubscribeFunc();\r\n                                    return resolveCallback(instance);\r\n                                }\r\n                            }\r\n                        };\r\n                        appInstanceStartedPromise = new Promise(function (resolve) {\r\n                            resolveCallback = resolve;\r\n                            unsubscribeFunc = _this._appManager.onInstanceStarted(function (startedInstance) {\r\n                                var windowId = startedInstance.agm.windowId;\r\n                                if (typeof windowId !== \"undefined\") {\r\n                                    startedAppsWindowIdsToInstances[windowId] = startedInstance;\r\n                                    checkResolveCondition();\r\n                                }\r\n                            });\r\n                        });\r\n                        return [4, this._windows.open(this.name, this._url, openOptions)];\r\n                    case 1:\r\n                        appWindow = _c.sent();\r\n                        checkResolveCondition();\r\n                        return [2, appInstanceStartedPromise];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Application;\r\n}());\n\nvar RemoteInstance = (function () {\r\n    function RemoteInstance(id, application, control, context, agm) {\r\n        this.id = id;\r\n        this.application = application;\r\n        this.control = control;\r\n        this.context = context;\r\n        this.agm = agm;\r\n        this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND = \"Peer has left while waiting for result\";\r\n    }\r\n    RemoteInstance.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, this.callControl(\"stop\", {}, false)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        if (error_1.message !== this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND) {\r\n                            throw new Error(error_1);\r\n                        }\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteInstance.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return this.control.send({ command: command, domain: \"appManager\", args: args, skipResult: skipResult }, { instance: this.id });\r\n    };\r\n    return RemoteInstance;\r\n}());\n\nvar LocalInstance = (function () {\r\n    function LocalInstance(id, control, _appManager, agm) {\r\n        this.id = id;\r\n        this.control = control;\r\n        this._appManager = _appManager;\r\n        this.agm = agm;\r\n        this.context = {};\r\n        this.startedByScript = false;\r\n        this.application = undefined;\r\n        control.setLocalInstance(this);\r\n    }\r\n    LocalInstance.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (_this.startedByScript) {\r\n                var unsubscribe_1 = _this._appManager.onInstanceStopped(function (instance) {\r\n                    if (instance.id === _this.id) {\r\n                        unsubscribe_1();\r\n                        resolve();\r\n                    }\r\n                });\r\n                window.close();\r\n            }\r\n            else {\r\n                reject(\"Can't close a window that wasn't started by a script.\");\r\n            }\r\n        });\r\n    };\r\n    return LocalInstance;\r\n}());\n\nvar nonEmptyStringDecoder$1 = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\r\nvar fdc3AppImageDecoder = object({\r\n    url: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IconDecoder = object({\r\n    icon: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IntentDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    displayName: optional(string()),\r\n    contexts: optional(array(string())),\r\n    customConfig: optional(object())\r\n});\r\nvar glue42CoreCreateOptionsDecoder = object({\r\n    url: nonEmptyStringDecoder$1,\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    width: optional(number()),\r\n    height: optional(number()),\r\n    context: optional(anyJson()),\r\n    relativeTo: optional(nonEmptyStringDecoder$1),\r\n    relativeDirection: optional(oneOf(constant(\"top\"), constant(\"left\"), constant(\"right\"), constant(\"bottom\")))\r\n});\r\nvar fdc3ApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    appId: nonEmptyStringDecoder$1,\r\n    manifest: nonEmptyStringDecoder$1,\r\n    manifestType: nonEmptyStringDecoder$1,\r\n    tooltip: optional(string()),\r\n    description: optional(string()),\r\n    contactEmail: optional(string()),\r\n    supportEmail: optional(string()),\r\n    publisher: optional(string()),\r\n    images: optional(array(fdc3AppImageDecoder)),\r\n    icons: optional(array(fdc3IconDecoder)),\r\n    customConfig: optional(object()),\r\n    intents: optional(array(fdc3IntentDecoder))\r\n});\r\nvar glue42CoreApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    details: glue42CoreCreateOptionsDecoder,\r\n    customProperties: optional(object())\r\n});\n\nvar AppManager = (function () {\r\n    function AppManager(windows, interop, control, config, appName) {\r\n        var _this = this;\r\n        this.windows = windows;\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.config = config;\r\n        this.appName = appName;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this.registry = lib$1();\r\n        this.DEFAULT_POLLING_INTERVAL = 3000;\r\n        this.OKAY_MESSAGE = \"OK\";\r\n        this.LOCAL_SOURCE = \"LOCAL_SOURCE\";\r\n        var myId = interop.instance.instance;\r\n        this._myInstance = new LocalInstance(myId, this.control, this, this.interop.instance);\r\n        if (config === null || config === void 0 ? void 0 : config.remoteSources) {\r\n            this.readyPromise = this.subscribeForRemoteApplications(config.remoteSources);\r\n        }\r\n        if (config === null || config === void 0 ? void 0 : config.localApplications) {\r\n            var validatedApplications = this.getValidatedApplications(config.localApplications);\r\n            this.addApplications(validatedApplications);\r\n        }\r\n        control.onStart(function () {\r\n            _this.trackInstanceLifetime();\r\n        });\r\n    }\r\n    Object.defineProperty(AppManager.prototype, \"myInstance\", {\r\n        get: function () {\r\n            if (!this.appName) {\r\n                console.warn(\"application wasn't provided to the GlueWeb factory function!\");\r\n            }\r\n            if (!this._myInstance) {\r\n                console.warn(\"The application isn't defined in any of the local/remote application sources!\");\r\n            }\r\n            return this._myInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AppManager.prototype.application = function (name) {\r\n        var _a;\r\n        return (_a = this._apps[name]) === null || _a === void 0 ? void 0 : _a.application;\r\n    };\r\n    AppManager.prototype.applications = function () {\r\n        var _this = this;\r\n        return Object.keys(this._apps).map(function (appName) { return _this._apps[appName].application; });\r\n    };\r\n    AppManager.prototype.instances = function () {\r\n        return this._instances;\r\n    };\r\n    AppManager.prototype.onAppAdded = function (callback) {\r\n        var _this = this;\r\n        var applications = Object.keys(this._apps).map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        this.replay(applications, callback);\r\n        return this.registry.add(\"appAdded\", callback);\r\n    };\r\n    AppManager.prototype.onAppRemoved = function (callback) {\r\n        return this.registry.add(\"appRemoved\", callback);\r\n    };\r\n    AppManager.prototype.onAppChanged = function (callback) {\r\n        return this.registry.add(\"appChanged\", callback);\r\n    };\r\n    AppManager.prototype.onInstanceStarted = function (callback) {\r\n        return this.registry.add(\"instanceStarted\", callback);\r\n    };\r\n    AppManager.prototype.onInstanceStopped = function (callback) {\r\n        return this.registry.add(\"instanceStopped\", callback);\r\n    };\r\n    AppManager.prototype.ready = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, this.readyPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getValidatedApplications = function (applications) {\r\n        var verifiedApplications = applications.filter(function (application) {\r\n            var isFDC3App = typeof application.manifest !== \"undefined\";\r\n            var isValid;\r\n            if (isFDC3App) {\r\n                isValid = fdc3ApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            else {\r\n                isValid = glue42CoreApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            if (!isValid) {\r\n                console.warn(\"Validation failed for application \\\"\" + application.name + \"\\\"!\");\r\n            }\r\n            return isValid;\r\n        });\r\n        return verifiedApplications;\r\n    };\r\n    AppManager.prototype.subscribeForRemoteApplications = function (remoteSources) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var initialFetchAppsPromises, _loop_1, this_1, _i, remoteSources_1, remoteSource;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        initialFetchAppsPromises = [];\r\n                        _loop_1 = function (remoteSource) {\r\n                            var url = remoteSource.url;\r\n                            var appsFetch = function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                var response, json, validatedApplications;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0: return [4, fetchTimeout(url, 1000)];\r\n                                        case 1:\r\n                                            response = _a.sent();\r\n                                            return [4, response.json()];\r\n                                        case 2:\r\n                                            json = (_a.sent());\r\n                                            if (json.message === this.OKAY_MESSAGE) {\r\n                                                validatedApplications = this.getValidatedApplications(json.applications);\r\n                                                this.addApplications(validatedApplications, url);\r\n                                            }\r\n                                            return [2];\r\n                                    }\r\n                                });\r\n                            }); };\r\n                            initialFetchAppsPromises.push(appsFetch());\r\n                            setInterval(function () { return appsFetch().catch(console.warn); }, remoteSource.pollingInterval || this_1.DEFAULT_POLLING_INTERVAL);\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, remoteSources_1 = remoteSources; _i < remoteSources_1.length; _i++) {\r\n                            remoteSource = remoteSources_1[_i];\r\n                            _loop_1(remoteSource);\r\n                        }\r\n                        return [4, Promise.all(initialFetchAppsPromises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getAppProps = function (application) {\r\n        var requiredProps = [\"name\", \"title\", \"version\"];\r\n        var userProperties = Object.fromEntries(Object.entries(application).filter(function (_a) {\r\n            var key = _a[0];\r\n            return !requiredProps.includes(key);\r\n        }));\r\n        return {\r\n            name: application.name,\r\n            title: application.title,\r\n            version: application.version,\r\n            userProperties: userProperties\r\n        };\r\n    };\r\n    AppManager.prototype.handleAppsChanged = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var _loop_2 = function (newlyAddedApplication) {\r\n            var currentApplicationWithTheSameNameAndSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source === source;\r\n            });\r\n            var currentApplicationWithTheSameNameButDifferentSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source !== source;\r\n            });\r\n            if (currentApplicationWithTheSameNameAndSource) {\r\n                var currentApplication = this_2._apps[currentApplicationWithTheSameNameAndSource];\r\n                var appProps = this_2.getAppProps(newlyAddedApplication);\r\n                if (JSON.stringify(currentApplication.appProps) !== JSON.stringify(appProps)) {\r\n                    var newlyAddedApplicationInstance = new Application(this_2, appProps, this_2.windows);\r\n                    this_2.registry.execute(\"appChanged\", newlyAddedApplicationInstance);\r\n                    this_2._apps[newlyAddedApplication.name] = {\r\n                        source: currentApplication.source,\r\n                        application: newlyAddedApplicationInstance,\r\n                        appProps: appProps\r\n                    };\r\n                }\r\n            }\r\n            else if (currentApplicationWithTheSameNameButDifferentSource) {\r\n                console.warn(\"Application \\\"\" + newlyAddedApplication.name + \"\\\" already defined by source \\\"\" + this_2._apps[currentApplicationWithTheSameNameButDifferentSource].source + \"\\\". Skipping application definition from source \" + source + \".\");\r\n            }\r\n        };\r\n        var this_2 = this;\r\n        for (var _i = 0, newlyAddedApplications_1 = newlyAddedApplications; _i < newlyAddedApplications_1.length; _i++) {\r\n            var newlyAddedApplication = newlyAddedApplications_1[_i];\r\n            _loop_2(newlyAddedApplication);\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsAdded = function (newlyAddedApplications, source) {\r\n        var currentAppNames = Object.keys(this._apps);\r\n        var newApplications = newlyAddedApplications.filter(function (newlyAddedApplication) {\r\n            return !currentAppNames.includes(newlyAddedApplication.name);\r\n        });\r\n        for (var _i = 0, newApplications_1 = newApplications; _i < newApplications_1.length; _i++) {\r\n            var newApplication = newApplications_1[_i];\r\n            var appProps = this.getAppProps(newApplication);\r\n            var newApplicationInstance = new Application(this, appProps, this.windows);\r\n            this.registry.execute(\"appAdded\", newApplicationInstance);\r\n            this._apps[newApplication.name] = {\r\n                source: source || this.LOCAL_SOURCE,\r\n                application: newApplicationInstance,\r\n                appProps: appProps\r\n            };\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsRemoved = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var currentApplicationsFromThisSource = Object.keys(this._apps)\r\n            .filter(function (appName) {\r\n            return _this._apps[appName].source === source;\r\n        })\r\n            .map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        var newlyAddedApplicationNames = newlyAddedApplications.map(function (newlyAddedApplication) {\r\n            return newlyAddedApplication.name;\r\n        });\r\n        var removedApplications = currentApplicationsFromThisSource.filter(function (currentApplicationFromThisSource) {\r\n            return !newlyAddedApplicationNames.includes(currentApplicationFromThisSource.name);\r\n        });\r\n        for (var _i = 0, removedApplications_1 = removedApplications; _i < removedApplications_1.length; _i++) {\r\n            var removedApplication = removedApplications_1[_i];\r\n            this.registry.execute(\"appRemoved\", removedApplication);\r\n            delete this._apps[removedApplication.name];\r\n        }\r\n    };\r\n    AppManager.prototype.tryPopulateMyInstanceApplication = function () {\r\n        var _this = this;\r\n        var _a;\r\n        if (this.appName) {\r\n            var myApp = (_a = Object.values(this._apps).find(function (app) { return app.application.name === _this.appName; })) === null || _a === void 0 ? void 0 : _a.application;\r\n            if (myApp) {\r\n                if (myApp.title) {\r\n                    document.title = myApp.title;\r\n                }\r\n                this._myInstance.application = myApp;\r\n            }\r\n        }\r\n    };\r\n    AppManager.prototype.addApplications = function (newlyAddedApplications, source) {\r\n        this.handleAppsChanged(newlyAddedApplications, source);\r\n        this.handleAppsAdded(newlyAddedApplications, source);\r\n        this.handleAppsRemoved(newlyAddedApplications, source);\r\n        if (!this._myInstance.application) {\r\n            this.tryPopulateMyInstanceApplication();\r\n        }\r\n    };\r\n    AppManager.prototype.replay = function (items, callback) {\r\n        var itemsToReplay = Array.isArray(items) ? items : Object.values(items);\r\n        itemsToReplay.forEach(function (item) { return callback(item); });\r\n    };\r\n    AppManager.prototype.remoteFromServer = function (server) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var serverApp, id, app, appWindow, context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        serverApp = server.application;\r\n                        if (!server.instance || !serverApp || !this._apps[serverApp]) {\r\n                            return [2, undefined];\r\n                        }\r\n                        id = server.instance;\r\n                        app = this._apps[serverApp].application;\r\n                        appWindow = this.windows.list().find(function (window) { return window.id === server.windowId; });\r\n                        return [4, (appWindow === null || appWindow === void 0 ? void 0 : appWindow.getContext())];\r\n                    case 1:\r\n                        context = _a.sent();\r\n                        return [2, new RemoteInstance(id, app, this.control, context, server)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.trackInstanceLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var remoteInstance;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            if (method.name !== Control.CONTROL_METHOD) {\r\n                                return [2];\r\n                            }\r\n                            return [4, this.remoteFromServer(server)];\r\n                        case 1:\r\n                            remoteInstance = _b.sent();\r\n                            if (remoteInstance) {\r\n                                this._instances.push(remoteInstance);\r\n                                this.registry.execute(\"instanceStarted\", remoteInstance);\r\n                            }\r\n                            return [2];\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        this.interop.serverRemoved(function (server) { return __awaiter(_this, void 0, void 0, function () {\r\n            var remoteInstance;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.remoteFromServer(server)];\r\n                    case 1:\r\n                        remoteInstance = _a.sent();\r\n                        if (remoteInstance) {\r\n                            this._instances = this._instances.filter(function (instance) { return instance.id !== remoteInstance.id; });\r\n                            this.registry.execute(\"instanceStopped\", remoteInstance);\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        }); });\r\n    };\r\n    return AppManager;\r\n}());\n\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n    }\r\n    Notifications.prototype.raise = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionPromise, notification, interopOptions_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(\"Notification\" in window)) {\r\n                            throw new Error(\"this browser does not support desktop notification\");\r\n                        }\r\n                        if (Notification.permission === \"granted\") {\r\n                            permissionPromise = Promise.resolve(\"granted\");\r\n                        }\r\n                        else if (Notification.permission === \"denied\") {\r\n                            permissionPromise = Promise.reject(\"no permissions from user\");\r\n                        }\r\n                        else {\r\n                            permissionPromise = Notification.requestPermission();\r\n                        }\r\n                        return [4, permissionPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        notification = this.raiseUsingWebApi(options);\r\n                        if (options.clickInterop) {\r\n                            interopOptions_1 = options.clickInterop;\r\n                            notification.onclick = function () {\r\n                                var _a, _b;\r\n                                _this.interop.invoke(interopOptions_1.method, (_a = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.arguments) !== null && _a !== void 0 ? _a : {}, (_b = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.target) !== null && _b !== void 0 ? _b : \"best\");\r\n                            };\r\n                        }\r\n                        return [2, notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.raiseUsingWebApi = function (options) {\r\n        return new Notification(options.title, options);\r\n    };\r\n    return Notifications;\r\n}());\n\nvar defaultAssetsBaseLocation = \"/glue\";\r\nvar defaultWorkerName = \"worker.js\";\r\nvar defaultConfigName = \"glue.config.json\";\r\nvar defaultLayoutsName = \"glue.layouts.json\";\r\nvar defaultWorkerLocation = defaultAssetsBaseLocation + \"/\" + defaultWorkerName;\r\nvar defaultConfig = {\r\n    layouts: {\r\n        autoRestore: false,\r\n        autoSaveWindowContext: false\r\n    },\r\n    logger: \"error\",\r\n    assets: {\r\n        location: defaultAssetsBaseLocation\r\n    },\r\n    channels: false,\r\n    appManager: false,\r\n    libraries: []\r\n};\n\nvar getRemoteConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfigLocation, response, json, _a;\r\n    var _b, _c;\r\n    return __generator(this, function (_d) {\r\n        switch (_d.label) {\r\n            case 0:\r\n                if (((_b = userConfig.assets) === null || _b === void 0 ? void 0 : _b.extendConfig) === false || userConfig.extends === false) {\r\n                    return [2, {}];\r\n                }\r\n                remoteConfigLocation = ((_c = userConfig.assets) === null || _c === void 0 ? void 0 : _c.location) ? userConfig.assets.location + \"/\" + defaultConfigName :\r\n                    typeof userConfig.extends === \"string\" ? userConfig.extends :\r\n                        defaultAssetsBaseLocation + \"/\" + defaultConfigName;\r\n                _d.label = 1;\r\n            case 1:\r\n                _d.trys.push([1, 4, , 5]);\r\n                return [4, fetchTimeout(remoteConfigLocation)];\r\n            case 2:\r\n                response = _d.sent();\r\n                if (!response.ok) {\r\n                    return [2, {}];\r\n                }\r\n                return [4, response.json()];\r\n            case 3:\r\n                json = _d.sent();\r\n                return [2, json !== null && json !== void 0 ? json : {}];\r\n            case 4:\r\n                _a = _d.sent();\r\n                return [2, {}];\r\n            case 5: return [2];\r\n        }\r\n    });\r\n}); };\r\nvar buildConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfig, resultWebConfig, lastIndex, worker;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                userConfig = userConfig !== null && userConfig !== void 0 ? userConfig : {};\r\n                return [4, getRemoteConfig(userConfig)];\r\n            case 1:\r\n                remoteConfig = _a.sent();\r\n                resultWebConfig = __assign(__assign(__assign({}, defaultConfig), remoteConfig.glue), userConfig);\r\n                resultWebConfig.worker = resultWebConfig.assets.location + \"/\" + defaultWorkerName;\r\n                if (typeof (resultWebConfig === null || resultWebConfig === void 0 ? void 0 : resultWebConfig.extends) === \"string\") {\r\n                    lastIndex = resultWebConfig.extends.lastIndexOf(\"/\");\r\n                    worker = resultWebConfig.extends.substr(0, lastIndex + 1) + defaultWorkerName;\r\n                    resultWebConfig.worker = worker;\r\n                }\r\n                if (!remoteConfig.layouts) {\r\n                    remoteConfig.layouts = { remoteType: \"json\" };\r\n                }\r\n                return [2, __assign(__assign({}, remoteConfig), { glue: resultWebConfig })];\r\n        }\r\n    });\r\n}); };\n\nvar dbName = \"glue42core\";\r\nvar dbVersion = 1;\r\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\n\nvar LayoutsController = (function () {\r\n    function LayoutsController(storage, windows, control, interop, config) {\r\n        var _a, _b;\r\n        this.storage = storage;\r\n        this.windows = windows;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this.autoSaveContext = (_b = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoSaveWindowContext) !== null && _b !== void 0 ? _b : false;\r\n        this.control.subscribe(\"layouts\", this.handleControlMessage.bind(this));\r\n        this.registerRequestMethods();\r\n    }\r\n    LayoutsController.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, globalLayouts, workspaceLayouts;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (layoutType) {\r\n                            return [2, this.storage.getAll(layoutType)];\r\n                        }\r\n                        return [4, Promise.all([\r\n                                this.storage.getAll(\"Global\"),\r\n                                this.storage.getAll(\"Workspace\")\r\n                            ])];\r\n                    case 1:\r\n                        _a = _b.sent(), globalLayouts = _a[0], workspaceLayouts = _a[1];\r\n                        return [2, globalLayouts.concat(workspaceLayouts)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.import = function (layouts) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(layouts.map(function (layout) { return _this.storage.store(layout, layout.type); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.save = function (layoutOptions, autoSave) {\r\n        if (autoSave === void 0) { autoSave = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openedWindows, components, layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        openedWindows = this.windows.getChildWindows().map(function (w) { return w.id; });\r\n                        return [4, this.getRemoteWindowsInfo(openedWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(this.getLocalLayoutComponent(layoutOptions.context, true));\r\n                        layout = {\r\n                            type: \"Global\",\r\n                            name: layoutOptions.name,\r\n                            components: components,\r\n                            context: layoutOptions.context || {},\r\n                            metadata: layoutOptions.metadata || {}\r\n                        };\r\n                        if (!autoSave) return [3, 2];\r\n                        this.storage.storeAutoLayout(layout);\r\n                        return [3, 4];\r\n                    case 2: return [4, this.storage.store(layout, \"Global\")];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.autoSave = function (layoutOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.save(layoutOptions, true)];\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restore = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.get(options.name, \"Global\")];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            throw new Error(\"can not find layout with name \" + options.name);\r\n                        }\r\n                        this.restoreComponents(layout);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restoreAutoSavedLayout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutName, layout, my, mainComponent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutName = \"_auto_\" + document.location.href;\r\n                        return [4, this.storage.getAutoLayout(layoutName)];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        my = this.windows.my();\r\n                        if (my.parent) {\r\n                            return [2];\r\n                        }\r\n                        mainComponent = layout.components.find(function (c) { return c.state.main; });\r\n                        my.setContext(mainComponent === null || mainComponent === void 0 ? void 0 : mainComponent.state.context);\r\n                        try {\r\n                            this.restoreComponents(layout);\r\n                        }\r\n                        catch (e) {\r\n                            return [2];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.remove = function (type, name) {\r\n        return this.storage.remove(name, type);\r\n    };\r\n    LayoutsController.prototype.getAll = function (type) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.getAll(type)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.map(function (layout) {\r\n                                return {\r\n                                    name: layout.name,\r\n                                    type: layout.type,\r\n                                    context: layout.context,\r\n                                    metadata: layout.metadata\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.get = function (name, type) {\r\n        return this.storage.get(name, type);\r\n    };\r\n    LayoutsController.prototype.getLocalLayoutComponent = function (context, main) {\r\n        if (main === void 0) { main = false; }\r\n        var requestResult;\r\n        var my = this.windows.my();\r\n        try {\r\n            if (this.autoSaveContext) {\r\n                requestResult = {\r\n                    windowContext: my.getContextSync()\r\n                };\r\n            }\r\n        }\r\n        catch (err) {\r\n        }\r\n        return {\r\n            type: \"window\",\r\n            componentType: \"application\",\r\n            state: {\r\n                name: my.name,\r\n                context: (requestResult === null || requestResult === void 0 ? void 0 : requestResult.windowContext) || {},\r\n                bounds: my.getBoundsSync(),\r\n                url: window.document.location.href,\r\n                id: my.id,\r\n                parentId: my.parent,\r\n                main: main\r\n            }\r\n        };\r\n    };\r\n    LayoutsController.prototype.restoreComponents = function (layout) {\r\n        var _this = this;\r\n        layout.components.forEach(function (c) {\r\n            if (c.type === \"window\") {\r\n                var state = c.state;\r\n                if (state.main) {\r\n                    return;\r\n                }\r\n                var newWindowOptions = __assign(__assign({}, state.bounds), { context: state.context });\r\n                _this.windows.open(state.name, state.url, newWindowOptions);\r\n            }\r\n        });\r\n    };\r\n    LayoutsController.prototype.getRemoteWindowsInfo = function (windows) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises, _loop_1, this_1, _i, windows_1, id, responses;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        promises = [];\r\n                        _loop_1 = function (id) {\r\n                            var interopServer = this_1.interop.servers().find(function (s) { return s.windowId === id; });\r\n                            if (!interopServer || !interopServer.getMethods) {\r\n                                return \"continue\";\r\n                            }\r\n                            var methods = interopServer.getMethods();\r\n                            if (methods.find(function (m) { return m.name === SaveContextMethodName; })) {\r\n                                try {\r\n                                    promises.push(this_1.interop.invoke(SaveContextMethodName, {}, { windowId: id }));\r\n                                }\r\n                                catch (_a) {\r\n                                }\r\n                            }\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, windows_1 = windows; _i < windows_1.length; _i++) {\r\n                            id = windows_1[_i];\r\n                            _loop_1(id);\r\n                        }\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        return [2, responses.map(function (response) { return response.returned; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.interop.register(SaveContextMethodName, function (args) {\r\n            return _this.getLocalLayoutComponent(args);\r\n        });\r\n    };\r\n    LayoutsController.prototype.handleControlMessage = function (command) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutCommand, args, components;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutCommand = command;\r\n                        if (!(layoutCommand.command === \"saveLayoutAndClose\")) return [3, 3];\r\n                        args = layoutCommand.args;\r\n                        return [4, this.getRemoteWindowsInfo(args.childWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(args.parentInfo);\r\n                        return [4, this.storage.storeAutoLayout({\r\n                                type: \"Global\",\r\n                                name: args.layoutName,\r\n                                components: components,\r\n                                context: args.context || {},\r\n                                metadata: args.metadata || {}\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        args.childWindows.forEach(function (cw) {\r\n                            var _a;\r\n                            (_a = _this.windows.findById(cw)) === null || _a === void 0 ? void 0 : _a.close();\r\n                        });\r\n                        _a.label = 3;\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return LayoutsController;\r\n}());\n\nvar LayoutStorage = (function () {\r\n    function LayoutStorage(localStore, autoStore, remoteStore) {\r\n        this.localStore = localStore;\r\n        this.autoStore = autoStore;\r\n        this.remoteStore = remoteStore;\r\n    }\r\n    LayoutStorage.prototype.get = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var foundRemote, foundLocal;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        foundRemote = _b.sent();\r\n                        return [4, this.localStore.get(name, layoutType)];\r\n                    case 2:\r\n                        foundLocal = _b.sent();\r\n                        if (foundRemote && foundLocal) {\r\n                            return [2, foundRemote];\r\n                        }\r\n                        return [2, foundRemote || foundLocal];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, local, remote, nonConflictLocal;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, Promise.all([\r\n                            this.localStore.getAll(layoutType),\r\n                            new Promise(function (resolve) {\r\n                                if (_this.remoteStore) {\r\n                                    return _this.remoteStore.getAll(layoutType).then(resolve);\r\n                                }\r\n                                resolve([]);\r\n                            })\r\n                        ])];\r\n                    case 1:\r\n                        _a = _b.sent(), local = _a[0], remote = _a[1];\r\n                        nonConflictLocal = local.filter(function (localLayout) { return !remote.some(function (remoteLayout) { return remoteLayout.name === localLayout.name; }); });\r\n                        return [2, remote.concat(nonConflictLocal)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.store = function (layout, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(layout.name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot save layout with name: \" + layout.name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        if (!layout.metadata) {\r\n                            layout.metadata = { allowSave: true };\r\n                        }\r\n                        else {\r\n                            layout.metadata.allowSave = true;\r\n                        }\r\n                        return [4, this.localStore.store(layout, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.remove = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot remove layout with name: \" + name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        return [4, this.localStore.delete(name, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAutoLayout = function (name) {\r\n        return this.autoStore.get(name, \"Global\");\r\n    };\r\n    LayoutStorage.prototype.storeAutoLayout = function (layout) {\r\n        this.autoStore.save(layout);\r\n    };\r\n    return LayoutStorage;\r\n}());\n\nconst instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nvar LocalStore = (function () {\r\n    function LocalStore() {\r\n        if (!(\"indexedDB\" in window)) {\r\n            throw new Error(\"Cannot initialize the local storage, because IndexedDb is not supported\");\r\n        }\r\n    }\r\n    Object.defineProperty(LocalStore.prototype, \"database\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (this._database) {\r\n                return Promise.resolve(this._database);\r\n            }\r\n            return new Promise(function (resolve) {\r\n                openDB(dbName, dbVersion, { upgrade: _this.setUpDb.bind(_this) })\r\n                    .then(function (database) {\r\n                    _this._database = database;\r\n                    resolve(_this._database);\r\n                });\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LocalStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).getAll(\"workspaceLayouts\")];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).getAll(\"globalLayouts\")];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.delete = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).delete(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).delete(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).get(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).get(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.store = function (layout, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        layoutDecoder.runWithException(layout);\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).put(\"workspaceLayouts\", layout, layout.name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).put(\"globalLayouts\", layout, layout.name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.setUpDb = function (database) {\r\n        if (!database.objectStoreNames.contains(\"workspaceLayouts\")) {\r\n            database.createObjectStore(\"workspaceLayouts\");\r\n        }\r\n        if (!database.objectStoreNames.contains(\"globalLayouts\")) {\r\n            database.createObjectStore(\"globalLayouts\");\r\n        }\r\n    };\r\n    return LocalStore;\r\n}());\n\nvar JSONStore = (function () {\r\n    function JSONStore(storeBaseUrl) {\r\n        this.storeBaseUrl = storeBaseUrl;\r\n    }\r\n    JSONStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var fetchUrl, response, layouts, error_1, layoutProp, layoutsToVerify;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        fetchUrl = this.storeBaseUrl + \"/\" + defaultLayoutsName;\r\n                        return [4, this.fetchTimeout(fetchUrl)];\r\n                    case 1:\r\n                        response = _a.sent();\r\n                        if (!response.ok) {\r\n                            return [2, []];\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4, response.json()];\r\n                    case 3:\r\n                        layouts = _a.sent();\r\n                        return [3, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        return [2, []];\r\n                    case 5:\r\n                        if (!layouts) {\r\n                            return [2, []];\r\n                        }\r\n                        layoutProp = layoutType === \"Global\" ? \"globals\" : \"workspaces\";\r\n                        layoutsToVerify = (layouts[layoutProp] || []);\r\n                        return [2, layoutsToVerify.filter(function (layout) {\r\n                                var decodeResult = layoutDecoder.run(layout);\r\n                                if (!decodeResult.ok) {\r\n                                    console.warn(\"Fetched layout: \" + layout.name + \" is discarded, because it failed the validation: \" + JSON.stringify(decodeResult));\r\n                                }\r\n                                return decodeResult.ok;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JSONStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getAll(layoutType)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.find(function (layout) { return layout.name === name; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JSONStore.prototype.fetchTimeout = function (url, timeoutMilliseconds) {\r\n        if (timeoutMilliseconds === void 0) { timeoutMilliseconds = 1000; }\r\n        return new Promise(function (resolve, reject) {\r\n            var timeoutHit = false;\r\n            var timeout = setTimeout(function () {\r\n                timeoutHit = true;\r\n                reject(new Error(\"Fetch request for: \" + url + \" timed out at: \" + timeoutMilliseconds + \" milliseconds\"));\r\n            }, timeoutMilliseconds);\r\n            fetch(url)\r\n                .then(function (response) {\r\n                if (!timeoutHit) {\r\n                    clearTimeout(timeout);\r\n                    resolve(response);\r\n                }\r\n            })\r\n                .catch(function (err) {\r\n                if (!timeoutHit) {\r\n                    clearTimeout(timeout);\r\n                    reject(err);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return JSONStore;\r\n}());\n\nvar AutoStorage = (function () {\r\n    function AutoStorage() {\r\n    }\r\n    AutoStorage.prototype.get = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        return obj[key];\r\n    };\r\n    AutoStorage.prototype.save = function (layout) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(layout.name, layout.type);\r\n        obj[key] = layout;\r\n        this.setObjectToLocalStorage(obj);\r\n        return layout;\r\n    };\r\n    AutoStorage.prototype.remove = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        delete obj[key];\r\n    };\r\n    AutoStorage.prototype.getObjectFromLocalStorage = function () {\r\n        var values = window.localStorage.getItem(AutoStorage.KEY);\r\n        if (values) {\r\n            return JSON.parse(values);\r\n        }\r\n        return {};\r\n    };\r\n    AutoStorage.prototype.setObjectToLocalStorage = function (obj) {\r\n        window.localStorage.setItem(AutoStorage.KEY, JSON.stringify(obj));\r\n    };\r\n    AutoStorage.prototype.getKey = function (name, type) {\r\n        return type + \"_\" + name;\r\n    };\r\n    AutoStorage.KEY = \"G0_layouts\";\r\n    return AutoStorage;\r\n}());\n\nvar hookCloseEvents = function (api, config, control, layoutsController) {\r\n    var done = false;\r\n    var doneFn = function () { return __awaiter(void 0, void 0, void 0, function () {\r\n        var shouldSave, allChildren, firstChild, layoutName, command;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            if (!done) {\r\n                done = true;\r\n                shouldSave = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoRestore;\r\n                if (shouldSave) {\r\n                    allChildren = api.windows.getChildWindows().map(function (w) { return w.id; });\r\n                    firstChild = allChildren[0];\r\n                    layoutName = \"_auto_\" + document.location.href;\r\n                    if (allChildren.length > 0) {\r\n                        command = {\r\n                            domain: \"layouts\",\r\n                            command: \"saveLayoutAndClose\",\r\n                            args: {\r\n                                childWindows: allChildren,\r\n                                closeEveryone: true,\r\n                                layoutName: layoutName,\r\n                                context: {},\r\n                                metadata: {},\r\n                                parentInfo: layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.getLocalLayoutComponent({}, true)\r\n                            }\r\n                        };\r\n                        control.send(command, { windowId: firstChild });\r\n                    }\r\n                    else {\r\n                        layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.autoSave({ name: layoutName });\r\n                    }\r\n                }\r\n                api.done();\r\n            }\r\n            return [2];\r\n        });\r\n    }); };\r\n    window.addEventListener(\"beforeunload\", function () {\r\n        doneFn();\r\n    });\r\n};\r\nvar createFactoryFunction = function (coreFactoryFunction) {\r\n    return function (config) { return __awaiter(void 0, void 0, void 0, function () {\r\n        var builtCoreConfig, isWebEnvironment, shouldInitializeChannels, shouldInitializeAppManager, gdWindowContext, control, windows, layouts, layoutsController, ext, channelsLib, appManagerLib, coreConfig, core;\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;\r\n        return __generator(this, function (_r) {\r\n            switch (_r.label) {\r\n                case 0: return [4, buildConfig(config)];\r\n                case 1:\r\n                    builtCoreConfig = _r.sent();\r\n                    isWebEnvironment = typeof window !== \"undefined\";\r\n                    shouldInitializeChannels = ((_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.channels) || false;\r\n                    shouldInitializeAppManager = ((_b = builtCoreConfig.glue) === null || _b === void 0 ? void 0 : _b.appManager) || false;\r\n                    if (isWebEnvironment) {\r\n                        gdWindowContext = window;\r\n                        if ((gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.glue42gd) && (gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.Glue)) {\r\n                            return [2, gdWindowContext.Glue({\r\n                                    windows: true,\r\n                                    logger: (_c = builtCoreConfig.glue) === null || _c === void 0 ? void 0 : _c.logger,\r\n                                    channels: shouldInitializeChannels,\r\n                                    layouts: true,\r\n                                    appManager: shouldInitializeAppManager,\r\n                                    libraries: config.libraries\r\n                                })];\r\n                        }\r\n                    }\r\n                    control = new Control();\r\n                    ext = {\r\n                        libs: [\r\n                            {\r\n                                name: \"notifications\",\r\n                                create: function (coreLib) { return new Notifications(coreLib.interop); }\r\n                            }\r\n                        ],\r\n                        version: version\r\n                    };\r\n                    if (shouldInitializeChannels) {\r\n                        channelsLib = {\r\n                            name: \"channels\",\r\n                            create: function (coreLib) { return new Channels(coreLib.contexts, builtCoreConfig.channels); }\r\n                        };\r\n                        (_d = ext.libs) === null || _d === void 0 ? void 0 : _d.push(channelsLib);\r\n                    }\r\n                    if (isWebEnvironment) {\r\n                        (_e = ext.libs) === null || _e === void 0 ? void 0 : _e.push({\r\n                            name: \"windows\",\r\n                            create: function (coreLib) {\r\n                                windows = new Windows(coreLib.interop, control);\r\n                                return windows;\r\n                            }\r\n                        }, {\r\n                            name: \"layouts\",\r\n                            create: function (coreLib) {\r\n                                var _a, _b;\r\n                                var remoteStore;\r\n                                if (((_a = builtCoreConfig.layouts) === null || _a === void 0 ? void 0 : _a.remoteType) === \"json\") {\r\n                                    var baseLocation = ((_b = builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue.assets) === null || _b === void 0 ? void 0 : _b.location) || defaultAssetsBaseLocation;\r\n                                    remoteStore = new JSONStore(baseLocation);\r\n                                }\r\n                                var localStore = new LocalStore();\r\n                                var autoStore = new AutoStorage();\r\n                                var layoutsStorage = new LayoutStorage(localStore, autoStore, remoteStore);\r\n                                layoutsController = new LayoutsController(layoutsStorage, windows, control, coreLib.interop, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue);\r\n                                layouts = new Layouts(layoutsController);\r\n                                return layouts;\r\n                            }\r\n                        });\r\n                        if (shouldInitializeAppManager) {\r\n                            appManagerLib = {\r\n                                name: \"appManager\",\r\n                                create: function (coreLib) { var _a; return new AppManager(windows, coreLib.interop, control, builtCoreConfig.appManager, (_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.application); }\r\n                            };\r\n                            (_f = ext.libs) === null || _f === void 0 ? void 0 : _f.push(appManagerLib);\r\n                        }\r\n                    }\r\n                    coreConfig = {\r\n                        gateway: {\r\n                            sharedWorker: (_h = (_g = builtCoreConfig.glue) === null || _g === void 0 ? void 0 : _g.worker) !== null && _h !== void 0 ? _h : defaultWorkerLocation,\r\n                            inproc: (_j = builtCoreConfig.glue) === null || _j === void 0 ? void 0 : _j.inproc\r\n                        },\r\n                        logger: (_k = builtCoreConfig.glue) === null || _k === void 0 ? void 0 : _k.logger,\r\n                        application: (_l = builtCoreConfig.glue) === null || _l === void 0 ? void 0 : _l.application\r\n                    };\r\n                    if (isWebEnvironment && !window.SharedWorker) {\r\n                        throw new Error(\"Cannot initialize Glue Web, because this environment does not support Shared Workers\");\r\n                    }\r\n                    return [4, promisePlus(function () { return coreFactoryFunction(coreConfig, ext); }, 10000, \"Glue Web initialization timed out\")];\r\n                case 2:\r\n                    core = _r.sent();\r\n                    if (!(config === null || config === void 0 ? void 0 : config.libraries)) return [3, 4];\r\n                    return [4, Promise.all(config.libraries.map(function (lib) { return lib(core, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue); }))];\r\n                case 3:\r\n                    _r.sent();\r\n                    _r.label = 4;\r\n                case 4:\r\n                    control.start(core.interop, core.logger.subLogger(\"control\"));\r\n                    if (!isWebEnvironment) return [3, 9];\r\n                    return [4, initStartupContext(core.windows.my(), core.interop, (_m = core.appManager) === null || _m === void 0 ? void 0 : _m.myInstance)];\r\n                case 5:\r\n                    _r.sent();\r\n                    if (!((_p = (_o = builtCoreConfig.glue) === null || _o === void 0 ? void 0 : _o.layouts) === null || _p === void 0 ? void 0 : _p.autoRestore)) return [3, 7];\r\n                    return [4, (layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.restoreAutoSavedLayout())];\r\n                case 6:\r\n                    _r.sent();\r\n                    _r.label = 7;\r\n                case 7: return [4, hookCloseEvents(core, (_q = builtCoreConfig.glue) !== null && _q !== void 0 ? _q : {}, control, layoutsController)];\r\n                case 8:\r\n                    _r.sent();\r\n                    _r.label = 9;\r\n                case 9: return [2, core];\r\n            }\r\n        });\r\n    }); };\r\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$2 = function() {\r\n    __assign$2 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$2.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) {\r\n        if (system.parent === undefined) {\r\n            return;\r\n        }\r\n        joinPromise.then(function () {\r\n            var metric = {\r\n                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [metric],\r\n            };\r\n            session.send(createMetricsMsg);\r\n        });\r\n    };\r\n    var updateSystem = function (system, state) {\r\n        joinPromise.then(function () {\r\n            var shadowedUpdateMetric = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        value: {\r\n                            Description: state.description,\r\n                            Value: state.state,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(shadowedUpdateMetric);\r\n            var stateObj = composeMsgForRootStateMetric(system);\r\n            var rootMetric = {\r\n                type: \"publish\",\r\n                peer_id: connection.peerId,\r\n                values: [{\r\n                        name: \"/State\",\r\n                        value: {\r\n                            Description: stateObj.description,\r\n                            Value: stateObj.value,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(rootMetric);\r\n        });\r\n    };\r\n    var createMetric = function (metric) {\r\n        var metricClone = cloneMetric(metric);\r\n        joinPromise.then(function () {\r\n            var m = serializeMetric(metricClone);\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [m],\r\n            };\r\n            session.send(createMetricsMsg);\r\n            if (typeof metricClone.value !== \"undefined\") {\r\n                updateMetricCore(metricClone);\r\n            }\r\n        });\r\n    };\r\n    var updateMetric = function (metric) {\r\n        var metricClone = cloneMetric(metric);\r\n        joinPromise.then(function () { return updateMetricCore(metricClone); });\r\n    };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(publishMetricsMsg);\r\n        }\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign$2({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign$2({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends$1(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends$1(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends$1(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends$1(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing.update(value);\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar PerfTracker = (function () {\r\n    function PerfTracker(api, initialPublishTimeout, publishInterval) {\r\n        this.api = api;\r\n        this.lastCount = 0;\r\n        this.initialPublishTimeout = 10 * 1000;\r\n        this.publishInterval = 60 * 1000;\r\n        this.initialPublishTimeout = initialPublishTimeout !== null && initialPublishTimeout !== void 0 ? initialPublishTimeout : this.initialPublishTimeout;\r\n        this.publishInterval = publishInterval !== null && publishInterval !== void 0 ? publishInterval : this.publishInterval;\r\n        this.scheduleCollection();\r\n        this.system = this.api.subSystem(\"performance\", \"Performance data published by the web application\");\r\n    }\r\n    PerfTracker.prototype.scheduleCollection = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.collect();\r\n            setInterval(function () {\r\n                _this.collect();\r\n            }, _this.publishInterval);\r\n        }, this.initialPublishTimeout);\r\n    };\r\n    PerfTracker.prototype.collect = function () {\r\n        try {\r\n            this.collectMemory();\r\n            this.collectEntries();\r\n        }\r\n        catch (_a) {\r\n        }\r\n    };\r\n    PerfTracker.prototype.collectMemory = function () {\r\n        var memory = window.performance.memory;\r\n        this.system.stringMetric(\"memory\", JSON.stringify({\r\n            totalJSHeapSize: memory.totalJSHeapSize,\r\n            usedJSHeapSize: memory.usedJSHeapSize\r\n        }));\r\n    };\r\n    PerfTracker.prototype.collectEntries = function () {\r\n        var allEntries = window.performance.getEntries();\r\n        if (allEntries.length <= this.lastCount) {\r\n            return;\r\n        }\r\n        this.lastCount = allEntries.length;\r\n        this.system.stringMetric(\"entries\", JSON.stringify(allEntries));\r\n    };\r\n    return PerfTracker;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    var rootSystem = repo.root;\r\n    if (!options.disableAutoAppSystem) {\r\n        rootSystem = rootSystem.subSystem(\"App\");\r\n    }\r\n    var api = addFAVSupport(rootSystem);\r\n    initPerf(api, options.pagePerformanceMetrics);\r\n    return api;\r\n});\r\nvar perf;\r\nfunction initPerf(api, config) {\r\n    var _a, _b;\r\n    if (typeof window === \"undefined\") {\r\n        return;\r\n    }\r\n    var perfConfig = (_b = (_a = window === null || window === void 0 ? void 0 : window.glue42gd) === null || _a === void 0 ? void 0 : _a.metrics) === null || _b === void 0 ? void 0 : _b.pagePerformanceMetrics;\r\n    if (perfConfig) {\r\n        config = perfConfig;\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.enabled) {\r\n        perf = new PerfTracker(api, config.initialPublishTimeout, config.publishInterval);\r\n    }\r\n}\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib$2();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib$2();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar timers = {};\r\nfunction getAllTimers() {\r\n    return timers;\r\n}\r\nfunction timer (timerName) {\r\n    var existing = timers[timerName];\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    var marks = [];\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    mark(\"start\", startTime);\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        mark(\"end\", endTime);\r\n        period = endTime - startTime;\r\n        return period;\r\n    }\r\n    function mark(name, time) {\r\n        var currentTime = time !== null && time !== void 0 ? time : now();\r\n        var diff = 0;\r\n        if (marks.length > 0) {\r\n            diff = currentTime - marks[marks.length - 1].time;\r\n        }\r\n        marks.push({ name: name, time: currentTime, diff: diff });\r\n    }\r\n    var timerObj = {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop,\r\n        mark: mark,\r\n        marks: marks\r\n    };\r\n    timers[timerName] = timerObj;\r\n    return timerObj;\r\n}\n\nvar dummyRequire = function () { return undefined; };\r\nvar requireFunc = Utils.isNode() ? require : dummyRequire;\r\nvar WebSocketConstructor = Utils.isNode() ? requireFunc(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this.startupTimer = timer(\"connection\");\r\n        this._running = true;\r\n        this._registry = lib$2();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.startupTimer.mark(\"opening-socket\");\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.startupTimer.mark(\"socket-initiated\");\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.startupTimer.mark(\"ws-opened\");\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$1$1(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$1$1,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$1$1 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1$1.lookup, version);\n    str = str + encode_1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1 = lib$1$1.generate;\nvar lib_2 = lib$1$1.seed;\nvar lib_3 = lib$1$1.worker;\nvar lib_4 = lib$1$1.characters;\nvar lib_5 = lib$1$1.decode;\nvar lib_6 = lib$1$1.isValid;\n\nvar shortid$1 = lib$1$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib$2();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid$1();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib$2();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected, 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib$2();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        timer(\"connection\").mark(\"transport-opened\");\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        timer(\"connection\").mark(\"protocol-logged-in\");\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        try {\r\n                            _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                        }\r\n                        catch (loggerError) {\r\n                            console.log(\"Message handler failed\", error);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            var interop = Logger.Interop;\r\n            if (interop) {\r\n                try {\r\n                    if (interop.methods({ name: Logger.InteropMethodName }).length > 0) {\r\n                        interop.invoke(Logger.InteropMethodName, {\r\n                            msg: \"\" + message,\r\n                            logger: loggerName,\r\n                            level: level\r\n                        });\r\n                    }\r\n                }\r\n                catch (_a) {\r\n                }\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version$2 = \"5.2.1\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_e) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid$1();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version$2\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid$1();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"warn\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        var gdConsoleLevel;\r\n        if (glue42gd) {\r\n            gdConsoleLevel = glue42gd.consoleLogLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    return {\r\n        bus: (_a = configuration.bus) !== null && _a !== void 0 ? _a : false,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_b = configuration.metrics) !== null && _b !== void 0 ? _b : true,\r\n        contexts: (_c = configuration.contexts) !== null && _c !== void 0 ? _c : true,\r\n        version: ext.version || version$2,\r\n        libs: (_d = ext.libs) !== null && _d !== void 0 ? _d : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta, logger) {\r\n    try {\r\n        if (logger === null || logger === void 0 ? void 0 : logger.canPublish(\"trace\")) {\r\n            logger === null || logger === void 0 ? void 0 : logger.trace(\"applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context));\r\n        }\r\n        if (!delta) {\r\n            return context;\r\n        }\r\n        if (delta.reset) {\r\n            context = __assign$2({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        if (delta.commands) {\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    deletePath(context, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(context, command.value, command.path);\r\n                }\r\n            }\r\n            return context;\r\n        }\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n        return context;\r\n    }\r\n    catch (e) {\r\n        logger === null || logger === void 0 ? void 0 : logger.error(\"error applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context), e);\r\n        return context;\r\n    }\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction setValueToPath(obj, value, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        if (typeof obj[pathArr[i]] !== \"object\") {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    obj[pathArr[i]] = value;\r\n}\r\nfunction deletePath(obj, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            return;\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    delete obj[pathArr[i]];\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._protocolVersion = undefined;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(GW3Bridge.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._protocolVersion) {\r\n                var contextsDomainInfo = this._connection.availableDomains.find(function (d) { return d.uri === \"context\"; });\r\n                this._protocolVersion = (_a = contextsDomainInfo === null || contextsDomainInfo === void 0 ? void 0 : contextsDomainInfo.version) !== null && _a !== void 0 ? _a : 1;\r\n            }\r\n            return this._protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(GW3Bridge.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this.protocolVersion >= 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            _this._contextIdToName[createContextMsg.context_id] = name;\r\n            var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n            contextData.isAnnounced = true;\r\n            contextData.name = name;\r\n            contextData.contextId = createContextMsg.context_id;\r\n            contextData.context = data;\r\n            _this._contextNameToData[name] = contextData;\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name)];\r\n                    case 1:\r\n                        currentContext = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.protocolVersion === 2 ?\r\n                            this.calculateContextDeltaV2(currentContext, delta) :\r\n                            this.calculateContextDeltaV1(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length\r\n                            && !((_a = calculatedDelta.commands) === null || _a === void 0 ? void 0 : _a.length)) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.setPath = function (name, path, value) {\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPath operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        return this.setPaths(name, [{ path: path, value: value }]);\r\n    };\r\n    GW3Bridge.prototype.setPaths = function (name, pathValues) {\r\n        var _this = this;\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            var obj = {};\r\n            for (var _i = 0, pathValues_1 = pathValues; _i < pathValues_1.length; _i++) {\r\n                var pathValue = pathValues_1[_i];\r\n                setValueToPath(obj, pathValue.value, pathValue.path);\r\n            }\r\n            return this.createContext(name, obj);\r\n        }\r\n        var commands = [];\r\n        for (var _a = 0, pathValues_2 = pathValues; _a < pathValues_2.length; _a++) {\r\n            var pathValue = pathValues_2[_a];\r\n            if (pathValue.value === null) {\r\n                commands.push({ type: \"remove\", path: pathValue.path });\r\n            }\r\n            else {\r\n                commands.push({ type: \"set\", path: pathValue.path, value: pathValue.value });\r\n            }\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { commands: commands }\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { added: {}, removed: [], updated: {}, commands: commands }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var _a;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return Promise.resolve({});\r\n        }\r\n        if (contextData && !contextData.hasCallbacks()) {\r\n            return new Promise(function (resolve, _) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator$1(this, function (_a) {\r\n                    this.subscribe(name, function (data, _d, _r, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        var context = (_a = contextData === null || contextData === void 0 ? void 0 : contextData.context) !== null && _a !== void 0 ? _a : {};\r\n        return Promise.resolve(context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context &&\r\n                    contextData.sentExplicitSubscription) {\r\n                    callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.destroy = function (name) {\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData) {\r\n            return Promise.reject(\"context with \" + name + \" does not exist\");\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_DESTROY_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta, this._logger);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta, this._logger);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, data, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(data), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV1 = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV2 = function (from, to) {\r\n        var _a, _b;\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined, commands: [] };\r\n        for (var _i = 0, _c = Object.keys(to); _i < _c.length; _i++) {\r\n            var x = _c[_i];\r\n            if (to[x] !== null) {\r\n                var fromX = from ? from[x] : null;\r\n                if (!deepEqual(fromX, to[x])) {\r\n                    (_a = delta.commands) === null || _a === void 0 ? void 0 : _a.push({ type: \"set\", path: x, value: to[x] });\r\n                }\r\n            }\r\n            else {\r\n                (_b = delta.commands) === null || _b === void 0 ? void 0 : _b.push({ type: \"remove\", path: x });\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.update(name, data);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.setPath = function (name, path, data) {\r\n        this.checkName(name);\r\n        this.checkPath(path);\r\n        var isTopLevelPath = path === \"\";\r\n        if (isTopLevelPath) {\r\n            this.checkData(data);\r\n            return this.set(name, data);\r\n        }\r\n        return this._bridge.setPath(name, path, data);\r\n    };\r\n    ContextsModule.prototype.setPaths = function (name, paths) {\r\n        this.checkName(name);\r\n        if (!Array.isArray(paths)) {\r\n            throw new Error(\"Please provide the paths as an array of PathValues!\");\r\n        }\r\n        for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\r\n            var _a = paths_1[_i], path = _a.path, value = _a.value;\r\n            this.checkPath(path);\r\n            var isTopLevelPath = path === \"\";\r\n            if (isTopLevelPath) {\r\n                this.checkData(value);\r\n            }\r\n        }\r\n        return this._bridge.setPaths(name, paths);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.destroy = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.destroy(name);\r\n    };\r\n    Object.defineProperty(ContextsModule.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this._bridge.setPathSupported;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" || name === \"\") {\r\n            throw new Error(\"Please provide the name as a non-empty string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkPath = function (path) {\r\n        if (typeof path !== \"string\") {\r\n            throw new Error(\"Please provide the path as a dot delimited string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkData = function (data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Please provide the data as an object!\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, promise, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    var timeout;\r\n    promise.finally(function () {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n    });\r\n    return new Promise(function (resolve, reject) {\r\n        timeout = setTimeout(function () { return reject(error); }, ms);\r\n    });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign$2({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign$2({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator$1(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign$2({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign$2(__assign$2({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid$1();\r\n                                    var method = serversMethodPair.methods[0];\r\n                                    var server = serversMethodPair.server;\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, method, argumentObj, server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, invokePromise, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached for method name: \" + (method === null || method === void 0 ? void 0 : method.name) + \", target instance: \" + JSON.stringify(server.instance) + \", options: \" + JSON.stringify(additionalOptionsCopy),\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign$2({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign$2({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid$1();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib$2();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib$2();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib$2();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer(\"glue\");\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            inner.marks = t.marks;\r\n            if (_allowTrace) {\r\n                _logger.trace(name + \" is ready - \" + (t.endTime - t.startTime));\r\n            }\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer(\"connection\");\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                authPromise = glue42gd.getGWToken()\r\n                    .then(function (token) {\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            initTimer.mark(\"auth-promise-resolved\");\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer(\"logger\");\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        if (_logger.canPublish(\"debug\")) {\r\n            _logger.debug(\"initializing glue...\");\r\n        }\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c, _d;\r\n        var initTimer = timer(\"metrics\");\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var disableAutoAppSystem = (_a = (typeof config !== \"boolean\" && config.disableAutoAppSystem)) !== null && _a !== void 0 ? _a : false;\r\n        _metrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_b = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _b !== void 0 ? _b : \"metrics-service\",\r\n            instance: (_d = (_c = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _c !== void 0 ? _c : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _d !== void 0 ? _d : shortid$1(),\r\n            disableAutoAppSystem: disableAutoAppSystem,\r\n            pagePerformanceMetrics: typeof config !== \"boolean\" ? config === null || config === void 0 ? void 0 : config.pagePerformanceMetrics : undefined\r\n        });\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer(\"interop\");\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer(\"contexts\");\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator$1(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer(\"bus\");\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer(name);\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version$2,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var all = getAllTimers();\r\n                return Object.keys(all).map(function (key) {\r\n                    var t = all[key];\r\n                    return {\r\n                        name: key,\r\n                        duration: t.endTime - t.startTime,\r\n                        marks: t.marks\r\n                    };\r\n                });\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        if (glue.agm) {\r\n            var deprecatedDecorator = function (fn, wrong, proper) {\r\n                return function () {\r\n                    glue.logger.warn(\"glue.js - 'glue.agm.\" + wrong + \"' method is deprecated, use 'glue.interop.\" + proper + \"' instead.\");\r\n                    fn.apply(glue.agm, arguments);\r\n                };\r\n            };\r\n            var agmAny = glue.agm;\r\n            agmAny.method_added = deprecatedDecorator(glue.agm.methodAdded, \"method_added\", \"methodAdded\");\r\n            agmAny.method_removed = deprecatedDecorator(glue.agm.methodRemoved, \"method_removed\", \"methodRemoved\");\r\n            agmAny.server_added = deprecatedDecorator(glue.agm.serverAdded, \"server_added\", \"serverAdded\");\r\n            agmAny.server_method_aded = deprecatedDecorator(glue.agm.serverMethodAdded, \"server_method_aded\", \"serverMethodAdded\");\r\n            agmAny.server_method_removed = deprecatedDecorator(glue.agm.serverMethodRemoved, \"server_method_removed\", \"serverMethodRemoved\");\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version$2;\r\nGlueCore.default = GlueCore;\n\nvar glueWebFactory = createFactoryFunction(GlueCore);\r\nif (typeof window !== \"undefined\") {\r\n    var windowAny = window;\r\n    windowAny.GlueWeb = glueWebFactory;\r\n    delete windowAny.GlueCore;\r\n}\r\nglueWebFactory.default = glueWebFactory;\r\nglueWebFactory.version = version;\n\nexport default glueWebFactory;\n//# sourceMappingURL=web.es.js.map\n","import createDesktopAgent from \"./agent\";\nimport Glue, { Glue42 } from \"@glue42/desktop\";\nimport GlueWebFactory from \"@glue42/web\";\nimport { getChannelsList, isEmptyObject, isGlue42Core } from \"./utils\";\nimport { version } from \"../package.json\";\nimport { FDC3 } from \"../types\";\nimport { WindowType } from \"./windowtype\";\n\nconst defaultGlueConfig = {\n    application: (window as WindowType).fdc3AppName,\n    appManager: true,\n    context: true,\n    intents: true,\n    channels: true,\n    agm: true\n};\n\nconst patchSharedContexts = (): Promise<void> => {\n    return new Promise((resolve) => {\n        let interval: any;\n\n        const callback = async (): Promise<void> => {\n            const channels = await getChannelsList();\n\n            if (channels.length === 0 || !isEmptyObject(channels[0])) {\n                clearInterval(interval);\n                resolve();\n            }\n        };\n\n        interval = setInterval(callback, 300);\n\n        callback();\n    });\n};\n\nconst setupGlue = (clientGlueConfig?: Glue42.Config): void => {\n    if (isGlue42Core) {\n        (window as WindowType).gluePromise = GlueWebFactory(defaultGlueConfig)\n            .then((glue) => {\n                (window as WindowType).glue = glue;\n\n                return patchSharedContexts();\n            })\n            .then(() => {\n                return (window as WindowType).glue;\n            });\n    } else {\n        const waitGlue42GD = new Promise((resolve) => {\n            let interval: any;\n\n            const callback = (): void => {\n                if ((window as WindowType).glue42gd) {\n                    clearInterval(interval);\n                    resolve();\n                }\n            };\n\n            interval = setInterval(callback, 300);\n\n            callback();\n        });\n\n        (window as WindowType).gluePromise = waitGlue42GD\n            .then(() => {\n                const GlueFactory = (window as WindowType).Glue || Glue;\n\n                return GlueFactory(clientGlueConfig || defaultGlueConfig);\n            })\n            .then((glue) => {\n                (window as WindowType).glue = glue;\n\n                return patchSharedContexts();\n            })\n            .then(() => {\n                return (window as WindowType).glue;\n            });\n    }\n};\n\nconst fdc3Factory = (): FDC3.DesktopAgent & { version: string } => {\n    setupGlue();\n\n    const agentApi = createDesktopAgent();\n\n    return {\n        ...agentApi,\n        version\n    };\n};\n\nexport default fdc3Factory;\n","import fdc3Factory from \"./main\";\n\nconst fdc3 = fdc3Factory();\n(window as any).fdc3 = fdc3;\n(fdc3 as any).default = fdc3;\n\nexport default fdc3;\n"],"names":["newSubscribe","id","callback","didReplay","window","glue","contexts","subscribe","data","delta","removed","unsubscribe","extraData","updaterId","interop","instance","getChannelsList","channelNames","channels","all","Promise","map","name","get","isEmptyObject","obj","Object","keys","length","constructor","isGlue42Core","navigator","userAgent","toLowerCase","includes","SystemChannel","[object Object]","glChannel","this","displayMetadata","meta","context","publish","contextType","channel","type","contextTypeInput","handlerInput","arguments","handler","unsubPromise","subscribeFor","then","unsub","join","leave","AppChannel","update","Listener","actualUnsub","unsubFunc","console","error","createChannelsApi","currentChannel","pendingSubscription","systemChannels","doesAppChannelExist","some","ctxName","isSystem","n","mapToFDC3AppChannel","channelName","handleSwitchChannelUI","channelId","setCurrentChannel","createPendingListener","setActualUnsub","initDone","gluePromise","channelContext","current","changed","getSystemChannels","getOrCreateAppChannel","set","createNewAppChannel","tryLeaveSystem","addContextListener","warn","listener","startupContext","appManager","myInstance","subHandler","onNewData","newChannel","getOrCreateChannel","find","systemChannel","joinChannel","Error","appChannel","tryGetAppChannel","getCurrentChannel","leaveCurrentChannel","broadcast","convertGlue42IntentToFDC3AppIntent","glueIntent","handlers","intent","displayName","apps","app","application","applicationName","title","tooltip","userProperties","description","icons","images","startAppAndWaitForIntentMethod","start","resolve","reject","timeout","setTimeout","serverMethodAdded","info","method","clearTimeout","server","createCoreDesktopAgent","open","props","createGlue42CoreDesktopAgent","findIntent","foundIntent","appIntents","applications","flatMap","intents","Array","from","Set","appIntent","intentName","filter","findIntentsByContext","getGlue42CoreIntentsByContext","raiseIntent","target","instancesToTarget","invocationResult","methodName","appTarget","instances","appInstance","agm","methods","getServers","invoke","all_return_values","source","executed_by","version","returned","addIntentListener","initialContext","windows","my","getContext","glueContext","intentContext","register","unregister","createGlue42EnterpriseDesktopAgent","glueIntents","findByContext","gIntent","glueIntentResult","raise","JSON","stringify","applicationInstance","extendStatics","d","b","setPrototypeOf","__proto__","p","hasOwnProperty","__extends","__","prototype","create","__assign","assign","t","s","i","call","apply","__awaiter","thisArg","_arguments","P","generator","fulfilled","value","step","next","e","rejected","result","done","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","MetricTypes","getMetricTypeByValue","metric","getTypeByValue","Date","serializeMetric","serializedMetrics","values","reduce","memo","key","innerType","composite","defineNestedComposite","normalizeMetricName","path","getMetricValueByType","now","publishNestedComposite","getTime","Boolean","toString","composeMsgForRootStateMetric","system","merged","flatten","arr","flat","toFlatten","concat","isArray","root","getAggregateState","highestState","sort","state","msg","forEach","m","idx","slice","aggregateDescription","Helpers","definition","parent","transport","BaseMetric","createMetric","defineProperty","_a","repo","enumerable","configurable","newValue","updateMetric","NumberMetric","_super","incrementBy","num","increment","decrement","decrementBy","ObjectMetric","mergeValues","_this","StringMetric","TimestampMetric","Repository","options","protocol","init","separator","_transport","_name","_description","_repo","_parent","_path","_buildPath","shadowedSystem","_state","_subSystems","_metrics","_getOrCreateMetric","metricObject","expectedType","metricDef","matching","shadowedMetric","existing","me","subSystems","metrics","subSystem","nameSystem","descriptionSystem","match","_system","getState","setState","stateDescription","updateSystem","stringMetric","timestampMetric","objectMetric","numberMetric","aggState","shadowedSubSystem","createSystem","addSystemMetrics","clickStream","undefined","rootSystem","useClickStream","document","clickStream_1","documentClickHandler","timestamp","className","tagName","href","page","location","addEventListener","attachEvent","urlMetric","appNameMetric","startUrl","glue42gd","appName","NullProtocol","connection","config","joinPromise","session","replayRepo","replaySystem","ss","createMetricsMsg","Description","Value","send","metricClone","cloneMetric","updateMetricCore","canUpdate","publishMetricsMsg","canUpdateMetric","_b","resolveReadyPromise","domain","onJoined","reconnect","defineRootMetricsMsg","service","shadowedUpdateMetric","stateObj","rootMetric","peer_id","peerId","gw3","createRegistry","errorHandling","_userErrorHandler","callbacks","_handleError","exceptionArtifact","errParam","stack","add","callbacksForKey","allForKey","acc","element","index","execute","argumentsArr","_i","results","err","clear","clearKey","default","lib","InProcTransport","settings","logger","registry","gw","facade","connect","_client","message","messageHandler","client","sendObject","_msg","onMessage","onConnectedChanged","close","SharedWorkerTransport","workerFile","worker","SharedWorker","port","onmessage","postMessage","Utils","getGDMajorVersion","glueDesktop","ver","Number","substr","isNaN","isNode","_isNode","global","process","PromiseWrapper","resolved","promise","delay","time","WebSocketConstructor","require","WebSocket","WS","_running","_registry","wsRequests","ws","waitForSocketConnection","pw","failed","readyState","openSocket","retryInterval","retriesLeft","reconnectInterval","notifyForSocketState","debug","initiateSocket","retries","onerror","reason","seen_1","WeakSet","has","notifyStatusChanged","onclose","onopen","identity","wsRequest","status","seed","alphabet","previousSeed","shuffled","randomFromSeed","nextValue","_seed_","ORIGINAL","reset","setCharacters","_alphabet_","unique","split","item","ind","lastIndexOf","getShuffled","characterIndex","sourceArray","targetArray","Math","floor","splice","shuffle","alphabet_1","characters","lookup","crypto","msCrypto","randomByteBrowser","getRandomValues","random","dest","Uint8Array","encode_1","number","loopCounter","str","pow","decode_1","indexOf","isValid","len","lib$1","fn","module","exports","createCommonjsModule","counter","previousSeconds","clusterWorkerId","generate","seconds","seedValue","workerId","newCharacters","decode","shortid","domainSession","successMessages","errorMessages","_latestOptions","isJoined","tryReconnecting","_connectionOn","disconnected","loggedIn","on","handleSuccessMessage","handleErrorMessage","sm","requestsMap","destination","wasReconnect","handleJoined","catch","requestId","request_id","entry","success","getNextRequestId","tag","skipPeerId","successMsg","_tag","errorMsg","onLeft","sendFireAndForget","connected","GW3ProtocolImpl","protocolVersion","datePrefix","datePrefixLen","dateMinLen","datePrefixFirstChar","_isLoggedIn","shouldTryLogin","initialLogin","initialLoginAttempts","sessions","handleDisconnected","ping","processStringMessage","parse","substring","milliseconds","parseInt","ex","msgType","createStringMessage","oldToJson","toJSON","datePrefix_1","processObjectMessage","createObjectMessage","login","authentication","e_1","helloMsg","sendOptions","welcomeMsg","token","err_1","_c","loginConfig","username","password","gatewayToken","getNewGWToken","flowName","provider","flowCallback","sessionId","secret","globalDomain","subLogger","maxRetries","reconnectAttempts","Buffer","resolvedIdentity","resolved_identity","availableDomains","available_domains","access_token","setLoggedIn","logout","promises","pingTimer","domainName","domainLogger","authToken","res","getGWToken","MessageReplayerImpl","specs","specsNames","messages","subs","subsRefCount","specs_1","spec","name_1","_loop_1","refCount","this_1","sub","processMessage","types","isDone","name_2","drain","off","Connection","messageHandlers","ids","_connected","isTrace","inproc","sharedWorker","canPublish","handleConnectionChanged","bind","handleTransportMessage","replaySpecs","replayer","isObjectBasedTransport","trace","strMessage","isLoggedIn","authRequest","distributeMessage","handlerId","msgObj","order","Logger","logFn","subLoggers","customLogFn","loggerFullName","includeTimeAndLevel","existingSub","publishLevel","level","_publishLevel","consoleLevel","_consoleLevel","log","publishMessage","compareWith","loggerName","Interop","InteropMethodName","prefix","date","getHours","getMinutes","getSeconds","getMilliseconds","toPrint","GW_MESSAGE_CREATE_CONTEXT","GW_MESSAGE_ACTIVITY_CREATED","GW_MESSAGE_ACTIVITY_DESTROYED","GW_MESSAGE_CONTEXT_CREATED","GW_MESSAGE_CONTEXT_ADDED","GW_MESSAGE_SUBSCRIBE_CONTEXT","GW_MESSAGE_SUBSCRIBED_CONTEXT","GW_MESSAGE_UNSUBSCRIBE_CONTEXT","GW_MESSAGE_CONTEXT_DESTROYED","GW_MESSAGE_UPDATE_CONTEXT","GW_MESSAGE_CONTEXT_UPDATED","GW_MESSAGE_JOINED_ACTIVITY","ContextMessageReplaySpec","prepareConfig","configuration","ext","_d","nodeStartingContext","startingContextString","env","_GD_STARTING_CONTEXT_","_e","instanceId","windowId","pid","environment","region","gwConfig","gateway","gwURL","uid","applicationConfig","getApplication","uniqueAppName","appInstanceId","api","getConnection","bus","auth","gwToken","getAuth","defaultLevel","getLogger","libs","customLogger","timer","endTime","period","startTime","stop","GW3ContextData","contextId","isAnnounced","activityId","updateCallbacks","hasCallbacks","applyContextDelta","deepClone","added_1","added","updated_1","updated","mergeObjectsProperties","hash","WeakMap","RegExp","flags","what","withWhat","right","left","deepEqual","x","InvokeStatus","GW3Bridge","_contextNameToData","_gw3Subscriptions","_nextCallbackSubscriptionNumber","_contextNameToId","_contextIdToName","_connection","_logger","_gw3Session","subscribeToContextCreatedMessages","subscribeToContextUpdatedMessages","subscribeToContextDestroyedMessages","handleContextCreatedMessage","handleContextUpdatedMessage","handleContextDestroyedMessage","dispose","contextName","createContext","lifetime","createContextMsg","context_id","contextData","sentExplicitSubscription","invokeUpdateCallbacks","currentContext","calculatedDelta","calculateContextDelta","gwResponse","handleUpdated","resolveImmediately","un","thisCallbackSubscriptionNumber","hadCallbacks","joinedActivity","sendSubscribe","subscriptionKey","sendUnsubscribe","oldContext","createdMessageTypes_1","createdMessageType","contextCreatedMsg","activity_id","updatedMessageTypes_1","updatedMessageType","contextUpdatedMsg","justSeen","context_snapshot","updater_id","updateCallbackIndex","updateCallback","destroyedMessageTypes_1","destroyedMessageType","destroyedMsg","to","ContextsModule","_bridge","checkName","ready","promisify","successCallback","errorCallback","rejectAfter","ms","Client","callProtocolSubscribe","targetServers","stream","successProxy","errorProxy","methodResponseTimeout","waitTimeoutMs","methodDef","method_response_timeout","wait_for_method_timeout","delayTillNow","currentServers","getServerMethodsByFilterAndTarget","retry_1","streamInfo","servers","methodFilter","filterCopy","serverMethodMap","getMethods","methodsForInstance","getMethodsForInstance","methodAdded","onMethodAdded","methodRemoved","onMethodRemoved","serverAdded","onServerAdded","serverRemoved","onServerRemoved","onServerMethodAdded","serverMethodRemoved","onServerMethodRemoved","argumentObj","additionalOptions","methodDefinition","serversMethodMap","errorObj","additionalOptionsCopy","invokePromises","invocationMessages","methodResponseTimeoutMs","tryToAwaitForMethods","supportsStreaming","objectTypes","called_with","serversMethodPair","invId","invokePromise","race","invocationId","getInvocationResultObj","every","getInvokePromise","invocationResults","calledWith","invokeMessage","Success","allValues","currentValue","all_errors","allErrors","currError","invResult","interval","setInterval","clearInterval","filterByTarget","matches","myMatches","serverMethodPair","instanceMatch","localMachine","isLocal","instanceFilter","instanceDefinition","containsProps","methodMatch","repoMethod","prop","isMatch","filterValue","repoMethodValue","filterObjTypes","repoObjectTypes","objTypeToContains","object","objType","repoObjType","isFullfiled","containsAllFromFilter","String","matchingServers","resultMethodsObject","methodKey","identifier","prev","matchingMethods","getServerMethodsById","ServerSubscription","subscription","branchKey","closeSingleSubscription","pushDataToSingle","Request","requestContext","accept","acceptRequestOnBranch","acceptOnBranch","branch","rejectRequest","ServerStreaming","onSubRequest","rc","rm","handleSubRequest","onSubAdded","handleSubAdded","onSubRemoved","handleSubRemoved","streamCallbacks","subscriptionRequestHandler","request","subscriptionAddedHandler","subscriptionRemovedHandler","ServerBranch","subscriptions","getSubscriptionList","closeAllSubscriptions","pushData","ServerStream","_protocol","_repoMethod","_server","branches","bList","getBranchList","def2","accepts","returns","updateRepoMethod","Server","serverRepository","invocations","currentlyUnregistering","streaming","onInvoked","onMethodInvoked","createStream","streamDef","existingStream","streamMethodDefinition","getList","serverMethod","protocolState","streamUserObject","repoId","remove","wrappedCallbackFunction","resultCallback","resultValue","args","userCallback","registerCore","registerAsync","wrappedCallback","resultCalled_1","methodResult","userCallbackAsync","forStream","methodToBeRemoved","unregisterWithPredicate","removeMethodsOrStreams","filterPredicate","methodsOrStreamsToRemove","methodsToRemove","methodUnregPromises","addAsCurrentlyUnregistering","theFunction","unregisterInProgress","methodToExecute","invocationArgs","unStrException","_value","methodInvocationResult","InstanceWrapper","wrapped","getStreams","refreshWrappedObject","refresh","unwrap","user","machine","API","ClientRepository","methodsCount","addServer","serverId","wrapper","serverEntry","removeServerById","methodId","removeServerMethod","addServerMethod","createMethodIdentifier","that","gatewayId","display_name","object_types","input_signature","result_signature","getServersByMethod","allMethods","allServers","unsubscribeFunc","serversWithMethodsToReplay","returnUnsubWithDelayedReplay","methodsToReplay","unsubCalled","getServerById","methodInfo","collectionToReplay","ServerRepository","nextId","getById","SUBSCRIPTION_REQUEST","SUBSCRIPTION_ADDED","SUBSCRIPTION_REMOVED","ServerStreaming$1","repository","ERR_URI_SUBSCRIPTION_FAILED","nextStreamId","handleAddInterest","handleRemoveInterest","streamingMethod","subscriptionsMap","branchKeyToStreamIdMap","streamId","getStreamId","subscription_id","subscribeMsg","stream_id","sendSubscriptionFailed","br","dropSubscriptionMessage","closeMultipleSubscriptions","subscriptionsToClose","drop","allSubscriptions","onSubscriptionLifetimeEvent","method_id","eventName","handlerFunc","getNextStreamId","caller_id","arguments_kv","subscriptionId","errorMessage","reason_uri","needleBranch","ServerProtocol","clientRepository","handleInvokeMessage","isStreaming","registerMsg","restrictions","invocation_id","callerId","UserSubscription","subscriptionData","params","trackedServers","pair","onData","dataCallback","queued","dataItem","onClosed","closedCallback","onFailed","onConnected","setNewSubscription","newSub","STATUS_AWAITING_ACCEPT","STATUS_SUBSCRIBED","ERR_MSG_SUB_FAILED","ON_CLOSE_MSG_CLIENT_INIT","ClientStreaming","subscriptionsList","subscriptionIdToLocalKeyMap","nextSubLocalKey","handleErrorSubscribing","errorResponse","subLocalKey","pendingSub","timeoutId","callArgs","callOnClosedHandlers","handleSubscribed","acceptingServer","isFirstResponse","serverInstance","handleEventData","trackedServersFound","isPrivateData","oob","sendingServerId","receivedStreamData","requestArguments","private","onDataHandlers","queuedData","handleSubscriptionCancelled","expectedNewLength","closers","getNextSubscriptionLocalKey","registerSubscription","server_id","drainSubscriptions","subsInfo","localKey","closeSubscription","closingServer","closersCount","closingServerId","ClientProtocol","handlePeerAdded","handlePeerRemoved","handleMethodsAddedMessage","handleMethodsRemovedMessage","handleResultMessage","handleInvocationError","newPeerId","new_peer_id","remoteId","local","serverInfo","removedPeerId","removed_id","methodIdList","gW3ProtocolFactory","libConfig","readyPromise","existingSubscriptions_1","registeredMethods","registeredMethods_1","def","handleReconnect","protocolPromise","MessageBus","topic","routingKey","removeEmptyValues","routing_key","target_identity","response","watchOnEvent","keysMatch","cleaned","obj1","obj2","keysObj1","allMatch","GlueCore","userConfig","gdVersion","preloadPromise","gdPreloadPromise","_interop","_contexts","_bus","glueInitTimer","internalConfig","registerLib","inner","initTime","initEndTime","initStartTime","setupMetrics","initTimer","metricsPublishingEnabledFunc","getMetricsPublishingEnabled","rootMetrics","disableAutoAppSystem","featureMetric","reportingSystem","action","payload","addFAVSupport","setupContexts","hasActivities","activities","setupBus","setupExternalLibs","externalLibs","createCallback","setupExternalLib","authPromise","authConfig","agmConfig","libsReadyPromises","coreVersion","feedback","feedbackInfo","performance","glueVer","glueConfig","browser","timing","memory","initTimes","extOptions","enrichGlue","updatePerfData","extendStatics$1","__extends$1","__assign$1","__awaiter$1","__generator$1","ActivityEntity","_id","_update","other","_updateCore","_beforeDelete","isString","arg","isUndefined","isUndefinedOrNull","isFunction","ifNotUndefined","doWithIt","ActivityType","ownerWindow","helperWindows","_ownerWindow","_helperWindows","initiate","_manager","WindowType","appByWindowTypeGetter","_appByWindowTypeGetter","getWindows","activity","isIndependent","createWindow","EntityEvent","entitiy","entity","EntityEventContext","eventType","ActivityStatusChangeEventContext","newStatus","oldStatus","EntityEventType","StatusChange","ActivityContextChangedEventContext","ActivityContextChange","Added","Removed","Updated","Closed","ActivityWindowEvent","ActivityWindowJoinedActivity","ActivityWindowLeftActivity","ActivityState","Created","Started","Destroyed","ActivityAGM","_activity","_ensureHasAgm","AGM","w","methodNames","methodsForWindow","currentWindowMethod","activityServers","promisify$1","potentialTargets","firstElem","_isInstance","_isActivityWindow","win","parameters","AttachedActivityDescriptor","manager","ownerActivityId","_ownerActivityId","ownerId","windowIds","frameColor","detach","descriptor","detachActivities","nextTick","cb","nodeify","resp","Activity","actType","_actType","_status","_context","_ownerId","_agm","getActivityType","addWindow","addWindowToActivity","windowType","createStackedWindows","windowTypes","leaveWindowFromActivity","getWindowsByType","setContext","setActivityContext","updateContext","updateActivityContext","onStatusChange","subscribeActivityEvents","ns","os","onWindowEvent","subscribeWindowEvents","onContextChanged","subscribeActivityContextChanged","act","stopActivity","clone","attach","attachActivities","onActivityAttached","subscribeActivitiesAttached","newActId","oldActId","onDetached","subscribeActivitiesDetached","newAct","originalActivity","_updateDescriptors","allStates","_attached","setFrameColor","color","callbacksToWait","underlyingWindow","getFrameColor","LogLevel","Trace","Debug","Info","Warn","Logger$1","GlueLogger","_glueLogger","GetNamed","Get","owner","GetTypeName","Level","_getMessage","exec","ActivityWindow","windowGetter","hcWindowId","_type","_activityId","_instance","_isIndependent","_windowGetter","_hcWindowId","getBounds","getWindowBounds","getWindowType","getActivityById","setVisible","isVisible","setWindowVisibility","activate","focus","activateWindow","setBounds","bounds","setWindowBounds","closeWindow","onActivityJoined","_subscribeForActivityWindowEvent","onActivityRemoved","event","ActivityStatus","getMessage","gwMmessageError","gwMessageAddActivityTypes","gwMessageActivityCreated","gwMessageActivityDestroyed","gwMessageActivityInitiated","gwMessageJoinedActivity","gwMessageActivityJoined","gwMessageActivityLeft","gwMessageOwnerChanged","gwMessageAddPeerFactories","gwMessagePeerFactoriesAdded","gwMessagePeerFactoriesRemoved","gwMessagePeerCreated","GW3Bridge$1","_activityChangeCallbacks","_activityTypeStatusChangeCallbacks","_activityWindowChangeCallbacks","_windowTypeStatusChangeCallbacks","_peerIdAndFactoryIdToPeerType","_peerFactoriesRegisteredByUs","_contextSubscriptions","_activityTypesInitiatedFromMe","_config","_sessionJoinedPromise","_sessionJoinedPromiseResolve","_activityJoinedPromise","_activityJoinedPromiseResolve","glue42gd_1","addRefreshHandler","setGWToken","activityTypeGwMessageEntityToActivityType","nameToWindowType","windowName","owner_type","helper_types","peerFactoryGwMessageEntityToWindowType","peer_type","activityGwMessageToActivity","owner_id","activity_type","activityToActivityStatusChangeEvent","forwardActivityTypeMessagesToStatusEventHandlers","handleActivityCreatedMessage","handleActivityDestroyedMessage","forwardActivityMessagesToStatusEventHandlers","forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers","forwardPeerFactoryMessagesToStatusEventHandlers","forwardPeerFactoryMessagesToPeerFactoryRequests","handlePeerFactoriesAdded","handlePeerFactoriesRemoved","forwardActivityWindowMessagesToEventHandlers","disposeRequestHandling","exit","mode","activity_types","typesToTrack","initReady","onActivityTypeStatusChange","registerActivityType","activityTypeName","toActivityPeerConfig","windowDefinition","activityType","invokeCallbacks","unregisterActivityType","onWindowTypeStatusChange","registerWindowFactory","factory","factories","unregisterWindowFactory","factory_ids","onActivityStatusChange","initiateActivity","initiateMsg","initial_context","isOverrideTypeDefinition","types_override","helpers","wd","sendCreateAndMapResultingMessagesToPromise","initMsg","fullReplace","removedKeys","removedKeys_1","announceWindow","activityWindowId","registerWindow","independent","shouldSendReady","activityInfo","getAgmInstance","generateWindowGetter","onActivityWindowChange","layout","width","height","top","cellSize","peer_name","created_id","joinActivity","destroy_peer_id","getAnnouncementInfo","announcementInfo","activityWindowType","activityWindowIndependent","activityWindowName","search","URLSearchParams","searchParams","maybeName","target_id","leaveActivity","getActivityTypes","getWindowTypes","getActivities","getActivityWindows","windowDefinitions","visible","cloneActivity","cloneOptions","into","merge","newActivityInfo","onActivitiesAttached","onActivitiesDetached","onActivityAttachedDescriptorsRefreshed","getAttachedDescriptors","getRandomRequestId","forwardAddedAndRemovedMessagesToEventHandler","addedMessageType","removedMessageType","mapper","getGetEntityEvent","isAdded","forwardMessageToEventHandler","messageType","getEntityEvent","ent","h","initiatedMessageType","initiatedMessageFilter","createdMessageFilter","cancelledMessageType","cancelledMessageFilter","createdMessageToPromiseResolution","resolveCreatedPromise","rejectCreatedPromise","initiatedSubscription","createdSubscription","cancelledSubscription","errorSubscription","reqId","createdPromise","initiatedMessageAck","dropSubscriptions","dropSubscription","msg4","msg1","msg2","msg3","toReturn","peerFactoryIdAndOwnerIdToWindowType","factoryId","peerType","subscribeToContext","unsubscribeContext","activityCreatedMessage","participants","createdMessage","peer_factory","gateway_token","joinedMessage","joinedId","joined_id","joinedType","joined_type","joinedName","joined_name","left_id","list","ActivityMy","_myAttached","_myDetached","_myAttachedTo","_myDetachedFrom","_myActivityFrameColorChanged","_myActivityJoinedCallbacks","_myActivityRemovedCallbacks","_myContextUpdateCallbacks","_m","am","_subscribeMyContextChanged","_subscribeMyWindowEvent","_subscribeActivitiesAttached","_subscribeActivitiesDetached","onWindowFrameColorChanged","_subscribeWindowFrameColorChanged","_w","announcedWindows","myWin","onActivityLeft","onActivityDetached","onAttachedToActivity","onDetachedFromActivity","attached","onFrameColorChanged","myActivity","_notifyMyContextChanged","_notifyMyWindowEvent","callbackStore","_notifyAttached","_notifyDetached","_notifyAttachedTo","_notifyDetachedFrom","detached","oldAct","ReadyMarker","signalsToWait","_signals","_callbacks","setCallback","isSet","isError","_error","signal","getError","EntityObservableCollection","processNew","_items","_listeners","_processNew","addOne","items","htmlContainer","internalEntity","_updateInternalCollections","_notifyListeners","getByName","getOrWait","entityAddedHandler","entityAsAny","isActivityDestroy","isWindowClose","oldEntity","ActivityManager","bridge","autoAnnounce","_announcedWindows","_attachedCallbacks","_detachedCallbacks","_frameColorChangesCallbacks","_windowHandlers","_activityTypes","_grabEntity","_windowTypes","_activities","_windows","_dataReadyMarker","_descriptorsMarker","_readyMarker","dataErr","errCatch","refreshDescriptors","_handleActivitiesAttached","_handleActivitiesDetached","_handleActivityDescriptorsRefreshed","_handleWindowFrameColorChanged","_subscribeForData","aw","_getInitialData","bridgeType","ownerWindowType","helperWindowTypes","ownerDefinition","helperDefinitions","relativeTo","relativeDirection","windowStyleAttributes","actId","subscribeActivityTypeEvents","at","factoryMethod","getName","array","predicate","currentWindow","windowEventHandler_1","unsubscribeWindowEvents","subscribeWindowTypeEvents","wt","window_1","wrappingHandler","found","windowTypeOrConfiguration","relativeToWindow","wid","relativeWindowTypes","relativeWindows","useExisting","activityWindows","alreadyCreated","removedKey","descriptors","stateWrapped","u","subscribeActivityFrameColorChanged","ac","descriptorAsObjectFromAPI","oldActivityId","newActivityId","ActivityManagementAPI","_my","activityTypes","_getActivityTypesWrapper","_getWindowTypesWrapper","registerFactory","unregisterFactory","announce","onAttached","onActivityFrameColorChanged","ActivityAPI","_mgr","aware","inActivity","getAvailableFrameColors","ActivityModule","logLevel","_isUsingHCImplementation","gdMajorVersion","_isUsingGW3Implementation","checkIsUsingGW3Implementation","activityManager","disableAutoAnnounce","_api","_readyPromise","GetFunctionalEntitlementMethodName","CanIMethodName","OnEventMethodName","createRegistry$1","lib$2","objectValues","objectClone","ApplicationImpl","_appManager","onInstanceStarted","onInstanceStopped","onAppRemoved","onAppChanged","onAppAvailable","onAppUnavailable","_props","Title","Version","AutoStart","IsShell","Caption","IsHidden","ApplicationName","ActivityWindowType","Arguments","AllowMultiple","IsReady","Icon","IconUrl","SortOrder","UserProperties","autoStart","caption","hidden","container","allowMultiple","Type","Mode","isActivity","styleAttributes","WindowStyleAttributes","searchFor","modeIndex","startModeIndex","stopModeIndex","style","updateFromProps","Name","Context","Options","acsResult","Instance_0","Id","handleInstanceStarted","check","filtered","isActivityInstance","onInstanceAgmServerReady","waitForApplicationInstance","onAvailable","onUnavailable","onChanged","onRemoved","InstanceImpl","_appName","startFailed","onAgmReady","_addToRegistry","onStopped","_unsubscribeInstanceStopped","_unsubscribeInstanceAgmServerReady","activityInstance","instWinCntx","_t42","activityIsOwner","activityOwnerInstance","_startUpContext","_title","_isActivityInstance","_inActivity","_agmInstance","ActivityId","updateAgmInstanceFromProps","AgmServers","GD3","agmInstances","gdAgmServers","propsAgmServer","propsAgm","machineName","userName","handleInstanceStopped","AppManagerImpl","_gdMajorVersion","_apps","_instances","getMyInstance","instanceId_1","handleAppAdded","_getAppId","_updateAppFromProps","handleAppUpdated","handleAppRemoved","handleAppReady","_getAppOrThrow","available","_getInstanceId","_getInstanceAppName","_updateInstanceFromProps","_getInstanceOrThrow","_matchInstance","handleInstanceAgmServerReady","handleInstanceStartFailed","handleInstanceUpdated","_replay","onInstanceStartFailed","onInstanceUpdated","onAppAdded","_getInstanceByIdAndName","itemsToReplay","promisify$2","EntitlementsImpl","handleBranchModified","handleBranchesModified","getRegion","_agmInvoke","Region","getBranches","Branches","getCurrentBranch","Branch","setRegion","ResultMessage","setCurrentBranch","currentUser","getFunctionalEntitlement","funct","Entitlement","Function","getFunctionalEntitlementBranch","canI","func","Result","canIBranch","onBranchesChanged","onBranchChanged","restart","transformFunction","AppManagerFactory","START_ONLY","SKIP_ICONS","entitlements","skipIcon","snapshot","skipIcons","resolveFunc","rejectFunc","resultPromise","streamData","events","createDataSubscription","windowStore","WindowStore","waitForTimeoutInMilliseconds","_pendingWindows","_pendingWindowsStates","getIfReady","remote","urlChanged","setReadyState","targetWindowState","markReadyToShow","setUrlChangedState","waitFor","onReadyWindow","onAdded","Utils$1","callbackifyPromise","fail","getMonitor","displays","workingAreaWidth","workingAreaHeight","monitor","totalOverlap","calculateTotalOverlap","getDisplayCenterOfScreen","display","max","r1","r2","r1x","r1y","r1xMax","r1yMax","r2x","r2y","r2xMax","r2yMax","min","windowFactory","executor","appManagerGetter","_group","resultWindow","_mode","_url","url","_bounds","_frameColor","_focus","_neighbours","neighbours","_groupId","groupId","_isGroupHeaderVisible","isGroupHeaderVisible","_isTabHeaderVisible","isTabHeaderVisible","_isTabSelected","isTabSelected","_settings","_isVisible","isCollapsed","_windowState","_tabGroupId","tabGroupId","_isLocked","isLocked","_frameButtons","_zoomFactor","zoomFactor","moveResize","dimensions","resolveTimeout","unsubscribeBoundsChanged","areBoundsEqual","onBoundsChanged","toBeVisible","isVisibilityCorrect","onVisibilityChanged","waitForLockingChanged","onLockingChanged","onUrlChanged","onCollapsed","onExpanded","onMaximized","onMinimized","onNormal","onTabHeaderVisibilityChanged","getNeighboursByDirection","direction","winId","getApplicationName","_APPLICATION_NAME","getWindowInfo","requested","minHeight","maxHeight","minWidth","maxWidth","areHeightsEqual","areWidthsEqual","areLeftsEqual","areTopsEqual","handleWindowClose","handleWindowChangeState","handleTitleChanged","newTitle","handleVisibilityChanged","handleUrlChanged","newUrl","handleWindowSettingsChanged","handleContextUpdated","handleFrameIsLockedChanged","handleBoundsChanged","handleFocusChanged","isFocused","handleFrameButtonAdded","frameButton","buttonObj","btn","buttonId","handleFrameButtonRemoved","frameButtonId","button","handleFrameButtonClicked","handleFrameColorChanged","handleFrameAttached","handleFrameSelectionChanged","newWindow","prevWindow","selectedWindow","previousWindow","un_1","onTabSelectionChanged","newWin","prevWin","handleCompositionChanged","handleGroupHeaderVisibilityChanged","handleTabHeaderVisibilityChanged","handleGroupChanged","newGroup","oldGroup","handleGroupAssociation","group","handleAttached","newTabGroupId","tabHeaderVisible","handleDetached","handleWindowAttached","handleWindowDetached","handleZoomFactorChanged","hostInstance","agmInstance","frameButtons","opened","topNeighbours","leftNeighbours","rightNeighbours","bottomNeighbours","screen","monitors","maximize","restore","minimize","maximizeRestore","currEvent","collapse","expand","toggleCollapse","setTitle","setStyle","errMessage","setOnTop","onTop","resetButtons","buttons","setSizeConstraints","constraints","navigate","addFrameButton","buttonInfo","imageBase64","removeFrameButton","show","hide","center","snap","targetWindowGroup","targetGroup","targetWindow","onWindowAdded","showLoader","loader","hideLoader","lock","unlock","getIcon","icon","setIcon","base64Image","setTabTooltip","attachTab","tab","sourceWindowId","targetWindowId","argsForSend","sourceWin","detachTab","opt","_options","hideTabHeader","visibilityChangeHeard","detachedHeard","unVisibility","unDetached","setTabHeaderVisible","toBeTabHeaderVisible","showPopup","createFlydown","setModalState","isModal","setZoomFactor","zoomIn","zoomOut","showDevTools","capture","captureOptions","flash","suppliedOptions","flashOptions","shouldFlash","onClose","onTitleChanged","onFrameButtonAdded","onFrameButtonRemoved","onFrameButtonClicked","onContextUpdated","onFocusChanged","onGroupChanged","onWindowAttached","onWindowDetached","onClosing","onRefreshing","prevent","onZoomFactorChanged","tabs","allWindows","getURL","getTitle","resizeTo","moveTo","getParentWindow","myParentId","parentInstanceId","getChildWindows","Events","GDExecutor","agmTarget","stylePromises","wait","toolTip","allowClose","allowCollapse","allowLockUnlock","allowMaximize","allowMinimize","tabTooltip","tabToolTip","buttonsConfig","snappingEdge","command","replace","dataURL","toShow","optionsCopy","reformatedOptions","targetLocation","popupBounds","size","targetId","popupId","fullOptions","horizontalOffset","verticalOffset","reformatFlydownOptions","zoneIds","zones","z","flydownSize","cancel","destroy","clearFlydownArea","handleFlydownBoundsRequested","cancelCallback","callbackData","responses","defaultResponse","zoneId","flydownId","flydownWindowBounds","flydownWindowId","captureGroup","groupWindowIds","setGroupHeaderVisible","getGroupTitle","setGroupTitle","addCloseHandler","assignGeneralIfUnassigned","zone","valueFromOptions","flydownBounds","flydownActiveArea","activeArea","areaIds","getWindowsByTabGroupId","GDEnvironment","wndId","_waitTimeout","normalizeInstance","_windowId","_appManagerGetter","caller","respondToEvent","streamResolve","streamReject","updateWindow","copyOptions","windowState","tabAttached","tabDetached","onEvent","onCompositionChanged","onGroupHeaderVisibilityChanged","onWindowGotFocus","onWindowLostFocus","windowInfo","readyResolve","extendedStreamEvent","getExtendedStreamEvent","windowInfoCreatedEvent","windowObjectAndEvents","theWindow","theWindowEvents","windowInfoBoundsChangedEvent","windowInfoUrlChangedEvent","windowInfoTitleChanged","windowInfoCompositionChanged","neighbors","groupHeaderVisible","windowInfoFocusChanged","focusChanged","frameId","winsToBeNotified_1","oldTabGroupId","winsToBeNotified_2","newWindowId","prevWindowId","windowObjAndEvents","mapToWindowConstructorOptions","isActiveTab","streamEvent","charAt","toUpperCase","groupFactory","_windowsId","waitForHeaderVisibilityChanged","onHeaderVisibilityChanged","groupObject","_mapToWindowObjects","winObjects","windowObject","_mapToWindowObject","mappedWindows","mappedWindow","isHeaderVisible","showHeader","hideHeader","onWindowRemoved","groupAPI","groupInternal","removeWindow","window_2","groupsFactory","_groups","heardForWindowsCounter","findGroupByWindow","groupFound","addNewWindow","windowGroupId","createdGroup","createOrGetGroup","deleteGroup","newGroupId","oldGroupId","groupEvents","groupsAPI","groupsEvents","onWindowMoved","WindowsFactory","groups","isReady","gdPromise","rej","envDetector","windowAdded","windowRemoved","myWindow","errorHandler","windowsForListing","findById","onTabAttached","onTabDetached","unsubscribed","store","LayoutStore","layouts","removeWhere","condition","where","first","seed$1","alphabet$1","previousSeed$1","shuffled$1","randomFromSeed$1","ORIGINAL$1","reset$1","setCharacters$1","getShuffled$1","shuffle$1","alphabet_1$1","crypto$1","randomByteBrowser$1","encode_1$1","decode_1$1","build_1","isValid$1","lib$3","createCommonjsModule$1","shortid$1","ContextProvider","activitiesGetter","registeredRequestsMethods","onSaveRequested","registerRequestMethods","isActivityOwner","context_1","requestResult","activityContext","windowContext","transformACSLayout","something","accumulator","convertedValue","LayoutImpl","components","metadata","LayoutsAPIImpl","activityGetter","setDefaultGlobal","clearDefaultGlobal","getDefaultGlobal","isSlimMode","l","gotSnapshot","save","verifyNotSlimMode","ignoreHidden","layoutObject","actIds","appIds","ignoreLayoutRestrictions","isVisibleWindow","ignoreMyInstance","autoCollectApps","invokeMethodAndTrack","activityIdToJoin","restoreActivityOwner","ignoreActivityWindowTypes","closeRunningInstance","reuseWindows","t42","restoreOptions","activityToJoin","closeOldWindows","reuseExistingWindows","toClose","splash","getInstancesToClose","import","export","getObjectValues","Layouts","rename","newName","oldName","updateMetadata","hibernate","resume","getCurrentLayout","onRestored","onRenamed","updateAppContextInCurrent","skipStreamEvent","agmResult","streamEventReceived","handleResult","shellApp","isShell","shellApplicationName","ACSStream","resolveReady","rejectReady","resolveGotSnapshot","rejectGotSnapshot","noRetry","transform","checkForLayoutEventMethod","IsSnapshot","addLayouts","OnLayoutAdded","removeLayouts","OnLayoutRemoved","changeLayouts","OnLayoutChanged","renameLayouts","OnLayoutRenamed","restoredLayout","OnLayoutRestored","Token","layoutsData","layoutData","removedLayouts","removedLayout","existingLayout","compareLayouts","changedLayouts","changedLayout","renamedLayouts","renamedLayout","layout1","layout2","restoredLayouts","LayoutsFactory","acsStream","DisplayCommand","DisplayManager","callGD","GetAll","decorateDisplay","getPrimary","isPrimary","Capture","captureAll","CaptureAll","getMousePosition","GetMousePosition","original","switchChannel","swId","CONTEXT_PREFIX","SharedContextSubscriber","isChannel","createContextName","___","startsWith","channelContextName","getContextData","ChannelsImpl","shared","subsKey","changedKey","joinCore","joinNoSelectorSwitch","leaveCore","leaveNoSelectorSwitch","changeSelector","doesChannelExist","intervalId","sharedContexts","interopLib","setupAGM","CommandMethod","HotkeysImpl","firstHotkey","hotkeys","Map","hkToLower","hotkey","formatHotkey","registerInvokeAGMMethod","delete","unregisterAll","isRegistered","IntentCommand","version$2","prepareConfig$1","getLibConfig","defaultMode","trueMode","getModeAsString","IntentEvents","intentListeners","invokeGlue","Raise","intentFilter","Find","FindByContext","unsubId","handleEvent","IntentListenerRaised","Glue42Notification","actions","badge","dir","image","lang","renotify","requireInteraction","silent","removeEventListener","dispatchEvent","Notifications","methodRegistered","notifications","notification","g42notification","handleNotificationAction","severity","glueRoutingDetailMethodName","g42notificationId","g42action","g42interopMethod","g42interopTarget","stringValue","glueAction","payload_1","event_1","Event","onaction","actionInterop","event_2","onclick","clickInterop","ThemesImpl","core","getConfiguration","getMethodName","getAll","getCurrent","selected","select","theme","setMethodName","sharedContextName","getThemesMethodName","setThemesMethodName","factory$4","_displays","getLibLogger","newLogger","loggerConfig","windowsLogger","debugLog","activityLogger","lay","channelsAPI","hotkeysAPI","factory$1","displaysLogger","agmAPI","intentsAPI","notificationsAPI","themesAPI","themes","factory$3","currentLog","glueFactoryLog","whatToExpose","shouldSetToWindow","autoInjected","Glue","whatToExpose$1","bytes","format_browser","mask","LN2","generate_1","test","basedir","base","commonjsRequire","RemoteWebWindow","control","callControl","skipResult","Control","CONTROL_METHOD","setLocalWindow","setLocalInstance","onStart","LocalWebWindow","screenLeft","screenTop","outerWidth","outerHeight","getBoundsSync","getContextSync","ChildWebWindow","createMethodName","initStartupContext","startedByScript","Windows","childWindows","trackWindowsLifetime","remoteWindow","remoteFromServer","relativeWindowId_1","relativeWindow","relativeWindowBounds","relativeDir","newBounds","optionsString","_f","availWidth","startingContext","registerChildStartupContext","getRelativeBounds","cw","closed","rect","ok","asPromise","withDefault","defaultValue","withException","map2","ar","mapError","andThen","freeze","isOk","isErr","successes","isJsonArray","json","isJsonObject","expectedGot","expected","got","typeString","printPath","paths","prependAt","newAt","rest","getOwnPropertySymbols","propertyIsEnumerable","__rest","Decoder","run","kind","input","runPromise","runWithException","succeed","string","boolean","constant","isEqual","decoders","decoder","err$$1","decodeValue_1","tuple","nth","union","ad","bd","oneOf","intersection","ds","anyJson","unknownJson","dict","optional","errors","errorsList","valueAt","jsonAtPath","fixedValue","lazy","mkDecoder","nonEmptyStringDecoder","windowLayoutItemDecoder","groupLayoutItemDecoder","children","columnLayoutItemDecoder","rowLayoutItemDecoder","workspaceComponentDecoder","windowComponentDecoder","componentType","parentId","main","layoutTypeDecoder","newLayoutOptionsDecoder","restoreOptionsDecoder","layoutDecoder","controller","layoutType","setContextDataToEmptyObjIfMissing","contextWithDataObj","updateChannel","newData","updateData","setPathSupported","pathValues","setPaths","Channels","fetchTimeout","timeoutMilliseconds","timeoutHit","fetch","promisePlus","timeoutMessage","Application","startWithoutTimeout","manifest","details","parsedManifest","openOptions","appWindow","resolveCallback","startedAppsWindowIdsToInstances","checkResolveCondition","appInstanceStartedPromise","startedInstance","RemoteInstance","WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND","error_1","LocalInstance","unsubscribe_1","nonEmptyStringDecoder$1","fdc3AppImageDecoder","fdc3IconDecoder","fdc3IntentDecoder","customConfig","glue42CoreCreateOptionsDecoder","fdc3ApplicationConfigDecoder","appId","manifestType","contactEmail","supportEmail","publisher","glue42CoreApplicationConfigDecoder","customProperties","AppManager","DEFAULT_POLLING_INTERVAL","OKAY_MESSAGE","LOCAL_SOURCE","myId","_myInstance","remoteSources","subscribeForRemoteApplications","localApplications","validatedApplications","getValidatedApplications","addApplications","trackInstanceLifetime","replay","initialFetchAppsPromises","remoteSources_1","remoteSource","appsFetch","pollingInterval","getAppProps","requiredProps","fromEntries","entries","handleAppsChanged","newlyAddedApplications","_loop_2","newlyAddedApplication","currentApplicationWithTheSameNameAndSource","this_2","currentApplicationWithTheSameNameButDifferentSource","currentApplication","appProps","newlyAddedApplicationInstance","newlyAddedApplications_1","handleAppsAdded","currentAppNames","newApplications_1","newApplication","newApplicationInstance","handleAppsRemoved","currentApplicationsFromThisSource","newlyAddedApplicationNames","removedApplications_1","currentApplicationFromThisSource","removedApplication","tryPopulateMyInstanceApplication","myApp","serverApp","remoteInstance","interopOptions_1","Notification","permission","requestPermission","raiseUsingWebApi","defaultAssetsBaseLocation","defaultWorkerName","defaultConfigName","defaultConfig","autoRestore","autoSaveWindowContext","assets","libraries","getRemoteConfig","remoteConfigLocation","extendConfig","extends","SaveContextMethodName","LayoutsController","storage","autoSaveContext","handleControlMessage","globalLayouts","workspaceLayouts","layoutOptions","autoSave","openedWindows","getRemoteWindowsInfo","getLocalLayoutComponent","storeAutoLayout","restoreComponents","restoreAutoSavedLayout","layoutName","mainComponent","getAutoLayout","c","newWindowOptions","windows_1","interopServer","layoutCommand","parentInfo","LayoutStorage","localStore","autoStore","remoteStore","foundRemote","foundLocal","nonConflictLocal","localLayout","remoteLayout","allowSave","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","receiver","IDBTransaction","objectStoreNames","objectStore","wrap","wrapFunction","IDBDatabase","transaction","IDBCursor","advance","continue","continuePrimaryKey","storeNames","tx","transformCachableValue","unlisten","complete","DOMException","cacheDonePromiseForTransaction","constructors","instanceOfAny","IDBObjectStore","IDBIndex","Proxy","IDBRequest","promisifyRequest","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","async","storeName","shift","returnVal","oldTraps","LocalStore","_database","blocked","upgrade","blocking","terminated","indexedDB","openPromise","oldVersion","newVersion","db","openDB","setUpDb","database","put","contains","createObjectStore","JSONStore","storeBaseUrl","fetchUrl","decodeResult","AutoStorage","getObjectFromLocalStorage","getKey","setObjectToLocalStorage","localStorage","getItem","KEY","setItem","hookCloseEvents","layoutsController","allChildren","firstChild","closeEveryone","__assign$2","PerfTracker","initialPublishTimeout","publishInterval","lastCount","scheduleCollection","collect","collectMemory","collectEntries","totalJSHeapSize","usedJSHeapSize","allEntries","getEntries","featureMetricFunc","perfConfig","pagePerformanceMetrics","enabled","initPerf","replayArgumentsArr","replayArgument","timers","timerName","marks","mark","currentTime","diff","timerObj","requireFunc","startupTimer","lib$1$1","loggerError","GW_MESSAGE_DESTROY_CONTEXT","gdConsoleLevel","consoleLogLevel","commands","deletePath","setValueToPath","pathArr","_protocolVersion","contextsDomainInfo","uri","calculateContextDeltaV2","calculateContextDeltaV1","setPath","pathValues_1","pathValue","pathValues_2","_r","checkData","checkPath","paths_1","finally","_allowTrace","setupInterop","duration","deprecatedDecorator","wrong","proper","agmAny","method_added","method_removed","server_added","server_method_aded","server_method_removed","coreFactoryFunction","glueWebFactory","builtCoreConfig","isWebEnvironment","shouldInitializeChannels","shouldInitializeAppManager","gdWindowContext","channelsLib","appManagerLib","coreConfig","_g","_h","_j","_k","_l","_o","_p","_q","remoteConfig","resultWebConfig","lastIndex","remoteType","coreLib","baseLocation","layoutsStorage","windowAny","GlueWeb","defaultGlueConfig","fdc3AppName","patchSharedContexts","fdc3","clientGlueConfig","GlueWebFactory","waitGlue42GD","setupGlue","agentApi","coreDesktopAgent","desktopAgent","createDesktopAgent","fdc3Factory"],"mappings":"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"}