{"version":3,"file":"fdc3-glue42.js","sources":["../src/utils.ts","../src/channels/channel.ts","../src/channels/channels.ts","../src/agent.ts","../node_modules/@glue42/desktop/dist/desktop.es.js","../../web/dist/web.es.js","../src/main.ts","../src/index.ts"],"sourcesContent":["import { FDC3 } from \"../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"./windowtype\";\n\n/**\n * Changes to subscribe to comply with the FDC3 specification:\n * 1. Skip updates from myself\n * 2. Ignore initial replay\n */\nexport const newSubscribe = (id: string, callback: (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => void) => {\n    let didReplay = false;\n\n    return (window as WindowType).glue.contexts.subscribe(id, (data: any, delta: any, removed: string[], unsubscribe: () => void, extraData?: any) => {\n        if (!didReplay) {\n            didReplay = true;\n            return;\n        }\n\n        const updateFromMe = extraData.updaterId === (window as WindowType).glue.interop.instance.instance;\n\n        if (!updateFromMe) {\n            callback(data, delta, removed, unsubscribe, extraData);\n        }\n    });\n};\n\n/**\n * Returns a list of all channel contexts. We are not using `glue.channels.list()` so that @glue42/fdc3 can be used with older versions of the Glue42 JS SDK.\n */\nexport const getChannelsList = async () => {\n    const channelNames = await (window as WindowType).glue.channels.all();\n    const channelContents: Array<Glue42.Channels.ChannelContext> =\n        await Promise.all(channelNames.map((name: string) => (window as WindowType).glue.channels.get(name)));\n\n    return channelContents;\n};\n\nexport const isEmptyObject = (obj: object): boolean => {\n    return Object.keys(obj).length === 0 && obj.constructor === Object;\n};\n\nexport const isGlue42Core = !navigator.userAgent.toLowerCase().includes(\" electron/\");\n\nexport const Listener = (actualUnsub:\n    (() => void)\n    | Promise<() => void>\n): FDC3.Listener => {\n    return {\n        unsubscribe(): void {\n            if (!actualUnsub) {\n                console.error(\"Could not unsubscribe!\");\n                return;\n            }\n\n            if (typeof actualUnsub === \"function\") {\n                actualUnsub();\n            } else {\n                (actualUnsub as Promise<() => void>).then((unsubFunc: () => void) => unsubFunc());\n            }\n        }\n    };\n};\n","import { FDC3 } from \"../../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { WindowType } from \"../windowtype\";\nimport { newSubscribe } from \"../utils\";\n\nexport class SystemChannel implements FDC3.Channel {\n    id: string;\n    readonly type: string = \"system\";\n    displayMetadata: FDC3.DisplayMetadata;\n\n    constructor(glChannel: Glue42.Channels.ChannelContext) {\n        this.id = glChannel.name;\n        this.displayMetadata = glChannel.meta;\n    }\n\n    broadcast(context: FDC3.Context): Promise<void> {\n        return (window as WindowType).glue.channels.publish(context, this.id);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<FDC3.Context | null> {\n        const channel = await (window as WindowType).glue.channels.get(this.id);\n\n        const { data } = channel;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextType: string, handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = (window as WindowType).glue.channels.subscribeFor(this.id, subHandler);\n\n        return {\n            unsubscribe(): void {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n\n    join(): Promise<void> {\n        return (window as WindowType).glue.channels.join(this.id);\n    }\n\n    leave(): Promise<void> {\n        return (window as WindowType).glue.channels.leave();\n    }\n}\n\nexport class AppChannel implements FDC3.Channel {\n    readonly type: string = \"app\";\n\n    constructor(public id: string) {\n    }\n\n    broadcast(context: FDC3.Context): Promise<void> {\n        return (window as WindowType).glue.contexts.update(this.id, context);\n    }\n\n    async getCurrentContext(contextType?: string): Promise<FDC3.Context | null> {\n        const context = await (window as WindowType).glue.contexts.get(this.id);\n\n        const { data } = context;\n\n        if (contextType) {\n            return data && data.type === contextType\n                ? data\n                : null;\n        }\n\n        return data;\n    }\n\n    addContextListener(handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextType: string, handler: FDC3.ContextHandler): FDC3.Listener;\n    addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        const subHandler = (data: any): void => {\n            if (contextType) {\n                if (data?.type === contextType) {\n                    handler(data);\n                }\n            } else {\n                handler(data);\n            }\n        };\n\n        const unsubPromise = newSubscribe(this.id, subHandler);\n\n        return {\n            unsubscribe: (): void => {\n                unsubPromise.then((unsub) => unsub());\n            }\n        };\n    }\n}\n","import { FDC3 } from \"../../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport { SystemChannel, AppChannel } from \"./channel\";\nimport { WindowType } from \"../windowtype\";\nimport { getChannelsList, isGlue42Core, newSubscribe, isEmptyObject, Listener } from \"../utils\";\n\ninterface PendingSubscription {\n    contextType: string;\n    handler: (context: FDC3.Context) => void;\n    setActualUnsub: (actualUnsub: () => void) => void;\n}\n\nconst createChannelsAgent = (): FDC3.ChannelsAPI => {\n    let currentChannel: FDC3.Channel | null;\n    let pendingSubscription: PendingSubscription | null;\n\n    const channels: { [name: string]: FDC3.Channel } = {};\n\n    let systemChannels: string[] = [];\n\n    const doesAppChannelExist = async (name: string): Promise<boolean> => {\n        const exists = (await (window as WindowType).glue.contexts.all())\n            .some((ctxName) => ctxName === name);\n\n        return exists;\n    };\n\n    const createNewAppChannel = async (channelId: string): Promise<void> => {\n        await (window as WindowType).glue.contexts.set(channelId, null);\n    };\n\n    const isSystem = (channel: FDC3.Channel | null): boolean => {\n        if (!channel) {\n            return false;\n        }\n        return systemChannels.some((n) => n === channel.id);\n    };\n\n    const mapToFDC3SystemChannel = (glueChannel: Glue42.Channels.ChannelContext): FDC3.Channel => {\n        return new SystemChannel(glueChannel);\n    };\n\n    const mapToFDC3AppChannel = (channelName: string): FDC3.Channel => {\n        return new AppChannel(channelName);\n    };\n\n    const handleSwitchChannelUI = (channelId: string): void => {\n        if (typeof channelId !== \"undefined\") {\n            setCurrentChannel(channels[channelId]);\n        }\n    };\n\n    const createPendingListener = (contextType: string, handler: (context: FDC3.Context) => void): FDC3.Listener => {\n        let unsubscribe = (): void => { pendingSubscription = null; };\n\n        const setActualUnsub = (actualUnsub: () => void): void => { unsubscribe = actualUnsub; };\n\n        // Used inside of setCurrentChannel.\n        pendingSubscription = { contextType, handler, setActualUnsub };\n\n        return {\n            unsubscribe\n        };\n    };\n\n    const init = async (): Promise<void> => {\n        await (window as WindowType).gluePromise;\n\n        const channelContents: Array<Glue42.Channels.ChannelContext> = await getChannelsList();\n\n        channelContents.map((channelContext) => {\n            channels[channelContext.name] = mapToFDC3SystemChannel(channelContext);\n        });\n\n        systemChannels = await (window as WindowType).glue.channels.all();\n\n        const current = await (window as WindowType).glue.channels.current();\n\n        // In Glue42 Core the channel selector widget needs to use the FDC3 Channels API instead of the Glue42 Channels API to navigate between the channels.\n        if (!isGlue42Core) {\n            if (current) {\n                handleSwitchChannelUI(current);\n            }\n\n            (window as WindowType).glue.channels.changed((channelId: string) => {\n                handleSwitchChannelUI(channelId);\n            });\n        }\n    };\n\n    const initDone = init();\n\n    const getSystemChannels = async (): Promise<FDC3.Channel[]> => {\n        await initDone;\n\n        const systemChannelImpls = systemChannels.map((id) => channels[id]);\n\n        return systemChannelImpls;\n    };\n\n    const getOrCreateAppChannel = async (channelId: FDC3.ChannelId): Promise<FDC3.Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            await createNewAppChannel(channelId);\n        }\n\n        return mapToFDC3AppChannel(channelId);\n    };\n\n    const getOrCreateChannel = async (channelId: FDC3.ChannelId): Promise<FDC3.Channel> => {\n        const systemChannels = await getSystemChannels();\n        const channel = systemChannels.find((systemChannel) => systemChannel.id === channelId);\n\n        if (typeof channel === \"undefined\") {\n            return getOrCreateAppChannel(channelId);\n        } else {\n            return channel;\n        }\n    };\n\n    const tryLeaveSystem = async (): Promise<void> => {\n        if (isSystem(currentChannel)) {\n            await (currentChannel as SystemChannel).leave();\n        }\n    };\n\n    const tryGetAppChannel = async (channelId: string): Promise<FDC3.Channel> => {\n        await initDone;\n\n        const exists = await doesAppChannelExist(channelId);\n\n        if (!exists) {\n            throw new Error(FDC3.ChannelError.NoChannelFound);\n        }\n\n        const appChannel = mapToFDC3AppChannel(channelId);\n        channels[channelId] = appChannel;\n\n        return appChannel;\n    };\n\n    const joinChannel = async (channelId: string): Promise<void> => {\n        await initDone;\n\n        const channel: FDC3.Channel = channels[channelId]\n            || await tryGetAppChannel(channelId);\n\n        if (!channel) {\n            throw new Error(FDC3.ChannelError.NoChannelFound);\n        }\n\n        if (isSystem(channel)) {\n            (channel as SystemChannel).join();\n        } else {\n            await tryLeaveSystem();\n        }\n\n        setCurrentChannel(channel);\n    };\n\n    const getCurrentChannel = async (): Promise<FDC3.Channel> => {\n        await initDone;\n\n        return currentChannel as FDC3.Channel;\n    };\n\n    const leaveCurrentChannel = async (): Promise<void> => {\n        await initDone;\n\n        await tryLeaveSystem();\n\n        currentChannel = null;\n    };\n\n    const broadcast = async (context: FDC3.Context): Promise<void> => {\n        await initDone;\n\n        if (!currentChannel) {\n            console.error(\"You must join a channel first.\");\n            return;\n        }\n\n        const { id, type } = currentChannel;\n        (type === \"system\")\n            ? (window as WindowType).glue.channels.publish(context)\n            : (window as WindowType).glue.contexts.update(id, context);\n    };\n\n    function addContextListener(handler: (context: FDC3.Context) => void): FDC3.Listener;\n    function addContextListener(contextType: string, handler: (context: FDC3.Context) => void): FDC3.Listener;\n    function addContextListener(contextTypeInput: any, handlerInput?: any): FDC3.Listener {\n        const contextType = arguments.length === 2 && contextTypeInput;\n        const handler = arguments.length === 2 ? handlerInput : contextTypeInput;\n\n        if (!currentChannel) {\n            console.warn(\"You will start receiving broadcasts only after you join a channel !\");\n            const listener = createPendingListener(contextType, handler);\n\n            // Handle context passed to `fdc3.open()`.\n            (window as WindowType).gluePromise\n                .then(() => {\n                    return (window as WindowType).glue.windows.my().getContext();\n                })\n                .then((startupContext) => {\n                    if (!isEmptyObject(startupContext)) {\n                        handler(startupContext);\n                    }\n                });\n\n            return listener;\n        }\n\n        const { id, type } = currentChannel;\n\n        const subscribe = (subHandler: (data: any) => void): (() => void) | Promise<() => void> => type === \"system\"\n            ? (window as WindowType).glue.channels.subscribe(subHandler)\n            : newSubscribe(id, subHandler);\n\n        const onNewData = (data: any): void => {\n            if (contextType) {\n                if (data.type === contextType) {\n                    handler(data);\n                }\n                return;\n            }\n            handler(data);\n        };\n\n        const unsubFunc = subscribe(onNewData);\n\n        return Listener(unsubFunc);\n    }\n\n    const setCurrentChannel = (newChannel: FDC3.Channel): void => {\n        currentChannel = newChannel;\n\n        if (pendingSubscription) {\n            const { contextType, handler, setActualUnsub } = pendingSubscription;\n\n            const listener = addContextListener(contextType, handler);\n\n            setActualUnsub(listener.unsubscribe);\n\n            pendingSubscription = null;\n        }\n    };\n\n    return {\n        getSystemChannels,\n        getOrCreateChannel,\n        joinChannel,\n        getCurrentChannel,\n        leaveCurrentChannel,\n        broadcast,\n        addContextListener,\n    };\n};\n\nexport default createChannelsAgent;\n","import { FDC3 } from \"../types\";\nimport { Glue42 } from \"@glue42/desktop\";\nimport createChannelsAgent from \"./channels/channels\";\nimport { WindowType } from \"./windowtype\";\n\nconst convertGlue42IntentToFDC3AppIntent = (glueIntent: Glue42.Intents.Intent): FDC3.AppIntent => {\n    const { name, handlers } = glueIntent;\n    const appIntents = handlers.filter((handler) => handler.type === \"app\");\n    const dynamicInstanceIntents = handlers.filter((handler) => handler.type === \"instance\" && !appIntents.some((appIntent) => appIntent.applicationName === handler.applicationName));\n    // Ignore instance handlers that aren't dynamic.\n    const handlersToUse = [...appIntents, ...dynamicInstanceIntents];\n\n    const appIntent: FDC3.AppIntent = {\n        // Issue with the FDC3 specification: there are multiple displayNames.\n        intent: { name, displayName: handlers[0].displayName || \"\" },\n        apps: handlersToUse.map((handler) => {\n            const appName = handler.applicationName;\n            const app = (window as WindowType).glue.appManager.application(appName);\n\n            return {\n                name: appName,\n                title: handler.applicationTitle || handler.instanceTitle || appName,\n                tooltip: app.userProperties.tooltip || `${appName} (${handler.type})`,\n                description: handler.applicationDescription,\n                icons: handler.applicationIcon ? [handler.applicationIcon, ...(app.userProperties.icons || [])] : app.userProperties.icons,\n                images: app.userProperties.images\n            };\n        })\n    };\n\n    return appIntent;\n};\n\nconst createIntentsAgent = (): Partial<FDC3.DesktopAgent> => {\n    const open = async (name: string, context?: FDC3.Context): Promise<void> => {\n        const app = (window as WindowType).glue.appManager.application(name);\n        if (!app) {\n            throw new Error(FDC3.OpenError.AppNotFound);\n        }\n\n        try {\n            await app.start(context);\n        } catch (error) {\n            // `start()` is expected to reject as the started application needs to pass in application name to `GlueWeb()`\n        }\n    };\n\n    const findIntent = async (intent: string, context?: FDC3.Context): Promise<FDC3.AppIntent> => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n\n        const glueIntents = await (window as WindowType).glue.intents.find({ name: intent, contextType: context?.type });\n\n        if (typeof glueIntents !== \"undefined\" && glueIntents.length === 0) {\n            throw new Error(FDC3.ResolveError.NoAppsFound);\n        }\n\n        // We will receive only one intent as they are grouped by name.\n        return convertGlue42IntentToFDC3AppIntent(glueIntents[0]);\n    };\n\n    const findIntentsByContext = async (context: FDC3.Context): Promise<FDC3.AppIntent[]> => {\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n\n        const glueIntents = await (window as WindowType).glue.intents.find({ contextType: context.type });\n\n        if (typeof glueIntents !== \"undefined\" && glueIntents.length === 0) {\n            throw new Error(FDC3.ResolveError.NoAppsFound);\n        }\n\n        return glueIntents.map((glueIntent) => convertGlue42IntentToFDC3AppIntent(glueIntent));\n    };\n\n    const raiseIntent = async (intent: string, context: FDC3.Context, target?: string): Promise<FDC3.IntentResolution> => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof context !== \"undefined\" && typeof context.type !== \"string\") {\n            throw new Error(\"Please provide the context.type as a string!\");\n        }\n        if (typeof target !== \"undefined\" && typeof target !== \"string\") {\n            throw new Error(\"Please provide the target as a string!\");\n        }\n\n        // target not provided => reuse (@glue42/web takes care of starting a new instance if there isn't a running one)\n        // target provided; no running instance => target app\n        // target provided; there is a running instance => target instance\n        let glueTarget: \"startNew\" | \"reuse\" | { app?: string; instance?: string } = \"reuse\";\n        if (typeof target !== \"undefined\") {\n            const app = (window as WindowType).glue.appManager.application(target);\n            if (typeof app === \"undefined\") {\n                throw new Error(`Application ${target} not found.`);\n            }\n            const appInstances = app.instances;\n            if (appInstances.length === 0) {\n                glueTarget = { app: target };\n            } else {\n                // Issue with the FDC3 specification: there is no instance targeting.\n                glueTarget = { instance: appInstances[0].id };\n            }\n        }\n\n        const glueIntentResult = await (window as WindowType).glue.intents.raise({ intent, context, target: glueTarget });\n\n        return {\n            source: glueIntentResult.handler.applicationName,\n            version: \"1.0.0\",\n            data: glueIntentResult.result\n        };\n    };\n\n    const addIntentListener = (intent: string, handler: (context: FDC3.Context) => void): FDC3.Listener => {\n        if (typeof intent !== \"string\") {\n            throw new Error(\"Please provide the intent as a string!\");\n        }\n        if (typeof handler !== \"function\") {\n            throw new Error(\"Please provide the handler as a function!\");\n        }\n        const unsub = {\n            unsubscribe: () => console.error(\"Could not unsubscribe!\")\n        };\n\n        (window as WindowType).gluePromise.then(() => {\n            unsub.unsubscribe = (window as WindowType).glue.intents.addIntentListener(intent, handler as (context: object) => void).unsubscribe;\n        });\n\n        return unsub;\n    };\n\n    return {\n        open: async (...props): Promise<void> => {\n            await (window as WindowType).gluePromise;\n            return open(...props);\n        },\n        findIntent: async (...props): Promise<FDC3.AppIntent> => {\n            await (window as WindowType).gluePromise;\n            return findIntent(...props);\n        },\n        findIntentsByContext: async (...props): Promise<FDC3.AppIntent[]> => {\n            await (window as WindowType).gluePromise;\n            return findIntentsByContext(...props);\n        },\n        raiseIntent: async (...props): Promise<FDC3.IntentResolution> => {\n            await (window as WindowType).gluePromise;\n            return raiseIntent(...props);\n        },\n        addIntentListener\n    };\n};\n\nconst createDesktopAgent = (): FDC3.DesktopAgent => {\n    const intentsAgent = createIntentsAgent();\n    const channelsAgent = createChannelsAgent();\n\n    return {\n        ...intentsAgent,\n        ...channelsAgent\n    } as FDC3.DesktopAgent;\n};\n\nexport default createDesktopAgent;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    var _this = this;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metric, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (system.parent === undefined) {\r\n                        return [2];\r\n                    }\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    metric = {\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        type: \"object\",\r\n                        composite: {\r\n                            Description: {\r\n                                type: \"string\",\r\n                                description: \"\",\r\n                            },\r\n                            Value: {\r\n                                type: \"number\",\r\n                                description: \"\",\r\n                            },\r\n                        },\r\n                        description: \"System state\",\r\n                        context: {},\r\n                    };\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [metric],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateSystem = function (system, state) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var shadowedUpdateMetric, stateObj, rootMetric;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    shadowedUpdateMetric = {\r\n                        type: \"publish\",\r\n                        values: [{\r\n                                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                                value: {\r\n                                    Description: state.description,\r\n                                    Value: state.state,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(shadowedUpdateMetric);\r\n                    stateObj = composeMsgForRootStateMetric(system);\r\n                    rootMetric = {\r\n                        type: \"publish\",\r\n                        peer_id: connection.peerId,\r\n                        values: [{\r\n                                name: \"/State\",\r\n                                value: {\r\n                                    Description: stateObj.description,\r\n                                    Value: stateObj.value,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(rootMetric);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var createMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone, m, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    m = serializeMetric(metricClone);\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [m],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    if (typeof metricClone.value !== \"undefined\") {\r\n                        updateMetricCore(metricClone);\r\n                    }\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    updateMetricCore(metricClone);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            return session.send(publishMetricsMsg);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign$1({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign$1({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends$1(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends$1(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends$1(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends$1(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing\r\n                    .update(value)\r\n                    .catch(function () { });\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar PerfTracker = (function () {\r\n    function PerfTracker(api, initialPublishTimeout, publishInterval) {\r\n        this.api = api;\r\n        this.lastCount = 0;\r\n        this.initialPublishTimeout = 10 * 1000;\r\n        this.publishInterval = 60 * 1000;\r\n        this.initialPublishTimeout = initialPublishTimeout !== null && initialPublishTimeout !== void 0 ? initialPublishTimeout : this.initialPublishTimeout;\r\n        this.publishInterval = publishInterval !== null && publishInterval !== void 0 ? publishInterval : this.publishInterval;\r\n        this.scheduleCollection();\r\n        this.system = this.api.subSystem(\"performance\", \"Performance data published by the web application\");\r\n    }\r\n    PerfTracker.prototype.scheduleCollection = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.collect();\r\n            setInterval(function () {\r\n                _this.collect();\r\n            }, _this.publishInterval);\r\n        }, this.initialPublishTimeout);\r\n    };\r\n    PerfTracker.prototype.collect = function () {\r\n        try {\r\n            this.collectMemory();\r\n            this.collectEntries();\r\n        }\r\n        catch (_a) {\r\n        }\r\n    };\r\n    PerfTracker.prototype.collectMemory = function () {\r\n        var memory = window.performance.memory;\r\n        this.system.stringMetric(\"memory\", JSON.stringify({\r\n            totalJSHeapSize: memory.totalJSHeapSize,\r\n            usedJSHeapSize: memory.usedJSHeapSize\r\n        }));\r\n    };\r\n    PerfTracker.prototype.collectEntries = function () {\r\n        var allEntries = window.performance.getEntries();\r\n        if (allEntries.length <= this.lastCount) {\r\n            return;\r\n        }\r\n        this.lastCount = allEntries.length;\r\n        this.system.stringMetric(\"entries\", JSON.stringify(allEntries));\r\n    };\r\n    return PerfTracker;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    var rootSystem = repo.root;\r\n    if (!options.disableAutoAppSystem) {\r\n        rootSystem = rootSystem.subSystem(\"App\");\r\n    }\r\n    var api = addFAVSupport(rootSystem);\r\n    initPerf(api, options.pagePerformanceMetrics);\r\n    return api;\r\n});\r\nvar perf;\r\nfunction initPerf(api, config) {\r\n    var _a, _b;\r\n    if (typeof window === \"undefined\") {\r\n        return;\r\n    }\r\n    var perfConfig = (_b = (_a = window === null || window === void 0 ? void 0 : window.glue42gd) === null || _a === void 0 ? void 0 : _a.metrics) === null || _b === void 0 ? void 0 : _b.pagePerformanceMetrics;\r\n    if (perfConfig) {\r\n        config = perfConfig;\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.enabled) {\r\n        perf = new PerfTracker(api, config.initialPublishTimeout, config.publishInterval);\r\n    }\r\n}\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib = createRegistry;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar timers = {};\r\nfunction getAllTimers() {\r\n    return timers;\r\n}\r\nfunction timer (timerName) {\r\n    var existing = timers[timerName];\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    var marks = [];\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    mark(\"start\", startTime);\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        mark(\"end\", endTime);\r\n        period = endTime - startTime;\r\n        return period;\r\n    }\r\n    function mark(name, time) {\r\n        var currentTime = time !== null && time !== void 0 ? time : now();\r\n        var diff = 0;\r\n        if (marks.length > 0) {\r\n            diff = currentTime - marks[marks.length - 1].time;\r\n        }\r\n        marks.push({ name: name, time: currentTime, diff: diff });\r\n    }\r\n    var timerObj = {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop,\r\n        mark: mark,\r\n        marks: marks\r\n    };\r\n    timers[timerName] = timerObj;\r\n    return timerObj;\r\n}\n\nvar dummyRequire = function () { return undefined; };\r\nvar requireFunc = Utils.isNode() ? require : dummyRequire;\r\nvar WebSocketConstructor = Utils.isNode() ? requireFunc(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this.startupTimer = timer(\"connection\");\r\n        this._running = true;\r\n        this._registry = lib();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.startupTimer.mark(\"opening-socket\");\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.startupTimer.mark(\"socket-initiated\");\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.startupTimer.mark(\"ws-opened\");\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1 = {\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte() {\n    if (!crypto || !crypto.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser = randomByte;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid = isShortId;\n\nvar lib$1 = createCommonjsModule(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1.lookup, version);\n    str = str + encode_1(alphabet_1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid;\n});\nvar lib_1 = lib$1.generate;\nvar lib_2 = lib$1.seed;\nvar lib_3 = lib$1.worker;\nvar lib_4 = lib$1.characters;\nvar lib_5 = lib$1.decode;\nvar lib_6 = lib$1.isValid;\n\nvar shortid = lib$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected, 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        timer(\"connection\").mark(\"transport-opened\");\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        timer(\"connection\").mark(\"protocol-logged-in\");\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        try {\r\n                            _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                        }\r\n                        catch (loggerError) {\r\n                            console.log(\"Message handler failed\", error);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            var interop = Logger.Interop;\r\n            if (interop) {\r\n                try {\r\n                    if (interop.methods({ name: Logger.InteropMethodName }).length > 0) {\r\n                        interop.invoke(Logger.InteropMethodName, {\r\n                            msg: \"\" + message,\r\n                            logger: loggerName,\r\n                            level: level\r\n                        });\r\n                    }\r\n                }\r\n                catch (_a) {\r\n                }\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version = \"5.2.3\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_e) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"warn\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        var gdConsoleLevel;\r\n        if (glue42gd) {\r\n            gdConsoleLevel = glue42gd.consoleLogLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    return {\r\n        bus: (_a = configuration.bus) !== null && _a !== void 0 ? _a : false,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_b = configuration.metrics) !== null && _b !== void 0 ? _b : true,\r\n        contexts: (_c = configuration.contexts) !== null && _c !== void 0 ? _c : true,\r\n        version: ext.version || version,\r\n        libs: (_d = ext.libs) !== null && _d !== void 0 ? _d : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta, logger) {\r\n    try {\r\n        if (logger === null || logger === void 0 ? void 0 : logger.canPublish(\"trace\")) {\r\n            logger === null || logger === void 0 ? void 0 : logger.trace(\"applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context));\r\n        }\r\n        if (!delta) {\r\n            return context;\r\n        }\r\n        if (delta.reset) {\r\n            context = __assign$1({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        if (delta.commands) {\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    deletePath(context, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(context, command.value, command.path);\r\n                }\r\n            }\r\n            return context;\r\n        }\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n        return context;\r\n    }\r\n    catch (e) {\r\n        logger === null || logger === void 0 ? void 0 : logger.error(\"error applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context), e);\r\n        return context;\r\n    }\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction setValueToPath(obj, value, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        if (typeof obj[pathArr[i]] !== \"object\") {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    obj[pathArr[i]] = value;\r\n}\r\nfunction deletePath(obj, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            return;\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    delete obj[pathArr[i]];\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._protocolVersion = undefined;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(GW3Bridge.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._protocolVersion) {\r\n                var contextsDomainInfo = this._connection.availableDomains.find(function (d) { return d.uri === \"context\"; });\r\n                this._protocolVersion = (_a = contextsDomainInfo === null || contextsDomainInfo === void 0 ? void 0 : contextsDomainInfo.version) !== null && _a !== void 0 ? _a : 1;\r\n            }\r\n            return this._protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(GW3Bridge.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this.protocolVersion >= 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            _this._contextIdToName[createContextMsg.context_id] = name;\r\n            var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n            contextData.isAnnounced = true;\r\n            contextData.name = name;\r\n            contextData.contextId = createContextMsg.context_id;\r\n            contextData.context = data;\r\n            _this._contextNameToData[name] = contextData;\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name)];\r\n                    case 1:\r\n                        currentContext = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.protocolVersion === 2 ?\r\n                            this.calculateContextDeltaV2(currentContext, delta) :\r\n                            this.calculateContextDeltaV1(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length\r\n                            && !((_a = calculatedDelta.commands) === null || _a === void 0 ? void 0 : _a.length)) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.setPath = function (name, path, value) {\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPath operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        return this.setPaths(name, [{ path: path, value: value }]);\r\n    };\r\n    GW3Bridge.prototype.setPaths = function (name, pathValues) {\r\n        var _this = this;\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            var obj = {};\r\n            for (var _i = 0, pathValues_1 = pathValues; _i < pathValues_1.length; _i++) {\r\n                var pathValue = pathValues_1[_i];\r\n                setValueToPath(obj, pathValue.value, pathValue.path);\r\n            }\r\n            return this.createContext(name, obj);\r\n        }\r\n        var commands = [];\r\n        for (var _a = 0, pathValues_2 = pathValues; _a < pathValues_2.length; _a++) {\r\n            var pathValue = pathValues_2[_a];\r\n            if (pathValue.value === null) {\r\n                commands.push({ type: \"remove\", path: pathValue.path });\r\n            }\r\n            else {\r\n                commands.push({ type: \"set\", path: pathValue.path, value: pathValue.value });\r\n            }\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { commands: commands }\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { added: {}, removed: [], updated: {}, commands: commands }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var _a;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return Promise.resolve({});\r\n        }\r\n        if (contextData && !contextData.hasCallbacks()) {\r\n            return new Promise(function (resolve, _) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator$1(this, function (_a) {\r\n                    this.subscribe(name, function (data, _d, _r, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        var context = (_a = contextData === null || contextData === void 0 ? void 0 : contextData.context) !== null && _a !== void 0 ? _a : {};\r\n        return Promise.resolve(context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context &&\r\n                    contextData.sentExplicitSubscription) {\r\n                    callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.destroy = function (name) {\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData) {\r\n            return Promise.reject(\"context with \" + name + \" does not exist\");\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_DESTROY_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta, this._logger);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta, this._logger);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, data, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        if (delta.commands) {\r\n            delta.added = delta.updated = delta.reset = {};\r\n            delta.removed = [];\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    if (command.path.indexOf(\".\") === -1) {\r\n                        delta.removed.push(command.path);\r\n                    }\r\n                    setValueToPath(delta.updated, null, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(delta.updated, command.value, command.path);\r\n                }\r\n            }\r\n        }\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(data), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV1 = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV2 = function (from, to) {\r\n        var _a, _b;\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined, commands: [] };\r\n        for (var _i = 0, _c = Object.keys(to); _i < _c.length; _i++) {\r\n            var x = _c[_i];\r\n            if (to[x] !== null) {\r\n                var fromX = from ? from[x] : null;\r\n                if (!deepEqual(fromX, to[x])) {\r\n                    (_a = delta.commands) === null || _a === void 0 ? void 0 : _a.push({ type: \"set\", path: x, value: to[x] });\r\n                }\r\n            }\r\n            else {\r\n                (_b = delta.commands) === null || _b === void 0 ? void 0 : _b.push({ type: \"remove\", path: x });\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.update(name, data);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.setPath = function (name, path, data) {\r\n        this.checkName(name);\r\n        this.checkPath(path);\r\n        var isTopLevelPath = path === \"\";\r\n        if (isTopLevelPath) {\r\n            this.checkData(data);\r\n            return this.set(name, data);\r\n        }\r\n        return this._bridge.setPath(name, path, data);\r\n    };\r\n    ContextsModule.prototype.setPaths = function (name, paths) {\r\n        this.checkName(name);\r\n        if (!Array.isArray(paths)) {\r\n            throw new Error(\"Please provide the paths as an array of PathValues!\");\r\n        }\r\n        for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\r\n            var _a = paths_1[_i], path = _a.path, value = _a.value;\r\n            this.checkPath(path);\r\n            var isTopLevelPath = path === \"\";\r\n            if (isTopLevelPath) {\r\n                this.checkData(value);\r\n            }\r\n        }\r\n        return this._bridge.setPaths(name, paths);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.destroy = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.destroy(name);\r\n    };\r\n    Object.defineProperty(ContextsModule.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this._bridge.setPathSupported;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" || name === \"\") {\r\n            throw new Error(\"Please provide the name as a non-empty string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkPath = function (path) {\r\n        if (typeof path !== \"string\") {\r\n            throw new Error(\"Please provide the path as a dot delimited string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkData = function (data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Please provide the data as an object!\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, promise, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    var timeout;\r\n    promise.finally(function () {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n    });\r\n    return new Promise(function (resolve, reject) {\r\n        timeout = setTimeout(function () { return reject(error); }, ms);\r\n    });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign$1({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign$1({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator$1(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign$1({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign$1(__assign$1({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid();\r\n                                    var method = serversMethodPair.methods[0];\r\n                                    var server = serversMethodPair.server;\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, method, argumentObj, server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, invokePromise, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached for method name: \" + (method === null || method === void 0 ? void 0 : method.name) + \", target instance: \" + JSON.stringify(server.instance) + \", options: \" + JSON.stringify(additionalOptionsCopy),\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign$1({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign$1({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer(\"glue\");\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            inner.marks = t.marks;\r\n            if (_allowTrace) {\r\n                _logger.trace(name + \" is ready - \" + (t.endTime - t.startTime));\r\n            }\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer(\"connection\");\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                authPromise = glue42gd.getGWToken()\r\n                    .then(function (token) {\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            initTimer.mark(\"auth-promise-resolved\");\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer(\"logger\");\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        if (_logger.canPublish(\"debug\")) {\r\n            _logger.debug(\"initializing glue...\");\r\n        }\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c, _d;\r\n        var initTimer = timer(\"metrics\");\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var disableAutoAppSystem = (_a = (typeof config !== \"boolean\" && config.disableAutoAppSystem)) !== null && _a !== void 0 ? _a : false;\r\n        _metrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_b = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _b !== void 0 ? _b : \"metrics-service\",\r\n            instance: (_d = (_c = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _c !== void 0 ? _c : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _d !== void 0 ? _d : shortid(),\r\n            disableAutoAppSystem: disableAutoAppSystem,\r\n            pagePerformanceMetrics: typeof config !== \"boolean\" ? config === null || config === void 0 ? void 0 : config.pagePerformanceMetrics : undefined\r\n        });\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer(\"interop\");\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer(\"contexts\");\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator$1(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer(\"bus\");\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer(name);\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var all = getAllTimers();\r\n                return Object.keys(all).map(function (key) {\r\n                    var t = all[key];\r\n                    return {\r\n                        name: key,\r\n                        duration: t.endTime - t.startTime,\r\n                        marks: t.marks\r\n                    };\r\n                });\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        if (glue.agm) {\r\n            var deprecatedDecorator = function (fn, wrong, proper) {\r\n                return function () {\r\n                    glue.logger.warn(\"glue.js - 'glue.agm.\" + wrong + \"' method is deprecated, use 'glue.interop.\" + proper + \"' instead.\");\r\n                    fn.apply(glue.agm, arguments);\r\n                };\r\n            };\r\n            var agmAny = glue.agm;\r\n            agmAny.method_added = deprecatedDecorator(glue.agm.methodAdded, \"method_added\", \"methodAdded\");\r\n            agmAny.method_removed = deprecatedDecorator(glue.agm.methodRemoved, \"method_removed\", \"methodRemoved\");\r\n            agmAny.server_added = deprecatedDecorator(glue.agm.serverAdded, \"server_added\", \"serverAdded\");\r\n            agmAny.server_method_aded = deprecatedDecorator(glue.agm.serverMethodAdded, \"server_method_aded\", \"serverMethodAdded\");\r\n            agmAny.server_method_removed = deprecatedDecorator(glue.agm.serverMethodRemoved, \"server_method_removed\", \"serverMethodRemoved\");\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version;\r\nGlueCore.default = GlueCore;\n\nvar ActivityEntity = (function () {\r\n    function ActivityEntity(id) {\r\n        this._id = id;\r\n    }\r\n    Object.defineProperty(ActivityEntity.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityEntity.prototype._update = function (other) {\r\n        if (other._id !== this._id) {\r\n            throw Error(\"Can not update from entity with different id.\");\r\n        }\r\n        this._updateCore(other);\r\n    };\r\n    ActivityEntity.prototype._updateCore = function (other) {\r\n        return;\r\n    };\r\n    ActivityEntity.prototype._beforeDelete = function (other) {\r\n        return;\r\n    };\r\n    return ActivityEntity;\r\n}());\n\nfunction isString(arg) {\r\n    return typeof arg === \"string\";\r\n}\r\nfunction isObject(arg) {\r\n    return typeof arg === \"object\" && arg !== null;\r\n}\r\nfunction isArray(arg) {\r\n    if (Array.isArray) {\r\n        return Array.isArray(arg);\r\n    }\r\n    return toString.call(arg) === \"[object Array]\";\r\n}\r\nfunction isUndefined(arg) {\r\n    return typeof arg === \"undefined\";\r\n}\r\nfunction isUndefinedOrNull(arg) {\r\n    return !arg || typeof arg === \"undefined\";\r\n}\r\nfunction isFunction(arg) {\r\n    return !!(arg && arg.constructor && arg.call && arg.apply);\r\n}\r\nfunction some(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction ifNotUndefined(what, doWithIt) {\r\n    if (typeof what !== \"undefined\") {\r\n        doWithIt(what);\r\n    }\r\n}\r\nfunction promisify$1(promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { return; };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { return; };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\n\nvar ActivityType = (function (_super) {\r\n    __extends(ActivityType, _super);\r\n    function ActivityType(name, ownerWindow, helperWindows, description) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._description = description;\r\n        _this._ownerWindow = ownerWindow;\r\n        _this._helperWindows = helperWindows || [];\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ActivityType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"description\", {\r\n        get: function () {\r\n            return this._description;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"helperWindows\", {\r\n        get: function () {\r\n            return this._helperWindows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"ownerWindow\", {\r\n        get: function () {\r\n            return this._ownerWindow;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityType.prototype.initiate = function (context, callback, configuration) {\r\n        return this._manager.initiate(this._name, context, callback, configuration);\r\n    };\r\n    ActivityType.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._description, function (x) { return _this._description = x; });\r\n        ifNotUndefined(other._ownerWindow, function (x) { return _this._ownerWindow = x; });\r\n        ifNotUndefined(other._helperWindows, function (x) { return _this._helperWindows = x; });\r\n    };\r\n    return ActivityType;\r\n}(ActivityEntity));\n\nvar WindowType = (function (_super) {\r\n    __extends(WindowType, _super);\r\n    function WindowType(name, appByWindowTypeGetter) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._appByWindowTypeGetter = appByWindowTypeGetter;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(WindowType.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"config\", {\r\n        get: function () {\r\n            return this._appByWindowTypeGetter(this._name);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ type: this._name });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowType.prototype.create = function (activity, configuration) {\r\n        var definition = Object.assign({ type: this.name, name: this.name, isIndependent: false }, configuration);\r\n        return this._manager.createWindow(activity, definition);\r\n    };\r\n    return WindowType;\r\n}(ActivityEntity));\n\nvar EntityEvent = (function () {\r\n    function EntityEvent(entitiy, context) {\r\n        this.entity = entitiy;\r\n        this.context = context;\r\n    }\r\n    return EntityEvent;\r\n}());\r\nvar EntityEventContext = (function () {\r\n    function EntityEventContext(eventType) {\r\n        this.type = eventType;\r\n    }\r\n    return EntityEventContext;\r\n}());\r\nvar ActivityStatusChangeEventContext = (function (_super) {\r\n    __extends(ActivityStatusChangeEventContext, _super);\r\n    function ActivityStatusChangeEventContext(newStatus, oldStatus) {\r\n        var _this = _super.call(this, EntityEventType.StatusChange) || this;\r\n        _this.newStatus = newStatus;\r\n        _this.oldStatus = oldStatus;\r\n        return _this;\r\n    }\r\n    return ActivityStatusChangeEventContext;\r\n}(EntityEventContext));\r\nvar ActivityContextChangedEventContext = (function (_super) {\r\n    __extends(ActivityContextChangedEventContext, _super);\r\n    function ActivityContextChangedEventContext(context, updated, removed) {\r\n        var _this = _super.call(this, EntityEventType.ActivityContextChange) || this;\r\n        _this.context = typeof context === \"string\" ? JSON.parse(context) : context;\r\n        _this.updated = updated;\r\n        _this.removed = removed;\r\n        return _this;\r\n    }\r\n    return ActivityContextChangedEventContext;\r\n}(EntityEventContext));\r\nvar EntityEventType = (function () {\r\n    function EntityEventType() {\r\n    }\r\n    EntityEventType.Added = \"added\";\r\n    EntityEventType.Removed = \"removed\";\r\n    EntityEventType.Updated = \"updated\";\r\n    EntityEventType.Closed = \"closed\";\r\n    EntityEventType.StatusChange = \"statusChange\";\r\n    EntityEventType.ActivityContextChange = \"activityContextUpdate\";\r\n    EntityEventType.ActivityWindowEvent = \"activityWindowEvent\";\r\n    EntityEventType.ActivityWindowJoinedActivity = \"joined\";\r\n    EntityEventType.ActivityWindowLeftActivity = \"left\";\r\n    return EntityEventType;\r\n}());\r\nvar ActivityState = (function () {\r\n    function ActivityState() {\r\n    }\r\n    ActivityState.Created = \"created\";\r\n    ActivityState.Started = \"started\";\r\n    ActivityState.Destroyed = \"destroyed\";\r\n    return ActivityState;\r\n}());\n\nvar ActivityAGM = (function () {\r\n    function ActivityAGM(activity) {\r\n        this._activity = activity;\r\n    }\r\n    ActivityAGM.prototype.register = function (definition, handler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.register(definition, handler);\r\n    };\r\n    ActivityAGM.prototype.servers = function () {\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        return this._activity.windows.map(function (w) {\r\n            return w.instance;\r\n        });\r\n    };\r\n    ActivityAGM.prototype.methods = function () {\r\n        var _this = this;\r\n        this._ensureHasAgm();\r\n        if (isUndefinedOrNull(this._activity)) {\r\n            return [];\r\n        }\r\n        var windows = this._activity.windows;\r\n        var methodNames = [];\r\n        var methods = [];\r\n        windows.forEach(function (window) {\r\n            var windowMethods = _this.methodsForWindow(window);\r\n            windowMethods.forEach(function (currentWindowMethod) {\r\n                if (methodNames.indexOf(currentWindowMethod.name) === -1) {\r\n                    methodNames.push(currentWindowMethod.name);\r\n                    methods.push(currentWindowMethod);\r\n                }\r\n            });\r\n        });\r\n        return methods;\r\n    };\r\n    ActivityAGM.prototype.methodsForWindow = function (window) {\r\n        this._ensureHasAgm();\r\n        if (!window.instance) {\r\n            return [];\r\n        }\r\n        return ActivityAGM.AGM.methodsForInstance(window.instance);\r\n    };\r\n    ActivityAGM.prototype.invoke = function (methodName, arg, target, options, success, error) {\r\n        this._ensureHasAgm();\r\n        var activityServers = this.servers();\r\n        var serversToInvokeAgainst = [];\r\n        if (isUndefinedOrNull(target)) {\r\n            target = \"activity.all\";\r\n        }\r\n        if (isString(target)) {\r\n            if (target === \"activity.all\") {\r\n                serversToInvokeAgainst = activityServers;\r\n            }\r\n            else if (target === \"activity.best\") {\r\n                var potentialTargets = activityServers.filter(function (server) {\r\n                    var methods = ActivityAGM.AGM.methodsForInstance(server);\r\n                    return methods.filter(function (m) {\r\n                        return m.name === methodName;\r\n                    }).length > 0;\r\n                });\r\n                if (potentialTargets.length > 0) {\r\n                    serversToInvokeAgainst = [potentialTargets[0]];\r\n                }\r\n            }\r\n            else if (target === \"all\" || target === \"best\") {\r\n                return promisify$1(ActivityAGM.AGM.invoke(methodName, arg, target, options), success, error);\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid invoke target \" + target);\r\n            }\r\n        }\r\n        else if (isArray(target)) {\r\n            if (target.length >= 0) {\r\n                var firstElem = target[0];\r\n                if (this._isInstance(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (instance) { return instance; });\r\n                }\r\n                else if (this._isActivityWindow(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (win) { return win.instance; });\r\n                }\r\n                else {\r\n                    throw new Error(\"Unknown target object\");\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isInstance(target)) {\r\n                serversToInvokeAgainst = [target];\r\n            }\r\n            else if (this._isActivityWindow(target)) {\r\n                serversToInvokeAgainst = [target.instance];\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown target object\");\r\n            }\r\n        }\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    ActivityAGM.prototype.unregister = function (definition) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.unregister(definition);\r\n    };\r\n    ActivityAGM.prototype.createStream = function (methodDefinition, subscriptionAddedHandler, subscriptionRemovedHandler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.createStream(methodDefinition, {\r\n            subscriptionAddedHandler: subscriptionAddedHandler,\r\n            subscriptionRemovedHandler: subscriptionRemovedHandler,\r\n            subscriptionRequestHandler: undefined\r\n        });\r\n    };\r\n    ActivityAGM.prototype.subscribe = function (methodDefinition, parameters, target) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.subscribe(methodDefinition, parameters);\r\n    };\r\n    ActivityAGM.prototype._ensureHasAgm = function () {\r\n        if (isUndefinedOrNull(ActivityAGM.AGM)) {\r\n            throw new Error(\"Agm should be configured to be used in activity\");\r\n        }\r\n    };\r\n    ActivityAGM.prototype._isInstance = function (obj) {\r\n        return obj.application !== undefined;\r\n    };\r\n    ActivityAGM.prototype._isActivityWindow = function (obj) {\r\n        return obj.instance !== undefined;\r\n    };\r\n    return ActivityAGM;\r\n}());\n\nvar AttachedActivityDescriptor = (function () {\r\n    function AttachedActivityDescriptor(manager, ownerActivityId, state) {\r\n        this._manager = manager;\r\n        this._ownerActivityId = ownerActivityId;\r\n        this._state = state;\r\n    }\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"ownerId\", {\r\n        get: function () {\r\n            return this._state.ownerId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"windowIds\", {\r\n        get: function () {\r\n            return this._state.windowIds;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"frameColor\", {\r\n        get: function () {\r\n            return this._state.frameColor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"context\", {\r\n        get: function () {\r\n            return this._state.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"tag\", {\r\n        get: function () {\r\n            return this._state.tag;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AttachedActivityDescriptor.prototype.detach = function (descriptor) {\r\n        var _this = this;\r\n        descriptor = descriptor || {};\r\n        var merged = {};\r\n        Object.keys(this._state).forEach(function (prop) {\r\n            merged[prop] = _this._state[prop];\r\n        });\r\n        merged.context = descriptor.context || merged.context;\r\n        merged.frameColor = descriptor.frameColor || merged.frameColor;\r\n        return this._manager.detachActivities(this._ownerActivityId, merged);\r\n    };\r\n    return AttachedActivityDescriptor;\r\n}());\n\nvar nextTick = function (cb) {\r\n    setTimeout(cb, 0);\r\n};\r\nfunction nodeify(promise, callback) {\r\n    if (!isFunction(callback)) {\r\n        return promise;\r\n    }\r\n    promise.then(function (resp) {\r\n        nextTick(function () {\r\n            callback(null, resp);\r\n        });\r\n    }, function (err) {\r\n        nextTick(function () {\r\n            callback(err, null);\r\n        });\r\n    });\r\n}\n\nvar Activity = (function (_super) {\r\n    __extends(Activity, _super);\r\n    function Activity(id, actType, status, context, ownerId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._id = id;\r\n        _this._actType = actType;\r\n        _this._status = status;\r\n        _this._context = context;\r\n        _this._ownerId = ownerId;\r\n        _this._agm = new ActivityAGM(_this);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Activity.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getActivityType(this._actType);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"context\", {\r\n        get: function () {\r\n            return this._context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"status\", {\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"owner\", {\r\n        get: function () {\r\n            if (!this._ownerId) {\r\n                return null;\r\n            }\r\n            return this._manager.getWindows({ id: this._ownerId })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"windows\", {\r\n        get: function () {\r\n            return this._manager.getWindows({ activityId: this._id });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.addWindow = function (window, callback) {\r\n        return this._manager.addWindowToActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.createWindow = function (windowType, callback) {\r\n        return this._manager.createWindow(this, windowType, callback);\r\n    };\r\n    Activity.prototype.createStackedWindows = function (windowTypes, timeout, callback) {\r\n        return this._manager.createStackedWindows(this, windowTypes, timeout, callback);\r\n    };\r\n    Activity.prototype.leave = function (window, callback) {\r\n        return this._manager.leaveWindowFromActivity(this, window, callback);\r\n    };\r\n    Activity.prototype.getWindowsByType = function (windowType) {\r\n        var filter = { activityId: this._id, type: windowType };\r\n        return this._manager.getWindows(filter);\r\n    };\r\n    Activity.prototype.setContext = function (context, callback) {\r\n        return this._manager.setActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.updateContext = function (context, callback) {\r\n        return this._manager.updateActivityContext(this, context, callback);\r\n    };\r\n    Activity.prototype.onStatusChange = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeActivityEvents(function (a, ns, os) {\r\n            if (a.id === _this.id) {\r\n                handler(a, ns, os);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onWindowEvent = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeWindowEvents(function (a, w, e) {\r\n            if (a.id === _this.id) {\r\n                handler(a, w, e);\r\n            }\r\n        });\r\n    };\r\n    Activity.prototype.onContextChanged = function (handler) {\r\n        var _this = this;\r\n        this._manager.subscribeActivityContextChanged(function (act, context, updated, removed) {\r\n            if (act.id === _this.id) {\r\n                handler(context, updated, removed, act);\r\n            }\r\n        });\r\n        try {\r\n            handler(this.context, this.context, [], this);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n    };\r\n    Activity.prototype.stop = function () {\r\n        this._manager.stopActivity(this);\r\n    };\r\n    Activity.prototype.clone = function (options) {\r\n        return this._manager.clone(this, options);\r\n    };\r\n    Activity.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._manager.attachActivities(activityId, this.id, tag);\r\n    };\r\n    Activity.prototype.onActivityAttached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesAttached(function (newActId, oldActId, descriptor) {\r\n            if (newActId !== _this._id) {\r\n                return;\r\n            }\r\n            callback(descriptor);\r\n        });\r\n    };\r\n    Activity.prototype.onDetached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesDetached(function (newAct, originalActivity, state) {\r\n            if (originalActivity.id !== _this._id) {\r\n                return;\r\n            }\r\n            callback(newAct, state);\r\n        });\r\n    };\r\n    Activity.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        ifNotUndefined(other._actType, function (x) { return _this._actType = x; });\r\n        ifNotUndefined(other._context, function (x) { return _this._context = x; });\r\n        ifNotUndefined(other._ownerId, function (x) { return _this._ownerId = x; });\r\n        if (other._status && (!this._status || (this._status.state !== other._status.state))) {\r\n            this._status = other._status;\r\n        }\r\n    };\r\n    Activity.prototype._updateDescriptors = function (allStates) {\r\n        var _this = this;\r\n        this._attached = allStates.map(function (s) {\r\n            return new AttachedActivityDescriptor(_this._manager, _this._id, s);\r\n        });\r\n    };\r\n    Object.defineProperty(Activity.prototype, \"attached\", {\r\n        get: function () {\r\n            return this._attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.setFrameColor = function (color, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var callbacksToWait = _this.windows.length;\r\n            if (callbacksToWait === 0) {\r\n                resolve(_this);\r\n            }\r\n            _this.windows.forEach(function (w) {\r\n                w.underlyingWindow.setFrameColor(color, function () {\r\n                    callbacksToWait--;\r\n                    if (callbacksToWait <= 0) {\r\n                        resolve(_this);\r\n                    }\r\n                });\r\n            });\r\n            setTimeout(function () {\r\n                if (callbacksToWait > 0) {\r\n                    reject(_this.id + \" - timed out waiting for setFrameColor with\" + color);\r\n                }\r\n            }, 5000);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Activity.prototype.getFrameColor = function () {\r\n        if (!this.windows || this.windows.length === 0) {\r\n            return \"\";\r\n        }\r\n        return this.windows[0].underlyingWindow.frameColor;\r\n    };\r\n    return Activity;\r\n}(ActivityEntity));\n\nvar LogLevel = (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.Trace = \"trace\";\r\n    LogLevel.Debug = \"debug\";\r\n    LogLevel.Info = \"info\";\r\n    LogLevel.Warn = \"warn\";\r\n    LogLevel.Error = \"error\";\r\n    return LogLevel;\r\n}());\r\nvar Logger$1 = (function () {\r\n    function Logger(name) {\r\n        this._name = name;\r\n        if (!isUndefinedOrNull(Logger.GlueLogger)) {\r\n            this._glueLogger = Logger.GlueLogger.subLogger(name);\r\n        }\r\n    }\r\n    Logger.GetNamed = function (name) {\r\n        return new Logger(name);\r\n    };\r\n    Logger.Get = function (owner) {\r\n        return new Logger(Logger.GetTypeName(owner));\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.trace(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Trace));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.debug(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Debug));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.info(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.warn(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info ||\r\n                Logger.Level === LogLevel.Warn) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.error = function (message) {\r\n        if (!isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.error(message);\r\n        }\r\n        else {\r\n            console.error(this._getMessage(message, LogLevel.Error));\r\n            console.trace();\r\n        }\r\n    };\r\n    Logger.prototype._getMessage = function (message, level) {\r\n        return \"[\" + level + \"] \" + this._name + \" - \" + message;\r\n    };\r\n    Logger.GetTypeName = function (object) {\r\n        var funcNameRegex = /function (.{1,})\\(/;\r\n        var results = (funcNameRegex).exec(object.constructor.toString());\r\n        return (results && results.length > 1) ? results[1] : \"\";\r\n    };\r\n    Logger.Level = LogLevel.Info;\r\n    return Logger;\r\n}());\n\nvar ActivityWindow = (function (_super) {\r\n    __extends(ActivityWindow, _super);\r\n    function ActivityWindow(id, name, type, activityId, instance, isIndependent, windowGetter, hcWindowId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._logger = Logger$1.Get(\"window\");\r\n        _this._type = type;\r\n        _this._activityId = activityId;\r\n        _this._name = name;\r\n        _this._instance = instance;\r\n        _this._isIndependent = isIndependent;\r\n        _this._windowGetter = windowGetter;\r\n        _this._hcWindowId = hcWindowId;\r\n        return _this;\r\n    }\r\n    ActivityWindow.prototype.getBounds = function () {\r\n        return this._manager.getWindowBounds(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isIndependent\", {\r\n        get: function () {\r\n            return this._isIndependent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"type\", {\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getWindowType(this._type);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"activity\", {\r\n        get: function () {\r\n            if (isUndefined(this._activityId)) {\r\n                return undefined;\r\n            }\r\n            return this._manager.getActivityById(this._activityId);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isOwner\", {\r\n        get: function () {\r\n            var act = this.activity;\r\n            if (isUndefined(act)) {\r\n                return false;\r\n            }\r\n            return act.owner.id === this.id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.setVisible = function (isVisible, callback) {\r\n        return this._manager.setWindowVisibility(this.id, isVisible);\r\n    };\r\n    ActivityWindow.prototype.activate = function (focus) {\r\n        return this._manager.activateWindow(this.id, focus);\r\n    };\r\n    ActivityWindow.prototype.setBounds = function (bounds, callback) {\r\n        return this._manager.setWindowBounds(this.id, bounds, callback);\r\n    };\r\n    ActivityWindow.prototype.close = function () {\r\n        return this._manager.closeWindow(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"instance\", {\r\n        get: function () {\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"underlyingWindow\", {\r\n        get: function () {\r\n            var window = this._windowGetter();\r\n            if (!window) {\r\n                return {\r\n                    id: this._hcWindowId\r\n                };\r\n            }\r\n            return window;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.onActivityJoined = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowJoinedActivity, callback);\r\n    };\r\n    ActivityWindow.prototype.onActivityRemoved = function (callback) {\r\n        this._subscribeForActivityWindowEvent(EntityEventType.ActivityWindowLeftActivity, callback);\r\n    };\r\n    ActivityWindow.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        ifNotUndefined(other._activityId, function (x) { return _this._activityId = x; });\r\n        ifNotUndefined(other._isIndependent, function (x) { return _this._isIndependent = x; });\r\n        ifNotUndefined(other._hcWindowId, function (x) { return _this._hcWindowId = x; });\r\n        ifNotUndefined(other._type, function (x) { return _this._type = x; });\r\n        ifNotUndefined(other._name, function (x) { return _this._name = x; });\r\n        if (!isUndefinedOrNull(other._instance)) {\r\n            this._instance = other._instance;\r\n        }\r\n    };\r\n    ActivityWindow.prototype._subscribeForActivityWindowEvent = function (eventName, callback) {\r\n        var _this = this;\r\n        this._manager.subscribeWindowEvents(function (activity, window, event) {\r\n            if (window.id !== _this.id) {\r\n                return;\r\n            }\r\n            if (event === eventName) {\r\n                callback(activity);\r\n            }\r\n        });\r\n    };\r\n    ActivityWindow.prototype._beforeDelete = function (other) {\r\n        this._hcWindowId = other._hcWindowId;\r\n    };\r\n    return ActivityWindow;\r\n}(ActivityEntity));\n\nvar ActivityStatus = (function () {\r\n    function ActivityStatus(state, message, time) {\r\n        this.state = state;\r\n        this.message = message;\r\n        this.time = time;\r\n    }\r\n    ActivityStatus.prototype.getState = function () {\r\n        return this.state;\r\n    };\r\n    ActivityStatus.prototype.getMessage = function () {\r\n        return this.message;\r\n    };\r\n    ActivityStatus.prototype.getTime = function () {\r\n        return this.time;\r\n    };\r\n    return ActivityStatus;\r\n}());\n\nvar gwMmessageError = \"error\";\r\nvar gwMessageAddActivityTypes = \"add-types\";\r\nvar gwMmessageActivityTypesAdded = \"types-added\";\r\nvar gwMessageRemoveActivityTypes = \"remove-types\";\r\nvar gwMessageActivityTypesRemoved = \"types-removed\";\r\nvar gwMessageActivityCreated = \"created\";\r\nvar gwMessageActivityDestroyed = \"destroyed\";\r\nvar gwMessageActivityInitiated = \"initiated\";\r\nvar gwMmessageJoinActivity = \"join-activity\";\r\nvar gwMessageJoinedActivity = \"joined\";\r\nvar gwMessageActivityJoined = \"activity-joined\";\r\nvar gwMessageLeaveActivity = \"leave-activity\";\r\nvar gwMessageActivityLeft = \"left\";\r\nvar gwNmessageMergeActivities = \"merge\";\r\nvar gwMessageSplitActivities = \"split\";\r\nvar gwMessageOwnerChanged = \"owner-changed\";\r\nvar gwMessageAddPeerFactories = \"add-peer-factories\";\r\nvar gwMessagePeerFactoriesAdded = \"peer-factories-added\";\r\nvar gwMessageRemovePeerFactories = \"remove-peer-factories\";\r\nvar gwMessagePeerFactoriesRemoved = \"peer-factories-removed\";\r\nvar gwMessageCreateActivity = \"create\";\r\nvar gwMessageCreatePeer = \"create-peer\";\r\nvar gwMessagePeerRequested = \"peer-requested\";\r\nvar gwMessageReady = \"ready\";\r\nvar gwMessagePeerCreated = \"peer-created\";\r\nvar gwMessageDestroyActivity = \"destroy\";\r\nvar gwMessageDisposePeer = \"dispose-peer\";\r\nvar gwMessageDestroyPeer = \"destroy-peer\";\r\nvar GW3Bridge$1 = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        this._activityChangeCallbacks = [];\r\n        this._activityTypeStatusChangeCallbacks = [];\r\n        this._activityWindowChangeCallbacks = [];\r\n        this._windowTypeStatusChangeCallbacks = [];\r\n        this._peerIdAndFactoryIdToPeerType = {};\r\n        this._peerFactoriesRegisteredByUs = {};\r\n        this._gw3Subscriptions = [];\r\n        this._contextSubscriptions = {};\r\n        this._activityTypesInitiatedFromMe = {};\r\n        this._config = config;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._contexts = config.contexts;\r\n        this._windows = config.windows;\r\n        this._sessionJoinedPromise = new Promise(function (resolve) {\r\n            _this._sessionJoinedPromiseResolve = resolve;\r\n        });\r\n        this._activityJoinedPromise = new Promise(function (resolve) {\r\n            _this._activityJoinedPromiseResolve = resolve;\r\n        });\r\n        if (!this._config.activityId) {\r\n            this._activityJoinedPromiseResolve({});\r\n        }\r\n        this._gw3Session = this._connection.domain(\"activity\", [\"joined\", \"initiated\", \"peer-created\", \"token\"]);\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd_1 = window.glue42gd;\r\n            if (glue42gd_1 && typeof glue42gd_1.addRefreshHandler === \"function\") {\r\n                glue42gd_1.addRefreshHandler(function (success, error) {\r\n                    _this._gw3Session\r\n                        .send({\r\n                        type: \"reload\"\r\n                    })\r\n                        .then(function (msg) {\r\n                        if (!msg.token) {\r\n                            error(\"Expected gateway token for refreshing.\");\r\n                            return;\r\n                        }\r\n                        try {\r\n                            glue42gd_1.setGWToken(msg.token);\r\n                        }\r\n                        catch (e) {\r\n                            error(e.message || e);\r\n                            return;\r\n                        }\r\n                        success();\r\n                    }, error);\r\n                });\r\n            }\r\n        }\r\n    }\r\n    GW3Bridge.activityTypeGwMessageEntityToActivityType = function (entity, description) {\r\n        var nameToWindowType = function (windowName) {\r\n            return new WindowType(windowName, undefined);\r\n        };\r\n        return new ActivityType(entity.name, entity.owner_type && nameToWindowType(entity.owner_type), entity.helper_types && entity.helper_types.map(nameToWindowType), description);\r\n    };\r\n    GW3Bridge.peerFactoryGwMessageEntityToWindowType = function (entity) {\r\n        return new WindowType(entity.peer_type, function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.activityGwMessageToActivity = function (msg, status) {\r\n        var ownerId = msg.owner !== undefined ? msg.owner.peer_id : msg.owner_id;\r\n        return new Activity(msg.activity_id, msg.activity_type, status, msg.context_snapshot, ownerId);\r\n    };\r\n    GW3Bridge.activityToActivityStatusChangeEvent = function (act) {\r\n        return new EntityEvent(act, new ActivityStatusChangeEventContext(act.status, undefined));\r\n    };\r\n    Object.defineProperty(GW3Bridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"GW3\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.init = function () {\r\n        var _this = this;\r\n        this.forwardActivityTypeMessagesToStatusEventHandlers();\r\n        this.subscribe(gwMessageActivityCreated, this.handleActivityCreatedMessage);\r\n        this.subscribe(gwMessageActivityDestroyed, this.handleActivityDestroyedMessage);\r\n        this.forwardActivityMessagesToStatusEventHandlers();\r\n        this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers();\r\n        this.forwardPeerFactoryMessagesToStatusEventHandlers();\r\n        this.forwardPeerFactoryMessagesToPeerFactoryRequests();\r\n        this.subscribe(gwMessagePeerFactoriesAdded, this.handlePeerFactoriesAdded);\r\n        this.subscribe(gwMessagePeerFactoriesRemoved, this.handlePeerFactoriesRemoved);\r\n        this.forwardActivityWindowMessagesToEventHandlers();\r\n        this.subscribe(gwMessageDisposePeer, function () {\r\n            if (_this._config.disposeRequestHandling === \"dispose\") {\r\n                _this.dispose();\r\n                return;\r\n            }\r\n            if (_this._config.disposeRequestHandling === \"exit\") {\r\n                if (_this._windows && typeof _this._windows.my() !== \"undefined\") {\r\n                    _this._windows.my().close();\r\n                    return;\r\n                }\r\n                if (typeof window !== \"undefined\" && typeof window.close === \"function\") {\r\n                    window.close();\r\n                    return;\r\n                }\r\n                if (typeof process !== \"undefined\" && typeof process.exit === \"function\") {\r\n                    process.exit();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        this._gw3Session.onJoined(function () {\r\n            if (_this._config.mode === \"trackMyOnly\" ||\r\n                _this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                _this._sessionJoinedPromiseResolve(_this);\r\n            }\r\n            else {\r\n                _this._gw3Session\r\n                    .send({\r\n                    type: \"subscribe\",\r\n                    activity_types: (_this._config.mode === \"trackAll\" ? [] :\r\n                        _this._config.mode === \"trackTypes\" ? _this._config.typesToTrack : [])\r\n                })\r\n                    .then(function () {\r\n                    _this._sessionJoinedPromiseResolve(_this);\r\n                });\r\n            }\r\n        });\r\n        this._gw3Session.join();\r\n    };\r\n    GW3Bridge.prototype.dispose = function () {\r\n        var _this = this;\r\n        this._gw3Subscriptions.forEach(function (sub) { return sub && _this._connection.off(sub); });\r\n        this._gw3Subscriptions.length = 0;\r\n    };\r\n    GW3Bridge.prototype.ready = function () {\r\n        return Promise.all([this._sessionJoinedPromise, this._activityJoinedPromise]);\r\n    };\r\n    GW3Bridge.prototype.initReady = function () {\r\n        return this._sessionJoinedPromise;\r\n    };\r\n    GW3Bridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, config, description) {\r\n        var _this = this;\r\n        var entity = {};\r\n        entity.name = activityTypeName;\r\n        var toActivityPeerConfig = function (windowDefinition) { return ({ type: windowDefinition.type, name: windowDefinition.name, configuration: windowDefinition }); };\r\n        entity.owner_type = toActivityPeerConfig(ownerWindow);\r\n        entity.helper_types = helperWindows.map(toActivityPeerConfig);\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageAddActivityTypes,\r\n            types: [entity]\r\n        })\r\n            .then(function () {\r\n            var activityType = GW3Bridge.activityTypeGwMessageEntityToActivityType(entity, description);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Added)), gwMessageAddActivityTypes);\r\n            return activityType;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageRemoveActivityTypes,\r\n            types: [activityTypeName]\r\n        })\r\n            .then(function () {\r\n            var activityType = new ActivityType(activityTypeName, undefined, undefined, undefined);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new EntityEvent(activityType, new EntityEventContext(EntityEventType.Removed)), gwMessageAddActivityTypes);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerWindowFactory = function (windowType, factory, parameters) {\r\n        var _this = this;\r\n        if (this._peerFactoriesRegisteredByUs[windowType]) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" already registered.\"));\r\n        }\r\n        this._peerFactoriesRegisteredByUs[windowType] = factory;\r\n        var entity = {\r\n            id: windowType,\r\n            peer_type: windowType,\r\n            configuration: parameters\r\n        };\r\n        return this._gw3Session.send({\r\n            type: gwMessageAddPeerFactories,\r\n            factories: [entity]\r\n        })\r\n            .then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(entity), new EntityEventContext(EntityEventType.Added)), gwMessageAddPeerFactories);\r\n        })\r\n            .catch(function () {\r\n            delete _this._peerFactoriesRegisteredByUs[windowType];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterWindowFactory = function (windowType) {\r\n        var _this = this;\r\n        var factory = this._peerFactoriesRegisteredByUs[windowType];\r\n        if (!factory) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" not registered.\"));\r\n        }\r\n        delete this._peerFactoriesRegisteredByUs[windowType];\r\n        return this._gw3Session.send({\r\n            type: gwMessageRemovePeerFactories,\r\n            factory_ids: [windowType]\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new EntityEvent(new WindowType(windowType, undefined), new EntityEventContext(EntityEventType.Removed)), gwMessageAddPeerFactories);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        var initiateMsg = {\r\n            type: gwMessageCreateActivity,\r\n            activity_type: activityType,\r\n            initial_context: context,\r\n        };\r\n        if (this.isOverrideTypeDefinition(configuration)) {\r\n            initiateMsg.types_override = {\r\n                owner_type: { type: configuration.owner.type, name: configuration.owner.name, configuration: configuration.owner },\r\n                helper_types: configuration.helpers && configuration.helpers.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); })\r\n            };\r\n        }\r\n        else {\r\n            initiateMsg.configuration = configuration && configuration.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); });\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise(initiateMsg, gwMessageActivityInitiated, function (msg, requestId) { return msg.request_id === requestId; }, gwMessageActivityCreated, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, gwMessageActivityDestroyed, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, function (msg) { return msg.activity_id; }).then(function (id) {\r\n            if (_this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                if (!_this._activityTypesInitiatedFromMe[activityType]) {\r\n                    _this._activityTypesInitiatedFromMe[activityType] = true;\r\n                    return _this._gw3Session\r\n                        .send({\r\n                        type: \"subscribe\",\r\n                        activity_types: [activityType]\r\n                    })\r\n                        .then(function () {\r\n                        return id;\r\n                    });\r\n                }\r\n            }\r\n            return id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.stopActivity = function (activity) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyActivity,\r\n            activity_id: activity.id,\r\n            reason_uri: \"com.tick42.glue.activity.constants.destroyReason.general\",\r\n            reason: \"Destroying activity\"\r\n        }).then(function (_) { return true; });\r\n    };\r\n    GW3Bridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        if (fullReplace) {\r\n            return this._contexts.set(activity.id, context);\r\n        }\r\n        else {\r\n            removedKeys = removedKeys || [];\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var x = removedKeys_1[_i];\r\n                context[x] = null;\r\n            }\r\n            return this._contexts.update(activity.id, context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        throw new Error(\"Invalid operation 'announceWindow' for GW3 protocol\");\r\n    };\r\n    GW3Bridge.prototype.registerWindow = function (type, name, independent) {\r\n        var shouldSendReady = typeof this._connection.gatewayToken !== \"undefined\";\r\n        var peerId = this._connection.peerId;\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                shouldSendReady = typeof glue42gd.activityInfo !== \"undefined\";\r\n            }\r\n        }\r\n        if (shouldSendReady) {\r\n            this._gw3Session.send({\r\n                type: gwMessageReady,\r\n            });\r\n        }\r\n        this.invokeCallbacks(this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(peerId, name, type, undefined, this.getAgmInstance(peerId), independent, this.generateWindowGetter(peerId), undefined), new EntityEventContext(EntityEventType.Added)), \"register window\");\r\n        return Promise.resolve(peerId);\r\n    };\r\n    GW3Bridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._activityWindowChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.createWindow = function (activityId, windowDefinition) {\r\n        var _this = this;\r\n        if (!windowDefinition.layout) {\r\n            if (windowDefinition.left || windowDefinition.width || windowDefinition.height || windowDefinition.top) {\r\n                windowDefinition.layout = {\r\n                    mode: \"pixels\",\r\n                    cellSize: 1,\r\n                };\r\n            }\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise({\r\n            type: gwMessageCreatePeer,\r\n            peer_type: windowDefinition.type,\r\n            peer_name: windowDefinition.name || windowDefinition.type,\r\n            configuration: windowDefinition,\r\n            activity_id: activityId,\r\n        }, undefined, undefined, gwMessagePeerCreated, function (msg, requestId) { return msg.request_id === requestId; }, undefined, undefined, function (msg) { return msg.created_id; })\r\n            .then(function (id) {\r\n            if (!activityId) {\r\n                return;\r\n            }\r\n            return _this.joinActivity(activityId, id, windowDefinition.name)\r\n                .then(function () {\r\n                return id;\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.closeWindow = function (id) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyPeer,\r\n            destroy_peer_id: id\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.getAnnouncementInfo = function () {\r\n        var activityId = this._config.activityId || (this._config.announcementInfo && this._config.announcementInfo.activityId);\r\n        var activityWindowType = (this._config.announcementInfo && this._config.announcementInfo.activityWindowType);\r\n        var activityWindowIndependent = (this._config.announcementInfo && this._config.announcementInfo.activityWindowIndependent);\r\n        var activityWindowName = (this._config.announcementInfo && this._config.announcementInfo.activityWindowName);\r\n        if (typeof window !== \"undefined\" &&\r\n            typeof window.location !== \"undefined\" &&\r\n            window.location.search &&\r\n            typeof URLSearchParams === \"function\") {\r\n            var searchParams = new URLSearchParams(location.search.slice(1));\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42PeerType\");\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42ActivityWindowType\");\r\n            if (typeof activityWindowIndependent === \"undefined\") {\r\n                activityWindowIndependent = searchParams.get(\"t42ActivityWindowIndependent\");\r\n            }\r\n            activityWindowName = activityWindowName || searchParams.get(\"t42ActivityWindowName\");\r\n            activityId = activityId || searchParams.get(\"t42ActivityId\");\r\n        }\r\n        activityWindowType = activityWindowType || \"unknown\";\r\n        activityWindowIndependent = activityWindowIndependent || false;\r\n        activityWindowName = activityWindowName || this._connection.peerId;\r\n        return {\r\n            activityWindowId: undefined,\r\n            activityId: activityId,\r\n            activityWindowType: activityWindowType,\r\n            activityWindowIndependent: activityWindowIndependent,\r\n            activityWindowName: activityWindowName,\r\n        };\r\n    };\r\n    GW3Bridge.prototype.joinActivity = function (activityId, windowId, name) {\r\n        var _this = this;\r\n        var maybeName = (name && { name: name }) || {};\r\n        return this._gw3Session.send(__assign({ type: gwMmessageJoinActivity, target_id: windowId, activity_id: activityId }, maybeName)).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, activityId, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), \"activity joined - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity joined - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMessageLeaveActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(new ActivityWindow(windowId, undefined, undefined, null, _this.getAgmInstance(windowId), undefined, _this.generateWindowGetter(windowId), undefined), new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), \"activity left - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new EntityEvent(new Activity(activityId, undefined, new ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new EntityEventContext(EntityEventType.Updated)), \"activity left - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.getActivityTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getWindowTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivities = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivityWindows = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.getWindowBounds = function (id) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowBounds = function (id, bounds) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.activateWindow = function (id, focus) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.setWindowVisibility = function (id, visible) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.cloneActivity = function (id, cloneOptions) {\r\n        return undefined;\r\n    };\r\n    GW3Bridge.prototype.attachActivities = function (from, to, tag) {\r\n        return this._gw3Session.send({\r\n            type: gwNmessageMergeActivities,\r\n            into: to,\r\n            merge: from\r\n        });\r\n    };\r\n    GW3Bridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageSplitActivities,\r\n            from: activityId,\r\n        }).then(function () { return \"\"; });\r\n    };\r\n    GW3Bridge.prototype.onActivitiesAttached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivitiesDetached = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n    };\r\n    GW3Bridge.prototype.getAttachedDescriptors = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getRandomRequestId = function () {\r\n        return this._connection.peerId + \":\" + Math.floor(Math.random() * 1e9) + \"\";\r\n    };\r\n    GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler = function (addedMessageType, removedMessageType, mapper, handlers) {\r\n        var getGetEntityEvent = function (isAdded) { return function (entity) { return new EntityEvent(entity, new EntityEventContext(isAdded ?\r\n            EntityEventType.Added :\r\n            EntityEventType.Removed)); }; };\r\n        var sub1;\r\n        var sub2;\r\n        sub1 = addedMessageType && this.forwardMessageToEventHandler(addedMessageType, function (msg) { return mapper(msg, true); }, getGetEntityEvent(true), handlers);\r\n        sub2 = removedMessageType && this.forwardMessageToEventHandler(removedMessageType, function (msg) { return mapper(msg, false); }, getGetEntityEvent(false), handlers);\r\n        return [sub1, sub2].filter(function (x) { return x; });\r\n    };\r\n    GW3Bridge.prototype.forwardMessageToEventHandler = function (messageType, mapper, getEntityEvent, handler) {\r\n        return this.subscribe(messageType, function (msg) {\r\n            mapper(msg)\r\n                .forEach(function (ent) {\r\n                return handler.forEach(function (h) { return h(getEntityEvent(ent, msg)); });\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise = function (msg, initiatedMessageType, initiatedMessageFilter, createdMessageType, createdMessageFilter, cancelledMessageType, cancelledMessageFilter, createdMessageToPromiseResolution) {\r\n        var _this = this;\r\n        var reqId = this.getRandomRequestId();\r\n        var resolveCreatedPromise;\r\n        var rejectCreatedPromise;\r\n        var createdPromise = new Promise(function (resolve, reject) {\r\n            resolveCreatedPromise = resolve;\r\n            rejectCreatedPromise = reject;\r\n        });\r\n        var initiatedMessageAck = null;\r\n        var initiatedSubscription;\r\n        var createdSubscription;\r\n        var cancelledSubscription;\r\n        var errorSubscription;\r\n        var dropSubscriptions = function () {\r\n            _this.dropSubscription(initiatedSubscription);\r\n            _this.dropSubscription(createdSubscription);\r\n            _this.dropSubscription(cancelledSubscription);\r\n            _this.dropSubscription(errorSubscription);\r\n        };\r\n        initiatedSubscription = initiatedMessageType &&\r\n            this.subscribe(initiatedMessageType, function (msg4) {\r\n                if (!initiatedMessageFilter(msg4, reqId)) {\r\n                    return;\r\n                }\r\n                initiatedMessageAck = msg4;\r\n                _this.dropSubscription(initiatedSubscription);\r\n            });\r\n        createdSubscription =\r\n            this.subscribe(createdMessageType, function (msg1) {\r\n                if (!createdMessageFilter(msg1, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                resolveCreatedPromise(createdMessageToPromiseResolution(msg1));\r\n            });\r\n        cancelledSubscription = cancelledMessageType &&\r\n            this.subscribe(cancelledMessageType, function (msg2) {\r\n                if (!cancelledMessageFilter(msg2, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg2);\r\n            });\r\n        errorSubscription = cancelledMessageType &&\r\n            this.subscribe(gwMmessageError, function (msg3) {\r\n                if (msg3.request_id !== reqId) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg3);\r\n            });\r\n        msg.request_id = reqId;\r\n        var toReturn = this._gw3Session\r\n            .send(msg)\r\n            .then(function () {\r\n            return createdPromise;\r\n        });\r\n        toReturn.then(dropSubscriptions, dropSubscriptions);\r\n        return toReturn;\r\n    };\r\n    GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType = function (factoryId, ownerId) {\r\n        var peerType = this._peerIdAndFactoryIdToPeerType[ownerId + \":\" + factoryId];\r\n        if (!peerType) {\r\n            return null;\r\n        }\r\n        else {\r\n            return new WindowType(peerType, undefined);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (messageType, handler) {\r\n        var _this = this;\r\n        var sub = this._connection.on(messageType, function (msg) { return handler.bind(_this)(msg); });\r\n        this._gw3Subscriptions.push(sub);\r\n        return sub;\r\n    };\r\n    GW3Bridge.prototype.dropSubscription = function (subscription) {\r\n        if (subscription) {\r\n            this._connection.off(subscription);\r\n            delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(subscription)];\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeCallbacks = function (callbacks, event, description) {\r\n        var _this = this;\r\n        callbacks.forEach(function (cb) {\r\n            try {\r\n                cb(event);\r\n            }\r\n            catch (err) {\r\n                _this._logger.error(\"Error in \" + (description || event.context.type) + \" callback: \" + JSON.stringify(err));\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityCreatedMessage = function (msg) {\r\n        if (!msg.context_id) {\r\n            this._logger.error(\"Activity created with unknown context_id: \" + msg.activity_id);\r\n        }\r\n        else {\r\n            if (!this._contextSubscriptions[msg.activity_id]) {\r\n                this.subscribeToContext(msg);\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContext = function (msg) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var activityId, _a, _b;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        activityId = msg.activity_id;\r\n                        _a = this._contextSubscriptions;\r\n                        _b = activityId;\r\n                        return [4, this._contexts.subscribe(activityId, function (data, updated, removed) {\r\n                                var event = new EntityEvent(new Activity(activityId, undefined, undefined, data, undefined), new ActivityContextChangedEventContext(data, updated, removed));\r\n                                _this.invokeCallbacks(_this._activityChangeCallbacks, event, \"context updated\");\r\n                            })];\r\n                    case 1:\r\n                        _a[_b] =\r\n                            _c.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityDestroyedMessage = function (msg) {\r\n        var unsubscribeContext = this._contextSubscriptions[msg.activity_id];\r\n        if (typeof unsubscribeContext === \"function\") {\r\n            unsubscribeContext();\r\n        }\r\n        delete this._contextSubscriptions[msg.activity_id];\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesAdded = function (msg) {\r\n        var _this = this;\r\n        msg.factories.forEach(function (entity) {\r\n            _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + entity.id] = entity.peer_type;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesRemoved = function (msg) {\r\n        var _this = this;\r\n        msg.factory_ids.forEach(function (factoryId) {\r\n            delete _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + factoryId];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers = function () {\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded, gwMessageActivityTypesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.types.map(function (t) { return GW3Bridge.activityTypeGwMessageEntityToActivityType(t, undefined); })\r\n            : msg.types.map(function (t) { return new ActivityType(t.name, undefined, undefined, undefined); }); }, this._activityTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers = function () {\r\n        var _this = this;\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity, gwMessageOwnerChanged]; _i < _a.length; _i++) {\r\n            var activityCreatedMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(activityCreatedMessage, function (msg) {\r\n                return ([msg.owner || __assign(__assign({}, msg), { type: msg.peer_type, name: msg.peer_name, peer_id: msg.owner_id })])\r\n                    .concat(msg.participants || [])\r\n                    .map(function (info) { return new ActivityWindow(info.peer_id, info.name, info.type, msg.activity_id, _this.getAgmInstance(info.peer_id), undefined, _this.generateWindowGetter(info.peer_id), undefined); });\r\n            }, function (ent, msg) { return new EntityEvent(ent, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)); }, this._activityWindowChangeCallbacks);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers = function () {\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var createdMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(createdMessage, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"started\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        }\r\n        this.forwardMessageToEventHandler(gwMessageActivityDestroyed, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"destroyed\", msg.reason, new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageActivityInitiated, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageOwnerChanged, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers = function () {\r\n        var _this = this;\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded, gwMessagePeerFactoriesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType)\r\n            : msg.factory_ids.map(function (id) { return _this.peerFactoryIdAndOwnerIdToWindowType(id, msg.owner_id); }).filter(function (x) { return x != null; }); }, this._windowTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests = function () {\r\n        var _this = this;\r\n        this.subscribe(gwMessagePeerRequested, function (msg) {\r\n            var factory = _this._peerFactoriesRegisteredByUs[msg.peer_factory];\r\n            if (!factory) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: \"Unknown peer factory \" + msg.peer_factory\r\n                });\r\n                return;\r\n            }\r\n            try {\r\n                var configuration = msg.configuration || {};\r\n                configuration.gateway_token = configuration.gateway_token || msg.gateway_token;\r\n                configuration.peer_factory = configuration.peer_factory || msg.peer_factory;\r\n                var promise = factory({\r\n                    activityId: msg.activity && msg.activity.id,\r\n                    activityType: msg.activity && msg.activity.type,\r\n                    type: msg.configuration && msg.configuration.type,\r\n                    gwToken: configuration.gateway_token,\r\n                    configuration: configuration\r\n                });\r\n                if (promise && promise.then && promise.catch) {\r\n                    promise.catch(function (err) { return _this._gw3Session.send({\r\n                        type: gwMmessageError,\r\n                        request_id: msg.request_id,\r\n                        reason: err && (err.message || JSON.stringify(err))\r\n                    }); });\r\n                }\r\n            }\r\n            catch (err) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: err && (err.message || JSON.stringify(err))\r\n                });\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers = function () {\r\n        var _this = this;\r\n        var _loop_1 = function (joinedMessage) {\r\n            this_1.subscribe(joinedMessage, function (msg) {\r\n                var joinedId = (joinedMessage === gwMessageActivityJoined) ? msg.joined_id : msg.peer_id;\r\n                var joinedType = (joinedMessage === gwMessageActivityJoined) ? msg.joined_type : msg.peer_type;\r\n                var joinedName = (joinedMessage === gwMessageActivityJoined) ? msg.joined_name : msg.peer_name;\r\n                var entity = new ActivityWindow(joinedId, joinedName, joinedType, msg.activity_id, _this.getAgmInstance(joinedId), undefined, _this.generateWindowGetter(joinedId), undefined);\r\n                if (!_this._contextSubscriptions[msg.activity_id]) {\r\n                    _this.subscribeToContext(msg).then(function () {\r\n                        if (joinedMessage === gwMessageJoinedActivity) {\r\n                            _this._activityJoinedPromiseResolve({});\r\n                        }\r\n                    });\r\n                }\r\n                else if (joinedMessage === gwMessageJoinedActivity) {\r\n                    _this._activityJoinedPromiseResolve({});\r\n                }\r\n                _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowJoinedActivity)), joinedMessage);\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = [gwMessageActivityJoined, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var joinedMessage = _a[_i];\r\n            _loop_1(joinedMessage);\r\n        }\r\n        this.subscribe(gwMessageActivityLeft, function (msg) {\r\n            var entity = new ActivityWindow(msg.left_id, undefined, undefined, null, _this.getAgmInstance(msg.left_id), undefined, _this.generateWindowGetter(msg.left_id), undefined);\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new EntityEvent(entity, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)), gwMessageActivityLeft);\r\n        });\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated, undefined, function (msg) { return [\r\n            new ActivityWindow(msg.created_id, undefined, undefined, undefined, undefined, undefined, _this.generateWindowGetter(msg.created_id), undefined)\r\n        ]; }, this._activityWindowChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.getAgmInstance = function (id) {\r\n        return this._config.agm.servers().find(function (s) { return s.peerId === id || s.windowId === id; });\r\n    };\r\n    GW3Bridge.prototype.generateWindowGetter = function (peerId) {\r\n        var _this = this;\r\n        return function () {\r\n            var server = _this.getAgmInstance(peerId);\r\n            if (!server) {\r\n                return;\r\n            }\r\n            var windowId = server.windowId;\r\n            return _this._config.windows.list().filter(function (w) { return w.id === windowId; })[0];\r\n        };\r\n    };\r\n    GW3Bridge.prototype.isOverrideTypeDefinition = function (value) {\r\n        if (typeof value === \"undefined\") {\r\n            return false;\r\n        }\r\n        if (value.owner) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ActivityMy = (function () {\r\n    function ActivityMy(manager, windows) {\r\n        var _this = this;\r\n        this._myAttached = [];\r\n        this._myDetached = [];\r\n        this._myAttachedTo = [];\r\n        this._myDetachedFrom = [];\r\n        this._myActivityFrameColorChanged = [];\r\n        this._myActivityJoinedCallbacks = [];\r\n        this._myActivityRemovedCallbacks = [];\r\n        this._myContextUpdateCallbacks = [];\r\n        this._logger = Logger$1.Get(this);\r\n        this._m = manager;\r\n        manager.ready()\r\n            .then(function (am) {\r\n            am.subscribeActivityContextChanged(_this._subscribeMyContextChanged.bind(_this));\r\n            am.subscribeWindowEvents(_this._subscribeMyWindowEvent.bind(_this));\r\n            am.subscribeActivitiesAttached(_this._subscribeActivitiesAttached.bind(_this));\r\n            am.subscribeActivitiesDetached(_this._subscribeActivitiesDetached.bind(_this));\r\n            if (windows) {\r\n                windows.onWindowFrameColorChanged(_this._subscribeWindowFrameColorChanged.bind(_this));\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityMy.prototype, \"window\", {\r\n        get: function () {\r\n            if (isUndefinedOrNull(this._w)) {\r\n                var announcedWindows = this._m.announcedWindows;\r\n                if (announcedWindows.length > 0) {\r\n                    this._w = announcedWindows[0];\r\n                }\r\n            }\r\n            return this._w;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityMy.prototype, \"activity\", {\r\n        get: function () {\r\n            var myWin = this.window;\r\n            if (isUndefinedOrNull(myWin)) {\r\n                return undefined;\r\n            }\r\n            return myWin.activity;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.createWindow = function (windowType) {\r\n        return this._m.createWindow(this.activity, windowType);\r\n    };\r\n    ActivityMy.prototype.createStackedWindows = function (windowTypes, timeout) {\r\n        return this._m.createStackedWindows(this.activity, windowTypes, timeout);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"context\", {\r\n        get: function () {\r\n            var activity = this.activity;\r\n            if (isUndefined(activity)) {\r\n                return {};\r\n            }\r\n            return activity.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.updateContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.updateContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.setContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.setContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.onActivityJoined = function (callback) {\r\n        this._myActivityJoinedCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (!isUndefinedOrNull(myWin) && !isUndefinedOrNull(myWin.activity)) {\r\n            callback(myWin.activity);\r\n        }\r\n    };\r\n    ActivityMy.prototype.onActivityLeft = function (callback) {\r\n        this._myActivityRemovedCallbacks.push(callback);\r\n    };\r\n    ActivityMy.prototype.onContextChanged = function (callback) {\r\n        this._myContextUpdateCallbacks.push(callback);\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var activity = myWin.activity;\r\n        if (isUndefinedOrNull(activity)) {\r\n            return;\r\n        }\r\n        callback(activity.context, activity.context, [], activity);\r\n    };\r\n    ActivityMy.prototype.clone = function (options, callback) {\r\n        var act = this.activity;\r\n        return this._m.clone(act, options, callback);\r\n    };\r\n    ActivityMy.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._m.attachActivities(activityId, this.activity.id, tag);\r\n    };\r\n    ActivityMy.prototype.onActivityAttached = function (callback) {\r\n        this._myAttached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onActivityDetached = function (callback) {\r\n        this._myDetached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onAttachedToActivity = function (callback) {\r\n        this._myAttachedTo.push(callback);\r\n    };\r\n    ActivityMy.prototype.onDetachedFromActivity = function (callback) {\r\n        this._myDetachedFrom.push(callback);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"attached\", {\r\n        get: function () {\r\n            if (!this.activity) {\r\n                return [];\r\n            }\r\n            return this.activity.attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.setFrameColor = function (color, callback) {\r\n        if (this.activity) {\r\n            return this.activity.setFrameColor(color, callback);\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    ActivityMy.prototype.getFrameColor = function () {\r\n        if (this.activity) {\r\n            return this.activity.getFrameColor();\r\n        }\r\n        return \"\";\r\n    };\r\n    ActivityMy.prototype.onFrameColorChanged = function (callback) {\r\n        this._myActivityFrameColorChanged.push(callback);\r\n    };\r\n    ActivityMy.prototype._subscribeMyContextChanged = function (activity, context, delta, removed) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (activity.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        this._notifyMyContextChanged(activity, context, delta, removed);\r\n    };\r\n    ActivityMy.prototype._subscribeMyWindowEvent = function (activity, window, event) {\r\n        if (isUndefinedOrNull(this.window)) {\r\n            return;\r\n        }\r\n        if (this.window.id !== window.id) {\r\n            return;\r\n        }\r\n        if (event === EntityEventType.ActivityWindowJoinedActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityJoinedCallbacks);\r\n            this._notifyMyContextChanged(activity, activity.context, null, null);\r\n        }\r\n        else if (event === EntityEventType.ActivityWindowLeftActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityRemovedCallbacks);\r\n        }\r\n    };\r\n    ActivityMy.prototype._notifyMyWindowEvent = function (activity, callbackStore) {\r\n        var _this = this;\r\n        callbackStore.forEach(function (element) {\r\n            try {\r\n                element(activity, event);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyMyContextChanged = function (activity, context, delta, removed) {\r\n        var _this = this;\r\n        delta = delta || {};\r\n        removed = removed || [];\r\n        this._myContextUpdateCallbacks.forEach(function (element) {\r\n            try {\r\n                element(context, delta, removed, activity);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttached = function (state) {\r\n        var _this = this;\r\n        this._myAttached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetached = function (state) {\r\n        var _this = this;\r\n        this._myDetached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttachedTo = function (state) {\r\n        var _this = this;\r\n        this._myAttachedTo.forEach(function (cb) {\r\n            try {\r\n                cb(_this.activity, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetachedFrom = function (detached, existing, state) {\r\n        var _this = this;\r\n        this._myDetachedFrom.forEach(function (cb) {\r\n            try {\r\n                cb(detached, existing, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesAttached = function (newAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (newAct.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        if (state.windowIds.indexOf(myWin.id) >= 0) {\r\n            this._notifyAttachedTo(state);\r\n            return;\r\n        }\r\n        this._notifyAttached(state);\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesDetached = function (newAct, oldAct, state) {\r\n        var myWin = this.window;\r\n        if (isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        if (oldAct.id === myActivity.id) {\r\n            this._notifyDetached(state);\r\n        }\r\n        if (newAct.id === myActivity.id) {\r\n            this._notifyDetachedFrom(newAct, oldAct, state);\r\n        }\r\n    };\r\n    ActivityMy.prototype._subscribeWindowFrameColorChanged = function (window) {\r\n        var act = this.activity;\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id === window.id) {\r\n            this._myActivityFrameColorChanged.forEach(function (callback) {\r\n                callback(window.frameColor);\r\n            });\r\n        }\r\n    };\r\n    return ActivityMy;\r\n}());\n\nvar ReadyMarker = (function () {\r\n    function ReadyMarker(name, signalsToWait) {\r\n        this._logger = Logger$1.Get(\"ReadyMarker [\" + name + \"]\");\r\n        this._logger.debug(\"Initializing ready marker for '\" + name + \"' with \" + signalsToWait + \" signals to wait\");\r\n        if (signalsToWait <= 0) {\r\n            throw new Error(\"Invalid signal number. Should be > 0\");\r\n        }\r\n        this._signals = signalsToWait;\r\n        this._callbacks = [];\r\n        this._name = name;\r\n    }\r\n    ReadyMarker.prototype.setCallback = function (callback) {\r\n        if (this.isSet()) {\r\n            callback(undefined);\r\n            return;\r\n        }\r\n        else if (this.isError()) {\r\n            callback(this._error);\r\n            return;\r\n        }\r\n        this._callbacks.push(callback);\r\n    };\r\n    ReadyMarker.prototype.signal = function (message) {\r\n        this._logger.debug(\"Signaled - \" + message + \" - signals left \" + (this._signals - 1));\r\n        this._signals--;\r\n        if (this._signals < 0) {\r\n            throw new Error(\"Error in ready marker '\" + this._name + \" - signals are \" + this._signals);\r\n        }\r\n        if (this.isSet()) {\r\n            this._callbacks.forEach(function (callback) {\r\n                callback(undefined);\r\n            });\r\n        }\r\n    };\r\n    ReadyMarker.prototype.error = function (error) {\r\n        this._error = error;\r\n        this._callbacks.forEach(function (errorCallback) {\r\n            errorCallback(error);\r\n        });\r\n    };\r\n    ReadyMarker.prototype.isSet = function () {\r\n        if (this.isError()) {\r\n            return false;\r\n        }\r\n        return this._signals === 0;\r\n    };\r\n    ReadyMarker.prototype.isError = function () {\r\n        return !isUndefined(this._error);\r\n    };\r\n    ReadyMarker.prototype.getError = function () {\r\n        return this._error;\r\n    };\r\n    return ReadyMarker;\r\n}());\n\nvar EntityObservableCollection = (function () {\r\n    function EntityObservableCollection(processNew) {\r\n        this._items = {};\r\n        this._listeners = [];\r\n        this._processNew = processNew;\r\n    }\r\n    EntityObservableCollection.prototype.addOne = function (item) {\r\n        this.add([item]);\r\n    };\r\n    EntityObservableCollection.prototype.add = function (items) {\r\n        var _this = this;\r\n        items.forEach(function (element) {\r\n            _this.process(new EntityEvent(element, new EntityEventContext(EntityEventType.Added)));\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.process = function (event) {\r\n        var context = event.context;\r\n        var type = context.type;\r\n        var entity = event.entity;\r\n        if (type === EntityEventType.StatusChange &&\r\n            !context.oldStatus) {\r\n            var act = this._items[entity.id];\r\n            if (act) {\r\n                context.oldStatus = act.status;\r\n            }\r\n        }\r\n        if (type === EntityEventType.StatusChange &&\r\n            context.oldStatus &&\r\n            context.newStatus &&\r\n            context.oldStatus.state ===\r\n                context.newStatus.state) {\r\n            context.type = EntityEventType.Updated;\r\n        }\r\n        if (typeof htmlContainer === \"undefined\") {\r\n            if (type === EntityEventType.ActivityWindowJoinedActivity &&\r\n                this._items[entity.id] &&\r\n                this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n            if (type === EntityEventType.ActivityWindowLeftActivity &&\r\n                this._items[entity.id] &&\r\n                !this._items[entity.id].activity) {\r\n                context.type = EntityEventType.Updated;\r\n            }\r\n        }\r\n        var internalEntity = this._updateInternalCollections(entity, type, context);\r\n        this._notifyListeners(internalEntity, context);\r\n        return internalEntity;\r\n    };\r\n    EntityObservableCollection.prototype.get = function () {\r\n        var result = [];\r\n        for (var key in this._items) {\r\n            if (this._items.hasOwnProperty(key)) {\r\n                var element = this._items[key];\r\n                result.push(element);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    EntityObservableCollection.prototype.getByName = function (name) {\r\n        for (var key in this._items) {\r\n            if (key === name) {\r\n                return this._items[key];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    EntityObservableCollection.prototype.getOrWait = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var entityAddedHandler = function (entity) {\r\n                if (entity.id !== name) {\r\n                    return;\r\n                }\r\n                resolve(entity);\r\n                _this.unsubscribe(entityAddedHandler);\r\n            };\r\n            _this.subscribe(entityAddedHandler);\r\n            var window = _this.getByName(name);\r\n            if (window) {\r\n                _this.unsubscribe(entityAddedHandler);\r\n                resolve(window);\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype.subscribe = function (handler) {\r\n        var _this = this;\r\n        this._listeners.push(handler);\r\n        Object.keys(this._items).forEach(function (key) {\r\n            var element = _this._items[key];\r\n            handler(element, new EntityEventContext(EntityEventType.Added.toString()));\r\n        });\r\n        return function () {\r\n            _this.unsubscribe(handler);\r\n        };\r\n    };\r\n    EntityObservableCollection.prototype.unsubscribe = function (handler) {\r\n        var index = this._listeners.indexOf(handler);\r\n        if (index !== -1) {\r\n            this._listeners.splice(index, 1);\r\n        }\r\n    };\r\n    EntityObservableCollection.prototype._notifyListeners = function (entity, context) {\r\n        this._listeners.forEach(function (listener) {\r\n            try {\r\n                listener(entity, context);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    EntityObservableCollection.prototype._updateInternalCollections = function (entity, type, context) {\r\n        var entityAsAny = entity;\r\n        var isActivityDestroy = (type === EntityEventType.StatusChange &&\r\n            entityAsAny.status &&\r\n            entityAsAny.status.state === ActivityState.Destroyed) ||\r\n            (type === EntityEventType.StatusChange &&\r\n                context &&\r\n                context.newStatus &&\r\n                context.newStatus.state === ActivityState.Destroyed);\r\n        var isWindowClose = type === EntityEventType.Closed;\r\n        var isTypeRemove = type === EntityEventType.Removed && typeof entityAsAny.isIndependent === \"undefined\";\r\n        if (isTypeRemove || isWindowClose || isActivityDestroy) {\r\n            var oldEntity = this._items[entity.id];\r\n            delete this._items[entity.id];\r\n            this._processNew(entity);\r\n            if (oldEntity) {\r\n                entity._beforeDelete(oldEntity);\r\n            }\r\n            return entity;\r\n        }\r\n        else {\r\n            var key = entity.id;\r\n            if (!this._items.hasOwnProperty(key)) {\r\n                this._processNew(entity);\r\n                this._items[entity.id] = entity;\r\n            }\r\n            else {\r\n                this._items[entity.id]._update(entity);\r\n            }\r\n        }\r\n        return this._items[entity.id];\r\n    };\r\n    return EntityObservableCollection;\r\n}());\n\nvar ActivityManager = (function () {\r\n    function ActivityManager(bridge, autoAnnounce, windows) {\r\n        var _this = this;\r\n        this._logger = Logger$1.Get(\"activityManager\");\r\n        this._announcedWindows = [];\r\n        this._attachedCallbacks = [];\r\n        this._detachedCallbacks = [];\r\n        this._frameColorChangesCallbacks = [];\r\n        this._windowHandlers = [];\r\n        this._bridge = bridge;\r\n        this._activityTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windowTypes = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._activities = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windows = new EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._dataReadyMarker = new ReadyMarker(\"Activity Manager Data\", [\"GetActivityTypes\", \"GetWindowTypes\", \"GetActivities\", \"GetWindows\"].length);\r\n        this._descriptorsMarker = new ReadyMarker(\"Attached Activities Descriptors\", [\"GetDescriptors\"].length);\r\n        if (autoAnnounce) {\r\n            this._readyMarker = new ReadyMarker(\"Activity Manager Announce\", [\"Announcement\"].length);\r\n            this._dataReadyMarker.setCallback(function (dataErr) {\r\n                if (dataErr) {\r\n                    _this._readyMarker.error(dataErr);\r\n                }\r\n                _this._descriptorsMarker.setCallback(function (err) {\r\n                    if (err) {\r\n                        _this._readyMarker.error(err);\r\n                    }\r\n                    _this._logger.debug(\"Auto announcing window\");\r\n                    _this.announceWindow()\r\n                        .then(function (w) {\r\n                        _this._announcedWindows.push(w);\r\n                        _this._readyMarker.signal(\"Successfully announced window with id '\" + w.id + \"'\");\r\n                    })\r\n                        .catch(function (errCatch) {\r\n                        _this._logger.debug(\"Will not announce window - \" + errCatch);\r\n                        _this._readyMarker.signal();\r\n                    });\r\n                });\r\n                _this.refreshDescriptors();\r\n            });\r\n        }\r\n        else {\r\n            this._readyMarker = this._dataReadyMarker;\r\n        }\r\n        this._bridge.onActivitiesAttached(function (e) {\r\n            _this._handleActivitiesAttached(e);\r\n        });\r\n        this._bridge.onActivitiesDetached(function (e) {\r\n            _this._handleActivitiesDetached(e);\r\n        });\r\n        this._bridge.onActivityAttachedDescriptorsRefreshed(function (e) {\r\n            _this._handleActivityDescriptorsRefreshed(e);\r\n        });\r\n        if (windows) {\r\n            windows.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this));\r\n        }\r\n        this._bridge.init();\r\n        this._subscribeForData();\r\n        this._bridge\r\n            .initReady()\r\n            .then(function (aw) {\r\n            _this._getInitialData();\r\n        })\r\n            .catch(function (error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityManager.prototype, \"usingHc\", {\r\n        get: function () {\r\n            return this._bridge.bridgeType === \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityManager.prototype, \"announcedWindows\", {\r\n        get: function () {\r\n            return this._announcedWindows;\r\n        },\r\n        set: function (v) {\r\n            throw new Error(\"not allowed\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityManager.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n        return nodeify(Promise.all([this._bridge.ready(), promise]).then(function () { return _this; }), callback);\r\n    };\r\n    ActivityManager.prototype.getActivityTypes = function () {\r\n        return this._activityTypes.get();\r\n    };\r\n    ActivityManager.prototype.getActivityType = function (name) {\r\n        return this._activityTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerActivityType = function (activityTypeName, ownerWindowType, helperWindowTypes, config, description, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activityTypeName)) {\r\n                reject(\"activityTypeName argument can not be undefined\");\r\n                return;\r\n            }\r\n            if (!isString(activityTypeName)) {\r\n                reject(\"activityTypeName should be string\");\r\n                return;\r\n            }\r\n            var actType = _this.getActivityType(activityTypeName);\r\n            if (!isUndefinedOrNull(actType)) {\r\n                reject(\"Activity type '\" + activityTypeName + \"' already exists\");\r\n                return;\r\n            }\r\n            var ownerDefinition;\r\n            if (isUndefined(ownerWindowType)) {\r\n                reject(\"Owner window type can not be undefined\");\r\n                return;\r\n            }\r\n            if (isString(ownerWindowType)) {\r\n                ownerDefinition = { type: ownerWindowType, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                ownerDefinition = ownerWindowType;\r\n            }\r\n            var helperDefinitions = [];\r\n            if (!isUndefined(helperWindowTypes) && isArray(helperWindowTypes)) {\r\n                for (var index in helperWindowTypes) {\r\n                    var item = helperWindowTypes[index];\r\n                    if (isString(item)) {\r\n                        var definition = {\r\n                            type: item,\r\n                            name: \"\",\r\n                            isIndependent: false,\r\n                            arguments: {},\r\n                            relativeTo: \"\",\r\n                            relativeDirection: \"\",\r\n                            windowStyleAttributes: {}\r\n                        };\r\n                        helperDefinitions.push(definition);\r\n                    }\r\n                    else {\r\n                        helperDefinitions.push(item);\r\n                    }\r\n                }\r\n            }\r\n            _this._bridge\r\n                .registerActivityType(activityTypeName, ownerDefinition, helperDefinitions, config, description)\r\n                .then(function (activityType) {\r\n                _this._grabEntity(activityType);\r\n                resolve(activityType);\r\n            })\r\n                .catch(function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterActivityType = function (type, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(type);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + type + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge.unregisterActivityType(type).then(function () { return resolve(actType); }, reject);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.initiate = function (activityType, context, callback, configuration) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var actType = _this.getActivityType(activityType);\r\n            if (isUndefined(actType)) {\r\n                reject(\"Activity type '\" + activityType + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .initiateActivity(activityType, context, configuration)\r\n                .then(function (actId) {\r\n                _this._activities\r\n                    .getOrWait(actId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityTypeEvents = function (handler) {\r\n        this._activityTypes.subscribe(function (at, context) {\r\n            handler(at, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowTypes = function () {\r\n        return this._windowTypes.get();\r\n    };\r\n    ActivityManager.prototype.getWindowType = function (name) {\r\n        return this._windowTypes.getByName(name);\r\n    };\r\n    ActivityManager.prototype.registerWindowFactory = function (windowType, factoryMethod, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (isObject(windowType)) {\r\n                windowType = windowType.getName();\r\n            }\r\n            else if (!isString(windowType)) {\r\n                reject(\"windowType should be string or object that has getName method\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .registerWindowFactory(windowType, factoryMethod)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.unregisterWindowFactory = function (windowType, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (!isString(windowType)) {\r\n                reject(\"windowType should be a string\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .unregisterWindowFactory(windowType)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getActivities = function (activityType) {\r\n        var act = this._activities.get();\r\n        act = act.filter(function (a) { return a._ownerId; });\r\n        if (!activityType) {\r\n            return act;\r\n        }\r\n        var types = activityType;\r\n        if (isString(activityType)) {\r\n            types = [activityType];\r\n        }\r\n        else if (activityType instanceof ActivityType) {\r\n            types = [activityType.name];\r\n        }\r\n        else if (activityType instanceof Array) ;\r\n        else {\r\n            throw new Error(\"Invalid input argument 'activityType' = \" + activityType);\r\n        }\r\n        return act.filter(function (at) {\r\n            var type = at.type;\r\n            return some(types, function (t) {\r\n                return type.id === t.id;\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype.getActivityById = function (id) {\r\n        return this._activities.getByName(id);\r\n    };\r\n    ActivityManager.prototype.announceWindow = function (activityWindowId, windowType) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var announcementInfo = _this._bridge.getAnnouncementInfo();\r\n            if (isUndefined(activityWindowId)) {\r\n                activityWindowId = announcementInfo.activityWindowId;\r\n            }\r\n            if (isUndefined(windowType)) {\r\n                windowType = announcementInfo.activityWindowType;\r\n            }\r\n            if (isUndefinedOrNull(windowType)) {\r\n                throw new Error(\"Can not announce - unknown windowType\");\r\n            }\r\n            var activityId = announcementInfo && announcementInfo.activityId;\r\n            if (isUndefinedOrNull(activityWindowId)) {\r\n                _this._logger.debug(\"Registering window with type:'\" + windowType + \"', name:'\" + announcementInfo.activityWindowName + \"', ind.:'\" + announcementInfo.activityWindowIndependent + \"'\");\r\n                _this._bridge.registerWindow(windowType, announcementInfo.activityWindowName, announcementInfo.activityWindowIndependent)\r\n                    .then(_this._windows.getOrWait.bind(_this._windows))\r\n                    .then(function (w) {\r\n                    if (activityId) {\r\n                        return _this._activities.getOrWait(activityId).then(function (_) { return w; });\r\n                    }\r\n                    else {\r\n                        return w;\r\n                    }\r\n                })\r\n                    .then(function (w) {\r\n                    resolve(w);\r\n                })\r\n                    .catch(function (err) {\r\n                    _this._logger.error(err);\r\n                });\r\n            }\r\n            else {\r\n                _this._logger.debug(\"Announcing window with id '\" + activityWindowId + \"' and type '\" + windowType + \"'\");\r\n                var currentWindow = _this._windows.getByName(activityWindowId);\r\n                if (!isUndefinedOrNull(currentWindow)) {\r\n                    _this._logger.debug(\"Window with id '\" + activityWindowId + \"' already announced - reusing the window\");\r\n                    resolve(currentWindow);\r\n                    return;\r\n                }\r\n                var windowEventHandler_1 = function (a, w, e) {\r\n                    if (activityWindowId === w.id) {\r\n                        if (e === EntityEventType.ActivityWindowJoinedActivity) {\r\n                            var activity = w.activity;\r\n                            if (isUndefined(activity)) {\r\n                                reject(\"UNDEFINED ACTIVITY\");\r\n                            }\r\n                            _this._logger.trace(\"Got joined event for id '\" + activityWindowId + \"'\");\r\n                            resolve(w);\r\n                            _this.unsubscribeWindowEvents(windowEventHandler_1);\r\n                        }\r\n                    }\r\n                };\r\n                _this.subscribeWindowEvents(windowEventHandler_1);\r\n                _this._logger.trace(\"Waiting for joined event for id '\" + activityWindowId + \"'\");\r\n                _this._bridge.announceWindow(windowType, activityWindowId);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    ActivityManager.prototype.subscribeWindowTypeEvents = function (handler) {\r\n        this._windowTypes.subscribe(function (wt, context) {\r\n            handler(wt, context.type);\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeActivityEvents = function (handler) {\r\n        var _this = this;\r\n        return this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.StatusChange) {\r\n                var p = context;\r\n                handler(act, p.newStatus, p.oldStatus);\r\n            }\r\n            if (context.type === EntityEventType.Removed ||\r\n                (context.type === EntityEventType.StatusChange &&\r\n                    context.newStatus.getState() === ActivityState.Destroyed)) {\r\n                for (var _i = 0, _a = _this._windows.get(); _i < _a.length; _i++) {\r\n                    var window_1 = _a[_i];\r\n                    if (window_1.activity && window_1.activity.id === act.id) {\r\n                        _this._windows.process(new EntityEvent(window_1, new EntityEventContext(EntityEventType.ActivityWindowLeftActivity)));\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.subscribeWindowEvents = function (handler) {\r\n        var wrappingHandler = function (window, context) {\r\n            var eventType = context.type;\r\n            if (eventType === EntityEventType.Added) {\r\n                eventType = \"opened\";\r\n            }\r\n            handler(window.activity, window, eventType);\r\n        };\r\n        this._windowHandlers.push([handler, wrappingHandler]);\r\n        return this._windows.subscribe(wrappingHandler);\r\n    };\r\n    ActivityManager.prototype.unsubscribeWindowEvents = function (handler) {\r\n        var found = this._windowHandlers.find(function (pair) { return pair[0] === handler; });\r\n        if (found) {\r\n            this._windowHandlers.splice(this._windowHandlers.indexOf(found), 1);\r\n            this._windows.unsubscribe(found[1]);\r\n        }\r\n    };\r\n    ActivityManager.prototype.createWindow = function (activity, windowTypeOrConfiguration, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(windowTypeOrConfiguration)) {\r\n                reject(\"windowType is undefined\");\r\n            }\r\n            var windowDefinition;\r\n            if (isString(windowTypeOrConfiguration)) {\r\n                windowDefinition = { type: windowTypeOrConfiguration, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else if (windowTypeOrConfiguration instanceof WindowType) {\r\n                windowDefinition = {\r\n                    type: windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    name: windowTypeOrConfiguration.name || windowTypeOrConfiguration.type || windowTypeOrConfiguration.id,\r\n                    isIndependent: false\r\n                };\r\n            }\r\n            else {\r\n                var invalidKeys_1 = [\"url\"];\r\n                var filteredWindowTypeOrConfiguration_1 = {};\r\n                Object.keys(windowTypeOrConfiguration).forEach(function (key) {\r\n                    if (invalidKeys_1.indexOf(key) === -1) {\r\n                        filteredWindowTypeOrConfiguration_1[key] = windowTypeOrConfiguration[key];\r\n                    }\r\n                });\r\n                windowDefinition = filteredWindowTypeOrConfiguration_1;\r\n            }\r\n            var relativeToWindow;\r\n            if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                relativeToWindow = windowDefinition.relativeTo;\r\n                if (typeof relativeToWindow === \"string\") {\r\n                    var windows = _this.getWindows({ type: relativeToWindow });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                    var windows = _this.getWindows({ type: relativeToWindow.type });\r\n                    if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                    windowDefinition.relativeTo = relativeToWindow.windowId;\r\n                }\r\n            }\r\n            _this._bridge.createWindow(activity && activity.id, windowDefinition)\r\n                .then(function (wid) {\r\n                _this._logger.debug(\"Window created, waiting for window entity with id \" + wid);\r\n                var handler = function (window, context) {\r\n                    if (window.id === wid && (!activity || window.activity)) {\r\n                        _this._logger.debug(\"Got entity window with id \" + wid);\r\n                        resolve(window);\r\n                        _this._windows.unsubscribe(handler);\r\n                    }\r\n                };\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.createStackedWindows = function (activity, relativeWindowTypes, timeout, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity is undefined\");\r\n            }\r\n            if (isUndefinedOrNull(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes is undefined\");\r\n            }\r\n            if (!Array.isArray(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes has to be an array\");\r\n            }\r\n            if (isUndefinedOrNull(timeout)) {\r\n                timeout = 20000;\r\n            }\r\n            var windowDefinitions = [];\r\n            relativeWindowTypes.forEach(function (element) {\r\n                var windowDefinition;\r\n                if (isString(element)) {\r\n                    windowDefinition = { type: element, name: \"\", isIndependent: false, arguments: {} };\r\n                }\r\n                else {\r\n                    windowDefinition = element;\r\n                }\r\n                windowDefinition.stackedWindow = true;\r\n                windowDefinition.timeout = timeout;\r\n                var relativeToWindow;\r\n                if (!isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                    relativeToWindow = windowDefinition.relativeTo;\r\n                    if (!isUndefinedOrNull(relativeToWindow.type)) {\r\n                        windowDefinition.relativeTo = relativeToWindow.type;\r\n                    }\r\n                    else if (!isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                        var windows = _this.getWindows({ id: relativeToWindow.windowId });\r\n                        if (!isUndefinedOrNull(windows) && windows.length > 0) {\r\n                            windowDefinition.relativeTo = windows[0].type.name;\r\n                        }\r\n                    }\r\n                }\r\n                windowDefinitions.push(windowDefinition);\r\n            });\r\n            var tasks = [];\r\n            windowDefinitions.forEach(function (wd) { return tasks.push(_this.createWindow(activity, wd)); });\r\n            Promise.all(tasks).then(resolve).catch(reject);\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.addWindowToActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.joinActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.leaveWindowFromActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.leaveActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    ActivityManager.prototype.setActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, true)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.updateActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            var removedKeys = [];\r\n            for (var key in context) {\r\n                if (context.hasOwnProperty(key) && context[key] === null) {\r\n                    removedKeys.push(key);\r\n                }\r\n            }\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var removedKey = removedKeys_1[_i];\r\n                delete context[removedKey];\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, false, removedKeys)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityContextChanged = function (handler) {\r\n        this._activities.subscribe(function (act, context) {\r\n            if (context.type === EntityEventType.ActivityContextChange) {\r\n                var updateContext = context;\r\n                handler(act, updateContext.context, updateContext.updated, updateContext.removed);\r\n            }\r\n        });\r\n    };\r\n    ActivityManager.prototype.stopActivity = function (activity, callback) {\r\n        var promise = this._bridge.stopActivity(activity);\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.getWindows = function (filter) {\r\n        if (isUndefined(filter)) {\r\n            return this._windows.get();\r\n        }\r\n        if (!isUndefined(filter.id)) {\r\n            return [this._windows.getByName(filter.id)];\r\n        }\r\n        var allWindows = this._windows.get();\r\n        return allWindows.filter(function (w) {\r\n            if (!isUndefined(filter.type) && w.type.id !== filter.type) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.name) && w.name !== filter.name) {\r\n                return false;\r\n            }\r\n            if (!isUndefined(filter.activityId)) {\r\n                if (isUndefinedOrNull(w.activity)) {\r\n                    return false;\r\n                }\r\n                if (w.activity.id !== filter.activityId) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowBounds = function (id) {\r\n        return this._bridge.getWindowBounds(id);\r\n    };\r\n    ActivityManager.prototype.setWindowBounds = function (id, bounds, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._bridge.setWindowBounds(id, bounds)\r\n                .then(function () { return resolve(); })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.closeWindow = function (id) {\r\n        return this._bridge.closeWindow(id);\r\n    };\r\n    ActivityManager.prototype.activateWindow = function (id, focus) {\r\n        return this._bridge.activateWindow(id, focus);\r\n    };\r\n    ActivityManager.prototype.setWindowVisibility = function (id, visible) {\r\n        return this._bridge.setWindowVisibility(id, visible);\r\n    };\r\n    ActivityManager.prototype.clone = function (activity, cloneOptions, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!activity) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge.cloneActivity(activity.id, cloneOptions)\r\n                .then(function (activityId) {\r\n                _this._activities\r\n                    .getOrWait(activityId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.attachActivities = function (from, to, tag, callback) {\r\n        var _this = this;\r\n        tag = tag || {};\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var fromActivity = _this._activities.getByName(from);\r\n            if (!fromActivity) {\r\n                reject(\"can not find activity with id \" + from);\r\n                return;\r\n            }\r\n            var toActivity = _this._activities.getByName(to);\r\n            if (!toActivity) {\r\n                reject(\"can not find activity with id \" + to);\r\n                return;\r\n            }\r\n            return _this._bridge.attachActivities(from, to, tag)\r\n                .then(function (data) {\r\n                var newActId = data.to;\r\n                var state = data.descriptor;\r\n                var allStates = data.descriptors;\r\n                _this._activities.getOrWait(newActId).then(function (act) {\r\n                    act._updateDescriptors(allStates);\r\n                    var stateWrapped = act.attached.filter(function (u) { return u.ownerId === state.ownerId; })[0];\r\n                    resolve(stateWrapped);\r\n                });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.detachActivities = function (activityId, descriptor, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            return _this._bridge.detachActivities(activityId, descriptor)\r\n                .then(function () {\r\n                var oldActId = undefined;\r\n                var newActId = undefined;\r\n                var descriptors = undefined;\r\n                _this._activities\r\n                    .getOrWait(oldActId)\r\n                    .then(function (oldAct) {\r\n                    oldAct._updateDescriptors(descriptors);\r\n                    _this._activities\r\n                        .getOrWait(newActId)\r\n                        .then(function (newAct) {\r\n                        resolve(newAct);\r\n                    });\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesAttached = function (callback) {\r\n        this._attachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesDetached = function (callback) {\r\n        this._detachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityFrameColorChanged = function (callback) {\r\n        this._frameColorChangesCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype._grabEntity = function (entity) {\r\n        entity._manager = this;\r\n    };\r\n    ActivityManager.prototype._getInitialData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Request initial data...\");\r\n        this._bridge.getActivityTypes()\r\n            .then(function (at) {\r\n            _this._activityTypes.add(at);\r\n            _this._dataReadyMarker.signal(\"Got act types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity types -\" + error);\r\n        });\r\n        this._bridge.getWindowTypes()\r\n            .then(function (wt) {\r\n            _this._windowTypes.add(wt);\r\n            _this._dataReadyMarker.signal(\"Got window types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting window types  \" + error);\r\n        });\r\n        this._bridge.getActivities()\r\n            .then(function (ac) {\r\n            _this._activities.add(ac);\r\n            _this._dataReadyMarker.signal(\"Got activities\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity instances -\" + error);\r\n        });\r\n        this._bridge.getActivityWindows()\r\n            .then(function (aw) {\r\n            _this._windows.add(aw);\r\n            _this._dataReadyMarker.signal(\"Got windows\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity windows -\" + error);\r\n        });\r\n    };\r\n    ActivityManager.prototype._subscribeForData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Subscribe for data...\");\r\n        this._bridge.onActivityTypeStatusChange(function (event) {\r\n            _this._activityTypes.process(event);\r\n        });\r\n        this._bridge.onWindowTypeStatusChange(function (event) {\r\n            _this._windowTypes.process(event);\r\n        });\r\n        this._bridge.onActivityWindowChange(function (event) {\r\n            _this._windows.process(event);\r\n        });\r\n        this._bridge.onActivityStatusChange(function (event) {\r\n            _this._activities.process(event);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesAttached = function (data) {\r\n        var _this = this;\r\n        var newActId = data.to;\r\n        var descriptor = data.descriptor;\r\n        var descriptors = data.descriptors;\r\n        this._activities.getOrWait(newActId).then(function (act) {\r\n            act._updateDescriptors(descriptors);\r\n            var descriptorAsObjectFromAPI = act.attached.filter(function (u) { return u.ownerId === descriptor.ownerId; })[0];\r\n            _this._attachedCallbacks.forEach(function (callback) {\r\n                try {\r\n                    callback(act, descriptorAsObjectFromAPI);\r\n                }\r\n                catch (err) {\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesDetached = function (data) {\r\n        var _this = this;\r\n        var oldActId = data.oldActivityId;\r\n        var newActId = data.newActivityId;\r\n        var descriptors = data.descriptors;\r\n        var descriptor = data.descriptor;\r\n        this._activities.getOrWait(oldActId).then(function (oldAct) {\r\n            oldAct._updateDescriptors(descriptors);\r\n            _this._activities.getOrWait(newActId).then(function (newAct) {\r\n                _this._detachedCallbacks.forEach(function (callback) {\r\n                    try {\r\n                        callback(newAct, oldAct, descriptor);\r\n                    }\r\n                    catch (err) {\r\n                        return;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivityDescriptorsRefreshed = function (data) {\r\n        var id = data.id;\r\n        var descriptors = data.descriptors;\r\n        var act = this._activities.getByName(id);\r\n        if (act) {\r\n            act._updateDescriptors(descriptors);\r\n        }\r\n    };\r\n    ActivityManager.prototype.refreshDescriptors = function () {\r\n        var _this = this;\r\n        this._bridge.getAttachedDescriptors()\r\n            .then(function (map) {\r\n            if (map) {\r\n                Object.keys(map).forEach(function (key) {\r\n                    var actId = key;\r\n                    var descriptors = map[key];\r\n                    var act = _this._activities.getByName(actId);\r\n                    if (act) {\r\n                        act._updateDescriptors(descriptors);\r\n                    }\r\n                });\r\n            }\r\n            _this._descriptorsMarker.signal(\"Successfully got descriptors\");\r\n        })\r\n            .catch(function (err) {\r\n            _this._descriptorsMarker.error(\"failed to get descriptors - \" + err);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleWindowFrameColorChanged = function (win) {\r\n        if (!win.activityId) {\r\n            return;\r\n        }\r\n        var act = this._activities.getByName(win.activityId);\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id !== win.id) {\r\n            return;\r\n        }\r\n        this._frameColorChangesCallbacks.forEach(function (callback) {\r\n            try {\r\n                callback(act, win.frameColor);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    return ActivityManager;\r\n}());\n\nvar ActivityManagementAPI = (function () {\r\n    function ActivityManagementAPI(manager, my) {\r\n        this._m = manager;\r\n        this._my = my;\r\n        this.activityTypes = {\r\n            get: this._getActivityTypesWrapper.bind(this),\r\n            register: this._m.registerActivityType.bind(this._m),\r\n            unregister: this._m.unregisterActivityType.bind(this._m),\r\n            subscribe: this._m.subscribeActivityTypeEvents.bind(this._m),\r\n            unsubscribe: undefined,\r\n            initiate: this._m.initiate.bind(this._m)\r\n        };\r\n        this.windowTypes = {\r\n            get: this._getWindowTypesWrapper.bind(this),\r\n            registerFactory: this._m.registerWindowFactory.bind(this._m),\r\n            unregisterFactory: this._m.unregisterWindowFactory.bind(this._m),\r\n            subscribe: this._m.subscribeWindowTypeEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n        this.windows = {\r\n            get: this._m.getWindows.bind(this._m),\r\n            subscribe: this._m.subscribeWindowEvents.bind(this._m),\r\n            announce: this._m.announceWindow.bind(this._m),\r\n            unsubscribe: undefined,\r\n            create: this._m.createWindow.bind(this._m)\r\n        };\r\n        this.instances = {\r\n            get: this._m.getActivities.bind(this._m),\r\n            subscribe: this._m.subscribeActivityEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n    }\r\n    ActivityManagementAPI.prototype.onAttached = function (callback) {\r\n        this._m.subscribeActivitiesAttached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onDetached = function (callback) {\r\n        this._m.subscribeActivitiesDetached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onActivityFrameColorChanged = function (callback) {\r\n        this._m.subscribeActivityFrameColorChanged(callback);\r\n    };\r\n    ActivityManagementAPI.prototype._getActivityTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getActivityTypes();\r\n        }\r\n        return this._m.getActivityType(name);\r\n    };\r\n    ActivityManagementAPI.prototype._getWindowTypesWrapper = function (name) {\r\n        if (isUndefined(name)) {\r\n            return this._m.getWindowTypes();\r\n        }\r\n        return this._m.getWindowType(name);\r\n    };\r\n    return ActivityManagementAPI;\r\n}());\n\nvar ActivityAPI = (function () {\r\n    function ActivityAPI(manager, my) {\r\n        this._mgr = manager;\r\n        this._my = my;\r\n        this.all = new ActivityManagementAPI(manager, my);\r\n    }\r\n    ActivityAPI.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._mgr.ready()\r\n                .then(function () {\r\n                resolve(_this);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return nodeify(promise, callback);\r\n    };\r\n    Object.defineProperty(ActivityAPI.prototype, \"my\", {\r\n        get: function () {\r\n            return this._my;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"aware\", {\r\n        get: function () {\r\n            return this._my.window !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"inActivity\", {\r\n        get: function () {\r\n            return this.aware && this._my.activity !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"agm\", {\r\n        get: function () {\r\n            if (!this.aware) {\r\n                return undefined;\r\n            }\r\n            if (!this.inActivity) {\r\n                return new ActivityAGM(null);\r\n            }\r\n            return this._my.activity.agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityAPI.prototype.getAvailableFrameColors = function () {\r\n        return [];\r\n    };\r\n    return ActivityAPI;\r\n}());\n\nvar ActivityModule = (function () {\r\n    function ActivityModule(config) {\r\n        var _this = this;\r\n        if (!config) {\r\n            throw new Error(\"config can not be null\");\r\n        }\r\n        if (!isUndefined(config.logLevel)) {\r\n            Logger$1.Level = config.logLevel;\r\n        }\r\n        if (!isUndefinedOrNull(config.logger)) {\r\n            Logger$1.GlueLogger = config.logger;\r\n        }\r\n        var bridge;\r\n        this._isUsingHCImplementation = config.gdMajorVersion === 2;\r\n        this._isUsingGW3Implementation = ActivityModule.checkIsUsingGW3Implementation(config.connection);\r\n        if (this._isUsingHCImplementation) {\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (this._isUsingGW3Implementation) {\r\n            bridge = new GW3Bridge$1(config);\r\n        }\r\n        else {\r\n            throw new Error(\"Unable to instantiate activity bridge implementation\");\r\n        }\r\n        if (!bridge) {\r\n            throw new Error(\"A bridge to native activity is needed to create activity lib.\");\r\n        }\r\n        ActivityAGM.AGM = config.agm;\r\n        var activityManager = new ActivityManager(bridge, !config.disableAutoAnnounce, config.windows);\r\n        var my = new ActivityMy(activityManager, config.windows);\r\n        this._api = new ActivityAPI(activityManager, my);\r\n        this._readyPromise = activityManager.ready().then(function (_) { return _this; });\r\n    }\r\n    ActivityModule.checkIsUsingGW3Implementation = function (connection) {\r\n        return connection.protocolVersion === 3;\r\n    };\r\n    Object.defineProperty(ActivityModule.prototype, \"api\", {\r\n        get: function () {\r\n            return this._api;\r\n        },\r\n        set: function (value) {\r\n            this._api = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingHCImplementation\", {\r\n        get: function () {\r\n            return this._isUsingHCImplementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingGW3Implementation\", {\r\n        get: function () {\r\n            return this._isUsingGW3Implementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityModule.prototype.ready = function (callback) {\r\n        return nodeify(this._readyPromise, callback);\r\n    };\r\n    return ActivityModule;\r\n}());\n\nvar ShutdownMethodName = \"T42.ACS.Shutdown\";\r\nvar RestartMethodName = \"T42.ACS.Restart\";\r\nvar GetConfigurationRegionMethodName = \"T42.ACS.GetConfigurationRegion\";\r\nvar SetConfigurationRegionMethodName = \"T42.ACS.SetConfigurationRegion\";\r\nvar GetUserMethodName = \"T42.ACS.GetUser\";\r\nvar GetBranchesMethodName = \"T42.ACS.GetBranches\";\r\nvar GetCurrentBranchMethodName = \"T42.ACS.GetCurrentBranch\";\r\nvar SetCurrentBranchMethodName = \"T42.ACS.SetCurrentBranch\";\r\nvar GetFunctionalEntitlementMethodName = \"T42.ACS.GetFunctionalEntitlement\";\r\nvar CanIMethodName = \"T42.ACS.CanI\";\r\nvar StartApplicationMethodName = \"T42.ACS.StartApplication\";\r\nvar StopApplicationMethodName = \"T42.ACS.StopApplication\";\r\nvar ActivateApplicationMethodName = \"T42.ACS.ActivateApplication\";\r\nvar OnEventMethodName = \"T42.ACS.OnEvent\";\r\nvar GetApplicationsMethodName = \"T42.ACS.GetApplications\";\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nfunction objectValues(source) {\r\n    if (!source) {\r\n        return [];\r\n    }\r\n    return Object.keys(source).map(function (key) { return source[key]; });\r\n}\r\nfunction objectClone(obj) {\r\n    var result;\r\n    try {\r\n        result = JSON.parse(JSON.stringify(obj || {}));\r\n    }\r\n    catch (error) {\r\n        result = {};\r\n    }\r\n    return result;\r\n}\n\nvar ApplicationImpl = (function () {\r\n    function ApplicationImpl(_appManager, _name, _agm) {\r\n        var _this = this;\r\n        this._appManager = _appManager;\r\n        this._name = _name;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application && instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n        });\r\n        _appManager.onAppRemoved(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        });\r\n        _appManager.onAppChanged(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appChanged\", app);\r\n        });\r\n        _appManager.onAppAvailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appAvailable\", app);\r\n        });\r\n        _appManager.onAppUnavailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appUnavailable\", app);\r\n        });\r\n    }\r\n    Object.defineProperty(ApplicationImpl.prototype, \"name\", {\r\n        get: function () { return this._name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"title\", {\r\n        get: function () { return this._props.Title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"version\", {\r\n        get: function () { return this._props.Version; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"autoStart\", {\r\n        get: function () { return this._props.AutoStart; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isShell\", {\r\n        get: function () { return this._props.IsShell; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"caption\", {\r\n        get: function () { return this._props.Caption; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"hidden\", {\r\n        get: function () { return this._props.IsHidden; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"container\", {\r\n        get: function () { return this._props.ApplicationName; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityType\", {\r\n        get: function () { return this._props.ActivityType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityWindowType\", {\r\n        get: function () { return this._props.ActivityWindowType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"windowSettings\", {\r\n        get: function () {\r\n            if (!this._props.Arguments) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.Arguments);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"allowMultiple\", {\r\n        get: function () { return this._props.AllowMultiple; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"available\", {\r\n        get: function () { return this._props.IsReady || true; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"icon\", {\r\n        get: function () { return this._props.Icon; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"iconURL\", {\r\n        get: function () { return this._props.IconUrl; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"sortOrder\", {\r\n        get: function () { return this._props.SortOrder; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"userProperties\", {\r\n        get: function () {\r\n            if (!this._props.UserProperties) {\r\n                return {};\r\n            }\r\n            return objectClone(this._props.UserProperties);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isActivity\", {\r\n        get: function () {\r\n            return this._props.ActivityType !== undefined && this._props.ActivityType !== \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"configuration\", {\r\n        get: function () {\r\n            return {\r\n                autoStart: this._props.AutoStart,\r\n                caption: this._props.Caption,\r\n                hidden: this._props.IsHidden,\r\n                container: this._props.ApplicationName,\r\n                activityType: this._props.ActivityType,\r\n                allowMultiple: this._props.AllowMultiple\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this._name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"type\", {\r\n        get: function () {\r\n            return this._props.Type;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"mode\", {\r\n        get: function () {\r\n            if (!this._props) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Mode && typeof this._props.Mode === \"string\") {\r\n                return this._props.Mode.toLowerCase();\r\n            }\r\n            if (this.isActivity) {\r\n                return \"unknown\";\r\n            }\r\n            if (this._props.Arguments && this._props.Arguments.mode && typeof this._props.Arguments.mode === \"string\") {\r\n                return this._props.Arguments.mode.toLowerCase();\r\n            }\r\n            var styleAttributes = this._props.WindowStyleAttributes;\r\n            if (styleAttributes) {\r\n                styleAttributes = styleAttributes.split(\" \").join(\"\");\r\n                var searchFor = \"mode:\\\"\";\r\n                var modeIndex = styleAttributes.indexOf(searchFor);\r\n                if (modeIndex !== -1) {\r\n                    var startModeIndex = modeIndex + searchFor.length;\r\n                    var stopModeIndex = styleAttributes.indexOf(\"\\\"\", startModeIndex);\r\n                    var style = styleAttributes.substr(startModeIndex, stopModeIndex - startModeIndex);\r\n                    if (style && typeof style === \"string\") {\r\n                        return style.toLowerCase();\r\n                    }\r\n                }\r\n            }\r\n            return \"flat\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ApplicationImpl.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        if (!this._props) {\r\n            this._props = { Name: props.Name };\r\n        }\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.start = function (context, options) {\r\n        var _this = this;\r\n        var name = this._name;\r\n        var startTimeout = 10000;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            context = context || {};\r\n            var waitForAGMInstance = true;\r\n            var waitForApplicationInstance = function (id) {\r\n                var check = function () {\r\n                    var filtered = _this._appManager.instances().filter(function (i) { return i.id === id; });\r\n                    var result;\r\n                    if (filtered.length === 2) {\r\n                        result = filtered[0].isActivityInstance ? filtered[0] : filtered[1];\r\n                    }\r\n                    else {\r\n                        result = filtered[0];\r\n                    }\r\n                    if (result && waitForAGMInstance) {\r\n                        if (result.agm) {\r\n                            return result;\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n                var unsub;\r\n                var timeout = setTimeout(function () {\r\n                    if (unsub) {\r\n                        unsub();\r\n                    }\r\n                    reject(\"timeout\");\r\n                }, startTimeout);\r\n                var waitFunc = function (i) {\r\n                    if (i.id !== id) {\r\n                        return;\r\n                    }\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    setTimeout(function () {\r\n                        resolve(check());\r\n                    }, 1);\r\n                };\r\n                {\r\n                    unsub = _this._appManager.onInstanceAgmServerReady(waitFunc);\r\n                }\r\n                var instances = check();\r\n                if (instances) {\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    resolve(instances);\r\n                }\r\n            };\r\n            _this._agm.invoke(StartApplicationMethodName, {\r\n                Name: name,\r\n                Context: context,\r\n                Options: options\r\n            }, \"best\", {\r\n                methodResponseTimeoutMs: startTimeout\r\n            }, function (result) {\r\n                var acsResult = result.returned && result.returned.Instance_0\r\n                    ? result.returned.Instance_0\r\n                    : result.returned;\r\n                if (acsResult && acsResult.Id) {\r\n                    if (_this._appManager.mode === \"startOnly\") {\r\n                        var instance = _this._appManager.handleInstanceStarted(acsResult);\r\n                        resolve(instance);\r\n                    }\r\n                    else {\r\n                        waitForApplicationInstance(acsResult.Id);\r\n                    }\r\n                }\r\n                else {\r\n                    resolve(undefined);\r\n                }\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onAvailable = function (callback) {\r\n        this._registry.add(\"appAvailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onUnavailable = function (callback) {\r\n        this._registry.add(\"appUnavailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onChanged = function (callback) {\r\n        this._registry.add(\"appChanged\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onRemoved = function (callback) {\r\n        this._registry.add(\"appRemoved\", callback);\r\n    };\r\n    return ApplicationImpl;\r\n}());\n\nvar InstanceImpl = (function () {\r\n    function InstanceImpl(_id, _appName, _appManager, _agm, _activities, _windows, startFailed) {\r\n        var _this = this;\r\n        this._id = _id;\r\n        this._appName = _appName;\r\n        this._appManager = _appManager;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this.onAgmReady = this._addToRegistry(\"agmReady\");\r\n        this.onStopped = this._addToRegistry(\"stopped\");\r\n        this._registry = lib$2();\r\n        if (startFailed) {\r\n            return;\r\n        }\r\n        this._unsubscribeInstanceStopped = this._appManager.onInstanceStopped(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"stopped\", instance);\r\n        });\r\n        this._unsubscribeInstanceAgmServerReady = this._appManager.onInstanceAgmServerReady(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"agmReady\", instance);\r\n        });\r\n    }\r\n    Object.defineProperty(InstanceImpl.prototype, \"id\", {\r\n        get: function () { return this._id; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"application\", {\r\n        get: function () { return this._appManager.application(this._appName); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activity\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._activities) {\r\n                throw new Error(\"This method requires glue.activities library to be enabled.\");\r\n            }\r\n            return this._activities.all.instances.get()\r\n                .filter(function (activityInstance) { return activityInstance.id === _this._activityId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityInstances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (i) { var _a; return ((_a = i.activity) === null || _a === void 0 ? void 0 : _a.id) === _this._activityId; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityOwnerInstance\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._activityId) {\r\n                return undefined;\r\n            }\r\n            var act = this.activity;\r\n            if (!act) {\r\n                throw new Error(\"Can not find activity with id \" + this._activityId);\r\n            }\r\n            var owner = act.owner;\r\n            var ownerWindowId = (_a = owner.underlyingWindow) === null || _a === void 0 ? void 0 : _a.id;\r\n            if (!ownerWindowId) {\r\n                throw new Error(\"Can not find owner wind underlyingWindow for activity with id \" + this._activityId);\r\n            }\r\n            return this._appManager.instances()\r\n                .filter(function (instance) { return instance.id === ownerWindowId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"window\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._windows) {\r\n                throw new Error(\"This method requires glue.windows library to be enabled.\");\r\n            }\r\n            var win = this._windows.list().filter(function (w) { return w.id === _this._id; })[0];\r\n            if (!win && this.activity && this.activityOwnerInstance) {\r\n                win = this.activityOwnerInstance.window;\r\n            }\r\n            return win;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"context\", {\r\n        get: function () {\r\n            var _a, _b, _c;\r\n            return _c = (_a = this._startUpContext, (_a !== null && _a !== void 0 ? _a : (_b = this.window) === null || _b === void 0 ? void 0 : _b.context)), (_c !== null && _c !== void 0 ? _c : {});\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"title\", {\r\n        get: function () { return this._title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityInstance\", {\r\n        get: function () { return this._isActivityInstance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityId\", {\r\n        get: function () { return this._activityId; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"inActivity\", {\r\n        get: function () { return this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isSingleWindowApp\", {\r\n        get: function () { return !this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agmInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InstanceImpl.prototype.updateFromProps = function (props) {\r\n        this._startUpContext = props.Context;\r\n        this._title = props.Title;\r\n        this._isActivityInstance = false;\r\n        if (props.ActivityId && props.ActivityId !== \"\") {\r\n            this._activityId = props.ActivityId;\r\n            this._isActivityInstance = true;\r\n        }\r\n        if (!this._activityId && this._startUpContext && this._startUpContext.activityId) {\r\n            this._activityId = this._startUpContext.activityId;\r\n        }\r\n        this._inActivity = Boolean(this._activityId);\r\n        this.updateAgmInstanceFromProps(props);\r\n    };\r\n    InstanceImpl.prototype.updateAgmInstanceFromProps = function (props) {\r\n        if (!props.AgmServers) {\r\n            return;\r\n        }\r\n        if (props.GD3) {\r\n            var agmInstances = props.AgmServers;\r\n            if (agmInstances) {\r\n                this._agmInstance = agmInstances[0];\r\n            }\r\n        }\r\n        else {\r\n            var gdAgmServers = props.AgmServers;\r\n            var propsAgmServer = Object.keys(gdAgmServers)[0];\r\n            if (!propsAgmServer) {\r\n                return;\r\n            }\r\n            var propsAgm = gdAgmServers[propsAgmServer];\r\n            this._agmInstance = {\r\n                machine: propsAgm.machineName,\r\n                user: propsAgm.userName,\r\n                environment: propsAgm.environment,\r\n                application: propsAgm.applicationName,\r\n            };\r\n        }\r\n    };\r\n    InstanceImpl.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var unsubscribe = _this._appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this._id) {\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            _this._agm.invoke(StopApplicationMethodName, {\r\n                Name: _this._appName,\r\n                Id: _this._id\r\n            })\r\n                .then(function () {\r\n                if (_this._appManager.mode === \"startOnly\") {\r\n                    _this._appManager.handleInstanceStopped({\r\n                        Name: _this._appName,\r\n                        Id: _this.id,\r\n                        Context: undefined,\r\n                        Title: undefined,\r\n                        ActivityId: undefined,\r\n                        AgmServers: undefined\r\n                    });\r\n                    resolve();\r\n                }\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    InstanceImpl.prototype.activate = function () {\r\n        return this._agm.invoke(ActivateApplicationMethodName, { Name: this._appName, Id: this._id });\r\n    };\r\n    InstanceImpl.prototype.done = function () {\r\n        this._registry.clear();\r\n        this._unsubscribeInstanceAgmServerReady();\r\n        this._unsubscribeInstanceStopped();\r\n    };\r\n    InstanceImpl.prototype._addToRegistry = function (key) {\r\n        var _this = this;\r\n        return function (callback) {\r\n            _this._registry.add(key, callback);\r\n        };\r\n    };\r\n    return InstanceImpl;\r\n}());\n\nvar AppManagerImpl = (function () {\r\n    function AppManagerImpl(mode, _agm, _activities, _windows, _logger, _gdMajorVersion) {\r\n        var _this = this;\r\n        this.mode = mode;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this._logger = _logger;\r\n        this._gdMajorVersion = _gdMajorVersion;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this._registry = lib$2();\r\n        this.application = function (name) {\r\n            return _this._apps[name];\r\n        };\r\n        this.applications = function () {\r\n            return Object.keys(_this._apps).map(function (k) { return _this._apps[k]; });\r\n        };\r\n        this.instances = function () {\r\n            return _this._instances;\r\n        };\r\n        this.getMyInstance = function () {\r\n            if (_this._gdMajorVersion >= 3) {\r\n                var instanceId_1 = window.glue42gd.appInstanceId;\r\n                return _this._instances.filter(function (i) { return i.id === instanceId_1; })[0];\r\n            }\r\n            return undefined;\r\n        };\r\n        this.handleAppAdded = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"adding app \" + id);\r\n            _this._apps[id] = new ApplicationImpl(_this, id, _this._agm);\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appAdded\", app);\r\n        };\r\n        this.handleAppUpdated = function (props) {\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appChanged\", app);\r\n        };\r\n        this.handleAppRemoved = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"removing app \" + id);\r\n            var app = _this.application(id);\r\n            _this._instances = _this._instances.filter(function (i) { return i.application.name !== app.name; });\r\n            delete _this._apps[id];\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        };\r\n        this.handleAppReady = function (props) {\r\n            var id = _this._getAppId(props);\r\n            var app = _this._getAppOrThrow(id);\r\n            app.updateFromProps(props);\r\n            if (app.available) {\r\n                _this._registry.execute(\"appAvailable\", app);\r\n            }\r\n            else {\r\n                _this._registry.execute(\"appUnavailable\", app);\r\n            }\r\n        };\r\n        this.handleInstanceStarted = function (props) {\r\n            _this._logger.trace(\"started app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = new InstanceImpl(id, appName, _this, _this._agm, _this._activities, _this._windows);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._instances.push(instance);\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n            return instance;\r\n        };\r\n        this.handleInstanceStopped = function (props) {\r\n            _this._logger.trace(\"failed to start app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            _this._instances = _this._instances.filter(function (i) { return !_this._matchInstance(i, id, appName); });\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n            instance.done();\r\n        };\r\n        this.handleInstanceAgmServerReady = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            instance.updateAgmInstanceFromProps(props);\r\n            _this._registry.execute(\"instanceAgmServerReady\", instance);\r\n        };\r\n        this.handleInstanceStartFailed = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var startFailed = true;\r\n            var instance = new InstanceImpl(id, appName, undefined, undefined, undefined, undefined, startFailed);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._registry.execute(\"instanceStartFailed\", instance);\r\n        };\r\n        this.handleInstanceUpdated = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, app);\r\n            _this._updateInstanceFromProps(instance, props);\r\n        };\r\n        this.onInstanceStarted = function (callback) {\r\n            _this._replay(_this._instances, callback);\r\n            return _this._registry.add(\"instanceStarted\", callback);\r\n        };\r\n        this.onInstanceStartFailed = function (callback) {\r\n            return _this._registry.add(\"instanceStartFailed\", callback);\r\n        };\r\n        this.onInstanceStopped = function (callback) {\r\n            return _this._registry.add(\"instanceStopped\", callback);\r\n        };\r\n        this.onInstanceUpdated = function (callback) {\r\n            return _this._registry.add(\"instanceChanged\", callback);\r\n        };\r\n        this.onInstanceAgmServerReady = function (callback) {\r\n            return _this._registry.add(\"instanceAgmServerReady\", callback);\r\n        };\r\n        this.onAppAdded = function (callback) {\r\n            _this._replay(_this._apps, callback);\r\n            return _this._registry.add(\"appAdded\", callback);\r\n        };\r\n        this.onAppRemoved = function (callback) {\r\n            return _this._registry.add(\"appRemoved\", callback);\r\n        };\r\n        this.onAppAvailable = function (callback) {\r\n            return _this._registry.add(\"appAvailable\", callback);\r\n        };\r\n        this.onAppUnavailable = function (callback) {\r\n            return _this._registry.add(\"appUnavailable\", callback);\r\n        };\r\n        this.onAppChanged = function (callback) {\r\n            return _this._registry.add(\"appChanged\", callback);\r\n        };\r\n    }\r\n    AppManagerImpl.prototype._getAppOrThrow = function (id) {\r\n        var result = this.application(id);\r\n        if (!result) {\r\n            throw Error(\"app with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getAppId = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._matchInstance = function (instance, id, appName) {\r\n        return instance.id === id && instance.application.name === appName;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceByIdAndName = function (id, appName) {\r\n        var _this = this;\r\n        return this._instances.filter(function (i) { return _this._matchInstance(i, id, appName); })[0];\r\n    };\r\n    AppManagerImpl.prototype._getInstanceOrThrow = function (id, appName) {\r\n        var result = this._getInstanceByIdAndName(id, appName);\r\n        if (!result) {\r\n            throw Error(\"instance with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceId = function (props) {\r\n        return props.Id;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceAppName = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._updateAppFromProps = function (props) {\r\n        var id = this._getAppId(props);\r\n        this._logger.trace(\"updating app with  + \" + id + \", \" + props);\r\n        var app = this._getAppOrThrow(id);\r\n        app.updateFromProps(props);\r\n        return app;\r\n    };\r\n    AppManagerImpl.prototype._updateInstanceFromProps = function (instance, props) {\r\n        this._logger.trace(\"updating instance with \" + this._getInstanceId(props) + \" for app \" + this._getInstanceAppName(props));\r\n        instance.updateFromProps(props);\r\n    };\r\n    AppManagerImpl.prototype._replay = function (itemsToReplay, callback) {\r\n        if (itemsToReplay) {\r\n            if (Array.isArray(itemsToReplay)) {\r\n                itemsToReplay.forEach(function (item) { return callback(item); });\r\n            }\r\n            else {\r\n                var itemsToReplayArr = Object.keys(itemsToReplay).map(function (key) { return itemsToReplay[key]; });\r\n                itemsToReplayArr.forEach(function (item) { return callback(item); });\r\n            }\r\n        }\r\n    };\r\n    return AppManagerImpl;\r\n}());\n\nfunction promisify$2(promise, successCallback, errorCallback) {\r\n    var isFunction = function (arg) {\r\n        return !!(arg && arg.constructor && arg.call && arg.apply);\r\n    };\r\n    if (!isFunction(successCallback) && !isFunction(errorCallback)) {\r\n        return promise;\r\n    }\r\n    if (!isFunction(successCallback)) {\r\n        successCallback = function () {\r\n        };\r\n    }\r\n    else if (!isFunction(errorCallback)) {\r\n        errorCallback = function () {\r\n        };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nvar EntitlementsImpl = (function () {\r\n    function EntitlementsImpl(_agm) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._registry = lib$2();\r\n        this.handleBranchModified = function (branch) {\r\n            _this._registry.execute(\"branchChanged\", branch);\r\n        };\r\n        this.handleBranchesModified = function (branches) {\r\n            _this._registry.execute(\"branchesChanged\", branches);\r\n        };\r\n        this.getRegion = function (success, error) {\r\n            return promisify$2(_this._agmInvoke(GetConfigurationRegionMethodName, function (e) { return e.returned.Region; }), success, error);\r\n        };\r\n        this.getBranches = function (success, error) {\r\n            var promise = _this._agmInvoke(GetBranchesMethodName, function (e) {\r\n                var obj = e.returned.Branches;\r\n                return Object.keys(obj).map(function (key) { return obj[key]; });\r\n            });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getCurrentBranch = function (success, error) {\r\n            var promise = _this._agmInvoke(GetCurrentBranchMethodName, function (e) { return e.returned.Branch; }, undefined);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setRegion = function (region, success, error) {\r\n            var promise = _this._agmInvoke(SetConfigurationRegionMethodName, function (e) { return e.returned.ResultMessage; }, { Region: region });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.setCurrentBranch = function (branch, success, error) {\r\n            var promise = _this._agmInvoke(SetCurrentBranchMethodName, function (e) { return e.returned.ResultMessage; }, { Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.currentUser = function (success, error) {\r\n            var promise = _this._agmInvoke(GetUserMethodName);\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlement = function (funct, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlementBranch = function (funct, branch, success, error) {\r\n            var promise = _this._agmInvoke(GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canI = function (func, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.canIBranch = function (func, branch, success, error) {\r\n            var promise = _this._agmInvoke(CanIMethodName, function (e) { return e.returned.Result; }, { Function: func, Branch: branch });\r\n            return promisify$2(promise, success, error);\r\n        };\r\n        this.onBranchesChanged = function (callback) {\r\n            _this._registry.add(\"branchesChanged\", callback);\r\n        };\r\n        this.onBranchChanged = function (callback) {\r\n            _this._registry.add(\"branchChanged\", callback);\r\n        };\r\n        this.exit = function (options) {\r\n            return _this._agmInvoke(ShutdownMethodName, null, options);\r\n        };\r\n        this.restart = function (options) {\r\n            return _this._agmInvoke(RestartMethodName, null, options);\r\n        };\r\n        this._agmInvoke = function (method, transformFunction, args) {\r\n            args = args || {};\r\n            return new Promise(function (resolve, reject) {\r\n                var errHandler = function (error) { return reject(error); };\r\n                _this._agm.invoke(method, args)\r\n                    .then(function (result) {\r\n                    if (!transformFunction) {\r\n                        transformFunction = function (d) { return d.returned; };\r\n                    }\r\n                    resolve(transformFunction(result));\r\n                })\r\n                    .catch(errHandler);\r\n            });\r\n        };\r\n    }\r\n    return EntitlementsImpl;\r\n}());\n\nfunction snapshot(agm, appManager) {\r\n    return new Promise(function (resolve, reject) {\r\n        agm.invoke(GetApplicationsMethodName, { skipIcon: true })\r\n            .then(function (response) {\r\n            var data = response.returned;\r\n            if (!data) {\r\n                resolve();\r\n            }\r\n            var applications = data.applications;\r\n            if (!applications) {\r\n                resolve();\r\n            }\r\n            objectValues(applications).map(function (item) { return appManager.handleAppAdded(item); });\r\n            resolve();\r\n        })\r\n            .catch(function (err) { return reject(\"Error getting application snapshot: \" + err.message); });\r\n    });\r\n}\n\nvar OnBranchChangedEvent = \"OnBranchChanged\";\r\nvar OnBranchesModifiedEvent = \"OnBranchesModified\";\r\nvar OnApplicationAddedEvent = \"OnApplicationAdded\";\r\nvar OnApplicationRemovedEvent = \"OnApplicationRemoved\";\r\nvar OnApplicationChangedEvent = \"OnApplicationChanged\";\r\nvar OnApplicationReadyEvent = \"OnApplicationReady\";\r\nvar OnApplicationStartedEvent = \"OnApplicationStarted\";\r\nvar OnApplicationAgmServerReadyEvent = \"OnApplicationAgmServerReady\";\r\nvar OnApplicationUpdatedEvent = \"OnApplicationUpdated\";\r\nvar OnApplicationStoppedEvent = \"OnApplicationStopped\";\r\nvar OnApplicationStartFailedEvent = \"OnApplicationStartFailed\";\n\nfunction createDataSubscription(agm, applications, entitlements, skipIcons) {\r\n    var subscription;\r\n    var start = function () {\r\n        var resolveFunc;\r\n        var rejectFunc;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            resolveFunc = resolve;\r\n            rejectFunc = reject;\r\n        });\r\n        agm.subscribe(OnEventMethodName, { arguments: { skipIcon: skipIcons }, waitTimeoutMs: 10000 })\r\n            .then(function (s) {\r\n            subscription = s;\r\n            subscription.onData(function (streamData) {\r\n                var events = streamData.data;\r\n                objectValues(events[OnApplicationAddedEvent])\r\n                    .map(function (item) { return applications.handleAppAdded(item); });\r\n                objectValues(events[OnApplicationChangedEvent])\r\n                    .map(function (item) { return applications.handleAppUpdated(item); });\r\n                objectValues(events[OnApplicationRemovedEvent])\r\n                    .map(function (item) { return applications.handleAppRemoved(item); });\r\n                objectValues(events[OnApplicationReadyEvent])\r\n                    .map(function (item) { return applications.handleAppReady(item); });\r\n                objectValues(events[OnApplicationStartedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStarted(item); });\r\n                objectValues(events[OnApplicationStartFailedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStartFailed(item); });\r\n                objectValues(events[OnApplicationStoppedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStopped(item); });\r\n                objectValues(events[OnApplicationUpdatedEvent])\r\n                    .map(function (item) { return applications.handleInstanceUpdated(item); });\r\n                objectValues(events[OnApplicationAgmServerReadyEvent])\r\n                    .map(function (item) { return applications.handleInstanceAgmServerReady(item); });\r\n                objectValues(events[OnBranchChangedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchModified(item); });\r\n                objectValues(events[OnBranchesModifiedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchesModified(item); });\r\n                resolveFunc();\r\n            });\r\n            subscription.onFailed(function (err) { return rejectFunc(err); });\r\n        })\r\n            .catch(function (err) { return rejectFunc(\"Error subscribing for \" + OnEventMethodName + \" stream. Err: \" + err); });\r\n        return resultPromise;\r\n    };\r\n    var stop = function () {\r\n        if (subscription) {\r\n            subscription.close();\r\n        }\r\n    };\r\n    return {\r\n        start: start,\r\n        stop: stop\r\n    };\r\n}\n\nvar AppManagerFactory = (function (config) {\r\n    if (!config) {\r\n        throw Error(\"config not set\");\r\n    }\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is missing\");\r\n    }\r\n    var START_ONLY = \"startOnly\";\r\n    var SKIP_ICONS = \"skipIcons\";\r\n    var FULL = \"full\";\r\n    var mode = config.mode || START_ONLY;\r\n    if (mode !== START_ONLY && mode !== SKIP_ICONS && mode !== FULL) {\r\n        throw new Error(\"Invalid mode for appManager lib - \" + mode + \" is not supported\");\r\n    }\r\n    var activities = config.activities;\r\n    var agm = config.agm;\r\n    var logger = config.logger;\r\n    var windows = config.windows;\r\n    var appManager = new AppManagerImpl(mode, agm, activities, windows, logger.subLogger(\"applications\"), config.gdMajorVersion);\r\n    var entitlements = new EntitlementsImpl(agm);\r\n    var readyPromise;\r\n    if (mode === START_ONLY) {\r\n        readyPromise = snapshot(agm, appManager);\r\n    }\r\n    else {\r\n        var subscription = createDataSubscription(agm, appManager, entitlements, mode === SKIP_ICONS);\r\n        readyPromise = subscription.start();\r\n    }\r\n    var api = {\r\n        ready: function () { return readyPromise; },\r\n        applications: appManager.applications,\r\n        application: appManager.application,\r\n        onAppAdded: appManager.onAppAdded,\r\n        onAppRemoved: appManager.onAppRemoved,\r\n        onAppChanged: appManager.onAppChanged,\r\n        onAppAvailable: appManager.onAppAvailable,\r\n        onAppUnavailable: appManager.onAppUnavailable,\r\n        instances: appManager.instances,\r\n        get myInstance() {\r\n            return appManager.getMyInstance();\r\n        },\r\n        onInstanceStarted: appManager.onInstanceStarted,\r\n        onInstanceStopped: appManager.onInstanceStopped,\r\n        onInstanceUpdated: appManager.onInstanceUpdated,\r\n        onInstanceStartFailed: appManager.onInstanceStartFailed,\r\n        getRegion: entitlements.getRegion,\r\n        getBranches: entitlements.getBranches,\r\n        getCurrentBranch: entitlements.getCurrentBranch,\r\n        getFunctionalEntitlement: entitlements.getFunctionalEntitlement,\r\n        getFunctionalEntitlementBranch: entitlements.getFunctionalEntitlementBranch,\r\n        setCurrentBranch: entitlements.setCurrentBranch,\r\n        setRegion: entitlements.setRegion,\r\n        currentUser: entitlements.currentUser,\r\n        canI: entitlements.canI,\r\n        canIBranch: entitlements.canIBranch,\r\n        onBranchesChanged: entitlements.onBranchesChanged,\r\n        exit: entitlements.exit,\r\n        restart: entitlements.restart\r\n    };\r\n    return api;\r\n});\n\nvar WindowStore = (function () {\r\n    function WindowStore() {\r\n        this.waitForTimeoutInMilliseconds = 60000;\r\n        this._windows = {};\r\n        this._pendingWindows = {};\r\n        this._pendingWindowsStates = {};\r\n        this._registry = lib$2();\r\n    }\r\n    WindowStore.prototype.init = function (logger) {\r\n        this._logger = logger;\r\n    };\r\n    WindowStore.prototype.get = function (id) {\r\n        return this._windows[id] || this._pendingWindows[id];\r\n    };\r\n    WindowStore.prototype.getIfReady = function (id) {\r\n        return this._windows[id];\r\n    };\r\n    Object.defineProperty(WindowStore.prototype, \"list\", {\r\n        get: function () {\r\n            return this._windows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowStore.prototype.add = function (window) {\r\n        var isExist = this._pendingWindows[window.API.id] ? true : false;\r\n        if (isExist) {\r\n            this._logger.error(\"trying to add window with id \" + window.API.id + \" from windowStore, which already exists\");\r\n            return;\r\n        }\r\n        var remote = window.API.windowType === \"remote\";\r\n        this._pendingWindows[window.API.id] = window;\r\n        this._pendingWindowsStates[window.API.id] = {\r\n            ready: false,\r\n            urlChanged: remote,\r\n        };\r\n        this._registry.execute(\"on-added\", window);\r\n    };\r\n    WindowStore.prototype.remove = function (window) {\r\n        delete this._windows[window.API.id];\r\n        delete this._pendingWindows[window.API.id];\r\n        delete this._pendingWindowsStates[window.API.id];\r\n        this._registry.execute(\"on-removed\", window);\r\n    };\r\n    WindowStore.prototype.setReadyState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.ready = true;\r\n        if (targetWindowState.urlChanged) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.setUrlChangedState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.urlChanged = true;\r\n        if (targetWindowState.ready) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.waitFor = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var un;\r\n            var timeout = setTimeout(function () {\r\n                un();\r\n                reject(\"waitFor timed out.\");\r\n            }, _this.waitForTimeoutInMilliseconds);\r\n            var win = _this._windows[id];\r\n            if (win) {\r\n                clearTimeout(timeout);\r\n                resolve(win);\r\n            }\r\n            else {\r\n                un = _this.onReadyWindow(function (w) {\r\n                    if (w.API.id !== id) {\r\n                        return;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    un();\r\n                    resolve(w);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    WindowStore.prototype.onReadyWindow = function (callback) {\r\n        return this._registry.add(\"on-ready\", callback);\r\n    };\r\n    WindowStore.prototype.onAdded = function (callback) {\r\n        return this._registry.add(\"on-added\", callback);\r\n    };\r\n    WindowStore.prototype.onRemoved = function (callback) {\r\n        return this._registry.add(\"on-removed\", callback);\r\n    };\r\n    WindowStore.prototype.markReadyToShow = function (windowId) {\r\n        if (this._pendingWindows[windowId]) {\r\n            this._windows[windowId] = this._pendingWindows[windowId];\r\n            delete this._pendingWindows[windowId];\r\n            delete this._pendingWindowsStates[windowId];\r\n        }\r\n        this._registry.execute(\"on-ready\", this._windows[windowId]);\r\n    };\r\n    return WindowStore;\r\n}());\r\nvar windowStore = new WindowStore();\n\nvar Utils$1 = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.callbackifyPromise = function (action, successCallback, errorCallback) {\r\n        var fail = function (error) {\r\n            var msg = error;\r\n            if (error instanceof Error) {\r\n                msg = error.message;\r\n            }\r\n            if (typeof errorCallback === \"function\") {\r\n                errorCallback(msg);\r\n                return;\r\n            }\r\n            return Promise.reject(msg);\r\n        };\r\n        try {\r\n            return action()\r\n                .then(function (result) {\r\n                if (typeof successCallback === \"function\") {\r\n                    successCallback(result);\r\n                }\r\n                return result;\r\n            })\r\n                .catch(function (error) {\r\n                return fail(error);\r\n            });\r\n        }\r\n        catch (err) {\r\n            return fail(err);\r\n        }\r\n    };\r\n    Utils.getMonitor = function (bounds, displays) {\r\n        var _this = this;\r\n        var monitorsSortedByOverlap = displays.map(function (m) {\r\n            var left = m.left, top = m.top, width = m.workingAreaWidth, height = m.workingAreaHeight;\r\n            var overlap = _this.calculateTotalOverlap({ left: left, top: top, width: width, height: height }, bounds);\r\n            return {\r\n                monitor: m,\r\n                totalOverlap: overlap\r\n            };\r\n        }).sort(function (a, b) { return b.totalOverlap - a.totalOverlap; });\r\n        return monitorsSortedByOverlap[0].monitor;\r\n    };\r\n    Utils.getDisplayCenterOfScreen = function (a, display) {\r\n        var left = Math.floor(Math.max(display.left, (display.left + (display.workingAreaWidth - a.width) / 2)));\r\n        var top = Math.floor(Math.max(display.top, (display.top + (display.workingAreaHeight - a.height) / 2)));\r\n        return {\r\n            top: top,\r\n            left: left\r\n        };\r\n    };\r\n    Utils.calculateTotalOverlap = function (r1, r2) {\r\n        var r1x = r1.left;\r\n        var r1y = r1.top;\r\n        var r1xMax = r1x + r1.width;\r\n        var r1yMax = r1y + r1.height;\r\n        var r2x = r2.left;\r\n        var r2y = r2.top;\r\n        var r2xMax = r2x + r2.width;\r\n        var r2yMax = r2y + r2.height;\r\n        var xOverlap = Math.max(0, Math.min(r1xMax, r2xMax) - Math.max(r1x, r2x));\r\n        var yOverlap = Math.max(0, Math.min(r1yMax, r2yMax) - Math.max(r1y, r2y));\r\n        return xOverlap * yOverlap;\r\n    };\r\n    return Utils;\r\n}());\n\nvar windowFactory = (function (id, options, executor, logger, appManagerGetter, agm, registry) {\r\n    var _registry = (registry !== null && registry !== void 0 ? registry : lib$2());\r\n    var _logger = logger.subLogger(\"window \" + id);\r\n    var _name = options.name;\r\n    var _mode = options.mode;\r\n    var _url = options.url;\r\n    var _title = options.title;\r\n    var _context = options.context || {};\r\n    var _bounds = options.bounds;\r\n    var _frameColor = options.frameColor;\r\n    var _focus = options.focus;\r\n    var _neighbours = options.neighbours || {};\r\n    var _groupId = options.groupId;\r\n    var _isGroupHeaderVisible = options.isGroupHeaderVisible;\r\n    var _isTabHeaderVisible = options.isTabHeaderVisible;\r\n    var _isTabSelected = options.isTabSelected;\r\n    var _settings = options.settings;\r\n    var _isVisible = options.isVisible;\r\n    var isCollapsed = options.isCollapsed;\r\n    var _windowState = options.state;\r\n    var _tabGroupId = options.tabGroupId;\r\n    var _isLocked = options.isLocked;\r\n    var _group;\r\n    var resultWindow;\r\n    var _frameButtons = [];\r\n    var _zoomFactor = options.zoomFactor;\r\n    function close(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.close(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function navigate(newUrl, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.navigate(resultWindow, newUrl)\r\n                .then(function () {\r\n                if (newUrl === _url) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onUrlChanged(function (url, win) {\r\n                    if (win.id === id && url === win.url) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setStyle(style, success, error) {\r\n        if (!style || Object.keys(style).length === 0 || Object.keys(style).every(function (key) { return !key; })) {\r\n            var errMessage = \"Invalid style arguments: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        if (style && style.focus !== undefined) {\r\n            if (typeof style.focus !== \"boolean\") {\r\n                var errMessage = \"Focus must be boolean. Currently only focus true is supported ! \" + JSON.stringify(style);\r\n                error(errMessage);\r\n                return Promise.reject(new Error(errMessage));\r\n            }\r\n            else if (style.focus === false) {\r\n                _logger.warn(\"Focus false is not supported ! \");\r\n            }\r\n        }\r\n        if (style && style.hidden !== undefined && typeof style.hidden !== \"boolean\") {\r\n            var errMessage = \"Hidden must be boolean ! provided: \" + JSON.stringify(style);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setStyle(resultWindow, style); }, success, error);\r\n    }\r\n    function resetButtons(buttons, success, error) {\r\n        return Utils$1.callbackifyPromise(function () { return executor.resetButtons(resultWindow, buttons); }, success, error);\r\n    }\r\n    function setOnTop(onTop, success, error) {\r\n        if (this.onTop === onTop) {\r\n            var errMessage = \"OnTop setting is already set to '\" + onTop + \"'\";\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setOnTop(resultWindow, onTop); }, success, error);\r\n    }\r\n    function setSizeConstraints(constraints, success, error) {\r\n        if (!constraints || Object.keys(constraints).every(function (value) { return value === undefined; })) {\r\n            var errMessage = \"Invalid Constraints: \" + JSON.stringify(constraints);\r\n            error(errMessage);\r\n            return Promise.reject(new Error(errMessage));\r\n        }\r\n        return Utils$1.callbackifyPromise(function () { return executor.setSizeConstraints(resultWindow, constraints); }, success, error);\r\n    }\r\n    function setTitle(newTitle, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTitle(resultWindow, newTitle)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function moveResize(dimensions, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var resolveImmediately = areBoundsEqual(dimensions, _bounds);\r\n            var isDone = false;\r\n            var done = function () {\r\n                if (isDone) {\r\n                    return;\r\n                }\r\n                isDone = true;\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n                if (unsubscribeBoundsChanged) {\r\n                    unsubscribeBoundsChanged();\r\n                    unsubscribeBoundsChanged = undefined;\r\n                }\r\n                if (resolveTimeout) {\r\n                    clearTimeout(resolveTimeout);\r\n                    resolveTimeout = undefined;\r\n                }\r\n            };\r\n            var resolveTimeout;\r\n            var unsubscribeBoundsChanged;\r\n            if (!resolveImmediately) {\r\n                unsubscribeBoundsChanged = onBoundsChanged(function (win) {\r\n                    if (win.id !== resultWindow.id) {\r\n                        return;\r\n                    }\r\n                    if (!areBoundsEqual(dimensions, win.bounds)) {\r\n                        return;\r\n                    }\r\n                    done();\r\n                });\r\n            }\r\n            executor.moveResize(resultWindow, dimensions)\r\n                .then(function () {\r\n                if (resolveImmediately) {\r\n                    done();\r\n                    return;\r\n                }\r\n                resolveTimeout = setTimeout(function () {\r\n                    done();\r\n                }, 1000);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function addFrameButton(buttonInfo, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof buttonInfo === \"undefined\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No button info\");\r\n                    return;\r\n                }\r\n                reject(\"No button info\");\r\n                return;\r\n            }\r\n            if (buttonInfo.buttonId === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            if (buttonInfo.imageBase64 === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No imageBase64\");\r\n                    return;\r\n                }\r\n                reject(\"No imageBase64\");\r\n                return;\r\n            }\r\n            executor.addFrameButton(resultWindow, buttonInfo)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function removeFrameButton(buttonId, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (buttonId === undefined || buttonId === \"\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            executor.removeFrameButton(resultWindow, buttonId)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function activate(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.activate(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function focus(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.focus(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximizeRestore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = _windowState === \"normal\" ? onMaximized : onNormal;\r\n            executor.maximizeRestore(resultWindow)\r\n                .then(function () {\r\n                var un = currEvent(function () {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    if (un) {\r\n                        un();\r\n                    }\r\n                    resolve(resultWindow);\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.maximize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"maximized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMaximized(function (win) {\r\n                    if (win.id === id && win.state === \"maximized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function restore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.restore(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"normal\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onNormal(function (win) {\r\n                    if (id === win.id && win.state === \"normal\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function minimize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.minimize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"minimized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMinimized(function (win) {\r\n                    if (id === win.id && win.state === \"minimized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        return resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function collapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.collapse(resultWindow)\r\n                .then(function () {\r\n                if (isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onCollapsed(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function expand(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (!isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.expand(resultWindow)\r\n                .then(function () {\r\n                if (!isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onExpanded(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function toggleCollapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = isCollapsed ? onExpanded : onCollapsed;\r\n            executor.toggleCollapse(resultWindow)\r\n                .then(function () {\r\n                currEvent(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function snap(target, direction, success, error) {\r\n        var targetWindowGroup;\r\n        if (!target) {\r\n            return Promise.reject(\"Please specify a target window! calledWith: \" + target);\r\n        }\r\n        if (typeof target === \"string\") {\r\n            var targetWindow = windowStore.get(target);\r\n            if (!targetWindow) {\r\n                return Promise.reject(new Error(\"Invalid target parameter or no such window. Invoked with:  \" + target));\r\n            }\r\n            targetWindowGroup = targetWindow.API.group;\r\n        }\r\n        else {\r\n            targetWindowGroup = target.group;\r\n        }\r\n        return Promise.all([\r\n            waitForMyWindowToJoinTargetGroup(targetWindowGroup),\r\n            executor.snap(resultWindow, target, direction)\r\n        ])\r\n            .then(function () {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return resultWindow;\r\n        })\r\n            .catch(function (e) {\r\n            if (typeof error === \"function\") {\r\n                error(e);\r\n            }\r\n            return e;\r\n        });\r\n    }\r\n    function waitForMyWindowToJoinTargetGroup(targetGroup) {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = targetGroup.onWindowAdded(function (_, window) {\r\n                if (resultWindow.id === window.id) {\r\n                    unsub();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function attachTab(tab, index, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId;\r\n            var targetWindowId = resultWindow.id;\r\n            var errorMessage = \"Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!tab) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof tab === \"string\") {\r\n                sourceWindowId = tab;\r\n            }\r\n            else if (typeof tab.id !== \"undefined\") {\r\n                sourceWindowId = tab.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var argsForSend = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (index) {\r\n                argsForSend.index = index;\r\n            }\r\n            var sourceWin = windowStore.get(argsForSend.sourceWindowId).API;\r\n            var un = sourceWin.onAttached(function (win) {\r\n                if (win.id === sourceWin.id) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    un();\r\n                    resolve(resultWindow);\r\n                }\r\n            });\r\n            executor.attachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                un();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function detachTab(opt, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var argsForSend = { windowId: resultWindow.id };\r\n            var _options = opt || {};\r\n            if (typeof _options.relativeTo !== \"undefined\") {\r\n                if (typeof _options.relativeTo === \"string\") {\r\n                    argsForSend.relativeTo = _options.relativeTo;\r\n                }\r\n                else if (typeof _options.relativeTo.id !== \"undefined\") {\r\n                    argsForSend.relativeTo = _options.relativeTo.id;\r\n                }\r\n                if (typeof _options.relativeDirection !== \"undefined\") {\r\n                    argsForSend.relativeDirection = _options.relativeDirection;\r\n                }\r\n                if (typeof _options.width !== \"undefined\") {\r\n                    argsForSend.width = _options.width;\r\n                }\r\n                if (typeof _options.height !== \"undefined\") {\r\n                    argsForSend.height = _options.height;\r\n                }\r\n            }\r\n            if (typeof _options.bounds !== \"undefined\") {\r\n                argsForSend.bounds = _options.bounds;\r\n            }\r\n            if (typeof _options.hideTabHeader !== \"undefined\") {\r\n                argsForSend.hideTabHeader = _options.hideTabHeader;\r\n            }\r\n            var visibilityChangeHeard = false;\r\n            var detachedHeard = false;\r\n            var unVisibility = _registry.add(\"frame-attached\", (function (win) {\r\n                var isVisibilityCorrect = _options.hideTabHeader === undefined || _options.hideTabHeader !== win.isTabHeaderVisible;\r\n                if (id === win.id && isVisibilityCorrect) {\r\n                    visibilityChangeHeard = true;\r\n                    unVisibility();\r\n                    if (detachedHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unDetached === \"function\") {\r\n                            unDetached();\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n            var unDetached = onDetached(function (win) {\r\n                if (id === win.id) {\r\n                    detachedHeard = true;\r\n                    unDetached();\r\n                    if (visibilityChangeHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unVisibility === \"function\") {\r\n                            unVisibility();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            executor.detachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                unDetached();\r\n                unVisibility();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setVisible(toBeVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setVisible(resultWindow, toBeVisible)\r\n                .then(function () {\r\n                var isVisibilityCorrect = toBeVisible === undefined ? _isVisible === true : _isVisible === toBeVisible;\r\n                if (isVisibilityCorrect) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onVisibilityChanged(function (win) {\r\n                    isVisibilityCorrect = toBeVisible === undefined ? win.isVisible === true : win.isVisible === toBeVisible;\r\n                    if (win.id === id && isVisibilityCorrect) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function showLoader(loader) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.showLoader(resultWindow, loader)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideLoader() {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.hideLoader(resultWindow)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function updateContext(context, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.updateContext(resultWindow, context)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function lock(success, error) {\r\n        if (resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.lock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function unlock(success, error) {\r\n        if (!resultWindow.isLocked) {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n            return Promise.resolve(resultWindow);\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            executor.unlock(resultWindow)\r\n                .then(function () { return waitForLockingChanged(); })\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function waitForLockingChanged() {\r\n        return new Promise(function (resolve) {\r\n            var un = onLockingChanged(function (window) {\r\n                if (window.id === resultWindow.id) {\r\n                    un();\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function getIcon(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.getIcon(resultWindow)\r\n                .then(function (icon) {\r\n                if (typeof success === \"function\") {\r\n                    success(icon);\r\n                }\r\n                resolve(icon);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setIcon(base64Image, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setIcon(resultWindow, base64Image)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setFrameColor(frameColor, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setFrameColor(resultWindow, frameColor)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabHeaderVisible(toBeTabHeaderVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTabHeaderVisible(resultWindow, toBeTabHeaderVisible)\r\n                .then(function () {\r\n                if (_isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onTabHeaderVisibilityChanged(function (win) {\r\n                    if (win.id === id && win.isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabTooltip(tooltip) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!tooltip) {\r\n                    throw new Error(tooltip + \" is null or undefined\");\r\n                }\r\n                return [2, executor.setTabTooltip(resultWindow, tooltip)];\r\n            });\r\n        });\r\n    }\r\n    function showPopup(config) {\r\n        return executor.showPopup(resultWindow, config);\r\n    }\r\n    function createFlydown(config) {\r\n        return executor.createFlydown(resultWindow.id, config);\r\n    }\r\n    function setModalState(isModal) {\r\n        return executor.setModalState(resultWindow.id, isModal || false);\r\n    }\r\n    function zoomIn(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomIn(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function zoomOut(success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            return executor.zoomOut(resultWindow);\r\n        }, success, error);\r\n    }\r\n    function setZoomFactor(zoomFactor, success, error) {\r\n        return Utils$1.callbackifyPromise(function () {\r\n            if (isNaN(zoomFactor)) {\r\n                throw new Error(\"zoomFactor is not a number\");\r\n            }\r\n            return executor.setZoomFactor(resultWindow, zoomFactor);\r\n        }, success, error);\r\n    }\r\n    function showDevTools() {\r\n        return executor.showDevTools(resultWindow);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.capture(resultWindow, captureOptions);\r\n    }\r\n    function flash(suppliedOptions) {\r\n        var flashOptions = {\r\n            shouldFlash: true\r\n        };\r\n        if (typeof suppliedOptions === \"boolean\") {\r\n            flashOptions.shouldFlash = suppliedOptions;\r\n        }\r\n        return executor.flash(resultWindow, flashOptions);\r\n    }\r\n    function onTitleChanged(callback) {\r\n        callback(resultWindow.title, resultWindow);\r\n        return _registry.add(\"onTitleChanged\", callback);\r\n    }\r\n    function onClose(callback) {\r\n        return _registry.add(\"onClose\", callback);\r\n    }\r\n    function onUrlChanged(callback) {\r\n        return _registry.add(\"onUrlChanged\", callback);\r\n    }\r\n    function onFrameButtonAdded(callback) {\r\n        return _registry.add(\"onFrameButtonAdded\", callback);\r\n    }\r\n    function onFrameButtonRemoved(callback) {\r\n        return _registry.add(\"onFrameButtonRemoved\", callback);\r\n    }\r\n    function onFrameButtonClicked(callback) {\r\n        return _registry.add(\"onFrameButtonClicked\", callback);\r\n    }\r\n    function onCollapsed(callback) {\r\n        if (isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"collapsed\", callback);\r\n    }\r\n    function onExpanded(callback) {\r\n        if (!isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"expanded\", callback);\r\n    }\r\n    function onMaximized(callback) {\r\n        if (_windowState === \"maximized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"maximized\", callback);\r\n    }\r\n    function onMinimized(callback) {\r\n        if (_windowState === \"minimized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"minimized\", callback);\r\n    }\r\n    function onNormal(callback) {\r\n        if (_windowState === \"normal\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"normal\", callback);\r\n    }\r\n    function onAttached(callback) {\r\n        return _registry.add(\"attached\", callback);\r\n    }\r\n    function onDetached(callback) {\r\n        return _registry.add(\"detached\", callback);\r\n    }\r\n    function onVisibilityChanged(callback) {\r\n        return _registry.add(\"visibility-changed\", callback);\r\n    }\r\n    function onContextUpdated(callback) {\r\n        return _registry.add(\"context-updated\", callback);\r\n    }\r\n    function onLockingChanged(callback) {\r\n        return _registry.add(\"lock-changed\", callback);\r\n    }\r\n    function onBoundsChanged(callback) {\r\n        return _registry.add(\"bounds-changed\", callback);\r\n    }\r\n    function onFocusChanged(callback) {\r\n        return _registry.add(\"focus-changed\", callback);\r\n    }\r\n    function onFrameColorChanged(callback) {\r\n        return _registry.add(\"frame-color-changed\", callback);\r\n    }\r\n    function onTabHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"tab-header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAttached(callback) {\r\n        return _registry.add(\"window-attached\", callback);\r\n    }\r\n    function onWindowDetached(callback) {\r\n        return _registry.add(\"window-detached\", callback);\r\n    }\r\n    function onGroupChanged(callback) {\r\n        return _registry.add(\"group-changed\", callback);\r\n    }\r\n    function onTabSelectionChanged(callback) {\r\n        return _registry.add(\"tab-selection-changed\", callback);\r\n    }\r\n    function onClosing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error) {\r\n            var promise = callback();\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onClosing(callbackWrap, id);\r\n    }\r\n    function onRefreshing(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        var callbackWrap = function (success, error, prevent) {\r\n            var promise = callback(prevent);\r\n            if (promise && promise.then) {\r\n                promise.then(success).catch(error);\r\n            }\r\n            else {\r\n                success();\r\n            }\r\n        };\r\n        return executor.onRefreshing(callbackWrap, id);\r\n    }\r\n    function onZoomFactorChanged(callback) {\r\n        if (!isFunction(callback)) {\r\n            throw new Error(\"callback should be a function\");\r\n        }\r\n        return _registry.add(\"zoom-factor-changed\", callback);\r\n    }\r\n    function handleTitleChanged(newTitle) {\r\n        _title = newTitle;\r\n        _registry.execute(\"onTitleChanged\", newTitle, resultWindow);\r\n    }\r\n    function handleUrlChanged(newUrl) {\r\n        _url = newUrl;\r\n        _registry.execute(\"onUrlChanged\", newUrl, resultWindow);\r\n    }\r\n    function handleVisibilityChanged(isVisible) {\r\n        if (isVisible === _isVisible) {\r\n            return;\r\n        }\r\n        _isVisible = isVisible;\r\n        _registry.execute(\"visibility-changed\", resultWindow);\r\n    }\r\n    function handleWindowSettingsChanged(settings) {\r\n        _settings = settings;\r\n        _registry.execute(\"settings-changed\", resultWindow);\r\n    }\r\n    function handleContextUpdated(context) {\r\n        _context = context;\r\n        _registry.execute(\"context-updated\", _context, resultWindow);\r\n    }\r\n    function handleWindowClose() {\r\n        if (resultWindow.id === undefined) {\r\n            return;\r\n        }\r\n        resultWindow.id = undefined;\r\n        _registry.execute(\"onClose\", resultWindow);\r\n    }\r\n    function handleFrameButtonAdded(frameButton) {\r\n        var buttonObj = [\"buttonId\", \"imageBase64\", \"order\", \"tooltip\"].reduce(function (memo, k) {\r\n            memo[k] = frameButton[k];\r\n            return memo;\r\n        }, {});\r\n        var frameButtonsIds = _frameButtons.map(function (btn) {\r\n            return btn.buttonId;\r\n        });\r\n        if (frameButtonsIds.indexOf(frameButton.buttonId) === -1) {\r\n            _frameButtons.push(buttonObj);\r\n        }\r\n        _registry.execute(\"onFrameButtonAdded\", buttonObj, resultWindow);\r\n    }\r\n    function handleFrameButtonRemoved(frameButtonId) {\r\n        var button;\r\n        _frameButtons = _frameButtons.reduce(function (memo, btn) {\r\n            if (btn.buttonId === frameButtonId) {\r\n                button = btn;\r\n            }\r\n            else {\r\n                memo.push(btn);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (button !== undefined) {\r\n            _registry.execute(\"onFrameButtonRemoved\", button, resultWindow);\r\n        }\r\n    }\r\n    function handleFrameButtonClicked(frameButton) {\r\n        var button = _frameButtons.filter(function (btn) {\r\n            return btn.buttonId === frameButton.buttonId;\r\n        });\r\n        if (button.length > 0) {\r\n            _registry.execute(\"onFrameButtonClicked\", button[0], resultWindow);\r\n        }\r\n    }\r\n    function handleWindowChangeState(state) {\r\n        if (state === \"collapsed\") {\r\n            isCollapsed = true;\r\n        }\r\n        else if (state === \"expanded\") {\r\n            isCollapsed = false;\r\n        }\r\n        else {\r\n            _windowState = state;\r\n        }\r\n        _registry.execute(state, resultWindow);\r\n    }\r\n    function handleFrameIsLockedChanged(isLocked) {\r\n        _isLocked = isLocked;\r\n        _registry.execute(\"lock-changed\", resultWindow);\r\n    }\r\n    function handleBoundsChanged(bounds) {\r\n        if (_bounds.top === bounds.top && _bounds.left === bounds.left && _bounds.width === bounds.width && _bounds.height === bounds.height) {\r\n            return;\r\n        }\r\n        _bounds.top = bounds.top;\r\n        _bounds.left = bounds.left;\r\n        _bounds.width = bounds.width;\r\n        _bounds.height = bounds.height;\r\n        _registry.execute(\"bounds-changed\", resultWindow);\r\n    }\r\n    function handleFocusChanged(isFocused) {\r\n        _focus = isFocused;\r\n        _registry.execute(\"focus-changed\", resultWindow);\r\n    }\r\n    function handleFrameColorChanged(frameColor) {\r\n        _frameColor = frameColor;\r\n        _registry.execute(\"frame-color-changed\", resultWindow);\r\n    }\r\n    function handleFrameAttached(tabGroupId, isTabHeaderVisible) {\r\n        _tabGroupId = tabGroupId;\r\n        _isTabHeaderVisible = isTabHeaderVisible;\r\n        _registry.execute(\"frame-attached\", resultWindow);\r\n    }\r\n    function handleCompositionChanged(neighbours, groupId) {\r\n        _neighbours = neighbours || {};\r\n        _groupId = groupId;\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(isGroupHeaderVisible) {\r\n        _isGroupHeaderVisible = isGroupHeaderVisible;\r\n    }\r\n    function handleTabHeaderVisibilityChanged(isTabHeaderVisible) {\r\n        if (_isTabHeaderVisible !== isTabHeaderVisible) {\r\n            _isTabHeaderVisible = isTabHeaderVisible;\r\n            _registry.execute(\"tab-header-visibility-changed\", resultWindow);\r\n        }\r\n    }\r\n    function handleFrameSelectionChanged(newWindow, prevWindow) {\r\n        var selectedWindow;\r\n        if (typeof newWindow !== \"undefined\" && newWindow === id) {\r\n            _isTabSelected = true;\r\n            selectedWindow = resultWindow;\r\n        }\r\n        else {\r\n            _isTabSelected = false;\r\n            selectedWindow = windowStore.get(newWindow) ? windowStore.get(newWindow).API : undefined;\r\n        }\r\n        var previousWindow = windowStore.get(prevWindow) ? windowStore.get(prevWindow).API : undefined;\r\n        if (_isTabSelected && previousWindow) {\r\n            var un_1 = previousWindow.onTabSelectionChanged(function (newWin, prevWin) {\r\n                if ((prevWin && prevWin.id) === previousWindow.id) {\r\n                    un_1();\r\n                    _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n        }\r\n    }\r\n    function handleAttached(newTabGroupId, tabHeaderVisible) {\r\n        _tabGroupId = newTabGroupId;\r\n        _isTabHeaderVisible = tabHeaderVisible;\r\n        _registry.execute(\"attached\", resultWindow);\r\n    }\r\n    function handleWindowAttached(win) {\r\n        _registry.execute(\"window-attached\", win);\r\n    }\r\n    function handleDetached(tabGroupId) {\r\n        _tabGroupId = tabGroupId;\r\n        var un = _registry.add(\"frame-attached\", function (win) {\r\n            if (win.id === id) {\r\n                un();\r\n                _registry.execute(\"detached\", resultWindow);\r\n            }\r\n        });\r\n    }\r\n    function handleWindowDetached(win) {\r\n        _registry.execute(\"window-detached\", win);\r\n    }\r\n    function handleZoomFactorChanged(zoomFactor) {\r\n        _zoomFactor = zoomFactor;\r\n        _registry.execute(\"zoom-factor-changed\", resultWindow);\r\n    }\r\n    function handleGroupChanged(newGroup, oldGroup) {\r\n        _logger.trace(\"handle group changed to win: \" + id + \" with group id: \" + newGroup.id);\r\n        _group = newGroup;\r\n        _groupId = newGroup.id;\r\n        _registry.execute(\"group-changed\", resultWindow, newGroup, oldGroup);\r\n    }\r\n    function handleGroupAssociation(group) {\r\n        if (group) {\r\n            _logger.trace(\"setting group to win: \" + id + \" with group id: \" + group.id);\r\n        }\r\n        _group = group;\r\n    }\r\n    function getAllTabs() {\r\n        var allWindows = windowStore.list;\r\n        if (_mode.toLowerCase() !== \"tab\") {\r\n            return [];\r\n        }\r\n        return Object.keys(allWindows).reduce(function (memo, win) {\r\n            var window = allWindows[win];\r\n            if (window\r\n                && window.API.tabGroupId\r\n                && typeof window.API.tabGroupId !== \"undefined\"\r\n                && typeof resultWindow.tabGroupId !== \"undefined\"\r\n                && window.API.tabGroupId === resultWindow.tabGroupId) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function mapWindowIdsToWindowObjects(windowIdArr) {\r\n        return windowIdArr.reduce(function (memo, winId) {\r\n            var window = windowStore.get(winId);\r\n            if (window) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function getNeighboursByDirection(direction) {\r\n        var windowIds = _neighbours[direction];\r\n        if (typeof windowIds !== \"undefined\") {\r\n            return mapWindowIdsToWindowObjects(windowIds);\r\n        }\r\n    }\r\n    function getApplicationName() {\r\n        if (_context._APPLICATION_NAME) {\r\n            return _context._APPLICATION_NAME;\r\n        }\r\n        if (_context && _context._t42 && _context._t42.application) {\r\n            return _context._t42.application;\r\n        }\r\n        var info = getWindowInfo();\r\n        if (!info) {\r\n            return undefined;\r\n        }\r\n        return info.applicationName;\r\n    }\r\n    function getWindowInfo() {\r\n        if (typeof window.glue42gd !== \"undefined\" && window.glue42gd.getWindowInfo) {\r\n            var info = window.glue42gd.getWindowInfo(id);\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return info;\r\n            }\r\n        }\r\n    }\r\n    function areBoundsEqual(requested, current) {\r\n        var height = requested.height;\r\n        var width = requested.width;\r\n        if (requested.height < _settings.minHeight) {\r\n            height = _settings.minHeight;\r\n        }\r\n        if (requested.height > _settings.maxHeight) {\r\n            height = _settings.maxHeight;\r\n        }\r\n        if (requested.width < _settings.minWidth) {\r\n            width = _settings.minWidth;\r\n        }\r\n        if (requested.width > _settings.maxWidth) {\r\n            width = _settings.maxWidth;\r\n        }\r\n        var areHeightsEqual = height ? current.height === height : true;\r\n        var areWidthsEqual = width ? current.width === width : true;\r\n        var areLeftsEqual = requested.left ? current.left === requested.left : true;\r\n        var areTopsEqual = requested.top ? current.top === requested.top : true;\r\n        return areHeightsEqual && areWidthsEqual && areLeftsEqual && areTopsEqual;\r\n    }\r\n    resultWindow = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get application() {\r\n            var appManager = appManagerGetter();\r\n            return appManager ? appManager.application(getApplicationName()) : undefined;\r\n        },\r\n        get hostInstance() {\r\n            return executor.hostInstance;\r\n        },\r\n        get agmInstance() {\r\n            var _this = this;\r\n            if (window.glue42gd) {\r\n                return agm.servers().find(function (s) { return s.windowId === _this.id; });\r\n            }\r\n            var appName = getApplicationName();\r\n            return appName ? { application: appName } : undefined;\r\n        },\r\n        get url() {\r\n            return _url;\r\n        },\r\n        id: id,\r\n        get title() {\r\n            return _title;\r\n        },\r\n        get windowStyleAttributes() {\r\n            return _settings;\r\n        },\r\n        get settings() {\r\n            return _settings;\r\n        },\r\n        get tabGroupId() {\r\n            return _mode.toLowerCase() === \"tab\" ? _tabGroupId : undefined;\r\n        },\r\n        get frameButtons() {\r\n            return _frameButtons;\r\n        },\r\n        get mode() {\r\n            return _mode;\r\n        },\r\n        get state() {\r\n            return _windowState;\r\n        },\r\n        get isCollapsed() {\r\n            return isCollapsed;\r\n        },\r\n        get isVisible() {\r\n            return _isVisible;\r\n        },\r\n        get isLocked() {\r\n            return _isLocked;\r\n        },\r\n        get context() {\r\n            return _context;\r\n        },\r\n        get bounds() {\r\n            return _bounds;\r\n        },\r\n        get minHeight() {\r\n            return _settings.minHeight;\r\n        },\r\n        get maxHeight() {\r\n            return _settings.maxHeight;\r\n        },\r\n        get minWidth() {\r\n            return _settings.minWidth;\r\n        },\r\n        get maxWidth() {\r\n            return _settings.maxWidth;\r\n        },\r\n        get isFocused() {\r\n            return _focus;\r\n        },\r\n        get frameColor() {\r\n            return _frameColor;\r\n        },\r\n        get opened() {\r\n            return resultWindow.id !== undefined;\r\n        },\r\n        get group() {\r\n            return _group;\r\n        },\r\n        get groupId() {\r\n            return _groupId;\r\n        },\r\n        get topNeighbours() {\r\n            return getNeighboursByDirection(\"top\");\r\n        },\r\n        get leftNeighbours() {\r\n            return getNeighboursByDirection(\"left\");\r\n        },\r\n        get rightNeighbours() {\r\n            return getNeighboursByDirection(\"right\");\r\n        },\r\n        get bottomNeighbours() {\r\n            return getNeighboursByDirection(\"bottom\");\r\n        },\r\n        get isGroupHeaderVisible() {\r\n            return _isGroupHeaderVisible;\r\n        },\r\n        get activityId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityId;\r\n        },\r\n        get activityWindowId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityWindowId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityWindowId;\r\n        },\r\n        get windowType() {\r\n            return options.windowType || \"electron\";\r\n        },\r\n        get zoomFactor() {\r\n            return _zoomFactor;\r\n        },\r\n        get screen() {\r\n            return Utils$1.getMonitor(resultWindow.bounds, window.glue42gd.monitors);\r\n        },\r\n        maximize: maximize,\r\n        restore: restore,\r\n        minimize: minimize,\r\n        maximizeRestore: maximizeRestore,\r\n        collapse: collapse,\r\n        expand: expand,\r\n        toggleCollapse: toggleCollapse,\r\n        focus: focus,\r\n        activate: activate,\r\n        moveResize: moveResize,\r\n        setTitle: setTitle,\r\n        setStyle: setStyle,\r\n        setOnTop: setOnTop,\r\n        resetButtons: resetButtons,\r\n        setSizeConstraints: setSizeConstraints,\r\n        navigate: navigate,\r\n        addFrameButton: addFrameButton,\r\n        removeFrameButton: removeFrameButton,\r\n        setVisible: setVisible,\r\n        show: function () { return setVisible(true); },\r\n        hide: function () { return setVisible(false); },\r\n        center: function (screen) { return moveResize(Utils$1.getDisplayCenterOfScreen(resultWindow.bounds, screen || resultWindow.screen)); },\r\n        close: close,\r\n        snap: snap,\r\n        showLoader: showLoader,\r\n        hideLoader: hideLoader,\r\n        updateContext: updateContext,\r\n        lock: lock,\r\n        unlock: unlock,\r\n        getIcon: getIcon,\r\n        setIcon: setIcon,\r\n        setFrameColor: setFrameColor,\r\n        setTabTooltip: setTabTooltip,\r\n        attachTab: attachTab,\r\n        detachTab: detachTab,\r\n        setTabHeaderVisible: setTabHeaderVisible,\r\n        showPopup: showPopup,\r\n        createFlydown: createFlydown,\r\n        setModalState: setModalState,\r\n        setZoomFactor: setZoomFactor,\r\n        zoomIn: zoomIn,\r\n        zoomOut: zoomOut,\r\n        showDevTools: showDevTools,\r\n        capture: capture,\r\n        flash: flash,\r\n        onClose: onClose,\r\n        onUrlChanged: onUrlChanged,\r\n        onTitleChanged: onTitleChanged,\r\n        onFrameButtonAdded: onFrameButtonAdded,\r\n        onFrameButtonRemoved: onFrameButtonRemoved,\r\n        onFrameButtonClicked: onFrameButtonClicked,\r\n        onCollapsed: onCollapsed,\r\n        onExpanded: onExpanded,\r\n        onMinimized: onMinimized,\r\n        onMaximized: onMaximized,\r\n        onNormal: onNormal,\r\n        onAttached: onAttached,\r\n        onDetached: onDetached,\r\n        onVisibilityChanged: onVisibilityChanged,\r\n        onContextUpdated: onContextUpdated,\r\n        onLockingChanged: onLockingChanged,\r\n        onBoundsChanged: onBoundsChanged,\r\n        onFrameColorChanged: onFrameColorChanged,\r\n        onFocusChanged: onFocusChanged,\r\n        onGroupChanged: onGroupChanged,\r\n        onWindowAttached: onWindowAttached,\r\n        onWindowDetached: onWindowDetached,\r\n        onTabSelectionChanged: onTabSelectionChanged,\r\n        onTabHeaderVisibilityChanged: onTabHeaderVisibilityChanged,\r\n        onClosing: onClosing,\r\n        onRefreshing: onRefreshing,\r\n        onZoomFactorChanged: onZoomFactorChanged,\r\n        get tabs() {\r\n            return getAllTabs();\r\n        },\r\n        get isTabHeaderVisible() {\r\n            return _isTabHeaderVisible;\r\n        },\r\n        get isTabSelected() {\r\n            return _isTabSelected;\r\n        },\r\n        getURL: function () {\r\n            return Promise.resolve(_url);\r\n        },\r\n        getTitle: function () {\r\n            return Promise.resolve(_title);\r\n        },\r\n        getBounds: function () {\r\n            return Promise.resolve(_bounds);\r\n        },\r\n        getContext: function () {\r\n            return Promise.resolve(_context);\r\n        },\r\n        setContext: function (context) {\r\n            return updateContext(context);\r\n        },\r\n        resizeTo: function (width, height) {\r\n            return moveResize({ width: width, height: height });\r\n        },\r\n        moveTo: function (top, left) {\r\n            return moveResize({ top: top, left: left });\r\n        },\r\n        getParentWindow: function () {\r\n            var _a;\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var myParentId;\r\n                return __generator(this, function (_b) {\r\n                    myParentId = _settings.parentInstanceId;\r\n                    if (!myParentId) {\r\n                        return [2, undefined];\r\n                    }\r\n                    return [2, (_a = windowStore.list[myParentId]) === null || _a === void 0 ? void 0 : _a.API];\r\n                });\r\n            });\r\n        },\r\n        getChildWindows: function () {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    return [2, Object.keys(windowStore.list)\r\n                            .map(function (key) { return windowStore.list[key].API; })\r\n                            .filter(function (w) {\r\n                            var parentId = w.settings.parentInstanceId;\r\n                            return parentId === id;\r\n                        })];\r\n                });\r\n            });\r\n        }\r\n    };\r\n    var events = {\r\n        handleWindowClose: handleWindowClose,\r\n        handleWindowChangeState: handleWindowChangeState,\r\n        handleTitleChanged: handleTitleChanged,\r\n        handleVisibilityChanged: handleVisibilityChanged,\r\n        handleUrlChanged: handleUrlChanged,\r\n        handleWindowSettingsChanged: handleWindowSettingsChanged,\r\n        handleContextUpdated: handleContextUpdated,\r\n        handleFrameIsLockedChanged: handleFrameIsLockedChanged,\r\n        handleBoundsChanged: handleBoundsChanged,\r\n        handleFocusChanged: handleFocusChanged,\r\n        handleFrameButtonAdded: handleFrameButtonAdded,\r\n        handleFrameButtonRemoved: handleFrameButtonRemoved,\r\n        handleFrameButtonClicked: handleFrameButtonClicked,\r\n        handleFrameColorChanged: handleFrameColorChanged,\r\n        handleFrameAttached: handleFrameAttached,\r\n        handleFrameSelectionChanged: handleFrameSelectionChanged,\r\n        handleCompositionChanged: handleCompositionChanged,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n        handleTabHeaderVisibilityChanged: handleTabHeaderVisibilityChanged,\r\n        handleGroupChanged: handleGroupChanged,\r\n        handleGroupAssociation: handleGroupAssociation,\r\n        handleAttached: handleAttached,\r\n        handleDetached: handleDetached,\r\n        handleWindowAttached: handleWindowAttached,\r\n        handleWindowDetached: handleWindowDetached,\r\n        handleZoomFactorChanged: handleZoomFactorChanged\r\n    };\r\n    return {\r\n        API: resultWindow,\r\n        Events: events,\r\n        Registry: _registry\r\n    };\r\n});\n\nvar GDExecutor = (function () {\r\n    function GDExecutor() {\r\n        this._registry = lib$2();\r\n    }\r\n    Object.defineProperty(GDExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    GDExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"close\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"navigate\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    url: newUrl\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var stylePromises, wait, toBeVisible, toolTip, maxWidth, maxHeight, minWidth, minHeight, allowClose, allowCollapse, allowLockUnlock, allowMaximize, allowMinimize;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        stylePromises = [];\r\n                        wait = function (promise) { return stylePromises.push(promise); };\r\n                        if (style.focus !== undefined && !resultWindow.isFocused) {\r\n                            wait(resultWindow.focus());\r\n                        }\r\n                        if (style.hidden !== undefined) {\r\n                            toBeVisible = !style.hidden;\r\n                            wait(resultWindow.setVisible(toBeVisible));\r\n                        }\r\n                        if (style.onTop !== undefined) {\r\n                            wait(resultWindow.setOnTop(style.onTop));\r\n                        }\r\n                        if (style.tabTooltip !== undefined || style.tabToolTip !== undefined) {\r\n                            toolTip = (_a = style.tabTooltip, (_a !== null && _a !== void 0 ? _a : style.tabToolTip));\r\n                            wait(resultWindow.setTabTooltip(toolTip));\r\n                        }\r\n                        maxWidth = style.maxWidth, maxHeight = style.maxHeight, minWidth = style.minWidth, minHeight = style.minHeight, allowClose = style.allowClose, allowCollapse = style.allowCollapse, allowLockUnlock = style.allowLockUnlock, allowMaximize = style.allowMaximize, allowMinimize = style.allowMinimize;\r\n                        wait(resultWindow.setSizeConstraints({ maxWidth: maxWidth, maxHeight: maxHeight, minWidth: minWidth, minHeight: minHeight }));\r\n                        wait(resultWindow.resetButtons({ allowClose: allowClose, allowCollapse: allowCollapse, allowLockUnlock: allowLockUnlock, allowMaximize: allowMaximize, allowMinimize: allowMinimize }));\r\n                        return [4, Promise.all(stylePromises)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setSizeConstraints = function (resultWindow, constraints) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setSizeConstraints\", {\r\n                windowId: resultWindow.id,\r\n                options: constraints\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabTooltip = function (w, tabToolTip) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setTabTooltip\", { windowId: w.id, options: { tabToolTip: tabToolTip } })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, w];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.resetButtons = function (resultWindow, buttonsConfig) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"resetButtons\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonsConfig\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setOnTop = function (resultWindow, onTop) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setOnTop\", {\r\n                windowId: resultWindow.id,\r\n                options: { onTop: onTop }\r\n            }).then(function () {\r\n                resolve(resultWindow);\r\n            }).catch(reject);\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    title: newTitle\r\n                }\r\n            };\r\n            _this.execute(\"setTitle\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"moveResize\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    bounds: dimensions\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"addButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonInfo\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"removeButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonId\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"activate\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"focus\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximizeRestore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"restore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"minimize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"collapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"expand\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"toggleCollapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" +\r\n                resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                targetWindowId: targetWindowId\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            _this.execute(\"snap\", {\r\n                windowId: resultWindow.id,\r\n                options: args\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.attachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"attachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.detachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"detachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        if (toBeVisible === void 0) { toBeVisible = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            var command;\r\n            if (toBeVisible) {\r\n                command = \"show\";\r\n            }\r\n            else {\r\n                command = \"hide\";\r\n            }\r\n            _this.execute(command, { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"showLoadingAnimation\", { windowId: resultWindow.id, options: loader })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"hideLoadingAnimation\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"updateContext\", {\r\n                windowId: resultWindow.id,\r\n                context: context,\r\n                replace: Object.keys(resultWindow.context).length > 0 ? false : true\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: true\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    lock: false\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"getIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {}\r\n            })\r\n                .then(function (result) {\r\n                resolve(result.icon);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    dataURL: base64Image\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setFrameColor\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    frameColor: frameColor\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setTabHeaderVisible\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    toShow: toBeTabHeaderVisible\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showPopup = function (targetWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var optionsCopy, reformatedOptions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            return [2, Promise.reject(\"The options object is not valid!\")];\r\n                        }\r\n                        optionsCopy = __assign({}, options);\r\n                        if (!optionsCopy.targetLocation) {\r\n                            optionsCopy.targetLocation = \"bottom\";\r\n                        }\r\n                        reformatedOptions = __assign(__assign({}, optionsCopy), { popupBounds: optionsCopy.size, targetId: targetWindow.id, popupId: optionsCopy.windowId });\r\n                        return [4, this.execute(\"showPopupWindow\", {\r\n                                windowId: targetWindow.id,\r\n                                options: reformatedOptions\r\n                            })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, targetWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.createFlydown = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var optionsCopy, fullOptions;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                if (!options) {\r\n                    return [2, Promise.reject(\"The options object is not valid!\")];\r\n                }\r\n                optionsCopy = __assign({}, options);\r\n                if (!optionsCopy.horizontalOffset) {\r\n                    optionsCopy.horizontalOffset = 0;\r\n                }\r\n                if (!optionsCopy.verticalOffset) {\r\n                    optionsCopy.verticalOffset = 0;\r\n                }\r\n                fullOptions = this.reformatFlydownOptions(windowId, optionsCopy);\r\n                return [2, this.execute(\"setFlydownArea\", { windowId: windowId, options: fullOptions }).then(function () {\r\n                        var zoneIds = fullOptions.zones.map(function (z) { return z.id; });\r\n                        fullOptions.zones.forEach(function (z) {\r\n                            var callback = typeof (z.flydownSize) === \"function\" ?\r\n                                z.flydownSize : function () { return z.flydownSize; };\r\n                            if (options.size instanceof Function && z.flydownSize) {\r\n                                callback = function (data, cancel) { return __awaiter(_this, void 0, void 0, function () {\r\n                                    var result;\r\n                                    return __generator(this, function (_a) {\r\n                                        switch (_a.label) {\r\n                                            case 0:\r\n                                                if (!(options.size instanceof Function)) return [3, 2];\r\n                                                return [4, options.size(data, cancel)];\r\n                                            case 1:\r\n                                                result = _a.sent();\r\n                                                _a.label = 2;\r\n                                            case 2:\r\n                                                if (!(z.flydownSize instanceof Function && z.flydownSize !== options.size)) return [3, 4];\r\n                                                return [4, z.flydownSize(data, cancel)];\r\n                                            case 3: return [2, (_a.sent()) || result];\r\n                                            case 4: return [2, result || z.flydownSize];\r\n                                        }\r\n                                    });\r\n                                }); };\r\n                            }\r\n                            _this._registry.clearKey(fullOptions.targetId + \"_\" + z.id);\r\n                            _this._registry.add(fullOptions.targetId + \"_\" + z.id, callback);\r\n                        });\r\n                        return {\r\n                            destroy: function () { return _this.clearFlydownArea(fullOptions.targetId, zoneIds); },\r\n                            options: optionsCopy\r\n                        };\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setModalState = function (windowId, isModal) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.execute(\"setModalState\", { windowId: windowId, options: { isModal: isModal } })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.handleFlydownBoundsRequested = function (targetId, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var cancelCallback, callbackData, responses, defaultResponse, response, responseOptions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        cancelCallback = function () { return data.cancel = true; };\r\n                        callbackData = {\r\n                            zoneId: data.flydownId,\r\n                            flydownWindowBounds: data.flydownWindowBounds,\r\n                            flydownWindowId: data.flydownWindowId,\r\n                        };\r\n                        return [4, Promise.all(this._registry.execute(targetId + \"_\" + data.flydownId, callbackData, cancelCallback))];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        if (responses.length === 1) {\r\n                            defaultResponse = { height: 0, width: 0, top: 0, left: 0 };\r\n                            response = typeof (responses[0]) === \"object\" && !Array.isArray(responses[0]) ? responses[0] : defaultResponse;\r\n                            responseOptions = __assign(__assign({}, data), { flydownWindowBounds: response });\r\n                            return [2, responseOptions];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomIn = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomIn\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.zoomOut = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"zoomOut\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setZoomFactor = function (window, zoomFactor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"setZoomFactor\", {\r\n                            windowId: window.id,\r\n                            options: {\r\n                                zoomFactor: zoomFactor\r\n                            }\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showDevTools = function (window) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"showDevTools\", {\r\n                            windowId: window.id,\r\n                        })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, window];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.capture = function (window, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureScreenshot\", { windowId: window.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.captureGroup = function (windowIds, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var base64screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"captureGroupScreenshot\", { windowId: windowIds[0], options: __assign({ groupWindowIds: windowIds }, options) })];\r\n                    case 1:\r\n                        base64screenshot = (_a.sent()).data;\r\n                        return [2, base64screenshot];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.flash = function (resultWindow, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.execute(\"flash\", { windowId: resultWindow.id, options: __assign({}, options) })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, resultWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.configure = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.execute(\"configure\", { windowId: windowId, options: __assign({}, options) })];\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.execute = function (command, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var args = __assign(__assign({}, options), { command: command });\r\n            _this.agm\r\n                .invoke(\"T42.Wnd.Execute\", args, _this.agmTarget)\r\n                .then(function (i) {\r\n                if (i.returned && i.returned.errorMsg) {\r\n                    reject(i);\r\n                }\r\n                else {\r\n                    resolve(i.returned);\r\n                }\r\n            })\r\n                .catch(function (i) {\r\n                reject(i);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.execute(\"setGroupHeaderVisibility\", {\r\n            windowId: windowId,\r\n            options: {\r\n                toShow: toShow\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.getGroupTitle = function (windowId) {\r\n        return this.execute(\"getGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function (r) { return r.title; });\r\n    };\r\n    GDExecutor.prototype.setGroupTitle = function (windowId, title) {\r\n        return this.execute(\"setGroupTitle\", {\r\n            windowId: windowId,\r\n            options: {\r\n                title: title\r\n            }\r\n        });\r\n    };\r\n    GDExecutor.prototype.onClosing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addCloseHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.onRefreshing = function (callback, id) {\r\n        var glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n        if (glue42gd) {\r\n            return glue42gd.addRefreshHandler(callback, id);\r\n        }\r\n    };\r\n    GDExecutor.prototype.reformatFlydownOptions = function (windowId, options) {\r\n        var assignGeneralIfUnassigned = function (zone, prop) {\r\n            if (options[prop] && (zone[prop] === undefined || zone[prop] === null)) {\r\n                var valueFromOptions = options[prop];\r\n                zone[prop] = valueFromOptions;\r\n            }\r\n        };\r\n        var zones = options.zones.map(function (z) {\r\n            assignGeneralIfUnassigned(z, \"windowId\");\r\n            assignGeneralIfUnassigned(z, \"targetLocation\");\r\n            if (options.size && (z.flydownSize === undefined || z.flydownSize === null)) {\r\n                z.flydownSize = options.size;\r\n            }\r\n            z.flydownBounds = z.flydownSize;\r\n            z.flydownId = z.windowId;\r\n            if (!z.targetLocation) {\r\n                z.targetLocation = \"bottom\";\r\n            }\r\n            return z;\r\n        });\r\n        return __assign(__assign({}, options), { zones: zones, targetId: windowId, flydownBounds: options.size, flydownActiveArea: options.activeArea });\r\n    };\r\n    GDExecutor.prototype.clearFlydownArea = function (windowId, areaIds) {\r\n        var _this = this;\r\n        return this.execute(\"clearFlydownWindowArea\", {\r\n            windowId: windowId,\r\n            options: {}\r\n        }).then(function () {\r\n            areaIds.forEach(function (id) {\r\n                _this._registry.clearKey(windowId + \"_\" + id);\r\n            });\r\n        });\r\n    };\r\n    return GDExecutor;\r\n}());\r\nvar executor = new GDExecutor();\n\nfunction getWindowsByTabGroupId(windowId, tabGroupId) {\r\n    var windows = windowStore.list;\r\n    return Object.keys(windows).reduce(function (memo, id) {\r\n        var win = windows[id];\r\n        if (win.API.tabGroupId === tabGroupId && win.API.id !== windowId) {\r\n            memo[id] = win;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\n\nvar GDEnvironment = (function () {\r\n    function GDEnvironment(agm, logger, appManagerGetter, instance, wndId) {\r\n        this._registry = lib$2();\r\n        this._waitTimeout = 10000;\r\n        this._agm = agm;\r\n        this._logger = logger.subLogger(\"gd-env\");\r\n        this._agmInstance = this.normalizeInstance(instance);\r\n        this._windowId = wndId;\r\n        this._appManagerGetter = appManagerGetter;\r\n    }\r\n    GDEnvironment.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof _this._agmInstance === \"undefined\") {\r\n                _this._agmInstance = \"best\";\r\n            }\r\n            _this._agm.registerAsync(\"T42.Wnd.OnEventWithResponse\", function (args, caller, success, err) {\r\n                _this.respondToEvent(args).then(success).catch(err);\r\n            });\r\n            var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n                _this._agm.subscribe(\"T42.Wnd.OnEvent\", {\r\n                    waitTimeoutMs: _this._waitTimeout,\r\n                    target: _this._agmInstance,\r\n                    onData: function (streamData) {\r\n                        _this.updateWindow(streamData.data, resolve);\r\n                    },\r\n                    onConnected: function (instance) {\r\n                        _this._agmInstance = _this.normalizeInstance(instance);\r\n                        executor.init(_this._agm, _this._agmInstance);\r\n                    }\r\n                }).catch(function (err) {\r\n                    reject(\"Can not subscribe for stream T42.Wnd.OnEvent. Err: \" + err);\r\n                });\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(GDEnvironment.prototype, \"executor\", {\r\n        get: function () {\r\n            return executor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDEnvironment.prototype.open = function (name, url, options, success, error) {\r\n        options = options || {};\r\n        var copyOptions = __assign({}, options);\r\n        if (name === undefined) {\r\n            error({ message: \"The name is undefined\" });\r\n            return;\r\n        }\r\n        if (copyOptions.relativeTo !== undefined && typeof copyOptions.relativeTo !== \"string\") {\r\n            copyOptions.relativeTo = copyOptions.relativeTo.id || \"\";\r\n        }\r\n        copyOptions.name = name;\r\n        copyOptions.url = url;\r\n        copyOptions.windowState = options.windowState || options.state;\r\n        delete copyOptions.state;\r\n        this._agm.invoke(\"T42.Wnd.Create\", copyOptions, this._agmInstance)\r\n            .then(function (message) {\r\n            if (message.returned !== undefined) {\r\n                var id = message.returned.id;\r\n                success(id);\r\n            }\r\n            else {\r\n                error({ message: \"failed to execute T42.Wnd.Create - unknown reason\" });\r\n            }\r\n        })\r\n            .catch(error);\r\n    };\r\n    GDEnvironment.prototype.createFlydown = function (windowId, options) {\r\n        return this.executor.createFlydown(windowId, options);\r\n    };\r\n    GDEnvironment.prototype.showPopup = function (windowId, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var window;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        window = windowStore.get(windowId);\r\n                        return [4, this.executor.showPopup(window.API, options)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GDEnvironment.prototype.tabAttached = function (callback) {\r\n        return this._registry.add(\"tab-attached\", callback);\r\n    };\r\n    GDEnvironment.prototype.tabDetached = function (callback) {\r\n        return this._registry.add(\"tab-detached\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowFrameColorChanged = function (callback) {\r\n        return this._registry.add(\"frame-color-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onEvent = function (callback) {\r\n        return this._registry.add(\"window-event\", callback);\r\n    };\r\n    GDEnvironment.prototype.my = function () {\r\n        return this._windowId;\r\n    };\r\n    GDEnvironment.prototype.execute = function (command, windowId, options) {\r\n        return this._agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n            windowId: windowId,\r\n        });\r\n    };\r\n    GDEnvironment.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this._agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this._agmInstance);\r\n    };\r\n    GDEnvironment.prototype.onCompositionChanged = function (callback) {\r\n        return this._registry.add(\"composition-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onGroupHeaderVisibilityChanged = function (callback) {\r\n        return this._registry.add(\"group-header-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowGotFocus = function (callback) {\r\n        return this._registry.add(\"got-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowLostFocus = function (callback) {\r\n        return this._registry.add(\"lost-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.normalizeInstance = function (instance) {\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            application: instance.application,\r\n            machine: instance.machine,\r\n            user: instance.user,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.respondToEvent = function (args) {\r\n        if (args.type === \"ShowFlydownBoundsRequested\") {\r\n            return this.executor.handleFlydownBoundsRequested(args.data.windowId, args.data);\r\n        }\r\n        return Promise.reject(\"There isn't a handler for \" + args.type);\r\n    };\r\n    GDEnvironment.prototype.updateWindow = function (windowInfo, readyResolve) {\r\n        var _this = this;\r\n        var extendedStreamEvent = this.getExtendedStreamEvent(windowInfo);\r\n        if (windowInfo.type === \"Snapshot\") {\r\n            var windowInfoFullInfoEvent = windowInfo;\r\n            windowInfoFullInfoEvent.windows.forEach(function (w) {\r\n                var win = _this.createWindow(w.id, w);\r\n                windowStore.markReadyToShow(win.API.id);\r\n                _this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            });\r\n            readyResolve(this);\r\n            return;\r\n        }\r\n        if (windowInfo.type === \"Created\") {\r\n            var windowInfoCreatedEvent = windowInfo;\r\n            var win = this.createWindow(windowInfoCreatedEvent.windowId, windowInfoCreatedEvent.data || {});\r\n            windowStore.setReadyState(win.API.id);\r\n            this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            return;\r\n        }\r\n        var windowObjectAndEvents = windowStore.get(windowInfo.windowId);\r\n        if (!windowObjectAndEvents) {\r\n            this._logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n            return;\r\n        }\r\n        var theWindow = windowObjectAndEvents.API;\r\n        var theWindowEvents = windowObjectAndEvents.Events;\r\n        if (windowInfo.type === \"BoundsChanged\") {\r\n            var windowInfoBoundsChangedEvent = windowInfo;\r\n            theWindowEvents.handleBoundsChanged(windowInfoBoundsChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"UrlChanged\") {\r\n            var windowInfoUrlChangedEvent = windowInfo;\r\n            windowStore.setUrlChangedState(windowInfoUrlChangedEvent.windowId);\r\n            theWindowEvents.handleUrlChanged(windowInfoUrlChangedEvent.data);\r\n        }\r\n        if (windowInfo.type === \"TitleChanged\") {\r\n            var windowInfoTitleChanged = windowInfo;\r\n            theWindowEvents.handleTitleChanged(windowInfoTitleChanged.data);\r\n        }\r\n        if (windowInfo.type === \"VisibilityChanged\") {\r\n            theWindowEvents.handleVisibilityChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ContextChanged\") {\r\n            theWindowEvents.handleContextUpdated(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"StateChanged\") {\r\n            theWindowEvents.handleWindowChangeState(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"FrameColorChanged\") {\r\n            theWindowEvents.handleFrameColorChanged(windowInfo.data);\r\n            this._registry.execute(\"frame-color-changed\", theWindow);\r\n        }\r\n        if (windowInfo.type === \"CompositionChanged\") {\r\n            var windowInfoCompositionChanged = windowInfo;\r\n            theWindowEvents.handleCompositionChanged(windowInfoCompositionChanged.data.neighbors, windowInfoCompositionChanged.data.groupId);\r\n            this._registry.execute(\"composition-changed\", windowInfoCompositionChanged.data);\r\n        }\r\n        if (windowInfo.type === \"GroupHeaderVisibilityChanged\") {\r\n            var info = windowInfo;\r\n            theWindowEvents.handleGroupHeaderVisibilityChanged(info.data.groupHeaderVisible);\r\n            this._registry.execute(\"group-header-changed\", info.data);\r\n        }\r\n        if (windowInfo.type === \"FocusChanged\") {\r\n            var windowInfoFocusChanged = windowInfo;\r\n            this.focusChanged(theWindowEvents, theWindow, windowInfoFocusChanged.data);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameChanged\") {\r\n            theWindowEvents.handleFrameAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            this._registry.execute(\"frame-changed\");\r\n        }\r\n        if (windowInfo.type === \"WindowFrameAdded\") {\r\n            theWindowEvents.handleAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            var winsToBeNotified_1 = getWindowsByTabGroupId(theWindow.id, windowInfo.data.frameId);\r\n            Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                var win = winsToBeNotified_1[id];\r\n                win.Events.handleWindowAttached(theWindow);\r\n            });\r\n            this._registry.execute(\"tab-attached\", theWindow, windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameRemoved\") {\r\n            var oldTabGroupId = theWindow.tabGroupId;\r\n            theWindowEvents.handleDetached(windowInfo.data.frameId);\r\n            var winsToBeNotified_2 = getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n            Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                var win = winsToBeNotified_2[id];\r\n                win.Events.handleWindowDetached(theWindow);\r\n            });\r\n            var un_1 = this._registry.add(\"frame-changed\", function () {\r\n                un_1();\r\n                _this._registry.execute(\"tab-detached\", theWindow, windowInfo.data.frameId, theWindow.tabGroupId);\r\n            });\r\n        }\r\n        if (windowInfo.type === \"TabHeaderVisibilityChanged\") {\r\n            theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"FrameSelectionChanged\") {\r\n            theWindowEvents.handleFrameSelectionChanged(windowInfo.data.newWindowId, windowInfo.data.prevWindowId);\r\n        }\r\n        if (windowInfo.type === \"ButtonClicked\") {\r\n            theWindowEvents.handleFrameButtonClicked(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonAdded\") {\r\n            theWindowEvents.handleFrameButtonAdded(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonRemoved\") {\r\n            theWindowEvents.handleFrameButtonRemoved(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"WindowZoomFactorChanged\") {\r\n            theWindowEvents.handleZoomFactorChanged(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"Closed\") {\r\n            windowStore.remove(windowObjectAndEvents);\r\n            theWindowEvents.handleWindowClose();\r\n        }\r\n        if (windowInfo.type === \"FrameIsLockedChanged\") {\r\n            theWindowEvents.handleFrameIsLockedChanged(windowInfo.data);\r\n        }\r\n        this._registry.execute(\"window-event\", extendedStreamEvent);\r\n    };\r\n    GDEnvironment.prototype.createWindow = function (windowId, options) {\r\n        var _a;\r\n        var wrapper = windowStore.get(windowId);\r\n        var windowObjAndEvents = windowFactory(windowId, this.mapToWindowConstructorOptions(options), executor, this._logger, this._appManagerGetter, this._agm, (_a = wrapper) === null || _a === void 0 ? void 0 : _a.Registry);\r\n        windowStore.add(windowObjAndEvents);\r\n        return windowObjAndEvents;\r\n    };\r\n    GDEnvironment.prototype.focusChanged = function (theWindowEvents, theWindow, focus) {\r\n        theWindowEvents.handleFocusChanged(focus);\r\n        if (focus) {\r\n            this._registry.execute(\"got-focus\", theWindow);\r\n        }\r\n        else {\r\n            this._registry.execute(\"lost-focus\", theWindow);\r\n        }\r\n    };\r\n    GDEnvironment.prototype.mapToWindowConstructorOptions = function (args) {\r\n        return {\r\n            name: args.name,\r\n            context: args.context,\r\n            bounds: args.bounds,\r\n            url: args.url,\r\n            title: args.title,\r\n            isVisible: args.isVisible,\r\n            focus: args.isFocused,\r\n            state: args.state,\r\n            frameColor: args.frameColor,\r\n            groupId: args.groupId,\r\n            neighbours: args.neighbors,\r\n            isFocused: args.isFocused,\r\n            isGroupHeaderVisible: args.groupHeaderVisible,\r\n            isCollapsed: args.isCollapsed,\r\n            tabGroupId: args.frameId,\r\n            mode: args.mode,\r\n            isTabHeaderVisible: args.isTabHeaderVisible,\r\n            isTabSelected: args.isActiveTab,\r\n            settings: args.settings,\r\n            windowType: args.windowType,\r\n            zoomFactor: args.zoomFactor,\r\n            isLocked: args.isLocked,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.getExtendedStreamEvent = function (streamEvent) {\r\n        try {\r\n            var result = __assign({ state: streamEvent.type, windowName: windowStore.get(streamEvent.windowId).API.name }, streamEvent);\r\n            if (result.state === \"WindowFrameAdded\") {\r\n                result.state = \"TabAttached\";\r\n            }\r\n            if (result.state === \"StateChanged\") {\r\n                result.state = result.data.charAt(0).toUpperCase() + result.data.slice(1);\r\n            }\r\n            if (result.state === \"ButtonAdded\") {\r\n                result.state = \"FrameButtonAdded\";\r\n            }\r\n            if (result.state === \"ButtonRemoved\") {\r\n                result.state = \"FrameButtonRemoved\";\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            return streamEvent;\r\n        }\r\n    };\r\n    return GDEnvironment;\r\n}());\n\nvar envDetector = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _logger = logger;\r\n    return new Promise(function (resolve, reject) {\r\n        if (gdMajorVersion === 2) {\r\n            _logger.trace(\"running in HC\");\r\n            throw new Error(\"GD2 not supported\");\r\n        }\r\n        else if (gdMajorVersion >= 3) {\r\n            _logger.trace(\"running in GD 3\");\r\n            var gd = new GDEnvironment(agm, _logger, appManagerGetter, undefined, window.glue42gd.windowId);\r\n            gd.init()\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else {\r\n            var gdPromise = new GDEnvironment(agm, _logger, appManagerGetter).init();\r\n            var wait = function (ms) { return new Promise(function (res, rej) { return setTimeout(function () { rej(\"timeout waiting for streams\"); }, ms); }); };\r\n            Promise.race([gdPromise, wait(10000)])\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n    });\r\n});\n\nvar groupFactory = (function (id, executor) {\r\n    var _registry = lib$2();\r\n    var _windowsId = [];\r\n    function addWindow(winId) {\r\n        if (_windowsId.indexOf(winId) === -1) {\r\n            _windowsId.push(winId);\r\n            var window_1 = windowStore.get(winId);\r\n            window_1.Events.handleGroupAssociation(groupObject);\r\n            _registry.execute(\"window-added\", groupObject, window_1.API);\r\n        }\r\n    }\r\n    function removeWindow(winId) {\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            _windowsId.splice(index, 1);\r\n            var window_2 = _mapToWindowObject(winId);\r\n            _registry.execute(\"window-removed\", groupObject, window_2);\r\n        }\r\n    }\r\n    function find(window, success) {\r\n        var winId;\r\n        if (typeof window === \"string\") {\r\n            winId = window;\r\n        }\r\n        else {\r\n            winId = window.id;\r\n        }\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            var mappedWindow = _mapToWindowObject(_windowsId[index]);\r\n            if (typeof success === \"function\") {\r\n                success(mappedWindow);\r\n            }\r\n            return mappedWindow;\r\n        }\r\n    }\r\n    function windows(success) {\r\n        var mappedWindows = _mapToWindowObjects();\r\n        if (typeof success === \"function\") {\r\n            success(mappedWindows);\r\n        }\r\n        return mappedWindows;\r\n    }\r\n    function showHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], true),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            Promise.all([\r\n                executor.setGroupHeaderVisible(_windowsId[0], false),\r\n                waitForHeaderVisibilityChanged()\r\n            ])\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                return;\r\n            });\r\n        });\r\n    }\r\n    function getTitle() {\r\n        return executor.getGroupTitle(_windowsId[0]);\r\n    }\r\n    function setTitle(title) {\r\n        return executor.setGroupTitle(_windowsId[0], title);\r\n    }\r\n    function capture(captureOptions) {\r\n        return executor.captureGroup(_windowsId, captureOptions);\r\n    }\r\n    function waitForHeaderVisibilityChanged() {\r\n        return new Promise(function (resolve, reject) {\r\n            var unsub = onHeaderVisibilityChanged(function (group) {\r\n                unsub();\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n    function execute(command, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.execute(command, options)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(windowInfo) {\r\n        _registry.execute(\"header-visibility-changed\", groupObject);\r\n    }\r\n    function _mapToWindowObjects() {\r\n        var winObjects = [];\r\n        _windowsId.forEach(function (winId) {\r\n            var windowObject = _mapToWindowObject(winId);\r\n            if (typeof windowObject !== \"undefined\") {\r\n                winObjects.push(windowObject);\r\n            }\r\n        });\r\n        return winObjects;\r\n    }\r\n    function _mapToWindowObject(windowId) {\r\n        return windowStore.get(windowId) ? windowStore.get(windowId).API : undefined;\r\n    }\r\n    function _getGroupHeaderVisibility() {\r\n        var windowWithHiddenHeader = _mapToWindowObjects().find(function (w) { return !w.isGroupHeaderVisible; });\r\n        var _isGroupHeaderVisible = windowWithHiddenHeader === undefined;\r\n        return _isGroupHeaderVisible;\r\n    }\r\n    function onHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function onWindowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    var groupObject = {\r\n        id: id,\r\n        get windows() {\r\n            return windows();\r\n        },\r\n        find: find,\r\n        get isHeaderVisible() {\r\n            return _getGroupHeaderVisibility();\r\n        },\r\n        showHeader: showHeader,\r\n        hideHeader: hideHeader,\r\n        getTitle: getTitle,\r\n        setTitle: setTitle,\r\n        capture: capture,\r\n        maximize: function (success, error) {\r\n            return execute(\"maximize\", { groupId: id }, success);\r\n        },\r\n        restore: function (success, error) {\r\n            return execute(\"restore\", { groupId: id }, success);\r\n        },\r\n        onHeaderVisibilityChanged: onHeaderVisibilityChanged,\r\n        onWindowAdded: onWindowAdded,\r\n        onWindowRemoved: onWindowRemoved,\r\n    };\r\n    var internal = {\r\n        addWindow: addWindow,\r\n        removeWindow: removeWindow,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n    };\r\n    return {\r\n        groupAPI: groupObject,\r\n        groupInternal: internal,\r\n    };\r\n});\n\nvar groupsFactory = (function (environment, logger) {\r\n    var _logger = logger.subLogger(\"groups\");\r\n    var _registry = lib$2();\r\n    var _groups = {};\r\n    var heardForWindowsCounter = -1;\r\n    var windows = windowStore.list;\r\n    Object.keys(windows).forEach(function (k) {\r\n        addNewWindow(windows[k]);\r\n    });\r\n    environment.onCompositionChanged(function (windowInfo) {\r\n        handleCompositionChanged(windowInfo);\r\n    });\r\n    environment.onGroupHeaderVisibilityChanged(function (windowInfo) {\r\n        var windowId = windowInfo.windowId;\r\n        var group = findGroupByWindow(windowId);\r\n        if (typeof group !== \"undefined\") {\r\n            var groupEvents = _groups[group.id];\r\n            if (heardForWindowsCounter === -1) {\r\n                heardForWindowsCounter = group.windows.length;\r\n            }\r\n            heardForWindowsCounter--;\r\n            if (heardForWindowsCounter === 0) {\r\n                heardForWindowsCounter = -1;\r\n                groupEvents.groupInternal.handleGroupHeaderVisibilityChanged(windowInfo);\r\n            }\r\n        }\r\n    });\r\n    windowStore.onAdded(function (win) {\r\n        addNewWindow(win);\r\n    });\r\n    windowStore.onRemoved(function (win) {\r\n        removeWindow(win);\r\n    });\r\n    function my() {\r\n        return findGroupByWindow(environment.my());\r\n    }\r\n    function list(success) {\r\n        var result = Object.keys(_groups).map(function (groupId) {\r\n            if (_groups[groupId]) {\r\n                return _groups[groupId].groupAPI;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(result);\r\n        }\r\n        return result;\r\n    }\r\n    function findGroupByWindow(winId, success) {\r\n        var windowId;\r\n        if (typeof winId === \"undefined\") {\r\n            logger.debug(\"trying to find a group by a window, but winId is undefined\");\r\n            return;\r\n        }\r\n        if (typeof winId === \"string\") {\r\n            windowId = winId;\r\n        }\r\n        else {\r\n            windowId = winId.id;\r\n        }\r\n        var groupFound;\r\n        Object.keys(_groups).forEach(function (groupId) {\r\n            var group = _groups[groupId].groupAPI;\r\n            if (group.find(windowId) !== undefined) {\r\n                groupFound = group;\r\n                return;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(groupFound);\r\n        }\r\n        return groupFound;\r\n    }\r\n    function onWindowMoved(callback) {\r\n        return _registry.add(\"window-moved\", callback);\r\n    }\r\n    function createOrGetGroup(groupId) {\r\n        if (!_groups.hasOwnProperty(groupId)) {\r\n            var createdGroup = groupFactory(groupId, environment.executor);\r\n            _groups[groupId] = createdGroup;\r\n            return createdGroup;\r\n        }\r\n        else {\r\n            return _groups[groupId];\r\n        }\r\n    }\r\n    function deleteGroup(groupId) {\r\n        if (_groups.hasOwnProperty(groupId) && typeof _groups[groupId] !== \"undefined\") {\r\n            if (_groups[groupId].groupAPI.windows.length === 0) {\r\n                delete _groups[groupId];\r\n            }\r\n        }\r\n    }\r\n    function addNewWindow(win) {\r\n        _logger.trace(\"Adding new window \" + win.API.id + \" to win.API.groupId \" + win.API.groupId);\r\n        var group = addWindow(win);\r\n        if (group) {\r\n            _logger.trace(\"handleGroupAssociation \" + win.API.id + \" to group.groupAPI.id \" + group.groupAPI.id);\r\n            win.Events.handleGroupAssociation(group.groupAPI);\r\n        }\r\n    }\r\n    function addWindow(win, groupId) {\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        var windowId = win.API.id;\r\n        if (typeof windowGroupId === \"undefined\" || typeof windowId === \"undefined\") {\r\n            _logger.debug(\"trying to add a window without group - winId: \" + windowId);\r\n            return;\r\n        }\r\n        var group = createOrGetGroup(windowGroupId);\r\n        group.groupInternal.addWindow(windowId);\r\n        return group;\r\n    }\r\n    function removeWindow(win, groupId) {\r\n        var windowId = win.API.id;\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        if (typeof windowGroupId !== \"undefined\") {\r\n            var group = _groups[windowGroupId];\r\n            group.groupInternal.removeWindow(windowId);\r\n            win.Events.handleGroupAssociation(undefined);\r\n            deleteGroup(windowGroupId);\r\n        }\r\n    }\r\n    function handleCompositionChanged(windowInfo) {\r\n        var newGroupId = windowInfo.groupId;\r\n        var windowId = windowInfo.windowId;\r\n        var oldGroup = findGroupByWindow(windowId);\r\n        var oldGroupId = oldGroup ? oldGroup.id : undefined;\r\n        _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId);\r\n        if (oldGroupId === newGroupId) {\r\n            _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId + \" are the same - returning...\");\r\n            return;\r\n        }\r\n        var win = windowStore.get(windowId) || windowStore.get(windowId);\r\n        var newGroup = addWindow(win, newGroupId);\r\n        if (oldGroup) {\r\n            removeWindow(win, oldGroupId);\r\n            _registry.execute(\"window-moved\", windowId, oldGroup, newGroupId);\r\n        }\r\n        win.Events.handleGroupChanged(newGroup.groupAPI, oldGroup);\r\n    }\r\n    var groups = {\r\n        get my() {\r\n            return my();\r\n        },\r\n        list: list,\r\n        findGroupByWindow: findGroupByWindow,\r\n    };\r\n    var events = { onWindowMoved: onWindowMoved };\r\n    return {\r\n        groupsAPI: groups,\r\n        groupsEvents: events,\r\n    };\r\n});\n\nvar WindowsFactory = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _registry = lib$2();\r\n    var _logger = logger;\r\n    var groups;\r\n    var environment;\r\n    windowStore.init(_logger);\r\n    var isReady = new Promise(function (resolve, reject) {\r\n        envDetector(agm, _logger, appManagerGetter, gdMajorVersion)\r\n            .then(function (env) {\r\n            environment = env;\r\n            groups = groupsFactory(env, _logger);\r\n            resolve();\r\n        })\r\n            .catch(function (e) {\r\n            var err = \"Environment detector fails with: \" + e;\r\n            _logger.error(err);\r\n            reject(err);\r\n        });\r\n    });\r\n    function ready() {\r\n        return isReady;\r\n    }\r\n    function my() {\r\n        var myWindow = windowStore.getIfReady(environment.my());\r\n        return myWindow ? myWindow.API : undefined;\r\n    }\r\n    function open(name, url, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var errorHandler = function (errorResponse) {\r\n                if (typeof error === \"function\") {\r\n                    error(errorResponse);\r\n                }\r\n                reject(errorResponse);\r\n            };\r\n            var successHandler = function (id) {\r\n                windowStore.waitFor(id)\r\n                    .then(function (win) {\r\n                    if (typeof success === \"function\") {\r\n                        success(win.API);\r\n                    }\r\n                    resolve(win.API);\r\n                    if (win.API.windowType === \"electron\") {\r\n                        win.Events.handleUrlChanged(win.API.url);\r\n                    }\r\n                })\r\n                    .catch(errorHandler);\r\n            };\r\n            environment.open(name, url, options, successHandler, errorHandler);\r\n        });\r\n    }\r\n    function find(name, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (window && window.API.name === name) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with name:\" + name);\r\n            }\r\n        }\r\n    }\r\n    function findById(id, success, error) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (typeof window !== \"undefined\" && window.API.id === id) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with such id:\" + id);\r\n            }\r\n        }\r\n    }\r\n    function list(success) {\r\n        var windows = windowStore.list;\r\n        var windowsForListing = Object.keys(windows)\r\n            .map(function (k) {\r\n            return windows[k].API;\r\n        });\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing;\r\n        }\r\n        success(windowsForListing);\r\n    }\r\n    function configure(options) {\r\n        var win = my();\r\n        var winId = win ? win.id : \"\";\r\n        return executor.configure(winId, options);\r\n    }\r\n    function windowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function windowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    function tabAttached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabAttached(callback);\r\n        });\r\n    }\r\n    function tabDetached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabDetached(callback);\r\n        });\r\n    }\r\n    function onWindowFrameColorChanged(callback) {\r\n        return isReady.then(function () {\r\n            return environment.onWindowFrameColorChanged(callback);\r\n        });\r\n    }\r\n    function onWindowGotFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowGotFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onWindowLostFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowLostFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onEvent(callback) {\r\n        var unsubFunc;\r\n        var unsubscribed = false;\r\n        isReady.then(function () {\r\n            if (unsubscribed) {\r\n                return;\r\n            }\r\n            unsubFunc = environment.onEvent(callback);\r\n        });\r\n        return function () {\r\n            unsubscribed = true;\r\n            if (unsubFunc) {\r\n                unsubFunc();\r\n            }\r\n        };\r\n    }\r\n    function createFlydown(targetId, config) {\r\n        return environment.createFlydown(targetId, config);\r\n    }\r\n    function showPopup(targetId, config) {\r\n        return environment.showPopup(targetId, config);\r\n    }\r\n    function handleWindowAdded(w) {\r\n        _registry.execute(\"window-added\", w.API);\r\n    }\r\n    function handleWindowRemoved(w) {\r\n        _registry.execute(\"window-removed\", w.API);\r\n    }\r\n    windowStore.onReadyWindow(handleWindowAdded);\r\n    windowStore.onRemoved(handleWindowRemoved);\r\n    return {\r\n        my: my,\r\n        open: open,\r\n        find: find,\r\n        findById: findById,\r\n        list: list,\r\n        ready: ready,\r\n        onWindowAdded: windowAdded,\r\n        windowAdded: windowAdded,\r\n        onWindowRemoved: windowRemoved,\r\n        windowRemoved: windowRemoved,\r\n        onTabAttached: tabAttached,\r\n        onTabDetached: tabDetached,\r\n        onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n        get groups() {\r\n            return groups.groupsAPI;\r\n        },\r\n        onWindowGotFocus: onWindowGotFocus,\r\n        onWindowLostFocus: onWindowLostFocus,\r\n        onEvent: onEvent,\r\n        createFlydown: createFlydown,\r\n        showPopup: showPopup,\r\n        configure: configure\r\n    };\r\n});\n\nvar LayoutStore = (function () {\r\n    function LayoutStore() {\r\n        this.layouts = [];\r\n    }\r\n    LayoutStore.prototype.removeWhere = function (condition) {\r\n        this.layouts = this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.add = function (item) {\r\n        this.layouts.push(item);\r\n    };\r\n    Object.defineProperty(LayoutStore.prototype, \"all\", {\r\n        get: function () {\r\n            return this.layouts;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LayoutStore.prototype.where = function (condition) {\r\n        return this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.first = function (condition) {\r\n        return this.where(condition)[0];\r\n    };\r\n    return LayoutStore;\r\n}());\r\nvar store = new LayoutStore();\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$3(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$3,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode$1(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1$1 = encode$1;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode$1(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1$1 = decode$1;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1$1(alphabet_1$1.lookup, version$1);\n    str = str + encode_1$1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1$1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1$1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$3 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1$1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1$1 = lib$3.generate;\nvar lib_2$1 = lib$3.seed;\nvar lib_3$1 = lib$3.worker;\nvar lib_4$1 = lib$3.characters;\nvar lib_5$1 = lib$3.decode;\nvar lib_6$1 = lib$3.isValid;\n\nvar shortid$1 = lib$3;\n\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\nvar ContextProvider = (function () {\r\n    function ContextProvider(config, activitiesGetter, callbacks, logger) {\r\n        this.config = config;\r\n        this.activitiesGetter = activitiesGetter;\r\n        this.callbacks = callbacks;\r\n        this.logger = logger;\r\n        this.interop = config.agm;\r\n        this.registerRequestMethods();\r\n    }\r\n    ContextProvider.prototype.onSaveRequested = function (callback) {\r\n        return this.callbacks.add(\"saveRequested\", callback);\r\n    };\r\n    ContextProvider.prototype.isActivityOwner = function () {\r\n        if (typeof htmlContainer !== \"undefined\") {\r\n            var context_1 = htmlContainer.getContext();\r\n            return context_1 && context_1._t42 && context_1._t42.activityIsOwner;\r\n        }\r\n        var activities = this.activitiesGetter();\r\n        if (!activities) {\r\n            return false;\r\n        }\r\n        if (!activities.inActivity) {\r\n            return false;\r\n        }\r\n        var myWindow = activities.my.window;\r\n        var myActivity = activities.my.activity;\r\n        if (!myActivity && !myWindow) {\r\n            return false;\r\n        }\r\n        return myActivity.owner.id === myWindow.id;\r\n    };\r\n    ContextProvider.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.interop.register(SaveContextMethodName, function (args) {\r\n            var _a, _b, _c;\r\n            var usersCbs = _this.callbacks.execute(\"saveRequested\", args);\r\n            if (((_a = usersCbs) === null || _a === void 0 ? void 0 : _a.length) > 1) {\r\n                _this.logger.warn(\"Multiple subscriptions for \\\"glue.layouts.onSaveRequested\\\" - only the first one will be used\");\r\n            }\r\n            var requestResult = usersCbs[0];\r\n            var autoSaveWindowContext = _this.config.autoSaveWindowContext;\r\n            if (autoSaveWindowContext) {\r\n                return { autoSaveWindowContext: autoSaveWindowContext };\r\n            }\r\n            var result = { windowContext: (_b = requestResult) === null || _b === void 0 ? void 0 : _b.windowContext, activityContext: undefined };\r\n            if (_this.isActivityOwner()) {\r\n                result.activityContext = (_c = requestResult) === null || _c === void 0 ? void 0 : _c.activityContext;\r\n            }\r\n            return result;\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\n\nfunction transformACSLayout(something) {\r\n    if (!something) {\r\n        return something;\r\n    }\r\n    if (Array.isArray(something)) {\r\n        return something.map(function (item) {\r\n            return transformACSLayout(item);\r\n        });\r\n    }\r\n    if (typeof something === \"string\" || typeof something === \"number\" || typeof something === \"boolean\") {\r\n        return something;\r\n    }\r\n    var initial = {};\r\n    return Object.keys(something).reduce(function (accumulator, current) {\r\n        var value = something[current];\r\n        var convertedValue = transformACSLayout(value);\r\n        var key = current;\r\n        if (current[0].toLowerCase() !== current[0]) {\r\n            key = current[0].toLowerCase() + current.substr(1);\r\n        }\r\n        accumulator[key] = convertedValue;\r\n        return accumulator;\r\n    }, initial);\r\n}\n\nvar LayoutImpl = (function () {\r\n    function LayoutImpl(data) {\r\n        this.name = data.name;\r\n        this.type = data.type;\r\n        this.components = data.components;\r\n        this.context = data.context;\r\n        this.metadata = data.metadata;\r\n        this.version = data.version;\r\n    }\r\n    return LayoutImpl;\r\n}());\n\nvar LayoutsAPIImpl = (function () {\r\n    function LayoutsAPIImpl(config, stream, callbacks, logger) {\r\n        this.config = config;\r\n        this.stream = stream;\r\n        this.callbacks = callbacks;\r\n        this.appManager = config.appManager;\r\n        this.onEvent = stream.onEvent;\r\n        this.provider = new ContextProvider(config, config.activityGetter, callbacks, logger);\r\n        stream.subscribe();\r\n    }\r\n    LayoutsAPIImpl.prototype.setDefaultGlobal = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.SelectDefaultLayout\", { name: name })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.clearDefaultGlobal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.DeselectDefaultLayout\")];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getDefaultGlobal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetDefaultLayout\")];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (this.isSlimMode()) {\r\n                            return [2, layout];\r\n                        }\r\n                        return [2, this.list().find(function (l) { return l.name === layout.name && l.type === \"Global\"; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.ready = function () {\r\n        if (this.config.mode === \"fullWaitSnapshot\") {\r\n            return this.stream.gotSnapshot;\r\n        }\r\n        return this.stream.ready;\r\n    };\r\n    LayoutsAPIImpl.prototype.save = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout.name) {\r\n                throw Error(\"layout.name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                layout.type = \"Global\";\r\n            }\r\n            if (layout.activityId) {\r\n                layout.type = \"Activity\";\r\n            }\r\n            if (typeof layout.ignoreHidden === \"undefined\") {\r\n                layout.ignoreHidden = true;\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                actIds: [],\r\n                appIds: [],\r\n                type: layout.type,\r\n                context: layout.context,\r\n                metadata: layout.metadata || {},\r\n                options: { ignoreLayoutRestrictions: false },\r\n            };\r\n            if (layout.type === \"Activity\") {\r\n                var actId = layout.activityId;\r\n                if (!actId) {\r\n                    if (!_this.appManager.myInstance.inActivity) {\r\n                        throw new Error(\"Current application is not in activity. Can not save activity layout for it\");\r\n                    }\r\n                    actId = _this.appManager.myInstance.activityId;\r\n                }\r\n                layoutObject.actIds.push(actId);\r\n                layoutObject.options = { ignoreLayoutRestrictions: true };\r\n            }\r\n            else if (layout.type === \"Global\") {\r\n                if (_this.config.gdMajorVersion === 2) {\r\n                    var instances = _this.appManager.instances();\r\n                    if (layout.ignoreHidden) {\r\n                        instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n                    }\r\n                    if (layout.ignoreMyInstance && _this.appManager.myInstance) {\r\n                        instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n                    }\r\n                    instances.reduce(function (prev, current) {\r\n                        if (!current.id) {\r\n                            return prev;\r\n                        }\r\n                        if (current.inActivity) {\r\n                            var actId = current.activityId;\r\n                            if (prev.actIds.indexOf(actId) === -1) {\r\n                                prev.actIds.push(actId);\r\n                            }\r\n                        }\r\n                        else {\r\n                            prev.appIds.push(current.id);\r\n                        }\r\n                        return prev;\r\n                    }, layoutObject);\r\n                }\r\n                else {\r\n                    layoutObject.autoCollectApps = true;\r\n                }\r\n            }\r\n            else {\r\n                throw new Error(\"layout type \" + layout.type + \" not supported\");\r\n            }\r\n            _this.invokeMethodAndTrack(\"T42.ACS.SaveLayout\", layoutObject, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.restore = function (options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (typeof options === \"undefined\") {\r\n                throw Error(\"options argument is required\");\r\n            }\r\n            if (!options.name) {\r\n                throw Error(\"options.name argument is required\");\r\n            }\r\n            if (!options.type) {\r\n                options.type = \"Global\";\r\n            }\r\n            if (options.activityIdToJoin) {\r\n                options.type = \"Activity\";\r\n            }\r\n            if (typeof options.restoreActivityOwner === \"undefined\") {\r\n                options.restoreActivityOwner = false;\r\n            }\r\n            if (typeof options.ignoreActivityWindowTypes === \"undefined\") {\r\n                options.ignoreActivityWindowTypes = [];\r\n            }\r\n            if (typeof options.setActivityContext === \"undefined\") {\r\n                options.setActivityContext = true;\r\n            }\r\n            if (typeof options.closeRunningInstance === \"undefined\") {\r\n                if (options.type === \"Global\") {\r\n                    options.closeRunningInstance = true;\r\n                }\r\n                else if (options.type === \"Activity\") {\r\n                    options.closeRunningInstance = false;\r\n                }\r\n            }\r\n            if (typeof options.reuseWindows === \"undefined\") {\r\n                options.reuseWindows = true;\r\n            }\r\n            options.context = options.context || {};\r\n            var t42 = {\r\n                restoreOptions: {\r\n                    activityToJoin: options.activityIdToJoin,\r\n                    setActivityContext: options.setActivityContext,\r\n                    ignoreActivityWindowTypes: options.ignoreActivityWindowTypes,\r\n                    restoreActivityOwner: options.restoreActivityOwner,\r\n                    closeOldWindows: options.closeRunningInstance,\r\n                    reuseExistingWindows: options.reuseWindows\r\n                }\r\n            };\r\n            var arg = {\r\n                type: options.type,\r\n                name: options.name,\r\n                context: options.context,\r\n                toClose: [],\r\n                splash: options.splash\r\n            };\r\n            if (_this.config.gdMajorVersion === 2) {\r\n                if (options.closeRunningInstance) {\r\n                    arg.toClose = _this.getInstancesToClose(options);\r\n                }\r\n            }\r\n            if (options.timeout) {\r\n                arg.timeout = options.timeout;\r\n            }\r\n            arg.context._t42 = t42;\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RestoreLayout\", arg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.remove = function (type, name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = {\r\n                type: type,\r\n                name: name,\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RemoveLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.list = function () {\r\n        this.verifyNotSlimMode();\r\n        return store.all;\r\n    };\r\n    LayoutsAPIImpl.prototype.import = function (layouts, mode) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            var msg = {\r\n                mode: mode || \"replace\",\r\n                layouts: layouts\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ImportLayouts\", msg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.export = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var handleResult = function (result) {\r\n                var layouts = _this.getObjectValues(result.Layouts).map(function (t) { return new LayoutImpl(transformACSLayout(t)); });\r\n                resolve(layouts);\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ExportLayouts\", {}, handleResult, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.rename = function (layout, newName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = { type: layout.type, oldName: layout.name, newName: newName };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RenameLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateMetadata = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            if (!layout.metadata) {\r\n                throw Error(\"metadata argument is required\");\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                type: layout.type,\r\n                metadata: layout.metadata\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateMetadata\", layoutObject, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.hibernate = function (name, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            options = options || {};\r\n            var request = {\r\n                name: name,\r\n                type: \"Global\",\r\n                context: options.context || {},\r\n                metadata: options.metadata || {},\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.HibernateLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.resume = function (name, context, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!name) {\r\n                return reject(\"name cannot be empty\");\r\n            }\r\n            var request = __assign({ name: name, type: \"Global\", context: context }, options);\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ResumeLayout\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.getCurrentLayout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.config.agm.invoke(\"T42.ACS.GetCurrentLayout\", {}, \"best\", { methodResponseTimeoutMs: 120 * 1000 })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        layout = result.returned.layout;\r\n                        if (!layout) {\r\n                            return [2, undefined];\r\n                        }\r\n                        if (!this.isSlimMode()) {\r\n                            layout = this.list().find(function (l) { return l.name === layout.name && l.type === layout.type; });\r\n                        }\r\n                        return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.onAdded = function (callback) {\r\n        var result = this.callbacks.add(\"added\", callback);\r\n        if (store.all.length > 0) {\r\n            store.all.forEach(function (layout) {\r\n                try {\r\n                    callback(layout);\r\n                }\r\n                catch (err) { }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    LayoutsAPIImpl.prototype.onRemoved = function (callback) {\r\n        return this.callbacks.add(\"removed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onChanged = function (callback) {\r\n        return this.callbacks.add(\"changed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRestored = function (callback) {\r\n        return this.callbacks.add(\"restored\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRenamed = function (callback) {\r\n        return this.callbacks.add(\"renamed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onEvent = function (callback) {\r\n        return this.stream.onEvent(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onSaveRequested = function (callback) {\r\n        return this.provider.onSaveRequested(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.updateAppContextInCurrent = function (context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (context && typeof context !== \"object\") {\r\n                reject(\"context must be an object\");\r\n            }\r\n            context = (context !== null && context !== void 0 ? context : {});\r\n            var request = {\r\n                context: context\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateLayoutComponentContext\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateDefaultContext = function (context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (context && typeof context !== \"object\") {\r\n                reject(\"context must be an object\");\r\n            }\r\n            context = (context !== null && context !== void 0 ? context : {});\r\n            var request = {\r\n                context: context\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateDefaultContext\", request, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.isSlimMode = function () {\r\n        return this.config.mode === \"slim\";\r\n    };\r\n    LayoutsAPIImpl.prototype.verifyNotSlimMode = function () {\r\n        if (this.isSlimMode()) {\r\n            throw Error(\"Operation not allowed in slim mode. Run in full mode.\");\r\n        }\r\n    };\r\n    LayoutsAPIImpl.prototype.isVisibleWindow = function (instance) {\r\n        if (instance.application.type === \"exe\" || instance.application.type === \"node\") {\r\n            return true;\r\n        }\r\n        if (instance.application.type === \"activity\") {\r\n            return true;\r\n        }\r\n        if (!instance || !instance.window) {\r\n            return false;\r\n        }\r\n        return instance.window.isVisible;\r\n    };\r\n    LayoutsAPIImpl.prototype.invokeMethodAndTrack = function (methodName, args, resolve, reject, skipStreamEvent) {\r\n        var streamEventReceived = skipStreamEvent;\r\n        var agmResult;\r\n        var token = shortid$1();\r\n        args.token = token;\r\n        var handleResult = function () {\r\n            if (streamEventReceived && agmResult) {\r\n                resolve(agmResult);\r\n            }\r\n        };\r\n        if (!skipStreamEvent) {\r\n            this.stream.waitFor(token)\r\n                .then(function () {\r\n                streamEventReceived = true;\r\n                handleResult();\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        var responseHandler = function (result) {\r\n            if (!result.returned) {\r\n                reject(\"No result from method \" + methodName);\r\n            }\r\n            if (result.returned.status && (result.returned.status !== \"Success\" && result.returned.status !== \"PartialSuccess\")) {\r\n                reject(result.returned);\r\n            }\r\n            agmResult = result.returned;\r\n            handleResult();\r\n        };\r\n        this.config.agm.invoke(methodName, args, \"best\", { methodResponseTimeoutMs: 120 * 1000 })\r\n            .then(responseHandler)\r\n            .catch(function (err) { return reject(err); });\r\n    };\r\n    LayoutsAPIImpl.prototype.getInstancesToClose = function (options) {\r\n        var _this = this;\r\n        var instances = [];\r\n        var shellApp = this.appManager.applications().filter(function (a) { return a.isShell; })[0];\r\n        var shellApplicationName = shellApp ? shellApp.name : \"AppManager\";\r\n        this.appManager.instances().forEach(function (i) {\r\n            if (_this.appManager.myInstance && i.id === _this.appManager.myInstance.id) {\r\n                return;\r\n            }\r\n            if (i.application.name === shellApplicationName) {\r\n                return;\r\n            }\r\n            if (!_this.isVisibleWindow(i)) {\r\n                return;\r\n            }\r\n            if (options.type === \"Activity\") {\r\n                if (i.activityId !== options.activityIdToJoin) {\r\n                    return;\r\n                }\r\n            }\r\n            instances.push({ application: i.application.name, instance: i.id });\r\n        });\r\n        return instances;\r\n    };\r\n    LayoutsAPIImpl.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return LayoutsAPIImpl;\r\n}());\n\nvar ACSStream = (function () {\r\n    function ACSStream(agm, callbacks) {\r\n        var _this = this;\r\n        this.agm = agm;\r\n        this.callbacks = callbacks;\r\n        this.ready = new Promise(function (resolve, reject) {\r\n            _this.resolveReady = resolve;\r\n            _this.rejectReady = reject;\r\n        });\r\n        this.gotSnapshot = new Promise(function (resolve, reject) {\r\n            _this.resolveGotSnapshot = resolve;\r\n            _this.rejectGotSnapshot = reject;\r\n        });\r\n    }\r\n    ACSStream.prototype.subscribe = function (noRetry) {\r\n        var _this = this;\r\n        var transform = function (obj) {\r\n            return _this.getObjectValues(obj).map(function (t) { return transformACSLayout(t); });\r\n        };\r\n        if (!this.checkForLayoutEventMethod()) {\r\n            if (noRetry) {\r\n                this.resolveReady();\r\n            }\r\n            setTimeout(function () {\r\n                _this.subscribe(true);\r\n            }, 500);\r\n        }\r\n        else {\r\n            this.agm.subscribe(\"T42.ACS.OnLayoutEvent\", { waitTimeoutMs: 10000 })\r\n                .then(function (subs) {\r\n                subs.onData(function (args) {\r\n                    var data = args.data;\r\n                    if (data.IsSnapshot) {\r\n                        _this.resolveGotSnapshot();\r\n                    }\r\n                    _this.addLayouts(transform(data.OnLayoutAdded));\r\n                    _this.removeLayouts(transform(data.OnLayoutRemoved));\r\n                    _this.changeLayouts(transform(data.OnLayoutChanged));\r\n                    _this.renameLayouts(transform(data.OnLayoutRenamed));\r\n                    _this.restoredLayout(transform(data.OnLayoutRestored));\r\n                    _this.callbacks.execute(\"streamEvent\", data);\r\n                });\r\n                subs.onFailed(function (err) {\r\n                    var msg = \"can not subscribe to T42.ACS.OnLayoutEvent \" + err;\r\n                    _this.rejectReady(msg);\r\n                    _this.rejectGotSnapshot(msg);\r\n                });\r\n                _this.resolveReady();\r\n            })\r\n                .catch(function (err) {\r\n                var msg = \"Error subscribing for T42.ACS.OnLayoutEvent stream. Err: \" + err;\r\n                _this.rejectReady(msg);\r\n                _this.rejectGotSnapshot(msg);\r\n            });\r\n        }\r\n    };\r\n    ACSStream.prototype.onEvent = function (callback) {\r\n        return this.callbacks.add(\"streamEvent\", callback);\r\n    };\r\n    ACSStream.prototype.waitFor = function (token, timeout) {\r\n        var _this = this;\r\n        if (!timeout) {\r\n            timeout = 10000;\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var done = false;\r\n            var unsubscribe = _this.onEvent(function (streamEvent) {\r\n                if (streamEvent.Token === token) {\r\n                    done = true;\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                if (!done) {\r\n                    reject(\"timed out\");\r\n                }\r\n            }, timeout);\r\n        });\r\n    };\r\n    ACSStream.prototype.checkForLayoutEventMethod = function () {\r\n        try {\r\n            return this.agm\r\n                .methods()\r\n                .map(function (m) { return m.name; })\r\n                .indexOf(\"T42.ACS.OnLayoutEvent\") !== -1;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    ACSStream.prototype.addLayouts = function (layoutsData) {\r\n        var _this = this;\r\n        if (!layoutsData) {\r\n            return;\r\n        }\r\n        layoutsData.forEach(function (layoutData) {\r\n            var layout = new LayoutImpl(layoutData);\r\n            store.add(layout);\r\n            _this.callbacks.execute(\"added\", layout);\r\n        });\r\n    };\r\n    ACSStream.prototype.removeLayouts = function (removedLayouts) {\r\n        var _this = this;\r\n        if (!removedLayouts) {\r\n            return;\r\n        }\r\n        removedLayouts.forEach(function (removedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, removedLayout); });\r\n            _this.callbacks.execute(\"removed\", removedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.changeLayouts = function (changedLayouts) {\r\n        var _this = this;\r\n        if (!changedLayouts) {\r\n            return;\r\n        }\r\n        changedLayouts.forEach(function (changedLayout) {\r\n            store.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, changedLayout); });\r\n            store.add(new LayoutImpl(changedLayout));\r\n            _this.callbacks.execute(\"changed\", changedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.renameLayouts = function (renamedLayouts) {\r\n        var _this = this;\r\n        if (!renamedLayouts) {\r\n            return;\r\n        }\r\n        renamedLayouts.forEach(function (renamedLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: renamedLayout.type, name: renamedLayout.oldName }); });\r\n            if (!existingLayout) {\r\n                throw Error(\"received rename event for unknown layout with type \" + renamedLayout.type + \" and name \" + renamedLayout.oldName);\r\n            }\r\n            existingLayout.name = renamedLayout.newName;\r\n            _this.callbacks.execute(\"renamed\", existingLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.compareLayouts = function (layout1, layout2) {\r\n        return layout1.name === layout2.name && layout1.type === layout2.type;\r\n    };\r\n    ACSStream.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    ACSStream.prototype.restoredLayout = function (restoredLayouts) {\r\n        var _this = this;\r\n        if (!restoredLayouts) {\r\n            return;\r\n        }\r\n        restoredLayouts.forEach(function (restoredLayout) {\r\n            var existingLayout = store.first(function (current) { return _this.compareLayouts(current, { type: restoredLayout.type, name: restoredLayout.name }); });\r\n            _this.callbacks.execute(\"restored\", existingLayout);\r\n        });\r\n    };\r\n    return ACSStream;\r\n}());\n\nfunction streamNull () {\r\n    return {\r\n        ready: Promise.resolve(undefined),\r\n        subscribe: function () { },\r\n        onEvent: function (callback) { return function () { }; },\r\n        waitFor: function (token, timeout) { return Promise.resolve(undefined); },\r\n        gotSnapshot: Promise.resolve(undefined),\r\n    };\r\n}\n\nfunction LayoutsFactory (config) {\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is required\");\r\n    }\r\n    if (!config.logger) {\r\n        throw Error(\"config.logger is required\");\r\n    }\r\n    config.mode = config.mode || \"slim\";\r\n    var logger = config.logger;\r\n    var callbacks = lib$2();\r\n    var acsStream;\r\n    if (config.mode === \"full\" || \"fullWaitSnapshot\") {\r\n        acsStream = new ACSStream(config.agm, callbacks);\r\n    }\r\n    else {\r\n        acsStream = streamNull();\r\n    }\r\n    return new LayoutsAPIImpl(config, acsStream, callbacks, logger);\r\n}\n\nvar T42DisplayCommand = \"T42.Displays.Command\";\r\nvar DisplayManager = (function () {\r\n    function DisplayManager(_agm, _logger) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._logger = _logger;\r\n        this.all = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var displays;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetAll, {})];\r\n                    case 1:\r\n                        displays = _a.sent();\r\n                        return [2, displays.map(this.decorateDisplay)];\r\n                }\r\n            });\r\n        }); };\r\n        this.get = function (id) { return __awaiter(_this, void 0, void 0, function () {\r\n            var display;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Get, { id: id })];\r\n                    case 1:\r\n                        display = _a.sent();\r\n                        return [2, this.decorateDisplay(display)];\r\n                }\r\n            });\r\n        }); };\r\n        this.getPrimary = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var primary;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        primary = (_a.sent()).find(function (d) { return d.isPrimary; });\r\n                        return [2, primary];\r\n                }\r\n            });\r\n        }); };\r\n        this.capture = function (options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var screenshot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.Capture, __assign({}, options))];\r\n                    case 1:\r\n                        screenshot = _a.sent();\r\n                        return [2, screenshot];\r\n                }\r\n            });\r\n        }); };\r\n        this.captureAll = function (options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var screenshots;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.CaptureAll, __assign({}, options))];\r\n                    case 1:\r\n                        screenshots = _a.sent();\r\n                        return [2, screenshots];\r\n                }\r\n            });\r\n        }); };\r\n        this.getMousePosition = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var point;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callGD(DisplayCommand.GetMousePosition)];\r\n                    case 1:\r\n                        point = _a.sent();\r\n                        return [2, point];\r\n                }\r\n            });\r\n        }); };\r\n        this.callGD = function (command, options) { return __awaiter(_this, void 0, void 0, function () {\r\n            var invocationResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this._agm.invoke(T42DisplayCommand, { options: __assign({}, options), command: command })];\r\n                    case 1:\r\n                        invocationResult = _a.sent();\r\n                        return [2, invocationResult.returned.data];\r\n                }\r\n            });\r\n        }); };\r\n        this.decorateDisplay = function (original) {\r\n            return __assign(__assign({}, original), { capture: function (size) { return _this.capture({ id: original.id, size: size }); } });\r\n        };\r\n    }\r\n    return DisplayManager;\r\n}());\r\nvar DisplayCommand;\r\n(function (DisplayCommand) {\r\n    DisplayCommand[\"Capture\"] = \"capture\";\r\n    DisplayCommand[\"CaptureAll\"] = \"captureAll\";\r\n    DisplayCommand[\"GetAll\"] = \"getAll\";\r\n    DisplayCommand[\"Get\"] = \"get\";\r\n    DisplayCommand[\"GetMousePosition\"] = \"getMousePosition\";\r\n})(DisplayCommand || (DisplayCommand = {}));\n\nvar interop;\r\nvar windowId;\r\nfunction setupAGM(interopLib, channels) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    interop = interopLib;\r\n                    if (typeof window !== \"undefined\") {\r\n                        if (window.glue42gd) {\r\n                            windowId = window.glue42gd.windowId;\r\n                        }\r\n                    }\r\n                    if (!windowId) {\r\n                        return [2];\r\n                    }\r\n                    return [4, interop.register(\"T42.Channels.Command\", function (args) {\r\n                            var command = args.command;\r\n                            if (!command) {\r\n                                throw new Error(\"missing command argument\");\r\n                            }\r\n                            if (command === \"join\") {\r\n                                var id = args.channel;\r\n                                if (!id) {\r\n                                    throw new Error(\"missing argument id\");\r\n                                }\r\n                                channels.joinNoSelectorSwitch(id);\r\n                                return;\r\n                            }\r\n                            if (command === \"leave\") {\r\n                                channels.leaveNoSelectorSwitch();\r\n                                return;\r\n                            }\r\n                            if (command === \"get\") {\r\n                                var id = channels.current();\r\n                                return { id: id };\r\n                            }\r\n                            throw new Error(\"unknown command \" + command);\r\n                        })];\r\n                case 1:\r\n                    _a.sent();\r\n                    interop.invoke(\"T42.Channels.Announce\", { swId: windowId, instance: interop.instance.instance });\r\n                    return [2];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction switchChannel(channel, id) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            interop.invoke(\"T42.Channels.Announce\", {\r\n                swId: (id !== null && id !== void 0 ? id : windowId),\r\n                command: \"switchChannel\",\r\n                data: { newChannel: channel }\r\n            });\r\n            return [2];\r\n        });\r\n    });\r\n}\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n            var _a;\r\n            callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (data, _, __, ___, extraData) {\r\n                                var _a;\r\n                                if (_this.callback) {\r\n                                    _this.callback(data.data, data, (_a = extraData) === null || _a === void 0 ? void 0 : _a.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (data) {\r\n                resolve(data);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.updateChannel = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.update(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.updateData = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        if (this.contexts.setPathSupported) {\r\n            var pathValues = Object.keys(data).map(function (key) {\r\n                return {\r\n                    path: \"data.\" + key,\r\n                    value: data[key]\r\n                };\r\n            });\r\n            return this.contexts.setPaths(contextName, pathValues);\r\n        }\r\n        else {\r\n            return this.contexts.update(contextName, { data: data });\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return CONTEXT_PREFIX + name;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar ChannelsImpl = (function () {\r\n    function ChannelsImpl(shared) {\r\n        this.shared = shared;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$2();\r\n        this.shared.subscribe(this.handler.bind(this));\r\n    }\r\n    ChannelsImpl.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.publish = function (data, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof data !== \"object\") {\r\n                    throw new Error(\"Please provide the data as an object!\");\r\n                }\r\n                if (name) {\r\n                    if (typeof name !== \"string\") {\r\n                        throw new Error(\"Please provide the name as a string!\");\r\n                    }\r\n                    if (!this.shared.isChannel(name)) {\r\n                        return [2, Promise.reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"))];\r\n                    }\r\n                    return [2, this.shared.updateData(name, data)];\r\n                }\r\n                if (!this.currentContext) {\r\n                    throw new Error(\"Not joined to any channel!\");\r\n                }\r\n                return [2, this.shared.updateData(this.currentContext, data)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    ChannelsImpl.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    ChannelsImpl.prototype.join = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.joinCore(name)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.joinNoSelectorSwitch = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.joinCore(name, false)];\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leave = function () {\r\n        return this.leaveCore();\r\n    };\r\n    ChannelsImpl.prototype.leaveNoSelectorSwitch = function () {\r\n        return this.leaveCore(false);\r\n    };\r\n    ChannelsImpl.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    ChannelsImpl.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    ChannelsImpl.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    ChannelsImpl.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta || {},\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.updateChannel(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    ChannelsImpl.prototype.joinCore = function (name, changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        if (name === this.currentContext) {\r\n                            return [2];\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.currentContext = name;\r\n                        return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        if (changeSelector) {\r\n                            switchChannel(name);\r\n                        }\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.leaveCore = function (changeSelector) {\r\n        if (changeSelector === void 0) { changeSelector = true; }\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        if (changeSelector) {\r\n            switchChannel();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    return ChannelsImpl;\r\n}());\n\nfunction factory(contexts, agm) {\r\n    var sharedContexts = new SharedContextSubscriber(contexts);\r\n    var channels = new ChannelsImpl(sharedContexts);\r\n    setupAGM(agm, channels);\r\n    return {\r\n        subscribe: channels.subscribe.bind(channels),\r\n        subscribeFor: channels.subscribeFor.bind(channels),\r\n        publish: channels.publish.bind(channels),\r\n        all: channels.all.bind(channels),\r\n        list: channels.list.bind(channels),\r\n        get: channels.get.bind(channels),\r\n        join: channels.join.bind(channels),\r\n        leave: channels.leave.bind(channels),\r\n        current: channels.current.bind(channels),\r\n        my: channels.my.bind(channels),\r\n        changed: channels.changed.bind(channels),\r\n        onChanged: channels.onChanged.bind(channels),\r\n        add: channels.add.bind(channels),\r\n        ready: function () { return contexts.ready(); }\r\n    };\r\n}\n\nvar CommandMethod = \"T42.Hotkeys.Command\";\r\nvar InvokeMethod = \"T42.Hotkeys.Invoke\";\r\nvar RegisterCommand = \"register\";\r\nvar UnregisterCommand = \"unregister\";\r\nvar UnregisterAllCommand = \"unregisterAll\";\r\nvar HotkeysImpl = (function () {\r\n    function HotkeysImpl(agm) {\r\n        this.agm = agm;\r\n        this.registry = lib$2();\r\n        this.firstHotkey = true;\r\n        this.hotkeys = new Map();\r\n    }\r\n    HotkeysImpl.prototype.register = function (info, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info === \"undefined\") {\r\n                            throw new Error(\"Hotkey parameter missing\");\r\n                        }\r\n                        if (typeof info === \"string\") {\r\n                            info = {\r\n                                hotkey: info\r\n                            };\r\n                        }\r\n                        else {\r\n                            if (!info.hotkey) {\r\n                                throw new Error(\"Info's hotkey parameter missing\");\r\n                            }\r\n                            info = {\r\n                                hotkey: info.hotkey,\r\n                                description: info.description\r\n                            };\r\n                        }\r\n                        hkToLower = this.formatHotkey(info.hotkey);\r\n                        if (this.hotkeys.has(hkToLower)) {\r\n                            throw new Error(\"Shortcut for \" + hkToLower + \" already registered\");\r\n                        }\r\n                        if (!this.firstHotkey) return [3, 2];\r\n                        this.firstHotkey = false;\r\n                        return [4, this.registerInvokeAGMMethod()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.registry.add(hkToLower, callback);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: RegisterCommand, hotkey: hkToLower, description: info.description })];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.hotkeys.set(hkToLower, info);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregister = function (hotkey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof hotkey === \"undefined\") {\r\n                            throw new Error(\"hotkey parameter missing\");\r\n                        }\r\n                        if (typeof hotkey !== \"string\") {\r\n                            throw new Error(\"hotkey parameter must be string\");\r\n                        }\r\n                        hkToLower = this.formatHotkey(hotkey);\r\n                        return [4, this.agm.invoke(CommandMethod, { command: UnregisterCommand, hotkey: hkToLower })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.delete(hkToLower);\r\n                        this.registry.clearKey(hkToLower);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregisterAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.agm.invoke(CommandMethod, { command: UnregisterAllCommand })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.clear();\r\n                        this.registry.clear();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.isRegistered = function (hotkey) {\r\n        var hkToLower = this.formatHotkey(hotkey);\r\n        return this.hotkeys.has(hkToLower);\r\n    };\r\n    HotkeysImpl.prototype.registerInvokeAGMMethod = function () {\r\n        var _this = this;\r\n        this.agm.register(InvokeMethod, function (args) {\r\n            var hkToLower = args.key.toLowerCase();\r\n            var info = _this.hotkeys.get(hkToLower);\r\n            _this.registry.execute(hkToLower, info);\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.formatHotkey = function (hotkey) {\r\n        if (hotkey) {\r\n            return hotkey.replace(/\\s/g, \"\").toLowerCase();\r\n        }\r\n    };\r\n    return HotkeysImpl;\r\n}());\n\nfunction factory$1(agm) {\r\n    var hotkeys = new HotkeysImpl(agm);\r\n    return {\r\n        register: hotkeys.register.bind(hotkeys),\r\n        unregister: hotkeys.unregister.bind(hotkeys),\r\n        unregisterAll: hotkeys.unregisterAll.bind(hotkeys),\r\n        isRegistered: hotkeys.isRegistered.bind(hotkeys),\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\n\nvar version$2 = \"5.2.4\";\n\nvar prepareConfig$1 = (function (options) {\r\n    function getLibConfig(value, defaultMode, trueMode) {\r\n        if (typeof value === \"boolean\" && !value) {\r\n            return undefined;\r\n        }\r\n        var mode = getModeAsString(value, defaultMode, trueMode);\r\n        if (typeof value === \"object\") {\r\n            value.mode = mode;\r\n            return value;\r\n        }\r\n        return {\r\n            mode: mode,\r\n        };\r\n    }\r\n    function getModeAsString(value, defaultMode, trueMode) {\r\n        if (typeof value === \"object\") {\r\n            return getModeAsString(value.mode, defaultMode, trueMode) + \"\";\r\n        }\r\n        else if (typeof value === \"undefined\") {\r\n            if (typeof defaultMode === \"boolean\" && !defaultMode) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return defaultMode + \"\";\r\n            }\r\n        }\r\n        else if (typeof value === \"boolean\") {\r\n            if (value) {\r\n                return ((trueMode === undefined) ? defaultMode : trueMode) + \"\";\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n        return value + \"\";\r\n    }\r\n    var appDefaultMode = false;\r\n    var appDefaultTrueMode = \"startOnly\";\r\n    var activitiesDefaultMode = \"trackMyTypeAndInitiatedFromMe\";\r\n    var layoutsDefaultMode = \"slim\";\r\n    return {\r\n        layouts: getLibConfig(options.layouts, layoutsDefaultMode),\r\n        activities: getLibConfig(options.activities, activitiesDefaultMode),\r\n        appManager: getLibConfig(options.appManager, appDefaultMode, appDefaultTrueMode),\r\n        windows: getLibConfig(options.windows, true),\r\n        channels: getLibConfig(options.channels || false, false),\r\n        displays: getLibConfig(options.displays, true)\r\n    };\r\n});\n\nvar Glue42Notification = (function () {\r\n    function Glue42Notification(options) {\r\n        this.options = options;\r\n        this.callbacks = lib$2();\r\n        this.actions = options.actions;\r\n        this.body = options.body;\r\n        this.badge = options.badge;\r\n        this.data = options.data;\r\n        this.dir = options.dir;\r\n        this.icon = options.icon;\r\n        this.image = options.image;\r\n        this.lang = options.lang;\r\n        this.renotify = options.renotify;\r\n        this.requireInteraction = options.requireInteraction;\r\n        this.silent = options.silent;\r\n        this.tag = options.tag;\r\n        this.timestamp = options.timestamp;\r\n        this.title = options.title;\r\n    }\r\n    Glue42Notification.prototype.close = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    Glue42Notification.prototype.addEventListener = function (type, listener, options) {\r\n        this.callbacks.add(type, listener);\r\n    };\r\n    Glue42Notification.prototype.removeEventListener = function (type, listener, options) {\r\n    };\r\n    Glue42Notification.prototype.dispatchEvent = function (event) {\r\n        this.callbacks.execute(event.type, event);\r\n        return true;\r\n    };\r\n    return Glue42Notification;\r\n}());\n\nvar STARTING_INDEX = 0;\r\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n        this.methodsRegistered = false;\r\n        this.methodNameRoot = \"T42.Notifications.Handler-\" + shortid$1();\r\n        this.nextId = 0;\r\n        this.notifications = {};\r\n    }\r\n    Object.defineProperty(Notifications.prototype, \"maxActions\", {\r\n        get: function () {\r\n            return 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Notifications.prototype.raise = function (options) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bunchOfPromises, index, id, notification, validActions, index, _loop_1, this_1, _i, validActions_1, action, g42notification;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!options) {\r\n                            throw new Error(\"invalid options - should be an object\");\r\n                        }\r\n                        if (!options.title) {\r\n                            throw new Error(\"invalid options - should have title\");\r\n                        }\r\n                        if (!!this.methodsRegistered) return [3, 2];\r\n                        bunchOfPromises = [];\r\n                        for (index = STARTING_INDEX; index < this.maxActions; index++) {\r\n                            bunchOfPromises.push(this.interop.register(this.methodNameRoot + \"_\" + index, this.handleNotificationAction.bind(this)));\r\n                        }\r\n                        return [4, Promise.all(bunchOfPromises)];\r\n                    case 1:\r\n                        _c.sent();\r\n                        this.methodsRegistered = true;\r\n                        _c.label = 2;\r\n                    case 2:\r\n                        id = String(this.nextId++);\r\n                        notification = {\r\n                            title: options.title,\r\n                            severity: \"Medium\",\r\n                            description: options.body,\r\n                            glueRoutingDetailMethodName: this.methodNameRoot + \"_\" + STARTING_INDEX,\r\n                            actions: [],\r\n                            source: id\r\n                        };\r\n                        if (options.actions) {\r\n                            validActions = options.actions.slice(0, this.maxActions);\r\n                            index = STARTING_INDEX;\r\n                            _loop_1 = function (action) {\r\n                                var args = {\r\n                                    g42notificationId: id,\r\n                                    g42action: action.action,\r\n                                    g42interopMethod: (_a = action.interop) === null || _a === void 0 ? void 0 : _a.method,\r\n                                    g42interopTarget: (_b = action.interop) === null || _b === void 0 ? void 0 : _b.target,\r\n                                };\r\n                                var parameters = Object.keys(args).map(function (key) {\r\n                                    var value = args[key];\r\n                                    return {\r\n                                        name: key,\r\n                                        value: {\r\n                                            stringValue: value\r\n                                        }\r\n                                    };\r\n                                });\r\n                                var glueAction = {\r\n                                    name: this_1.methodNameRoot + \"_\" + index,\r\n                                    description: action.title,\r\n                                    displayName: action.title,\r\n                                    parameters: parameters\r\n                                };\r\n                                notification.actions.push(glueAction);\r\n                                index++;\r\n                            };\r\n                            this_1 = this;\r\n                            for (_i = 0, validActions_1 = validActions; _i < validActions_1.length; _i++) {\r\n                                action = validActions_1[_i];\r\n                                _loop_1(action);\r\n                            }\r\n                        }\r\n                        return [4, this.interop.invoke(\"T42.GNS.Publish.RaiseNotification\", { notification: notification })];\r\n                    case 3:\r\n                        _c.sent();\r\n                        g42notification = new Glue42Notification(options);\r\n                        this.notifications[id] = g42notification;\r\n                        return [2, g42notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.handleNotificationAction = function (args) {\r\n        if (args.g42notificationId) {\r\n            var payload_1 = args;\r\n            var id = payload_1.g42notificationId;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_1 = new Event(\"onaction\");\r\n            event_1.action = payload_1.g42action;\r\n            if (notification.onaction) {\r\n                notification.onaction(event_1);\r\n            }\r\n            var actionDefinition = (notification.actions || []).find(function (item) { return item.action === payload_1.g42action; });\r\n            var actionInterop = actionDefinition.interop;\r\n            if (actionInterop) {\r\n                this.interop.invoke(actionInterop.method, actionInterop.arguments || {}, actionInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_1);\r\n        }\r\n        else if (args.notification && args.notification.source) {\r\n            var id = args.notification.source;\r\n            var notification = this.notifications[id];\r\n            if (!notification) {\r\n                return;\r\n            }\r\n            var event_2 = new Event(\"onclick\");\r\n            if (notification.onclick) {\r\n                notification.onclick(event_2);\r\n            }\r\n            var clickInterop = notification.options.clickInterop;\r\n            if (clickInterop) {\r\n                this.interop.invoke(clickInterop.method, clickInterop.arguments || {}, clickInterop.target || \"best\");\r\n            }\r\n            notification.dispatchEvent(event_2);\r\n        }\r\n    };\r\n    return Notifications;\r\n}());\n\nvar ThemesConfigurationMethodName = \"T42.Themes.Configuration\";\r\nvar ThemesImpl = (function () {\r\n    function ThemesImpl(core) {\r\n        this.core = core;\r\n        this.registry = lib$2();\r\n        this.isSubscribed = false;\r\n        this.getConfiguration();\r\n    }\r\n    ThemesImpl.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2: return [2, (_a.sent()).returned.all];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getCurrent = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var all;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.getMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.getAll()];\r\n                    case 2:\r\n                        all = _a.sent();\r\n                        return [2, all.returned.all.find(function (t) { return t.name === all.returned.selected; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.select = function (theme) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.setMethodName) {\r\n                            throw new Error(\"not supported\");\r\n                        }\r\n                        return [4, this.core.interop.invoke(this.setMethodName, { theme: theme })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.onChanged = function (callback) {\r\n        this.subscribe();\r\n        return this.registry.add(\"changed\", callback);\r\n    };\r\n    ThemesImpl.prototype.getConfiguration = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var config, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        if (this.sharedContextName) {\r\n                            return [2];\r\n                        }\r\n                        return [4, this.core.interop.invoke(ThemesConfigurationMethodName)];\r\n                    case 1:\r\n                        config = _a.sent();\r\n                        this.sharedContextName = config.returned.sharedContextName;\r\n                        this.getMethodName = config.returned.getThemesMethodName;\r\n                        this.setMethodName = config.returned.setThemesMethodName;\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [2];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.getAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.core.interop.invoke(this.getMethodName)];\r\n                    case 2: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ThemesImpl.prototype.subscribe = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getConfiguration()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (this.isSubscribed) {\r\n                            return [2];\r\n                        }\r\n                        this.isSubscribed = true;\r\n                        this.core.contexts.subscribe(this.sharedContextName, function (data) {\r\n                            if (data && data.all && data.selected) {\r\n                                _this.registry.execute(\"changed\", data.all.find(function (t) { return t.name === data.selected; }));\r\n                            }\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ThemesImpl;\r\n}());\n\nfunction factory$2(core) {\r\n    var themes = new ThemesImpl(core);\r\n    return {\r\n        list: themes.list.bind(themes),\r\n        getCurrent: themes.getCurrent.bind(themes),\r\n        select: themes.select.bind(themes),\r\n        onChanged: themes.onChanged.bind(themes),\r\n        ready: function () { return Promise.resolve(); },\r\n    };\r\n}\n\nvar GLUE42_FDC3_INTENTS_METHOD_PREFIX = \"Tick42.FDC3.Intents.\";\r\nvar Intents = (function () {\r\n    function Intents(interop, windows, logger) {\r\n        this.interop = interop;\r\n        this.windows = windows;\r\n        this.logger = logger;\r\n    }\r\n    Intents.prototype.find = function (intentFilter) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intents, ctToLower_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        intents = _a.sent();\r\n                        if (typeof intentFilter === \"undefined\") {\r\n                            return [2, intents];\r\n                        }\r\n                        if (typeof intentFilter === \"string\") {\r\n                            return [2, intents.filter(function (intent) { return intent.name === intentFilter; })];\r\n                        }\r\n                        if (typeof intentFilter !== \"object\") {\r\n                            throw new Error(\"Please provide the intentFilter as a string or an object!\");\r\n                        }\r\n                        if (intentFilter.contextType) {\r\n                            ctToLower_1 = intentFilter.contextType.toLowerCase();\r\n                            intents = intents.filter(function (intent) { return intent.handlers.some(function (handler) { var _a; return (_a = handler.contextTypes) === null || _a === void 0 ? void 0 : _a.some(function (ct) { return ct.toLowerCase() === ctToLower_1; }); }); });\r\n                        }\r\n                        if (intentFilter.name) {\r\n                            intents = intents.filter(function (intent) { return intent.name === intentFilter.name; });\r\n                        }\r\n                        return [2, intents];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raise = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intentName, intentDef, isDynamicIntent, target, handler, anAppHandler, anInstanceHandler, instanceId, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if ((typeof intent !== \"string\" && typeof intent !== \"object\") || (typeof intent === \"object\" && typeof intent.intent !== \"string\")) {\r\n                            throw new Error(\"Please provide the intent as a string or an object with an intent property!\");\r\n                        }\r\n                        if (typeof intent === \"string\") {\r\n                            intent = {\r\n                                intent: intent\r\n                            };\r\n                        }\r\n                        intentName = intent.intent;\r\n                        return [4, this.get(intentName)];\r\n                    case 1:\r\n                        intentDef = _a.sent();\r\n                        if (typeof intentDef === \"undefined\") {\r\n                            throw new Error(\"Intent \" + intentName + \" not found.\");\r\n                        }\r\n                        isDynamicIntent = !intentDef.handlers.some(function (intentDefHandler) { return intentDefHandler.type === \"app\"; });\r\n                        target = intent.target || (isDynamicIntent ? \"reuse\" : \"startNew\");\r\n                        anAppHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\"; });\r\n                        if (target === \"startNew\") {\r\n                            handler = anAppHandler;\r\n                        }\r\n                        else if (target === \"reuse\") {\r\n                            anInstanceHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\"; });\r\n                            handler = anInstanceHandler || anAppHandler;\r\n                        }\r\n                        else if (target.instance) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\" && intentHandler.instanceId === target.instance; });\r\n                        }\r\n                        else if (target.app) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\" && intentHandler.applicationName === target.app; });\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Invalid intent target: \" + JSON.stringify(target));\r\n                        }\r\n                        if (!handler) {\r\n                            throw new Error(\"Can not raise intent for request \" + JSON.stringify(intent) + \" - can not find intent handler.\");\r\n                        }\r\n                        instanceId = handler.instanceId;\r\n                        if (!(handler.type === \"app\")) return [3, 3];\r\n                        return [4, this.startApp(handler.applicationName, intent.options)];\r\n                    case 2:\r\n                        instanceId = _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [4, this.raiseIntentToInstance(instanceId, intentName, intent.context)];\r\n                    case 4:\r\n                        result = _a.sent();\r\n                        result.request = intent;\r\n                        result.handler = handler;\r\n                        return [2, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.all = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, apps_1, intents_1, appsWithIntents, _i, appsWithIntents_1, app, _a, _b, intentDef, intent, handler, _loop_1, _c, _d, server, e_1;\r\n            var _this = this;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        _e.trys.push([0, 6, , 7]);\r\n                        return [4, this.interop.invoke(\"T42.ACS.GetApplications\", { withIntentsInfo: true })];\r\n                    case 1:\r\n                        result = _e.sent();\r\n                        apps_1 = result.returned.applications;\r\n                        intents_1 = {};\r\n                        appsWithIntents = apps_1.filter(function (app) { return app.intents && app.intents.length > 0; });\r\n                        for (_i = 0, appsWithIntents_1 = appsWithIntents; _i < appsWithIntents_1.length; _i++) {\r\n                            app = appsWithIntents_1[_i];\r\n                            for (_a = 0, _b = app.intents; _a < _b.length; _a++) {\r\n                                intentDef = _b[_a];\r\n                                intent = intents_1[intentDef.name];\r\n                                if (!intent) {\r\n                                    intent = {\r\n                                        name: intentDef.name,\r\n                                        handlers: [],\r\n                                    };\r\n                                    intents_1[intentDef.name] = intent;\r\n                                }\r\n                                handler = {\r\n                                    applicationName: app.name,\r\n                                    applicationTitle: app.title,\r\n                                    applicationDescription: app.caption,\r\n                                    displayName: intentDef.displayName,\r\n                                    contextTypes: intentDef.contexts,\r\n                                    applicationIcon: app.icon,\r\n                                    type: \"app\"\r\n                                };\r\n                                intent.handlers.push(handler);\r\n                            }\r\n                        }\r\n                        _loop_1 = function (server) {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, Promise.all(server.getMethods()\r\n                                            .filter(function (method) { return method.name.startsWith(GLUE42_FDC3_INTENTS_METHOD_PREFIX); })\r\n                                            .map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                                            var intentName, intent, info, app, appIntent, window, title, handler;\r\n                                            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\r\n                                            return __generator(this, function (_l) {\r\n                                                switch (_l.label) {\r\n                                                    case 0:\r\n                                                        intentName = method.name.replace(GLUE42_FDC3_INTENTS_METHOD_PREFIX, \"\");\r\n                                                        intent = intents_1[intentName];\r\n                                                        if (!intent) {\r\n                                                            intent = {\r\n                                                                name: intentName,\r\n                                                                handlers: [],\r\n                                                            };\r\n                                                            intents_1[intentName] = intent;\r\n                                                        }\r\n                                                        if (method.description) {\r\n                                                            try {\r\n                                                                info = JSON.parse(method.description);\r\n                                                            }\r\n                                                            catch (_m) { }\r\n                                                        }\r\n                                                        app = apps_1.find(function (appWithIntents) { return appWithIntents.name === server.application; });\r\n                                                        if (app && app.intents) {\r\n                                                            appIntent = app.intents.find(function (appDefIntent) { return appDefIntent.name === intentName; });\r\n                                                        }\r\n                                                        window = this.windows.findById(server.windowId);\r\n                                                        return [4, ((_a = window) === null || _a === void 0 ? void 0 : _a.getTitle())];\r\n                                                    case 1:\r\n                                                        title = _l.sent();\r\n                                                        handler = {\r\n                                                            instanceId: server.instance,\r\n                                                            applicationName: server.application,\r\n                                                            applicationIcon: ((_b = info) === null || _b === void 0 ? void 0 : _b.icon) || ((_c = app) === null || _c === void 0 ? void 0 : _c.icon),\r\n                                                            applicationTitle: (_d = app) === null || _d === void 0 ? void 0 : _d.title,\r\n                                                            applicationDescription: ((_e = info) === null || _e === void 0 ? void 0 : _e.description) || ((_f = app) === null || _f === void 0 ? void 0 : _f.caption),\r\n                                                            displayName: ((_g = info) === null || _g === void 0 ? void 0 : _g.displayName) || ((_h = appIntent) === null || _h === void 0 ? void 0 : _h.displayName),\r\n                                                            contextTypes: ((_j = info) === null || _j === void 0 ? void 0 : _j.contextTypes) || ((_k = appIntent) === null || _k === void 0 ? void 0 : _k.contexts),\r\n                                                            instanceTitle: title,\r\n                                                            type: \"instance\"\r\n                                                        };\r\n                                                        intent.handlers.push(handler);\r\n                                                        return [2];\r\n                                                }\r\n                                            });\r\n                                        }); }))];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        };\r\n                        _c = 0, _d = this.interop.servers();\r\n                        _e.label = 2;\r\n                    case 2:\r\n                        if (!(_c < _d.length)) return [3, 5];\r\n                        server = _d[_c];\r\n                        return [5, _loop_1(server)];\r\n                    case 3:\r\n                        _e.sent();\r\n                        _e.label = 4;\r\n                    case 4:\r\n                        _c++;\r\n                        return [3, 2];\r\n                    case 5: return [2, Object.values(intents_1)];\r\n                    case 6:\r\n                        e_1 = _e.sent();\r\n                        this.logger.error(\"Failed to get the applications!\", e_1);\r\n                        return [2, []];\r\n                    case 7: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.addIntentListener = function (intent, handler) {\r\n        var _this = this;\r\n        if ((typeof intent !== \"string\" && typeof intent !== \"object\") || (typeof intent === \"object\" && typeof intent.intent !== \"string\")) {\r\n            throw new Error(\"Please provide the intent as a string or an object with an intent property!\");\r\n        }\r\n        if (typeof handler !== \"function\") {\r\n            throw new Error(\"Please provide the handler as a function!\");\r\n        }\r\n        var result = { unsubscribe: function () { return console.log(\"Could not unsubscribe!\"); } };\r\n        var intentName = typeof intent === \"string\" ? intent : intent.intent;\r\n        var methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intentName;\r\n        var methodDescription = typeof intent === \"string\" ? undefined : JSON.stringify(intent);\r\n        this.interop.register({ name: methodName, description: methodDescription }, function (args) {\r\n            return handler(args);\r\n        }).then(function () {\r\n            result.unsubscribe = function () {\r\n                _this.interop.unregister(methodName);\r\n            };\r\n        });\r\n        return result;\r\n    };\r\n    Intents.prototype.get = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1: return [2, (_a.sent()).find(function (registeredIntent) { return registeredIntent.name === intent; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.startApp = function (application, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.interop.invoke(\"T42.ACS.StartApplication\", { Name: application, options: options })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned.Id];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raiseIntentToInstance = function (instanceId, intent, context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodName, interopServer, method, result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intent;\r\n                        interopServer = this.interop.servers().find(function (server) { return server.instance === instanceId; });\r\n                        if (!!interopServer) return [3, 2];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.serverAdded(function (server) {\r\n                                    if (server.instance === instanceId) {\r\n                                        interopServer = server;\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop server for instance \" + instanceId));\r\n                                }, 30 * 1000);\r\n                            }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        method = interopServer.getMethods().find(function (registeredMethod) { return registeredMethod.name === methodName; });\r\n                        if (!!method) return [3, 4];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.methodAdded(function (addedMethod) {\r\n                                    if (addedMethod.name === methodName) {\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop method \" + methodName + \" for instance \" + instanceId));\r\n                                }, 10 * 1000);\r\n                            }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [4, this.interop.invoke(methodName, context, { instance: instanceId })];\r\n                    case 5:\r\n                        result = _a.sent();\r\n                        return [2, {\r\n                                result: result.returned\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Intents;\r\n}());\n\nvar instances = [];\r\nvar factory$3 = function (options) { return __awaiter(void 0, void 0, void 0, function () {\r\n    function createWindows(core) {\r\n        if (glueConfig.windows) {\r\n            var windowsLogger = getLibLogger(\"windows\", core.logger, glueConfig.windows);\r\n            _windows = WindowsFactory(core.agm, windowsLogger, function () {\r\n                return _appManager;\r\n            }, gdMajorVersion);\r\n            debugLog(_windows);\r\n            return _windows;\r\n        }\r\n    }\r\n    function createActivities(core) {\r\n        if (glueConfig.activities) {\r\n            if (ActivityModule.checkIsUsingGW3Implementation && ActivityModule.checkIsUsingGW3Implementation(core.connection)) {\r\n                var activityLogger = getLibLogger(\"activity\", core.logger, glueConfig.activities);\r\n                _activity = new ActivityModule({\r\n                    connection: core.connection,\r\n                    contexts: core.contexts,\r\n                    agm: core.agm,\r\n                    logger: activityLogger,\r\n                    logLevel: \"info\",\r\n                    disableAutoAnnounce: false,\r\n                    disposeRequestHandling: \"exit\",\r\n                    announcementInfo: null,\r\n                    windows: _windows,\r\n                    appManagerGetter: function () {\r\n                        return _appManager;\r\n                    },\r\n                    mode: glueConfig.activities.mode,\r\n                    typesToTrack: glueConfig.activities.typesToTrack,\r\n                    activityId: glue42gd.activityInfo && glue42gd.activityInfo.activityId,\r\n                    gdMajorVersion: gdMajorVersion\r\n                }).api;\r\n                debugLog(_activity);\r\n                return _activity;\r\n            }\r\n        }\r\n    }\r\n    function createAppManager(core) {\r\n        if (!glueConfig.appManager) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"appManager\", core.logger, glueConfig.appManager);\r\n        _appManager = AppManagerFactory({\r\n            agm: core.agm,\r\n            windows: _windows,\r\n            logger: logger,\r\n            activities: _activity,\r\n            mode: glueConfig.appManager.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(_appManager);\r\n        return _appManager;\r\n    }\r\n    function createLayouts(core) {\r\n        var _a;\r\n        if (!glueConfig.layouts) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"layouts\", core.logger, glueConfig.layouts);\r\n        var layoutsConfig = glueConfig.layouts;\r\n        var lay = LayoutsFactory({\r\n            agm: core.agm,\r\n            appManager: _appManager,\r\n            activityGetter: function () { return _activity; },\r\n            logger: logger,\r\n            mode: layoutsConfig.mode,\r\n            autoSaveWindowContext: (_a = layoutsConfig.autoSaveWindowContext, (_a !== null && _a !== void 0 ? _a : false)),\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(lay);\r\n        return lay;\r\n    }\r\n    function createChannels(core) {\r\n        if (!glueConfig.channels) {\r\n            return;\r\n        }\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var channelsAPI = factory(core.contexts, core.agm);\r\n        debugLog(channelsAPI);\r\n        return channelsAPI;\r\n    }\r\n    function createHotkeys(core) {\r\n        var hotkeysAPI = factory$1(core.agm);\r\n        debugLog(hotkeysAPI);\r\n        return hotkeysAPI;\r\n    }\r\n    function createIntents(core) {\r\n        var intentsAPI = new Intents(core.agm, _windows, core.logger.subLogger(\"intents\"));\r\n        debugLog(intentsAPI);\r\n        return intentsAPI;\r\n    }\r\n    function createNotifications(core) {\r\n        var notificationsAPI = new Notifications(core.interop);\r\n        debugLog(notificationsAPI);\r\n        return notificationsAPI;\r\n    }\r\n    function createDisplaysApi(core) {\r\n        if (glueConfig.displays) {\r\n            var displaysLogger = getLibLogger(\"displays\", core.logger, glueConfig.displays);\r\n            _displays = new DisplayManager(core.agm, displaysLogger);\r\n            debugLog(_displays);\r\n            return _displays;\r\n        }\r\n    }\r\n    function createThemes(core) {\r\n        if (!core.contexts) {\r\n            return;\r\n        }\r\n        var themesAPI = factory$2(core);\r\n        debugLog(themesAPI);\r\n        return themesAPI;\r\n    }\r\n    function getLibLogger(loggerName, logger, config) {\r\n        var newLogger = logger.subLogger(loggerName);\r\n        if (config && config.logger) {\r\n            var loggerConfig = config.logger;\r\n            if (loggerConfig.console) {\r\n                newLogger.consoleLevel(loggerConfig.console);\r\n            }\r\n            if (loggerConfig.publish) {\r\n                newLogger.publishLevel(loggerConfig.publish);\r\n            }\r\n        }\r\n        return newLogger;\r\n    }\r\n    function debugLog(entry) {\r\n        currentLog.push(entry);\r\n    }\r\n    var glue42gd, gdMajorVersion, glueConfig, _appManager, _activity, _windows, _displays, ext, currentLog, glueApi;\r\n    var _a;\r\n    return __generator(this, function (_b) {\r\n        switch (_b.label) {\r\n            case 0:\r\n                glue42gd = typeof window !== \"undefined\" && window.glue42gd;\r\n                if (glue42gd) {\r\n                    if (instances.length > 0) {\r\n                        return [2, instances[0]];\r\n                    }\r\n                }\r\n                gdMajorVersion = Utils$1.getGDMajorVersion();\r\n                options = options || {};\r\n                glueConfig = prepareConfig$1(options);\r\n                options.gateway = options.gateway || {};\r\n                ext = {\r\n                    libs: [\r\n                        { name: \"windows\", create: createWindows },\r\n                        { name: \"activities\", create: createActivities },\r\n                        { name: \"appManager\", create: createAppManager },\r\n                        { name: \"layouts\", create: createLayouts },\r\n                        { name: \"channels\", create: createChannels },\r\n                        { name: \"hotkeys\", create: createHotkeys },\r\n                        { name: \"displays\", create: createDisplaysApi },\r\n                        { name: \"intents\", create: createIntents },\r\n                        { name: \"notifications\", create: createNotifications },\r\n                        { name: \"themes\", create: createThemes }\r\n                    ],\r\n                    version: version$2,\r\n                    enrichGlue: function (glue) {\r\n                        glue.config.activities = glueConfig.activities;\r\n                        glue.config.windows = glueConfig.windows;\r\n                        glue.config.appManager = glueConfig.appManager;\r\n                        glue.config.layouts = glueConfig.layouts;\r\n                        glue.config.channels = glueConfig.channels;\r\n                        glue.config.displays = glueConfig.displays;\r\n                    },\r\n                };\r\n                currentLog = [];\r\n                if (typeof window !== \"undefined\") {\r\n                    if (!window.glueFactoryLog) {\r\n                        window.glueFactoryLog = [];\r\n                    }\r\n                    window.glueFactoryLog.push(currentLog);\r\n                }\r\n                return [4, GlueCore(options, ext)];\r\n            case 1:\r\n                glueApi = (_b.sent());\r\n                instances.push(glueApi);\r\n                if (!(Array.isArray((_a = options) === null || _a === void 0 ? void 0 : _a.libraries) && options.libraries.length)) return [3, 3];\r\n                return [4, Promise.all(options.libraries.map(function (lib) { return lib(glueApi, options); }))];\r\n            case 2:\r\n                _b.sent();\r\n                _b.label = 3;\r\n            case 3: return [2, glueApi];\r\n        }\r\n    });\r\n}); };\r\nfactory$3.coreVersion = GlueCore.version;\r\nfactory$3.version = version$2;\r\nfactory$3.instances = instances;\n\nvar whatToExpose = factory$3;\r\nvar shouldSetToWindow = true;\r\nif (typeof window !== \"undefined\") {\r\n    var glue42gd = window.glue42gd;\r\n    if (glue42gd && glue42gd.autoInjected) {\r\n        whatToExpose = window.Glue;\r\n        shouldSetToWindow = false;\r\n    }\r\n    if (shouldSetToWindow) {\r\n        window.Glue = whatToExpose;\r\n    }\r\n    delete window.GlueCore;\r\n}\r\nwhatToExpose.default = whatToExpose;\r\nvar whatToExpose$1 = whatToExpose;\n\nexport default whatToExpose$1;\n//# sourceMappingURL=desktop.es.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar version = \"1.6.1\";\n\nfunction createCommonjsModule(fn, basedir, module) {\n\treturn module = {\n\t  path: basedir,\n\t  exports: {},\n\t  require: function (path, base) {\n      return commonjsRequire(path, (base === undefined || base === null) ? module.path : base);\n    }\n\t}, fn(module, module.exports), module.exports;\n}\n\nfunction commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nvar randomFromSeed = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed$1(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nvar alphabet_1 = {\n    get: get,\n    characters: characters,\n    seed: setSeed$1,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nvar randomByteBrowser = randomByte;\n\n// This file replaces `format.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\nvar format_browser = function (random, alphabet, size) {\n  // We cant use bytes bigger than the alphabet. To make bytes values closer\n  // to the alphabet, we apply bitmask on them. We look for the closest\n  // `2 ** x - 1` number, which will be bigger than alphabet size. If we have\n  // 30 symbols in the alphabet, we will take 31 (00011111).\n  // We do not use faster Math.clz32, because it is not available in browsers.\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1;\n  // Bitmask is not a perfect solution (in our example it will pass 31 bytes,\n  // which is bigger than the alphabet). As a result, we will need more bytes,\n  // than ID size, because we will refuse bytes bigger than the alphabet.\n\n  // Every hardware random generator call is costly,\n  // because we need to wait for entropy collection. This is why often it will\n  // be faster to ask for few extra bytes in advance, to avoid additional calls.\n\n  // Here we calculate how many random bytes should we call in advance.\n  // It depends on ID length, mask / alphabet size and magic number 1.6\n  // (which was selected according benchmarks).\n\n  // -~f => Math.ceil(f) if n is float number\n  // -~i => i + 1 if n is integer number\n  var step = -~(1.6 * mask * size / alphabet.length);\n  var id = '';\n\n  while (true) {\n    var bytes = random(step);\n    // Compact alternative for `for (var i = 0; i < step; i++)`\n    var i = step;\n    while (i--) {\n      // If random byte is bigger than alphabet even after bitmask,\n      // we refuse it by `|| ''`.\n      id += alphabet[bytes[i] & mask] || '';\n      // More compact than `id.length + 1 === size`\n      if (id.length === +size) return id\n    }\n  }\n};\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format_browser(randomByteBrowser, alphabet_1.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar generate_1 = generate;\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1567752802062;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version$1 = 7;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate_1(version$1);\n    str = str + generate_1(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate_1(counter);\n    }\n    str = str + generate_1(seconds);\n    return str;\n}\n\nvar build_1 = build;\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet_1.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nvar isValid = isShortId;\n\nvar lib = createCommonjsModule(function (module) {\n\n\n\n\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1.characters(newCharacters);\n    }\n\n    return alphabet_1.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build_1(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n});\n\nvar shortid = lib;\n\nvar RemoteWebWindow = (function () {\r\n    function RemoteWebWindow(id, name, control, windows) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.control = control;\r\n        this.windows = windows;\r\n    }\r\n    RemoteWebWindow.prototype.getURL = function () {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, this.callControl(\"getURL\", {})];\r\n                    case 1:\r\n                        result = _b.sent();\r\n                        return [2, (_a = result === null || result === void 0 ? void 0 : result.returned) === null || _a === void 0 ? void 0 : _a._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveResize = function (bounds) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", bounds, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                return [2, new Promise(function (resolve, reject) {\r\n                        var done = function () {\r\n                            if (timeout) {\r\n                                clearTimeout(timeout);\r\n                            }\r\n                            if (un) {\r\n                                un();\r\n                            }\r\n                        };\r\n                        var un = _this.windows.onWindowRemoved(function (w) {\r\n                            if (w.id === _this.id) {\r\n                                resolve(_this);\r\n                                done();\r\n                            }\r\n                        });\r\n                        var timeout = setTimeout(function () {\r\n                            reject(\"can not close window - probably not opened by your window\");\r\n                            done();\r\n                        }, 5000);\r\n                        _this.callControl(\"close\", {}, true)\r\n                            .catch(function () {\r\n                        });\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof title === \"string\") {\r\n                            title = { title: title };\r\n                        }\r\n                        return [4, this.callControl(\"setTitle\", title, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { width: width, height: height }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"moveResize\", { top: top, left: left }, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"focus\", {}, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getBounds\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getContext\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"getTitle\", {})];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2, result.returned._value];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.onContextUpdated = function (callback) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    RemoteWebWindow.prototype.updateContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"updateContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.callControl(\"setContext\", context, true)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteWebWindow.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.control.send({ command: command, domain: \"windows\", args: args, skipResult: skipResult }, { windowId: this.id })];\r\n                    case 1: return [2, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return RemoteWebWindow;\r\n}());\n\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry.default = createRegistry;\r\nvar lib$1 = createRegistry;\n\nvar Control = (function () {\r\n    function Control() {\r\n        this.callbacks = {};\r\n        this.registry = lib$1();\r\n    }\r\n    Control.prototype.start = function (interop, logger) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.interop = interop;\r\n                        this.logger = logger;\r\n                        return [4, this.interop.register(Control.CONTROL_METHOD, function (arg) { return __awaiter(_this, void 0, void 0, function () {\r\n                                var command, result, result, callback;\r\n                                return __generator(this, function (_a) {\r\n                                    command = arg;\r\n                                    logger.trace(\"received control command \" + JSON.stringify(command));\r\n                                    if (command.domain === \"windows\") {\r\n                                        if (!this.myWindow) {\r\n                                            return [2];\r\n                                        }\r\n                                        result = this.myWindow[command.command].call(this.myWindow, command.args);\r\n                                        if (command.skipResult) {\r\n                                            return [2, {}];\r\n                                        }\r\n                                        else {\r\n                                            return [2, result];\r\n                                        }\r\n                                    }\r\n                                    if (command.domain === \"appManager\") {\r\n                                        if (!this.myInstance) {\r\n                                            return [2];\r\n                                        }\r\n                                        result = this.myInstance[command.command].call(this.myInstance, command.args);\r\n                                        if (command.skipResult) {\r\n                                            return [2, {}];\r\n                                        }\r\n                                        else {\r\n                                            return [2, result];\r\n                                        }\r\n                                    }\r\n                                    if (command.domain === \"layouts\") {\r\n                                        callback = this.callbacks[command.domain];\r\n                                        if (callback) {\r\n                                            callback(command);\r\n                                        }\r\n                                    }\r\n                                    return [2];\r\n                                });\r\n                            }); })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.registry.execute(\"started\");\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Control.prototype.send = function (command, target) {\r\n        if (!this.interop) {\r\n            throw new Error(\"Control not started\");\r\n        }\r\n        this.logger.info(\"sending control command \" + JSON.stringify(command) + \" to \" + JSON.stringify(target) + \"}\");\r\n        return this.interop.invoke(Control.CONTROL_METHOD, command, target);\r\n    };\r\n    Control.prototype.subscribe = function (domain, callback) {\r\n        this.callbacks[domain] = callback;\r\n    };\r\n    Control.prototype.setLocalWindow = function (window) {\r\n        this.myWindow = window;\r\n    };\r\n    Control.prototype.setLocalInstance = function (instance) {\r\n        this.myInstance = instance;\r\n    };\r\n    Control.prototype.onStart = function (callback) {\r\n        return this.registry.add(\"started\", callback);\r\n    };\r\n    Control.CONTROL_METHOD = \"GC.Control\";\r\n    return Control;\r\n}());\n\nvar LocalWebWindow = (function () {\r\n    function LocalWebWindow(id, name, window, control, interop) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.window = window;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this.context = {};\r\n        this.registry = lib$1();\r\n        control.setLocalWindow(this);\r\n    }\r\n    LocalWebWindow.prototype.getURL = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.location.href];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveResize = function (_a) {\r\n        var left = _a.left, top = _a.top, width = _a.width, height = _a.height;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_b) {\r\n                left = left !== null && left !== void 0 ? left : window.screenLeft;\r\n                top = top !== null && top !== void 0 ? top : window.screenTop;\r\n                width = width !== null && width !== void 0 ? width : window.outerWidth;\r\n                height = height !== null && height !== void 0 ? height : window.outerHeight;\r\n                window.moveTo(left, top);\r\n                window.resizeTo(width, height);\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.close = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.parent) {\r\n                    throw new Error(\"can not close window if it's not opened by script\");\r\n                }\r\n                try {\r\n                    window.close();\r\n                }\r\n                catch (_b) {\r\n                    console.log(\"what\");\r\n                }\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.setTitle = function (title) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof title === \"object\" && title !== null) {\r\n                    title = title.title;\r\n                }\r\n                document.title = title;\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.resizeTo = function (width, height) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ width: width, height: height })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.moveTo = function (top, left) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.moveResize({ top: top, left: left })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.focus = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                window.focus();\r\n                return [2, this];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBounds = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getBoundsSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContext = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.getContextSync()];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getContextSync = function () {\r\n        return this.context;\r\n    };\r\n    LocalWebWindow.prototype.getTitle = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.window.document.title];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.onContextUpdated = function (callback) {\r\n        return this.registry.add(\"context-updated\", callback);\r\n    };\r\n    LocalWebWindow.prototype.updateContext = function (context) {\r\n        var oldContext = this.context;\r\n        this.context = Object.assign({}, oldContext, context);\r\n        this.registry.execute(\"context-updated\", this.context, oldContext);\r\n        return Promise.resolve(this);\r\n    };\r\n    LocalWebWindow.prototype.setContext = function (context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var oldContext;\r\n            return __generator(this, function (_a) {\r\n                oldContext = this.context;\r\n                this.context = Object.assign({}, context);\r\n                this.registry.execute(\"context-updated\", context, oldContext);\r\n                return [2, Promise.resolve(this)];\r\n            });\r\n        });\r\n    };\r\n    LocalWebWindow.prototype.getBoundsSync = function () {\r\n        return {\r\n            left: this.window.screenLeft,\r\n            top: this.window.screenTop,\r\n            width: this.window.outerWidth,\r\n            height: this.window.outerHeight\r\n        };\r\n    };\r\n    return LocalWebWindow;\r\n}());\n\nvar ChildWebWindow = (function (_super) {\r\n    __extends(ChildWebWindow, _super);\r\n    function ChildWebWindow(window, id, name, control, windows) {\r\n        var _this = _super.call(this, id, name, control, windows) || this;\r\n        _this.window = window;\r\n        _this.id = id;\r\n        _this.name = name;\r\n        return _this;\r\n    }\r\n    return ChildWebWindow;\r\n}(RemoteWebWindow));\n\nvar createMethodName = function (id) { return \"\\\"GC.Wnd.\\\"\" + id; };\r\nvar registerChildStartupContext = function (interop, parent, id, name, options) {\r\n    var _a;\r\n    var methodName = createMethodName(id);\r\n    var startingContext = {\r\n        context: (_a = options === null || options === void 0 ? void 0 : options.context) !== null && _a !== void 0 ? _a : {},\r\n        name: name,\r\n        parent: parent\r\n    };\r\n    interop.register(methodName, function () { return startingContext; });\r\n};\r\nvar initStartupContext = function (my, interop, instance) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var methodName, result;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                methodName = createMethodName(my.id);\r\n                if (!interop.methods().find(function (m) { return m.name === methodName; })) return [3, 2];\r\n                return [4, interop.invoke(methodName)];\r\n            case 1:\r\n                result = _a.sent();\r\n                if (my) {\r\n                    my.setContext(result.returned.context);\r\n                    my.name = result.returned.name;\r\n                    my.parent = result.returned.parent;\r\n                    if (instance) {\r\n                        instance.startedByScript = true;\r\n                        instance.context = result.returned.context;\r\n                    }\r\n                }\r\n                _a.label = 2;\r\n            case 2: return [2];\r\n        }\r\n    });\r\n}); };\n\nvar Windows = (function () {\r\n    function Windows(interop, control) {\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.registry = lib$1();\r\n        this.childWindows = [];\r\n        var id = interop.instance.windowId;\r\n        var name = \"document.title (\" + shortid() + \")\";\r\n        this.myWindow = new LocalWebWindow(id, name, window, this.control, this.interop);\r\n        this.trackWindowsLifetime();\r\n    }\r\n    Windows.prototype.list = function () {\r\n        var _this = this;\r\n        var method = this.interop.methods({ name: Control.CONTROL_METHOD })[0];\r\n        if (!method) {\r\n            return [];\r\n        }\r\n        var servers = method.getServers ? method.getServers() : [];\r\n        return servers.reduce(function (prev, current) {\r\n            var remoteWindow = _this.remoteFromServer(current);\r\n            if (remoteWindow) {\r\n                prev.push(remoteWindow);\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Windows.prototype.findById = function (id) {\r\n        return this.list().find(function (w) { return w.id === id; });\r\n    };\r\n    Windows.prototype.my = function () {\r\n        return this.myWindow;\r\n    };\r\n    Windows.prototype.open = function (name, url, options) {\r\n        var _a, _b, _c, _d, _e;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var width, height, left, top, id, relativeWindowId_1, relativeWindow, relativeWindowBounds, relativeDir, newBounds, optionsString, newWindow, remoteWindow;\r\n            return __generator(this, function (_f) {\r\n                switch (_f.label) {\r\n                    case 0:\r\n                        width = (_a = options === null || options === void 0 ? void 0 : options.width) !== null && _a !== void 0 ? _a : 400;\r\n                        height = (_b = options === null || options === void 0 ? void 0 : options.height) !== null && _b !== void 0 ? _b : 400;\r\n                        left = (_c = options === null || options === void 0 ? void 0 : options.left) !== null && _c !== void 0 ? _c : window.screen.availWidth - window.screenLeft;\r\n                        top = (_d = options === null || options === void 0 ? void 0 : options.top) !== null && _d !== void 0 ? _d : 0;\r\n                        id = shortid();\r\n                        registerChildStartupContext(this.interop, this.my().id, id, name, options);\r\n                        if (!(options === null || options === void 0 ? void 0 : options.relativeTo)) return [3, 2];\r\n                        relativeWindowId_1 = options.relativeTo;\r\n                        relativeWindow = this.list().find(function (w) { return w.id === relativeWindowId_1; });\r\n                        if (!relativeWindow) return [3, 2];\r\n                        return [4, relativeWindow.getBounds()];\r\n                    case 1:\r\n                        relativeWindowBounds = _f.sent();\r\n                        relativeDir = (_e = options.relativeDirection) !== null && _e !== void 0 ? _e : \"right\";\r\n                        newBounds = this.getRelativeBounds({ width: width, height: height, left: left, top: top }, relativeWindowBounds, relativeDir);\r\n                        width = newBounds.width;\r\n                        height = newBounds.height;\r\n                        left = newBounds.left;\r\n                        top = newBounds.top;\r\n                        _f.label = 2;\r\n                    case 2:\r\n                        optionsString = \"width=\" + width + \",height=\" + height + \",left=\" + left + \",top=\" + top + \",scrollbars=none,location=no,status=no,menubar=no\";\r\n                        newWindow = window.open(url, id, optionsString);\r\n                        if (!newWindow) {\r\n                            throw new Error(\"failed to open a window with url=\" + url + \" and options=\" + optionsString);\r\n                        }\r\n                        newWindow.focus();\r\n                        newWindow.moveTo(left, top);\r\n                        newWindow.resizeTo(width, height);\r\n                        remoteWindow = new ChildWebWindow(newWindow, id, name, this.control, this);\r\n                        this.childWindows.push(remoteWindow);\r\n                        return [2, remoteWindow];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Windows.prototype.onWindowAdded = function (callback) {\r\n        return this.registry.add(\"window-added\", callback);\r\n    };\r\n    Windows.prototype.onWindowRemoved = function (callback) {\r\n        return this.registry.add(\"window-removed\", callback);\r\n    };\r\n    Windows.prototype.getChildWindows = function () {\r\n        this.childWindows = this.childWindows.filter(function (cw) { return !cw.window.closed; });\r\n        return this.childWindows;\r\n    };\r\n    Windows.prototype.remoteFromServer = function (server) {\r\n        var _a;\r\n        if (!server.windowId) {\r\n            return undefined;\r\n        }\r\n        return new RemoteWebWindow(server.windowId, (_a = server.application) !== null && _a !== void 0 ? _a : \"\", this.control, this);\r\n    };\r\n    Windows.prototype.getRelativeBounds = function (rect, relativeTo, relativeDirection) {\r\n        var edgeDistance = 0;\r\n        switch (relativeDirection) {\r\n            case \"bottom\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top + relativeTo.height + edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"top\":\r\n                return {\r\n                    left: relativeTo.left,\r\n                    top: relativeTo.top - rect.height - edgeDistance,\r\n                    width: relativeTo.width,\r\n                    height: rect.height\r\n                };\r\n            case \"right\":\r\n                return {\r\n                    left: relativeTo.left + relativeTo.width + edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n            case \"left\":\r\n                return {\r\n                    left: relativeTo.left - rect.width - edgeDistance,\r\n                    top: relativeTo.top,\r\n                    width: rect.width,\r\n                    height: relativeTo.height\r\n                };\r\n        }\r\n        throw new Error(\"invalid relativeDirection\");\r\n    };\r\n    Windows.prototype.trackWindowsLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            if (method.name !== Control.CONTROL_METHOD) {\r\n                return;\r\n            }\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-added\", remoteWindow);\r\n            }\r\n        });\r\n        this.interop.serverRemoved(function (server) {\r\n            var remoteWindow = _this.remoteFromServer(server);\r\n            if (remoteWindow) {\r\n                _this.registry.execute(\"window-removed\", remoteWindow);\r\n            }\r\n        });\r\n    };\r\n    return Windows;\r\n}());\n\n/**\r\n * Wraps values in an `Ok` type.\r\n *\r\n * Example: `ok(5) // => {ok: true, result: 5}`\r\n */\r\nvar ok = function (result) { return ({ ok: true, result: result }); };\r\n/**\r\n * Typeguard for `Ok`.\r\n */\r\nvar isOk = function (r) { return r.ok === true; };\r\n/**\r\n * Wraps errors in an `Err` type.\r\n *\r\n * Example: `err('on fire') // => {ok: false, error: 'on fire'}`\r\n */\r\nvar err = function (error) { return ({ ok: false, error: error }); };\r\n/**\r\n * Typeguard for `Err`.\r\n */\r\nvar isErr = function (r) { return r.ok === false; };\r\n/**\r\n * Create a `Promise` that either resolves with the result of `Ok` or rejects\r\n * with the error of `Err`.\r\n */\r\nvar asPromise = function (r) {\r\n    return r.ok === true ? Promise.resolve(r.result) : Promise.reject(r.error);\r\n};\r\n/**\r\n * Unwraps a `Result` and returns either the result of an `Ok`, or\r\n * `defaultValue`.\r\n *\r\n * Example:\r\n * ```\r\n * Result.withDefault(5, number().run(json))\r\n * ```\r\n *\r\n * It would be nice if `Decoder` had an instance method that mirrored this\r\n * function. Such a method would look something like this:\r\n * ```\r\n * class Decoder<A> {\r\n *   runWithDefault = (defaultValue: A, json: any): A =>\r\n *     Result.withDefault(defaultValue, this.run(json));\r\n * }\r\n *\r\n * number().runWithDefault(5, json)\r\n * ```\r\n * Unfortunately, the type of `defaultValue: A` on the method causes issues\r\n * with type inference on  the `object` decoder in some situations. While these\r\n * inference issues can be solved by providing the optional type argument for\r\n * `object`s, the extra trouble and confusion doesn't seem worth it.\r\n */\r\nvar withDefault = function (defaultValue, r) {\r\n    return r.ok === true ? r.result : defaultValue;\r\n};\r\n/**\r\n * Return the successful result, or throw an error.\r\n */\r\nvar withException = function (r) {\r\n    if (r.ok === true) {\r\n        return r.result;\r\n    }\r\n    else {\r\n        throw r.error;\r\n    }\r\n};\r\n/**\r\n * Given an array of `Result`s, return the successful values.\r\n */\r\nvar successes = function (results) {\r\n    return results.reduce(function (acc, r) { return (r.ok === true ? acc.concat(r.result) : acc); }, []);\r\n};\r\n/**\r\n * Apply `f` to the result of an `Ok`, or pass the error through.\r\n */\r\nvar map = function (f, r) {\r\n    return r.ok === true ? ok(f(r.result)) : r;\r\n};\r\n/**\r\n * Apply `f` to the result of two `Ok`s, or pass an error through. If both\r\n * `Result`s are errors then the first one is returned.\r\n */\r\nvar map2 = function (f, ar, br) {\r\n    return ar.ok === false ? ar :\r\n        br.ok === false ? br :\r\n            ok(f(ar.result, br.result));\r\n};\r\n/**\r\n * Apply `f` to the error of an `Err`, or pass the success through.\r\n */\r\nvar mapError = function (f, r) {\r\n    return r.ok === true ? r : err(f(r.error));\r\n};\r\n/**\r\n * Chain together a sequence of computations that may fail, similar to a\r\n * `Promise`. If the first computation fails then the error will propagate\r\n * through. If it succeeds, then `f` will be applied to the value, returning a\r\n * new `Result`.\r\n */\r\nvar andThen = function (f, r) {\r\n    return r.ok === true ? f(r.result) : r;\r\n};\r\n\n\nvar result = Object.freeze({\n\tok: ok,\n\tisOk: isOk,\n\terr: err,\n\tisErr: isErr,\n\tasPromise: asPromise,\n\twithDefault: withDefault,\n\twithException: withException,\n\tsuccesses: successes,\n\tmap: map,\n\tmap2: map2,\n\tmapError: mapError,\n\tandThen: andThen\n});\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign$1 = function() {\r\n    __assign$1 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$1.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction isEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a === null && b === null) {\r\n        return true;\r\n    }\r\n    if (typeof (a) !== typeof (b)) {\r\n        return false;\r\n    }\r\n    if (typeof (a) === 'object') {\r\n        // Array\r\n        if (Array.isArray(a)) {\r\n            if (!Array.isArray(b)) {\r\n                return false;\r\n            }\r\n            if (a.length !== b.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (!isEqual(a[i], b[i])) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        // Hash table\r\n        var keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!b.hasOwnProperty(keys[i])) {\r\n                return false;\r\n            }\r\n            if (!isEqual(a[keys[i]], b[keys[i]])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n/*\r\n * Helpers\r\n */\r\nvar isJsonArray = function (json) { return Array.isArray(json); };\r\nvar isJsonObject = function (json) {\r\n    return typeof json === 'object' && json !== null && !isJsonArray(json);\r\n};\r\nvar typeString = function (json) {\r\n    switch (typeof json) {\r\n        case 'string':\r\n            return 'a string';\r\n        case 'number':\r\n            return 'a number';\r\n        case 'boolean':\r\n            return 'a boolean';\r\n        case 'undefined':\r\n            return 'undefined';\r\n        case 'object':\r\n            if (json instanceof Array) {\r\n                return 'an array';\r\n            }\r\n            else if (json === null) {\r\n                return 'null';\r\n            }\r\n            else {\r\n                return 'an object';\r\n            }\r\n        default:\r\n            return JSON.stringify(json);\r\n    }\r\n};\r\nvar expectedGot = function (expected, got) {\r\n    return \"expected \" + expected + \", got \" + typeString(got);\r\n};\r\nvar printPath = function (paths) {\r\n    return paths.map(function (path) { return (typeof path === 'string' ? \".\" + path : \"[\" + path + \"]\"); }).join('');\r\n};\r\nvar prependAt = function (newAt, _a) {\r\n    var at = _a.at, rest = __rest(_a, [\"at\"]);\r\n    return (__assign$1({ at: newAt + (at || '') }, rest));\r\n};\r\n/**\r\n * Decoders transform json objects with unknown structure into known and\r\n * verified forms. You can create objects of type `Decoder<A>` with either the\r\n * primitive decoder functions, such as `boolean()` and `string()`, or by\r\n * applying higher-order decoders to the primitives, such as `array(boolean())`\r\n * or `dict(string())`.\r\n *\r\n * Each of the decoder functions are available both as a static method on\r\n * `Decoder` and as a function alias -- for example the string decoder is\r\n * defined at `Decoder.string()`, but is also aliased to `string()`. Using the\r\n * function aliases exported with the library is recommended.\r\n *\r\n * `Decoder` exposes a number of 'run' methods, which all decode json in the\r\n * same way, but communicate success and failure in different ways. The `map`\r\n * and `andThen` methods modify decoders without having to call a 'run' method.\r\n *\r\n * Alternatively, the main decoder `run()` method returns an object of type\r\n * `Result<A, DecoderError>`. This library provides a number of helper\r\n * functions for dealing with the `Result` type, so you can do all the same\r\n * things with a `Result` as with the decoder methods.\r\n */\r\nvar Decoder = /** @class */ (function () {\r\n    /**\r\n     * The Decoder class constructor is kept private to separate the internal\r\n     * `decode` function from the external `run` function. The distinction\r\n     * between the two functions is that `decode` returns a\r\n     * `Partial<DecoderError>` on failure, which contains an unfinished error\r\n     * report. When `run` is called on a decoder, the relevant series of `decode`\r\n     * calls is made, and then on failure the resulting `Partial<DecoderError>`\r\n     * is turned into a `DecoderError` by filling in the missing information.\r\n     *\r\n     * While hiding the constructor may seem restrictive, leveraging the\r\n     * provided decoder combinators and helper functions such as\r\n     * `andThen` and `map` should be enough to build specialized decoders as\r\n     * needed.\r\n     */\r\n    function Decoder(decode) {\r\n        var _this = this;\r\n        this.decode = decode;\r\n        /**\r\n         * Run the decoder and return a `Result` with either the decoded value or a\r\n         * `DecoderError` containing the json input, the location of the error, and\r\n         * the error message.\r\n         *\r\n         * Examples:\r\n         * ```\r\n         * number().run(12)\r\n         * // => {ok: true, result: 12}\r\n         *\r\n         * string().run(9001)\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {\r\n         * //     kind: 'DecoderError',\r\n         * //     input: 9001,\r\n         * //     at: 'input',\r\n         * //     message: 'expected a string, got 9001'\r\n         * //   }\r\n         * // }\r\n         * ```\r\n         */\r\n        this.run = function (json) {\r\n            return mapError(function (error) { return ({\r\n                kind: 'DecoderError',\r\n                input: json,\r\n                at: 'input' + (error.at || ''),\r\n                message: error.message || ''\r\n            }); }, _this.decode(json));\r\n        };\r\n        /**\r\n         * Run the decoder as a `Promise`.\r\n         */\r\n        this.runPromise = function (json) { return asPromise(_this.run(json)); };\r\n        /**\r\n         * Run the decoder and return the value on success, or throw an exception\r\n         * with a formatted error string.\r\n         */\r\n        this.runWithException = function (json) { return withException(_this.run(json)); };\r\n        /**\r\n         * Construct a new decoder that applies a transformation to the decoded\r\n         * result. If the decoder succeeds then `f` will be applied to the value. If\r\n         * it fails the error will propagated through.\r\n         *\r\n         * Example:\r\n         * ```\r\n         * number().map(x => x * 5).run(10)\r\n         * // => {ok: true, result: 50}\r\n         * ```\r\n         */\r\n        this.map = function (f) {\r\n            return new Decoder(function (json) { return map(f, _this.decode(json)); });\r\n        };\r\n        /**\r\n         * Chain together a sequence of decoders. The first decoder will run, and\r\n         * then the function will determine what decoder to run second. If the result\r\n         * of the first decoder succeeds then `f` will be applied to the decoded\r\n         * value. If it fails the error will propagate through.\r\n         *\r\n         * This is a very powerful method -- it can act as both the `map` and `where`\r\n         * methods, can improve error messages for edge cases, and can be used to\r\n         * make a decoder for custom types.\r\n         *\r\n         * Example of adding an error message:\r\n         * ```\r\n         * const versionDecoder = valueAt(['version'], number());\r\n         * const infoDecoder3 = object({a: boolean()});\r\n         *\r\n         * const decoder = versionDecoder.andThen(version => {\r\n         *   switch (version) {\r\n         *     case 3:\r\n         *       return infoDecoder3;\r\n         *     default:\r\n         *       return fail(`Unable to decode info, version ${version} is not supported.`);\r\n         *   }\r\n         * });\r\n         *\r\n         * decoder.run({version: 3, a: true})\r\n         * // => {ok: true, result: {a: true}}\r\n         *\r\n         * decoder.run({version: 5, x: 'abc'})\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {... message: 'Unable to decode info, version 5 is not supported.'}\r\n         * // }\r\n         * ```\r\n         *\r\n         * Example of decoding a custom type:\r\n         * ```\r\n         * // nominal type for arrays with a length of at least one\r\n         * type NonEmptyArray<T> = T[] & { __nonEmptyArrayBrand__: void };\r\n         *\r\n         * const nonEmptyArrayDecoder = <T>(values: Decoder<T>): Decoder<NonEmptyArray<T>> =>\r\n         *   array(values).andThen(arr =>\r\n         *     arr.length > 0\r\n         *       ? succeed(createNonEmptyArray(arr))\r\n         *       : fail(`expected a non-empty array, got an empty array`)\r\n         *   );\r\n         * ```\r\n         */\r\n        this.andThen = function (f) {\r\n            return new Decoder(function (json) {\r\n                return andThen(function (value) { return f(value).decode(json); }, _this.decode(json));\r\n            });\r\n        };\r\n        /**\r\n         * Add constraints to a decoder _without_ changing the resulting type. The\r\n         * `test` argument is a predicate function which returns true for valid\r\n         * inputs. When `test` fails on an input, the decoder fails with the given\r\n         * `errorMessage`.\r\n         *\r\n         * ```\r\n         * const chars = (length: number): Decoder<string> =>\r\n         *   string().where(\r\n         *     (s: string) => s.length === length,\r\n         *     `expected a string of length ${length}`\r\n         *   );\r\n         *\r\n         * chars(5).run('12345')\r\n         * // => {ok: true, result: '12345'}\r\n         *\r\n         * chars(2).run('HELLO')\r\n         * // => {ok: false, error: {... message: 'expected a string of length 2'}}\r\n         *\r\n         * chars(12).run(true)\r\n         * // => {ok: false, error: {... message: 'expected a string, got a boolean'}}\r\n         * ```\r\n         */\r\n        this.where = function (test, errorMessage) {\r\n            return _this.andThen(function (value) { return (test(value) ? Decoder.succeed(value) : Decoder.fail(errorMessage)); });\r\n        };\r\n    }\r\n    /**\r\n     * Decoder primitive that validates strings, and fails on all other input.\r\n     */\r\n    Decoder.string = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'string'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a string', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates numbers, and fails on all other input.\r\n     */\r\n    Decoder.number = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'number'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a number', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates booleans, and fails on all other input.\r\n     */\r\n    Decoder.boolean = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'boolean'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a boolean', json) });\r\n        });\r\n    };\r\n    Decoder.constant = function (value) {\r\n        return new Decoder(function (json) {\r\n            return isEqual(json, value)\r\n                ? ok(value)\r\n                : err({ message: \"expected \" + JSON.stringify(value) + \", got \" + JSON.stringify(json) });\r\n        });\r\n    };\r\n    Decoder.object = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json) && decoders) {\r\n                var obj = {};\r\n                for (var key in decoders) {\r\n                    if (decoders.hasOwnProperty(key)) {\r\n                        var r = decoders[key].decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            // tslint:disable-next-line:strict-type-predicates\r\n                            if (r.result !== undefined) {\r\n                                obj[key] = r.result;\r\n                            }\r\n                        }\r\n                        else if (json[key] === undefined) {\r\n                            return err({ message: \"the key '\" + key + \"' is required but was not present\" });\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else if (isJsonObject(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.array = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json) && decoder) {\r\n                var decodeValue_1 = function (v, i) {\r\n                    return mapError(function (err$$1) { return prependAt(\"[\" + i + \"]\", err$$1); }, decoder.decode(v));\r\n                };\r\n                return json.reduce(function (acc, v, i) {\r\n                    return map2(function (arr, result) { return arr.concat([result]); }, acc, decodeValue_1(v, i));\r\n                }, ok([]));\r\n            }\r\n            else if (isJsonArray(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an array', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.tuple = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json)) {\r\n                if (json.length !== decoders.length) {\r\n                    return err({\r\n                        message: \"expected a tuple of length \" + decoders.length + \", got one of length \" + json.length\r\n                    });\r\n                }\r\n                var result = [];\r\n                for (var i = 0; i < decoders.length; i++) {\r\n                    var nth = decoders[i].decode(json[i]);\r\n                    if (nth.ok) {\r\n                        result[i] = nth.result;\r\n                    }\r\n                    else {\r\n                        return err(prependAt(\"[\" + i + \"]\", nth.error));\r\n                    }\r\n                }\r\n                return ok(result);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot(\"a tuple of length \" + decoders.length, json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.union = function (ad, bd) {\r\n        var decoders = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            decoders[_i - 2] = arguments[_i];\r\n        }\r\n        return Decoder.oneOf.apply(Decoder, [ad, bd].concat(decoders));\r\n    };\r\n    Decoder.intersection = function (ad, bd) {\r\n        var ds = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            ds[_i - 2] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            return [ad, bd].concat(ds).reduce(function (acc, decoder) { return map2(Object.assign, acc, decoder.decode(json)); }, ok({}));\r\n        });\r\n    };\r\n    /**\r\n     * Escape hatch to bypass validation. Always succeeds and types the result as\r\n     * `any`. Useful for defining decoders incrementally, particularly for\r\n     * complex objects.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   name: string;\r\n     *   complexUserData: ComplexType;\r\n     * }\r\n     *\r\n     * const userDecoder: Decoder<User> = object({\r\n     *   name: string(),\r\n     *   complexUserData: anyJson()\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.anyJson = function () { return new Decoder(function (json) { return ok(json); }); };\r\n    /**\r\n     * Decoder identity function which always succeeds and types the result as\r\n     * `unknown`.\r\n     */\r\n    Decoder.unknownJson = function () {\r\n        return new Decoder(function (json) { return ok(json); });\r\n    };\r\n    /**\r\n     * Decoder for json objects where the keys are unknown strings, but the values\r\n     * should all be of the same type.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * dict(number()).run({chocolate: 12, vanilla: 10, mint: 37});\r\n     * // => {ok: true, result: {chocolate: 12, vanilla: 10, mint: 37}}\r\n     * ```\r\n     */\r\n    Decoder.dict = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json)) {\r\n                var obj = {};\r\n                for (var key in json) {\r\n                    if (json.hasOwnProperty(key)) {\r\n                        var r = decoder.decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            obj[key] = r.result;\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Decoder for values that may be `undefined`. This is primarily helpful for\r\n     * decoding interfaces with optional fields.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   id: number;\r\n     *   isOwner?: boolean;\r\n     * }\r\n     *\r\n     * const decoder: Decoder<User> = object({\r\n     *   id: number(),\r\n     *   isOwner: optional(boolean())\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.optional = function (decoder) {\r\n        return new Decoder(function (json) { return (json === undefined ? ok(undefined) : decoder.decode(json)); });\r\n    };\r\n    /**\r\n     * Decoder that attempts to run each decoder in `decoders` and either succeeds\r\n     * with the first successful decoder, or fails after all decoders have failed.\r\n     *\r\n     * Note that `oneOf` expects the decoders to all have the same return type,\r\n     * while `union` creates a decoder for the union type of all the input\r\n     * decoders.\r\n     *\r\n     * Examples:\r\n     * ```\r\n     * oneOf(string(), number().map(String))\r\n     * oneOf(constant('start'), constant('stop'), succeed('unknown'))\r\n     * ```\r\n     */\r\n    Decoder.oneOf = function () {\r\n        var decoders = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            decoders[_i] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            var errors = [];\r\n            for (var i = 0; i < decoders.length; i++) {\r\n                var r = decoders[i].decode(json);\r\n                if (r.ok === true) {\r\n                    return r;\r\n                }\r\n                else {\r\n                    errors[i] = r.error;\r\n                }\r\n            }\r\n            var errorsList = errors\r\n                .map(function (error) { return \"at error\" + (error.at || '') + \": \" + error.message; })\r\n                .join('\", \"');\r\n            return err({\r\n                message: \"expected a value matching one of the decoders, got the errors [\\\"\" + errorsList + \"\\\"]\"\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that always succeeds with either the decoded value, or a fallback\r\n     * default value.\r\n     */\r\n    Decoder.withDefault = function (defaultValue, decoder) {\r\n        return new Decoder(function (json) {\r\n            return ok(withDefault(defaultValue, decoder.decode(json)));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that pulls a specific field out of a json structure, instead of\r\n     * decoding and returning the full structure. The `paths` array describes the\r\n     * object keys and array indices to traverse, so that values can be pulled out\r\n     * of a nested structure.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * const decoder = valueAt(['a', 'b', 0], string());\r\n     *\r\n     * decoder.run({a: {b: ['surprise!']}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * decoder.run({a: {x: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b[0]' message: 'path does not exist'}}\r\n     * ```\r\n     *\r\n     * Note that the `decoder` is ran on the value found at the last key in the\r\n     * path, even if the last key is not found. This allows the `optional`\r\n     * decoder to succeed when appropriate.\r\n     * ```\r\n     * const optionalDecoder = valueAt(['a', 'b', 'c'], optional(string()));\r\n     *\r\n     * optionalDecoder.run({a: {b: {c: 'surprise!'}}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * optionalDecoder.run({a: {b: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b.c' message: 'expected an object, got \"cats\"'}\r\n     *\r\n     * optionalDecoder.run({a: {b: {z: 1}}})\r\n     * // => {ok: true, result: undefined}\r\n     * ```\r\n     */\r\n    Decoder.valueAt = function (paths, decoder) {\r\n        return new Decoder(function (json) {\r\n            var jsonAtPath = json;\r\n            for (var i = 0; i < paths.length; i++) {\r\n                if (jsonAtPath === undefined) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: 'path does not exist'\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'string' && !isJsonObject(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an object', jsonAtPath)\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'number' && !isJsonArray(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an array', jsonAtPath)\r\n                    });\r\n                }\r\n                else {\r\n                    jsonAtPath = jsonAtPath[paths[i]];\r\n                }\r\n            }\r\n            return mapError(function (error) {\r\n                return jsonAtPath === undefined\r\n                    ? { at: printPath(paths), message: 'path does not exist' }\r\n                    : prependAt(printPath(paths), error);\r\n            }, decoder.decode(jsonAtPath));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always succeeds with `fixedValue`.\r\n     */\r\n    Decoder.succeed = function (fixedValue) {\r\n        return new Decoder(function (json) { return ok(fixedValue); });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always fails with `errorMessage`.\r\n     */\r\n    Decoder.fail = function (errorMessage) {\r\n        return new Decoder(function (json) { return err({ message: errorMessage }); });\r\n    };\r\n    /**\r\n     * Decoder that allows for validating recursive data structures. Unlike with\r\n     * functions, decoders assigned to variables can't reference themselves\r\n     * before they are fully defined. We can avoid prematurely referencing the\r\n     * decoder by wrapping it in a function that won't be called until use, at\r\n     * which point the decoder has been defined.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface Comment {\r\n     *   msg: string;\r\n     *   replies: Comment[];\r\n     * }\r\n     *\r\n     * const decoder: Decoder<Comment> = object({\r\n     *   msg: string(),\r\n     *   replies: lazy(() => array(decoder))\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.lazy = function (mkDecoder) {\r\n        return new Decoder(function (json) { return mkDecoder().decode(json); });\r\n    };\r\n    return Decoder;\r\n}());\n\n/* tslint:disable:variable-name */\r\n/** See `Decoder.string` */\r\nvar string = Decoder.string;\r\n/** See `Decoder.number` */\r\nvar number = Decoder.number;\r\n/** See `Decoder.boolean` */\r\nvar boolean = Decoder.boolean;\r\n/** See `Decoder.anyJson` */\r\nvar anyJson = Decoder.anyJson;\r\n/** See `Decoder.constant` */\r\nvar constant = Decoder.constant;\r\n/** See `Decoder.object` */\r\nvar object = Decoder.object;\r\n/** See `Decoder.array` */\r\nvar array = Decoder.array;\r\n/** See `Decoder.optional` */\r\nvar optional = Decoder.optional;\r\n/** See `Decoder.oneOf` */\r\nvar oneOf = Decoder.oneOf;\r\n/** See `Decoder.lazy` */\r\nvar lazy = Decoder.lazy;\n\nvar nonEmptyStringDecoder = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\n\nvar windowLayoutItemDecoder = object({\r\n    type: constant(\"window\"),\r\n    config: object({\r\n        appName: nonEmptyStringDecoder,\r\n        url: optional(nonEmptyStringDecoder)\r\n    })\r\n});\r\nvar groupLayoutItemDecoder = object({\r\n    type: constant(\"group\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(windowLayoutItemDecoder))\r\n});\r\nvar columnLayoutItemDecoder = object({\r\n    type: constant(\"column\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return columnLayoutItemDecoder; }), lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar rowLayoutItemDecoder = object({\r\n    type: constant(\"row\"),\r\n    config: anyJson(),\r\n    children: array(oneOf(columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder, lazy(function () { return rowLayoutItemDecoder; })))\r\n});\r\nvar workspaceComponentDecoder = object({\r\n    type: constant(\"Workspace\"),\r\n    state: object({\r\n        config: anyJson(),\r\n        context: anyJson(),\r\n        children: array(oneOf(rowLayoutItemDecoder, columnLayoutItemDecoder, groupLayoutItemDecoder, windowLayoutItemDecoder))\r\n    })\r\n});\n\nvar windowComponentDecoder = object({\r\n    type: constant(\"window\"),\r\n    componentType: constant(\"application\"),\r\n    state: object({\r\n        name: anyJson(),\r\n        context: anyJson(),\r\n        url: nonEmptyStringDecoder,\r\n        bounds: anyJson(),\r\n        id: nonEmptyStringDecoder,\r\n        parentId: optional(nonEmptyStringDecoder),\r\n        main: boolean()\r\n    })\r\n});\n\nvar layoutTypeDecoder = oneOf(constant(\"Global\"), constant(\"Workspace\"));\r\nvar newLayoutOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson())\r\n});\r\nvar restoreOptionsDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    context: optional(anyJson()),\r\n    closeRunningInstance: optional(boolean())\r\n});\r\nvar layoutDecoder = object({\r\n    name: nonEmptyStringDecoder,\r\n    type: layoutTypeDecoder,\r\n    context: optional(anyJson()),\r\n    metadata: optional(anyJson()),\r\n    components: array(oneOf(workspaceComponentDecoder, windowComponentDecoder))\r\n});\n\nvar Layouts = (function () {\r\n    function Layouts(controller) {\r\n        this.controller = controller;\r\n    }\r\n    Layouts.prototype.ready = function () {\r\n        return this.controller.ready();\r\n    };\r\n    Layouts.prototype.getAll = function (type) {\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.getAll(type);\r\n    };\r\n    Layouts.prototype.get = function (name, type) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.get(name, type);\r\n    };\r\n    Layouts.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (layoutType) {\r\n                    layoutTypeDecoder.runWithException(layoutType);\r\n                }\r\n                return [2, this.controller.export(layoutType)];\r\n            });\r\n        });\r\n    };\r\n    Layouts.prototype.import = function (layouts) {\r\n        layouts.forEach(function (layout) { return layoutDecoder.runWithException(layout); });\r\n        return this.controller.import(layouts);\r\n    };\r\n    Layouts.prototype.save = function (layout) {\r\n        newLayoutOptionsDecoder.runWithException(layout);\r\n        return this.controller.save(layout);\r\n    };\r\n    Layouts.prototype.restore = function (options) {\r\n        restoreOptionsDecoder.runWithException(options);\r\n        return this.controller.restore(options);\r\n    };\r\n    Layouts.prototype.remove = function (type, name) {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        layoutTypeDecoder.runWithException(type);\r\n        return this.controller.remove(type, name);\r\n    };\r\n    Layouts.prototype.onAdded = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutAdded(callback);\r\n    };\r\n    Layouts.prototype.onChanged = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutChanged(callback);\r\n    };\r\n    Layouts.prototype.onRemoved = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"The provided callback must be of type 'function'\");\r\n        }\r\n        return this.controller.onLayoutRemoved(callback);\r\n    };\r\n    return Layouts;\r\n}());\n\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n        this.setContextDataToEmptyObjIfMissing = function (context) {\r\n            return __assign(__assign({}, context), { data: context.data || {} });\r\n        };\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.subscribeFor = function (name, callback) {\r\n        var _this = this;\r\n        if (!this.isChannel(name)) {\r\n            return Promise.reject(new Error(\"Channel with name: \" + name + \" doesn't exist!\"));\r\n        }\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n            var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n            callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        contextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4, this.contexts.subscribe(contextName, function (context, _, __, ___, extraData) {\r\n                                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                                if (_this.callback) {\r\n                                    _this.callback(contextWithDataObj.data, contextWithDataObj, extraData === null || extraData === void 0 ? void 0 : extraData.updaterId);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        return this.contexts.set(contextName, data);\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var contextNames = this.contexts.all();\r\n        var channelContextNames = contextNames.filter(function (contextName) { return contextName.startsWith(CONTEXT_PREFIX); });\r\n        var channelNames = channelContextNames.map(function (channelContextName) { return channelContextName.substr(CONTEXT_PREFIX.length); });\r\n        return channelNames;\r\n    };\r\n    SharedContextSubscriber.prototype.getContextData = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this.isChannel(name)) {\r\n                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n            }\r\n            var contextName = _this.createContextName(name);\r\n            _this.contexts.subscribe(contextName, function (context) {\r\n                var contextWithDataObj = _this.setContextDataToEmptyObjIfMissing(context);\r\n                resolve(contextWithDataObj);\r\n            }).then(function (unsubscribeFunc) { return unsubscribeFunc(); });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.updateChannel = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        var newData = {\r\n            name: data.name,\r\n            meta: data.meta\r\n        };\r\n        if ((data === null || data === void 0 ? void 0 : data.data) && !this.isEmptyObject(data.data)) {\r\n            newData.data = data.data;\r\n        }\r\n        return this.contexts.update(contextName, newData);\r\n    };\r\n    SharedContextSubscriber.prototype.updateData = function (name, data) {\r\n        var contextName = this.createContextName(name);\r\n        if (this.contexts.setPathSupported) {\r\n            var pathValues = Object.keys(data).map(function (key) {\r\n                return {\r\n                    path: \"data.\" + key,\r\n                    value: data[key]\r\n                };\r\n            });\r\n            return this.contexts.setPaths(contextName, pathValues);\r\n        }\r\n        else {\r\n            return this.contexts.update(contextName, { data: data });\r\n        }\r\n    };\r\n    SharedContextSubscriber.prototype.isChannel = function (name) {\r\n        return this.all().some(function (channelName) { return channelName === name; });\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (name) {\r\n        return \"\" + CONTEXT_PREFIX + name;\r\n    };\r\n    SharedContextSubscriber.prototype.isEmptyObject = function (obj) {\r\n        return Object.keys(obj).length === 0 && obj.constructor === Object;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\n\nvar Channels = (function () {\r\n    function Channels(contexts, channels) {\r\n        var _this = this;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = lib$1();\r\n        this.shared = new SharedContextSubscriber(contexts);\r\n        this.shared.subscribe(this.handler.bind(this));\r\n        this.readyPromise = Promise.resolve(channels === null || channels === void 0 ? void 0 : channels.reduce(function (promise, channel) {\r\n            return promise.then(function () { return _this.add(channel); });\r\n        }, Promise.resolve({})));\r\n    }\r\n    Channels.prototype.subscribe = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    Channels.prototype.subscribeFor = function (name, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var unsubscribeFunc;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the name as a string!\");\r\n                        }\r\n                        if (typeof callback !== \"function\") {\r\n                            throw new Error(\"Please provide the callback as a function!\");\r\n                        }\r\n                        return [4, this.shared.subscribeFor(name, callback)];\r\n                    case 1:\r\n                        unsubscribeFunc = _a.sent();\r\n                        return [2, unsubscribeFunc];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.publish = function (data, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (typeof data !== \"object\") {\r\n                    throw new Error(\"Please provide the data as an object!\");\r\n                }\r\n                if (name) {\r\n                    if (typeof name !== \"string\") {\r\n                        throw new Error(\"Please provide the name as a string!\");\r\n                    }\r\n                    if (!this.shared.isChannel(name)) {\r\n                        throw new Error(\"A channel with name: \" + name + \" doesn't exist!\");\r\n                    }\r\n                    return [2, this.shared.updateData(name, data)];\r\n                }\r\n                if (!this.currentContext) {\r\n                    throw new Error(\"Not joined to any channel!\");\r\n                }\r\n                return [2, this.shared.updateData(this.currentContext, data)];\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.all = function () {\r\n        var channelNames = this.shared.all();\r\n        return Promise.resolve(channelNames);\r\n    };\r\n    Channels.prototype.list = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var channelNames, channelContexts;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1:\r\n                        channelNames = _a.sent();\r\n                        return [4, Promise.all(channelNames.map(function (channelName) { return _this.get(channelName); }))];\r\n                    case 2:\r\n                        channelContexts = _a.sent();\r\n                        return [2, channelContexts];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.get = function (name) {\r\n        if (typeof name !== \"string\") {\r\n            return Promise.reject(new Error(\"Please provide the channel name as a string!\"));\r\n        }\r\n        return this.shared.getContextData(name);\r\n    };\r\n    Channels.prototype.join = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var doesChannelExist, channelExistsPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof name !== \"string\") {\r\n                            throw new Error(\"Please provide the channel name as a string!\");\r\n                        }\r\n                        doesChannelExist = function (channelName) {\r\n                            var channelNames = _this.shared.all();\r\n                            return channelNames.includes(channelName);\r\n                        };\r\n                        if (!!doesChannelExist(name)) return [3, 2];\r\n                        channelExistsPromise = new Promise(function (resolve, reject) {\r\n                            var timeoutId;\r\n                            var intervalId = setInterval(function () {\r\n                                if (doesChannelExist(name)) {\r\n                                    clearTimeout(timeoutId);\r\n                                    clearInterval(intervalId);\r\n                                    resolve();\r\n                                }\r\n                            }, 100);\r\n                            timeoutId = setTimeout(function () {\r\n                                clearInterval(intervalId);\r\n                                return reject(new Error(\"A channel with name: \" + name + \" doesn't exist!\"));\r\n                            }, 3000);\r\n                        });\r\n                        return [4, channelExistsPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.currentContext = name;\r\n                        return [4, this.shared.switchChannel(name)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.registry.execute(this.changedKey, name);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.leave = function () {\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        this.shared.unsubscribe();\r\n        return Promise.resolve();\r\n    };\r\n    Channels.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    Channels.prototype.my = function () {\r\n        return this.current();\r\n    };\r\n    Channels.prototype.changed = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(this.changedKey, callback);\r\n    };\r\n    Channels.prototype.onChanged = function (callback) {\r\n        return this.changed(callback);\r\n    };\r\n    Channels.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info !== \"object\") {\r\n                            throw new Error(\"Please provide the info as an object!\");\r\n                        }\r\n                        if (typeof info.name === \"undefined\") {\r\n                            throw new Error(\"info.name is missing!\");\r\n                        }\r\n                        if (typeof info.name !== \"string\") {\r\n                            throw new Error(\"Please provide the info.name as a string!\");\r\n                        }\r\n                        if (typeof info.meta === \"undefined\") {\r\n                            throw new Error(\"info.meta is missing!\");\r\n                        }\r\n                        if (typeof info.meta !== \"object\") {\r\n                            throw new Error(\"Please provide the info.meta as an object!\");\r\n                        }\r\n                        if (typeof info.meta.color === \"undefined\") {\r\n                            throw new Error(\"info.meta.color is missing!\");\r\n                        }\r\n                        if (typeof info.meta.color !== \"string\") {\r\n                            throw new Error(\"Please provide the info.meta.color as a string!\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta,\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4, this.shared.updateChannel(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Channels.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Channels.prototype.handler = function (data, context, updaterId) {\r\n        this.registry.execute(this.subsKey, data, context, updaterId);\r\n    };\r\n    return Channels;\r\n}());\n\nvar fetchTimeout = function (url, timeoutMilliseconds) {\r\n    if (timeoutMilliseconds === void 0) { timeoutMilliseconds = 1000; }\r\n    return new Promise(function (resolve, reject) {\r\n        var timeoutHit = false;\r\n        var timeout = setTimeout(function () {\r\n            timeoutHit = true;\r\n            reject(new Error(\"Fetch request for: \" + url + \" timed out at: \" + timeoutMilliseconds + \" milliseconds\"));\r\n        }, timeoutMilliseconds);\r\n        fetch(url)\r\n            .then(function (response) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                resolve(response);\r\n            }\r\n        })\r\n            .catch(function (err) {\r\n            if (!timeoutHit) {\r\n                clearTimeout(timeout);\r\n                reject(err);\r\n            }\r\n        });\r\n    });\r\n};\n\nvar promisePlus = function (promise, timeoutMilliseconds, timeoutMessage) {\r\n    return new Promise(function (resolve, reject) {\r\n        var timeout = setTimeout(function () {\r\n            var message = timeoutMessage || \"Promise timeout hit: \" + timeoutMilliseconds;\r\n            reject(message);\r\n        }, timeoutMilliseconds);\r\n        promise()\r\n            .then(function (result) {\r\n            clearTimeout(timeout);\r\n            resolve(result);\r\n        })\r\n            .catch(function (error) {\r\n            clearTimeout(timeout);\r\n            reject(error);\r\n        });\r\n    });\r\n};\n\nvar Application = (function () {\r\n    function Application(_appManager, _props, _windows) {\r\n        var _this = this;\r\n        var _a, _b, _c, _d;\r\n        this._appManager = _appManager;\r\n        this._props = _props;\r\n        this._windows = _windows;\r\n        this._registry = lib$1();\r\n        this.start = function (context, options) {\r\n            return promisePlus(function () { return _this.startWithoutTimeout(context, options); }, 3000, \"Application \\\"\" + _this.name + \"\\\" start timeout!\");\r\n        };\r\n        if (typeof ((_a = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) === \"undefined\") {\r\n            this._url = (_c = (_b = _props === null || _props === void 0 ? void 0 : _props.userProperties) === null || _b === void 0 ? void 0 : _b.details) === null || _c === void 0 ? void 0 : _c.url;\r\n        }\r\n        else {\r\n            var parsedManifest = JSON.parse(_props.userProperties.manifest);\r\n            this._url = ((_d = parsedManifest.details) === null || _d === void 0 ? void 0 : _d.url) || parsedManifest.url;\r\n        }\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStarted\", instance);\r\n            }\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application.name === _this.name) {\r\n                _this._registry.execute(\"instanceStopped\", instance);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(Application.prototype, \"name\", {\r\n        get: function () {\r\n            return this._props.name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"title\", {\r\n        get: function () {\r\n            return this._props.title || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"version\", {\r\n        get: function () {\r\n            return this._props.version || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"icon\", {\r\n        get: function () {\r\n            return this._props.icon || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"caption\", {\r\n        get: function () {\r\n            return this._props.caption || \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"userProperties\", {\r\n        get: function () {\r\n            return this._props.userProperties || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Application.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this.name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Application.prototype.onInstanceStarted = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    Application.prototype.onInstanceStopped = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    Application.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        var url = typeof ((_a = props === null || props === void 0 ? void 0 : props.userProperties) === null || _a === void 0 ? void 0 : _a.manifest) !== \"undefined\" ? JSON.parse(props === null || props === void 0 ? void 0 : props.userProperties.manifest).url : (_b = props === null || props === void 0 ? void 0 : props.userProperties) === null || _b === void 0 ? void 0 : _b.details.url;\r\n        this._url = url;\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    Application.prototype.startWithoutTimeout = function (context, options) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openOptions, appWindow, unsubscribeFunc, resolveCallback, startedAppsWindowIdsToInstances, checkResolveCondition, appInstanceStartedPromise;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        openOptions = __assign(__assign(__assign({}, (_b = (_a = this._props) === null || _a === void 0 ? void 0 : _a.userProperties) === null || _b === void 0 ? void 0 : _b.details), options), { context: context || (options === null || options === void 0 ? void 0 : options.context) });\r\n                        if (!this._url) {\r\n                            throw new Error(\"Application \" + this.name + \" doesn't have a URL.\");\r\n                        }\r\n                        startedAppsWindowIdsToInstances = {};\r\n                        checkResolveCondition = function () {\r\n                            if (typeof appWindow !== \"undefined\") {\r\n                                var instance = startedAppsWindowIdsToInstances[appWindow.id];\r\n                                if (typeof instance !== \"undefined\") {\r\n                                    unsubscribeFunc();\r\n                                    return resolveCallback(instance);\r\n                                }\r\n                            }\r\n                        };\r\n                        appInstanceStartedPromise = new Promise(function (resolve) {\r\n                            resolveCallback = resolve;\r\n                            unsubscribeFunc = _this._appManager.onInstanceStarted(function (startedInstance) {\r\n                                var windowId = startedInstance.agm.windowId;\r\n                                if (typeof windowId !== \"undefined\") {\r\n                                    startedAppsWindowIdsToInstances[windowId] = startedInstance;\r\n                                    checkResolveCondition();\r\n                                }\r\n                            });\r\n                        });\r\n                        return [4, this._windows.open(this.name, this._url, openOptions)];\r\n                    case 1:\r\n                        appWindow = _c.sent();\r\n                        checkResolveCondition();\r\n                        return [2, appInstanceStartedPromise];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Application;\r\n}());\n\nvar RemoteInstance = (function () {\r\n    function RemoteInstance(id, application, control, context, agm) {\r\n        this.id = id;\r\n        this.application = application;\r\n        this.control = control;\r\n        this.context = context;\r\n        this.agm = agm;\r\n        this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND = \"Peer has left while waiting for result\";\r\n    }\r\n    RemoteInstance.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, this.callControl(\"stop\", {}, false)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        if (error_1.message !== this.WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND) {\r\n                            throw new Error(error_1);\r\n                        }\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RemoteInstance.prototype.callControl = function (command, args, skipResult) {\r\n        if (skipResult === void 0) { skipResult = false; }\r\n        return this.control.send({ command: command, domain: \"appManager\", args: args, skipResult: skipResult }, { instance: this.id });\r\n    };\r\n    return RemoteInstance;\r\n}());\n\nvar LocalInstance = (function () {\r\n    function LocalInstance(id, control, _appManager, agm) {\r\n        this.id = id;\r\n        this.control = control;\r\n        this._appManager = _appManager;\r\n        this.agm = agm;\r\n        this.context = {};\r\n        this.startedByScript = false;\r\n        this.application = undefined;\r\n        control.setLocalInstance(this);\r\n    }\r\n    LocalInstance.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (_this.startedByScript) {\r\n                var unsubscribe_1 = _this._appManager.onInstanceStopped(function (instance) {\r\n                    if (instance.id === _this.id) {\r\n                        unsubscribe_1();\r\n                        resolve();\r\n                    }\r\n                });\r\n                window.close();\r\n            }\r\n            else {\r\n                reject(\"Can't close a window that wasn't started by a script.\");\r\n            }\r\n        });\r\n    };\r\n    return LocalInstance;\r\n}());\n\nvar nonEmptyStringDecoder$1 = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\r\nvar fdc3AppImageDecoder = object({\r\n    url: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IconDecoder = object({\r\n    icon: optional(nonEmptyStringDecoder$1)\r\n});\r\nvar fdc3IntentDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    displayName: optional(string()),\r\n    contexts: optional(array(string())),\r\n    customConfig: optional(object())\r\n});\r\nvar glue42CoreCreateOptionsDecoder = object({\r\n    url: optional(nonEmptyStringDecoder$1),\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    width: optional(number()),\r\n    height: optional(number()),\r\n    context: optional(anyJson()),\r\n    relativeTo: optional(nonEmptyStringDecoder$1),\r\n    relativeDirection: optional(oneOf(constant(\"top\"), constant(\"left\"), constant(\"right\"), constant(\"bottom\")))\r\n});\r\nvar fdc3ApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    appId: nonEmptyStringDecoder$1,\r\n    manifest: nonEmptyStringDecoder$1,\r\n    manifestType: nonEmptyStringDecoder$1,\r\n    tooltip: optional(string()),\r\n    description: optional(string()),\r\n    contactEmail: optional(string()),\r\n    supportEmail: optional(string()),\r\n    publisher: optional(string()),\r\n    images: optional(array(fdc3AppImageDecoder)),\r\n    icons: optional(array(fdc3IconDecoder)),\r\n    customConfig: optional(object()),\r\n    intents: optional(array(fdc3IntentDecoder))\r\n});\r\nvar glue42CoreApplicationConfigDecoder = object({\r\n    name: nonEmptyStringDecoder$1,\r\n    title: optional(string()),\r\n    version: optional(string()),\r\n    details: glue42CoreCreateOptionsDecoder,\r\n    customProperties: optional(object()),\r\n    icon: optional(string()),\r\n    caption: optional(string())\r\n});\n\nvar AppManager = (function () {\r\n    function AppManager(windows, interop, control, config, appName) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        this.windows = windows;\r\n        this.interop = interop;\r\n        this.control = control;\r\n        this.config = config;\r\n        this.appName = appName;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this.registry = lib$1();\r\n        this.DEFAULT_POLLING_INTERVAL = 3000;\r\n        this.OKAY_MESSAGE = \"OK\";\r\n        this.LOCAL_SOURCE = \"LOCAL_SOURCE\";\r\n        var myId = interop.instance.instance;\r\n        this._myInstance = new LocalInstance(myId, this.control, this, this.interop.instance);\r\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a.remoteSources) {\r\n            this.readyPromise = this.subscribeForRemoteApplications(this.config.remoteSources);\r\n        }\r\n        if ((_b = this.config) === null || _b === void 0 ? void 0 : _b.localApplications) {\r\n            var validatedApplications = this.getValidatedApplications(this.config.localApplications);\r\n            this.addApplications(validatedApplications);\r\n        }\r\n        control.onStart(function () {\r\n            _this.trackInstanceLifetime();\r\n        });\r\n    }\r\n    Object.defineProperty(AppManager.prototype, \"myInstance\", {\r\n        get: function () {\r\n            if (!this.appName) {\r\n                console.warn(\"application wasn't provided to the GlueWeb factory function!\");\r\n            }\r\n            if (!this._myInstance) {\r\n                console.warn(\"The application isn't defined in any of the local/remote application sources!\");\r\n            }\r\n            return this._myInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AppManager.prototype.application = function (name) {\r\n        var _a;\r\n        if (typeof name !== \"string\") {\r\n            throw new Error(\"Please provide the name as a string!\");\r\n        }\r\n        return (_a = this._apps[name]) === null || _a === void 0 ? void 0 : _a.application;\r\n    };\r\n    AppManager.prototype.applications = function () {\r\n        var _this = this;\r\n        return Object.keys(this._apps).map(function (appName) { return _this._apps[appName].application; });\r\n    };\r\n    AppManager.prototype.instances = function () {\r\n        return this._instances;\r\n    };\r\n    AppManager.prototype.onAppAdded = function (callback) {\r\n        var _this = this;\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        var applications = Object.keys(this._apps).map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        return this.registry.add(\"appAdded\", callback, applications);\r\n    };\r\n    AppManager.prototype.onAppRemoved = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"appRemoved\", callback);\r\n    };\r\n    AppManager.prototype.onAppChanged = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"appChanged\", callback);\r\n    };\r\n    AppManager.prototype.onInstanceStarted = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"instanceStarted\", callback, this._instances);\r\n    };\r\n    AppManager.prototype.onInstanceStopped = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this.registry.add(\"instanceStopped\", callback);\r\n    };\r\n    AppManager.prototype.ready = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, this.readyPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        error_1 = _a.sent();\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getValidatedApplications = function (applications) {\r\n        var verifiedApplications = applications.filter(function (application) {\r\n            var isFDC3App = typeof application.manifest !== \"undefined\";\r\n            var isValid;\r\n            if (isFDC3App) {\r\n                isValid = fdc3ApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            else {\r\n                isValid = glue42CoreApplicationConfigDecoder.run(application).ok;\r\n            }\r\n            if (!isValid) {\r\n                console.warn(\"Validation failed for application \\\"\" + application.name + \"\\\"!\");\r\n            }\r\n            return isValid;\r\n        });\r\n        return verifiedApplications;\r\n    };\r\n    AppManager.prototype.subscribeForRemoteApplications = function (remoteSources) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var initialFetchAppsPromises, _loop_1, this_1, _i, remoteSources_1, remoteSource;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        initialFetchAppsPromises = [];\r\n                        _loop_1 = function (remoteSource) {\r\n                            var url = remoteSource.url;\r\n                            var appsFetch = function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                var response, json, validatedApplications;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0: return [4, fetchTimeout(url, 1000)];\r\n                                        case 1:\r\n                                            response = _a.sent();\r\n                                            return [4, response.json()];\r\n                                        case 2:\r\n                                            json = (_a.sent());\r\n                                            if (json.message === this.OKAY_MESSAGE) {\r\n                                                validatedApplications = this.getValidatedApplications(json.applications);\r\n                                                this.addApplications(validatedApplications, url);\r\n                                            }\r\n                                            return [2];\r\n                                    }\r\n                                });\r\n                            }); };\r\n                            initialFetchAppsPromises.push(appsFetch());\r\n                            setInterval(function () { return appsFetch().catch(console.warn); }, remoteSource.pollingInterval || this_1.DEFAULT_POLLING_INTERVAL);\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, remoteSources_1 = remoteSources; _i < remoteSources_1.length; _i++) {\r\n                            remoteSource = remoteSources_1[_i];\r\n                            _loop_1(remoteSource);\r\n                        }\r\n                        return [4, Promise.all(initialFetchAppsPromises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.getAppProps = function (application) {\r\n        var glue42CoreAppProps = [\"name\", \"title\", \"version\", \"customProperties\", \"icon\", \"caption\"];\r\n        var userProperties = Object.fromEntries(Object.entries(application).filter(function (_a) {\r\n            var key = _a[0];\r\n            return !glue42CoreAppProps.includes(key);\r\n        }));\r\n        return {\r\n            name: application.name,\r\n            title: application.title,\r\n            version: application.version,\r\n            icon: application.icon,\r\n            caption: application.caption,\r\n            userProperties: __assign(__assign({}, userProperties), application.customProperties)\r\n        };\r\n    };\r\n    AppManager.prototype.handleAppsChanged = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var _loop_2 = function (newlyAddedApplication) {\r\n            var currentApplicationWithTheSameNameAndSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source === source;\r\n            });\r\n            var currentApplicationWithTheSameNameButDifferentSource = Object.keys(this_2._apps).find(function (appName) {\r\n                return appName === newlyAddedApplication.name && _this._apps[appName].source !== source;\r\n            });\r\n            if (currentApplicationWithTheSameNameAndSource) {\r\n                var currentApplication = this_2._apps[currentApplicationWithTheSameNameAndSource];\r\n                var appProps = this_2.getAppProps(newlyAddedApplication);\r\n                if (JSON.stringify(currentApplication.appProps) !== JSON.stringify(appProps)) {\r\n                    var newlyAddedApplicationInstance = new Application(this_2, appProps, this_2.windows);\r\n                    this_2.registry.execute(\"appChanged\", newlyAddedApplicationInstance);\r\n                    this_2._apps[newlyAddedApplication.name] = {\r\n                        source: currentApplication.source,\r\n                        application: newlyAddedApplicationInstance,\r\n                        appProps: appProps\r\n                    };\r\n                }\r\n            }\r\n            else if (currentApplicationWithTheSameNameButDifferentSource) {\r\n                console.warn(\"Application \\\"\" + newlyAddedApplication.name + \"\\\" already defined by source \\\"\" + this_2._apps[currentApplicationWithTheSameNameButDifferentSource].source + \"\\\". Skipping application definition from source \" + source + \".\");\r\n            }\r\n        };\r\n        var this_2 = this;\r\n        for (var _i = 0, newlyAddedApplications_1 = newlyAddedApplications; _i < newlyAddedApplications_1.length; _i++) {\r\n            var newlyAddedApplication = newlyAddedApplications_1[_i];\r\n            _loop_2(newlyAddedApplication);\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsAdded = function (newlyAddedApplications, source) {\r\n        var currentAppNames = Object.keys(this._apps);\r\n        var newApplications = newlyAddedApplications.filter(function (newlyAddedApplication) {\r\n            return !currentAppNames.includes(newlyAddedApplication.name);\r\n        });\r\n        for (var _i = 0, newApplications_1 = newApplications; _i < newApplications_1.length; _i++) {\r\n            var newApplication = newApplications_1[_i];\r\n            var appProps = this.getAppProps(newApplication);\r\n            var newApplicationInstance = new Application(this, appProps, this.windows);\r\n            this.registry.execute(\"appAdded\", newApplicationInstance);\r\n            this._apps[newApplication.name] = {\r\n                source: source || this.LOCAL_SOURCE,\r\n                application: newApplicationInstance,\r\n                appProps: appProps\r\n            };\r\n        }\r\n    };\r\n    AppManager.prototype.handleAppsRemoved = function (newlyAddedApplications, source) {\r\n        var _this = this;\r\n        var currentApplicationsFromThisSource = Object.keys(this._apps)\r\n            .filter(function (appName) {\r\n            return _this._apps[appName].source === source;\r\n        })\r\n            .map(function (appName) {\r\n            return _this._apps[appName].application;\r\n        });\r\n        var newlyAddedApplicationNames = newlyAddedApplications.map(function (newlyAddedApplication) {\r\n            return newlyAddedApplication.name;\r\n        });\r\n        var removedApplications = currentApplicationsFromThisSource.filter(function (currentApplicationFromThisSource) {\r\n            return !newlyAddedApplicationNames.includes(currentApplicationFromThisSource.name);\r\n        });\r\n        for (var _i = 0, removedApplications_1 = removedApplications; _i < removedApplications_1.length; _i++) {\r\n            var removedApplication = removedApplications_1[_i];\r\n            this.registry.execute(\"appRemoved\", removedApplication);\r\n            delete this._apps[removedApplication.name];\r\n        }\r\n    };\r\n    AppManager.prototype.tryPopulateMyInstanceApplication = function () {\r\n        var _this = this;\r\n        var _a;\r\n        if (this.appName) {\r\n            var myApp = (_a = Object.values(this._apps).find(function (app) { return app.application.name === _this.appName; })) === null || _a === void 0 ? void 0 : _a.application;\r\n            if (myApp) {\r\n                if (myApp.title) {\r\n                    document.title = myApp.title;\r\n                }\r\n                this._myInstance.application = myApp;\r\n            }\r\n        }\r\n    };\r\n    AppManager.prototype.addApplications = function (newlyAddedApplications, source) {\r\n        this.handleAppsChanged(newlyAddedApplications, source);\r\n        this.handleAppsAdded(newlyAddedApplications, source);\r\n        this.handleAppsRemoved(newlyAddedApplications, source);\r\n        if (!this._myInstance.application) {\r\n            this.tryPopulateMyInstanceApplication();\r\n        }\r\n    };\r\n    AppManager.prototype.remoteFromServer = function (server) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var serverApp, id, app, appWindow, context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        serverApp = server.application;\r\n                        if (!server.instance || !serverApp || !this._apps[serverApp]) {\r\n                            return [2, undefined];\r\n                        }\r\n                        id = server.instance;\r\n                        app = this._apps[serverApp].application;\r\n                        appWindow = this.windows.list().find(function (window) { return window.id === server.windowId; });\r\n                        return [4, (appWindow === null || appWindow === void 0 ? void 0 : appWindow.getContext())];\r\n                    case 1:\r\n                        context = _a.sent();\r\n                        return [2, new RemoteInstance(id, app, this.control, context, server)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AppManager.prototype.trackInstanceLifetime = function () {\r\n        var _this = this;\r\n        this.interop.serverMethodAdded(function (_a) {\r\n            var server = _a.server, method = _a.method;\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var remoteInstance;\r\n                return __generator(this, function (_b) {\r\n                    switch (_b.label) {\r\n                        case 0:\r\n                            if (method.name !== Control.CONTROL_METHOD) {\r\n                                return [2];\r\n                            }\r\n                            return [4, this.remoteFromServer(server)];\r\n                        case 1:\r\n                            remoteInstance = _b.sent();\r\n                            if (remoteInstance) {\r\n                                this._instances.push(remoteInstance);\r\n                                this.registry.execute(\"instanceStarted\", remoteInstance);\r\n                            }\r\n                            return [2];\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        this.interop.serverRemoved(function (server) { return __awaiter(_this, void 0, void 0, function () {\r\n            var remoteInstance;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.remoteFromServer(server)];\r\n                    case 1:\r\n                        remoteInstance = _a.sent();\r\n                        if (remoteInstance) {\r\n                            this._instances = this._instances.filter(function (instance) { return instance.id !== remoteInstance.id; });\r\n                            this.registry.execute(\"instanceStopped\", remoteInstance);\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        }); });\r\n    };\r\n    return AppManager;\r\n}());\n\nvar nonEmptyStringDecoder$2 = string().where(function (s) { return s.length > 0; }, \"Expected a non-empty string\");\r\nvar glue42CoreCreateOptionsDecoder$1 = object({\r\n    url: optional(nonEmptyStringDecoder$2),\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    width: optional(number()),\r\n    height: optional(number()),\r\n    context: optional(anyJson()),\r\n    relativeTo: optional(nonEmptyStringDecoder$2),\r\n    relativeDirection: optional(oneOf(constant(\"top\"), constant(\"left\"), constant(\"right\"), constant(\"bottom\")))\r\n});\r\nvar glue42CoreIntentContextDecoder = object({\r\n    type: optional(nonEmptyStringDecoder$2),\r\n    data: optional(object())\r\n});\r\nvar glue42CoreIntentFilterDecoder = oneOf(object({\r\n    name: optional(string()),\r\n    contextType: optional(string())\r\n}), nonEmptyStringDecoder$2);\r\nvar glue42CoreIntentDefinitionDecoder = oneOf(object({\r\n    intent: nonEmptyStringDecoder$2,\r\n    contextTypes: optional(array(string())),\r\n    displayName: optional(string())\r\n}), nonEmptyStringDecoder$2);\r\nvar glue42CoreIntentRequestDecoder = oneOf(object({\r\n    intent: nonEmptyStringDecoder$2,\r\n    target: optional(oneOf(constant(\"startNew\"), constant(\"reuse\"), object({\r\n        app: optional(string()),\r\n        instance: optional(string())\r\n    }))),\r\n    context: optional(glue42CoreIntentContextDecoder),\r\n    options: optional(glue42CoreCreateOptionsDecoder$1)\r\n}), nonEmptyStringDecoder$2);\n\nvar GLUE42_FDC3_INTENTS_METHOD_PREFIX = \"Tick42.FDC3.Intents.\";\r\nvar Intents = (function () {\r\n    function Intents(interop, windows, appManager) {\r\n        this.interop = interop;\r\n        this.windows = windows;\r\n        this.appManager = appManager;\r\n    }\r\n    Intents.prototype.find = function (intentFilter) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intents, ctToLower_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        glue42CoreIntentFilterDecoder.runWithException(intentFilter);\r\n                        return [4, this.all()];\r\n                    case 1:\r\n                        intents = _a.sent();\r\n                        if (typeof intentFilter === \"undefined\") {\r\n                            return [2, intents];\r\n                        }\r\n                        if (typeof intentFilter === \"string\") {\r\n                            return [2, intents.filter(function (intent) { return intent.name === intentFilter; })];\r\n                        }\r\n                        if (intentFilter.contextType) {\r\n                            ctToLower_1 = intentFilter.contextType.toLowerCase();\r\n                            intents = intents.filter(function (intent) { return intent.handlers.some(function (handler) { var _a; return (_a = handler.contextTypes) === null || _a === void 0 ? void 0 : _a.some(function (ct) { return ct.toLowerCase() === ctToLower_1; }); }); });\r\n                        }\r\n                        if (intentFilter.name) {\r\n                            intents = intents.filter(function (intent) { return intent.name === intentFilter.name; });\r\n                        }\r\n                        return [2, intents];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raise = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var intentName, intentDef, isDynamicIntent, target, handler, anAppHandler, anInstanceHandler, instanceId, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        glue42CoreIntentRequestDecoder.runWithException(intent);\r\n                        if (typeof intent === \"string\") {\r\n                            intent = {\r\n                                intent: intent\r\n                            };\r\n                        }\r\n                        intentName = intent.intent;\r\n                        return [4, this.get(intentName)];\r\n                    case 1:\r\n                        intentDef = _a.sent();\r\n                        if (typeof intentDef === \"undefined\") {\r\n                            throw new Error(\"Intent \" + intentName + \" not found.\");\r\n                        }\r\n                        isDynamicIntent = !intentDef.handlers.some(function (intentDefHandler) { return intentDefHandler.type === \"app\"; });\r\n                        target = intent.target || (isDynamicIntent ? \"reuse\" : \"startNew\");\r\n                        anAppHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\"; });\r\n                        if (target === \"startNew\") {\r\n                            handler = anAppHandler;\r\n                        }\r\n                        else if (target === \"reuse\") {\r\n                            anInstanceHandler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\"; });\r\n                            handler = anInstanceHandler || anAppHandler;\r\n                        }\r\n                        else if (target.instance) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"instance\" && intentHandler.instanceId === target.instance; });\r\n                        }\r\n                        else if (target.app) {\r\n                            handler = intentDef.handlers.find(function (intentHandler) { return intentHandler.type === \"app\" && intentHandler.applicationName === target.app; });\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Invalid intent target: \" + JSON.stringify(target));\r\n                        }\r\n                        if (!handler) {\r\n                            throw new Error(\"Can not raise intent for request \" + JSON.stringify(intent) + \" - can not find intent handler.\");\r\n                        }\r\n                        instanceId = handler.instanceId;\r\n                        if (!(handler.type === \"app\")) return [3, 3];\r\n                        return [4, this.startApp(handler.applicationName, intent.options)];\r\n                    case 2:\r\n                        instanceId = _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [4, this.raiseIntentToInstance(instanceId, intentName, intent.context)];\r\n                    case 4:\r\n                        result = _a.sent();\r\n                        result.request = intent;\r\n                        result.handler = handler;\r\n                        return [2, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.all = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var apps, intents, appsWithIntents, _i, appsWithIntents_1, app, _a, _b, intentDef, intent, handler, _loop_1, _c, _d, server;\r\n            var _this = this;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        apps = this.appManager.applications().map(function (app) {\r\n                            return {\r\n                                name: app.name,\r\n                                title: app.title,\r\n                                icon: app.icon,\r\n                                caption: app.caption,\r\n                                intents: app.userProperties.intents\r\n                            };\r\n                        });\r\n                        intents = {};\r\n                        appsWithIntents = apps.filter(function (app) { return app.intents && app.intents.length > 0; });\r\n                        for (_i = 0, appsWithIntents_1 = appsWithIntents; _i < appsWithIntents_1.length; _i++) {\r\n                            app = appsWithIntents_1[_i];\r\n                            for (_a = 0, _b = app.intents; _a < _b.length; _a++) {\r\n                                intentDef = _b[_a];\r\n                                intent = intents[intentDef.name];\r\n                                if (!intent) {\r\n                                    intent = {\r\n                                        name: intentDef.name,\r\n                                        handlers: [],\r\n                                    };\r\n                                    intents[intentDef.name] = intent;\r\n                                }\r\n                                handler = {\r\n                                    applicationName: app.name,\r\n                                    applicationTitle: app.title,\r\n                                    applicationDescription: app.caption,\r\n                                    displayName: intentDef.displayName,\r\n                                    contextTypes: intentDef.contexts,\r\n                                    applicationIcon: app.icon,\r\n                                    type: \"app\"\r\n                                };\r\n                                intent.handlers.push(handler);\r\n                            }\r\n                        }\r\n                        _loop_1 = function (server) {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, Promise.all(server.getMethods()\r\n                                            .filter(function (method) { return method.name.startsWith(GLUE42_FDC3_INTENTS_METHOD_PREFIX); })\r\n                                            .map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                                            var intentName, intent, info, app, appIntent, window, title, handler;\r\n                                            return __generator(this, function (_a) {\r\n                                                switch (_a.label) {\r\n                                                    case 0:\r\n                                                        intentName = method.name.replace(GLUE42_FDC3_INTENTS_METHOD_PREFIX, \"\");\r\n                                                        intent = intents[intentName];\r\n                                                        if (!intent) {\r\n                                                            intent = {\r\n                                                                name: intentName,\r\n                                                                handlers: [],\r\n                                                            };\r\n                                                            intents[intentName] = intent;\r\n                                                        }\r\n                                                        if (method.description) {\r\n                                                            try {\r\n                                                                info = JSON.parse(method.description);\r\n                                                            }\r\n                                                            catch (_b) { }\r\n                                                        }\r\n                                                        app = apps.find(function (appDef) { return appDef.name === server.application; });\r\n                                                        if (app && app.intents) {\r\n                                                            appIntent = app.intents.find(function (appDefIntent) { return appDefIntent.name === intentName; });\r\n                                                        }\r\n                                                        window = this.windows.findById(server.windowId);\r\n                                                        return [4, (window === null || window === void 0 ? void 0 : window.getTitle())];\r\n                                                    case 1:\r\n                                                        title = _a.sent();\r\n                                                        handler = {\r\n                                                            instanceId: server.instance,\r\n                                                            applicationName: server.application,\r\n                                                            applicationIcon: (info === null || info === void 0 ? void 0 : info.icon) || (app === null || app === void 0 ? void 0 : app.icon),\r\n                                                            applicationTitle: app === null || app === void 0 ? void 0 : app.title,\r\n                                                            applicationDescription: (info === null || info === void 0 ? void 0 : info.description) || (app === null || app === void 0 ? void 0 : app.caption),\r\n                                                            displayName: (info === null || info === void 0 ? void 0 : info.displayName) || (appIntent === null || appIntent === void 0 ? void 0 : appIntent.displayName),\r\n                                                            contextTypes: (info === null || info === void 0 ? void 0 : info.contextTypes) || (appIntent === null || appIntent === void 0 ? void 0 : appIntent.contexts),\r\n                                                            instanceTitle: title,\r\n                                                            type: \"instance\"\r\n                                                        };\r\n                                                        intent.handlers.push(handler);\r\n                                                        return [2];\r\n                                                }\r\n                                            });\r\n                                        }); }))];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        };\r\n                        _c = 0, _d = this.interop.servers();\r\n                        _e.label = 1;\r\n                    case 1:\r\n                        if (!(_c < _d.length)) return [3, 4];\r\n                        server = _d[_c];\r\n                        return [5, _loop_1(server)];\r\n                    case 2:\r\n                        _e.sent();\r\n                        _e.label = 3;\r\n                    case 3:\r\n                        _c++;\r\n                        return [3, 1];\r\n                    case 4: return [2, Object.values(intents)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.addIntentListener = function (intent, handler) {\r\n        var _this = this;\r\n        glue42CoreIntentDefinitionDecoder.runWithException(intent);\r\n        if (typeof handler !== \"function\") {\r\n            throw new Error(\"Please provide the handler as a function!\");\r\n        }\r\n        var result = { unsubscribe: function () { return console.log(\"Could not unsubscribe!\"); } };\r\n        var intentName = typeof intent === \"string\" ? intent : intent.intent;\r\n        var methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intentName;\r\n        var methodDescription = typeof intent === \"string\" ? undefined : JSON.stringify(intent);\r\n        this.interop.register({ name: methodName, description: methodDescription }, function (args) {\r\n            return handler(args);\r\n        }).then(function () {\r\n            result.unsubscribe = function () {\r\n                _this.interop.unregister(methodName);\r\n            };\r\n        });\r\n        return result;\r\n    };\r\n    Intents.prototype.get = function (intent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.all()];\r\n                    case 1: return [2, (_a.sent()).find(function (registeredIntent) { return registeredIntent.name === intent; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.startApp = function (application, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var instance;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.appManager.application(application).start({}, options)];\r\n                    case 1:\r\n                        instance = _a.sent();\r\n                        return [2, instance.id];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Intents.prototype.raiseIntentToInstance = function (instanceId, intent, context) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodName, interopServer, method, result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodName = \"\" + GLUE42_FDC3_INTENTS_METHOD_PREFIX + intent;\r\n                        interopServer = this.interop.servers().find(function (server) { return server.instance === instanceId; });\r\n                        if (!!interopServer) return [3, 2];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.serverAdded(function (server) {\r\n                                    if (server.instance === instanceId) {\r\n                                        interopServer = server;\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop server for instance \" + instanceId));\r\n                                }, 30 * 1000);\r\n                            }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        method = interopServer.getMethods().find(function (registeredMethod) { return registeredMethod.name === methodName; });\r\n                        if (!!method) return [3, 4];\r\n                        return [4, (new Promise(function (resolve, reject) {\r\n                                var timeoutId;\r\n                                var unsub = _this.interop.methodAdded(function (addedMethod) {\r\n                                    if (addedMethod.name === methodName) {\r\n                                        resolve();\r\n                                        clearTimeout(timeoutId);\r\n                                        unsub();\r\n                                    }\r\n                                });\r\n                                timeoutId = setTimeout(function () {\r\n                                    unsub();\r\n                                    reject(new Error(\"Can not find interop method \" + methodName + \" for instance \" + instanceId));\r\n                                }, 10 * 1000);\r\n                            }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [4, this.interop.invoke(methodName, context, { instance: instanceId })];\r\n                    case 5:\r\n                        result = _a.sent();\r\n                        return [2, {\r\n                                result: result.returned\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Intents;\r\n}());\n\nvar Notifications = (function () {\r\n    function Notifications(interop) {\r\n        this.interop = interop;\r\n    }\r\n    Notifications.prototype.raise = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionPromise, notification, interopOptions_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(\"Notification\" in window)) {\r\n                            throw new Error(\"this browser does not support desktop notification\");\r\n                        }\r\n                        if (Notification.permission === \"granted\") {\r\n                            permissionPromise = Promise.resolve(\"granted\");\r\n                        }\r\n                        else if (Notification.permission === \"denied\") {\r\n                            permissionPromise = Promise.reject(\"no permissions from user\");\r\n                        }\r\n                        else {\r\n                            permissionPromise = Notification.requestPermission();\r\n                        }\r\n                        return [4, permissionPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        notification = this.raiseUsingWebApi(options);\r\n                        if (options.clickInterop) {\r\n                            interopOptions_1 = options.clickInterop;\r\n                            notification.onclick = function () {\r\n                                var _a, _b;\r\n                                _this.interop.invoke(interopOptions_1.method, (_a = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.arguments) !== null && _a !== void 0 ? _a : {}, (_b = interopOptions_1 === null || interopOptions_1 === void 0 ? void 0 : interopOptions_1.target) !== null && _b !== void 0 ? _b : \"best\");\r\n                            };\r\n                        }\r\n                        return [2, notification];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Notifications.prototype.raiseUsingWebApi = function (options) {\r\n        return new Notification(options.title, options);\r\n    };\r\n    return Notifications;\r\n}());\n\nvar defaultAssetsBaseLocation = \"/glue\";\r\nvar defaultWorkerName = \"worker.js\";\r\nvar defaultConfigName = \"glue.config.json\";\r\nvar defaultLayoutsName = \"glue.layouts.json\";\r\nvar defaultWorkerLocation = defaultAssetsBaseLocation + \"/\" + defaultWorkerName;\r\nvar defaultConfig = {\r\n    layouts: {\r\n        autoRestore: false,\r\n        autoSaveWindowContext: false\r\n    },\r\n    logger: \"error\",\r\n    assets: {\r\n        location: defaultAssetsBaseLocation\r\n    },\r\n    channels: false,\r\n    appManager: false,\r\n    libraries: []\r\n};\n\nvar getRemoteConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfigLocation, response, json, _a;\r\n    var _b, _c;\r\n    return __generator(this, function (_d) {\r\n        switch (_d.label) {\r\n            case 0:\r\n                if (((_b = userConfig.assets) === null || _b === void 0 ? void 0 : _b.extendConfig) === false || userConfig.extends === false) {\r\n                    return [2, {}];\r\n                }\r\n                remoteConfigLocation = ((_c = userConfig.assets) === null || _c === void 0 ? void 0 : _c.location) ? userConfig.assets.location + \"/\" + defaultConfigName :\r\n                    typeof userConfig.extends === \"string\" ? userConfig.extends :\r\n                        defaultAssetsBaseLocation + \"/\" + defaultConfigName;\r\n                _d.label = 1;\r\n            case 1:\r\n                _d.trys.push([1, 4, , 5]);\r\n                return [4, fetchTimeout(remoteConfigLocation)];\r\n            case 2:\r\n                response = _d.sent();\r\n                if (!response.ok) {\r\n                    return [2, {}];\r\n                }\r\n                return [4, response.json()];\r\n            case 3:\r\n                json = _d.sent();\r\n                return [2, json !== null && json !== void 0 ? json : {}];\r\n            case 4:\r\n                _a = _d.sent();\r\n                return [2, {}];\r\n            case 5: return [2];\r\n        }\r\n    });\r\n}); };\r\nvar buildConfig = function (userConfig) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var remoteConfig, resultWebConfig, lastIndex, worker;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                userConfig = userConfig !== null && userConfig !== void 0 ? userConfig : {};\r\n                return [4, getRemoteConfig(userConfig)];\r\n            case 1:\r\n                remoteConfig = _a.sent();\r\n                resultWebConfig = __assign(__assign(__assign({}, defaultConfig), remoteConfig.glue), userConfig);\r\n                resultWebConfig.worker = resultWebConfig.assets.location + \"/\" + defaultWorkerName;\r\n                if (typeof (resultWebConfig === null || resultWebConfig === void 0 ? void 0 : resultWebConfig.extends) === \"string\") {\r\n                    lastIndex = resultWebConfig.extends.lastIndexOf(\"/\");\r\n                    worker = resultWebConfig.extends.substr(0, lastIndex + 1) + defaultWorkerName;\r\n                    resultWebConfig.worker = worker;\r\n                }\r\n                if (!remoteConfig.layouts) {\r\n                    remoteConfig.layouts = { remoteType: \"json\" };\r\n                }\r\n                return [2, __assign(__assign({}, remoteConfig), { glue: resultWebConfig })];\r\n        }\r\n    });\r\n}); };\n\nvar dbName = \"glue42core\";\r\nvar dbVersion = 1;\r\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\nvar LayoutEventMethodName = \"T42.Layouts.Events\";\n\nvar LayoutsController = (function () {\r\n    function LayoutsController(storage, windows, control, interop, config) {\r\n        var _a, _b;\r\n        this.storage = storage;\r\n        this.windows = windows;\r\n        this.control = control;\r\n        this.interop = interop;\r\n        this._registry = lib$1();\r\n        this.autoSaveContext = (_b = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoSaveWindowContext) !== null && _b !== void 0 ? _b : false;\r\n        this.control.subscribe(\"layouts\", this.handleControlMessage.bind(this));\r\n        this.readyPromise = Promise.all([\r\n            this.registerRequestMethods(),\r\n            this.registerEventsMethod()\r\n        ]).then(function () {\r\n            console.log(\"methods are live\");\r\n            return;\r\n        });\r\n    }\r\n    LayoutsController.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    LayoutsController.prototype.export = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, globalLayouts, workspaceLayouts;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (layoutType) {\r\n                            return [2, this.storage.getAll(layoutType)];\r\n                        }\r\n                        return [4, Promise.all([\r\n                                this.storage.getAll(\"Global\"),\r\n                                this.storage.getAll(\"Workspace\")\r\n                            ])];\r\n                    case 1:\r\n                        _a = _b.sent(), globalLayouts = _a[0], workspaceLayouts = _a[1];\r\n                        return [2, globalLayouts.concat(workspaceLayouts)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.import = function (layouts) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(layouts.map(function (layout) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var layoutEvent;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, this.get(layout.name, layout.type)];\r\n                                    case 1:\r\n                                        layoutEvent = (_a.sent()) ? \"layoutChanged\" : \"layoutAdded\";\r\n                                        return [4, this.storage.store(layout, layout.type)];\r\n                                    case 2:\r\n                                        _a.sent();\r\n                                        this.emitLayoutEvent(layoutEvent, layout);\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        }); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.save = function (layoutOptions, autoSave) {\r\n        if (autoSave === void 0) { autoSave = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var openedWindows, components, layout, layoutEvent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        openedWindows = this.windows.getChildWindows().map(function (w) { return w.id; });\r\n                        return [4, this.getRemoteWindowsInfo(openedWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(this.getLocalLayoutComponent(layoutOptions.context, true));\r\n                        layout = {\r\n                            type: \"Global\",\r\n                            name: layoutOptions.name,\r\n                            components: components,\r\n                            context: layoutOptions.context || {},\r\n                            metadata: layoutOptions.metadata || {}\r\n                        };\r\n                        return [4, this.get(layoutOptions.name, \"Global\")];\r\n                    case 2:\r\n                        layoutEvent = (_a.sent()) ? \"layoutChanged\" : \"layoutAdded\";\r\n                        if (!autoSave) return [3, 3];\r\n                        this.storage.storeAutoLayout(layout);\r\n                        return [3, 5];\r\n                    case 3: return [4, this.storage.store(layout, \"Global\")];\r\n                    case 4:\r\n                        _a.sent();\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        this.emitLayoutEvent(layoutEvent, layout);\r\n                        return [2, layout];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.autoSave = function (layoutOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2, this.save(layoutOptions, true)];\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restore = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layout;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.get(options.name, \"Global\")];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            throw new Error(\"can not find layout with name \" + options.name);\r\n                        }\r\n                        this.restoreComponents(layout);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.restoreAutoSavedLayout = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutName, layout, my, mainComponent;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutName = \"_auto_\" + document.location.href;\r\n                        return [4, this.storage.getAutoLayout(layoutName)];\r\n                    case 1:\r\n                        layout = _a.sent();\r\n                        if (!layout) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        my = this.windows.my();\r\n                        if (my.parent) {\r\n                            return [2];\r\n                        }\r\n                        mainComponent = layout.components.find(function (c) { return c.state.main; });\r\n                        my.setContext(mainComponent === null || mainComponent === void 0 ? void 0 : mainComponent.state.context);\r\n                        try {\r\n                            this.restoreComponents(layout);\r\n                        }\r\n                        catch (e) {\r\n                            return [2];\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.remove = function (type, name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutToRemove;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.get(name, type)];\r\n                    case 1:\r\n                        layoutToRemove = _a.sent();\r\n                        return [4, this.storage.remove(name, type)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        if (layoutToRemove) {\r\n                            this.emitLayoutEvent(\"layoutRemoved\", layoutToRemove);\r\n                        }\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.getAll = function (type) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.storage.getAll(type)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.map(function (layout) {\r\n                                return {\r\n                                    name: layout.name,\r\n                                    type: layout.type,\r\n                                    context: layout.context,\r\n                                    metadata: layout.metadata\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.get = function (name, type) {\r\n        return this.storage.get(name, type);\r\n    };\r\n    LayoutsController.prototype.getLocalLayoutComponent = function (context, main) {\r\n        if (main === void 0) { main = false; }\r\n        var requestResult;\r\n        var my = this.windows.my();\r\n        try {\r\n            if (this.autoSaveContext) {\r\n                requestResult = {\r\n                    windowContext: my.getContextSync()\r\n                };\r\n            }\r\n        }\r\n        catch (err) {\r\n        }\r\n        return {\r\n            type: \"window\",\r\n            componentType: \"application\",\r\n            state: {\r\n                name: my.name,\r\n                context: (requestResult === null || requestResult === void 0 ? void 0 : requestResult.windowContext) || {},\r\n                bounds: my.getBoundsSync(),\r\n                url: window.document.location.href,\r\n                id: my.id,\r\n                parentId: my.parent,\r\n                main: main\r\n            }\r\n        };\r\n    };\r\n    LayoutsController.prototype.onLayoutAdded = function (callback) {\r\n        return this._registry.add(\"layoutAdded\", callback);\r\n    };\r\n    LayoutsController.prototype.onLayoutChanged = function (callback) {\r\n        return this._registry.add(\"layoutChanged\", callback);\r\n    };\r\n    LayoutsController.prototype.onLayoutRemoved = function (callback) {\r\n        return this._registry.add(\"layoutRemoved\", callback);\r\n    };\r\n    LayoutsController.prototype.restoreComponents = function (layout) {\r\n        var _this = this;\r\n        layout.components.forEach(function (c) {\r\n            if (c.type === \"window\") {\r\n                var state = c.state;\r\n                if (state.main) {\r\n                    return;\r\n                }\r\n                var newWindowOptions = __assign(__assign({}, state.bounds), { context: state.context });\r\n                _this.windows.open(state.name, state.url, newWindowOptions);\r\n            }\r\n        });\r\n    };\r\n    LayoutsController.prototype.getRemoteWindowsInfo = function (windows) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises, _loop_1, this_1, _i, windows_1, id, responses;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        promises = [];\r\n                        _loop_1 = function (id) {\r\n                            var interopServer = this_1.interop.servers().find(function (s) { return s.windowId === id; });\r\n                            if (!interopServer || !interopServer.getMethods) {\r\n                                return \"continue\";\r\n                            }\r\n                            var methods = interopServer.getMethods();\r\n                            if (methods.find(function (m) { return m.name === SaveContextMethodName; })) {\r\n                                try {\r\n                                    promises.push(this_1.interop.invoke(SaveContextMethodName, {}, { windowId: id }));\r\n                                }\r\n                                catch (_a) {\r\n                                }\r\n                            }\r\n                        };\r\n                        this_1 = this;\r\n                        for (_i = 0, windows_1 = windows; _i < windows_1.length; _i++) {\r\n                            id = windows_1[_i];\r\n                            _loop_1(id);\r\n                        }\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        responses = _a.sent();\r\n                        return [2, responses.map(function (response) { return response.returned; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        return this.interop.register(SaveContextMethodName, function (args) {\r\n            return _this.getLocalLayoutComponent(args);\r\n        });\r\n    };\r\n    LayoutsController.prototype.handleControlMessage = function (command) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layoutCommand, args, components;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutCommand = command;\r\n                        if (!(layoutCommand.command === \"saveLayoutAndClose\")) return [3, 3];\r\n                        args = layoutCommand.args;\r\n                        return [4, this.getRemoteWindowsInfo(args.childWindows)];\r\n                    case 1:\r\n                        components = _a.sent();\r\n                        components.push(args.parentInfo);\r\n                        return [4, this.storage.storeAutoLayout({\r\n                                type: \"Global\",\r\n                                name: args.layoutName,\r\n                                components: components,\r\n                                context: args.context || {},\r\n                                metadata: args.metadata || {}\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        args.childWindows.forEach(function (cw) {\r\n                            var _a;\r\n                            (_a = _this.windows.findById(cw)) === null || _a === void 0 ? void 0 : _a.close();\r\n                        });\r\n                        _a.label = 3;\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutsController.prototype.registerEventsMethod = function () {\r\n        var _this = this;\r\n        return this.interop.register(LayoutEventMethodName, function (args) {\r\n            _this._registry.execute(args.event, args.layout);\r\n        });\r\n    };\r\n    LayoutsController.prototype.emitLayoutEvent = function (event, layout) {\r\n        var hasLayoutMethod = this.interop.methods().some(function (m) { return m.name === LayoutEventMethodName; });\r\n        if (hasLayoutMethod) {\r\n            this.interop.invoke(LayoutEventMethodName, { event: event, layout: layout }, \"all\").catch(function () { });\r\n        }\r\n    };\r\n    return LayoutsController;\r\n}());\n\nvar LayoutStorage = (function () {\r\n    function LayoutStorage(localStore, autoStore, remoteStore) {\r\n        this.localStore = localStore;\r\n        this.autoStore = autoStore;\r\n        this.remoteStore = remoteStore;\r\n    }\r\n    LayoutStorage.prototype.get = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var foundRemote, foundLocal;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        foundRemote = _b.sent();\r\n                        return [4, this.localStore.get(name, layoutType)];\r\n                    case 2:\r\n                        foundLocal = _b.sent();\r\n                        if (foundRemote && foundLocal) {\r\n                            return [2, foundRemote];\r\n                        }\r\n                        return [2, foundRemote || foundLocal];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, local, remote, nonConflictLocal;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, Promise.all([\r\n                            this.localStore.getAll(layoutType),\r\n                            new Promise(function (resolve) {\r\n                                if (_this.remoteStore) {\r\n                                    return _this.remoteStore.getAll(layoutType).then(resolve);\r\n                                }\r\n                                resolve([]);\r\n                            })\r\n                        ])];\r\n                    case 1:\r\n                        _a = _b.sent(), local = _a[0], remote = _a[1];\r\n                        nonConflictLocal = local.filter(function (localLayout) { return !remote.some(function (remoteLayout) { return remoteLayout.name === localLayout.name; }); });\r\n                        return [2, remote.concat(nonConflictLocal)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.store = function (layout, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(layout.name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot save layout with name: \" + layout.name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        if (!layout.metadata) {\r\n                            layout.metadata = { allowSave: true };\r\n                        }\r\n                        else {\r\n                            layout.metadata.allowSave = true;\r\n                        }\r\n                        return [4, this.localStore.store(layout, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.remove = function (name, layoutType) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var remoteLayout;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4, ((_a = this.remoteStore) === null || _a === void 0 ? void 0 : _a.get(name, layoutType))];\r\n                    case 1:\r\n                        remoteLayout = _b.sent();\r\n                        if (remoteLayout) {\r\n                            throw new Error(\"Cannot remove layout with name: \" + name + \" and type: \" + layoutType + \", because it is present in the remote store and is treated as readonly\");\r\n                        }\r\n                        return [4, this.localStore.delete(name, layoutType)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LayoutStorage.prototype.getAutoLayout = function (name) {\r\n        return this.autoStore.get(name, \"Global\");\r\n    };\r\n    LayoutStorage.prototype.storeAutoLayout = function (layout) {\r\n        this.autoStore.save(layout);\r\n    };\r\n    return LayoutStorage;\r\n}());\n\nconst instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nvar LocalStore = (function () {\r\n    function LocalStore() {\r\n        if (!(\"indexedDB\" in window)) {\r\n            throw new Error(\"Cannot initialize the local storage, because IndexedDb is not supported\");\r\n        }\r\n    }\r\n    Object.defineProperty(LocalStore.prototype, \"database\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (this._database) {\r\n                return Promise.resolve(this._database);\r\n            }\r\n            return new Promise(function (resolve) {\r\n                openDB(dbName, dbVersion, { upgrade: _this.setUpDb.bind(_this) })\r\n                    .then(function (database) {\r\n                    _this._database = database;\r\n                    resolve(_this._database);\r\n                });\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LocalStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).getAll(\"workspaceLayouts\")];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).getAll(\"globalLayouts\")];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.delete = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).delete(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).delete(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).get(\"workspaceLayouts\", name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).get(\"globalLayouts\", name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.store = function (layout, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        layoutDecoder.runWithException(layout);\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        _a = layoutType;\r\n                        switch (_a) {\r\n                            case \"Workspace\": return [3, 1];\r\n                            case \"Global\": return [3, 3];\r\n                        }\r\n                        return [3, 5];\r\n                    case 1: return [4, this.database];\r\n                    case 2: return [2, (_b.sent()).put(\"workspaceLayouts\", layout, layout.name)];\r\n                    case 3: return [4, this.database];\r\n                    case 4: return [2, (_b.sent()).put(\"globalLayouts\", layout, layout.name)];\r\n                    case 5: throw new Error(\"The provided layout type is not recognized: \" + layoutType);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocalStore.prototype.setUpDb = function (database) {\r\n        if (!database.objectStoreNames.contains(\"workspaceLayouts\")) {\r\n            database.createObjectStore(\"workspaceLayouts\");\r\n        }\r\n        if (!database.objectStoreNames.contains(\"globalLayouts\")) {\r\n            database.createObjectStore(\"globalLayouts\");\r\n        }\r\n    };\r\n    return LocalStore;\r\n}());\n\nvar JSONStore = (function () {\r\n    function JSONStore(storeBaseUrl) {\r\n        this.storeBaseUrl = storeBaseUrl;\r\n    }\r\n    JSONStore.prototype.getAll = function (layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var fetchUrl, response, layouts, error_1, layoutProp, layoutsToVerify;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        layoutTypeDecoder.runWithException(layoutType);\r\n                        fetchUrl = this.storeBaseUrl + \"/\" + defaultLayoutsName;\r\n                        return [4, this.fetchTimeout(fetchUrl)];\r\n                    case 1:\r\n                        response = _a.sent();\r\n                        if (!response.ok) {\r\n                            return [2, []];\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4, response.json()];\r\n                    case 3:\r\n                        layouts = _a.sent();\r\n                        return [3, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        return [2, []];\r\n                    case 5:\r\n                        if (!layouts) {\r\n                            return [2, []];\r\n                        }\r\n                        layoutProp = layoutType === \"Global\" ? \"globals\" : \"workspaces\";\r\n                        layoutsToVerify = (layouts[layoutProp] || []);\r\n                        return [2, layoutsToVerify.filter(function (layout) {\r\n                                var decodeResult = layoutDecoder.run(layout);\r\n                                if (!decodeResult.ok) {\r\n                                    console.warn(\"Fetched layout: \" + layout.name + \" is discarded, because it failed the validation: \" + JSON.stringify(decodeResult));\r\n                                }\r\n                                return decodeResult.ok;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JSONStore.prototype.get = function (name, layoutType) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var allLayouts;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.getAll(layoutType)];\r\n                    case 1:\r\n                        allLayouts = _a.sent();\r\n                        return [2, allLayouts.find(function (layout) { return layout.name === name; })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JSONStore.prototype.fetchTimeout = function (url, timeoutMilliseconds) {\r\n        if (timeoutMilliseconds === void 0) { timeoutMilliseconds = 1000; }\r\n        return new Promise(function (resolve, reject) {\r\n            var timeoutHit = false;\r\n            var timeout = setTimeout(function () {\r\n                timeoutHit = true;\r\n                reject(new Error(\"Fetch request for: \" + url + \" timed out at: \" + timeoutMilliseconds + \" milliseconds\"));\r\n            }, timeoutMilliseconds);\r\n            fetch(url)\r\n                .then(function (response) {\r\n                if (!timeoutHit) {\r\n                    clearTimeout(timeout);\r\n                    resolve(response);\r\n                }\r\n            })\r\n                .catch(function (err) {\r\n                if (!timeoutHit) {\r\n                    clearTimeout(timeout);\r\n                    reject(err);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return JSONStore;\r\n}());\n\nvar AutoStorage = (function () {\r\n    function AutoStorage() {\r\n    }\r\n    AutoStorage.prototype.get = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        return obj[key];\r\n    };\r\n    AutoStorage.prototype.save = function (layout) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(layout.name, layout.type);\r\n        obj[key] = layout;\r\n        this.setObjectToLocalStorage(obj);\r\n        return layout;\r\n    };\r\n    AutoStorage.prototype.remove = function (name, type) {\r\n        var obj = this.getObjectFromLocalStorage();\r\n        var key = this.getKey(name, type);\r\n        delete obj[key];\r\n    };\r\n    AutoStorage.prototype.getObjectFromLocalStorage = function () {\r\n        var values = window.localStorage.getItem(AutoStorage.KEY);\r\n        if (values) {\r\n            return JSON.parse(values);\r\n        }\r\n        return {};\r\n    };\r\n    AutoStorage.prototype.setObjectToLocalStorage = function (obj) {\r\n        window.localStorage.setItem(AutoStorage.KEY, JSON.stringify(obj));\r\n    };\r\n    AutoStorage.prototype.getKey = function (name, type) {\r\n        return type + \"_\" + name;\r\n    };\r\n    AutoStorage.KEY = \"G0_layouts\";\r\n    return AutoStorage;\r\n}());\n\nvar hookCloseEvents = function (api, config, control, layoutsController) {\r\n    var done = false;\r\n    var doneFn = function () { return __awaiter(void 0, void 0, void 0, function () {\r\n        var shouldSave, allChildren, firstChild, layoutName, command;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            if (!done) {\r\n                done = true;\r\n                shouldSave = (_a = config === null || config === void 0 ? void 0 : config.layouts) === null || _a === void 0 ? void 0 : _a.autoRestore;\r\n                if (shouldSave) {\r\n                    allChildren = api.windows.getChildWindows().map(function (w) { return w.id; });\r\n                    firstChild = allChildren[0];\r\n                    layoutName = \"_auto_\" + document.location.href;\r\n                    if (allChildren.length > 0) {\r\n                        command = {\r\n                            domain: \"layouts\",\r\n                            command: \"saveLayoutAndClose\",\r\n                            args: {\r\n                                childWindows: allChildren,\r\n                                closeEveryone: true,\r\n                                layoutName: layoutName,\r\n                                context: {},\r\n                                metadata: {},\r\n                                parentInfo: layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.getLocalLayoutComponent({}, true)\r\n                            }\r\n                        };\r\n                        control.send(command, { windowId: firstChild });\r\n                    }\r\n                    else {\r\n                        layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.autoSave({ name: layoutName });\r\n                    }\r\n                }\r\n                api.done();\r\n            }\r\n            return [2];\r\n        });\r\n    }); };\r\n    window.addEventListener(\"beforeunload\", function () {\r\n        doneFn();\r\n    });\r\n};\r\nvar createFactoryFunction = function (coreFactoryFunction) {\r\n    return function (config) { return __awaiter(void 0, void 0, void 0, function () {\r\n        var builtCoreConfig, isWebEnvironment, shouldInitializeChannels, shouldInitializeAppManager, gdWindowContext, control, windows, appManager, layoutsController, ext, channelsLib, appManagerLib, intentsLib, coreConfig, core;\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;\r\n        return __generator(this, function (_r) {\r\n            switch (_r.label) {\r\n                case 0: return [4, buildConfig(config)];\r\n                case 1:\r\n                    builtCoreConfig = _r.sent();\r\n                    isWebEnvironment = typeof window !== \"undefined\";\r\n                    shouldInitializeChannels = ((_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.channels) || false;\r\n                    shouldInitializeAppManager = ((_b = builtCoreConfig.glue) === null || _b === void 0 ? void 0 : _b.appManager) || false;\r\n                    if (isWebEnvironment) {\r\n                        gdWindowContext = window;\r\n                        if ((gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.glue42gd) && (gdWindowContext === null || gdWindowContext === void 0 ? void 0 : gdWindowContext.Glue)) {\r\n                            return [2, gdWindowContext.Glue({\r\n                                    windows: true,\r\n                                    logger: (_c = builtCoreConfig.glue) === null || _c === void 0 ? void 0 : _c.logger,\r\n                                    channels: shouldInitializeChannels,\r\n                                    layouts: true,\r\n                                    appManager: shouldInitializeAppManager,\r\n                                    libraries: config.libraries\r\n                                })];\r\n                        }\r\n                    }\r\n                    control = new Control();\r\n                    ext = {\r\n                        libs: [\r\n                            {\r\n                                name: \"notifications\",\r\n                                create: function (coreLib) { return new Notifications(coreLib.interop); }\r\n                            }\r\n                        ],\r\n                        version: version\r\n                    };\r\n                    if (shouldInitializeChannels) {\r\n                        channelsLib = {\r\n                            name: \"channels\",\r\n                            create: function (coreLib) { return new Channels(coreLib.contexts, builtCoreConfig.channels); }\r\n                        };\r\n                        (_d = ext.libs) === null || _d === void 0 ? void 0 : _d.push(channelsLib);\r\n                    }\r\n                    if (isWebEnvironment) {\r\n                        (_e = ext.libs) === null || _e === void 0 ? void 0 : _e.push({\r\n                            name: \"windows\",\r\n                            create: function (coreLib) {\r\n                                windows = new Windows(coreLib.interop, control);\r\n                                return windows;\r\n                            }\r\n                        }, {\r\n                            name: \"layouts\",\r\n                            create: function (coreLib) {\r\n                                var _a, _b;\r\n                                var remoteStore;\r\n                                if (((_a = builtCoreConfig.layouts) === null || _a === void 0 ? void 0 : _a.remoteType) === \"json\") {\r\n                                    var baseLocation = ((_b = builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue.assets) === null || _b === void 0 ? void 0 : _b.location) || defaultAssetsBaseLocation;\r\n                                    remoteStore = new JSONStore(baseLocation);\r\n                                }\r\n                                var localStore = new LocalStore();\r\n                                var autoStore = new AutoStorage();\r\n                                var layoutsStorage = new LayoutStorage(localStore, autoStore, remoteStore);\r\n                                layoutsController = new LayoutsController(layoutsStorage, windows, control, coreLib.interop, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue);\r\n                                return new Layouts(layoutsController);\r\n                            }\r\n                        });\r\n                        appManagerLib = {\r\n                            name: \"appManager\",\r\n                            create: function (coreLib) {\r\n                                var _a;\r\n                                appManager = new AppManager(windows, coreLib.interop, control, builtCoreConfig.appManager, (_a = builtCoreConfig.glue) === null || _a === void 0 ? void 0 : _a.application);\r\n                                return shouldInitializeAppManager ? appManager : undefined;\r\n                            }\r\n                        };\r\n                        intentsLib = {\r\n                            name: \"intents\",\r\n                            create: function (coreLib) { return new Intents(coreLib.interop, windows, appManager); }\r\n                        };\r\n                        (_f = ext.libs) === null || _f === void 0 ? void 0 : _f.push(appManagerLib, intentsLib);\r\n                    }\r\n                    coreConfig = {\r\n                        gateway: {\r\n                            sharedWorker: (_h = (_g = builtCoreConfig.glue) === null || _g === void 0 ? void 0 : _g.worker) !== null && _h !== void 0 ? _h : defaultWorkerLocation,\r\n                            inproc: (_j = builtCoreConfig.glue) === null || _j === void 0 ? void 0 : _j.inproc\r\n                        },\r\n                        logger: (_k = builtCoreConfig.glue) === null || _k === void 0 ? void 0 : _k.logger,\r\n                        application: (_l = builtCoreConfig.glue) === null || _l === void 0 ? void 0 : _l.application\r\n                    };\r\n                    if (isWebEnvironment && !window.SharedWorker) {\r\n                        throw new Error(\"Cannot initialize Glue Web, because this environment does not support Shared Workers\");\r\n                    }\r\n                    return [4, promisePlus(function () { return coreFactoryFunction(coreConfig, ext); }, 10000, \"Glue Web initialization timed out\")];\r\n                case 2:\r\n                    core = _r.sent();\r\n                    if (!(config === null || config === void 0 ? void 0 : config.libraries)) return [3, 4];\r\n                    return [4, Promise.all(config.libraries.map(function (lib) { return lib(core, builtCoreConfig === null || builtCoreConfig === void 0 ? void 0 : builtCoreConfig.glue); }))];\r\n                case 3:\r\n                    _r.sent();\r\n                    _r.label = 4;\r\n                case 4:\r\n                    control.start(core.interop, core.logger.subLogger(\"control\"));\r\n                    if (!isWebEnvironment) return [3, 9];\r\n                    return [4, initStartupContext(core.windows.my(), core.interop, (_m = core.appManager) === null || _m === void 0 ? void 0 : _m.myInstance)];\r\n                case 5:\r\n                    _r.sent();\r\n                    if (!((_p = (_o = builtCoreConfig.glue) === null || _o === void 0 ? void 0 : _o.layouts) === null || _p === void 0 ? void 0 : _p.autoRestore)) return [3, 7];\r\n                    return [4, (layoutsController === null || layoutsController === void 0 ? void 0 : layoutsController.restoreAutoSavedLayout())];\r\n                case 6:\r\n                    _r.sent();\r\n                    _r.label = 7;\r\n                case 7: return [4, hookCloseEvents(core, (_q = builtCoreConfig.glue) !== null && _q !== void 0 ? _q : {}, control, layoutsController)];\r\n                case 8:\r\n                    _r.sent();\r\n                    _r.label = 9;\r\n                case 9: return [2, core];\r\n            }\r\n        });\r\n    }); };\r\n};\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics$1 = function(d, b) {\r\n    extendStatics$1 = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics$1(d, b);\r\n};\r\n\r\nfunction __extends$1(d, b) {\r\n    extendStatics$1(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign$2 = function() {\r\n    __assign$2 = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign$2.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter$1(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator$1(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar MetricTypes = {\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    TIMESTAMP: 3,\r\n    OBJECT: 4\r\n};\n\nfunction getMetricTypeByValue(metric) {\r\n    if (metric.type === MetricTypes.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (metric.type === MetricTypes.NUMBER) {\r\n        return \"number\";\r\n    }\r\n    else if (metric.type === MetricTypes.STRING) {\r\n        return \"string\";\r\n    }\r\n    else if (metric.type === MetricTypes.OBJECT) {\r\n        return \"object\";\r\n    }\r\n    return \"unknown\";\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        if (!a.state) {\r\n            return 1;\r\n        }\r\n        if (!b.state) {\r\n            return -1;\r\n        }\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\n\nfunction gw3 (connection, config) {\r\n    var _this = this;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\");\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect && resolveReadyPromise) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join({\r\n            system: config.system,\r\n            service: config.service,\r\n            instance: config.instance\r\n        });\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metric, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (system.parent === undefined) {\r\n                        return [2];\r\n                    }\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    metric = {\r\n                        name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        type: \"object\",\r\n                        composite: {\r\n                            Description: {\r\n                                type: \"string\",\r\n                                description: \"\",\r\n                            },\r\n                            Value: {\r\n                                type: \"number\",\r\n                                description: \"\",\r\n                            },\r\n                        },\r\n                        description: \"System state\",\r\n                        context: {},\r\n                    };\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [metric],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateSystem = function (system, state) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var shadowedUpdateMetric, stateObj, rootMetric;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    shadowedUpdateMetric = {\r\n                        type: \"publish\",\r\n                        values: [{\r\n                                name: normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                                value: {\r\n                                    Description: state.description,\r\n                                    Value: state.state,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(shadowedUpdateMetric);\r\n                    stateObj = composeMsgForRootStateMetric(system);\r\n                    rootMetric = {\r\n                        type: \"publish\",\r\n                        peer_id: connection.peerId,\r\n                        values: [{\r\n                                name: \"/State\",\r\n                                value: {\r\n                                    Description: stateObj.description,\r\n                                    Value: stateObj.value,\r\n                                },\r\n                                timestamp: Date.now(),\r\n                            }],\r\n                    };\r\n                    session.send(rootMetric);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var createMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone, m, createMetricsMsg;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    m = serializeMetric(metricClone);\r\n                    createMetricsMsg = {\r\n                        type: \"define\",\r\n                        metrics: [m],\r\n                    };\r\n                    session.send(createMetricsMsg);\r\n                    if (typeof metricClone.value !== \"undefined\") {\r\n                        updateMetricCore(metricClone);\r\n                    }\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetric = function (metric) { return __awaiter$1(_this, void 0, void 0, function () {\r\n        var metricClone;\r\n        return __generator$1(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    metricClone = cloneMetric(metric);\r\n                    return [4, joinPromise];\r\n                case 1:\r\n                    _a.sent();\r\n                    updateMetricCore(metricClone);\r\n                    return [2];\r\n            }\r\n        });\r\n    }); };\r\n    var updateMetricCore = function (metric) {\r\n        if (canUpdate()) {\r\n            var value = getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            return session.send(publishMetricsMsg);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    var cloneMetric = function (metric) {\r\n        var metricClone = __assign$2({}, metric);\r\n        if (typeof metric.value === \"object\" && metric.value !== null) {\r\n            metricClone.value = __assign$2({}, metric.value);\r\n        }\r\n        return metricClone;\r\n    };\r\n    var canUpdate = function () {\r\n        var _a;\r\n        try {\r\n            var func = (_a = config.canUpdateMetric) !== null && _a !== void 0 ? _a : (function () { return true; });\r\n            return func();\r\n        }\r\n        catch (_b) {\r\n            return true;\r\n        }\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\n\nvar Helpers = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\n\nvar BaseMetric = (function () {\r\n    function BaseMetric(definition, system, transport, value, type) {\r\n        this.definition = definition;\r\n        this.system = system;\r\n        this.transport = transport;\r\n        this.value = value;\r\n        this.type = type;\r\n        this.path = [];\r\n        Helpers.validate(definition, system, transport);\r\n        this.path = system.path.slice(0);\r\n        this.path.push(system.name);\r\n        this.name = definition.name;\r\n        this.description = definition.description;\r\n        transport.createMetric(this);\r\n    }\r\n    Object.defineProperty(BaseMetric.prototype, \"repo\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.system) === null || _a === void 0 ? void 0 : _a.repo;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(BaseMetric.prototype, \"id\", {\r\n        get: function () { return this.system.path + \"/\" + name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    BaseMetric.prototype.update = function (newValue) {\r\n        this.value = newValue;\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    return BaseMetric;\r\n}());\n\nvar NumberMetric = (function (_super) {\r\n    __extends$1(NumberMetric, _super);\r\n    function NumberMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.NUMBER) || this;\r\n    }\r\n    NumberMetric.prototype.incrementBy = function (num) {\r\n        this.update(this.value + num);\r\n    };\r\n    NumberMetric.prototype.increment = function () {\r\n        this.incrementBy(1);\r\n    };\r\n    NumberMetric.prototype.decrement = function () {\r\n        this.incrementBy(-1);\r\n    };\r\n    NumberMetric.prototype.decrementBy = function (num) {\r\n        this.incrementBy(num * -1);\r\n    };\r\n    return NumberMetric;\r\n}(BaseMetric));\n\nvar ObjectMetric = (function (_super) {\r\n    __extends$1(ObjectMetric, _super);\r\n    function ObjectMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.OBJECT) || this;\r\n    }\r\n    ObjectMetric.prototype.update = function (newValue) {\r\n        this.mergeValues(newValue);\r\n        return this.transport.updateMetric(this);\r\n    };\r\n    ObjectMetric.prototype.mergeValues = function (values) {\r\n        var _this = this;\r\n        return Object.keys(this.value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _this.value[k] = values[k];\r\n            }\r\n        });\r\n    };\r\n    return ObjectMetric;\r\n}(BaseMetric));\n\nvar StringMetric = (function (_super) {\r\n    __extends$1(StringMetric, _super);\r\n    function StringMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.STRING) || this;\r\n    }\r\n    return StringMetric;\r\n}(BaseMetric));\n\nvar TimestampMetric = (function (_super) {\r\n    __extends$1(TimestampMetric, _super);\r\n    function TimestampMetric(definition, system, transport, value) {\r\n        return _super.call(this, definition, system, transport, value, MetricTypes.TIMESTAMP) || this;\r\n    }\r\n    TimestampMetric.prototype.now = function () {\r\n        this.update(new Date());\r\n    };\r\n    return TimestampMetric;\r\n}(BaseMetric));\n\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.STRING, value, function (metricDef) { return new StringMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.NUMBER, value, function (metricDef) { return new NumberMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.OBJECT, value, function (metricDef) { return new ObjectMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric(definition, MetricTypes.TIMESTAMP, value, function (metricDef) { return new TimestampMetric(metricDef, me, _transport, value); });\r\n    }\r\n    function _getOrCreateMetric(metricObject, expectedType, value, createMetric) {\r\n        var metricDef = { name: \"\" };\r\n        if (typeof metricObject === \"string\") {\r\n            metricDef = { name: metricObject };\r\n        }\r\n        else {\r\n            metricDef = metricObject;\r\n        }\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDef.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDef.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing\r\n                    .update(value)\r\n                    .catch(function () { });\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDef);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        timestampMetric: timestampMetric,\r\n        objectMetric: objectMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\n\nvar Repository = (function () {\r\n    function Repository(options, protocol) {\r\n        protocol.init(this);\r\n        this.root = system(\"\", this, protocol);\r\n        this.addSystemMetrics(this.root, options.clickStream || options.clickStream === undefined);\r\n    }\r\n    Repository.prototype.addSystemMetrics = function (rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    };\r\n    return Repository;\r\n}());\n\nvar NullProtocol = (function () {\r\n    function NullProtocol() {\r\n    }\r\n    NullProtocol.prototype.init = function (repo) {\r\n    };\r\n    NullProtocol.prototype.createSystem = function (system) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateSystem = function (metric, state) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.createMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    NullProtocol.prototype.updateMetric = function (metric) {\r\n        return Promise.resolve();\r\n    };\r\n    return NullProtocol;\r\n}());\n\nvar PerfTracker = (function () {\r\n    function PerfTracker(api, initialPublishTimeout, publishInterval) {\r\n        this.api = api;\r\n        this.lastCount = 0;\r\n        this.initialPublishTimeout = 10 * 1000;\r\n        this.publishInterval = 60 * 1000;\r\n        this.initialPublishTimeout = initialPublishTimeout !== null && initialPublishTimeout !== void 0 ? initialPublishTimeout : this.initialPublishTimeout;\r\n        this.publishInterval = publishInterval !== null && publishInterval !== void 0 ? publishInterval : this.publishInterval;\r\n        this.scheduleCollection();\r\n        this.system = this.api.subSystem(\"performance\", \"Performance data published by the web application\");\r\n    }\r\n    PerfTracker.prototype.scheduleCollection = function () {\r\n        var _this = this;\r\n        setTimeout(function () {\r\n            _this.collect();\r\n            setInterval(function () {\r\n                _this.collect();\r\n            }, _this.publishInterval);\r\n        }, this.initialPublishTimeout);\r\n    };\r\n    PerfTracker.prototype.collect = function () {\r\n        try {\r\n            this.collectMemory();\r\n            this.collectEntries();\r\n        }\r\n        catch (_a) {\r\n        }\r\n    };\r\n    PerfTracker.prototype.collectMemory = function () {\r\n        var memory = window.performance.memory;\r\n        this.system.stringMetric(\"memory\", JSON.stringify({\r\n            totalJSHeapSize: memory.totalJSHeapSize,\r\n            usedJSHeapSize: memory.usedJSHeapSize\r\n        }));\r\n    };\r\n    PerfTracker.prototype.collectEntries = function () {\r\n        var allEntries = window.performance.getEntries();\r\n        if (allEntries.length <= this.lastCount) {\r\n            return;\r\n        }\r\n        this.lastCount = allEntries.length;\r\n        this.system.stringMetric(\"entries\", JSON.stringify(allEntries));\r\n    };\r\n    return PerfTracker;\r\n}());\n\nvar metrics = (function (options) {\r\n    var protocol;\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        protocol = new NullProtocol();\r\n    }\r\n    else {\r\n        protocol = gw3(options.connection, options);\r\n    }\r\n    var repo = new Repository(options, protocol);\r\n    var rootSystem = repo.root;\r\n    if (!options.disableAutoAppSystem) {\r\n        rootSystem = rootSystem.subSystem(\"App\");\r\n    }\r\n    var api = addFAVSupport(rootSystem);\r\n    initPerf(api, options.pagePerformanceMetrics);\r\n    return api;\r\n});\r\nvar perf;\r\nfunction initPerf(api, config) {\r\n    var _a, _b;\r\n    if (typeof window === \"undefined\") {\r\n        return;\r\n    }\r\n    var perfConfig = (_b = (_a = window === null || window === void 0 ? void 0 : window.glue42gd) === null || _a === void 0 ? void 0 : _a.metrics) === null || _b === void 0 ? void 0 : _b.pagePerformanceMetrics;\r\n    if (perfConfig) {\r\n        config = perfConfig;\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.enabled) {\r\n        perf = new PerfTracker(api, config.initialPublishTimeout, config.publishInterval);\r\n    }\r\n}\r\nfunction addFAVSupport(system) {\r\n    var reportingSystem = system.subSystem(\"reporting\");\r\n    var def = {\r\n        name: \"features\"\r\n    };\r\n    var featureMetric;\r\n    var featureMetricFunc = function (name, action, payload) {\r\n        if (typeof name === \"undefined\" || name === \"\") {\r\n            throw new Error(\"name is mandatory\");\r\n        }\r\n        else if (typeof action === \"undefined\" || action === \"\") {\r\n            throw new Error(\"action is mandatory\");\r\n        }\r\n        else if (typeof payload === \"undefined\" || payload === \"\") {\r\n            throw new Error(\"payload is mandatory\");\r\n        }\r\n        if (!featureMetric) {\r\n            featureMetric = reportingSystem.objectMetric(def, { name: name, action: action, payload: payload });\r\n        }\r\n        else {\r\n            featureMetric.update({\r\n                name: name,\r\n                action: action,\r\n                payload: payload\r\n            });\r\n        }\r\n    };\r\n    system.featureMetric = featureMetricFunc;\r\n    return system;\r\n}\n\nfunction createRegistry$1(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback, replayArgumentsArr) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        if (replayArgumentsArr) {\r\n            setTimeout(function () {\r\n                replayArgumentsArr.forEach(function (replayArgument) {\r\n                    var _a;\r\n                    if ((_a = callbacks[key]) === null || _a === void 0 ? void 0 : _a.includes(callback)) {\r\n                        try {\r\n                            if (Array.isArray(replayArgument)) {\r\n                                callback.apply(undefined, replayArgument);\r\n                            }\r\n                            else {\r\n                                callback.apply(undefined, [replayArgument]);\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            _handleError(err, key);\r\n                        }\r\n                    }\r\n                });\r\n            }, 0);\r\n        }\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\ncreateRegistry$1.default = createRegistry$1;\r\nvar lib$2 = createRegistry$1;\n\nvar InProcTransport = (function () {\r\n    function InProcTransport(settings, logger) {\r\n        var _this = this;\r\n        this.registry = lib$2();\r\n        this.gw = settings.facade;\r\n        this.gw.connect(function (_client, message) {\r\n            _this.messageHandler(message);\r\n        }).then(function (client) {\r\n            _this.client = client;\r\n        });\r\n    }\r\n    Object.defineProperty(InProcTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InProcTransport.prototype.sendObject = function (msg) {\r\n        if (this.client) {\r\n            this.client.send(msg);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        else {\r\n            return Promise.reject(\"not connected\");\r\n        }\r\n    };\r\n    InProcTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    InProcTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    InProcTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    InProcTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.name = function () {\r\n        return \"in-memory\";\r\n    };\r\n    InProcTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    InProcTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return InProcTransport;\r\n}());\n\nvar SharedWorkerTransport = (function () {\r\n    function SharedWorkerTransport(workerFile, logger) {\r\n        var _this = this;\r\n        this.logger = logger;\r\n        this.registry = lib$2();\r\n        this.worker = new SharedWorker(workerFile);\r\n        this.worker.port.onmessage = function (e) {\r\n            _this.messageHandler(e.data);\r\n        };\r\n    }\r\n    Object.defineProperty(SharedWorkerTransport.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SharedWorkerTransport.prototype.sendObject = function (msg) {\r\n        this.worker.port.postMessage(msg);\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.send = function (_msg) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    SharedWorkerTransport.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    SharedWorkerTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    SharedWorkerTransport.prototype.close = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.open = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.name = function () {\r\n        return \"shared-worker\";\r\n    };\r\n    SharedWorkerTransport.prototype.reconnect = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SharedWorkerTransport.prototype.messageHandler = function (msg) {\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return SharedWorkerTransport;\r\n}());\n\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return undefined;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return undefined;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? undefined : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        if (typeof Utils._isNode !== \"undefined\") {\r\n            return Utils._isNode;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            Utils._isNode = false;\r\n            return false;\r\n        }\r\n        try {\r\n            Utils._isNode = Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            Utils._isNode = false;\r\n        }\r\n        return Utils._isNode;\r\n    };\r\n    return Utils;\r\n}());\n\nvar PromiseWrapper = (function () {\r\n    function PromiseWrapper() {\r\n        var _this = this;\r\n        this.rejected = false;\r\n        this.resolved = false;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = function (t) {\r\n                _this.resolved = true;\r\n                resolve(t);\r\n            };\r\n            _this.reject = function (err) {\r\n                _this.rejected = true;\r\n                reject(err);\r\n            };\r\n        });\r\n    }\r\n    PromiseWrapper.delay = function (time) {\r\n        return new Promise(function (resolve) { return setTimeout(resolve, time); });\r\n    };\r\n    Object.defineProperty(PromiseWrapper.prototype, \"ended\", {\r\n        get: function () {\r\n            return this.rejected || this.resolved;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PromiseWrapper;\r\n}());\n\nvar timers = {};\r\nfunction getAllTimers() {\r\n    return timers;\r\n}\r\nfunction timer (timerName) {\r\n    var existing = timers[timerName];\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    var marks = [];\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    mark(\"start\", startTime);\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        mark(\"end\", endTime);\r\n        period = endTime - startTime;\r\n        return period;\r\n    }\r\n    function mark(name, time) {\r\n        var currentTime = time !== null && time !== void 0 ? time : now();\r\n        var diff = 0;\r\n        if (marks.length > 0) {\r\n            diff = currentTime - marks[marks.length - 1].time;\r\n        }\r\n        marks.push({ name: name, time: currentTime, diff: diff });\r\n    }\r\n    var timerObj = {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop,\r\n        mark: mark,\r\n        marks: marks\r\n    };\r\n    timers[timerName] = timerObj;\r\n    return timerObj;\r\n}\n\nvar dummyRequire = function () { return undefined; };\r\nvar requireFunc = Utils.isNode() ? require : dummyRequire;\r\nvar WebSocketConstructor = Utils.isNode() ? requireFunc(\"ws\") : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this.startupTimer = timer(\"connection\");\r\n        this._running = true;\r\n        this._registry = lib$2();\r\n        this.wsRequests = [];\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        if (!this.settings.ws) {\r\n            throw new Error(\"ws is missing\");\r\n        }\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(function () {\r\n                var _a;\r\n                try {\r\n                    (_a = _this.ws) === null || _a === void 0 ? void 0 : _a.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        var _this = this;\r\n        this.logger.info(\"opening ws...\");\r\n        this._running = true;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.waitForSocketConnection(resolve, reject);\r\n        });\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.name = function () {\r\n        return \"ws \" + this.settings.ws;\r\n    };\r\n    WS.prototype.reconnect = function () {\r\n        var _a;\r\n        (_a = this.ws) === null || _a === void 0 ? void 0 : _a.close();\r\n        var pw = new PromiseWrapper();\r\n        this.waitForSocketConnection(function () {\r\n            pw.resolve();\r\n        });\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed) {\r\n        var _a;\r\n        failed = failed !== null && failed !== void 0 ? failed : (function () { });\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this.settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (((_a = this.ws) === null || _a === void 0 ? void 0 : _a.readyState) === 1) {\r\n            callback();\r\n            return;\r\n        }\r\n        this.wsRequests.push({ callback: callback, failed: failed });\r\n        if (this.wsRequests.length > 1) {\r\n            return;\r\n        }\r\n        this.openSocket();\r\n    };\r\n    WS.prototype.openSocket = function (retryInterval, retriesLeft) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.startupTimer.mark(\"opening-socket\");\r\n                        if (retryInterval === undefined) {\r\n                            retryInterval = this.settings.reconnectInterval;\r\n                        }\r\n                        if (retriesLeft !== undefined) {\r\n                            if (retriesLeft === 0) {\r\n                                this.notifyForSocketState(\"wait for socket on \" + this.settings.ws + \" failed - no more retries left\");\r\n                                return [2];\r\n                            }\r\n                            this.logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n                        }\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        return [4, this.initiateSocket()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this.startupTimer.mark(\"socket-initiated\");\r\n                        this.notifyForSocketState();\r\n                        return [3, 4];\r\n                    case 3:\r\n                        _a = _b.sent();\r\n                        setTimeout(function () {\r\n                            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n                            _this.openSocket(retryInterval, retries);\r\n                        }, retryInterval);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        var pw = new PromiseWrapper();\r\n        this.logger.debug(\"initiating ws to \" + this.settings.ws + \"...\");\r\n        this.ws = new WebSocketConstructor(this.settings.ws || \"\");\r\n        this.ws.onerror = function (err) {\r\n            var reason = \"\";\r\n            try {\r\n                reason = JSON.stringify(err);\r\n            }\r\n            catch (error) {\r\n                var seen_1 = new WeakSet();\r\n                var replacer = function (key, value) {\r\n                    if (typeof value === \"object\" && value !== null) {\r\n                        if (seen_1.has(value)) {\r\n                            return;\r\n                        }\r\n                        seen_1.add(value);\r\n                    }\r\n                    return value;\r\n                };\r\n                reason = JSON.stringify(err, replacer);\r\n            }\r\n            pw.reject(\"error\");\r\n            _this.notifyStatusChanged(false, reason);\r\n        };\r\n        this.ws.onclose = function (err) {\r\n            _this.logger.info(\"ws closed \" + err);\r\n            pw.reject(\"closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this.ws.onopen = function () {\r\n            var _a;\r\n            _this.startupTimer.mark(\"ws-opened\");\r\n            _this.logger.info(\"ws opened \" + ((_a = _this.settings.identity) === null || _a === void 0 ? void 0 : _a.application));\r\n            pw.resolve();\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this.ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n        return pw.promise;\r\n    };\r\n    WS.prototype.notifyForSocketState = function (error) {\r\n        this.wsRequests.forEach(function (wsRequest) {\r\n            if (error) {\r\n                if (wsRequest.failed) {\r\n                    wsRequest.failed(error);\r\n                }\r\n            }\r\n            else {\r\n                wsRequest.callback();\r\n            }\r\n        });\r\n        this.wsRequests = [];\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\n\nfunction createCommonjsModule$1(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed$1 = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue$1() {\n    seed$1 = (seed$1 * 9301 + 49297) % 233280;\n    return seed$1/(233280.0);\n}\n\nfunction setSeed$2(_seed_) {\n    seed$1 = _seed_;\n}\n\nvar randomFromSeed$1 = {\n    nextValue: getNextValue$1,\n    seed: setSeed$2\n};\n\nvar ORIGINAL$1 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet$1;\nvar previousSeed$1;\n\nvar shuffled$1;\n\nfunction reset$1() {\n    shuffled$1 = false;\n}\n\nfunction setCharacters$1(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet$1 !== ORIGINAL$1) {\n            alphabet$1 = ORIGINAL$1;\n            reset$1();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet$1) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL$1.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL$1.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet$1 = _alphabet_;\n    reset$1();\n}\n\nfunction characters$1(_alphabet_) {\n    setCharacters$1(_alphabet_);\n    return alphabet$1;\n}\n\nfunction setSeed$1$1(seed) {\n    randomFromSeed$1.seed(seed);\n    if (previousSeed$1 !== seed) {\n        reset$1();\n        previousSeed$1 = seed;\n    }\n}\n\nfunction shuffle$1() {\n    if (!alphabet$1) {\n        setCharacters$1(ORIGINAL$1);\n    }\n\n    var sourceArray = alphabet$1.split('');\n    var targetArray = [];\n    var r = randomFromSeed$1.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed$1.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled$1() {\n    if (shuffled$1) {\n        return shuffled$1;\n    }\n    shuffled$1 = shuffle$1();\n    return shuffled$1;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup$1(index) {\n    var alphabetShuffled = getShuffled$1();\n    return alphabetShuffled[index];\n}\n\nvar alphabet_1$1 = {\n    characters: characters$1,\n    seed: setSeed$1$1,\n    lookup: lookup$1,\n    shuffled: getShuffled$1\n};\n\nvar crypto$1 = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nfunction randomByte$1() {\n    if (!crypto$1 || !crypto$1.getRandomValues) {\n        return Math.floor(Math.random() * 256) & 0x30;\n    }\n    var dest = new Uint8Array(1);\n    crypto$1.getRandomValues(dest);\n    return dest[0] & 0x30;\n}\n\nvar randomByteBrowser$1 = randomByte$1;\n\nfunction encode(lookup, number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + lookup( ( (number >> (4 * loopCounter)) & 0x0f ) | randomByteBrowser$1() );\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nvar encode_1 = encode;\n\n/**\n * Decode the id to get the version and worker\n * Mainly for debugging and testing.\n * @param id - the shortid-generated id.\n */\nfunction decode(id) {\n    var characters = alphabet_1$1.shuffled();\n    return {\n        version: characters.indexOf(id.substr(0, 1)) & 0x0f,\n        worker: characters.indexOf(id.substr(1, 1)) & 0x0f\n    };\n}\n\nvar decode_1 = decode;\n\nfunction isShortId$1(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var characters = alphabet_1$1.characters();\n    var len = id.length;\n    for(var i = 0; i < len;i++) {\n        if (characters.indexOf(id[i]) === -1) {\n            return false;\n        }\n    }\n    return true;\n}\n\nvar isValid$1 = isShortId$1;\n\nvar lib$1$1 = createCommonjsModule$1(function (module) {\n\n\n\n\n\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId =  0;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + encode_1(alphabet_1$1.lookup, version);\n    str = str + encode_1(alphabet_1$1.lookup, clusterWorkerId);\n    if (counter > 0) {\n        str = str + encode_1(alphabet_1$1.lookup, counter);\n    }\n    str = str + encode_1(alphabet_1$1.lookup, seconds);\n\n    return str;\n}\n\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet_1$1.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet_1$1.characters(newCharacters);\n    }\n\n    return alphabet_1$1.shuffled();\n}\n\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.decode = decode_1;\nmodule.exports.isValid = isValid$1;\n});\nvar lib_1 = lib$1$1.generate;\nvar lib_2 = lib$1$1.seed;\nvar lib_3 = lib$1$1.worker;\nvar lib_4 = lib$1$1.characters;\nvar lib_5 = lib$1$1.decode;\nvar lib_6 = lib$1$1.isValid;\n\nvar shortid$1 = lib$1$1;\n\nfunction domainSession (domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    successMessages = successMessages || [\"success\"];\r\n    errorMessages = errorMessages || [\"error\"];\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = lib$2();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(\"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(\"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(\"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining domain \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return Promise.resolve();\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        tryReconnecting = false;\r\n        return send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.debug(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.debug(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        if (!requestId) {\r\n            return;\r\n        }\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid$1();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(msg, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n \" + e.stack + \" \\n msg was: \" + JSON.stringify(msg), e);\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\n\nvar GW3ProtocolImpl = (function () {\r\n    function GW3ProtocolImpl(connection, settings, logger) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.protocolVersion = 3;\r\n        this.datePrefix = \"#T42_DATE#\";\r\n        this.datePrefixLen = this.datePrefix.length;\r\n        this.dateMinLen = this.datePrefixLen + 1;\r\n        this.datePrefixFirstChar = this.datePrefix[0];\r\n        this.registry = lib$2();\r\n        this._isLoggedIn = false;\r\n        this.shouldTryLogin = true;\r\n        this.initialLogin = true;\r\n        this.initialLoginAttempts = 3;\r\n        this.sessions = [];\r\n        connection.disconnected(function () {\r\n            _this.handleDisconnected();\r\n        });\r\n        this.ping();\r\n    }\r\n    Object.defineProperty(GW3ProtocolImpl.prototype, \"isLoggedIn\", {\r\n        get: function () {\r\n            return this._isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3ProtocolImpl.prototype.processStringMessage = function (message) {\r\n        var _this = this;\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < _this.dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== _this.datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, _this.datePrefixLen) !== _this.datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(_this.datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createStringMessage = function (message) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            var datePrefix_1 = this.datePrefix;\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix_1 + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.processObjectMessage = function (message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    };\r\n    GW3ProtocolImpl.prototype.createObjectMessage = function (message) {\r\n        return message;\r\n    };\r\n    GW3ProtocolImpl.prototype.login = function (config, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var authentication, token, e_1, _a, helloMsg, sendOptions, welcomeMsg, msg, token, _b, err_1;\r\n            return __generator$1(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging in...\");\r\n                        this.loginConfig = config;\r\n                        if (!this.loginConfig) {\r\n                            this.loginConfig = { username: \"\", password: \"\" };\r\n                        }\r\n                        this.shouldTryLogin = true;\r\n                        authentication = {};\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        if (!config.gatewayToken) return [3, 5];\r\n                        if (!reconnect) return [3, 4];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 3, , 4]);\r\n                        return [4, this.getNewGWToken()];\r\n                    case 2:\r\n                        token = _c.sent();\r\n                        config.gatewayToken = token;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _c.sent();\r\n                        this.logger.warn(\"failed to get GW token when reconnecting \" + ((e_1 === null || e_1 === void 0 ? void 0 : e_1.message) || e_1));\r\n                        return [3, 4];\r\n                    case 4:\r\n                        authentication.method = \"gateway-token\";\r\n                        authentication.token = config.gatewayToken;\r\n                        this.connection.gatewayToken = config.gatewayToken;\r\n                        return [3, 10];\r\n                    case 5:\r\n                        if (!(config.flowName === \"sspi\")) return [3, 9];\r\n                        authentication.provider = \"win\";\r\n                        authentication.method = \"access-token\";\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 7];\r\n                        _a = authentication;\r\n                        return [4, config.flowCallback(config.sessionId, null)];\r\n                    case 6:\r\n                        _a.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        return [3, 8];\r\n                    case 7: throw new Error(\"Invalid SSPI config\");\r\n                    case 8: return [3, 10];\r\n                    case 9:\r\n                        if (config.token) {\r\n                            authentication.method = \"access-token\";\r\n                            authentication.token = config.token;\r\n                        }\r\n                        else if (config.username) {\r\n                            authentication.method = \"secret\";\r\n                            authentication.login = config.username;\r\n                            authentication.secret = config.password;\r\n                        }\r\n                        else {\r\n                            throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n                        }\r\n                        _c.label = 10;\r\n                    case 10:\r\n                        helloMsg = {\r\n                            type: \"hello\",\r\n                            identity: this.settings.identity,\r\n                            authentication: authentication\r\n                        };\r\n                        if (config.sessionId) {\r\n                            helloMsg.request_id = config.sessionId;\r\n                        }\r\n                        this.globalDomain = domainSession(\"global\", this.connection, this.logger.subLogger(\"global-domain\"), [\r\n                            \"welcome\",\r\n                            \"token\",\r\n                            \"authentication-request\"\r\n                        ]);\r\n                        sendOptions = { skipPeerId: true };\r\n                        if (this.initialLogin) {\r\n                            sendOptions.retryInterval = this.settings.reconnectInterval;\r\n                            sendOptions.maxRetries = this.settings.reconnectAttempts;\r\n                        }\r\n                        _c.label = 11;\r\n                    case 11:\r\n                        _c.trys.push([11, 19, 20, 21]);\r\n                        welcomeMsg = void 0;\r\n                        _c.label = 12;\r\n                    case 12:\r\n                        return [4, this.globalDomain.send(helloMsg, undefined, sendOptions)];\r\n                    case 13:\r\n                        msg = _c.sent();\r\n                        if (!(msg.type === \"authentication-request\")) return [3, 16];\r\n                        token = Buffer.from(msg.authentication.token, \"base64\");\r\n                        if (!(config.flowCallback && config.sessionId)) return [3, 15];\r\n                        _b = helloMsg.authentication;\r\n                        return [4, config.flowCallback(config.sessionId, token)];\r\n                    case 14:\r\n                        _b.token =\r\n                            (_c.sent())\r\n                                .data\r\n                                .toString(\"base64\");\r\n                        _c.label = 15;\r\n                    case 15:\r\n                        helloMsg.request_id = config.sessionId;\r\n                        return [3, 12];\r\n                    case 16:\r\n                        if (msg.type === \"welcome\") {\r\n                            welcomeMsg = msg;\r\n                            return [3, 18];\r\n                        }\r\n                        else if (msg.type === \"error\") {\r\n                            throw new Error(\"Authentication failed: \" + msg.reason);\r\n                        }\r\n                        else {\r\n                            throw new Error(\"Unexpected message type during authentication: \" + msg.type);\r\n                        }\r\n                    case 17: return [3, 12];\r\n                    case 18:\r\n                        this.initialLogin = false;\r\n                        this.logger.info(\"login successful with peerId \" + welcomeMsg.peer_id);\r\n                        this.connection.peerId = welcomeMsg.peer_id;\r\n                        this.connection.resolvedIdentity = welcomeMsg.resolved_identity;\r\n                        this.connection.availableDomains = welcomeMsg.available_domains;\r\n                        if (welcomeMsg.options) {\r\n                            this.connection.token = welcomeMsg.options.access_token;\r\n                            this.connection.info = welcomeMsg.options.info;\r\n                        }\r\n                        this.setLoggedIn(true);\r\n                        return [2, welcomeMsg.resolved_identity];\r\n                    case 19:\r\n                        err_1 = _c.sent();\r\n                        this.logger.error(\"error sending hello message - \" + (err_1.message || err_1.msg || err_1.reason || err_1), err_1);\r\n                        throw err_1;\r\n                    case 20:\r\n                        if (config && config.flowCallback && config.sessionId) {\r\n                            config.flowCallback(config.sessionId, null);\r\n                        }\r\n                        return [7];\r\n                    case 21: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var promises;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.debug(\"logging out...\");\r\n                        this.shouldTryLogin = false;\r\n                        if (this.pingTimer) {\r\n                            clearTimeout(this.pingTimer);\r\n                        }\r\n                        promises = this.sessions.map(function (session) {\r\n                            session.leave();\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.loggedIn = function (callback) {\r\n        if (this._isLoggedIn) {\r\n            callback();\r\n        }\r\n        return this.registry.add(\"onLoggedIn\", callback);\r\n    };\r\n    GW3ProtocolImpl.prototype.domain = function (domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = this.sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = domainSession(domainName, this.connection, domainLogger, successMessages, errorMessages);\r\n            this.sessions.push(session);\r\n        }\r\n        return session;\r\n    };\r\n    GW3ProtocolImpl.prototype.handleDisconnected = function () {\r\n        var _this = this;\r\n        this.setLoggedIn(false);\r\n        var tryToLogin = this.shouldTryLogin;\r\n        if (tryToLogin && this.initialLogin) {\r\n            if (this.initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            this.initialLoginAttempts--;\r\n        }\r\n        this.logger.debug(\"disconnected - will try new login?\" + this.shouldTryLogin);\r\n        if (this.shouldTryLogin) {\r\n            if (!this.loginConfig) {\r\n                throw new Error(\"no login info\");\r\n            }\r\n            this.connection.login(this.loginConfig, true)\r\n                .catch(function () {\r\n                setTimeout(_this.handleDisconnected, 1000);\r\n            });\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.setLoggedIn = function (value) {\r\n        this._isLoggedIn = value;\r\n        if (this._isLoggedIn) {\r\n            this.registry.execute(\"onLoggedIn\");\r\n        }\r\n    };\r\n    GW3ProtocolImpl.prototype.ping = function () {\r\n        var _this = this;\r\n        if (!this.shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (this._isLoggedIn) {\r\n            this.connection.send({ type: \"ping\" });\r\n        }\r\n        this.pingTimer = setTimeout(function () {\r\n            _this.ping();\r\n        }, 30 * 1000);\r\n    };\r\n    GW3ProtocolImpl.prototype.authToken = function () {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        if (!this.globalDomain) {\r\n            return Promise.reject(new Error(\"no global domain session\"));\r\n        }\r\n        return this.globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    };\r\n    GW3ProtocolImpl.prototype.getNewGWToken = function () {\r\n        if (typeof window !== undefined) {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                return glue42gd.getGWToken();\r\n            }\r\n        }\r\n        return Promise.reject(new Error(\"not running in GD\"));\r\n    };\r\n    return GW3ProtocolImpl;\r\n}());\n\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        var _a;\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _b = this.specs[name].types; _i < _b.length; _i++) {\r\n            var type = _b[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                (_a = this.connection) === null || _a === void 0 ? void 0 : _a.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\n\nvar Connection = (function () {\r\n    function Connection(settings, logger) {\r\n        this.settings = settings;\r\n        this.logger = logger;\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = lib$2();\r\n        this._connected = false;\r\n        this.isTrace = false;\r\n        settings = settings || {};\r\n        settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n        settings.reconnectInterval = settings.reconnectInterval || 1000;\r\n        if (settings.inproc) {\r\n            this.transport = new InProcTransport(settings.inproc, logger.subLogger(\"inMemory\"));\r\n        }\r\n        else if (settings.sharedWorker) {\r\n            this.transport = new SharedWorkerTransport(settings.sharedWorker, logger.subLogger(\"shared-worker\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            this.transport = new WS(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        this.isTrace = logger.canPublish(\"trace\");\r\n        logger.info(\"starting with \" + this.transport.name() + \" transport\");\r\n        this.protocol = new GW3ProtocolImpl(this, settings, logger.subLogger(\"protocol\"));\r\n        this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this.transport.onMessage(this.handleTransportMessage.bind(this));\r\n        if (settings.replaySpecs && settings.replaySpecs.length) {\r\n            this.replayer = new MessageReplayerImpl(settings.replaySpecs);\r\n            this.replayer.init(this);\r\n        }\r\n    }\r\n    Object.defineProperty(Connection.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            return (_a = this.protocol) === null || _a === void 0 ? void 0 : _a.protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.send = function (message, options) {\r\n        if (this.transport.sendObject &&\r\n            this.transport.isObjectBasedTransport) {\r\n            var msg = this.protocol.createObjectMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + JSON.stringify(msg));\r\n            }\r\n            return this.transport.sendObject(msg, options);\r\n        }\r\n        else {\r\n            var strMessage = this.protocol.createStringMessage(message);\r\n            if (this.isTrace) {\r\n                this.logger.trace(\">> \" + strMessage);\r\n            }\r\n            return this.transport.send(strMessage, options);\r\n        }\r\n    };\r\n    Connection.prototype.on = function (type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    Connection.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(Connection.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this.protocol.isLoggedIn;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Connection.prototype.connected = function (callback) {\r\n        var _this = this;\r\n        return this.protocol.loggedIn(function () {\r\n            callback(_this.settings.ws || _this.settings.sharedWorker || \"\");\r\n        });\r\n    };\r\n    Connection.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    Connection.prototype.login = function (authRequest, reconnect) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var identity;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.transport.open()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        timer(\"connection\").mark(\"transport-opened\");\r\n                        identity = this.protocol.login(authRequest, reconnect);\r\n                        timer(\"connection\").mark(\"protocol-logged-in\");\r\n                        return [2, identity];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.logout = function () {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.protocol.logout()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, this.transport.close()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Connection.prototype.loggedIn = function (callback) {\r\n        return this.protocol.loggedIn(callback);\r\n    };\r\n    Connection.prototype.domain = function (domain, successMessages, errorMessages) {\r\n        return this.protocol.domain(domain, this.logger.subLogger(\"domain=\" + domain), successMessages, errorMessages);\r\n    };\r\n    Connection.prototype.authToken = function () {\r\n        return this.protocol.authToken();\r\n    };\r\n    Connection.prototype.reconnect = function () {\r\n        return this.transport.reconnect();\r\n    };\r\n    Connection.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        try {\r\n                            _this.logger.error(\"Message handler failed with \" + error.stack, error);\r\n                        }\r\n                        catch (loggerError) {\r\n                            console.log(\"Message handler failed\", error);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Connection.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    Connection.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this.protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this.protocol.processObjectMessage(msg);\r\n        }\r\n        if (this.isTrace) {\r\n            this.logger.trace(\"<< \" + JSON.stringify(msgObj));\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return Connection;\r\n}());\n\nvar order = [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"off\"];\r\nvar Logger = (function () {\r\n    function Logger(name, parent, logFn) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.subLoggers = [];\r\n        this.logFn = console;\r\n        this.customLogFn = false;\r\n        this.name = name;\r\n        if (parent) {\r\n            this.path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this.path = name;\r\n        }\r\n        this.loggerFullName = \"[\" + this.path + \"]\";\r\n        this.includeTimeAndLevel = !logFn;\r\n        if (logFn) {\r\n            this.logFn = logFn;\r\n            this.customLogFn = true;\r\n        }\r\n    }\r\n    Logger.prototype.subLogger = function (name) {\r\n        var existingSub = this.subLoggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new Logger(name, this, this.customLogFn ? this.logFn : undefined);\r\n        this.subLoggers.push(sub);\r\n        return sub;\r\n    };\r\n    Logger.prototype.publishLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.publishLevel());\r\n    };\r\n    Logger.prototype.consoleLevel = function (level) {\r\n        var _a;\r\n        if (level) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.consoleLevel());\r\n    };\r\n    Logger.prototype.log = function (message, level, error) {\r\n        this.publishMessage(level || \"info\", message, error);\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        this.log(message, \"trace\");\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        this.log(message, \"debug\");\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        this.log(message, \"info\");\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        this.log(message, \"warn\");\r\n    };\r\n    Logger.prototype.error = function (message, err) {\r\n        this.log(message, \"error\");\r\n    };\r\n    Logger.prototype.canPublish = function (level, compareWith) {\r\n        var levelIdx = order.indexOf(level);\r\n        var restrictionIdx = order.indexOf(compareWith || this.consoleLevel() || \"trace\");\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    Logger.prototype.publishMessage = function (level, message, error) {\r\n        var loggerName = this.loggerFullName;\r\n        if (level === \"error\" && !error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message =\r\n                    message +\r\n                        \"\\n\" +\r\n                        e.stack\r\n                            .split(\"\\n\")\r\n                            .slice(3)\r\n                            .join(\"\\n\");\r\n            }\r\n        }\r\n        if (this.canPublish(level, this.publishLevel())) {\r\n            var interop = Logger.Interop;\r\n            if (interop) {\r\n                try {\r\n                    if (interop.methods({ name: Logger.InteropMethodName }).length > 0) {\r\n                        interop.invoke(Logger.InteropMethodName, {\r\n                            msg: \"\" + message,\r\n                            logger: loggerName,\r\n                            level: level\r\n                        });\r\n                    }\r\n                }\r\n                catch (_a) {\r\n                }\r\n            }\r\n        }\r\n        if (this.canPublish(level)) {\r\n            var prefix = \"\";\r\n            if (this.includeTimeAndLevel) {\r\n                var date = new Date();\r\n                var time = date.getHours() + \":\" + date.getMinutes() + \":\" + date.getSeconds() + \":\" + date.getMilliseconds();\r\n                prefix = \"[\" + time + \"] [\" + level + \"] \";\r\n            }\r\n            var toPrint = \"\" + prefix + loggerName + \": \" + message;\r\n            switch (level) {\r\n                case \"trace\":\r\n                    this.logFn.debug(toPrint);\r\n                    break;\r\n                case \"debug\":\r\n                    if (this.logFn.debug) {\r\n                        this.logFn.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        this.logFn.log(toPrint);\r\n                    }\r\n                    break;\r\n                case \"info\":\r\n                    this.logFn.info(toPrint);\r\n                    break;\r\n                case \"warn\":\r\n                    this.logFn.warn(toPrint);\r\n                    break;\r\n                case \"error\":\r\n                    this.logFn.error(toPrint, error);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Logger.InteropMethodName = \"T42.AppLogger.Log\";\r\n    return Logger;\r\n}());\n\nvar GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nvar GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nvar GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nvar GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nvar GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nvar GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nvar GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nvar GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nvar GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nvar GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nvar GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nvar GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nvar GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\n\nvar ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            GW_MESSAGE_CREATE_CONTEXT,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            GW_MESSAGE_DESTROY_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_UPDATE_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\n\nvar version$2 = \"5.2.4\";\n\nfunction prepareConfig (configuration, ext, glue42gd) {\r\n    var _a, _b, _c, _d;\r\n    var nodeStartingContext;\r\n    if (Utils.isNode()) {\r\n        var startingContextString = process.env._GD_STARTING_CONTEXT_;\r\n        if (startingContextString) {\r\n            try {\r\n                nodeStartingContext = JSON.parse(startingContextString);\r\n            }\r\n            catch (_e) {\r\n            }\r\n        }\r\n    }\r\n    function getConnection() {\r\n        var _a, _b, _c, _d;\r\n        var gwConfig = configuration.gateway;\r\n        var protocolVersion = (_a = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.protocolVersion) !== null && _a !== void 0 ? _a : 3;\r\n        var reconnectInterval = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectInterval;\r\n        var reconnectAttempts = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.reconnectAttempts;\r\n        var defaultWs = \"ws://localhost:8385\";\r\n        var ws = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.ws;\r\n        var sharedWorker = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.sharedWorker;\r\n        var inproc = gwConfig === null || gwConfig === void 0 ? void 0 : gwConfig.inproc;\r\n        if (glue42gd) {\r\n            ws = glue42gd.gwURL;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwURL) {\r\n            ws = nodeStartingContext.gwURL;\r\n        }\r\n        if (!ws && !sharedWorker && !inproc) {\r\n            ws = defaultWs;\r\n        }\r\n        var instanceId;\r\n        var windowId;\r\n        var pid;\r\n        var environment;\r\n        var region;\r\n        var appName = getApplication();\r\n        var uniqueAppName = appName;\r\n        if (typeof glue42gd !== \"undefined\") {\r\n            windowId = glue42gd.windowId;\r\n            pid = glue42gd.pid;\r\n            if (glue42gd.env) {\r\n                environment = glue42gd.env.env;\r\n                region = glue42gd.env.region;\r\n            }\r\n            uniqueAppName = (_b = glue42gd.application) !== null && _b !== void 0 ? _b : \"glue-app\";\r\n            instanceId = glue42gd.appInstanceId;\r\n        }\r\n        else if (Utils.isNode()) {\r\n            pid = process.pid;\r\n            if (nodeStartingContext) {\r\n                environment = nodeStartingContext.env;\r\n                region = nodeStartingContext.region;\r\n                instanceId = nodeStartingContext.instanceId;\r\n            }\r\n        }\r\n        else {\r\n            windowId = window.name || shortid$1();\r\n        }\r\n        var replaySpecs = (_d = (_c = configuration.gateway) === null || _c === void 0 ? void 0 : _c.replaySpecs) !== null && _d !== void 0 ? _d : [];\r\n        replaySpecs.push(ContextMessageReplaySpec);\r\n        return {\r\n            identity: {\r\n                application: uniqueAppName,\r\n                applicationName: appName,\r\n                windowId: windowId,\r\n                instance: instanceId,\r\n                process: pid,\r\n                region: region,\r\n                environment: environment,\r\n                api: ext.version || version$2\r\n            },\r\n            reconnectInterval: reconnectInterval,\r\n            ws: ws,\r\n            sharedWorker: sharedWorker,\r\n            inproc: inproc,\r\n            protocolVersion: protocolVersion,\r\n            reconnectAttempts: reconnectAttempts,\r\n            replaySpecs: replaySpecs,\r\n        };\r\n    }\r\n    function getApplication() {\r\n        if (configuration.application) {\r\n            return configuration.application;\r\n        }\r\n        if (glue42gd) {\r\n            return glue42gd.applicationName;\r\n        }\r\n        var uid = shortid$1();\r\n        if (Utils.isNode()) {\r\n            if (nodeStartingContext) {\r\n                return nodeStartingContext.applicationConfig.name;\r\n            }\r\n            return \"NodeJS\" + uid;\r\n        }\r\n        if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n            return document.title + (\" (\" + uid + \")\");\r\n        }\r\n        return uid;\r\n    }\r\n    function getAuth() {\r\n        var _a, _b;\r\n        if (typeof configuration.auth === \"string\") {\r\n            return {\r\n                token: configuration.auth\r\n            };\r\n        }\r\n        if (configuration.auth) {\r\n            return configuration.auth;\r\n        }\r\n        if (Utils.isNode() && nodeStartingContext && nodeStartingContext.gwToken) {\r\n            return {\r\n                gatewayToken: nodeStartingContext.gwToken\r\n            };\r\n        }\r\n        if (((_a = configuration.gateway) === null || _a === void 0 ? void 0 : _a.inproc) || ((_b = configuration.gateway) === null || _b === void 0 ? void 0 : _b.sharedWorker)) {\r\n            return {\r\n                username: \"glue42\", password: \"glue42\"\r\n            };\r\n        }\r\n    }\r\n    function getLogger() {\r\n        var _a, _b;\r\n        var config = configuration.logger;\r\n        var defaultLevel = \"warn\";\r\n        if (!config) {\r\n            config = defaultLevel;\r\n        }\r\n        var gdConsoleLevel;\r\n        if (glue42gd) {\r\n            gdConsoleLevel = glue42gd.consoleLogLevel;\r\n        }\r\n        if (typeof config === \"string\") {\r\n            return { console: gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config, publish: defaultLevel };\r\n        }\r\n        return {\r\n            console: (_a = gdConsoleLevel !== null && gdConsoleLevel !== void 0 ? gdConsoleLevel : config.console) !== null && _a !== void 0 ? _a : defaultLevel,\r\n            publish: (_b = config.publish) !== null && _b !== void 0 ? _b : defaultLevel\r\n        };\r\n    }\r\n    var connection = getConnection();\r\n    return {\r\n        bus: (_a = configuration.bus) !== null && _a !== void 0 ? _a : false,\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: (_b = configuration.metrics) !== null && _b !== void 0 ? _b : true,\r\n        contexts: (_c = configuration.contexts) !== null && _c !== void 0 ? _c : true,\r\n        version: ext.version || version$2,\r\n        libs: (_d = ext.libs) !== null && _d !== void 0 ? _d : [],\r\n        customLogger: configuration.customLogger\r\n    };\r\n}\n\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\n\nfunction applyContextDelta(context, delta, logger) {\r\n    try {\r\n        if (logger === null || logger === void 0 ? void 0 : logger.canPublish(\"trace\")) {\r\n            logger === null || logger === void 0 ? void 0 : logger.trace(\"applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context));\r\n        }\r\n        if (!delta) {\r\n            return context;\r\n        }\r\n        if (delta.reset) {\r\n            context = __assign$2({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, undefined);\r\n        if (delta.commands) {\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    deletePath(context, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(context, command.value, command.path);\r\n                }\r\n            }\r\n            return context;\r\n        }\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n        return context;\r\n    }\r\n    catch (e) {\r\n        logger === null || logger === void 0 ? void 0 : logger.error(\"error applying context delta \" + JSON.stringify(delta) + \" on context \" + JSON.stringify(context), e);\r\n        return context;\r\n    }\r\n}\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    return Object.assign.apply(Object, __spreadArrays([result], Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction setValueToPath(obj, value, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        if (typeof obj[pathArr[i]] !== \"object\") {\r\n            obj[pathArr[i]] = {};\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    obj[pathArr[i]] = value;\r\n}\r\nfunction deletePath(obj, path) {\r\n    var pathArr = path.split(\".\");\r\n    var i;\r\n    for (i = 0; i < pathArr.length - 1; i++) {\r\n        if (!obj[pathArr[i]]) {\r\n            return;\r\n        }\r\n        obj = obj[pathArr[i]];\r\n    }\r\n    delete obj[pathArr[i]];\r\n}\n\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        var _a;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._protocolVersion = undefined;\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", [\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        (_a = this._connection.replayer) === null || _a === void 0 ? void 0 : _a.drain(ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(GW3Bridge.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            var _a;\r\n            if (!this._protocolVersion) {\r\n                var contextsDomainInfo = this._connection.availableDomains.find(function (d) { return d.uri === \"context\"; });\r\n                this._protocolVersion = (_a = contextsDomainInfo === null || contextsDomainInfo === void 0 ? void 0 : contextsDomainInfo.version) !== null && _a !== void 0 ? _a : 1;\r\n            }\r\n            return this._protocolVersion;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(GW3Bridge.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this.protocolVersion >= 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            _this._contextIdToName[createContextMsg.context_id] = name;\r\n            var contextData = _this._contextNameToData[name] || new GW3ContextData(createContextMsg.context_id, name, true, undefined);\r\n            contextData.isAnnounced = true;\r\n            contextData.name = name;\r\n            contextData.contextId = createContextMsg.context_id;\r\n            contextData.context = data;\r\n            _this._contextNameToData[name] = contextData;\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _a;\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var contextData, currentContext, calculatedDelta;\r\n            var _this = this;\r\n            return __generator$1(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contextData = this._contextNameToData[name];\r\n                        if (!contextData || !contextData.isAnnounced) {\r\n                            return [2, this.createContext(name, delta)];\r\n                        }\r\n                        currentContext = contextData.context;\r\n                        if (!!contextData.hasCallbacks()) return [3, 2];\r\n                        return [4, this.get(contextData.name)];\r\n                    case 1:\r\n                        currentContext = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        calculatedDelta = this.protocolVersion === 2 ?\r\n                            this.calculateContextDeltaV2(currentContext, delta) :\r\n                            this.calculateContextDeltaV1(currentContext, delta);\r\n                        if (!Object.keys(calculatedDelta.added).length\r\n                            && !Object.keys(calculatedDelta.updated).length\r\n                            && !calculatedDelta.removed.length\r\n                            && !((_a = calculatedDelta.commands) === null || _a === void 0 ? void 0 : _a.length)) {\r\n                            return [2, Promise.resolve()];\r\n                        }\r\n                        return [2, this._gw3Session\r\n                                .send({\r\n                                type: GW_MESSAGE_UPDATE_CONTEXT,\r\n                                domain: \"global\",\r\n                                context_id: contextData.contextId,\r\n                                delta: calculatedDelta,\r\n                            }, {}, { skipPeerId: false })\r\n                                .then(function (gwResponse) {\r\n                                _this.handleUpdated(contextData, calculatedDelta, {\r\n                                    updaterId: gwResponse.peer_id\r\n                                });\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.setPath = function (name, path, value) {\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPath operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        return this.setPaths(name, [{ path: path, value: value }]);\r\n    };\r\n    GW3Bridge.prototype.setPaths = function (name, pathValues) {\r\n        var _this = this;\r\n        if (!this.setPathSupported) {\r\n            return Promise.reject(\"glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later\");\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            var obj = {};\r\n            for (var _i = 0, pathValues_1 = pathValues; _i < pathValues_1.length; _i++) {\r\n                var pathValue = pathValues_1[_i];\r\n                setValueToPath(obj, pathValue.value, pathValue.path);\r\n            }\r\n            return this.createContext(name, obj);\r\n        }\r\n        var commands = [];\r\n        for (var _a = 0, pathValues_2 = pathValues; _a < pathValues_2.length; _a++) {\r\n            var pathValue = pathValues_2[_a];\r\n            if (pathValue.value === null) {\r\n                commands.push({ type: \"remove\", path: pathValue.path });\r\n            }\r\n            else {\r\n                commands.push({ type: \"set\", path: pathValue.path, value: pathValue.value });\r\n            }\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { commands: commands }\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { added: {}, removed: [], updated: {}, commands: commands }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var _a;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return Promise.resolve({});\r\n        }\r\n        if (contextData && !contextData.hasCallbacks()) {\r\n            return new Promise(function (resolve, _) { return __awaiter$1(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator$1(this, function (_a) {\r\n                    this.subscribe(name, function (data, _d, _r, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        var context = (_a = contextData === null || contextData === void 0 ? void 0 : contextData.context) !== null && _a !== void 0 ? _a : {};\r\n        return Promise.resolve(context);\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context && contextData.sentExplicitSubscription) {\r\n                    var clone = deepClone(contextData.context);\r\n                    callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                var clone = deepClone(contextData.context);\r\n                callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            var clone = deepClone(contextData.context);\r\n            callback(clone, clone, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.destroy = function (name) {\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData) {\r\n            return Promise.reject(\"context with \" + name + \" does not exist\");\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_DESTROY_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = applyContextDelta(contextData.context, delta, this._logger);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_ADDED,\r\n            GW_MESSAGE_CONTEXT_CREATED,\r\n            GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_UPDATED,\r\n            GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new GW3ContextData(contextId, contextUpdatedMsg.name, true, undefined);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = applyContextDelta(contextData.context, contextUpdatedMsg.delta, this._logger);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextUpdatedMsg.delta, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        if (delta.commands) {\r\n            delta.added = delta.updated = delta.reset = {};\r\n            delta.removed = [];\r\n            for (var _i = 0, _a = delta.commands; _i < _a.length; _i++) {\r\n                var command = _a[_i];\r\n                if (command.type === \"remove\") {\r\n                    if (command.path.indexOf(\".\") === -1) {\r\n                        delta.removed.push(command.path);\r\n                    }\r\n                    setValueToPath(delta.updated, null, command.path);\r\n                }\r\n                else if (command.type === \"set\") {\r\n                    setValueToPath(delta.updated, command.value, command.path);\r\n                }\r\n            }\r\n        }\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(deepClone(contextData.context), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex, 10), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            GW_MESSAGE_CONTEXT_DESTROYED,\r\n            GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV1 = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    GW3Bridge.prototype.calculateContextDeltaV2 = function (from, to) {\r\n        var _a, _b;\r\n        var delta = { added: {}, updated: {}, removed: [], reset: undefined, commands: [] };\r\n        for (var _i = 0, _c = Object.keys(to); _i < _c.length; _i++) {\r\n            var x = _c[_i];\r\n            if (to[x] !== null) {\r\n                var fromX = from ? from[x] : null;\r\n                if (!deepEqual(fromX, to[x])) {\r\n                    (_a = delta.commands) === null || _a === void 0 ? void 0 : _a.push({ type: \"set\", path: x, value: to[x] });\r\n                }\r\n            }\r\n            else {\r\n                (_b = delta.commands) === null || _b === void 0 ? void 0 : _b.push({ type: \"remove\", path: x });\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\n\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this._bridge = new GW3Bridge(config);\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.update(name, data);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        this.checkData(data);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.setPath = function (name, path, data) {\r\n        this.checkName(name);\r\n        this.checkPath(path);\r\n        var isTopLevelPath = path === \"\";\r\n        if (isTopLevelPath) {\r\n            this.checkData(data);\r\n            return this.set(name, data);\r\n        }\r\n        return this._bridge.setPath(name, path, data);\r\n    };\r\n    ContextsModule.prototype.setPaths = function (name, paths) {\r\n        this.checkName(name);\r\n        if (!Array.isArray(paths)) {\r\n            throw new Error(\"Please provide the paths as an array of PathValues!\");\r\n        }\r\n        for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\r\n            var _a = paths_1[_i], path = _a.path, value = _a.value;\r\n            this.checkPath(path);\r\n            var isTopLevelPath = path === \"\";\r\n            if (isTopLevelPath) {\r\n                this.checkData(value);\r\n            }\r\n        }\r\n        return this._bridge.setPaths(name, paths);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        if (typeof callback !== \"function\") {\r\n            throw new Error(\"Please provide the callback as a function!\");\r\n        }\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.destroy = function (name) {\r\n        this.checkName(name);\r\n        return this._bridge.destroy(name);\r\n    };\r\n    Object.defineProperty(ContextsModule.prototype, \"setPathSupported\", {\r\n        get: function () {\r\n            return this._bridge.setPathSupported;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" || name === \"\") {\r\n            throw new Error(\"Please provide the name as a non-empty string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkPath = function (path) {\r\n        if (typeof path !== \"string\") {\r\n            throw new Error(\"Please provide the path as a dot delimited string!\");\r\n        }\r\n    };\r\n    ContextsModule.prototype.checkData = function (data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Please provide the data as an object!\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\n\nfunction promisify (promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    return promise.then(successCallback, errorCallback);\r\n}\n\nfunction rejectAfter(ms, promise, error) {\r\n    if (ms === void 0) { ms = 0; }\r\n    var timeout;\r\n    promise.finally(function () {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n    });\r\n    return new Promise(function (resolve, reject) {\r\n        timeout = setTimeout(function () { return reject(error); }, ms);\r\n    });\r\n}\n\nvar InvokeStatus;\r\n(function (InvokeStatus) {\r\n    InvokeStatus[InvokeStatus[\"Success\"] = 0] = \"Success\";\r\n    InvokeStatus[InvokeStatus[\"Error\"] = 1] = \"Error\";\r\n})(InvokeStatus || (InvokeStatus = {}));\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback, existingSub) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            var _a;\r\n            options.methodResponseTimeout = (_a = options.methodResponseTimeout) !== null && _a !== void 0 ? _a : options.waitTimeoutMs;\r\n            _this.protocol.client.subscribe(stream, options, targetServers, successProxy, errorProxy, existingSub);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!method) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (!methodDef.name) {\r\n                reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n                return;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\", \\\"best\\\", or an instance.\"));\r\n                return;\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    if (!target || !(options.waitTimeoutMs)) {\r\n                        return;\r\n                    }\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        callProtocolSubscribe(currentServers, def, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        var filterCopy = methodFilter === undefined\r\n            ? undefined\r\n            : __assign$2({}, methodFilter);\r\n        return this.getServers(filterCopy).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.instance;\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        else {\r\n            methodFilter = __assign$2({}, methodFilter);\r\n        }\r\n        return this.getMethods(methodFilter);\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance);\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(callback);\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(callback);\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(callback);\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server, reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server, method: method });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var getInvokePromise;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                getInvokePromise = function () { return __awaiter$1(_this, void 0, void 0, function () {\r\n                    var methodDefinition, serversMethodMap, err_1, method, errorObj, timeout, additionalOptionsCopy, invokePromises, invocationMessages, results, allRejected;\r\n                    var _this = this;\r\n                    var _a;\r\n                    return __generator$1(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (typeof methodFilter === \"string\") {\r\n                                    methodDefinition = { name: methodFilter };\r\n                                }\r\n                                else {\r\n                                    methodDefinition = __assign$2({}, methodFilter);\r\n                                }\r\n                                if (!methodDefinition.name) {\r\n                                    return [2, Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\")];\r\n                                }\r\n                                if (!argumentObj) {\r\n                                    argumentObj = {};\r\n                                }\r\n                                if (!target) {\r\n                                    target = \"best\";\r\n                                }\r\n                                if (typeof target === \"string\" && target !== \"all\" && target !== \"best\" && target !== \"skipMine\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + target + \"\\\" is not a valid target. Valid targets are \\\"all\\\" and \\\"best\\\".\"))];\r\n                                }\r\n                                if (!additionalOptions) {\r\n                                    additionalOptions = {};\r\n                                }\r\n                                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                    additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                                    if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                                        additionalOptions.methodResponseTimeoutMs = this.configuration.methodResponseTimeout;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                    additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                                    if (additionalOptions.waitTimeoutMs === undefined) {\r\n                                        additionalOptions.waitTimeoutMs = this.configuration.waitTimeoutMs;\r\n                                    }\r\n                                }\r\n                                if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                                    return [2, Promise.reject(new Error(\"\\\"\" + additionalOptions.waitTimeoutMs + \"\\\" is not a valid number for \\\"waitTimeoutMs\\\" \"))];\r\n                                }\r\n                                if (typeof argumentObj !== \"object\") {\r\n                                    return [2, Promise.reject(new Error(\"The method arguments must be an object. method: \" + methodDefinition.name))];\r\n                                }\r\n                                serversMethodMap = this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                                if (!(serversMethodMap.length === 0)) return [3, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4, this.tryToAwaitForMethods(methodDefinition, target, additionalOptions)];\r\n                            case 2:\r\n                                serversMethodMap = _b.sent();\r\n                                return [3, 4];\r\n                            case 3:\r\n                                err_1 = _b.sent();\r\n                                method = __assign$2(__assign$2({}, methodDefinition), { getServers: function () { return []; }, supportsStreaming: false, objectTypes: (_a = methodDefinition.objectTypes) !== null && _a !== void 0 ? _a : [] });\r\n                                errorObj = {\r\n                                    method: method,\r\n                                    called_with: argumentObj,\r\n                                    message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                                    executed_by: undefined,\r\n                                    returned: undefined,\r\n                                    status: undefined,\r\n                                };\r\n                                return [2, Promise.reject(errorObj)];\r\n                            case 4:\r\n                                timeout = additionalOptions.methodResponseTimeoutMs;\r\n                                additionalOptionsCopy = additionalOptions;\r\n                                invokePromises = serversMethodMap.map(function (serversMethodPair) {\r\n                                    var invId = shortid$1();\r\n                                    var method = serversMethodPair.methods[0];\r\n                                    var server = serversMethodPair.server;\r\n                                    var invokePromise = _this.protocol.client.invoke(invId, method, argumentObj, server, additionalOptionsCopy);\r\n                                    return Promise.race([\r\n                                        invokePromise,\r\n                                        rejectAfter(timeout, invokePromise, {\r\n                                            invocationId: invId,\r\n                                            message: \"Invocation timeout (\" + timeout + \" ms) reached for method name: \" + (method === null || method === void 0 ? void 0 : method.name) + \", target instance: \" + JSON.stringify(server.instance) + \", options: \" + JSON.stringify(additionalOptionsCopy),\r\n                                            status: InvokeStatus.Error,\r\n                                        })\r\n                                    ]);\r\n                                });\r\n                                return [4, Promise.all(invokePromises)];\r\n                            case 5:\r\n                                invocationMessages = _b.sent();\r\n                                results = this.getInvocationResultObj(invocationMessages, methodDefinition, argumentObj);\r\n                                allRejected = invocationMessages.every(function (result) { return result.status === InvokeStatus.Error; });\r\n                                if (allRejected) {\r\n                                    return [2, Promise.reject(results)];\r\n                                }\r\n                                return [2, results];\r\n                        }\r\n                    });\r\n                }); };\r\n                return [2, promisify(getInvokePromise(), success, error)];\r\n            });\r\n        });\r\n    };\r\n    Client.prototype.getInvocationResultObj = function (invocationResults, method, calledWith) {\r\n        var all_return_values = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Success; })\r\n            .reduce(function (allValues, currentValue) {\r\n            allValues = __spreadArrays(allValues, [\r\n                {\r\n                    executed_by: currentValue.instance,\r\n                    returned: currentValue.result,\r\n                    called_with: calledWith,\r\n                    method: method,\r\n                    message: currentValue.message,\r\n                    status: currentValue.status,\r\n                }\r\n            ]);\r\n            return allValues;\r\n        }, []);\r\n        var all_errors = invocationResults\r\n            .filter(function (invokeMessage) { return invokeMessage.status === InvokeStatus.Error; })\r\n            .reduce(function (allErrors, currError) {\r\n            allErrors = __spreadArrays(allErrors, [\r\n                {\r\n                    executed_by: currError.instance,\r\n                    called_with: calledWith,\r\n                    name: method.name,\r\n                    message: currError.message,\r\n                }\r\n            ]);\r\n            return allErrors;\r\n        }, []);\r\n        var invResult = invocationResults[0];\r\n        var result = {\r\n            method: method,\r\n            called_with: calledWith,\r\n            returned: invResult.result,\r\n            executed_by: invResult.instance,\r\n            all_return_values: all_return_values,\r\n            all_errors: all_errors,\r\n            message: invResult.message,\r\n            status: invResult.status\r\n        };\r\n        return result;\r\n    };\r\n    Client.prototype.tryToAwaitForMethods = function (methodDefinition, target, additionalOptions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (additionalOptions.waitTimeoutMs === 0) {\r\n                reject();\r\n                return;\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var retry = function () {\r\n                delayTillNow += delayStep;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodDefinition, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    clearInterval(interval);\r\n                    resolve(serversMethodMap);\r\n                }\r\n                else if (delayTillNow >= (additionalOptions.waitTimeoutMs || 10000)) {\r\n                    clearInterval(interval);\r\n                    reject();\r\n                    return;\r\n                }\r\n            };\r\n            var interval = setInterval(retry, delayStep);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                return __spreadArrays(serverMethodMap);\r\n            }\r\n            else if (target === \"best\") {\r\n                var localMachine = serverMethodMap\r\n                    .find(function (s) { return s.server.instance.isLocal; });\r\n                if (localMachine) {\r\n                    return [localMachine];\r\n                }\r\n                if (serverMethodMap[0] !== undefined) {\r\n                    return [serverMethodMap[0]];\r\n                }\r\n            }\r\n            else if (target === \"skipMine\") {\r\n                return serverMethodMap.filter(function (_a) {\r\n                    var server = _a.server;\r\n                    return server.instance.peerId !== _this.instance.peerId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            var targetArray = void 0;\r\n            if (!Array.isArray(target)) {\r\n                targetArray = [target];\r\n            }\r\n            else {\r\n                targetArray = target;\r\n            }\r\n            var allServersMatching = targetArray.reduce(function (matches, filter) {\r\n                var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                    return _this.instanceMatch(filter, serverMethodPair.server.instance);\r\n                });\r\n                return matches.concat(myMatches);\r\n            }, []);\r\n            return allServersMatching;\r\n        }\r\n        return [];\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, repoMethod) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return filter[prop] !== undefined\r\n                && typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\"\r\n                && prop !== \"id\"\r\n                && prop !== \"gatewayId\"\r\n                && prop !== \"identifier\"\r\n                && prop[0] !== \"_\";\r\n        });\r\n        return filterProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var repoMethodValue = repoMethod[prop];\r\n            if (prop === \"objectTypes\") {\r\n                var containsAllFromFilter = function (filterObjTypes, repoObjectTypes) {\r\n                    var objTypeToContains = filterObjTypes.reduce(function (object, objType) {\r\n                        object[objType] = false;\r\n                        return object;\r\n                    }, {});\r\n                    repoObjectTypes.forEach(function (repoObjType) {\r\n                        if (objTypeToContains[repoObjType] !== undefined) {\r\n                            objTypeToContains[repoObjType] = true;\r\n                        }\r\n                    });\r\n                    var filterIsFullfilled = function () { return Object.keys(objTypeToContains).reduce(function (isFullfiled, objType) {\r\n                        if (!objTypeToContains[objType]) {\r\n                            isFullfiled = false;\r\n                        }\r\n                        return isFullfiled;\r\n                    }, true); };\r\n                    return filterIsFullfilled();\r\n                };\r\n                if (filterValue.length > repoMethodValue.length\r\n                    || containsAllFromFilter(filterValue, repoMethodValue) === false) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n            else if (String(filterValue).toLowerCase() !== String(repoMethodValue).toLowerCase()) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        var methods = this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method);\r\n        });\r\n        return methods;\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.instance);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.identifier] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server, methods: [] };\r\n            });\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\n\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            if (!this.repoMethod.stream) {\r\n                throw new Error(\"no stream\");\r\n            }\r\n            return this.repoMethod.stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () {\r\n            if (!this.subscription.instance) {\r\n                throw new Error(\"no instance\");\r\n            }\r\n            return this.subscription.instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\n\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\n\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new Request(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new ServerSubscription(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\n\nvar ServerStream = (function () {\r\n    function ServerStream(_protocol, _repoMethod, _server) {\r\n        this._protocol = _protocol;\r\n        this._repoMethod = _repoMethod;\r\n        this._server = _server;\r\n        this.name = this._repoMethod.definition.name;\r\n    }\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this._protocol.server.getBranchList(this._repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new ServerBranch(key, this._protocol, this._repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new ServerBranch(branchKey, _this._protocol, _this._repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.branch = function (key) {\r\n        return this.branches(key);\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this._protocol.server.getSubscriptionList(this._repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new ServerSubscription(_this._protocol, _this._repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this._repoMethod.definition;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this._protocol.server.closeAllSubscriptions(this._repoMethod);\r\n        this._server.unregister(this._repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this._protocol.server.pushData(this._repoMethod, data, branches);\r\n    };\r\n    ServerStream.prototype.updateRepoMethod = function (repoMethod) {\r\n        this._repoMethod = repoMethod;\r\n    };\r\n    return ServerStream;\r\n}());\n\nvar Server = (function () {\r\n    function Server(protocol, serverRepository) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.invocations = 0;\r\n        this.currentlyUnregistering = {};\r\n        this.streaming = new ServerStreaming(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback, existingStream) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!streamDef) {\r\n                reject(\"The stream name must be unique! Please, provide either a unique string for a stream name to \\u201Cglue.interop.createStream()\\u201D or a \\u201CmethodDefinition\\u201D object with a unique \\u201Cname\\u201D property for the stream.\");\r\n                return;\r\n            }\r\n            var streamMethodDefinition;\r\n            if (typeof streamDef === \"string\") {\r\n                streamMethodDefinition = { name: \"\" + streamDef };\r\n            }\r\n            else {\r\n                streamMethodDefinition = __assign$2({}, streamDef);\r\n            }\r\n            if (!streamMethodDefinition.name) {\r\n                return reject(\"The \\u201Cname\\u201D property is required for the \\u201CstreamDefinition\\u201D object and must be unique. Stream definition: \" + JSON.stringify(streamMethodDefinition));\r\n            }\r\n            var nameAlreadyExists = _this.serverRepository.getList()\r\n                .some(function (serverMethod) { return serverMethod.definition.name === streamMethodDefinition.name; });\r\n            if (nameAlreadyExists) {\r\n                return reject(\"A stream with the name \\\"\" + streamMethodDefinition.name + \"\\\" already exists! Please, provide a unique name for the stream.\");\r\n            }\r\n            streamMethodDefinition.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = _this.serverRepository.add({\r\n                definition: streamMethodDefinition,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            });\r\n            _this.protocol.server.createStream(repoMethod)\r\n                .then(function () {\r\n                var streamUserObject;\r\n                if (existingStream) {\r\n                    streamUserObject = existingStream;\r\n                    existingStream.updateRepoMethod(repoMethod);\r\n                }\r\n                else {\r\n                    streamUserObject = new ServerStream(_this.protocol, repoMethod, _this);\r\n                }\r\n                repoMethod.stream = streamUserObject;\r\n                resolve(streamUserObject);\r\n            })\r\n                .catch(function (err) {\r\n                if (repoMethod.repoId) {\r\n                    _this.serverRepository.remove(repoMethod.repoId);\r\n                }\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        var _this = this;\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) { return __awaiter$1(_this, void 0, void 0, function () {\r\n            var result, resultValue, e_1;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 5]);\r\n                        result = callback(context.args, context.instance);\r\n                        if (!(result && typeof result.then === \"function\")) return [3, 2];\r\n                        return [4, result];\r\n                    case 1:\r\n                        resultValue = _a.sent();\r\n                        resultCallback(undefined, resultValue);\r\n                        return [3, 3];\r\n                    case 2:\r\n                        resultCallback(undefined, result);\r\n                        _a.label = 3;\r\n                    case 3: return [3, 5];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        if (!e_1) {\r\n                            e_1 = \"\";\r\n                        }\r\n                        resultCallback(e_1, e_1);\r\n                        return [3, 5];\r\n                    case 5: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (!methodDefinition) {\r\n            return Promise.reject(\"Method definition is required. Please, provide either a unique string for a method name or a \\u201CmethodDefinition\\u201D object with a required \\u201Cname\\u201D property.\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be a callback function. Method: \" + (typeof methodDefinition === \"string\" ? methodDefinition : methodDefinition.name));\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                var resultCalled_1 = false;\r\n                var success = function (result) {\r\n                    if (!resultCalled_1) {\r\n                        resultCallback(undefined, result);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var error = function (e) {\r\n                    if (!resultCalled_1) {\r\n                        if (!e) {\r\n                            e = \"\";\r\n                        }\r\n                        resultCallback(e, e);\r\n                    }\r\n                    resultCalled_1 = true;\r\n                };\r\n                var methodResult = callback(context.args, context.instance, success, error);\r\n                if (methodResult && typeof methodResult.then === \"function\") {\r\n                    methodResult\r\n                        .then(success)\r\n                        .catch(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, undefined);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please, provide either a unique string for a name or an object containing a \\u201Cname\\u201D property.\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method name is required. Cannot find a method if the method name is undefined!\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method with a name \\\"\" + methodDefinition.name + \"\\\" does not exist or is not registered by your application!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"Could not find a \" + (forStream ? \"stream\" : \"method\") + \" matching the specified condition!\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        var _this = this;\r\n        var methodUnregPromises = [];\r\n        methodsToRemove.forEach(function (method) {\r\n            var promise = _this.protocol.server.unregister(method)\r\n                .then(function () {\r\n                if (method.repoId) {\r\n                    _this.serverRepository.remove(method.repoId);\r\n                }\r\n            });\r\n            methodUnregPromises.push(promise);\r\n            _this.addAsCurrentlyUnregistering(method.definition.name, promise);\r\n        });\r\n        return Promise.all(methodUnregPromises);\r\n    };\r\n    Server.prototype.addAsCurrentlyUnregistering = function (methodName, promise) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var timeout;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                timeout = new Promise(function (resolve) { return setTimeout(resolve, 5000); });\r\n                this.currentlyUnregistering[methodName] = Promise.race([promise, timeout]).then(function () {\r\n                    delete _this.currentlyUnregistering[methodName];\r\n                });\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var methodDefinition, unregisterInProgress, nameAlreadyExists, repoMethod;\r\n            var _this = this;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof method === \"string\") {\r\n                            methodDefinition = { name: \"\" + method };\r\n                        }\r\n                        else {\r\n                            methodDefinition = __assign$2({}, method);\r\n                        }\r\n                        if (!methodDefinition.name) {\r\n                            return [2, Promise.reject(\"Please, provide a (unique) string value for the \\u201Cname\\u201D property in the \\u201CmethodDefinition\\u201D object: \" + JSON.stringify(method))];\r\n                        }\r\n                        unregisterInProgress = this.currentlyUnregistering[methodDefinition.name];\r\n                        if (!unregisterInProgress) return [3, 2];\r\n                        return [4, unregisterInProgress];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        nameAlreadyExists = this.serverRepository.getList()\r\n                            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n                        if (nameAlreadyExists) {\r\n                            return [2, Promise.reject(\"A method with the name \\\"\" + methodDefinition.name + \"\\\" already exists! Please, provide a unique name for the method.\")];\r\n                        }\r\n                        if (methodDefinition.supportsStreaming) {\r\n                            return [2, Promise.reject(\"When you create methods with \\u201Cglue.interop.register()\\u201D or \\u201Cglue.interop.registerAsync()\\u201D the property \\u201CsupportsStreaming\\u201D cannot be \\u201Ctrue\\u201D. If you want \\u201C\" + methodDefinition.name + \"\\u201D to be a stream, please use the \\u201Cglue.interop.createStream()\\u201D method.\")];\r\n                        }\r\n                        repoMethod = this.serverRepository.add({\r\n                            definition: methodDefinition,\r\n                            theFunction: theFunction,\r\n                            protocolState: {},\r\n                        });\r\n                        return [2, this.protocol.server.register(repoMethod)\r\n                                .catch(function (err) {\r\n                                if (repoMethod === null || repoMethod === void 0 ? void 0 : repoMethod.repoId) {\r\n                                    _this.serverRepository.remove(repoMethod.repoId);\r\n                                }\r\n                                throw err;\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute || !methodToExecute.theFunction) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err !== undefined && err !== null) {\r\n                if (err.message && typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result) {\r\n                result = {};\r\n            }\r\n            else if (typeof result !== \"object\" || Array.isArray(result)) {\r\n                result = { _value: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\n\nvar InstanceWrapper = (function () {\r\n    function InstanceWrapper(instance, connection) {\r\n        var _this = this;\r\n        this.wrapped = {\r\n            getMethods: getMethods,\r\n            getStreams: getStreams,\r\n        };\r\n        if (instance) {\r\n            this.refreshWrappedObject(instance);\r\n        }\r\n        if (connection) {\r\n            connection.loggedIn(function () {\r\n                _this.refresh(connection);\r\n            });\r\n            this.refresh(connection);\r\n        }\r\n    }\r\n    InstanceWrapper.prototype.unwrap = function () {\r\n        return this.wrapped;\r\n    };\r\n    InstanceWrapper.prototype.refresh = function (connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n        var resolvedIdentity = connection === null || connection === void 0 ? void 0 : connection.resolvedIdentity;\r\n        var instance = Object.assign({}, resolvedIdentity !== null && resolvedIdentity !== void 0 ? resolvedIdentity : {}, { peerId: connection === null || connection === void 0 ? void 0 : connection.peerId });\r\n        this.refreshWrappedObject(instance);\r\n    };\r\n    InstanceWrapper.prototype.refreshWrappedObject = function (resolvedIdentity) {\r\n        var _a, _b, _c;\r\n        this.wrapped.user = resolvedIdentity.user;\r\n        this.wrapped.instance = resolvedIdentity.instance;\r\n        this.wrapped.application = (_a = resolvedIdentity.application) !== null && _a !== void 0 ? _a : shortid$1();\r\n        this.wrapped.applicationName = resolvedIdentity.applicationName;\r\n        this.wrapped.pid = (_c = (_b = resolvedIdentity.pid) !== null && _b !== void 0 ? _b : resolvedIdentity.process) !== null && _c !== void 0 ? _c : Math.floor(Math.random() * 10000000000);\r\n        this.wrapped.machine = resolvedIdentity.machine;\r\n        this.wrapped.environment = resolvedIdentity.environment;\r\n        this.wrapped.region = resolvedIdentity.region;\r\n        this.wrapped.windowId = resolvedIdentity.windowId;\r\n        this.wrapped.isLocal = true;\r\n        this.wrapped.api = resolvedIdentity.api;\r\n        this.wrapped.service = resolvedIdentity.service;\r\n        this.wrapped.peerId = resolvedIdentity.peerId;\r\n    };\r\n    return InstanceWrapper;\r\n}());\r\nfunction getMethods() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this);\r\n}\r\nfunction getStreams() {\r\n    var _a;\r\n    return (_a = InstanceWrapper.API) === null || _a === void 0 ? void 0 : _a.methodsForInstance(this).filter(function (m) { return m.supportsStreaming; });\r\n}\n\nvar ClientRepository = (function () {\r\n    function ClientRepository(logger) {\r\n        this.logger = logger;\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = lib$2();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        this.logger.debug(\"adding server \" + serverId);\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var wrapper = new InstanceWrapper(info);\r\n        var serverEntry = {\r\n            id: serverId,\r\n            methods: {},\r\n            instance: wrapper.unwrap(),\r\n            wrapper: wrapper,\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry.instance);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        if (!server) {\r\n            this.logger.warn(\"not aware of server \" + id + \", my state \" + JSON.stringify(Object.keys(this.servers)));\r\n            return;\r\n        }\r\n        else {\r\n            this.logger.debug(\"removing server \" + id);\r\n        }\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server.instance, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        if (server.methods[method.id]) {\r\n            return;\r\n        }\r\n        var identifier = this.createMethodIdentifier(method);\r\n        var that = this;\r\n        var methodDefinition = {\r\n            identifier: identifier,\r\n            gatewayId: method.id,\r\n            name: method.name,\r\n            displayName: method.display_name,\r\n            description: method.description,\r\n            version: method.version,\r\n            objectTypes: method.object_types || [],\r\n            accepts: method.input_signature,\r\n            returns: method.result_signature,\r\n            supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            getServers: function () {\r\n                return that.getServersByMethod(identifier);\r\n            }\r\n        };\r\n        methodDefinition.object_types = methodDefinition.objectTypes;\r\n        methodDefinition.display_name = methodDefinition.displayName;\r\n        methodDefinition.version = methodDefinition.version;\r\n        server.methods[method.id] = methodDefinition;\r\n        if (!this.methodsCount[identifier]) {\r\n            this.methodsCount[identifier] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodDefinition);\r\n        }\r\n        this.methodsCount[identifier] = this.methodsCount[identifier] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server.instance, methodDefinition);\r\n        return methodDefinition;\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[method.identifier] = this.methodsCount[method.identifier] - 1;\r\n        if (this.methodsCount[method.identifier] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server.instance, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.identifier] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        var serversWithMethodsToReplay = this.getServers().map(function (s) { return s.instance; });\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, serversWithMethodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        var methodsToReplay = this.getMethods();\r\n        return this.returnUnsubWithDelayedReplay(unsubscribeFunc, methodsToReplay, callback);\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        var unsubCalled = false;\r\n        var servers = this.getServers();\r\n        setTimeout(function () {\r\n            servers.forEach(function (server) {\r\n                var methods = server.methods;\r\n                Object.keys(methods).forEach(function (methodId) {\r\n                    if (!unsubCalled) {\r\n                        callback(server.instance, methods[methodId]);\r\n                    }\r\n                });\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        var _this = this;\r\n        Object.keys(this.servers).forEach(function (key) {\r\n            _this.removeServerById(key, \"reset\");\r\n        });\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createMethodIdentifier = function (methodInfo) {\r\n        var accepts = methodInfo.input_signature !== undefined ? methodInfo.input_signature : \"\";\r\n        var returns = methodInfo.result_signature !== undefined ? methodInfo.result_signature : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (identifier) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var methodInfo = server.methods[methodId];\r\n                if (methodInfo.identifier === identifier) {\r\n                    allServers.push(server.instance);\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.returnUnsubWithDelayedReplay = function (unsubscribeFunc, collectionToReplay, callback) {\r\n        var unsubCalled = false;\r\n        setTimeout(function () {\r\n            collectionToReplay.forEach(function (item) {\r\n                if (!unsubCalled) {\r\n                    callback(item);\r\n                }\r\n            });\r\n        }, 0);\r\n        return function () {\r\n            unsubCalled = true;\r\n            unsubscribeFunc();\r\n        };\r\n    };\r\n    return ClientRepository;\r\n}());\n\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.find(function (m) {\r\n            return m.repoId === id;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\n\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming$1 = (function () {\r\n    function ServerStreaming(session, repository, serverRepository) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = lib$2();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) {\r\n            _this.handleAddInterest(msg);\r\n        });\r\n        session.on(\"remove-interest\", function (msg) {\r\n            _this.handleRemoveInterest(msg);\r\n        });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = [];\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            if (!branches || branches.length === 0) {\r\n                return true;\r\n            }\r\n            return branches.indexOf(br.key) >= 0;\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        if (streamingMethod.protocolState.subscriptionsMap) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        }\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var subscriptionsToClose = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return [];\r\n        }\r\n        var subscriptionsMap = streamingMethod.protocolState.subscriptionsMap;\r\n        var allSubscriptions = Object.keys(subscriptionsMap)\r\n            .map(function (key) {\r\n            return subscriptionsMap[key];\r\n        });\r\n        var result = [];\r\n        allSubscriptions.forEach(function (sub) {\r\n            var branch = \"\";\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                branch = sub.branchKey;\r\n            }\r\n            if (result.indexOf(branch) === -1) {\r\n                result.push(branch);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        if (!streamingMethod.protocolState.subscriptionsMap) {\r\n            return;\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = caller.instance;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        if (!streamingMethod.protocolState.branchKeyToStreamIdMap) {\r\n            throw new Error(\"streaming \" + streamingMethod.definition.name + \" method without protocol state\");\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\n\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = lib$2();\r\n        this.streaming = new ServerStreaming$1(session, clientRepository, serverRepository);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod) {\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        return this.register(repoMethod, true);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, isStreaming) {\r\n        var _this = this;\r\n        var methodDef = repoMethod.definition;\r\n        var flags = { streaming: isStreaming || false };\r\n        var registerMsg = {\r\n            type: \"register\",\r\n            methods: [{\r\n                    id: repoMethod.repoId,\r\n                    name: methodDef.name,\r\n                    display_name: methodDef.displayName,\r\n                    description: methodDef.description,\r\n                    version: methodDef.version,\r\n                    flags: flags,\r\n                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                    input_signature: methodDef.accepts,\r\n                    result_signature: methodDef.returns,\r\n                    restrictions: undefined,\r\n                }],\r\n        };\r\n        return this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n            .then(function () {\r\n            _this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId);\r\n        })\r\n            .catch(function (msg) {\r\n            _this.logger.warn(\"failed to register method \" + repoMethod.definition.name + \" with id \" + repoMethod.repoId + \" - \" + JSON.stringify(msg));\r\n            throw msg;\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err || err === \"\") {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator$1(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId).instance;\r\n        var invocationArgs = { args: args, instance: client };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\n\nvar UserSubscription = (function () {\r\n    function UserSubscription(repository, subscriptionData) {\r\n        this.repository = repository;\r\n        this.subscriptionData = subscriptionData;\r\n    }\r\n    Object.defineProperty(UserSubscription.prototype, \"requestArguments\", {\r\n        get: function () {\r\n            return this.subscriptionData.params.arguments || {};\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"servers\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.subscriptionData.trackedServers\r\n                .filter(function (pair) { return pair.subscriptionId; })\r\n                .map(function (pair) { return _this.repository.getServerById(pair.serverId).instance; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"serverInstance\", {\r\n        get: function () {\r\n            return this.servers[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UserSubscription.prototype, \"stream\", {\r\n        get: function () {\r\n            return this.subscriptionData.method;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    UserSubscription.prototype.onData = function (dataCallback) {\r\n        if (typeof dataCallback !== \"function\") {\r\n            throw new TypeError(\"The data callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onData.push(dataCallback);\r\n        if (this.subscriptionData.handlers.onData.length === 1 && this.subscriptionData.queued.data.length > 0) {\r\n            this.subscriptionData.queued.data.forEach(function (dataItem) {\r\n                dataCallback(dataItem);\r\n            });\r\n        }\r\n    };\r\n    UserSubscription.prototype.onClosed = function (closedCallback) {\r\n        if (typeof closedCallback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onClosed.push(closedCallback);\r\n    };\r\n    UserSubscription.prototype.onFailed = function (callback) {\r\n    };\r\n    UserSubscription.prototype.onConnected = function (callback) {\r\n        if (typeof callback !== \"function\") {\r\n            throw new TypeError(\"The callback must be a function.\");\r\n        }\r\n        this.subscriptionData.handlers.onConnected.push(callback);\r\n    };\r\n    UserSubscription.prototype.close = function () {\r\n        this.subscriptionData.close();\r\n    };\r\n    UserSubscription.prototype.setNewSubscription = function (newSub) {\r\n        this.subscriptionData = newSub;\r\n    };\r\n    return UserSubscription;\r\n}());\n\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.params.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.params.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.params.arguments,\r\n                        method: pendingSub.method,\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            if (isFirstResponse) {\r\n                var reconnect = false;\r\n                var sub = pendingSub.subscription;\r\n                if (sub) {\r\n                    sub.setNewSubscription(pendingSub);\r\n                    pendingSub.success(sub);\r\n                    reconnect = true;\r\n                }\r\n                else {\r\n                    sub = new UserSubscription(_this.repository, pendingSub);\r\n                    pendingSub.subscription = sub;\r\n                    pendingSub.success(sub);\r\n                }\r\n                for (var _i = 0, _a = pendingSub.handlers.onConnected; _i < _a.length; _i++) {\r\n                    var handler = _a[_i];\r\n                    try {\r\n                        handler(sub.serverInstance, reconnect);\r\n                    }\r\n                    catch (e) {\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).instance,\r\n                    requestArguments: subscription.params.arguments,\r\n                    message: undefined,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, params, targetServers, success, error, existingSub) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, params, success, error, params.methodResponseTimeout || 10000, existingSub);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod,\r\n                called_with: params.arguments,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            var method = target.methods.find(function (m) { return m.name === streamingMethod.name; });\r\n            if (!method) {\r\n                _this.logger.error(\"can not find method \" + streamingMethod.name + \" for target \" + target.server.id);\r\n                return;\r\n            }\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: method.gatewayId,\r\n                arguments_kv: params.arguments,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.drainSubscriptions = function () {\r\n        var existing = Object.values(this.subscriptionsList);\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        return existing;\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, params, success, error, timeout, existingSub) {\r\n        var _this = this;\r\n        var subsInfo = {\r\n            localKey: subLocalKey,\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            params: params,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onData) || [],\r\n                onClosed: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onClosed) || [],\r\n                onConnected: (existingSub === null || existingSub === void 0 ? void 0 : existingSub.handlers.onConnected) || [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n            close: function () { return _this.closeSubscription(subLocalKey); },\r\n            subscription: existingSub === null || existingSub === void 0 ? void 0 : existingSub.subscription\r\n        };\r\n        if (!existingSub) {\r\n            if (params.onData) {\r\n                subsInfo.handlers.onData.push(params.onData);\r\n            }\r\n            if (params.onClosed) {\r\n                subsInfo.handlers.onClosed.push(params.onClosed);\r\n            }\r\n            if (params.onConnected) {\r\n                subsInfo.handlers.onConnected.push(params.onConnected);\r\n            }\r\n        }\r\n        this.subscriptionsList[subLocalKey] = subsInfo;\r\n        subsInfo.timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: params.arguments,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return subsInfo;\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer;\r\n        if (closingServerId !== undefined && typeof closingServerId === \"string\") {\r\n            closingServer = this.repository.getServerById(closingServerId).instance;\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.params.arguments || {},\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            subscription.queued.closers.push(server.serverId);\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\n\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(session, repository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new ClientStreaming(session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, options, targetServers, success, error, existingSub) {\r\n        this.streaming.subscribe(stream, options, targetServers, success, error, existingSub);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.gatewayId;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        return this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.drainSubscriptions = function () {\r\n        return this.streaming.drainSubscriptions();\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var isLocal = msg.meta ? msg.meta.local : true;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            applicationName: remoteId.applicationName,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n            api: remoteId.api,\r\n            isLocal: isLocal\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.gatewayId) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        return {\r\n            invocationId: invocationId,\r\n            result: result,\r\n            instance: server.instance,\r\n            status: InvokeStatus.Success,\r\n            message: \"\"\r\n        };\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        if (\"_tag\" in msg) {\r\n            var invocationId = msg._tag.invocationId;\r\n            var serverId = msg._tag.serverId;\r\n            var server = this.repository.getServerById(serverId);\r\n            var message = msg.reason;\r\n            var context_1 = msg.context;\r\n            return {\r\n                invocationId: invocationId,\r\n                result: context_1,\r\n                instance: server.instance,\r\n                status: InvokeStatus.Error,\r\n                message: message\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                invocationId: \"\",\r\n                message: msg.message,\r\n                status: InvokeStatus.Error,\r\n                error: msg\r\n            };\r\n        }\r\n    };\r\n    return ClientProtocol;\r\n}());\n\nfunction gW3ProtocolFactory (instance, connection, clientRepository, serverRepository, libConfig, interop) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", [\"subscribed\"]);\r\n    var server = new ServerProtocol(session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new ClientProtocol(session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        var existingSubscriptions = client.drainSubscriptions();\r\n        for (var _i = 0, existingSubscriptions_1 = existingSubscriptions; _i < existingSubscriptions_1.length; _i++) {\r\n            var sub = existingSubscriptions_1[_i];\r\n            var methodInfo = sub.method;\r\n            var params = Object.assign({}, sub.params);\r\n            logger.info(\"trying to re-subscribe to method \" + methodInfo.name);\r\n            interop.client.subscribe(methodInfo, params, undefined, undefined, sub);\r\n        }\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        for (var _a = 0, registeredMethods_1 = registeredMethods; _a < registeredMethods_1.length; _a++) {\r\n            var method = registeredMethods_1[_a];\r\n            var def = method.definition;\r\n            logger.info(\"re-publishing method \" + def.name);\r\n            if (method.stream) {\r\n                interop.server.createStream(def, method.streamCallbacks, undefined, undefined, method.stream);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallback) {\r\n                interop.register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction && method.theFunction.userCallbackAsync) {\r\n                interop.registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        }\r\n    }\r\n    function handleInitialJoin() {\r\n        if (resolveReadyPromise) {\r\n            resolveReadyPromise({\r\n                client: client,\r\n                server: server,\r\n            });\r\n            resolveReadyPromise = undefined;\r\n        }\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.onLeft(function () {\r\n        clientRepository.reset();\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\n\nvar Interop = (function () {\r\n    function Interop(configuration) {\r\n        var _this = this;\r\n        if (typeof configuration === \"undefined\") {\r\n            throw new Error(\"configuration is required\");\r\n        }\r\n        if (typeof configuration.connection === \"undefined\") {\r\n            throw new Error(\"configuration.connections is required\");\r\n        }\r\n        var connection = configuration.connection;\r\n        if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n            configuration.methodResponseTimeout = 30 * 1000;\r\n        }\r\n        if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n            configuration.waitTimeoutMs = 30 * 1000;\r\n        }\r\n        InstanceWrapper.API = this;\r\n        this.instance = new InstanceWrapper(undefined, connection).unwrap();\r\n        this.clientRepository = new ClientRepository(configuration.logger.subLogger(\"cRep\"));\r\n        this.serverRepository = new ServerRepository();\r\n        var protocolPromise;\r\n        if (connection.protocolVersion === 3) {\r\n            protocolPromise = gW3ProtocolFactory(this.instance, connection, this.clientRepository, this.serverRepository, configuration, this);\r\n        }\r\n        else {\r\n            throw new Error(\"protocol \" + connection.protocolVersion + \" not supported\");\r\n        }\r\n        this.readyPromise = protocolPromise.then(function (protocol) {\r\n            _this.protocol = protocol;\r\n            _this.client = new Client(_this.protocol, _this.clientRepository, _this.instance, configuration);\r\n            _this.server = new Server(_this.protocol, _this.serverRepository);\r\n            return _this;\r\n        });\r\n    }\r\n    Interop.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    Interop.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    Interop.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    Interop.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    Interop.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    Interop.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    Interop.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    Interop.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    Interop.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    Interop.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    Interop.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    Interop.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    Interop.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    Interop.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    return Interop;\r\n}());\n\nvar successMessages = [\"subscribed\", \"success\"];\r\nvar MessageBus = (function () {\r\n    function MessageBus(connection, logger) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n            var args = _this.removeEmptyValues({\r\n                type: \"publish\",\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, routingKey = _a.routingKey, target = _a.target;\r\n                var args = _this.removeEmptyValues({\r\n                    type: \"subscribe\",\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: \"unsubscribe\", subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on(\"event\", function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args[\"publisher-identity\"];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (_this.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n        this.session = connection.domain(\"bus\", successMessages);\r\n        this.readyPromise = this.session.join();\r\n        this.readyPromise.then(function () {\r\n            _this.watchOnEvent();\r\n        });\r\n    }\r\n    MessageBus.prototype.ready = function () {\r\n        return this.readyPromise;\r\n    };\r\n    MessageBus.prototype.removeEmptyValues = function (obj) {\r\n        var cleaned = {};\r\n        Object.keys(obj).forEach(function (key) {\r\n            if (obj[key] !== undefined && obj[key] !== null) {\r\n                cleaned[key] = obj[key];\r\n            }\r\n        });\r\n        return cleaned;\r\n    };\r\n    MessageBus.prototype.keysMatch = function (obj1, obj2) {\r\n        var keysObj1 = Object.keys(obj1);\r\n        var allMatch = true;\r\n        keysObj1.forEach(function (key) {\r\n            if (obj1[key] !== obj2[key]) {\r\n                allMatch = false;\r\n            }\r\n        });\r\n        return allMatch;\r\n    };\r\n    return MessageBus;\r\n}());\n\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = Utils.getGDMajorVersion();\r\n    var glue42gd;\r\n    var preloadPromise = Promise.resolve();\r\n    if (gdVersion) {\r\n        if (gdVersion < 3) {\r\n            throw new Error(\"GD v2 is not supported. Use v4 of the API to run in that context.\");\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n            preloadPromise = window.gdPreloadPromise || preloadPromise;\r\n        }\r\n    }\r\n    var glueInitTimer = timer(\"glue\");\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = prepareConfig(userConfig, ext, glue42gd);\r\n    var _connection;\r\n    var _interop;\r\n    var _logger;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var _allowTrace;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        _allowTrace = _logger.canPublish(\"trace\");\r\n        if (_allowTrace) {\r\n            _logger.trace(\"registering \" + name + \" module\");\r\n        }\r\n        var done = function () {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n            inner.marks = t.marks;\r\n            if (_allowTrace) {\r\n                _logger.trace(name + \" is ready - \" + (t.endTime - t.startTime));\r\n            }\r\n        };\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                done();\r\n            });\r\n        }\r\n        else {\r\n            done();\r\n        }\r\n        if (!Array.isArray(name)) {\r\n            name = [name];\r\n        }\r\n        name.forEach(function (n) {\r\n            libs[n] = inner;\r\n            GlueCore[n] = inner;\r\n        });\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer(\"connection\");\r\n        _connection = new Connection(internalConfig.connection, _logger.subLogger(\"connection\"));\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            if (glue42gd) {\r\n                authPromise = glue42gd.getGWToken()\r\n                    .then(function (token) {\r\n                    return {\r\n                        gatewayToken: token\r\n                    };\r\n                });\r\n            }\r\n            else {\r\n                authPromise = Promise.reject(\"You need to provide auth information\");\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            initTimer.mark(\"auth-promise-resolved\");\r\n            var authRequest;\r\n            if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function () {\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var _a;\r\n        var initTimer = timer(\"logger\");\r\n        _logger = new Logger(\"\" + ((_a = internalConfig.connection.identity) === null || _a === void 0 ? void 0 : _a.application), undefined, internalConfig.customLogger);\r\n        _logger.consoleLevel(internalConfig.logger.console);\r\n        _logger.publishLevel(internalConfig.logger.publish);\r\n        if (_logger.canPublish(\"debug\")) {\r\n            _logger.debug(\"initializing glue...\");\r\n        }\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        var _a, _b, _c, _d;\r\n        var initTimer = timer(\"metrics\");\r\n        var config = internalConfig.metrics;\r\n        var metricsPublishingEnabledFunc = glue42gd === null || glue42gd === void 0 ? void 0 : glue42gd.getMetricsPublishingEnabled;\r\n        var identity = internalConfig.connection.identity;\r\n        var canUpdateMetric = metricsPublishingEnabledFunc ? metricsPublishingEnabledFunc : function () { return true; };\r\n        var disableAutoAppSystem = (_a = (typeof config !== \"boolean\" && config.disableAutoAppSystem)) !== null && _a !== void 0 ? _a : false;\r\n        _metrics = metrics({\r\n            connection: config ? _connection : undefined,\r\n            logger: _logger.subLogger(\"metrics\"),\r\n            canUpdateMetric: canUpdateMetric,\r\n            system: \"Glue42\",\r\n            service: (_b = identity === null || identity === void 0 ? void 0 : identity.service) !== null && _b !== void 0 ? _b : \"metrics-service\",\r\n            instance: (_d = (_c = identity === null || identity === void 0 ? void 0 : identity.instance) !== null && _c !== void 0 ? _c : identity === null || identity === void 0 ? void 0 : identity.windowId) !== null && _d !== void 0 ? _d : shortid$1(),\r\n            disableAutoAppSystem: disableAutoAppSystem,\r\n            pagePerformanceMetrics: typeof config !== \"boolean\" ? config === null || config === void 0 ? void 0 : config.pagePerformanceMetrics : undefined\r\n        });\r\n        registerLib(\"metrics\", _metrics, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupInterop() {\r\n        var initTimer = timer(\"interop\");\r\n        var agmConfig = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"interop\"),\r\n        };\r\n        _interop = new Interop(agmConfig);\r\n        Logger.Interop = _interop;\r\n        registerLib([\"interop\", \"agm\"], _interop, initTimer);\r\n        return Promise.resolve();\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && _connection.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer(\"contexts\");\r\n            _contexts = new ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\")\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = _connection.replayer;\r\n            if (replayer) {\r\n                replayer.drain(ContextMessageReplaySpec.name);\r\n            }\r\n        }\r\n    }\r\n    function setupBus() {\r\n        return __awaiter$1(this, void 0, void 0, function () {\r\n            var initTimer;\r\n            return __generator$1(this, function (_a) {\r\n                if (!internalConfig.bus) {\r\n                    return [2, Promise.resolve()];\r\n                }\r\n                initTimer = timer(\"bus\");\r\n                _bus = new MessageBus(_connection, _logger.subLogger(\"bus\"));\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                return [2, Promise.resolve()];\r\n            });\r\n        });\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer(name);\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function (feedbackInfo) {\r\n            if (!_interop) {\r\n                return;\r\n            }\r\n            _interop.invoke(\"T42.ACS.Feedback\", feedbackInfo, \"best\");\r\n        };\r\n        var info = {\r\n            coreVersion: version$2,\r\n            version: internalConfig.version\r\n        };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            logger: _logger,\r\n            interop: _interop,\r\n            agm: _interop,\r\n            connection: _connection,\r\n            metrics: _metrics,\r\n            contexts: _contexts,\r\n            bus: _bus,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _logger === null || _logger === void 0 ? void 0 : _logger.info(\"done called by user...\");\r\n                return _connection.logout();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get glueVer() {\r\n                return internalConfig.version;\r\n            },\r\n            get glueConfig() {\r\n                return JSON.stringify(userConfig);\r\n            },\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var all = getAllTimers();\r\n                return Object.keys(all).map(function (key) {\r\n                    var t = all[key];\r\n                    return {\r\n                        name: key,\r\n                        duration: t.endTime - t.startTime,\r\n                        marks: t.marks\r\n                    };\r\n                });\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n        });\r\n        glue.config = {};\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext && ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext === null || ext === void 0 ? void 0 : ext.extOptions[k];\r\n            });\r\n        }\r\n        if (ext === null || ext === void 0 ? void 0 : ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        if (glue.agm) {\r\n            var deprecatedDecorator = function (fn, wrong, proper) {\r\n                return function () {\r\n                    glue.logger.warn(\"glue.js - 'glue.agm.\" + wrong + \"' method is deprecated, use 'glue.interop.\" + proper + \"' instead.\");\r\n                    fn.apply(glue.agm, arguments);\r\n                };\r\n            };\r\n            var agmAny = glue.agm;\r\n            agmAny.method_added = deprecatedDecorator(glue.agm.methodAdded, \"method_added\", \"methodAdded\");\r\n            agmAny.method_removed = deprecatedDecorator(glue.agm.methodRemoved, \"method_removed\", \"methodRemoved\");\r\n            agmAny.server_added = deprecatedDecorator(glue.agm.serverAdded, \"server_added\", \"serverAdded\");\r\n            agmAny.server_method_aded = deprecatedDecorator(glue.agm.serverMethodAdded, \"server_method_aded\", \"serverMethodAdded\");\r\n            agmAny.server_method_removed = deprecatedDecorator(glue.agm.serverMethodRemoved, \"server_method_removed\", \"serverMethodRemoved\");\r\n        }\r\n        return glue;\r\n    }\r\n    return preloadPromise\r\n        .then(setupLogger)\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupInterop(), setupContexts(), setupBus()]); })\r\n        .then(function () { return _interop.readyPromise; })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = GlueCore;\r\n}\r\nGlueCore.version = version$2;\r\nGlueCore.default = GlueCore;\n\nvar glueWebFactory = createFactoryFunction(GlueCore);\r\nif (typeof window !== \"undefined\") {\r\n    var windowAny = window;\r\n    windowAny.GlueWeb = glueWebFactory;\r\n    delete windowAny.GlueCore;\r\n}\r\nglueWebFactory.default = glueWebFactory;\r\nglueWebFactory.version = version;\n\nexport default glueWebFactory;\n//# sourceMappingURL=web.es.js.map\n","import createDesktopAgent from \"./agent\";\nimport Glue, { Glue42 } from \"@glue42/desktop\";\nimport GlueWebFactory from \"@glue42/web\";\nimport { getChannelsList, isEmptyObject, isGlue42Core } from \"./utils\";\nimport { version } from \"../package.json\";\nimport { FDC3 } from \"../types\";\nimport { WindowType } from \"./windowtype\";\n\nconst defaultGlueConfig = {\n    application: (window as WindowType).fdc3AppName,\n    appManager: true,\n    context: true,\n    intents: true,\n    channels: true,\n    agm: true\n};\n\nconst patchSharedContexts = (): Promise<void> => {\n    return new Promise((resolve) => {\n        let interval: any;\n\n        const callback = async (): Promise<void> => {\n            const channels = await getChannelsList();\n\n            if (channels.length === 0 || !isEmptyObject(channels[0])) {\n                clearInterval(interval);\n                resolve();\n            }\n        };\n\n        interval = setInterval(callback, 300);\n\n        callback();\n    });\n};\n\nconst setupGlue = (clientGlueConfig?: Glue42.Config): void => {\n    if (isGlue42Core) {\n        (window as WindowType).gluePromise = GlueWebFactory(defaultGlueConfig)\n            .then((glue) => {\n                (window as WindowType).glue = glue;\n\n                return patchSharedContexts();\n            })\n            .then(() => {\n                return (window as WindowType).glue;\n            });\n    } else {\n        const waitGlue42GD = new Promise((resolve) => {\n            let interval: any;\n\n            const callback = (): void => {\n                if ((window as WindowType).glue42gd) {\n                    clearInterval(interval);\n                    resolve();\n                }\n            };\n\n            interval = setInterval(callback, 300);\n\n            callback();\n        });\n\n        (window as WindowType).gluePromise = waitGlue42GD\n            .then(() => {\n                const GlueFactory = (window as WindowType).Glue || Glue;\n\n                return GlueFactory(clientGlueConfig || defaultGlueConfig);\n            })\n            .then((glue) => {\n                (window as WindowType).glue = glue;\n\n                return patchSharedContexts();\n            })\n            .then(() => {\n                return (window as WindowType).glue;\n            });\n    }\n};\n\nconst fdc3Factory = (): FDC3.DesktopAgent & { version: string } => {\n    setupGlue();\n\n    const agentApi = createDesktopAgent();\n\n    return {\n        ...agentApi,\n        version\n    };\n};\n\nexport default fdc3Factory;\n","import fdc3Factory from \"./main\";\n\nconst fdc3 = fdc3Factory();\n(window as any).fdc3 = fdc3;\n(fdc3 as any).default = fdc3;\n\nexport default fdc3;\n"],"names":["newSubscribe","id","callback","didReplay","window","glue","contexts","subscribe","data","delta","removed","unsubscribe","extraData","updaterId","interop","instance","getChannelsList","channelNames","channels","all","Promise","map","name","get","isEmptyObject","obj","Object","keys","length","constructor","isGlue42Core","navigator","userAgent","toLowerCase","includes","Listener","actualUnsub","[object Object]","then","unsubFunc","console","error","SystemChannel","glChannel","this","displayMetadata","meta","context","publish","contextType","channel","type","contextTypeInput","handlerInput","arguments","handler","unsubPromise","subscribeFor","unsub","join","leave","AppChannel","update","createChannelsAgent","currentChannel","pendingSubscription","systemChannels","doesAppChannelExist","some","ctxName","isSystem","n","mapToFDC3AppChannel","channelName","handleSwitchChannelUI","channelId","setCurrentChannel","createPendingListener","setActualUnsub","initDone","gluePromise","channelContext","current","changed","getSystemChannels","getOrCreateAppChannel","set","createNewAppChannel","tryLeaveSystem","addContextListener","warn","listener","windows","my","getContext","startupContext","subHandler","onNewData","newChannel","getOrCreateChannel","find","systemChannel","joinChannel","Error","appChannel","tryGetAppChannel","getCurrentChannel","leaveCurrentChannel","broadcast","convertGlue42IntentToFDC3AppIntent","glueIntent","handlers","appIntents","filter","dynamicInstanceIntents","appIntent","applicationName","handlersToUse","intent","displayName","apps","appName","app","appManager","application","title","applicationTitle","instanceTitle","tooltip","userProperties","description","applicationDescription","icons","applicationIcon","images","createIntentsAgent","open","props","start","findIntent","glueIntents","intents","findIntentsByContext","raiseIntent","target","glueTarget","appInstances","instances","glueIntentResult","raise","source","version","result","addIntentListener","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","prototype","create","__assign","assign","t","s","i","call","apply","__awaiter","thisArg","_arguments","P","generator","resolve","reject","fulfilled","value","step","next","e","rejected","done","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","extendStatics$1","__extends$1","__assign$1","__awaiter$1","__generator$1","__spreadArrays","il","r","k","a","j","jl","MetricTypes","getMetricTypeByValue","metric","getTypeByValue","Date","serializeMetric","serializedMetrics","values","reduce","memo","key","innerType","composite","defineNestedComposite","normalizeMetricName","path","getMetricValueByType","now","publishNestedComposite","getTime","Boolean","toString","composeMsgForRootStateMetric","system","merged","flatten","arr","flat","toFlatten","concat","isArray","root","getAggregateState","highestState","sort","state","msg","forEach","m","idx","slice","aggregateDescription","Helpers","definition","parent","transport","BaseMetric","createMetric","defineProperty","_a","repo","enumerable","configurable","newValue","updateMetric","NumberMetric","_super","incrementBy","num","increment","decrement","decrementBy","ObjectMetric","mergeValues","_this","StringMetric","TimestampMetric","Repository","options","protocol","init","separator","_transport","_name","_description","_repo","_parent","_path","_buildPath","shadowedSystem","_state","_subSystems","_metrics","_getOrCreateMetric","metricObject","expectedType","metricDef","matching","shadowedMetric","existing","catch","me","subSystems","metrics","subSystem","nameSystem","descriptionSystem","match","_system","getState","setState","stateDescription","updateSystem","stringMetric","timestampMetric","objectMetric","numberMetric","aggState","shadowedSubSystem","createSystem","addSystemMetrics","clickStream","undefined","rootSystem","useClickStream","document","clickStream_1","documentClickHandler","timestamp","className","tagName","href","page","location","addEventListener","attachEvent","urlMetric","appNameMetric","startUrl","glue42gd","NullProtocol","PerfTracker","api","initialPublishTimeout","publishInterval","lastCount","scheduleCollection","setTimeout","collect","setInterval","collectMemory","collectEntries","memory","performance","JSON","stringify","totalJSHeapSize","usedJSHeapSize","allEntries","getEntries","connection","config","joinPromise","session","replayRepo","replaySystem","ss","createMetricsMsg","Description","Value","send","metricClone","cloneMetric","updateMetricCore","canUpdate","publishMetricsMsg","canUpdateMetric","_b","resolveReadyPromise","domain","onJoined","reconnect","defineRootMetricsMsg","service","shadowedUpdateMetric","stateObj","rootMetric","peer_id","peerId","gw3","disableAutoAppSystem","featureMetric","reportingSystem","def","featureMetricFunc","action","payload","addFAVSupport","perfConfig","pagePerformanceMetrics","enabled","initPerf","createRegistry","errorHandling","_userErrorHandler","callbacks","_handleError","exceptionArtifact","errParam","stack","add","replayArgumentsArr","callbacksForKey","replayArgument","err","allForKey","acc","element","index","execute","argumentsArr","_i","results","clear","clearKey","default","lib","InProcTransport","settings","logger","registry","gw","facade","connect","_client","message","messageHandler","client","sendObject","_msg","onMessage","onConnectedChanged","close","SharedWorkerTransport","workerFile","worker","SharedWorker","port","onmessage","postMessage","Utils","getGDMajorVersion","glueDesktop","ver","Number","substr","isNaN","isNode","_isNode","global","process","PromiseWrapper","resolved","promise","delay","time","timers","timer","timerName","marks","endTime","period","startTime","mark","currentTime","diff","timerObj","stop","requireFunc","require","WebSocketConstructor","WebSocket","WS","startupTimer","_running","_registry","wsRequests","ws","waitForSocketConnection","info","pw","failed","readyState","openSocket","retryInterval","retriesLeft","reconnectInterval","notifyForSocketState","debug","initiateSocket","retries","onerror","reason","seen_1","WeakSet","has","notifyStatusChanged","onclose","onopen","identity","wsRequest","status","seed","alphabet","previousSeed","shuffled","randomFromSeed","nextValue","_seed_","ORIGINAL","reset","setCharacters","_alphabet_","unique","split","item","ind","lastIndexOf","getShuffled","characterIndex","sourceArray","targetArray","Math","floor","splice","shuffle","alphabet_1","characters","lookup","crypto","msCrypto","randomByteBrowser","getRandomValues","random","dest","Uint8Array","encode_1","number","loopCounter","str","pow","decode_1","indexOf","isValid","len","lib$1","fn","module","exports","createCommonjsModule","counter","previousSeconds","clusterWorkerId","generate","seconds","seedValue","workerId","newCharacters","decode","shortid","domainSession","successMessages","errorMessages","_latestOptions","isJoined","tryReconnecting","_connectionOn","disconnected","loggedIn","on","handleSuccessMessage","handleErrorMessage","sm","requestsMap","destination","wasReconnect","handleJoined","requestId","request_id","entry","success","getNextRequestId","tag","skipPeerId","successMsg","_tag","errorMsg","onLeft","sendFireAndForget","connected","GW3ProtocolImpl","protocolVersion","datePrefix","datePrefixLen","dateMinLen","datePrefixFirstChar","_isLoggedIn","shouldTryLogin","initialLogin","initialLoginAttempts","sessions","handleDisconnected","ping","processStringMessage","parse","substring","milliseconds","parseInt","ex","msgType","createStringMessage","oldToJson","toJSON","datePrefix_1","processObjectMessage","createObjectMessage","login","authentication","e_1","helloMsg","sendOptions","welcomeMsg","token","err_1","_c","loginConfig","username","password","gatewayToken","getNewGWToken","method","flowName","provider","flowCallback","sessionId","secret","globalDomain","subLogger","maxRetries","reconnectAttempts","Buffer","from","resolvedIdentity","resolved_identity","availableDomains","available_domains","access_token","setLoggedIn","logout","promises","pingTimer","clearTimeout","domainName","domainLogger","authToken","res","getGWToken","MessageReplayerImpl","specs","specsNames","messages","subs","subsRefCount","specs_1","spec","name_1","_loop_1","refCount","this_1","sub","processMessage","types","isDone","name_2","drain","off","Connection","messageHandlers","ids","_connected","isTrace","inproc","sharedWorker","canPublish","handleConnectionChanged","bind","handleTransportMessage","replaySpecs","replayer","isObjectBasedTransport","trace","strMessage","isLoggedIn","authRequest","distributeMessage","handlerId","loggerError","log","msgObj","order","Logger","logFn","subLoggers","customLogFn","loggerFullName","includeTimeAndLevel","existingSub","publishLevel","level","_publishLevel","consoleLevel","_consoleLevel","publishMessage","compareWith","loggerName","Interop","methods","InteropMethodName","invoke","prefix","date","getHours","getMinutes","getSeconds","getMilliseconds","toPrint","GW_MESSAGE_CREATE_CONTEXT","GW_MESSAGE_ACTIVITY_CREATED","GW_MESSAGE_ACTIVITY_DESTROYED","GW_MESSAGE_CONTEXT_CREATED","GW_MESSAGE_CONTEXT_ADDED","GW_MESSAGE_SUBSCRIBE_CONTEXT","GW_MESSAGE_SUBSCRIBED_CONTEXT","GW_MESSAGE_UNSUBSCRIBE_CONTEXT","GW_MESSAGE_DESTROY_CONTEXT","GW_MESSAGE_CONTEXT_DESTROYED","GW_MESSAGE_UPDATE_CONTEXT","GW_MESSAGE_CONTEXT_UPDATED","GW_MESSAGE_JOINED_ACTIVITY","ContextMessageReplaySpec","prepareConfig","configuration","ext","_d","nodeStartingContext","startingContextString","env","_GD_STARTING_CONTEXT_","_e","instanceId","windowId","pid","environment","region","gwConfig","gateway","gwURL","uid","applicationConfig","getApplication","uniqueAppName","appInstanceId","getConnection","bus","auth","gwToken","getAuth","gdConsoleLevel","defaultLevel","consoleLogLevel","getLogger","libs","customLogger","GW3ContextData","contextId","isAnnounced","activityId","updateCallbacks","hasCallbacks","applyContextDelta","deepClone","commands","command","deletePath","setValueToPath","added_1","added","updated_1","updated","mergeObjectsProperties","hash","WeakMap","Set","RegExp","flags","what","withWhat","right","left","deepEqual","x","pathArr","InvokeStatus","GW3Bridge","_contextNameToData","_gw3Subscriptions","_nextCallbackSubscriptionNumber","_contextNameToId","_contextIdToName","_protocolVersion","_connection","_logger","_gw3Session","subscribeToContextCreatedMessages","subscribeToContextUpdatedMessages","subscribeToContextDestroyedMessages","handleContextCreatedMessage","handleContextUpdatedMessage","handleContextDestroyedMessage","contextsDomainInfo","uri","dispose","contextName","createContext","lifetime","createContextMsg","context_id","contextData","currentContext","calculatedDelta","calculateContextDeltaV2","calculateContextDeltaV1","gwResponse","handleUpdated","setPath","setPathSupported","setPaths","pathValues","pathValues_1","pathValue","pathValues_2","_r","un","thisCallbackSubscriptionNumber","hadCallbacks","joinedActivity","sentExplicitSubscription","sendSubscribe","subscriptionKey","sendUnsubscribe","destroy","oldContext","invokeUpdateCallbacks","createdMessageTypes_1","createdMessageType","contextCreatedMsg","activity_id","updatedMessageTypes_1","updatedMessageType","contextUpdatedMsg","justSeen","context_snapshot","updater_id","updateCallbackIndex","updateCallback","destroyedMessageTypes_1","destroyedMessageType","destroyedMsg","to","ContextsModule","_bridge","checkName","checkData","checkPath","paths","paths_1","ready","promisify","successCallback","errorCallback","rejectAfter","ms","timeout","finally","Client","callProtocolSubscribe","targetServers","stream","successProxy","errorProxy","methodResponseTimeout","waitTimeoutMs","methodDef","method_response_timeout","wait_for_method_timeout","delayTillNow","currentServers","getServerMethodsByFilterAndTarget","retry_1","streamInfo","servers","methodFilter","filterCopy","getServers","serverMethodMap","server","getMethods","methodsForInstance","getMethodsForInstance","methodAdded","onMethodAdded","methodRemoved","onMethodRemoved","serverAdded","onServerAdded","serverRemoved","onServerRemoved","serverMethodAdded","onServerMethodAdded","serverMethodRemoved","onServerMethodRemoved","argumentObj","additionalOptions","methodDefinition","serversMethodMap","errorObj","additionalOptionsCopy","invokePromises","invocationMessages","methodResponseTimeoutMs","tryToAwaitForMethods","supportsStreaming","objectTypes","called_with","executed_by","returned","serversMethodPair","invId","invokePromise","race","invocationId","getInvocationResultObj","every","getInvokePromise","invocationResults","calledWith","all_return_values","invokeMessage","Success","allValues","currentValue","all_errors","allErrors","currError","invResult","interval","clearInterval","filterByTarget","matches","myMatches","serverMethodPair","instanceMatch","localMachine","isLocal","instanceFilter","instanceDefinition","containsProps","methodMatch","repoMethod","prop","isMatch","filterValue","repoMethodValue","filterObjTypes","repoObjectTypes","objTypeToContains","object","objType","repoObjType","isFullfiled","containsAllFromFilter","String","matchingServers","resultMethodsObject","methodKey","identifier","prev","matchingMethods","getServerMethodsById","ServerSubscription","subscription","branchKey","closeSingleSubscription","pushDataToSingle","Request","requestContext","accept","acceptRequestOnBranch","acceptOnBranch","branch","rejectRequest","ServerStreaming","onSubRequest","rc","rm","handleSubRequest","onSubAdded","handleSubAdded","onSubRemoved","handleSubRemoved","streamCallbacks","subscriptionRequestHandler","request","subscriptionAddedHandler","subscriptionRemovedHandler","ServerBranch","subscriptions","getSubscriptionList","closeAllSubscriptions","pushData","ServerStream","_protocol","_repoMethod","_server","branches","bList","getBranchList","def2","accepts","returns","unregister","updateRepoMethod","Server","serverRepository","invocations","currentlyUnregistering","streaming","onInvoked","onMethodInvoked","createStream","streamDef","existingStream","streamMethodDefinition","getList","serverMethod","protocolState","streamUserObject","repoId","remove","register","wrappedCallbackFunction","resultCallback","resultValue","args","userCallback","registerCore","registerAsync","wrappedCallback","resultCalled_1","methodResult","userCallbackAsync","forStream","methodToBeRemoved","unregisterWithPredicate","removeMethodsOrStreams","filterPredicate","methodsOrStreamsToRemove","methodsToRemove","methodUnregPromises","addAsCurrentlyUnregistering","methodName","theFunction","unregisterInProgress","methodToExecute","invocationArgs","unStrException","_value","methodInvocationResult","InstanceWrapper","wrapped","getStreams","refreshWrappedObject","refresh","unwrap","user","machine","API","ClientRepository","methodsCount","addServer","serverId","wrapper","serverEntry","removeServerById","methodId","removeServerMethod","addServerMethod","createMethodIdentifier","that","gatewayId","display_name","object_types","input_signature","result_signature","getServersByMethod","allMethods","allServers","unsubscribeFunc","serversWithMethodsToReplay","returnUnsubWithDelayedReplay","methodsToReplay","unsubCalled","getServerById","methodInfo","collectionToReplay","ServerRepository","nextId","getById","SUBSCRIPTION_REQUEST","SUBSCRIPTION_ADDED","SUBSCRIPTION_REMOVED","ServerStreaming$1","repository","ERR_URI_SUBSCRIPTION_FAILED","nextStreamId","handleAddInterest","handleRemoveInterest","streamingMethod","subscriptionsMap","branchKeyToStreamIdMap","streamId","getStreamId","subscription_id","subscribeMsg","stream_id","sendSubscriptionFailed","br","dropSubscriptionMessage","closeMultipleSubscriptions","subscriptionsToClose","drop","allSubscriptions","onSubscriptionLifetimeEvent","method_id","eventName","handlerFunc","getNextStreamId","caller_id","arguments_kv","subscriptionId","errorMessage","reason_uri","needleBranch","ServerProtocol","clientRepository","handleInvokeMessage","isStreaming","registerMsg","restrictions","invocation_id","callerId","UserSubscription","subscriptionData","params","trackedServers","pair","onData","dataCallback","queued","dataItem","onClosed","closedCallback","onFailed","onConnected","setNewSubscription","newSub","STATUS_AWAITING_ACCEPT","STATUS_SUBSCRIBED","ERR_MSG_SUB_FAILED","ON_CLOSE_MSG_CLIENT_INIT","ClientStreaming","subscriptionsList","subscriptionIdToLocalKeyMap","nextSubLocalKey","handleErrorSubscribing","errorResponse","subLocalKey","pendingSub","timeoutId","callArgs","callOnClosedHandlers","handleSubscribed","acceptingServer","isFirstResponse","serverInstance","handleEventData","trackedServersFound","isPrivateData","oob","sendingServerId","receivedStreamData","requestArguments","private","onDataHandlers","queuedData","handleSubscriptionCancelled","expectedNewLength","closers","getNextSubscriptionLocalKey","registerSubscription","server_id","drainSubscriptions","subsInfo","localKey","closeSubscription","closingServer","closersCount","closingServerId","ClientProtocol","handlePeerAdded","handlePeerRemoved","handleMethodsAddedMessage","handleMethodsRemovedMessage","handleResultMessage","handleInvocationError","newPeerId","new_peer_id","remoteId","local","serverInfo","removedPeerId","removed_id","methodIdList","gW3ProtocolFactory","libConfig","readyPromise","existingSubscriptions_1","registeredMethods","registeredMethods_1","handleReconnect","protocolPromise","MessageBus","topic","routingKey","removeEmptyValues","routing_key","target_identity","response","watchOnEvent","keysMatch","cleaned","obj1","obj2","keysObj1","allMatch","GlueCore","userConfig","gdVersion","preloadPromise","gdPreloadPromise","_interop","_contexts","_bus","_allowTrace","glueInitTimer","internalConfig","registerLib","inner","initTime","initEndTime","initStartTime","setupInterop","initTimer","agmConfig","setupContexts","hasActivities","activities","setupBus","setupExternalLibs","externalLibs","createCallback","setupExternalLib","authPromise","authConfig","metricsPublishingEnabledFunc","getMetricsPublishingEnabled","libsReadyPromises","coreVersion","feedback","feedbackInfo","agm","glueVer","glueConfig","browser","timing","initTimes","duration","extOptions","enrichGlue","updatePerfData","deprecatedDecorator","wrong","proper","agmAny","method_added","method_removed","server_added","server_method_aded","server_method_removed","ActivityEntity","_id","_update","other","_updateCore","_beforeDelete","isString","arg","isUndefined","isUndefinedOrNull","isFunction","ifNotUndefined","doWithIt","ActivityType","ownerWindow","helperWindows","_ownerWindow","_helperWindows","initiate","_manager","WindowType","appByWindowTypeGetter","_appByWindowTypeGetter","getWindows","activity","isIndependent","createWindow","EntityEvent","entitiy","entity","EntityEventContext","eventType","ActivityStatusChangeEventContext","newStatus","oldStatus","EntityEventType","StatusChange","ActivityContextChangedEventContext","ActivityContextChange","Added","Removed","Updated","Closed","ActivityWindowEvent","ActivityWindowJoinedActivity","ActivityWindowLeftActivity","ActivityState","Created","Started","Destroyed","ActivityAGM","_activity","_ensureHasAgm","AGM","w","methodNames","methodsForWindow","currentWindowMethod","activityServers","promisify$1","potentialTargets","firstElem","_isInstance","_isActivityWindow","win","parameters","AttachedActivityDescriptor","manager","ownerActivityId","_ownerActivityId","ownerId","windowIds","frameColor","detach","descriptor","detachActivities","nextTick","cb","nodeify","resp","Activity","actType","_actType","_status","_context","_ownerId","_agm","getActivityType","addWindow","addWindowToActivity","windowType","createStackedWindows","windowTypes","leaveWindowFromActivity","getWindowsByType","setContext","setActivityContext","updateContext","updateActivityContext","onStatusChange","subscribeActivityEvents","ns","os","onWindowEvent","subscribeWindowEvents","onContextChanged","subscribeActivityContextChanged","act","stopActivity","clone","attach","attachActivities","onActivityAttached","subscribeActivitiesAttached","newActId","oldActId","onDetached","subscribeActivitiesDetached","newAct","originalActivity","_updateDescriptors","allStates","_attached","setFrameColor","color","callbacksToWait","underlyingWindow","getFrameColor","LogLevel","Trace","Debug","Info","Warn","Logger$1","GlueLogger","_glueLogger","GetNamed","Get","owner","GetTypeName","Level","_getMessage","exec","ActivityWindow","windowGetter","hcWindowId","_type","_activityId","_instance","_isIndependent","_windowGetter","_hcWindowId","getBounds","getWindowBounds","getWindowType","getActivityById","setVisible","isVisible","setWindowVisibility","activate","focus","activateWindow","setBounds","bounds","setWindowBounds","closeWindow","onActivityJoined","_subscribeForActivityWindowEvent","onActivityRemoved","event","ActivityStatus","getMessage","gwMmessageError","gwMessageAddActivityTypes","gwMessageActivityCreated","gwMessageActivityDestroyed","gwMessageActivityInitiated","gwMessageJoinedActivity","gwMessageActivityJoined","gwMessageActivityLeft","gwMessageOwnerChanged","gwMessageAddPeerFactories","gwMessagePeerFactoriesAdded","gwMessagePeerFactoriesRemoved","gwMessagePeerCreated","GW3Bridge$1","_activityChangeCallbacks","_activityTypeStatusChangeCallbacks","_activityWindowChangeCallbacks","_windowTypeStatusChangeCallbacks","_peerIdAndFactoryIdToPeerType","_peerFactoriesRegisteredByUs","_contextSubscriptions","_activityTypesInitiatedFromMe","_config","_windows","_sessionJoinedPromise","_sessionJoinedPromiseResolve","_activityJoinedPromise","_activityJoinedPromiseResolve","glue42gd_1","addRefreshHandler","setGWToken","activityTypeGwMessageEntityToActivityType","nameToWindowType","windowName","owner_type","helper_types","peerFactoryGwMessageEntityToWindowType","peer_type","activityGwMessageToActivity","owner_id","activity_type","activityToActivityStatusChangeEvent","forwardActivityTypeMessagesToStatusEventHandlers","handleActivityCreatedMessage","handleActivityDestroyedMessage","forwardActivityMessagesToStatusEventHandlers","forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers","forwardPeerFactoryMessagesToStatusEventHandlers","forwardPeerFactoryMessagesToPeerFactoryRequests","handlePeerFactoriesAdded","handlePeerFactoriesRemoved","forwardActivityWindowMessagesToEventHandlers","disposeRequestHandling","exit","mode","activity_types","typesToTrack","initReady","onActivityTypeStatusChange","registerActivityType","activityTypeName","toActivityPeerConfig","windowDefinition","activityType","invokeCallbacks","unregisterActivityType","onWindowTypeStatusChange","registerWindowFactory","factory","factories","unregisterWindowFactory","factory_ids","onActivityStatusChange","initiateActivity","initiateMsg","initial_context","isOverrideTypeDefinition","types_override","helpers","wd","sendCreateAndMapResultingMessagesToPromise","initMsg","fullReplace","removedKeys","removedKeys_1","announceWindow","activityWindowId","registerWindow","independent","shouldSendReady","activityInfo","getAgmInstance","generateWindowGetter","onActivityWindowChange","layout","width","height","top","cellSize","peer_name","created_id","joinActivity","destroy_peer_id","getAnnouncementInfo","announcementInfo","activityWindowType","activityWindowIndependent","activityWindowName","search","URLSearchParams","searchParams","maybeName","target_id","leaveActivity","getActivityTypes","getWindowTypes","getActivities","getActivityWindows","windowDefinitions","visible","cloneActivity","cloneOptions","into","merge","newActivityInfo","onActivitiesAttached","onActivitiesDetached","onActivityAttachedDescriptorsRefreshed","getAttachedDescriptors","getRandomRequestId","forwardAddedAndRemovedMessagesToEventHandler","addedMessageType","removedMessageType","mapper","getGetEntityEvent","isAdded","forwardMessageToEventHandler","messageType","getEntityEvent","ent","h","initiatedMessageType","initiatedMessageFilter","createdMessageFilter","cancelledMessageType","cancelledMessageFilter","createdMessageToPromiseResolution","resolveCreatedPromise","rejectCreatedPromise","initiatedSubscription","createdSubscription","cancelledSubscription","errorSubscription","reqId","createdPromise","initiatedMessageAck","dropSubscriptions","dropSubscription","msg4","msg1","msg2","msg3","toReturn","peerFactoryIdAndOwnerIdToWindowType","factoryId","peerType","subscribeToContext","unsubscribeContext","activityCreatedMessage","participants","createdMessage","peer_factory","gateway_token","joinedMessage","joinedId","joined_id","joinedType","joined_type","joinedName","joined_name","left_id","list","ActivityMy","_myAttached","_myDetached","_myAttachedTo","_myDetachedFrom","_myActivityFrameColorChanged","_myActivityJoinedCallbacks","_myActivityRemovedCallbacks","_myContextUpdateCallbacks","_m","am","_subscribeMyContextChanged","_subscribeMyWindowEvent","_subscribeActivitiesAttached","_subscribeActivitiesDetached","onWindowFrameColorChanged","_subscribeWindowFrameColorChanged","_w","announcedWindows","myWin","onActivityLeft","onActivityDetached","onAttachedToActivity","onDetachedFromActivity","attached","onFrameColorChanged","myActivity","_notifyMyContextChanged","_notifyMyWindowEvent","callbackStore","_notifyAttached","_notifyDetached","_notifyAttachedTo","_notifyDetachedFrom","detached","oldAct","ReadyMarker","signalsToWait","_signals","_callbacks","setCallback","isSet","isError","_error","signal","getError","EntityObservableCollection","processNew","_items","_listeners","_processNew","addOne","items","htmlContainer","internalEntity","_updateInternalCollections","_notifyListeners","getByName","getOrWait","entityAddedHandler","entityAsAny","isActivityDestroy","isWindowClose","oldEntity","ActivityManager","bridge","autoAnnounce","_announcedWindows","_attachedCallbacks","_detachedCallbacks","_frameColorChangesCallbacks","_windowHandlers","_activityTypes","_grabEntity","_windowTypes","_activities","_dataReadyMarker","_descriptorsMarker","_readyMarker","dataErr","errCatch","refreshDescriptors","_handleActivitiesAttached","_handleActivitiesDetached","_handleActivityDescriptorsRefreshed","_handleWindowFrameColorChanged","_subscribeForData","aw","_getInitialData","bridgeType","ownerWindowType","helperWindowTypes","ownerDefinition","helperDefinitions","relativeTo","relativeDirection","windowStyleAttributes","actId","subscribeActivityTypeEvents","at","factoryMethod","getName","array","predicate","currentWindow","windowEventHandler_1","unsubscribeWindowEvents","subscribeWindowTypeEvents","wt","window_1","wrappingHandler","found","windowTypeOrConfiguration","relativeToWindow","invalidKeys_1","filteredWindowTypeOrConfiguration_1","wid","relativeWindowTypes","stackedWindow","tasks","removedKey","descriptors","stateWrapped","u","subscribeActivityFrameColorChanged","ac","descriptorAsObjectFromAPI","oldActivityId","newActivityId","ActivityManagementAPI","_my","activityTypes","_getActivityTypesWrapper","_getWindowTypesWrapper","registerFactory","unregisterFactory","announce","onAttached","onActivityFrameColorChanged","ActivityAPI","_mgr","aware","inActivity","getAvailableFrameColors","ActivityModule","logLevel","_isUsingHCImplementation","gdMajorVersion","_isUsingGW3Implementation","checkIsUsingGW3Implementation","activityManager","disableAutoAnnounce","_api","_readyPromise","GetFunctionalEntitlementMethodName","CanIMethodName","OnEventMethodName","createRegistry$1","lib$2","objectValues","objectClone","ApplicationImpl","_appManager","onInstanceStarted","onInstanceStopped","onAppRemoved","onAppChanged","onAppAvailable","onAppUnavailable","_props","Title","Version","AutoStart","IsShell","Caption","IsHidden","ApplicationName","ActivityWindowType","Arguments","AllowMultiple","IsReady","Icon","IconUrl","SortOrder","UserProperties","autoStart","caption","hidden","container","allowMultiple","Type","Mode","isActivity","styleAttributes","WindowStyleAttributes","searchFor","modeIndex","startModeIndex","stopModeIndex","style","updateFromProps","Name","Context","Options","acsResult","Instance_0","Id","handleInstanceStarted","check","filtered","isActivityInstance","onInstanceAgmServerReady","waitForApplicationInstance","onAvailable","onUnavailable","onChanged","onRemoved","InstanceImpl","_appName","startFailed","onAgmReady","_addToRegistry","onStopped","_unsubscribeInstanceStopped","_unsubscribeInstanceAgmServerReady","activityInstance","ownerWindowId","activityOwnerInstance","_startUpContext","_title","_isActivityInstance","_inActivity","_agmInstance","ActivityId","updateAgmInstanceFromProps","AgmServers","GD3","agmInstances","gdAgmServers","propsAgmServer","propsAgm","machineName","userName","handleInstanceStopped","AppManagerImpl","_gdMajorVersion","_apps","_instances","applications","getMyInstance","instanceId_1","handleAppAdded","_getAppId","_updateAppFromProps","handleAppUpdated","handleAppRemoved","handleAppReady","_getAppOrThrow","available","_getInstanceId","_getInstanceAppName","_updateInstanceFromProps","_getInstanceOrThrow","_matchInstance","handleInstanceAgmServerReady","handleInstanceStartFailed","handleInstanceUpdated","_replay","onInstanceStartFailed","onInstanceUpdated","onAppAdded","_getInstanceByIdAndName","itemsToReplay","promisify$2","EntitlementsImpl","handleBranchModified","handleBranchesModified","getRegion","_agmInvoke","Region","getBranches","Branches","getCurrentBranch","Branch","setRegion","ResultMessage","setCurrentBranch","currentUser","getFunctionalEntitlement","funct","Entitlement","Function","getFunctionalEntitlementBranch","canI","func","Result","canIBranch","onBranchesChanged","onBranchChanged","restart","transformFunction","AppManagerFactory","START_ONLY","SKIP_ICONS","entitlements","skipIcon","snapshot","skipIcons","resolveFunc","rejectFunc","resultPromise","streamData","events","createDataSubscription","myInstance","windowStore","WindowStore","waitForTimeoutInMilliseconds","_pendingWindows","_pendingWindowsStates","getIfReady","remote","urlChanged","setReadyState","targetWindowState","markReadyToShow","setUrlChangedState","waitFor","onReadyWindow","onAdded","Utils$1","callbackifyPromise","fail","getMonitor","displays","workingAreaWidth","workingAreaHeight","monitor","totalOverlap","calculateTotalOverlap","getDisplayCenterOfScreen","display","max","r1","r2","r1x","r1y","r1xMax","r1yMax","r2x","r2y","r2xMax","r2yMax","min","windowFactory","executor","appManagerGetter","_group","resultWindow","_mode","_url","url","_bounds","_frameColor","_focus","_neighbours","neighbours","_groupId","groupId","_isGroupHeaderVisible","isGroupHeaderVisible","_isTabHeaderVisible","isTabHeaderVisible","_isTabSelected","isTabSelected","_settings","_isVisible","isCollapsed","_windowState","_tabGroupId","tabGroupId","_isLocked","isLocked","_frameButtons","_zoomFactor","zoomFactor","moveResize","dimensions","resolveTimeout","unsubscribeBoundsChanged","resolveImmediately","areBoundsEqual","onBoundsChanged","toBeVisible","isVisibilityCorrect","onVisibilityChanged","waitForLockingChanged","onLockingChanged","onUrlChanged","onCollapsed","onExpanded","onMaximized","onMinimized","onNormal","onTabHeaderVisibilityChanged","getNeighboursByDirection","direction","winId","getApplicationName","_APPLICATION_NAME","_t42","getWindowInfo","requested","minHeight","maxHeight","minWidth","maxWidth","areHeightsEqual","areWidthsEqual","areLeftsEqual","areTopsEqual","handleWindowClose","handleWindowChangeState","handleTitleChanged","newTitle","handleVisibilityChanged","handleUrlChanged","newUrl","handleWindowSettingsChanged","handleContextUpdated","handleFrameIsLockedChanged","handleBoundsChanged","handleFocusChanged","isFocused","handleFrameButtonAdded","frameButton","buttonObj","btn","buttonId","handleFrameButtonRemoved","frameButtonId","button","handleFrameButtonClicked","handleFrameColorChanged","handleFrameAttached","handleFrameSelectionChanged","newWindow","prevWindow","selectedWindow","previousWindow","un_1","onTabSelectionChanged","newWin","prevWin","handleCompositionChanged","handleGroupHeaderVisibilityChanged","handleTabHeaderVisibilityChanged","handleGroupChanged","newGroup","oldGroup","handleGroupAssociation","group","handleAttached","newTabGroupId","tabHeaderVisible","handleDetached","handleWindowAttached","handleWindowDetached","handleZoomFactorChanged","hostInstance","agmInstance","frameButtons","opened","topNeighbours","leftNeighbours","rightNeighbours","bottomNeighbours","screen","monitors","maximize","restore","minimize","maximizeRestore","currEvent","collapse","expand","toggleCollapse","setTitle","setStyle","errMessage","setOnTop","onTop","resetButtons","buttons","setSizeConstraints","constraints","navigate","addFrameButton","buttonInfo","imageBase64","removeFrameButton","show","hide","center","snap","targetWindowGroup","targetGroup","targetWindow","onWindowAdded","showLoader","loader","hideLoader","lock","unlock","getIcon","icon","setIcon","base64Image","setTabTooltip","attachTab","tab","sourceWindowId","targetWindowId","argsForSend","sourceWin","detachTab","opt","_options","hideTabHeader","visibilityChangeHeard","detachedHeard","unVisibility","unDetached","setTabHeaderVisible","toBeTabHeaderVisible","showPopup","createFlydown","setModalState","isModal","setZoomFactor","zoomIn","zoomOut","showDevTools","capture","captureOptions","flash","suppliedOptions","flashOptions","shouldFlash","onClose","onTitleChanged","onFrameButtonAdded","onFrameButtonRemoved","onFrameButtonClicked","onContextUpdated","onFocusChanged","onGroupChanged","onWindowAttached","onWindowDetached","onClosing","onRefreshing","prevent","onZoomFactorChanged","tabs","allWindows","getURL","getTitle","resizeTo","moveTo","getParentWindow","myParentId","parentInstanceId","getChildWindows","Events","Registry","GDExecutor","agmTarget","stylePromises","wait","toolTip","allowClose","allowCollapse","allowLockUnlock","allowMaximize","allowMinimize","tabTooltip","tabToolTip","buttonsConfig","snappingEdge","replace","dataURL","toShow","optionsCopy","reformatedOptions","targetLocation","popupBounds","size","targetId","popupId","fullOptions","horizontalOffset","verticalOffset","reformatFlydownOptions","zoneIds","zones","z","flydownSize","cancel","clearFlydownArea","handleFlydownBoundsRequested","cancelCallback","callbackData","responses","defaultResponse","zoneId","flydownId","flydownWindowBounds","flydownWindowId","captureGroup","groupWindowIds","configure","setGroupHeaderVisible","getGroupTitle","setGroupTitle","addCloseHandler","assignGeneralIfUnassigned","zone","valueFromOptions","flydownBounds","flydownActiveArea","activeArea","areaIds","getWindowsByTabGroupId","GDEnvironment","wndId","_waitTimeout","normalizeInstance","_windowId","_appManagerGetter","caller","respondToEvent","streamResolve","streamReject","updateWindow","copyOptions","windowState","tabAttached","tabDetached","onEvent","onCompositionChanged","onGroupHeaderVisibilityChanged","onWindowGotFocus","onWindowLostFocus","windowInfo","readyResolve","extendedStreamEvent","getExtendedStreamEvent","windowInfoCreatedEvent","windowObjectAndEvents","theWindow","theWindowEvents","windowInfoBoundsChangedEvent","windowInfoUrlChangedEvent","windowInfoTitleChanged","windowInfoCompositionChanged","neighbors","groupHeaderVisible","windowInfoFocusChanged","focusChanged","frameId","winsToBeNotified_1","oldTabGroupId","winsToBeNotified_2","newWindowId","prevWindowId","windowObjAndEvents","mapToWindowConstructorOptions","isActiveTab","streamEvent","charAt","toUpperCase","groupFactory","_windowsId","waitForHeaderVisibilityChanged","onHeaderVisibilityChanged","groupObject","_mapToWindowObjects","winObjects","windowObject","_mapToWindowObject","mappedWindows","mappedWindow","isHeaderVisible","showHeader","hideHeader","onWindowRemoved","groupAPI","groupInternal","removeWindow","window_2","groupsFactory","_groups","heardForWindowsCounter","findGroupByWindow","groupFound","addNewWindow","windowGroupId","createdGroup","createOrGetGroup","deleteGroup","newGroupId","oldGroupId","groupEvents","groupsAPI","groupsEvents","onWindowMoved","WindowsFactory","groups","isReady","gdPromise","rej","envDetector","myWindow","windowAdded","windowRemoved","errorHandler","windowsForListing","findById","onTabAttached","onTabDetached","unsubscribed","store","LayoutStore","layouts","removeWhere","condition","where","first","seed$1","alphabet$1","previousSeed$1","shuffled$1","randomFromSeed$1","ORIGINAL$1","reset$1","setCharacters$1","getShuffled$1","shuffle$1","alphabet_1$1","crypto$1","randomByteBrowser$1","encode_1$1","decode_1$1","build_1","isValid$1","lib$3","createCommonjsModule$1","shortid$1","ContextProvider","activitiesGetter","registerRequestMethods","onSaveRequested","isActivityOwner","context_1","activityIsOwner","usersCbs","requestResult","autoSaveWindowContext","windowContext","activityContext","transformACSLayout","something","accumulator","convertedValue","LayoutImpl","components","metadata","LayoutsAPIImpl","activityGetter","setDefaultGlobal","clearDefaultGlobal","getDefaultGlobal","isSlimMode","l","gotSnapshot","save","verifyNotSlimMode","ignoreHidden","layoutObject","actIds","appIds","ignoreLayoutRestrictions","isVisibleWindow","ignoreMyInstance","autoCollectApps","invokeMethodAndTrack","activityIdToJoin","restoreActivityOwner","ignoreActivityWindowTypes","closeRunningInstance","reuseWindows","t42","restoreOptions","activityToJoin","closeOldWindows","reuseExistingWindows","toClose","splash","getInstancesToClose","import","export","getObjectValues","Layouts","rename","newName","oldName","updateMetadata","hibernate","resume","getCurrentLayout","onRestored","onRenamed","updateAppContextInCurrent","updateDefaultContext","skipStreamEvent","agmResult","streamEventReceived","handleResult","shellApp","isShell","shellApplicationName","ACSStream","resolveReady","rejectReady","resolveGotSnapshot","rejectGotSnapshot","noRetry","transform","checkForLayoutEventMethod","IsSnapshot","addLayouts","OnLayoutAdded","removeLayouts","OnLayoutRemoved","changeLayouts","OnLayoutChanged","renameLayouts","OnLayoutRenamed","restoredLayout","OnLayoutRestored","Token","layoutsData","layoutData","removedLayouts","removedLayout","existingLayout","compareLayouts","changedLayouts","changedLayout","renamedLayouts","renamedLayout","layout1","layout2","restoredLayouts","LayoutsFactory","acsStream","DisplayCommand","DisplayManager","callGD","GetAll","decorateDisplay","getPrimary","isPrimary","Capture","captureAll","CaptureAll","getMousePosition","GetMousePosition","original","switchChannel","swId","CONTEXT_PREFIX","SharedContextSubscriber","isChannel","createContextName","___","startsWith","channelContextName","getContextData","updateChannel","updateData","ChannelsImpl","shared","subsKey","changedKey","joinCore","joinNoSelectorSwitch","leaveCore","leaveNoSelectorSwitch","changeSelector","doesChannelExist","intervalId","sharedContexts","interopLib","setupAGM","CommandMethod","HotkeysImpl","firstHotkey","hotkeys","Map","hkToLower","hotkey","formatHotkey","registerInvokeAGMMethod","delete","unregisterAll","isRegistered","version$2","prepareConfig$1","getLibConfig","defaultMode","trueMode","getModeAsString","Glue42Notification","actions","badge","dir","image","lang","renotify","requireInteraction","silent","removeEventListener","dispatchEvent","Notifications","methodsRegistered","methodNameRoot","notifications","bunchOfPromises","notification","validActions","validActions_1","g42notification","maxActions","handleNotificationAction","severity","glueRoutingDetailMethodName","g42notificationId","g42action","g42interopMethod","g42interopTarget","stringValue","glueAction","payload_1","event_1","Event","onaction","actionInterop","event_2","onclick","clickInterop","ThemesImpl","core","isSubscribed","getConfiguration","getMethodName","getAll","getCurrent","selected","select","theme","setMethodName","sharedContextName","getThemesMethodName","setThemesMethodName","GLUE42_FDC3_INTENTS_METHOD_PREFIX","Intents","intentFilter","ctToLower_1","contextTypes","ct","intentName","intentDef","isDynamicIntent","anAppHandler","anInstanceHandler","intentDefHandler","intentHandler","startApp","raiseIntentToInstance","apps_1","intents_1","appsWithIntents","appsWithIntents_1","withIntentsInfo","_f","_g","_h","_j","_k","_l","appWithIntents","appDefIntent","methodDescription","registeredIntent","interopServer","registeredMethod","addedMethod","factory$3","createWindows","windowsLogger","getLibLogger","debugLog","createActivities","activityLogger","createAppManager","createLayouts","layoutsConfig","lay","createChannels","channelsAPI","createHotkeys","hotkeysAPI","createIntents","intentsAPI","createNotifications","notificationsAPI","createDisplaysApi","displaysLogger","_displays","createThemes","themesAPI","themes","factory$2","newLogger","loggerConfig","currentLog","glueApi","glueFactoryLog","libraries","whatToExpose","shouldSetToWindow","autoInjected","Glue","whatToExpose$1","bytes","format_browser","mask","LN2","generate_1","test","basedir","base","commonjsRequire","RemoteWebWindow","control","callControl","skipResult","Control","CONTROL_METHOD","setLocalWindow","setLocalInstance","onStart","LocalWebWindow","screenLeft","screenTop","outerWidth","outerHeight","getBoundsSync","getContextSync","ChildWebWindow","createMethodName","initStartupContext","startedByScript","Windows","childWindows","trackWindowsLifetime","remoteWindow","remoteFromServer","relativeWindowId_1","relativeWindow","relativeWindowBounds","relativeDir","newBounds","optionsString","availWidth","startingContext","registerChildStartupContext","getRelativeBounds","cw","closed","rect","ok","asPromise","withDefault","defaultValue","withException","map2","ar","mapError","andThen","freeze","isOk","isErr","successes","isJsonArray","json","isJsonObject","expectedGot","expected","got","typeString","printPath","prependAt","newAt","rest","getOwnPropertySymbols","propertyIsEnumerable","__rest","Decoder","run","kind","input","runPromise","runWithException","succeed","string","boolean","constant","isEqual","decoders","decoder","err$$1","decodeValue_1","tuple","nth","union","ad","bd","oneOf","intersection","ds","anyJson","unknownJson","dict","optional","errors","errorsList","valueAt","jsonAtPath","fixedValue","lazy","mkDecoder","nonEmptyStringDecoder","windowLayoutItemDecoder","groupLayoutItemDecoder","children","columnLayoutItemDecoder","rowLayoutItemDecoder","workspaceComponentDecoder","windowComponentDecoder","componentType","parentId","main","layoutTypeDecoder","newLayoutOptionsDecoder","restoreOptionsDecoder","layoutDecoder","controller","layoutType","onLayoutAdded","onLayoutChanged","onLayoutRemoved","setContextDataToEmptyObjIfMissing","contextWithDataObj","newData","Channels","fetchTimeout","timeoutMilliseconds","timeoutHit","fetch","promisePlus","timeoutMessage","Application","startWithoutTimeout","manifest","details","parsedManifest","openOptions","appWindow","resolveCallback","startedAppsWindowIdsToInstances","checkResolveCondition","appInstanceStartedPromise","startedInstance","RemoteInstance","WINDOW_DID_NOT_HAVE_TIME_TO_RESPOND","error_1","LocalInstance","unsubscribe_1","nonEmptyStringDecoder$1","fdc3AppImageDecoder","fdc3IconDecoder","fdc3IntentDecoder","customConfig","glue42CoreCreateOptionsDecoder","fdc3ApplicationConfigDecoder","appId","manifestType","contactEmail","supportEmail","publisher","glue42CoreApplicationConfigDecoder","customProperties","AppManager","DEFAULT_POLLING_INTERVAL","OKAY_MESSAGE","LOCAL_SOURCE","myId","_myInstance","remoteSources","subscribeForRemoteApplications","localApplications","validatedApplications","getValidatedApplications","addApplications","trackInstanceLifetime","initialFetchAppsPromises","remoteSources_1","remoteSource","appsFetch","pollingInterval","getAppProps","glue42CoreAppProps","fromEntries","entries","handleAppsChanged","newlyAddedApplications","_loop_2","newlyAddedApplication","currentApplicationWithTheSameNameAndSource","this_2","currentApplicationWithTheSameNameButDifferentSource","currentApplication","appProps","newlyAddedApplicationInstance","newlyAddedApplications_1","handleAppsAdded","currentAppNames","newApplications_1","newApplication","newApplicationInstance","handleAppsRemoved","currentApplicationsFromThisSource","newlyAddedApplicationNames","removedApplications_1","currentApplicationFromThisSource","removedApplication","tryPopulateMyInstanceApplication","myApp","serverApp","remoteInstance","nonEmptyStringDecoder$2","glue42CoreCreateOptionsDecoder$1","glue42CoreIntentContextDecoder","glue42CoreIntentFilterDecoder","glue42CoreIntentDefinitionDecoder","glue42CoreIntentRequestDecoder","appDef","interopOptions_1","Notification","permission","requestPermission","raiseUsingWebApi","defaultAssetsBaseLocation","defaultWorkerName","defaultConfigName","defaultConfig","autoRestore","assets","getRemoteConfig","remoteConfigLocation","extendConfig","extends","SaveContextMethodName","LayoutEventMethodName","LayoutsController","storage","autoSaveContext","handleControlMessage","registerEventsMethod","globalLayouts","workspaceLayouts","layoutEvent","emitLayoutEvent","layoutOptions","autoSave","openedWindows","getRemoteWindowsInfo","getLocalLayoutComponent","storeAutoLayout","restoreComponents","restoreAutoSavedLayout","layoutName","mainComponent","getAutoLayout","c","layoutToRemove","newWindowOptions","windows_1","layoutCommand","parentInfo","LayoutStorage","localStore","autoStore","remoteStore","foundRemote","foundLocal","nonConflictLocal","localLayout","remoteLayout","allowSave","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","receiver","IDBTransaction","objectStoreNames","objectStore","wrap","wrapFunction","IDBDatabase","transaction","IDBCursor","advance","continue","continuePrimaryKey","storeNames","tx","transformCachableValue","unlisten","complete","DOMException","cacheDonePromiseForTransaction","constructors","instanceOfAny","IDBObjectStore","IDBIndex","Proxy","IDBRequest","promisifyRequest","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","async","storeName","shift","returnVal","oldTraps","LocalStore","_database","blocked","upgrade","blocking","terminated","indexedDB","openPromise","oldVersion","newVersion","db","openDB","setUpDb","database","put","contains","createObjectStore","JSONStore","storeBaseUrl","fetchUrl","decodeResult","AutoStorage","getObjectFromLocalStorage","getKey","setObjectToLocalStorage","localStorage","getItem","KEY","setItem","hookCloseEvents","layoutsController","allChildren","firstChild","closeEveryone","__assign$2","lib$1$1","coreFactoryFunction","glueWebFactory","builtCoreConfig","isWebEnvironment","shouldInitializeChannels","shouldInitializeAppManager","gdWindowContext","channelsLib","appManagerLib","intentsLib","coreConfig","_o","_p","_q","remoteConfig","resultWebConfig","lastIndex","remoteType","coreLib","baseLocation","layoutsStorage","windowAny","GlueWeb","defaultGlueConfig","fdc3AppName","patchSharedContexts","fdc3","clientGlueConfig","GlueWebFactory","waitGlue42GD","setupGlue","agentApi","intentsAgent","channelsAgent","createDesktopAgent","fdc3Factory"],"mappings":"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"}